-- MySQL dump 10.13  Distrib 5.6.21, for osx10.8 (x86_64)
--
-- Host: localhost    Database: lafon_development
-- ------------------------------------------------------
-- Server version	5.6.21

/*!40101 SET @OLD_CHARACTER_SET_CLIENT=@@CHARACTER_SET_CLIENT */;
/*!40101 SET @OLD_CHARACTER_SET_RESULTS=@@CHARACTER_SET_RESULTS */;
/*!40101 SET @OLD_COLLATION_CONNECTION=@@COLLATION_CONNECTION */;
/*!40101 SET NAMES utf8 */;
/*!40103 SET @OLD_TIME_ZONE=@@TIME_ZONE */;
/*!40103 SET TIME_ZONE='+00:00' */;
/*!40014 SET @OLD_UNIQUE_CHECKS=@@UNIQUE_CHECKS, UNIQUE_CHECKS=0 */;
/*!40014 SET @OLD_FOREIGN_KEY_CHECKS=@@FOREIGN_KEY_CHECKS, FOREIGN_KEY_CHECKS=0 */;
/*!40101 SET @OLD_SQL_MODE=@@SQL_MODE, SQL_MODE='NO_AUTO_VALUE_ON_ZERO' */;
/*!40111 SET @OLD_SQL_NOTES=@@SQL_NOTES, SQL_NOTES=0 */;

--
-- Table structure for table `articles`
--

DROP TABLE IF EXISTS `articles`;
/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!40101 SET character_set_client = utf8 */;
CREATE TABLE `articles` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `title` varchar(255) DEFAULT NULL,
  `body` text,
  `created_at` datetime DEFAULT NULL,
  `updated_at` datetime DEFAULT NULL,
  PRIMARY KEY (`id`)
) ENGINE=InnoDB AUTO_INCREMENT=4751 DEFAULT CHARSET=utf8;
/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Dumping data for table `articles`
--

LOCK TABLES `articles` WRITE;
/*!40000 ALTER TABLE `articles` DISABLE KEYS */;
INSERT INTO `articles` VALUES (41,'Articles by Category','TDD Basics\r\n==========\r\n-----------\r\n\r\n[Writing your First Test](http://www.rubyplus.com/articles/51 \"Writing your First Test\")\r\n[Test First Programming](http://www.rubyplus.com/articles/81 \"Test First Programming\")\r\n[Canonical Test Structure](http://www.rubyplus.com/articles/91 \"Canonical Test Structure\")\r\n[Code Mutation](http://www.rubyplus.com/articles/101 \"Code Mutation\")\r\n[Minimal Implementation](http://www.rubyplus.com/articles/121 \"Minimal Implementation\")\r\n[TDD Cycle : Red, Green, Refactor](http://www.rubyplus.com/articles/131 \"TDD Cycle : Red, Green, Refactor\")\r\n[Refactor in Green State](http://www.rubyplus.com/articles/211 \"Refactor in Green State\")\r\n[Test Behavior Not Implementation](http://www.rubyplus.com/articles/221 \"Test Behavior Not Implementation\")\r\n[Obvious Implementation](http://www.rubyplus.com/articles/521 \"Obvious Implementation\")\r\n[Learning Specs](http://www.rubyplus.com/articles/361 \"Learning Specs\")\r\n[Essential Skills for TDD](http://www.rubyplus.com/articles/381 \"Essential Skills for TDD\")\r\n[What vs How in TDD](http://www.rubyplus.com/articles/411 \"What vs How in TDD\")\r\n[Make Your Code Robust](http://www.rubyplus.com/articles/881 \'Make Your Code Robust\')\r\n[Testing computation involving floating-point numbers](http://www.rubyplus.com/articles/891 \'Testing computation involving floating-point numbers\')\r\n[Base Conversion](http://www.rubyplus.com/articles/911 \'Base Conversion\')\r\n\r\nTDD Beyond Basics\r\n=================\r\n-----------------\r\n\r\n[Fakes and Mocks](http://www.rubyplus.com/articles/141 \"Fakes and Mocks\")\r\n[Open Closed Principle](http://www.rubyplus.com/articles/151 \"Open Closed Principle\")\r\n[Contract Tests](http://www.rubyplus.com/articles/161 \"Contract Tests\")\r\n[Testing Random Behavior](http://www.rubyplus.com/articles/171 \"Testing Random Behavior\")\r\n[Single Purpose Principle](http://www.rubyplus.com/articles/181 \"Single Purpose Principle\")\r\n[Single Purpose Principle Revisited](http://www.rubyplus.com/articles/241 \"Single Purpose Principle Revisited\")\r\n[Dependency Inversion Principle](http://www.rubyplus.com/articles/191 \"Dependency Inversion Principle\")\r\n[Null Object](http://www.rubyplus.com/articles/201 \"Null Object\")\r\n[Synchronization Specs](http://www.rubyplus.com/articles/231 \"Synchronization Specs\")\r\n[Seams in a System](http://www.rubyplus.com/articles/251 \"Seams in a System\")\r\n[How to Use Fakes to Speed Up Tests](http://www.rubyplus.com/articles/261 \"How to Use Fakes to Speed Up Tests\")\r\n[Stubs are Not Mocks](http://www.rubyplus.com/articles/401 \"Stubs are Not Mocks\")\r\n[Factorial Kata](http://rubyplus.com/articles/441 \'Factorial Kata\')\r\n[Counting](http://rubyplus.com/articles/451 \'Counting\')\r\n[Character to Number Conversion](http://rubyplus.com/articles/641 \'Character to Number Conversion\')\r\n[Test Precisely and Concretely](http://www.rubyplus.com/articles/831 \'Test Precisely and Concretely\')\r\n[Mutation Testing](http://www.rubyplus.com/articles/951 \'Mutation Testing\')\r\n\r\nTDD Advanced Concepts\r\n=====================\r\n----------------------\r\n\r\n[Test Spy](http://www.rubyplus.com/articles/271 \"Test Spy\")\r\n[Command Query Separation Principle](http://www.rubyplus.com/articles/281 \"Command Query Separation Principle\")\r\n[Double Dispatch](http://www.rubyplus.com/articles/341 \"Double Dispatch\")\r\n[Dealing with External API](http://www.rubyplus.com/articles/351 \"Dealing with External API\")\r\n[Spiking and TDD](http://rubyplus.com/articles/671 \'Spiking and TDD\')\r\n\r\nTDD Best Practice\r\n=================\r\n-----------------\r\n\r\n[Eliminating Loops in Tests](http://rubyplus.com/articles/111 \"Eliminating Loops in Tests\")\r\n\r\n\r\nKatas\r\n======\r\n-------\r\n\r\nBasics\r\n-------\r\n\r\n[Reverse the Digits of an Integer](http://www.rubyplus.com/articles/581 \"Reverse the Digits of an Integer\")\r\n[String Calculator Kata](http://www.rubyplus.com/articles/371 \"String Calculator Kata\")\r\n[Bowling Game Kata](http://www.rubyplus.com/articles/301 \"Bowling Game Kata\")\r\n[Bowling Game Kata Part 2](http://www.rubyplus.com/articles/311 \"Bowling Game Kata\")\r\n[Bowling Game Kata part 3](http://www.rubyplus.com/articles/321 \"Bowling Game Kata\")\r\n[Bowling Game Kata Final Solution](http://www.rubyplus.com/articles/331 \"Bowling Game Kata\")\r\n[FizzBuzz Kata](http://www.rubyplus.com/articles/421 \"FizzBuzz Kata\")\r\n[Generate Prime Numbers](http://rubyplus.com/articles/461 \'Generate Prime Numbers\')\r\n[The Sieve of Erastosthenes](http://rubyplus.com/articles/471 \'The Sieve of Erastosthenes\')\r\n\r\nBeyond Basics\r\n--------------\r\n\r\n[Factorial Kata](http://www.rubyplus.com/articles/441 \"Factorial Kata\")\r\n[Counting](http://www.rubyplus.com/articles/451 \"Counting\")\r\n[Greatest Common Divisor](http://www.rubyplus.com/articles/481 \"Greatest Common Divisor\")\r\n[Tennis Kata](http://www.rubyplus.com/articles/491 \"Tennis Kata\")\r\n[Prime Factors Kata](http://www.rubyplus.com/articles/511 \"Prime Factors Kata\")\r\n[Prime Factors Kata Analysis](http://www.rubyplus.com/articles/541 \"Prime Factors Kata Analysis\")\r\n\r\nAdvanced\r\n--------\r\n\r\n[Angry Rock Kata](http://www.rubyplus.com/articles/291 \"Angry Rock Kata\")\r\n[Sum Kata](http://www.rubyplus.com/articles/431 \"Sum Kata\")\r\n\r\nRails\r\n=======\r\n-------\r\n\r\n[How to Install Redis](http://rubyplus.com/articles/501 \"How to Install Redis\")\r\n[How to install and configure Resque](http://www.rubyplus.com/articles/531 \"How to install and configure Resque\")\r\n[How to use Mailchimp API to subscribe users in Rails 4.1](http://www.rubyplus.com/articles/551 \"Mailchimp API\")\r\n[Sending emails using SendGrid API in Rails 4.1](http://www.rubyplus.com/articles/561 \"SendGrid API\")\r\n[Using SuckerPunch gem for Background Job Processing in Rails 4.1](http://www.rubyplus.com/articles/571 \"SuckerPunch\")\r\n[SSHKit Gem Basics](http://www.rubyplus.com/articles/591 \"SSHKit\")\r\n[SSHKit Gem Basics Part 2](http://www.rubyplus.com/articles/601 \"SSHKit\")\r\n[Availability Tests](http://www.rubyplus.com/articles/611 \"Availability Tests\")\r\n[How to Install Alpha SSL certificate using Moonshine for Rails 4.1](http://www.rubyplus.com/articles/621 \"Alpha SSL\")\r\n[Simple Direct File Upload to Amazon S3 in Rails](http://rubyplus.com/articles/651 \'Simple Direct File Upload to Amazon S3 in Rails\')\r\n[Rails Tips](http://www.rubyplus.com/articles/771 \'Rails Tips\')\r\n\r\nNo SQL\r\n=======\r\n-------\r\n\r\n[MongoDB Basics](http://www.rubyplus.com/articles/851 \'MongoDB Basics\')\r\n[MongoDB Basics Part 2](http://www.rubyplus.com/articles/861 \'MongoDB Basics Part 2\')\r\n[HBase Basics](http://www.rubyplus.com/articles/901 \'HBase Basics\')\r\n[CouchDB Basics](http://www.rubyplus.com/articles/921 \'CouchDB Basics\')\r\n[MongoDB Ruby Driver Tutorial](http://www.rubyplus.com/articles/931 \'MongoDB Ruby Driver Tutorial\')\r\n\r\nSQL Basics\r\n=======\r\n-------\r\n\r\n[Create, Insert and Select Statements](http://rubyplus.com/articles/981 \'Create, Insert and Select Statements\')\r\n[Sorting](http://rubyplus.com/articles/991 \'Sorting\')\r\n[Search Conditions] (http://rubyplus.com/articles/1001 \'Search Conditions\')\r\n[Advanced Search Conditions](http://rubyplus.com/articles/1011 \'Advanced Search Conditions\')\r\n[Wildcard Search](http://rubyplus.com/articles/1021 \'Wildcard Search\')\r\n[Calculated Fields](http://rubyplus.com/articles/1031 \'Calculated Fields\')\r\n[Aggregate Functions](http://rubyplus.com/articles/1041 \'Aggregate Functions\')\r\n[Grouping Data](http://rubyplus.com/articles/1051 \'Grouping Data\')\r\n[Subqueries](http://rubyplus.com/articles/1061 \'Subqueries\')\r\n[Joins](http://rubyplus.com/articles/1071 \'Joins\')\r\n[Inner Join](http://rubyplus.com/articles/1081 \'Inner Join\')\r\n[Advanced Joins](http://rubyplus.com/articles/1091 \'Advanced Joins\')\r\n[Update and Delete](http://rubyplus.com/articles/1101 \'Update and Delete\')\r\n[MySql2 Gem Basics](http://www.rubyplus.com/articles/791 \'MySql2 Gem Basics\')\r\n[SQLite Basics](http://www.rubyplus.com/articles/801 \'SQLite Basics\')\r\n\r\nRuby Threads\r\n=======\r\n-------\r\n\r\n[Ruby Thread Basics](http://www.rubyplus.com/articles/841 \'Ruby Thread Basics\')\r\n[Troubleshooting Thread Deadlocks using strace](http://www.rubyplus.com/articles/971 \'Troubleshooting Thread Deadlocks using strace\')\r\n\r\nPayment Gateways\r\n=======\r\n-------\r\n\r\n[Recurring Billing using Stripe API](http://www.rubyplus.com/articles/941 \'Recurring Billing using Stripe API\')\r\n[Stripe Recurring Billing Part 2](http://www.rubyplus.com/articles/961 \'Stripe Recurring Billing Part 2\')\r\n\r\nBooks\r\n=======\r\n-------\r\n\r\n[Top 20 Things a Programmer Should Know](http://www.rubyplus.com/articles/811 \'Top 20 Things a Programmer Should Know\')\r\n[The Next 17 Things a Programmer Should Know](http://www.rubyplus.com/articles/871 \'The Next 17 Things a Programmer Should Know\')\r\n[Code Simplicity Book Review](http://www.rubyplus.com/articles/821 \'Code Simplicity Book Review\')\r\n\r\n\r\nDesign\r\n=======\r\n-------\r\n\r\n[Flexible Design](http://rubyplus.com/articles/661 \'Flexible Design\')\r\n\r\nTips\r\n=======\r\n-------\r\n\r\n[Unix Tips](http://www.rubyplus.com/articles/681 \'Unix Tips\')\r\n[Subversion Tips](http://www.rubyplus.com/articles/691 \'Subversion Tips\')\r\n[Ruby Gem Tips](http://www.rubyplus.com/articles/701 \'Ruby Gem Tips\')\r\n[RSpec Tips](http://www.rubyplus.com/articles/761 \'RSpec Tips\')\r\n[RVM Tips](http://www.rubyplus.com/articles/781 \'RVM Tips\')\r\n\r\n\r\nMiscellaneous\r\n=======\r\n-------\r\n\r\n[Git Command Quick Reference](http://www.rubyplus.com/articles/711 \'Git Command Quick Reference\')\r\n[How to install Nokogiri on Lion](http://www.rubyplus.com/articles/721 \'How to install Nokogiri on Lion\')\r\n[Installing Ruby 1.9.3 using RVM in Lion](http://www.rubyplus.com/articles/731 \'Installing Ruby 1.9.3 using RVM in Lion\')\r\n[Memcache and Redis Installation](http://www.rubyplus.com/articles/741 \'Memcache and Redis Installation\')\r\n[RabbitMQ on Mac OS X](http://www.rubyplus.com/articles/751 \'RabbitMQ on Mac OS X\')','2014-08-24 05:49:14','2014-10-26 22:29:17'),(51,'TDD Basics : Writing your First Test','Pre-requisites\r\n=========\r\n---------\r\n\r\n  - Ruby 2 or above must be installed\r\n  - Your favorite text editor\r\n  - RSpec gem 2 or above\r\n\r\nObjective\r\n==========\r\n \r\nLearn about assertion. \r\n\r\nScope\r\n=========\r\n---------\r\n\r\nIn Test First Programming, you write the test before you write the code. This article does not use Test First Programming. Test First Programming is introduced in the next article.\r\n \r\nSteps\r\n=========\r\n----------\r\n\r\nStep 1\r\n---------\r\n\r\nLet\'s write a calculator program that can add two numbers. Create a calculator.rb file with Calculator class that has an add method as shown:\r\n\r\n```ruby\r\nclass Calculator \r\n  def add(x, y)\r\n    x+y\r\n  end \r\nend\r\n```\r\n\r\nStep 2\r\n---------\r\n\r\nAdd the following code to calculator.rb below the Calculator class to manually test the calculator add feature:\r\n\r\n```ruby\r\nclass Calculator \r\n  def add(x, y)\r\n    x+y\r\n  end \r\nend\r\n\r\ncalculator = Calculator.new\r\nresult = calculator.add(1, 1)\r\nputs result\r\n```\r\n\r\nCode and test is in the same file because it is easier to see all the code at once.\r\n\r\nStep 3\r\n---------\r\n\r\nRun this program as follows:\r\n\r\n```ruby\r\nruby calculator.rb\r\n```\r\n\r\nIn this case we print the result. We know 1 + 1 = 2. So, we check if the result is equal to the expected value, which is 2. If it is correct we know it works otherwise we either debug our code using a debugger or add print statements to troubleshoot and fix the problem. This manual verification of the result will become tedious when our programs grow and become big.\r\n\r\nStep 4\r\n---------\r\n\r\nSo the question is : How can we automate the manual verification? Let’s modify the program :\r\n\r\n```ruby\r\nclass Calculator \r\n  def add(x, y)\r\n    x+y\r\n  end \r\nend\r\n\r\ncalculator = Calculator.new\r\nresult = calculator.add(1,2)\r\nif result == 3\r\n  puts \"Addition passed\"\r\nelse\r\n  puts \"Addition failed\" \r\nend\r\n```\r\n\r\nIn this version we have removed the manual verification step where we check the result is equal to the expected value by the conditional check in the ‘if’ statement.\r\n\r\nStep 5\r\n---------\r\n\r\nLet’s make the output easier to recognize.\r\n\r\n```ruby\r\nclass Calculator \r\n  def add(x, y)\r\n    x+y\r\n  end \r\nend\r\n\r\ncalculator = Calculator.new\r\nresult = calculator.add(1,2)\r\nif result == 3\r\n  print \"\\033[32m Addition passed \\033[0m\"\r\nelse\r\n  print \"\\e[31m Addition failed \\e[0m\" \r\nend\r\n```\r\n\r\nNow the output message will be red when it fails and green when it passes.\r\n\r\nStep 6\r\n---------\r\n\r\nLet’s now implement the subtraction:\r\n\r\n```ruby\r\nclass Calculator \r\n  def add(x, y)\r\n    x+y\r\n  end \r\n\r\n  def subtract(x, y)\r\n    x-y\r\n  end\r\nend\r\n\r\ncalculator = Calculator.new\r\nresult = calculator.add(1,2)\r\nif result == 3\r\n  print \"\\033[32m Addition passed \\033[0m\"\r\nelse\r\n  print \"\\e[31m Addition failed \\e[0m\" \r\nend\r\n\r\nresult2 = calculator.subtract(2, 1)\r\nif result2 == 1\r\n  print \"\\033[32m Subtraction passed \\033[0m\"\r\nelse\r\n  print \"\\e[31m Subtraction failed \\e[0m\" \r\nend\r\n```\r\n\r\nStep 7\r\n---------\r\n\r\nThis works. Now we see duplication in our code. Let’s create a utility method that we can reuse. The verify method is defined outside the calculator class.\r\n\r\n```ruby\r\nclass Calculator \r\n  def add(x, y)\r\n    x+y\r\n  end \r\n\r\n  def subtract(x, y)\r\n    x-y\r\n  end\r\nend\r\n\r\ndef verify(expected, actual, message) \r\n  if actual == expected\r\n    print \"\\033[32m #{message} passed \\033[0m\" \r\n  else\r\n    print \"\\e[31m #{message} failed \\e[0m\" \r\n  end\r\nend\r\n```\r\n\r\nStep 8\r\n---------\r\n\r\nWe can now simplify our test program :\r\n\r\n```ruby\r\nclass Calculator \r\n  def add(x, y)\r\n    x+y\r\n  end \r\n\r\n  def subtract(x, y)\r\n    x-y\r\n  end\r\nend\r\n\r\ndef verify(expected, actual, message) \r\n  if actual == expected\r\n    print \"\\033[32m #{message} passed \\033[0m\" \r\n  else\r\n    print \"\\e[31m #{message} failed \\e[0m\" \r\n  end\r\nend\r\n\r\ncalculator = Calculator.new\r\nresult = calculator.add(1, 2)\r\nverify(3, result, \'Addition\')\r\nresult2 = calculator.subtract(2, 1)\r\nverify(1, result2, \'Subtraction\')\r\n```\r\n\r\nThe verify() method that we have developed is called assertion. It automates the manual verification of the test result.\r\n\r\nDiscussion\r\n==========\r\n----------\r\n\r\nAccording to the dictionary assertion is a confident and forceful statement of fact or belief.\r\nOur assert method verify can only be used for integer values. If we need to compare boolean, strings, decimals etc we need to revise our simple assert method to handle those types. Wouldn’t it be nice if there was a library that provided this feature? Well, that’s where the test frameworks such as Minitest and Rspec come into picture. In MiniTest the verify method is named ‘assert’ and in rspec it is named ‘should’ in 2.0 version and \'expect\' in 3.0 version.\r\n\r\nExercises\r\n==========\r\n----------\r\n\r\nAdd code to test_calculator.rb to implement multiplication and division similar to the addition and subtraction examples.\r\n\r\nDiagnostics\r\n============\r\n----------\r\n\r\nLet’s improve the diagnostics message when something goes wrong.\r\n\r\n```ruby\r\ndef verify(expected, actual, message) \r\n  if actual == expected\r\n    print \"\\033[32m #{message} passed \\033[0m\" \r\n  else\r\n    puts \"Expected : #{expected} but got : #{actual} #{message}\r\n    print \"\\e[31m #{message} failed \\e[0m\"\r\n  end \r\nend\r\n```\r\n\r\n![alt text](https://images.rubyplus.com/big-picture.jpeg \"TDD Cycle : Improving Diagnostics\"). \r\n\r\nWe will learn more about TDD cycle in an upcoming article.\r\n\r\nSummary\r\n========\r\n---------\r\n\r\nIn this article you learned about assertion and why you need them. Assertion is at the heart of a test. You cannot write a test without an assertion. In the next article we will discuss Test First Programming.\r\n','2014-07-23 00:11:36','2016-12-22 04:51:10'),(81,'TDD Basics : Test First Programming','Objective\r\n=========\r\n----------\r\n\r\n- To learn about Test First Programming\r\n\r\nDiscussion\r\n==========\r\n----------\r\n\r\nLet\'s write a simple calculator program driven by test. What statements can you make about the calculator program that is true? How about :\r\n\r\n  - It should add given two numbers\r\n  \r\nSteps\r\n=========\r\n---------\r\n\r\nStep 1\r\n-------\r\n\r\nLet\'s write a specification for this statement. Create a file called calculator_spec.rb with the following contents:\r\n\r\n```ruby\r\ndescribe Calculator do\r\n  it \'should add given two numbers\' \r\nend\r\n```\r\n\r\nThe **describe** is a RSpec method. In this case, we are describing the behavior of the Calculator class. We are expressing the requirement in the method called **it** that takes a string as it\'s argument. \r\n\r\nStep 2\r\n----------\r\n\r\nGo to the directory where the spec file resides and run the test like this:\r\n\r\n```ruby\r\n$rspec calculator_spec.rb --color --format documentation\r\n```\r\n\r\nThis test fails. \r\n\r\nStep 3\r\n--------------\r\n\r\nDefine Calculator class at the top of the calculator_spec.rb file with the code shown below:\r\n\r\n```ruby\r\nclass Calculator\r\nend\r\n\r\ndescribe Calculator do\r\n  it \'should add given two numbers\' \r\nend\r\n```\r\n\r\nYou now see a pending spec. This is because you have not written the test yet.\r\n\r\nStep 4\r\n--------------\r\n\r\nLet\'s write the test as follows:\r\n\r\n```ruby\r\nclass Calculator\r\nend\r\n\r\ndescribe Calculator do\r\n  it \'should add given two numbers\' do\r\n    calculator = Calculator.new\r\n    \r\n    result = calculator.add(1,2)\r\n    \r\n    expect(result).to eq(3)\r\n  end\r\nend\r\n```\r\n\r\nThe describe() is a method that takes the class name as its argument. The test is written inside the do-end block of the **it** method. The it() method takes a string argument. This string argument is called the **doc string** and describes the scenario we are testing. \r\n\r\nWe first create an instance of the Calculator class. The second step is invoking the method add(x, y) to calculate sum of two numbers. The third step is checking if the result is the same as we expect. In this step, we have converted the statement that is true to an assertion. The expect() method is the assertion in rspec. It takes an argument that needs to be verified for correctness.\r\n\r\nStep 5\r\n--------------\r\n\r\nFollow the step 2 instructions to run the test again. This test fails because you have not defined the add(x,y) method.\r\n\r\nStep 6\r\n--------------\r\n\r\nDefine the add method to the class as follows:\r\n\r\n```ruby\r\nclass Calculator\r\n  def add(x,y)\r\n    \r\n  end\r\nend\r\n\r\ndescribe Calculator do\r\n  # The code here is same as before.\r\nend\r\n```\r\n\r\nStep 7\r\n--------------\r\n\r\nFollow the step 2 instructions to run the test again. We now have a test that is failing for the right reason. Failing for the right reason means that the test will fail to satisfy the requirements instead of syntax mistakes, missing require statements etc.\r\n\r\nStep 8\r\n--------------\r\n\r\nChange the add to return : x + y. Now the test passes.\r\n\r\nStep 9\r\n--------------\r\n\r\nYou can now move the Calculator class to its own file called calculator.rb.\r\n\r\nStep 10\r\n--------------\r\n\r\nAdd \r\n\r\n```ruby\r\nrequire_relative \'calculator\'\r\n```\r\n\r\nto the top of the calculator_spec.rb. So the complete code listing for calculator.rb looks like this:\r\n\r\n```ruby\r\nrequire_relative \'calculator\'\r\n\r\nclass Calculator\r\n  def add(x,y)\r\n    x + y \r\n  end\r\nend\r\n```\r\n\r\nStep 11\r\n--------------\r\n\r\nRun the test again. It should now pass. \r\n\r\nSummary\r\n=========\r\n-----------\r\n\r\nIn this article we took little baby steps. We wrote the test first. Initial error messages were related to setting up the environment. Once you get past that, you can make the test fail for the right reason. Then you implement the code to make the test pass. Once you get to green you can cleanup the test and the production code. This is called as refactoring. We will discuss more about refactoring in another article.\r\n\r\nQ&A\r\n-----------\r\n**Why do we need to make the test fail for the right reason?**\r\n\r\nTest does not have a test to prove its correctness. The correctness of the test is done manually, just once by making sure that it fails for the right reason. Strive to make the test so simple that it does not require a test.\r\n\r\n**Why did we define the Calculator class in the same file as the test?**\r\n\r\nWe did that for convenience, we were able to see all the code at once. You don\'t have to have them in the same file. You could have split panes in your IDE showing both files so that it is easy to write code.\r\n\r\nExercises\r\n===========\r\n-----------\r\n\r\n1. Write specs for the following statements:\r\n   - It should subtract given two numbers\r\n	 - It should multiply given two numbers\r\n	 - It should divide given two numbers\r\n\r\n2. Write specs for edge cases such as invalid input, division by 0 etc.\r\n\r\n3. Create a .rspec file with the following contents\r\n\r\n```ruby\r\n--color\r\n--format documentation\r\n```\r\n\r\nNow you can run the specs without giving it any options like this:\r\n\r\n```ruby\r\nrspec calculator_spec.rb\r\n```\r\n\r\nWhat do you see as the output in the terminal?','2014-07-24 01:20:12','2014-08-13 05:17:16'),(91,'TDD Basics : Canonical Test Structure','Objective\r\n=========\r\n---------\r\n\r\n- To practice Canonical Test Structure, Given, When, Then\r\n\r\nDiscussion\r\n==========\r\n---------\r\n\r\nAccording to the dictionary, the term canonical is defined as:\r\n\r\n```sh\r\nMathematics : relating to a general rule or standard formula.\r\n```\r\n\r\nIn our case, the following three steps is a standard forumula for writing any test:\r\n\r\n```sh\r\nStep 1 - Given : Precondition. The System is in a known state.\r\nStep 2 - When  : Exercise the System Under Test (SUT)\r\nStep 3 - Then  : Postcondition. Check the outcome is as expected.\r\n```\r\n  \r\nSteps\r\n=========\r\n---------\r\n\r\nStep 1\r\n-------\r\n\r\nCreate a file stack_spec.rb with the following contents:\r\n\r\n```ruby\r\nrequire_relative \'stack\'\r\n\r\ndescribe Stack do\r\n  it \'should push a given item\' do\r\n    stack = Stack.new\r\n	\r\n    stack.push(1)\r\n	\r\n    stack.size.should == 1\r\n  end \r\n\r\n  it \'should pop from the stack\' do\r\n    stack = Stack.new\r\n    stack.push(2)\r\n	\r\n    result = stack.pop\r\n	\r\n    result.should == 2\r\n    stack.size.should == 0\r\n  end\r\nend\r\n```\r\n\r\nWe have two specs that describe the behavior of push and pop operations of Stack. \r\n\r\nStep 2\r\n----------\r\n\r\nCreate a file stack.rb with a simple implementation that can push and pop as follows:\r\n\r\n```ruby\r\nclass Stack\r\n  def initialize\r\n	  @elements = []\r\n  end\r\n	\r\n  def push(item)\r\n	  @elements << item\r\n  end\r\n	\r\n  def	pop\r\n	  @elements.pop\r\n  end\r\n	\r\n  def size\r\n	  @elements.size\r\n  end\r\nend\r\n```\r\n\r\nStep 3\r\n--------------\r\n\r\nRun the specs. \r\n\r\n```ruby\r\n$rspec stack_spec.rb\r\n```\r\n\r\nYou should see them all pass.\r\n\r\nDiscussion\r\n==========\r\n----------\r\n\r\nInstead of thinking about **How do I write a test?**. Ask yourself the following questions:\r\n\r\n- What is the given condition?\r\n- How do I exercise the system under test?\r\n- How do I verify the outcome?\r\n\r\nThe answers to these questions will help you write the test. These questions correspond to each of the step in the Canonical Test Structure. \r\n\r\nFor example, if you have a class called Car, you need to have fuel in order to drive the car. The given condition in this case is that is has fuel. The **drive** is the behavior you are testing so you invoke drive() on the instance of a car in order to exercise the system under test. When you drive you expect to travel. So, you can verify the outcome by checking the distance traveled for a given amount of time and average speed.\r\n\r\nIdentifying Given, When, Then\r\n=============================\r\n----------\r\n\r\nHere is an example of how to identify Given, When, Then in a test. Copy the following given_when_then.rb to canonical exercise directory. \r\n\r\n```ruby\r\ndef Given\r\n  yield\r\nend\r\n\r\ndef When\r\n  yield\r\nend\r\n\r\ndef Then\r\n  yield\r\nend\r\n```\r\n\r\nThese are just methods in the given_when_then.rb file. Do not create a class for given_when_then.rb. The following code identifies the three steps for the stack_spec.rb:\r\n\r\n```ruby\r\nrequire_relative \'stack\'\r\nrequire_relative \'given_when_then\'\r\n\r\ndescribe Stack do\r\n  it \'should push a given item\' do\r\n    Given { @stack = Stack.new }\r\n		\r\n    When { @stack.push(1) }\r\n		\r\n    Then { @stack.size.should == 1}\r\n  end\r\nend\r\n```\r\n\r\nStep 4\r\n--------\r\n\r\nRun the stack_spec.rb. It should pass. \r\n\r\nDiscussion\r\n==========\r\n---------\r\n\r\nThis is an example for State Verification. We check the state of the system after we exercise the SUT for correctness.\r\n\r\nSummary\r\n=========\r\n---------\r\n\r\nIn this article we used the training wheels given_when_then.rb to practice identifying the three steps of the canonical test structure. It is also called as Arrange Act Assert or AAA. These training wheels are not required once you understand the concept.\r\n\r\nExercises\r\n===========\r\n------------\r\n\r\nIdentify the Given, When, Then steps for the second spec:\r\n\r\n```ruby\r\nit \'should pop from the stack\'.\r\n```\r\n\r\nQ&A\r\n===========\r\n-----------\r\n\r\n**What if the method does many things things that needs to be tested?**\r\n\r\nIdeally a method should be small and do just one thing. If a method has three steps with different scenarios, then you will write three different specs for each scenario.\r\n\r\n**What if I want to test push and pop in one test?**\r\n\r\nThe structure of the test is Arrange, Act, Assert. There should be only one Arrange, one Act and one Assert per test. In this case you would have multiple of each of these steps. So it does not follow the best practice. \r\n\r\n**Why do we need just one AAA in our test?**\r\n\r\nBecause if you had multiple of each of the steps, you would have the state at the end of the first assertion interact with the state at the end of the second assertion. Ideally we want each test to be isolated. \r\n\r\nThis is discussed in depth in xUnit Test Patterns by Gerard Mesaros. Here is a concise version of his discussion on this topic.\r\n\r\n**Principle: Verify One Condition per Test**\r\n\r\nAlso known as: Single Condition Test\r\n\r\nWhen one assertion fails, the rest of the test is not executed. This makes it hard to achieve Defect Localization. A single failed assertion will cause the test to stop running and the rest of the test will provide no data on what works and what doesn\'t.\r\n\r\n**What is isolation?**\r\n\r\nIsolation means that the state is clean in the beginning of each test and it cleans up the state at the end of each test. This makes our tests independent. Making tests independent is a good practice. When the tests are independent we can run them in any order and they will pass.','2014-07-24 16:30:54','2014-08-23 19:35:29'),(101,'TDD Basics : Code Mutation ','Objective\r\n=========\r\n---------\r\n\r\n- To illustrate the need to mutate the code when the test passes without failing.\r\n\r\nDiscussion\r\n==========\r\n---------\r\n\r\nThe test is written before the code and if it passes without failing, then we don\'t know if the test is correct. In such cases, you must modify the production code to make the test fail to make sure that it is testing the right thing. \r\n\r\nSteps\r\n=========\r\n---------\r\n\r\nStep 1\r\n-------\r\n\r\nCreate a ruby_extensions_spec.rb with the following contents:\r\n\r\n```ruby\r\nrequire_relative \'ruby_extensions\'\r\n\r\ndescribe \'Ruby extensions\' do\r\n  it \'return a list of elements common to both arrays without duplicates\' do\r\n    a = [1,1,3,5]\r\n    b = [1,2,3]\r\n    result = a.intersection(b)\r\n		\r\n    result.should == [1, 3]\r\n  end \r\nend\r\n```\r\n\r\nStep 2\r\n----------\r\n\r\nTo make the test pass, create ruby_extensions.rb with the following contents:\r\n\r\n```ruby\r\nclass Array\r\n  def intersection(another)\r\n    self & another\r\n  end\r\nend\r\n```\r\n\r\nThe & opertor is used for intersection operation in Array. The builtin Array class does not have intersection method. We are opening the Ruby\'s Array class and defining a intersection method. The test should pass.\r\n\r\nStep 3\r\n--------------\r\n\r\nAdd the second spec for the boundary condition like this:\r\n\r\n```ruby\r\nrequire_relative \'ruby_extensions\'\r\n\r\ndescribe \'Array extensions\' do\r\n  # First spec same as before\r\n	\r\n	# Here is the new spec\r\n	it \'returns no common element if there is no common elements between the two arrays\' do\r\n    a = [1,1,3,5]	\r\n    b = [7,9]\r\n    result = a.intersection(b)\r\n		\r\n    result.should == []		\r\n  end\r\nend\r\n```\r\n\r\nStep 4\r\n-----------\r\n\r\nRun the specs now. The new test passes without failing. The question is how do you know if this test is correct? We don\'t have a test to test this test. To validate the test, we have to mutate the production code to make it fail for the scenario under test.\r\n\r\nStep 5\r\n-----------\r\n\r\nChange the ruby_extensions.rb so that only the second spec fails like this:\r\n\r\n```ruby\r\nclass Array\r\n  def intersection(another)\r\n    return [1]\r\n    self & another\r\n  end\r\nend\r\n```\r\n\r\nHere we short-circuit the code to bypass the correct implementation and provide a wrong value as the answer.\r\n\r\nStep 6\r\n--------------\r\n\r\nNow run the specs. The second spec now breaks with the error:\r\n\r\n```ruby\r\n1) Array Array extensions returns no common element if there is no common elements between the two arrays\r\n   Failure/Error: result.should == []\r\n     expected: []\r\n       got: [1] (using ==)\r\n```\r\n\r\nStep 7\r\n--------------\r\n\r\nDelete the line below from the ruby_extensions.rb\r\n\r\n```ruby\r\nreturn [1] \r\n```\r\n\r\nStep 8\r\n--------------\r\n\r\nRun the specs. It should now pass.\r\n\r\nSummary\r\n=========\r\n---------\r\n\r\nIn this article we saw:\r\n\r\n- What to do when the test passes without failing?\r\n- How to open classes that preserves the semantics of the core classes?\r\n- Intention revealing variable and method names.\r\n\r\nSo we learned why and when to mutate the production code. If you had followed the Transformation Priority Premise, this problem would not have occurred at all. \r\n\r\nExercises\r\n===========\r\n-----------\r\n\r\n1. Google the term \'Transformation Priority Premise\' and watch the videos to learn about this principle.\r\n2. Think of edge cases for the ruby_extensions.rb. \r\n3. Write specs for the edge cases. When the spec passes without failing, mutate the code to make only the boundary condition for that particular test fail. Then make all the specs pass.\r\n','2014-07-24 23:01:49','2014-12-12 09:25:54'),(111,'TDD Best Practice : Eliminating Loops in Tests','Objective\r\n=========\r\n---------\r\n\r\nThe objective of this lesson is to illustrate how to eliminate loops in specs. \r\n\r\nDiscussion\r\n==========\r\n---------\r\n\r\nThis article illustrates the Communicate Intent Principle discussed in the xUnit Test Patterns by Gerard Mezaros. This principle is also known as: Higher Level Language, Single Glance Readable. If we have to squint our eyes when we look at the test, then it is harder to understand because we need to infer the \"big picture\" from all the details.\r\n\r\nThe tests must specify and focus on **WHAT** instead of implementation, the **HOW**. Loops are implementation details. For an indepth discussion on What vs How, read the [What vs How in Test Driven Development](http://www.rubyplus.com/articles/411 \"What vs How in Test Driven Development\") article. \r\n\r\nJust quickly read the following code for meszaros gem : https://github.com/bparanj/meszaros to see the utility methods that help to eliminate loops in specs. Here is the loop_spec.rb\r\n\r\n```ruby\r\nrequire \'spec_helper\'\r\nrequire \'meszaros/loop\'\r\n\r\nmodule Meszaros\r\n  describe Loop do\r\n    it \'should allow data driven spec : 0\' do\r\n      result = []\r\n      Loop.data_driven_spec([]) do |element|\r\n        result << element\r\n      end\r\n\r\n      result.should be_empty\r\n    end\r\n\r\n    it \'should allow data driven spec : 1\' do\r\n      result = []\r\n      Loop.data_driven_spec([4]) do |element|\r\n        result << element\r\n      end\r\n\r\n      result.should == [4]\r\n    end\r\n\r\n    it \'should allow data driven spec : n\' do\r\n      result = []						\r\n      Loop.data_driven_spec([1,2,3,4]) do |element|\r\n        result << element\r\n      end\r\n			\r\n      result.should == [1,2,3,4]\r\n    end\r\n		\r\n    it \'should raise exception when nil is passed as the parameter\' do\r\n      expect do\r\n        Loop.data_driven_spec(nil) do |element|\r\n          true.should be_true\r\n        end\r\n      end.to raise_error\r\n    end\r\n	 \r\n    it \'execute code 0 times\' do\r\n      result = 0\r\n\r\n      Loop.repeat(0) do\r\n        result += 1\r\n      end\r\n			\r\n      result.should == 0\r\n    end\r\n		\r\n    it \'execute code once\' do\r\n      result = 0\r\n\r\n      Loop.repeat(0) do\r\n        result += 1\r\n      end\r\n	\r\n      result.should == 1\r\n    end\r\n    	\r\n    it \'raises exception for nil parameter in repeat\' do\r\n      expect do\r\n        Loop.repeat(nil) do\r\n          true.should be_true\r\n        end\r\n      end.to raise_error\r\n    end\r\n\r\n    it \'raises exception for string parameter in repeat\' do\r\n      expect do\r\n        Loop.repeat(\'dumb\') do\r\n          true.should be_true\r\n        end\r\n      end.to raise_error\r\n    end\r\n\r\n    it \'raises exception for float parameter in repeat\' do\r\n      expect do\r\n        Loop.repeat(1.1) do\r\n          true.should be_true\r\n        end\r\n      end.to raise_error\r\n    end\r\n\r\n    it \'execute code n number of times\' do\r\n      result = 0\r\n\r\n      Loop.repeat(3) do\r\n      result += 1\r\n    end\r\n			\r\n    result.should == 3\r\n   end\r\nend\r\n```\r\n\r\nHere is loop.rb\r\n\r\n \r\n```ruby\r\nmodule Meszaros\r\n  class Loop\r\n    def self.data_driven_spec(container)\r\n      container.each do |element|\r\n        yield element\r\n      end\r\n    end\r\n	\r\n    def self.repeat(n)\r\n      n.times { yield }		\r\n    end\r\n  end\r\nend\r\n```\r\n\r\nDiscussion\r\n=============\r\n--------------\r\n\r\nFrom the specs, you can see the cases for looping 0, 1 and n times. We gradually increase the complexity of the tests and extend the solution to a generic case of n. It also documents the behavior for illegal inputs. The developer can see how the API works by reading the specs. Data driven spec and repeat methods are available in meszaros gem.\r\n\r\nThe **WHAT** is like a blue print for a house. Blue print does not get buried under implementation details of a house. The **HOW** is the mechanics of implementation. \r\n\r\n![alt text](https://images.rubyplus.com/house-blueprint.gif \"House Blueprint\")\r\n\r\nWhen you see the blue print for a house you can answer questiosn like:\r\n\r\n- What is the size of master bed room?\r\n- What is the living room?\r\n- Where is the balcony?\r\n\r\nand so on. It does not specify the material used to build the house, paint color, whether the floor will be hardwood floor etc. These are implementation details.\r\n  \r\nBefore\r\n=========\r\n---------\r\n\r\nLet\'s take a look at an example to see how the code would look like when it mixes the **WHAT** with **HOW**. The code for before section is stolen from Alex Chaffe\'s presentation: https://github.com/alexch/test-driven\r\n\r\nMatrix Test\r\n-----------\r\n\r\n```ruby\r\nclass String\r\n  def vowel?\r\n    %w(a e i o u).include?(self)	\r\n  end\r\nend\r\n\r\ndescribe \'Vowel Checker\' do\r\n  %w(a e i o u).each do |letter|\r\n    it \"#{letter} is a vowel\" do\r\n      letter.should be_vowel\r\n    end\r\n  end\r\nend\r\n```\r\n\r\nThis mixes the **WHAT** and **HOW**. It is not clear. Since the implementation detail buries the intent of the spec. It passes with the message:\r\n\r\n```ruby\r\n$rspec ruby_extensions_spec.rb --color --format doc\r\n\r\nVowel Checker\r\n  a is a vowel\r\n  e is a vowel\r\n  i is a vowel\r\n  o is a vowel\r\n  u is a vowel\r\nFinished in 0.0048 seconds 5 examples, 0 failures\r\n\r\n```\r\n\r\nAfter\r\n===========\r\n-----------\r\n\r\nHow can we communicate intent in the specs? Here is the code after fixing this problem:\r\n\r\nData Driven Spec\r\n----------------\r\n\r\n```ruby\r\nclass String\r\n  def vowel?\r\n    %w(a e i o u).include?(self)\r\n  end\r\nend\r\n\r\ndef data_driven_spec(container)\r\n  container.each do |element|\r\n    yield element\r\n  end\r\nend\r\n\r\ndescribe \'Vowel Checker\' do\r\n  specify \'a, e, i, o, u are the vowel set\' do\r\n    data_driven_spec(%w(a e i o u)) do |letter|\r\n      letter.should be_vowel\r\n    end\r\n  end			\r\nend\r\n```\r\n\r\nRun the specs.\r\n\r\n```ruby\r\n$rspec ruby_extensions_spec.rb --color --format doc\r\n```\r\n\r\nIt passes with the following message:\r\n\r\n```ruby\r\nVowel Checker\r\n  a, e, i, o, u are the vowel set \r\nFinished in 0.00358 seconds\r\n1 example, 0 failures\r\n```\r\n\r\nThis is a specification that focuses only on **WHAT**. It separates the **WHAT** from the **HOW**. The **HOW** is hidden behind a library call data_driven_spec. The doc string is easily understood without running the program inside your head. Since the spec passed without failing, let\'s mutate the code like this:\r\n\r\n```ruby\r\nclass String\r\n  def vowel?\r\n    !(%w(a e i o u).include?(self))\r\n  end\r\nend\r\n```\r\n\r\nIt now fails with the error message:\r\n\r\n```ruby\r\n1) Vowel Checker a, e, i, o, u are the vowel set\r\n    Failure/Error: letter.should be_vowel\r\n      expected vowel? to return true, got false\r\n```\r\n\r\nThe error message is also very clear in failure. Now revert back the change. The spec should pass.\r\n\r\nExercises\r\n===========\r\n-----------\r\n\r\n- Can you think of another way to mutate the vowel?() method so that the test fails first? \r\n- Can we use the utility method in the Loop class to square or cube all elements in a given array?\r\n- Can you use a custom RSpec matcher for the vowel check?','2014-07-25 18:28:57','2016-12-22 04:52:54'),(121,'TDD Basics : Minimal Implementation','Objective\r\n=========\r\n\r\n- Learn to be minimal when implementing the production code.\r\n\r\nDiscussion\r\n=============\r\n-------------\r\n\r\n**Why do we need to be minimal when writing the production code?**\r\n\r\nBecause, the goal of TDD is to end up with a minimal system. Simplicity is the goal. \r\n\r\n![alt text](https://images.rubyplus.com/zen5.jpg \"Simplicity\")\r\n\r\n**Why do we aim for a minimal system?**\r\n\r\nBecause it will be maintainable. In a maintainable system, tests will be easy to understand, modify and extend. Keeping your code ready for unexpected changes is about simple design. \r\n\r\n![alt text](https://images.rubyplus.com/bigstock_Time_For_Change.jpg \"Time to Change\")\r\n\r\nThe only thing you can bet on tomorrow is change.\r\n\r\nSteps\r\n==========\r\n----------\r\n\r\nStep 1\r\n-------\r\n\r\nIn this example, the requirement is that we should be able to assign a role to a given user. Create a user_spec.rb file with the following contents:\r\n\r\n```ruby\r\ndescribe User do\r\n\r\nend\r\n```\r\n\r\nStep 2\r\n-------\r\n\r\nRun the spec. We get the error:\r\n \r\n```ruby\r\nuninitialized constant User\r\n```\r\n\r\nStep 3\r\n--------\r\n\r\nAdd the User class definition to the top of the user_spec.rb as follows:\r\n\r\n```ruby\r\nclass User\r\n\r\nend\r\n\r\ndescribe User do\r\n\r\nend\r\n```\r\n\r\nStep 4\r\n--------\r\n\r\nRun the test again. We are green but there are no examples to run yet.\r\n\r\nStep 5\r\n---------\r\n\r\nAdd the first spec:\r\n\r\n```ruby\r\nclass User\r\n\r\nend\r\n\r\ndescribe User do\r\n  it \'should be in any role assigned to it\'\r\nend\r\n```\r\n\r\nStep 6\r\n-------\r\n\r\nRun the spec again. You see a pending spec in the output:\r\n\r\n```ruby\r\nPending:\r\n  User should be in any role assigned to it\r\n```\r\n\r\nStep 7\r\n-------\r\n\r\nChange the spec to the following:\r\n\r\n```ruby\r\nclass User\r\n\r\nend\r\n\r\ndescribe User do\r\n  it \'should be in any role assigned to it\' do\r\n    User.new\r\n    user.assign_role(\'some role\')\r\n    user.should be_in_role(\'some role\')\r\n  end\r\nend\r\n```\r\n\r\nStep 8\r\n-------\r\n\r\nRun the spec. We get the error:\r\n\r\n```ruby\r\nundefined method \'assign_role\' for User\r\n```\r\n\r\nStep 9\r\n-------\r\n\r\nDefine the assign_role method in User class like this:\r\n\r\n```ruby\r\nclass User\r\n  def assign_role\r\n\r\n  end\r\nend\r\n\r\ndescribe User do\r\n  it \'should be in any role assigned to it\' do\r\n    User.new\r\n    user.assign_role(\'some role\')\r\n    user.should be_in_role(\'some role\')\r\n  end\r\nend\r\n```\r\n\r\nStep 10\r\n---------\r\n\r\nRun the spec. We get the error:\r\n\r\n```ruby\r\nwrong number of arguments (1 for 0)\r\n```\r\n\r\nStep 11\r\n----------\r\n\r\nAdd the argument like this:\r\n\r\n```ruby\r\nclass User\r\n  def assign_role(role)\r\n\r\n  end\r\nend\r\n\r\ndescribe User do\r\n  it \'should be in any role assigned to it\' do\r\n    User.new\r\n    user.assign_role(\'some role\')\r\n    user.should be_in_role(\'some role\')\r\n  end\r\nend\r\n```\r\n\r\nStep 12\r\n-----------\r\n\r\nRun the spec. We get the error:\r\n\r\n```ruby\r\nundefined_method \'in_role?\' for User\r\n```\r\n\r\nStep 13\r\n---------\r\n\r\nAdd in_role? method to user.rb as follows:\r\n\r\n```ruby\r\nclass User\r\n  def assign_role(role)\r\n\r\n  end\r\n  \r\n  def in_role?\r\n\r\n  end\r\nend\r\n\r\ndescribe User do\r\n  it \'should be in any role assigned to it\' do\r\n    User.new\r\n    user.assign_role(\'some role\')\r\n    user.should be_in_role(\'some role\')\r\n  end\r\nend\r\n```\r\n\r\nStep 14\r\n----------\r\n\r\nRun the spec. We get the error:\r\n\r\n```ruby\r\nwrong number of arguments (1 for 0)\r\n```\r\n\r\nStep 15\r\n-------\r\n\r\nAdd an argument to in_role? method:\r\n\r\n```ruby\r\nclass User\r\n  def assign_role(role)\r\n\r\n  end\r\n  \r\n  def in_role?(role)\r\n\r\n  end\r\nend\r\n\r\ndescribe User do\r\n  it \'should be in any role assigned to it\' do\r\n    User.new\r\n    user.assign_role(\'some role\')\r\n    user.should be_in_role(\'some role\')\r\n  end\r\nend\r\n```\r\n\r\nStep 16\r\n---------\r\n\r\nRun the spec. We get the error:\r\n\r\n```ruby\r\nexpected in_role?(\'some role\') to return true, got nil\r\n```\r\n\r\nWe are now failing for the right reason. Notice that each small step we took was guided by the failure messages given by running the test. We only did just enough to get past the current error message. We were minimal in writing the production code.\r\n\r\nStep 17\r\n----------\r\n\r\nChange the in_role? implementation like this:\r\n\r\n```ruby\r\nclass User\r\n  def assign_role(role)\r\n\r\n  end\r\n  \r\n  def in_role?(role)\r\n    true\r\n  end\r\nend\r\n\r\ndescribe User do\r\n  it \'should be in any role assigned to it\' do\r\n    User.new\r\n    user.assign_role(\'some role\')\r\n    user.should be_in_role(\'some role\')\r\n  end\r\nend\r\n```\r\n\r\nStep 18\r\n---------\r\n\r\nRun the spec. The example will now pass. We know that this implementation is bogus.\r\n\r\nStep 19\r\n---------\r\n\r\nWe want the specs to force us to write the logic that can handle assigning roles.\r\n\r\n```ruby\r\nclass User\r\n  def assign_role(role)\r\n\r\n  end\r\n  \r\n  def in_role?(role)\r\n    true\r\n  end\r\nend\r\n\r\ndescribe User do\r\n  it \'should be in any role assigned to it\' do\r\n    User.new\r\n    user.assign_role(\'some role\')\r\n    user.should be_in_role(\'some role\')\r\n  end\r\n  \r\n  it \'should not be in a role that is not assigned to it\' do\r\n    user = User.new\r\n  \r\n    user.should_not be_in_role(\'admin\')\r\n  end\r\nend\r\n```\r\n\r\nStep 20\r\n--------\r\n\r\nRun the spec. We get the error:\r\n\r\n```ruby\r\nexpected in_role?(\'admin\') to return false, got true\r\n```\r\n\r\nStep 21\r\n---------\r\n\r\nChange the user.rb as follows:\r\n\r\n```ruby\r\nclass User\r\n  def assign_role(role)\r\n    @role = role  \r\n  end\r\n  \r\n  def in_role?(role)\r\n    @role == role  \r\n  end\r\nend\r\n\r\ndescribe User do\r\n  # code remains same as before\r\nend\r\n```\r\n\r\nStep 22\r\n---------\r\n\r\nRun the specs. The specs will pass. \r\n\r\nQ&A\r\n=============\r\n-------------\r\n\r\n**How do we achieve simplicity?**\r\n\r\nIt\'s about saying no to future requirements and extra flexibility. \r\n\r\n**How do you recognize simple design?** \r\n\r\nKnowledge. Knowledge is insight in problem domain. It develops over time.\r\n\r\n**How can you achieve simple design?**\r\n\r\nGain knowledge. Refactor to reflect new understanding. Code bare minimum. Keep things as simple as possible for as long as possible.\r\n\r\n**Do we always have to take such small steps?**\r\n\r\nNo. If you are confident that you can get to green quickly you can take bigger steps. If you are taking bigger steps and you end up in red, it is an indicator that you need to take smaller steps.\r\n\r\nExercises\r\n===========\r\n-----------\r\n\r\n- Move user.rb to its own class. Make sure all the specs pass.\r\n- Implement the feature where a user can be in many roles. Remember to write the test first.\r\n- Download the [BDD_Basics_I.mov screencast](https://s3.amazonaws.com/clickplan.com/download/BDD_Basics_I.mov.zip \"BDD Basics Part 1\") and watch the demo screencast. \r\n- Watch [BDD_Basics_II.mov] (https://s3.amazonaws.com/clickplan.com/download/BDD_Basics_II.mov.zip \'BDD Basics Part 2\') video.\r\n- Watch [BDD_Basics_III.mov] (https://s3.amazonaws.com/clickplan.com/download/BDD_Basics_III.mov.zip \'BDD Basics Part 3\') video.\r\n\r\nReference\r\n===========\r\n-----------\r\n\r\n1. The Test Automation Manifesto - A paper by Gerard Meszaros, Shaun Smith and Jennitta Andrea.','2014-07-26 19:31:41','2016-12-22 04:59:54'),(131,'TDD Basics : TDD Cycle : Red, Green, Refactor','Objectives\r\n==========\r\n----------\r\n\r\n- What is a Starter Test? When to use it?\r\n- Focus on getting it to work first, cleanup by refactoring and then focus on optimization.\r\n- When refactoring, start green and end in green.\r\n- Learn recursive solution and optimize the execution by using non-recursive solution.\r\n- Using existing tests as regression tests when making major changes to existing code.\r\n\r\n![alt text](https://images.rubyplus.com/ecg-pulse.jpg \"Cycle\")\r\n\r\nProblem Statement\r\n=================\r\n-------------\r\n\r\nGenerate Fibonacci sequence for a given number.\r\n\r\nProblem Domain Analysis\r\n=============\r\n-------------\r\n\r\nIn mathematics, the Fibonacci numbers are the numbers in the following integer sequence: 0, 1, 1, 2, 3, 5, 8, 13, 21, 34, 55, 89, 144, 233, 377, 610 ... By definition, the first two numbers in the Fibonacci sequence are 0 and 1 and each subsequent number is the sum of the previous two.\r\n\r\n![alt text](https://images.rubyplus.com/fibonacci.png \"Fibonacci Numbers\")\r\n\r\nAlgebraic Equation\r\n-------------\r\n\r\nIn mathematical terms, the sequence fibonacci(n) of Fibonacci numbers is defined by the recurrence relation :\r\n\r\n```sh\r\nfibonacci(n) = fibonacci(n-1) + fibonacci(n-2) \r\n```\r\n\r\nwith seed values\r\n\r\n```sh\r\nfibonacci(0) = 0\r\nfibonacci(1) = 1\r\n```\r\n\r\n![alt text](https://images.rubyplus.com/fibonacci-function.png \"Fibonacci Function\")\r\n\r\nVisual Representation\r\n-------------\r\n\r\n![alt text](https://math.temple.edu/~reich/Fib/pascal3.gif \"Fibonacci Numbers\")\r\n\r\nSample Input Output\r\n------------\r\n\r\nEach input output set is an example. Make each example executable.\r\n\r\n```sh\r\nInput  : 0, 1, 2, 3, 4, 5\r\nOutput : 0, 1, 1, 2, 3, 5 \r\n```\r\n\r\n![alt text](https://images.rubyplus.com/fibonacci-table.png \"Fibonacci Input Output Table\")\r\n\r\n\r\n![alt text](https://images.rubyplus.com/FibonacciTable.png \"Fibonacci Sample Data\")\r\n\r\nThe final solution should be able to take any random number and calculate the Fibonacci number without any modification to the production code.\r\n\r\nInitial Conditions\r\n----------------\r\n\r\nFirst two numbers are given (not calculated).\r\n\r\nSolution Domain Analysis\r\n=========\r\n-----------\r\n\r\n![alt text](https://images.rubyplus.com/sda-fib.png \"Solution Domain Analysis Fibonacci\")\r\n\r\nSteps\r\n==========\r\n----------\r\n\r\nStep 1 \r\n-------\r\n\r\nIn this step, we set up the environment.\r\n\r\n```ruby\r\nrequire \'test/unit\'\r\n\r\nclass FibonacciTest < Test::Unit::TestCase\r\n  def test_fibonacci_of_zeror_is_zeror\r\n    fail \'fail\'\r\n  end\r\nend\r\n```\r\n\r\nIn this step, we got the proper require statement to execute the test. The test also follows the proper naming convention for tests. This example illustrates how to go from Requirements to Examples to Executable Specs. Each test for this problem takes an argument, does some computation and returns a result. It illustrates Direct Input and Direct Output. This is called State Based Testing. In State Based Testing, there are no side effects. Side effect free functions are easy to test.\r\n\r\nSee the appendix of the [Essential TDD book](http://www.rubyplus.com/etdd.pdf \"Essential TDD\") for definition of Direct Input, Direct Output and Side Effects.\r\n\r\nStep 2\r\n-------\r\n\r\nIn this step, we will discover the public API. Here is the fibonacci_test.rb\r\n\r\n```ruby\r\nrequire \'test/unit\'\r\n\r\nclass Fibonacci\r\n  def self.of(number)\r\n    0\r\n  end\r\nend\r\n\r\nclass FibonacciTest < Test::Unit::TestCase\r\n  def test_fibonacci_of_zero_is_zero\r\n    fib_of_zero = Fibonacci.of(0)\r\n    assert_equal(fib_of_zero, 0)\r\n  end\r\nend\r\n```\r\n\r\nStarter Test\r\n-------------\r\n\r\n>> Start by testing a variant of an operation that doesn\'t do anything. If you write a realistic test first, then you will find yourself solving a bunch of problems at once. Realistic test will leave you too long without feedback. You want the red/green/refactor loop to take just minutes. You can shorten the loop by choosing inputs and outputs that are trivially easy to discover. Pick a Starter Test that will teach you something but that you are certain you can quickly get to work. \r\n>> ----- Kent Beck (Test-driven Development: By Example)\r\n\r\n==Starter Test== is helpful when you are implementing something unfamiliar or complicated. You don\'t need the Starter Test when you are confident, you can pick a test that will require a non-trivial operation.\r\n\r\nStep 3\r\n--------\r\n\r\nDon\'t change the test code and code under test at the same time.\r\n\r\n```ruby\r\nrequire \'test/unit\'\r\n\r\nclass Fibonacci\r\n  def self.of(number)\r\n    0\r\n  end\r\nend\r\n\r\nclass FibonacciTest < Test::Unit::TestCase\r\n  def test_fibonacci_of_zero_is_zero\r\n    fib_of_zero = Fibonacci.of(0)\r\n    assert_equal(0, fib_of_zero)\r\n  end\r\nend\r\n```\r\n\r\nIn this step, I found the right assertion to use. You can see the order of the parameters for assert_equal matters. I overcame the temptation to change the test code and code under test at the same time. Thereby test driving the development of the production code. I got the test to pass quickly by using a fake implementation. The fake implementation returns a constant.\r\n\r\nStep 4\r\n--------\r\n\r\nHere is the dirty implementation that makes fib(1) = 1 pass very quickly using a dirty implementation.\r\n\r\n```ruby\r\nrequire \'test/unit\'\r\n\r\nclass Fibonacci\r\n  def self.of(number)\r\n    number\r\n  end\r\nend\r\n\r\nclass FibonacciTest < Test::Unit::TestCase\r\n  def test_fibonacci_of_zero_is_zero\r\n    fib_of_zero = Fibonacci.of(0)\r\n    assert_equal(0, fib_of_zero)\r\n  end\r\n  \r\n  def test_fibonacci_of_one_is_one\r\n    fib_of_one = Fibonacci.of(1)\r\n    assert_equal(1, fib_of_one)\r\n  end\r\nend\r\n```\r\n\r\nStep 5\r\n---------\r\n\r\nIn this step, we force the implementation to change via tests. The broken test forced the implementation to change. Here is the dirty implementation that passes the test.\r\n\r\n```ruby\r\nrequire \'test/unit\'\r\n\r\nclass Fibonacci\r\n  def self.of(number)\r\n    if number == 2\r\n      return 1\r\n    else\r\n      return number\r\n    end\r\n  end\r\nend\r\n\r\nclass FibonacciTest < Test::Unit::TestCase\r\n  # First two specs are same as before\r\n  \r\n  def test_fibonacci_of_two_is_one\r\n    fib_of_two = Fibonacci.of(2)\r\n    assert_equal(1, fib_of_two)\r\n  end\r\nend\r\n```\r\n\r\nStep 6\r\n-------\r\n\r\nThis step is about refactoring in the green state. The new test broke the implementation. Commented out the new test to refactor the test in green state. \r\n\r\n```ruby\r\nrequire \'test/unit\'\r\n\r\nclass Fibonacci\r\n  def self.of(number)\r\n    if number == 0\r\n      return 0\r\n    elsif number <= 2\r\n      return 1\r\n    end\r\n  end\r\nend  \r\n\r\nclass FibonacciTest < Test::Unit::TestCase\r\n\r\n  def test_fibonacci_of_zero_is_zero\r\n    fib_of_zero = Fibonacci.of(0)\r\n    assert_equal(0, fib_of_zero)\r\n  end\r\n  \r\n  def test_fibonacci_of_one_is_one\r\n    fib_of_one = Fibonacci.of(1)\r\n    assert_equal(1, fib_of_one)\r\n  end\r\n  \r\n  def test_fibonacci_of_two_is_one\r\n    fib_of_two = Fibonacci.of(2)\r\n    assert_equal(1, fib_of_two)\r\n  end\r\n  \r\n  def xtest_fibonacci_of_three_is_two\r\n    fib_of_three = Fibonacci.of(3)\r\n    assert_equal(2, fib_of_three)\r\n  end\r\n  \r\nend\r\n```\r\n\r\nStep 7\r\n-------\r\n\r\nIn this step we are going to use fake implementation. \r\n\r\n```ruby\r\nrequire \'test/unit\'\r\n\r\nclass Fibonacci\r\n  def self.of(number)\r\n    if number == 0\r\n      return 0\r\n    elsif number <= 2\r\n      return 1\r\n    end\r\n    return 2\r\n  end\r\nend  \r\n\r\nclass FibonacciTest < Test::Unit::TestCase\r\n\r\n  def test_fibonacci_of_zero_is_zero\r\n    fib_of_zero = Fibonacci.of(0)\r\n    assert_equal(0, fib_of_zero)\r\n  end\r\n  \r\n  def test_fibonacci_of_one_is_one\r\n    fib_of_one = Fibonacci.of(1)\r\n    assert_equal(1, fib_of_one)\r\n  end\r\n  \r\n  def test_fibonacci_of_two_is_one\r\n    fib_of_two = Fibonacci.of(2)\r\n    assert_equal(1, fib_of_two)\r\n  end\r\n  \r\n  def test_fibonacci_of_three_is_two\r\n    fib_of_three = Fibonacci.of(3)\r\n    assert_equal(2, fib_of_three)\r\n  end\r\n  \r\nend\r\n```\r\n\r\nStep 8\r\n-------\r\n\r\nLet\'s now look at recursive solution. When you look at the input and output for the Fibonacci sequence:\r\n\r\n```sh\r\nInput  : 0 1 2 3\r\nOutput : 0 1 1 2\r\n```\r\n\r\nWe see that the pattern emerges and we see the result is the sum of previous two Fibonacci numbers. So\r\n\r\n```ruby\r\nreturn 2\r\n```\r\n\r\nis actually return 1 + 1 which from the above same data set is :\r\n\r\n```ruby\r\nfib(n-1) + fib(n-2)\r\n```\r\n\r\nThis is the generic solution to this problem.\r\n\r\n```ruby\r\nrequire \'test/unit\'\r\n\r\nclass Fibonacci\r\n  def self.of(number)\r\n    if number == 0\r\n      return 0\r\n    elsif number <=2\r\n      return 1\r\n    end\r\n    return of(number - 1) + of(number - 2)\r\n  end\r\nend\r\n\r\nclass FibonacciTest < Test::Unit::TestCase\r\n\r\n  def test_fibonacci_of_zero_is_zero\r\n    fib_of_zero = Fibonacci.of(0)\r\n    assert_equal(0, fib_of_zero)\r\n  end\r\n  \r\n  def test_fibonacci_of_one_is_one\r\n    fib_of_one = Fibonacci.of(1)\r\n    assert_equal(1, fib_of_one)\r\n  end\r\n  \r\n  def test_fibonacci_of_two_is_one\r\n    fib_of_two = Fibonacci.of(2)\r\n    assert_equal(1, fib_of_two)\r\n  end\r\n  \r\n  def test_fibonacci_of_three_is_two\r\n    fib_of_three = Fibonacci.of(3)\r\n    assert_equal(2, fib_of_three)\r\n  end\r\n  \r\nend\r\n```\r\n\r\nWe now have the generalized solution that uses recursion.\r\n\r\nStep 9\r\n-------\r\n\r\nLet\'s clean up the solution.\r\n\r\n```ruby\r\nrequire \'test/unit\'\r\n\r\nclass Fibonacci\r\n  def self.of(n)\r\n    return 0 if n == 0\r\n    return 1 if n == 1\r\n    return of(n-1) + of(n-2)\r\n  end\r\nend\r\n\r\n# Specs same as previous steps\r\n```\r\n\r\nBefore starting refactoring you must be in green state. After refactoring is done you should still be in green state. You can see that the variables are expressive of the domain.\r\n\r\nStep 10\r\n---------\r\n\r\nLet\'s now add a new test that is a large number to make sure our solution is good.\r\n\r\n```ruby\r\ndef test_fibonacci_of_ten_is_fifty_five\r\n  fib_of_ten = Fibonacci.of(10)\r\n  assert_equal(55, fib_of_ten)\r\nend\r\n```\r\n\r\nThis is a story test. It gives us the confidence that our solution is complete. So we don\'t have to write any more tests and we are done.\r\n\r\nStep 11\r\n----------\r\n\r\nLet\'s us now optimize the solution.\r\n\r\n```ruby\r\nrequire \'test/unit\'\r\n\r\nclass Fibonacci\r\n  def self.of(n)\r\n    current, successor = 0, 1\r\n    n.times do\r\n      current, successor = successor, current + successor\r\n    end\r\n    return current\r\n  end\r\nend\r\n\r\n# Tests are same as before.\r\n```\r\n\r\nThis version illustrates using existing tests as safety net when making major changes to the code. Notice that we only focus on one thing at a time. The focus can shift from one version to the other. \r\n\r\n![alt text](https://images.rubyplus.com/bigstock_Focus_6716743.jpg \"Focus\")\r\n\r\n[Code Mutation](http://www.rubyplus.com/articles/101 \'Code Mutation\') we discussed in a previous article is also part of the TDD Cycle. Regression is one of the goals of TDD and we have seen how to use existing test suite as a safety net for catching regression bugs.\r\n\r\nTDD Cycle\r\n-----------\r\n\r\n![alt text](https://images.rubyplus.com/funda-tdd-cycle.jpeg \"Fundamental TDD Cycle\")\r\n\r\nIn this example we saw how we go about repeating the TDD cycle many times to form a rhythm. We wrote a failing test, we quickly made it pass with a quick and dirty implementation and then we refactored to cleanup the code. The focus is on the design during the refactor step.\r\n\r\nExercises\r\n===========\r\n-----------\r\n\r\n1) Run the mini-test based Fibonacci and sure all tests pass. \r\n\r\n```ruby\r\n$ruby fibonacci_test.rb\r\n```\r\n\r\n2) Move the Fibonacci class into its own file and make all the tests pass.\r\n3) Get the output of the mini-test in color.\r\n4) Convert the given mini-test to rspec version fibonacci_spec.rb. You can refer the solution in the appendix of the [Essential TDD book](http://www.rubyplus.com/etdd.pdf \"Essential TDD\").','2014-07-26 23:57:03','2016-12-22 07:37:04'),(141,' TDD Beyond Basics : Fakes and Mocks','Objective\r\n=========\r\n\r\n- Learn to be minimal when implementing the production code.\r\n\r\nDiscussion\r\n=============\r\n-------------\r\n\r\n**Why do we need to be minimal when writing the production code?**\r\n\r\nBecause, the goal of TDD is to end up with a minimal system. Simplicity is the goal. \r\n\r\n**Why do we aim for a minimal system?**\r\n\r\nBecause it will be maintainable. In a maintainable system, tests will be easy to understand, modify and extend. Keeping your code ready for unexpected changes is about simple design.\r\n\r\nSteps\r\n==========\r\n----------\r\n\r\nStep 1\r\n-------\r\n\r\nIn this example, the requirement is that we should be able to assign a role to a given user. Create a user_spec.rb file with the following contents:\r\n\r\n```ruby\r\ndescribe User do\r\n\r\nend\r\n```\r\n\r\nStep 2\r\n-------\r\n\r\nRun the spec. We get the error:\r\n \r\n```ruby\r\nuninitialized constant User\r\n```\r\n\r\nStep 3\r\n--------\r\n\r\nAdd the User class definition to the top of the user_spec.rb as follows:\r\n\r\n```ruby\r\nclass User\r\n\r\nend\r\n\r\ndescribe User do\r\n\r\nend\r\n```\r\n\r\nStep 4\r\n--------\r\n\r\nRun the test again. We are green but there are no examples to run yet.\r\n\r\nStep 5\r\n---------\r\n\r\nAdd the first spec:\r\n\r\n```ruby\r\nclass User\r\n\r\nend\r\n\r\ndescribe User do\r\n  it \'should be in any role assigned to it\'\r\nend\r\n```\r\n\r\nStep 6\r\n-------\r\n\r\nRun the spec again. You see a pending spec in the output:\r\n\r\n```ruby\r\nPending:\r\n  User should be in any role assigned to it\r\n```\r\n\r\nStep 7\r\n-------\r\n\r\nChange the spec to the following:\r\n\r\n```ruby\r\nclass User\r\n\r\nend\r\n\r\ndescribe User do\r\n  it \'should be in any role assigned to it\' do\r\n    User.new\r\n    user.assign_role(\'some role\')\r\n    user.should be_in_role(\'some role\')\r\n  end\r\nend\r\n```\r\n\r\nStep 8\r\n-------\r\n\r\nRun the spec. We get the error:\r\n\r\n```ruby\r\nundefined method \'assign_role\' for User\r\n```\r\n\r\nStep 9\r\n-------\r\n\r\nDefine the assign_role method in User class like this:\r\n\r\n```ruby\r\nclass User\r\n  def assign_role\r\n\r\n  end\r\nend\r\n\r\ndescribe User do\r\n  it \'should be in any role assigned to it\' do\r\n    User.new\r\n    user.assign_role(\'some role\')\r\n    user.should be_in_role(\'some role\')\r\n  end\r\nend\r\n```\r\n\r\nStep 10\r\n---------\r\n\r\nRun the spec. We get the error:\r\n\r\n```ruby\r\nwrong number of arguments (1 for 0)\r\n```\r\n\r\nStep 11\r\n----------\r\n\r\nAdd the argument like this:\r\n\r\n```ruby\r\nclass User\r\n  def assign_role(role)\r\n\r\n  end\r\nend\r\n\r\ndescribe User do\r\n  it \'should be in any role assigned to it\' do\r\n    User.new\r\n    user.assign_role(\'some role\')\r\n    user.should be_in_role(\'some role\')\r\n  end\r\nend\r\n```\r\n\r\nStep 12\r\n-----------\r\n\r\nRun the spec. We get the error:\r\n\r\n```ruby\r\nundefined_method \'in_role?\' for User\r\n```\r\n\r\nStep 13\r\n---------\r\n\r\nAdd in_role? method to user.rb as follows:\r\n\r\n```ruby\r\nclass User\r\n  def assign_role(role)\r\n\r\n  end\r\n  \r\n  def in_role?\r\n\r\n  end\r\nend\r\n\r\ndescribe User do\r\n  it \'should be in any role assigned to it\' do\r\n    User.new\r\n    user.assign_role(\'some role\')\r\n    user.should be_in_role(\'some role\')\r\n  end\r\nend\r\n```\r\n\r\nStep 14\r\n----------\r\n\r\nRun the spec. We get the error:\r\n\r\n```ruby\r\nwrong number of arguments (1 for 0)\r\n```\r\n\r\nStep 15\r\n-------\r\n\r\nAdd an argument to in_role? method:\r\n\r\n```ruby\r\nclass User\r\n  def assign_role(role)\r\n\r\n  end\r\n  \r\n  def in_role?(role)\r\n\r\n  end\r\nend\r\n\r\ndescribe User do\r\n  it \'should be in any role assigned to it\' do\r\n    User.new\r\n    user.assign_role(\'some role\')\r\n    user.should be_in_role(\'some role\')\r\n  end\r\nend\r\n```\r\n\r\nStep 16\r\n---------\r\n\r\nRun the spec. We get the error:\r\n\r\n```ruby\r\nexpected in_role?(\'some role\') to return true, got nil\r\n```\r\n\r\nWe are now failing for the right reason. Notice that each small step we took was guided by the failure messages given by running the test. We only did just enough to get past the current error message. We were minimal in writing the production code.\r\n\r\nStep 17\r\n----------\r\n\r\nChange the in_role? implementation like this:\r\n\r\n```ruby\r\nclass User\r\n  def assign_role(role)\r\n\r\n  end\r\n  \r\n  def in_role?(role)\r\n    true\r\n  end\r\nend\r\n\r\ndescribe User do\r\n  it \'should be in any role assigned to it\' do\r\n    User.new\r\n    user.assign_role(\'some role\')\r\n    user.should be_in_role(\'some role\')\r\n  end\r\nend\r\n```\r\n\r\nStep 18\r\n---------\r\n\r\nRun the spec. The example will now pass. We know that this implementation is bogus.\r\n\r\nStep 19\r\n---------\r\n\r\nWe want the specs to force us to write the logic that can handle assigning roles.\r\n\r\n```ruby\r\nclass User\r\n  def assign_role(role)\r\n\r\n  end\r\n  \r\n  def in_role?(role)\r\n    true\r\n  end\r\nend\r\n\r\ndescribe User do\r\n  it \'should be in any role assigned to it\' do\r\n    User.new\r\n    user.assign_role(\'some role\')\r\n    user.should be_in_role(\'some role\')\r\n  end\r\n  \r\n  it \'should not be in a role that is not assigned to it\' do\r\n    user = User.new\r\n  \r\n    user.should_not be_in_role(\'admin\')\r\n  end\r\nend\r\n```\r\n\r\nStep 20\r\n--------\r\n\r\nRun the spec. We get the error:\r\n\r\n```ruby\r\nexpected in_role?(\'admin\') to return false, got true\r\n```\r\n\r\nStep 21\r\n---------\r\n\r\nChange the user.rb as follows:\r\n\r\n```ruby\r\nclass User\r\n  def assign_role(role)\r\n    @role = role  \r\n  end\r\n  \r\n  def in_role?(role)\r\n    @role == role  \r\n  end\r\nend\r\n\r\ndescribe User do\r\n  # code remains same as before\r\nend\r\n```\r\n\r\nStep 22\r\n---------\r\n\r\nRun the specs. The specs will pass. \r\n\r\nQ&A\r\n=============\r\n-------------\r\n\r\n**How do we achieve simplicity?**\r\n\r\nIt\'s about saying no to future requirements and extra flexibility. \r\n\r\n**How do you recognize simple design?** \r\n\r\nKnowledge. Knowledge is insight in problem domain. It develops over time.\r\n\r\n**How can you achieve simple design?**\r\n\r\nGain knowledge. Refactor to reflect new understanding. Code bare minimum. Keep things as simple as possible for as long as possible.\r\n\r\n**Do we always have to take such small steps?**\r\n\r\nNo. If you are confident that you can get to green quickly you can take bigger steps. If you are taking bigger steps and you end up in red, it is an indicator that you need to take smaller steps.\r\n\r\nExercises\r\n===========\r\n-----------\r\n\r\n- Move user.rb to its own class. Make sure all the specs pass.\r\n- Implement the feature where a user can be in many roles. Remember to write the test first.\r\n- Download the [BDD_Basics_I.mov screencast](https://s3.amazonaws.com/clickplan.com/download/BDD_Basics_I.mov.zip \"BDD Basics Part 1\") and watch the demo screencast. \r\n- Watch [BDD_Basics_II.mov] (https://s3.amazonaws.com/clickplan.com/download/BDD_Basics_II.mov.zip \'BDD Basics Part 2\') video.\r\n- Watch [BDD_Basics_III.mov] (https://s3.amazonaws.com/clickplan.com/download/BDD_Basics_III.mov.zip \'BDD Basics Part 3\') video.\r\n\r\nReference\r\n===========\r\n-----------\r\n\r\n1. The Test Automation Manifesto - A paper by Gerard Meszaros, Shaun Smith and Jennitta Andrea.','2014-07-27 17:31:48','2014-08-24 17:23:31'),(151,'TDD Beyond Basics : Open Closed Principle','Objective\r\n=========\r\n\r\n- Learn how to apply Open Closed Principle\r\n\r\nDiscussion\r\n===================\r\n-------------------\r\n\r\nThis lesson builds on top of the previous lesson on [Fakes and Mocks](http://www.rubyplus.com/articles/141 \"Fakes and Mocks\"). What does test driven development have to do with design principles? Test driven development is not just about reducing the duplication in code. It involves driving the design of the production code through tests. \r\n\r\nSteps\r\n=============\r\n-------------\r\n\r\nStep 1\r\n------------\r\n\r\nMove fake_display.rb and scanner_spec.rb into spec directory. Move real_display.rb and scanner.rb into lib directory. Change the scanner_spec.rb require_relative statement like this:\r\n\r\n```ruby\r\nrequire_relative \'../lib/scanner\'\r\n\r\n```\r\n\r\nStep 2\r\n----------\r\n\r\nRun the specs. It will pass.\r\n\r\nStep 3\r\n------------\r\n\r\nWe now have a new requirement where we need to use a touch screen display. Let\'s write the spec for this new requirement. Add the following spec to scanner_spec.rb.\r\n\r\n```ruby\r\nit \'scans and displays the details on touch display\' do\r\n  touch_display = TouchDisplay.new\r\n  scanner = Scanner.new(touch_display)\r\n\r\n  scanner.scan(\'1\')\r\n  \r\n  expect(touch_display.last_line_item).to eq(\'Milk $3.99\')\r\nend\r\n```\r\n\r\nStep 4\r\n------------\r\n\r\nAdd the\r\n\r\n```ruby\r\nrequire_relative \'../lib/touch_display\'\r\n```\r\n\r\nto the top of the scanner_spec.rb\r\n\r\nStep 5\r\n------------\r\n\r\nCreate a touch_display.rb in lib directory with the following contents:\r\n\r\n```ruby\r\nclass TouchDisplay\r\n  attr_reader :last_line_item\r\n  \r\n  def display(line_item)\r\n    @last_line_item = line_item\r\n    p \'Logic to display the line_item to touch display\'\r\n  end\r\nend\r\n```\r\n\r\nStep 6\r\n-------\r\n\r\nRun all the specs. All specs will pass.\r\n\r\nDiscussion\r\n==============\r\n---------------\r\n\r\nTo satisfy our new requirement we added new code, we did not modify the existing production code. Open Closed Principle states that a module should be open for extension and closed for modification. Our scanner class satisfies this principle. \r\n\r\nWe were able to achieve this by using dependency injection to decouple the display from the scanner. As long as any new concrete implementation of the display implements our `display(line_item)` interface with an accessor for last_line_item, we can extend our program without violating Open Closed Principle. If you notice the scanner class, it has the` attr_reader` only to allow the test to be written, so why do we need code that is only required by the test? Does the code that is only required by the test violate encapsulation? What do you think?\r\n\r\nSummary\r\n===========\r\n-----------\r\n\r\nIn this lesson you learned how to apply Open Closed Principle to design a system that is [flexible](http://www.rubyplus.com/articles/661 \'Flexible Design\') to new requirements. We used constructor dependency injection to achieve decoupling of the scanner from the display. So interchanging new displays that conform to our interface works without any modification to the original code. ','2014-07-27 19:17:27','2016-03-21 23:24:40'),(161,'TDD Beyond Basics : Contract Tests','Objectives\r\n==========\r\n-------------\r\n\r\n- Learn how to write Contract tests\r\n- Learn about reliable test. \r\n\r\nDiscussion\r\n=============\r\n-------------\r\n\r\nIn this lesson you will be introduced to Contract tests. You will learn how to use Contract tests to explicitly document the behavior of an API for invalid inputs. You will also learn about reliable test, a test that fails when it should.\r\n\r\nWho should be responsible for handling invalid inputs? Client or the supplier? If we make both client and the supplier code both check for invalid inputs, it is called Defensive Programming.\r\n\r\n**Why Defensive Programming is not a good idea?**\r\n\r\nDefensive programming is not a good idea because it results in complexity. The client and the supplier code will be doing the same work and there would be no agreement on who is responsible for the proper handling of the errors. The lack of clear responsibility also means we cannot say whether the bug is in the client or the supplier.\r\n\r\nSteps\r\n=============\r\n-------------\r\n\r\nStep 1\r\n------------\r\n\r\nCreate week_spec.rb with the following contents:\r\n\r\n```ruby\r\ndescribe Week do\r\n  it \'returns monday as the first day of the week\' do\r\n    day = Week.day(\'1\')\r\n    \r\n    day.should == :monday\r\n  end\r\n  \r\n  it \'returns false for out of range numbers\' do\r\n    day = Week.day(\'8\')\r\n    \r\n    day.should be_false\r\n  end\r\nend\r\n```\r\n\r\nStep 2\r\n----------\r\n\r\nCreate week.rb with the following contents:\r\n\r\n```ruby\r\nclass Week\r\n  DAYS = { \"1\" => :monday, \r\n           \"2\" => :tuesday, \r\n           \"3\" => :wednesday, \r\n           \"4\" => :thursday, \r\n           \"5\" => :friday, \r\n           \"6\" => :saturday, \r\n           \"7\" => :sunday}\r\n  def self.day(n)\r\n    if n.to_i < 8\r\n      DAYS[n]    \r\n    else\r\n     nil\r\n    end\r\n  end\r\nend\r\n```\r\n\r\nStep 3\r\n------------\r\n\r\nRun the specs. \r\n\r\n```sh\r\n$rspec week_spec.rb \r\n```\r\n\r\n```ruby\r\nWeek\r\n  returns monday as the first day of the week\r\n  returns false for out of range numbers\r\nFinished in 0.06081 seconds \r\n2 examples, 0 failures\r\n```\r\n\r\nStep 4\r\n------------\r\n\r\nChange the implementation of the day method like this:\r\n\r\n```ruby\r\ndef self.day(n)\r\n  DAYS[n]\r\nend\r\n```\r\n\r\nStep 4\r\n------------\r\n\r\nRun the specs. It will still pass. Because, in Ruby, accessing a hash that does not have the given key will return nil, which evaluates to fase. Here the implementation is explicit in order to illustrate a problem.\r\n\r\nStep 5\r\n------------\r\n\r\nChange the day method implementation in week_spec.rb like this:\r\n\r\n```ruby\r\ndef self.day(n)\r\n  if n.to_i < 8\r\n    DAYS[n]\r\n  else\r\n    \'\'\r\n  end\r\nend\r\n```\r\n\r\nStep 6\r\n-------\r\n\r\nRun the specs again.\r\n\r\n```sh\r\nFailures:\r\n1) Week returns false for numbers that does not correspond to a week day \r\n   Failure/Error: day.should be_false\r\n    expected: false value\r\n      got: \"\"\r\n     ./week_spec.rb:27:in ‘block (2 levels) in <top (required)>’\r\nFinished in 0.00488 seconds\r\n2 examples, 1 failure\r\nFailed examples:\r\nrspec ./week_spec.rb:24\r\nWeek returns false for out of range numbers\r\n\r\n```\r\n\r\nTest fails.\r\n\r\nDiscussion\r\n==============\r\n--------------\r\n\r\nTest breaks when the production code changes the return value from nil to blank string. Test fails when it should. This is good. If the clients use a conditional statement to check the true/false value, they will be protected by this failing test, since the defect is localized. Violating the contract between the client and library results in a failing test. We have to fix this problem so that the existing clients using our library does not break.\r\n\r\nStep 7\r\n---------\r\n\r\nLet\'s revert back the implementation to working version. Since clients are dependent on the returned false value of nil.\r\n\r\n```ruby\r\nclass Week\r\n  DAYS = { \"1\" => :monday, \r\n           \"2\" => :tuesday, \r\n           \"3\" => :wednesday, \r\n           \"4\" => :thursday, \r\n           \"5\" => :friday, \r\n           \"6\" => :saturday, \r\n           \"7\" => :sunday}\r\n  def self.day(n)\r\n    if n.to_i < 8\r\n      DAYS[n]    \r\n    else\r\n     nil\r\n    end\r\n  end\r\nend\r\n```\r\n\r\nThe specs remain the same. Here is the code:\r\n\r\n```ruby\r\ndescribe Week do\r\n  it \'returns monday as the first day of the week\' do\r\n    day = Week.day(\'1\')\r\n    \r\n    day.should == :monday\r\n  end\r\n  \r\n  it \'returns false for out of range numbers\' do\r\n    day = Week.day(\'8\')\r\n    \r\n    day.should be_false\r\n  end\r\nend\r\n```\r\n\r\nIf you are versioning your API, then you could make changes that can break your clients. In this case, you would deprecate your old API and give sufficient time for the clients to migrate to your newer version.\r\n\r\nStep 8\r\n-----------\r\n\r\nLet\'s add contract tests that explicitly documents the behavior of the API for invalid inputs. Hash#fetch method throws exception for cases that was implicit in the code.\r\n\r\nHere is the code for week.rb:\r\n\r\n```ruby\r\nclass Week\r\n  DAYS = { \"1\" => :monday, \r\n           \"2\" => :tuesday, \r\n           \"3\" => :wednesday, \r\n           \"4\" => :thursday, \r\n           \"5\" => :friday, \r\n           \"6\" => :saturday, \r\n           \"7\" => :sunday}\r\n  def self.day(n)\r\n    if n.to_i < 8\r\n      DAYS[n]    \r\n    else\r\n     nil\r\n    end\r\n  end\r\n\r\n  def self.end(n)\r\n    if n.to_i < 5\r\n      raise \"The given number is not a weekend\"\r\n    else\r\n      DAYS.fetch(n)\r\n    end\r\n  end\r\nend\r\n```\r\n\r\nHere is the specs:\r\n\r\n```ruby\r\ndescribe Week do\r\n  # existing contract test for week day\r\n  it \'returns false for out of range numbers\' do\r\n    day = Week.day(\'8\')\r\n    \r\n    day.should be_false\r\n  end\r\n\r\n  # new contract test\r\n  it \'throws exception for numbers that is not weekend\' do\r\n    expect do\r\n      week_end = Week.end(\'4\')\r\n    end.to raise_error\r\n  end\r\n  \r\n  it \'throws exception for numbers that is out of range\' do\r\n    expect do\r\n      week_end = Week.end(\'40\')\r\n    end.to raise_error\r\n  end\r\nend\r\n```\r\n\r\nStep 9\r\n----------\r\n\r\nRun all specs.\r\n\r\n```sh\r\n$rspec week_spec.rb\r\n```\r\n\r\n```ruby\r\nWeek\r\n  returns monday as the first day of the week\r\n  returns false for out of range numbers\r\n  throws exception for numbers that is not weekend\r\n  throws exception for numbers that is out of range\r\nFinished in 0.00743 seconds 4 examples, 0 failures  \r\n```\r\n\r\nDiscussion\r\n===========\r\n-----------\r\n\r\nApply Bertrand Meyer\'s guideline when deciding about exceptions: When a contract is broken by either client or supplier, throw an exception. This helps us to determine whether the bug is in the client or the supplier code. In our case, the contract is that as long as the client provides the proper input, the supplier will return the corresponding symbol for the week.\r\n\r\n>> A program must be able to deal with exceptions. A good design rule is to list explicitly the situations\r\n>> that may cause a program to break down.\r\n>>   ---- Jorgen Knudsen from Object Design : Roles, Responsibilities and Collaborations\r\n\r\nExplicitly document the behavior of your API by writing contract specs. This will help other developers understand and use your library as intended. \r\n\r\nSummary\r\n===========\r\n-----------\r\n\r\nIn this lesson you learned about contract tests and why it is important to include them in your specs. You also learned about Bertrand Meyer\'s guideline about throwing exceptions.','2014-07-27 23:09:23','2014-08-13 17:04:09'),(171,'TDD Beyond Basics : Testing Random Behavior - Guessing Game Kata Part 1','Objectives\r\n==========\r\n\r\n- Learn how to test random behavior\r\n- Learn how to identify and fix over specifying behavior in your tests\r\n\r\nDifficulty Level\r\n================\r\n----------------\r\n\r\nMedium\r\n\r\nProblem Statement\r\n===================\r\n-------------------\r\n\r\nWrite a program that generates a random number between 0 and 100 (inclusive). The user must guess this number. Each correct guess (it if was a number) will receive the message \'Guess Higher!\' or \'Guess Lower!\'. \r\n\r\n- The prompt should display: \'Welcome to the Guessing Game\'\r\n- When the program is run, it should generate a random number between 0 and 100 inclusive.\r\n- You will display a command line prompt for the user to enter their guess number. \r\n- Quitting is not an option. The user can only end the game by guessing the target number. Be sure that your prompt explains them what they are to do.\r\n- Once you have received a value from the user, you should perform validation. If the user has given you an invalid value (anything other than a number between 1 and 100), display an appropriate error message. If the user has given you a valid value, display a message either telling them that there were correct or should guess higher or lower as described above. \r\n- This process should continue until they guess the correct number.\r\n\r\nSteps\r\n=============\r\n-------------\r\n\r\nStep 1\r\n------------\r\n\r\nCreate guess_game_spec.rb with the following contents:\r\n\r\n```ruby\r\nrequire_relative \'guess_game\'\r\n\r\ndescribe GuessGame do\r\n  it \'generates random number between 1 and 100 inclusive\' do\r\n    game = GuessGame.new\r\n    result = game.random\r\n    \r\n    expect(result).to eq(50)\r\n  end\r\nend\r\n```\r\n\r\nStep 2\r\n----------\r\n\r\nCreate guess_game.rb with the following contents:\r\n\r\n```ruby\r\nclass GuessGame\r\n  def random\r\n    50\r\n  end\r\nend\r\n```\r\n\r\nThis is the minimal implementation that passes the test, but it does not prove that the numbers generated are random.\r\n\r\n\r\nStep 3\r\n------\r\n\r\nHere is a test that is based on the \'The TDD Express : From Fast to Fastest\' presentation by Bill DePhillips of Thoughtworks.\r\n\r\n```ruby\r\nrequire_relative \'guess_game\'\r\n\r\ndescribe GuessGame do\r\n  it \'generates random number between 1 and 100 inclusive\' do\r\n    game = GuessGame.new\r\n    result = game.random\r\n   \r\n    expect(result).to be_a Fixnum  \r\n  end\r\nend\r\n```\r\n\r\nRun the test, it should pass.\r\n\r\nStep 4\r\n--------\r\n\r\nThere is a relationship between the **doc string** and the test. In this case, we can change the **doc string** to reflect what we are testing like this:\r\n\r\n```ruby\r\nrequire_relative \'guess_game\'\r\n\r\ndescribe GuessGame do\r\n  it \'returns a number\' do\r\n    game = GuessGame.new\r\n    result = game.random\r\n   \r\n    expect(result).to be_a Fixnum  \r\n  end\r\nend\r\n```\r\n\r\nI am still unease when I look at the assertion. It seems to be coupled to the datatype. It is subtle to recognize the fact that this is an example of over specification. An easy way to find out if your test is over specifying or not is to ask the question: Does this test focus on behavior? The answer is clearly, no. So, this test must be deleted.\r\n\r\nStep 5\r\n------------\r\n\r\nLet\'s see how we can test for randomness. Here is another test that is based on \'The TDD Express : From Fast to Fastest\' presentation by Bill DePhillips of Thoughtworks.\r\n\r\n```ruby\r\ndescribe GuessGame do \r\n it \'is random over many runs\' do\r\n   lots_of_rolls = 100.times.map { GuessGame.new.random }\r\n   expect(lots_of_rolls.uniq.sort).to eq((1..100).to_a)\r\n end\r\nend\r\n```\r\n\r\nCreate guess_game.rb with the following contents:\r\n\r\n```ruby\r\nclass GuessGame\r\n  def random\r\n    Random.new.rand(1..100)\r\n  end\r\nend\r\n```\r\n\r\nThe tests will pass. But, this is another example for over specifying in the test. Since he uses only [1,2,3,4,5,6] for rolling a dice and generates 100 random numbers. It probably passes when it checks that the dice rolls numbers 1 to 6. \r\n\r\nComplexity increases with the problem size. This is also likely fail intermittently, since I am generating random numbers 100 times. My example probably needs 1000 or more random number generation to check for numbers between 1 and 100. This accidental complexity also decreases the performance of the test suite. \r\n\r\n- Why generate 100 random numbers? \r\n- What is the minimum number of random numbers you need to write the test? \r\n- How can we specify that the generated random number is within the expected range of numbers?\r\n- What if we can eliminate the loop altogether so that we don\'t generate 100 random numbers for each test run?\r\n\r\nWe always strive for the minimal data set we need for a particular scenario when writing a test. We want the test to be as simple as possible. This makes the tests easy to maintain.  We will come up with a better solution in the next step.\r\n\r\nStep 6\r\n------------\r\n\r\nCan we use a stub? No, you cannot use stub to resolve the random failures because you will stub yourself out. So, what statement can you make about this code that is true? Can we loosen our assertion and still satisfy the requirement? The guess_game_spec below deals with the problem of randomness.\r\n\r\n```ruby\r\nrequire_relative \'guess_game\'\r\n\r\ndescribe GuessGame do\r\n  it \'generates random number between 1 and 100 inclusive\' do\r\n    game = GuessGame.new\r\n    result = game.random\r\n\r\n    expect(1..100).to cover(result)\r\n  end\r\nend\r\n```\r\n\r\nThis spec checks only the range of the generated random number is within the expected range of 1 to 100. This test now passes. This test shows you that you don\'t have to over specify in your tests.\r\n\r\nSummary\r\n===========\r\n-----------\r\n\r\nIn this lesson you learned about testing randomness and how to identify and fix over specifying behavior. In the subsequent lessons we will gradually build the guessing game and learn other design principles and testing techniques.','2014-07-27 23:11:25','2014-08-17 09:02:59'),(181,'TDD Beyond Basics : Guessing Game Kata Part 2','Objective\r\n==========\r\n----------\r\n\r\n- To apply [Single Purpose Principle](https://rubyplus.com/articles/2641 \'Single Purpose Principle\') to Guessing Game Kata\r\n\r\nProblem Statement\r\n===================\r\n-------------------\r\n\r\nRefer the guessing game problem description described in the previous article : [TDD Beyond Basics : Testing Random Behavior](https://www.rubyplus.com/articles/171 \"TDD Beyond Basics : Testing Random Behavior\")\r\n\r\nSteps\r\n========\r\n--------\r\n\r\nStep 1\r\n------------\r\n\r\nLet\'s now write the second example. Here is the guess_game_spec.rb:\r\n\r\n```ruby\r\nrequire_relative \'guess_game\'\r\n\r\ndescribe GuessGame do\r\n  # other specs remain the same as before\r\n  it \'display greeting when the game begins\' do\r\n    fake_console = mock(\'Console\')\r\n    fake_console.should_receive(:output).with(\'Welcome to the Guessing Game\')\r\n    \r\n    game = GuessGame.new(fake_console)\r\n\r\n    game.start\r\n  end\r\nend\r\n```\r\n\r\nStep 2\r\n----------\r\n\r\nRun the spec, you will see : undefined method \'start\' error message.\r\n\r\nStep 3\r\n------------\r\n\r\nLet\'s write the minimal code required to get past the error message.\r\n\r\n```ruby\r\nclass GuessGame\r\n  # other code same as before\r\n  def start\r\n\r\n  end\r\nend\r\n```\r\n\r\nStep 4\r\n---------\r\nWe have defined an empty start method. Run the specs again, you will see. \r\n\r\n```ruby\r\n1) GuessGame should display greeting when the game begins\r\nFailure/Error: \r\nfake_console.should_receive(:output).with(\"Welcome to the Guessing Game\")\r\n  (Mock \"Console\").output(\"Welcome to the Guessing Game\")\r\n  expected: 1 time\r\n  received: 0 times\r\n```\r\n\r\nThis test is failing because the console object never received the output(string) method call.\r\n\r\nStep 5\r\n------------\r\n\r\nChange the GuessGame class as follows:\r\n\r\n```ruby\r\nclass GuessGame\r\n  def initialize(console)\r\n    @console = console\r\n  end\r\n  \r\n  def random\r\n    Random.new.rand(1..100)\r\n  end\r\n  \r\n  def start\r\n    @console.output(\'Welcome to the Guessing Game\')\r\n  end\r\nend\r\n```\r\n\r\nGuessGame class now has a constructor that takes a console object. It then delegates welcoming the user to the console object in the start method. This is an example of dependency injection. Any collaborator that conforms to the interface we have discovered can be used to construct a GuessGame object.\r\n\r\nStep 6\r\n----------\r\n\r\nRun the specs again, you will see the following failure message:\r\n\r\n```ruby\r\n1) GuessGame should generate random number between 1 and 100 inclusive \r\n    Failure/Error: game = GuessGame.new\r\n    ArgumentError:\r\n      wrong number of arguments (0 for 1)\r\n```\r\n\r\nThis implementation broke our previous test which is not passing in the console object to the constructor. We can fix it by initializing the default value to standard output.\r\n\r\nStep 7\r\n-----------\r\n\r\nChange the guess_game.rb constructor as follows:\r\n\r\n```ruby\r\nclass GuessGame\r\n  def initialize(console=STDOUT)\r\n    @console = console\r\n  end\r\nend\r\n```\r\n\r\nStep 8\r\n----------\r\n\r\nRun the specs now. It will pass. We are back to green. This spec shows how you can defer decisions about how to interact with the user. It could be standard output, GUI, client server app etc. Fake object is injected into the game object. \r\n\r\nHere is the complete listing for this lesson:\r\n\r\n```ruby\r\nrequire_relative \'guess_game\'\r\n\r\ndescribe GuessGame do\r\n  it \'generates random number between 1 and 100 inclusive\' do\r\n    game = GuessGame.new\r\n    result = game.random\r\n\r\n    expected = 1..100\r\n    expected.should cover(result)\r\n  end\r\n\r\n  it \'displays greeting when the game begins\' do\r\n    fake_console = double(\'Console\')\r\n    fake_console.should_receive(:output).with(\'Welcome to the Guessing Game\')\r\n    game = GuessGame.new(fake_console)\r\n    game.start\r\n  end\r\nend\r\n```\r\n\r\n```ruby\r\nclass GuessGame\r\n  def initialize(console=STDOUT)\r\n    @console = console\r\n  end\r\n\r\n  def random\r\n    Random.new.rand(1..100)\r\n  end\r\n\r\n  def start\r\n    @console.output(\'Welcome to the Guessing Game\')\r\n  end\r\nend\r\n```\r\n\r\nDiscussion\r\n============\r\n--------------\r\n\r\nThe public interface output(string) of the Console object is discovered during the mocking step. It hides the details about the type of interface that must be implemented to communicate with an user. Game delegates any user interfacing code to a collaborating console object therefore it obeys Single Purpose Principle. Console object also obeys the Single Purpose Principle by focusing only on one concrete implementation of dealing with user interaction.\r\n\r\nWe could have implemented this similar to the code breaker game in The RSpec book by calling the puts method on output variable. \r\n\r\n```ruby\r\nmodule Codebreaker\r\n  class Game\r\n    def initialize(output)\r\n      @output = output\r\n    end\r\n    def start\r\n      @output.puts(\"Welcome to Codebreaker!\")\r\n    end\r\n  end\r\nend\r\n\r\nmodule Codebreaker\r\n  describe Game do\r\n    describe \"#start\" do\r\n      it \"sends a welcome message\" do\r\n        output = double(\'output\')\r\n        game = Game.new(output)\r\n        output.should_receive(:puts).with(\'Welcome to Codebreaker!\')\r\n        game.start\r\n      end\r\n      it \"prompts for the first guess\"\r\n    end\r\n  end\r\nend\r\n```\r\n\r\nBy doing so we tie our game object to the implementation details. This results in tightly coupled objects which is not desirable. Whenever we change the way we interface with the external world, the code will break. We desire loosely coupled objects with high cohesion.\r\n\r\nYou might encounter a problem where random number generation spec fails when user interfacing feature is modified. Random number generation and user interfacing logic are not related in any way. Ideally they should be split into separate classes that has only one purpose. We will revisit this topic later.\r\n  \r\nSummary\r\n===========\r\n-----------\r\n\r\nIn this lesson you learned how to apply Single Purpose principle and how to design collaborators that are highly cohesive. We also saw some bad code examples in RSpec book that ties implementation level details with game logic. In the next lesson we will continue building the guessing game.\r\n\r\nReference\r\n=========\r\n---------\r\n\r\n[Everything that is wrong with mocking, bdd, and rspec](http://ngauthier.com/2010/12/everything-that-is-wrong-with-mocking.html \"Everything that is wrong with mocking, bdd, and rspec\")\r\n[Single Purpose Principle](https://rubyplus.com/articles/2641 \'Single Purpose Principle\')\r\n','2014-07-27 23:50:17','2015-10-06 06:16:02'),(191,'TDD Beyond Basics : Dependency Inversion Principle - Guessing Game Kata Part 3','Objective\r\n=========\r\n----------\r\n\r\n- Learn about Dependency Inversion Principle\r\n\r\nDiscussion\r\n==========\r\n----------\r\n\r\nRefer the guessing game problem description described in the first part of this series on guessing game  : [TDD Beyond Basics : Testing Random Behavior](http://www.rubyplus.com/articles/171 \"TDD Beyond Basics : Testing Random Behavior\"). \r\n\r\nIn the previous article you learned the [Single Purpose Principle](http://www.rubyplus.com/articles/181 \"Single Purpose Principle\"). The spec used a mock that complies with Gerard Meszaros standard discussed in his book xUnit Test Patterns: Refactoring Test Code. We followed that standard. We used double and set expectation, so it is a mock. If we don\'t set the expectation on the double, it can be used as a stub. In this article we will continue working on the guessing game.\r\n\r\nSteps\r\n=========\r\n---------\r\n\r\nStep 1\r\n-------\r\n\r\nLet\'s take our code for a test drive. From the directory where the guess_game.rb resides, run the following code in irb:\r\n\r\n```ruby\r\nload \'./guess_game.rb\'\r\n\r\ngame = GuessGame.new\r\ngame.start\r\n```\r\n\r\nThis gives us the error:\r\n\r\n```sh\r\nNoMethodError: undefined method \'output\' for\r\n```\r\n\r\nStep 2\r\n----------\r\n\r\nRun the following code in irb:\r\n\r\n```ruby\r\nSTDOUT.puts \'hi\'\r\n```\r\n\r\nIt will print \'hi\' on the standard output. \r\n\r\nStep 3\r\n--------------\r\n\r\nBut it does not recognize output(string) method. To fix this problem, let\'s wrap the output method in a StandardOutput class. Create standard_output.rb with the following contents:\r\n\r\n```ruby\r\nclass StandardOutput\r\n  def output(message)\r\n    puts message\r\n  end\r\nend\r\n```\r\n\r\nStep 4\r\n----------------\r\n\r\nChange the constructor of the GuessGame like this:\r\n\r\n```ruby\r\nclass GuessGame\r\n  def initialize(console=StandardOutput.new)\r\n    @console = console\r\n  end\r\nend\r\n```\r\n\r\nStep 5\r\n--------------\r\n\r\nThe StandardOutput class in not a built-in Ruby class. It\'s our custom class.\r\n\r\n```ruby\r\nirb > Kernel\r\n  => Kernel\r\nirb > StandardOutput\r\n  NameError: uninitialized constant Object::StandardOutput\r\n    from (irb):2\r\n```\r\n\r\nYou can quickly double check this by searching the [Ruby documentation]:http://www.ruby-doc.org/stdlib-2.1.2/ . We do this check to avoid inadvertently reopening an existing class in Ruby.\r\n\r\nStep 6\r\n--------------\r\n\r\nThe current version of specs look like this:\r\n\r\n```ruby\r\nrequire_relative \'guess_game\'\r\n\r\ndescribe GuessGame do\r\n  it \'generates random number between 1 and 100 inclusive\' do\r\n    game = GuessGame.new\r\n    result = game.random\r\n\r\n    expected = 1..100\r\n    expected.should cover(result)\r\n  end\r\n\r\n  it \'displays greeting when the game begins\' do\r\n    fake_console = double(\'Console\')\r\n    fake_console.should_receive(:output).with(\'Welcome to the Guessing Game\')\r\n    game = GuessGame.new(fake_console)\r\n    game.start\r\n  end\r\nend\r\n```\r\n\r\nThis is version that we ended up in the previous article. We have not made any changes to it yet. Run the specs, the tests still pass. \r\n\r\nDiscussion\r\n===========\r\n-------------\r\n\r\nThis fix shows how to invert dependencies on concrete classes to abstract interface. In this case the abstract interface is \'output\' and not specific method like \'puts\' or GUI related method that ties the game logic to a concrete implementation of user interaction.\r\n\r\nStep 7\r\n--------------\r\n\r\nChange the guess_game.rb constructor default value as follows:\r\n\r\n```ruby\r\n  def initialize(console=StandardOutput.new)\r\n    @console = console\r\n  end\r\n```\r\n\r\nThe complete guess_game.rb now looks like this:\r\n\r\n```ruby\r\nclass GuessGame\r\n  def initialize(console=StandardOutput.new)\r\n    @console = console\r\n  end\r\n\r\n  def random\r\n    Random.new.rand(1..100)\r\n  end\r\n\r\n  def start\r\n    @console.output(\'Welcome to the Guessing Game\')\r\n  end\r\nend\r\n```\r\n\r\nIn this version we fixed the bug due to wrong default value in the constructor.\r\n\r\nSummary\r\n=========\r\n-----------\r\n\r\nIn this article we saw Dependency Inversion Principle. We learned how to invert dependencies so that we depend on abstractions instead of concrete classes. Our code will be brittle if we depend on concrete classes. In the next article you will learn about using null objects in specs.','2014-07-28 20:01:13','2014-08-13 17:20:19'),(201,'TDD Beyond Basics : Null Object - Guessing Game Kata Part 4','Objective\r\n=========\r\n----------\r\n\r\n- To learn about as_null_object in rspec\r\n  \r\nSteps\r\n=========\r\n---------\r\n\r\nStep 1\r\n-------\r\n\r\nIn irb type:\r\n\r\n```ruby\r\n$irb\r\n> require \'rspec/mocks/standalone\'\r\n    => true\r\n> s = stub\r\n    => #<RSpec::Mocks::Mock:0xfdb8 @name=nil> \r\n> s.hi RSpec::Mocks::MockExpectationError:\r\n   Stub received unexpected message :hi with (no args)\r\n```\r\n\r\nIf you send a message to a stub that is not programmed to respond to a method, you get an error \'Stub received unexpected message\'.\r\n\r\n\r\nStep 2\r\n----------\r\n\r\nIn irb type:\r\n\r\n```ruby\r\n  > t = stub(\'stubber\', :age => 16)\r\n=> #<RSpec::Mocks::Mock:0x7104 @name=\"stubber\"> \r\n  > t.age\r\n => 16\r\n```\r\n\r\nWe have programmed the stub to respond to age method. So when we call the age method, we get 16 as the answer.\r\n\r\n\r\nStep 3\r\n--------------\r\n\r\nIn irb type:\r\n\r\n```ruby\r\n  > t = stub(\'stubber\', :age => 16).as_null_object\r\n=> #<RSpec::Mocks::Mock:0x7104 @name=\"stubber\"> \r\n  > t.age\r\n => 16\r\n  > t.hi\r\n=> #<RSpec::Mocks::Mock:0x7104 @name=\"stubber\"> \r\n  > t.bye\r\n=> #<RSpec::Mocks::Mock:0x7104 @name=\"stubber\">\r\n  > t.foo.bar\r\n=> #<RSpec::Mocks::Mock:0x7104 @name=\"stubber\">\r\n```\r\n\r\nWhen you call as_null_object on the stub. it behaves as the unix dev/null equivalent for tests. It ignores any messages that is not explicitly programmed to respond. It\'a black hole where messages disappear. You can chain as deep as you want and it will keep returning the stub object. This is useful for incidental interactions that is not relevant to what is being tested.\r\n\r\nStep 4\r\n----------------\r\n\r\nLet\'s add the third spec:\r\n\r\n```ruby\r\nrequire_relative \'guess_game\'\r\n\r\ndescribe GuessGame do\r\n  # First two specs same as before\r\n  \r\n  # Here is the new third spec\r\n  it \'prompt the user to enter the guess number\' do\r\n    fake_console = double(\'Console\')\r\n    fake_console.should_receive(:prompt).with(\'Enter a number between 1 and 100\')\r\n    game = GuessGame.new(fake_console)\r\n    game.start\r\n  end\r\n  \r\nend\r\n```\r\n\r\nStep 5\r\n--------------\r\n\r\nWhen you run the spec, you get the following error:\r\n\r\n```ruby\r\nGuessGame prompt the user to enter the guess number.\r\n  Failure/Error: game.start\r\n    Double \"Console\" received unexpected message\r\n      :output with (\"Welcome to the Guessing Game\")\r\n```\r\n\r\nThe third spec failed because of the second spec. \r\n\r\nStep 6\r\n--------------\r\n\r\nTo fix this, call as_null_object on fake_console like this:\r\n\r\n```ruby\r\nrequire_relative \'guess_game\'\r\n\r\ndescribe GuessGame do\r\n  # other specs same as before\r\n  \r\n  it \'prompt the user to enter the guess number\' do\r\n    fake_console = double(\'Console\').as_null_object\r\n    # same code as before\r\n  end\r\n\r\nend\r\n```\r\n\r\nStep 7\r\n-----------\r\n\r\nWhen you run the spec, we now fail for the right reason:\r\n\r\n```ruby\r\nGuessGame prompt the user to enter the guess number\r\n  Failure/Error:\r\n    fake_console.should_receive(:prompt).with(\'Enter a number between 1 and 100\')\r\n    (Double \"Console\").prompt(\"Enter a number between 1 and 100\")\r\n      expected: 1 time\r\n      received: 0 times\r\n```\r\n\r\nStep 8\r\n------------\r\n\r\nChange the start method like this:\r\n\r\n```ruby\r\nrequire_relative \'standard_output\'\r\n\r\nclass GuessGame\r\n  # other code same as before\r\n  def start\r\n    @console.output(\'Welcome to the Guessing Game\')\r\n    @console.output(\'Enter a number between 1 and 100\')\r\n  end\r\nend\r\n```\r\n\r\nStep 9\r\n------------\r\n\r\nRun the spec, it now fails with the following error:\r\n\r\n```ruby\r\nGuessGame should display greeting when the game begins \r\n  Failure/Error: game.start\r\n    Double \"Console\" received unexpected message\r\n      :prompt with (\"Enter a number between 1 and 100\")\r\n```\r\n\r\nSpec 3 passes but it breaks existing spec 2. \r\n\r\nStep 10\r\n--------------\r\n\r\nTo fix this, call as_null_object which ignores any messages not set as expectation in spec 2 as shown below:\r\n\r\n```ruby\r\nrequire_relative \'guess_game\'\r\n\r\ndescribe GuessGame do\r\n  # other specs same as before\r\n  it \'displays greeting when the game begins\' do\r\n    fake_console = double(\'Console\').as_null_object\r\n    # rest of this spec same as before\r\n  end\r\nend\r\n```\r\n\r\nStep 11\r\n-----------\r\n\r\nAll specs now pass.\r\n\r\nStep 12\r\n--------------\r\n\r\nLet\'s play the game in the irb.\r\n\r\n```ruby\r\n$irb\r\n  > load \'./guess_game.rb\'\r\n => true\r\n  > g = GuessGame.new\r\n=> #<GuessGame:0x08 @console=StandardOutput\r\n  > g.start\r\nWelcome to the Guessing Game\r\nNoMethodError: undefined method \'prompt\' for StandardOutput\r\n```\r\n\r\nStep 13\r\n-----------\r\n\r\nLet\'s add the prompt method to the standard_output.rb:\r\n\r\n```ruby\r\nclass StandardOutput\r\n  # other code same as before\r\n  \r\n  def prompt(message)\r\n    output(message)\r\n    puts \'>\'\r\n  end\r\nend\r\n```\r\n\r\nNote that this change is not driven by test. The reason is that the mock fake_console and the read object StandardOutput are not in sync. This is exposed by our exploration session in irb console. We will revisit this issue and learn how to write Synchronization Specs to keep them in sync later.\r\n\r\nStep 14\r\n-----------\r\n\r\nHere is the complete code listing for guess_game.rb:\r\n\r\n```ruby\r\nrequire_relative \'standard_output\'\r\n\r\nclass GuessGame\r\n  def initialize(console=StandardOutput.new)\r\n    @console = console \r\n  end\r\n  \r\n  def random \r\n    Random.new.rand(1..100)\r\n  end\r\n  \r\n  def start\r\n    @console.output(\"Welcome to the Guessing Game\")\r\n    @console.prompt(\"Enter a number between 1 and 100\") \r\n  end\r\nend\r\n```\r\n\r\nHere is the standard_output.rb\r\n\r\n```ruby\r\nclass StandardOutput \r\n  def output(message)\r\n    puts message\r\n  end\r\n\r\n  def prompt(message)\r\n    output(message)\r\n    puts \'>\'\r\n  end\r\nend\r\n```\r\n\r\nSummary\r\n=========\r\n---------\r\n\r\nIn this article you learned about as_null_object and when to use it in your tests. We also ran into the problem of keeping the mock and the real object in sync. We will discuss the solution to this problem later.','2014-07-28 20:12:38','2014-08-13 17:24:06'),(211,'TDD Basics : Refactor in Green State - Guessing Game Kata Part 5','Objectives\r\n==========\r\n----------\r\n\r\n- Start refactoring when in green state and end refactoring in green state\r\n- Learn how to express the relationship between the doc string and the test data\r\n- Learn about using stub for incidental interactions\r\n  \r\nSteps\r\n=========\r\n---------\r\n\r\nStep 1\r\n-------\r\n\r\nRun all the specs. It should pass. Let\'s delete the random method because it is required only once for each game session.\r\n\r\n```ruby\r\nrequire_relative \'standard_output\'\r\n\r\nclass GuessGame\r\n  attr_reader :random\r\n  \r\n  def initialize(console=StandardOutput.new)\r\n    @console = console \r\n    @random = Random.new.rand(1..100)\r\n  end\r\n    \r\n  def start\r\n    @console.output(\"Welcome to the Guessing Game\")\r\n    @console.prompt(\"Enter a number between 1 and 100\") \r\n  end\r\nend\r\n```\r\n\r\nWe have moved the random number generation inside the constructor and exposed it\'s value via attr_reader. We have completed refactoring.\r\n\r\nStep 2\r\n----------\r\n\r\nRun all the specs. It should pass. We were green before refactoring and after refactoring we are still green. This is important, start refactoring when you are in green state and after refactoring you should still be green. \r\n\r\nStep 3\r\n----------\r\n\r\nLet\'s now add the fourth sepc.\r\n\r\n```ruby\r\nrequire_relative \'guess_game\'\r\n\r\ndescribe GuessGame do\r\n  # other specs same as before\r\n  it \'validates guess entered by the user : lower than 1\' do\r\n    game = GuessGame.new\r\n    game.start\r\n    game.error.should == \'The number must be between 1 and 100\'\r\n  end\r\nend\r\n```\r\n\r\nStep 4\r\n-----------\r\n\r\nWhen you run the specs, you get:\r\n\r\n```ruby\r\nGuessGame validates guess entered by the user : lower than 1\r\n  Failure/Error:\r\n    game.error.should == \'The number must be between 1 and 100\'\r\n  NoMethodError:\r\n    undefined method \'error\' for #<GuessGame:0xd8>\r\n```\r\n\r\nStep 5\r\n-----------\r\n\r\nAdd the attr_accessor for error variable in guess_game.rb:\r\n\r\n```ruby\r\nrequire_relative \'standard_output\'\r\n\r\nclass GuessGame\r\n  attr_accessor :error\r\n  \r\n  # rest of the code is same as before\r\nend\r\n```\r\n\r\nStep 6\r\n-----------\r\n\r\nRun the specs again. We now fail for the right reason:\r\n\r\n```ruby\r\nGuessGame validates guess entered by the user : lower than 1\r\n  Failure/Error:\r\n  game.error.should == \'The number must be between 1 and 100\'\r\n    expected: \"The number must be between 1 and 100\"\r\n    got: nil (using ==)\r\n```\r\n\r\nStep 7\r\n--------------\r\n\r\nChange the guess_game.rb as shown below:\r\n\r\n```ruby\r\nclass GuessGame\r\n  attr_reader :random\r\n  attr_accessor :error\r\n\r\n  def initialize(console=StandardOutput.new)\r\n    @console = console\r\n    @random = Random.new(1..100)\r\n  end\r\n\r\n  def start\r\n    @console.output(\'Welcome to the Guessing Game\')\r\n    @console.prompt(\'Enter the number between 1 and 100\')\r\n    guess = get_user_guess\r\n    validate(guess)\r\n  end\r\n  \r\n  def validate(n)\r\n    if (n < 1)\r\n      @error = \'The number must be between 1 and 100\'\r\n    end\r\n  end\r\n  \r\n  def get_user_guess\r\n    0\r\n  end\r\nend\r\n```\r\n\r\nStep 8\r\n----------------\r\n\r\nAll the specs now pass. Let\'s now add the spec to validate the guess that is higher than 100\r\n\r\n```ruby\r\nrequire_relative \'guess_game\'\r\n\r\ndescribe GuessGame do\r\n  # other specs same as before\r\n  it \'validates guess entered by the user : higher than 100\' do\r\n    game = GuessGame.new\r\n    game.stub(:get_user_guess) { 101 }\r\n    game.start\r\n    \r\n    game.error.should == \'The number must be between 1 and 100\'\r\n  end\r\nend\r\n```\r\n\r\nWe don\'t want to worry about how we are going to get the user input because our focus now is on testing the validation logic. So we stub the get_user_guess method to return a value that will help us to test the validation logic. Calling the get_user_guess is an example for incidental interaction.\r\n\r\nStep 9\r\n-------------\r\n\r\nThis spec fails for the right reason with the error:\r\n\r\n```ruby\r\nGuessGame validates guess entered by the user : higher than 100\r\n  Failure/Error:\r\n    game.error.should == \'The number must be between 1 and 100\'\r\n    expected: \"The number must be between 1 and 100\"\r\n    got: nil (using ==)\r\n```\r\n\r\nStep 10\r\n--------------\r\n\r\nChange the guess_game.rb validate method as follows:\r\n\r\n```ruby\r\nclass GuessGame\r\n  # rest of the class same as before  \r\n  def validate(n)\r\n    if (n < 1) or (n > 100)\r\n      @error = \'The number must be between 1 and 100\'\r\n    end\r\n  end\r\n  \r\nend\r\n```\r\n\r\nStep 11\r\n-----------\r\n\r\nAll specs now pass. The standard_output.rb remains unchanged.\r\n\r\nStep 12\r\n------------\r\n\r\nChange the validation spec for the lower bound as follows:\r\n\r\n```ruby\r\nrequire_relative \'guess_game\'\r\n\r\ndescribe GuessGame do\r\n  # other specs same as before\r\n  it \'validates guess entered by the user : lower than 1\' do\r\n    game = GuessGame.new\r\n    game.stub(:get_user_guess) { 0 }\r\n    game.start\r\n    \r\n    game.error.should == \'The number must be between 1 and 100\'\r\n  end\r\nend\r\n```\r\n\r\nWhy did we make this change? This spec expresses the relationship between the doc string and the data set used to test clearly. You can just look at the spec and see that 0 is lower than 1. You don\'t have to look at the production code to see that it is returning a value lower than 1. \r\n\r\nSummary\r\n=========\r\n-----------\r\n\r\nIn this article you learned about staring the refactor when in green state and ending in green state when refactoring is complete. You also learned about the using stub for incidental interaction in the spec. We also saw how to express the relationship between the doc string in the spec and the data set.','2014-07-28 20:14:15','2014-08-13 17:30:38'),(221,'TDD Basics : Test Behavior Not Implementation - Guessing Game Kata Part 6','Objective\r\n=========\r\n----------\r\n\r\n- To lean how to write tests that is focused on behavior and not the implementation details.\r\n  \r\nSteps\r\n=========\r\n---------\r\n\r\nStep 1\r\n-------\r\n\r\nLet\'s write the next spec. If required, refer the guess game description described in the previous article that introduces the game. Here is the guess_game_spec.rb with the new spec:\r\n\r\n```ruby\r\nrequire_relative \'guess_game\'\r\n\r\ndescribe GuessGame do\r\n\r\n  it \'give clue for valid input : computer pick < guess\' do\r\n    fake_console = double(\'Console\').as_null_object\r\n    fake_console.should_receive(:output).with(\'Your guess is lower\')\r\n    game = GuessGame.new(fake_console)\r\n    game.random = 25\r\n    game.stub(:get_user_guess) { 10 }\r\n\r\n    game.start\r\n  end\r\n  \r\nend\r\n```\r\n\r\nStep 2\r\n----------\r\n\r\nRun the spec, watch it fail with the error:\r\n\r\n```ruby\r\nGuessGame give clue for valid input : computer pick < guess\r\n  Failure/Error: game.random = 25\r\n  NoMethodError:\r\n    undefined method \'random=\' for GuessGame\r\n```\r\n\r\nStep 3\r\n----------\r\n\r\nChange the guess_game.rb to:\r\n\r\n```ruby\r\nrequire relative \'standard_output\'\r\n\r\nclass GuessGame\r\n  attr_accessor :random\r\n  \r\n  # rest of the code is same as before\r\nend\r\n```\r\n\r\nStep 4\r\n-----------\r\n\r\nRun the specs again. Now the error message is:\r\n\r\n```ruby\r\nGuessGame give clue for valid input : computer pick < guess\r\nFailure/Error:\r\n  fake_console.should_receive(:output).with(\'Your guess is lower\')\r\n    Double \"Console\" received :output with unexpected arguments\r\n    expected: (\"Your guess is lower\")\r\n      got: (\"Welcome to the Guessing Game\")\r\n```\r\n\r\nStep 5\r\n-----------\r\n\r\nChange the guess_game.rb as shown below:\r\n\r\n```ruby\r\nrequire_relative \'standard_output\'\r\n\r\nclass GuessGame\r\n  attr_accessor :random\r\n  attr_accessor :error\r\n\r\n  def initialize(console=StandardOutput.new)\r\n    @console = console\r\n    @random = Random.new.rand(1..100)\r\n  end\r\n\r\n  def start\r\n    @console.ouput(\'Welcome to the Guessing Game\')\r\n    @console.prompt(\'Enter the number between 1 and 100\')\r\n    guess = get_user_guess\r\n    valid = validate(guess)\r\n    give_clue if valid\r\n  end\r\n\r\n  def validate(n)\r\n    if (n < 1) or (n > 100)\r\n      @error = \'The number must be between 1 and 100\'\r\n      false\r\n    else\r\n      true\r\n    end\r\n  end\r\n\r\n  def give_clue\r\n    @console.output(\'Your guess is lower\')\r\n  end\r\n\r\n  def get_user_guess\r\n    0\r\n  end\r\nend\r\n```\r\n\r\nStep 6\r\n-----------\r\n\r\nAll specs pass now. \r\n\r\nStep 7\r\n--------------\r\n\r\nLet\'s make the spec use computer_pick instead of random. This makes the variable expressive of gaming domain instead of being tied to implementation.\r\n\r\n```ruby\r\nrequire_relative \'guess_game\'\r\n\r\ndescribe GuessGame do\r\n\r\n  it \'give clue for valid input : computer pick < guess\' do\r\n    # same code as before\r\n    game.computer_pick = 25\r\n    # same code as before\r\n  end\r\n  \r\nend\r\n```\r\n\r\nStep 8\r\n----------------\r\n\r\nThis gives the error:\r\n\r\n```ruby\r\nNoMethodError:\r\n  undefined method \'computer_pick=\' for GuessGame\r\n```\r\n\r\nStep 9\r\n------------\r\n\r\nChange the guess_game.rb implementation to:\r\n\r\n```ruby\r\nclass GuessGame\r\n  attr_accessor :computer_pick\r\n  # code same as before\r\n\r\n  def initialize(console=StandardOutput.new)\r\n    @console = console\r\n    @computer_pick = Random.new.rand(1..100)\r\n  end\r\n\r\n  # rest of the code same as before\r\nend\r\n```\r\n\r\nStep 9\r\n-------------\r\n\r\nIt breaks the older spec. To fix it, change the line that references random to computer_pick:\r\n\r\n```ruby\r\n\r\nit \'generate random number between 1 and 100 inclusive\' do\r\n  # same code as before\r\n\r\n  result = game.computer_pick\r\n\r\n  # rest of the code is same as before\r\nend\r\n```\r\n\r\nStep 10\r\n--------------\r\n\r\nNow all specs pass.\r\n\r\nStep 11\r\n-----------\r\n\r\nLet\'s write the spec for giving clue when the valid input is higher than computer pick.\r\n\r\n```ruby\r\nit \'give clue for valid input > computer pick\' do\r\n  fake_console = double(\'Console\').as_null_object\r\n  fake_console.should_receive(:output).with(\'Your guess is higher\')\r\n  game = GuessGame.new(fake_console)\r\n  game.computer_pick = 25\r\n  game.stub(:get_user_guess) { 50 }\r\n\r\n  game.start\r\nend\r\n```\r\n\r\nStep 12\r\n------------\r\n\r\nThe failure message now is:\r\n\r\n```ruby\r\nGuessGame give clue for valid input > computer pick\r\n  Failure/Error:\r\n    fake_console.should_receive(:output).with(\'Your guess is higher\')\r\n    Double \"Console\" received :output with unexpected arguments\r\n    expected: (\"Your guess is higher\")\r\n      got: (\"Welcome to the Guessing Game\"), (\"Your guess is lower\")\r\n```\r\n\r\nWe are failing for the right reason.\r\n\r\nStep 13\r\n---------\r\n\r\nChange the guess_game.rb as follows:\r\n\r\n```ruby\r\nrequire_relative \'standard_output\'\r\n\r\nclass GuessGame\r\n# same code as before\r\n\r\n  def give_clue\r\n    if get_user_guess < @computer_pick\r\n      @console.output(\'Your guess is lower\')\r\n    else\r\n      @console.output(\'Your guess is higher\')\r\n    end\r\n  end\r\nend\r\n```\r\n\r\nStep 14\r\n------------\r\n\r\nAll specs now pass.\r\n\r\nStep 15\r\n------------\r\n\r\nLet\'s add the spec when the user guess is correct.\r\n\r\n```ruby\r\nrequire_relative \'guess_game\'\r\n\r\ndescribe GuessGame do\r\n# code same as before\r\n\r\n  it \'recognize the correct answer when the guess is correct\' do\r\n    fake_console = double(\'Console\').as_null_object\r\n    fake_console.should_receive(:output).with(\'Your guess is correct\')\r\n\r\n    game = GuessGame.new(fake_console)\r\n    game.computer_pick = 25\r\n    game.guess = 25\r\n\r\n    game.start\r\n  end\r\nend\r\n```\r\n\r\nStep 16\r\n----------\r\n\r\n```ruby\r\nGuessGame should recognize the correct answer when the guess is correct \r\nFailure/Error:\r\n  fake_console.should_receive(:output).with(\'Your guess is correct\')\r\n  Double \"Console\" received :output with unexpected arguments\r\n    expected: (\"Your guess is correct\")\r\n    got: (\"Welcome to the Guessing Game\"), (\"Your guess is higher\")\r\n```\r\n\r\nStep 17\r\n---------\r\n\r\nChange the guess_game.rb as follows:\r\n\r\n```ruby\r\nrequire_relative \'standard_output\'\r\n\r\nclass GuessGame\r\n# same code as before\r\n\r\n  def give_clue\r\n    if get_user_guess < @computer_pick\r\n      @console.output(\'Your guess is lower\')\r\n    elsif get_user_guess > @computer_pick\r\n      @console.output(\'Your guess is higher\')\r\n    else\r\n      @console.output(\'Your guess is correct\')\r\n    end\r\n  end\r\nend\r\n```\r\n\r\nStep 18\r\n-----------\r\n\r\nAll specs will now pass.\r\n\r\nStep 19\r\n-----------\r\n\r\nLet\'s now hide the implementation details by making the validate and give_clue methods private.\r\n\r\n```ruby\r\nrequire_relative \'standard_output\'\r\n\r\nclass GuessGame\r\n# same code as before\r\n\r\n  private\r\n\r\n  def validate(n)\r\n    # same code as before\r\n  end\r\n\r\n  def give_clue\r\n    # same code as before\r\n  end\r\nend\r\n```\r\n\r\nStep 20\r\n----------\r\n\r\nAll specs still pass. This means our specs are not testing the implementation details. Since our specs are only focused on testing the behavior, we were able to hide the implementation. Specs that depend on implementation will break whenever the implementation changes, even if the behavior did not change. Brittle specs are hard to maintain and offer no value. Specs should break only if the behavior changes, this acts as a safety net protecting us from regression bugs.\r\n\r\nSummary\r\n=========\r\n---------\r\n\r\nIn this article you learned about focusing on testing the behavior instead of implementation details. You saw how we can hide the implementation from the clients. Specs are the first client of our library and they must be unaware of implementation details.','2014-07-28 22:25:22','2014-08-13 17:33:34'),(231,'TDD Beyond Basics : Synchronization Specs - Guessing Game Kata Part 7','Objective\r\n=========\r\n----------\r\n\r\n- To learn how to keep mocks in sync with the real class. \r\n\r\nDiscussion\r\n=========\r\n-----------\r\n\r\nIn an earlier article we ran into a problem when the mock went out of sync with the StandardOutput class. We had deferred the discussion about this topic in that article. The StandardOutput class is one of several concrete implementation of an user interfacing object. We could have GuiOutput as another concrete implementation of the same interface. The fake_console mock is a generic **role** that represents an user interfacing object. In this lesson we will write synchronization specs to keep mocks in sync with production code.\r\n  \r\nSteps\r\n=========\r\n----------\r\n\r\nStep 1\r\n-------\r\n\r\nCreate console_interface_spec.rb with the following code:\r\n\r\n```ruby\r\nshared_examples \'Console Interface\' do\r\n  describe \'Console Interface Protocol\' do\r\n    it \'should implement the console interface : output(arg)\' do\r\n      @object.should respond_to(:output).with(1).argument\r\n    end\r\n  \r\n    it \'should implement the console interface: prompt(arg)\' do\r\n      @object.should respond_to(:prompt).with(1).argument\r\n    end\r\n  end\r\nend\r\n```\r\n\r\nStep 2\r\n----------\r\n\r\nIf you run this spec, you get:\r\n\r\n```ruby\r\nNo examples found.\r\n\r\nFinished in 0.00008 seconds\r\n0 examples, 0 failures\r\n```\r\nThe shared examples are meant to be shared.\r\n\r\nStep 3\r\n----------\r\n\r\nCreate a standard_output_spec.rb like this:\r\n\r\n```ruby\r\nrequire_relative \'console_interface_spec\'\r\nrequire_relative \'standard_output\'\r\n\r\ndescribe StandardOutput do\r\n  before(:each) do\r\n    @object = StandardOutput.new\r\n  end\r\n\r\n  it_behaves_like \'Console Interface\'\r\nend\r\n```\r\n\r\nThe standard_output.rb remains unchanged, here is the code for reference:\r\n\r\n```ruby\r\nclass StandardOutput\r\n  def output(message)\r\n    puts message\r\n  end\r\n  \r\n  def prompt(message)\r\n    output(message)\r\n    puts \'>\'\r\n  end\r\nend\r\n```\r\n\r\nStep 4\r\n-----------\r\n\r\nRun this spec as follows:\r\n\r\n```ruby\r\n$rspec standard_output_spec.rb \r\n```\r\n\r\nNow you get the following output:\r\n\r\n```ruby\r\nStandardOutput\r\n  behaves like Console Interface\r\n    Console Interface\r\n      should implement the console interface: output(arg)\r\n      should implement the console interface: prompt(arg)\r\nFinished in 0.00258 seconds \r\n2 examples, 0 failures\r\n```\r\n\r\nDiscussion\r\n============\r\n-----------\r\n\r\nThe Console Interface shared example is a Synchronization Spec that illustrates how to avoid the problem of specs passing / failing when mocks go out of sync with the production code. Synchronization specs are a way to express the interface design in code. It makes the protocol of the class explicit. The term protocol here is used to mean how a collaborator needs to communicate with an object exposing it\'s interface. As you can see from the shared example, we also specify how many arguments to expect in the interface.\r\n\r\nWhen to use synchronization specs? If you are using lot of mocks you may not be able to write synchronization specs for all of them. In this case, think about writing synchronization specs for the most dependent and important module of your application. \r\n\r\nSummary\r\n=========\r\n-----------\r\n\r\nIn this article you learned about Synchronization Specs and when to use them. In the next article we will discuss the Single Purpose Principle in depth.','2014-07-29 21:25:27','2014-08-13 17:35:58'),(241,'TDD Beyond Basics : Single Purpose Principle Revisited - Guessing Game Kata Part 8','Objective\r\n=========\r\n----------\r\n\r\n- To learn how to apply Single Purpose Principle.\r\n  \r\nDiscussion\r\n=========\r\n---------------------------\r\n\r\nLet\'s take a look at the things that GuessGame object can do:\r\n\r\n- it should generate random number between 1 and 100 inclusive\r\n- it should display greeting when the game begins\r\n- it should prompt the user to enter the number representing their guess\r\n- it should perform validation of the guess entered by the user : lower than 1\r\n- it should perform validation of the guess entered by the user : higher than 100\r\n- it should give clue when the input is valid and is less than the computer pick\r\n- it should give clue when the input is valid and is greater than the computer pick\r\n- it should recognize the correct answer when the guess is correct\r\n\r\nWe can categorize the above responsibilities as follows:\r\n\r\n**Random Number Generation**\r\n\r\n- it should generate random number between 1 and 100 inclusive\r\n\r\n**Interacting with the user**\r\n\r\n- it should display greeting when the game begins\r\n- it should prompt the user to enter the number representing their guess\r\n- it should give clue when the input is valid and is less than the computer pick\r\n- it should give clue when the input is valid and is greater than the computer pick\r\n\r\n**Input Validation**\r\n\r\n- it should perform validation of the guess entered by the user : lower than 1\r\n- it should perform validation of the guess entered by the user : higher than 100\r\n\r\n**Know when the guess is correct**\r\n\r\n- it should recognize the correct answer when the guess is correct\r\n\r\nRandom number generation can be moved into Randomizer class. So we can delete the first spec, since it is now the responsibility of it\'s collaborator. Interacting with users will the job of boundary objects. Input validation is the job validator objects. The GuessGame object could become a gaming engine that delegates validation and user interaction to validator and boundary objects if they become complex.\r\n\r\nWe know validation rules and user interfacing needs will change at a different rate from the game logic. We are aware of these facts when making decisions about adding new classes. For now, we will leave the GuessGame as it is.\r\n\r\nAs we reflect on the responsibilities we can check whether the set of responsibilities serve one purpose or they are doing unrelated things. This will help us design classes with high cohesion. This leads us to the following code.\r\n\r\nSteps\r\n=========\r\n---------\r\n\r\nStep 1\r\n-------\r\n\r\nDelete the following spec in guess_game_spec.rb\r\n\r\n```ruby\r\nrequire_relative \'guess_game\'\r\n\r\ndescribe GuessGame do\r\n  # delete the following spec\r\n  it \'generate random number between 1 and 100 inclusive\' do\r\n\r\n  end\r\nend\r\n```\r\n\r\nStep 2\r\n----------\r\n\r\nMove the randomizing function to a new Randomizer class. Here is the code for randomizer.rb\r\n\r\n```ruby\r\nclass Randomizer\r\n  def self.get\r\n    Random.new.rand(1..100)\r\n  end\r\nend\r\n```\r\n\r\nHere is the randomizer_spec.rb:\r\n\r\n```ruby\r\ndescribe Randomizer do\r\n  it \'generate random number between 1 and 100 inclusvie\' do\r\n    result = Randomizer.new.get\r\n\r\n    expected = 1..100\r\n    expected.should cover(result)\r\n  end\r\nend\r\n```\r\n\r\nStep 3\r\n----------\r\n\r\nChange the guess_game.rb as follows:\r\n\r\n```ruby\r\nrequire_relative \'standard_output\'\r\nrequire_relative \'randomizer\'\r\n\r\nclass GuessGame\r\n  attr_accessor :computer_pick\r\n  attr_accessor :error\r\n\r\n  def initialize(console=StandardOutput.new, randomizer=Randomizer.new)\r\n    @console = console\r\n    @computer_pick = randomizer.get\r\n  end\r\n  \r\n  # rest of the code same as before\r\nend\r\n```\r\n\r\nStep 4\r\n-----------\r\n\r\nRun the specs. It will pass.\r\n\r\nHow to Use RSpec Syntax to Keep your Design Cohesive\r\n==========\r\n----------\r\n\r\nThe rspec syntax allows you to describe the class in the second argument as follows:\r\n\r\n```ruby\r\ndescribe ClassName, \'here you can state the purpose of the class\' do\r\n\r\nend\r\n```\r\n\r\nIf the class is focused on doing one thing really well, this second argument will be short. It will **NOT** have the words such as **AND**, **OR**. Because when you use those words, the class has more than one purpose. \r\n\r\nSummary\r\n=========\r\n---------\r\n\r\nIn this article you learned more about Single Purpose Principle and how to apply it to come up with a good design. In the next article we will wrap up the GuessGame. You will learn about the boundary of the system and how to isolate the changes in the way we interact with the system from the gaming logic so that we separate the different concerns. We need to separate them because they change for different reasons. They are orthogonal since they are independent of each other.  ','2014-07-29 21:26:16','2015-10-06 06:21:17'),(251,'TDD Beyond Basics : Seams in a System - Guessing Game Kata Final Solution','Objectives\r\n==========\r\n----------\r\n\r\n- Learn how to find the seams in a system\r\n- Learn about exploratory testing  \r\n\r\nDiscussion\r\n============\r\n------------\r\n\r\nYou can use the electrical outlet to plugin a lamp, a laptop adapter, TV etc as long as the device can handle the voltage and frequency rating. There is one outlet but different devices connect to it that has different functionality. Seams in a system are similar to electrical plugin points. Why do we care about seams? Seams make the code testable and flexible. \r\n\r\n![alt text](https://images.rubyplus.com/socket.jpg \"Seams\")\r\n  \r\n>> Seam is a place where you can alter behavior of your program without editing in that place. Every seam has an enabling point, a place wehre you can make the decision to use one behavior or another.\r\n>>  -- Michael C. Feathers (Working Effectively with Legacy Code)\r\n\r\nWhy do we need to apply concepts that is discussed in a book about legacy code? Because it is a design technique, if you build a system with flexibility where it is needed, it becomes easy to test. You can also identify that when it is difficult to test, it is a symptom of bad design. In such cases, you need to think hard about improving the design.\r\n\r\nThe `guess_game.rb` still has a fake implementation for get_user_guess method:\r\n\r\n```ruby\r\ndef get_user_guess\r\n  0\r\nend\r\n```\r\n\r\nWe now have to deal with getting input from the user. We have test driven the development of the game and we are now getting to the system boundary where the gaming engine needs to interact with users to get input. The way we interact with users is likely to change at a different rate than the game logic requirements. This means that we have found a seam in our system. This is a plugin point to our system where we could have different ways of getting user input. So, the question is : How can we abstract the standard input and standard output?\r\n\r\nSteps\r\n=========\r\n---------\r\n\r\nStep 1\r\n-------\r\n\r\nLet\'s play in the irb:\r\n\r\n```ruby\r\nirb > x = $stdin.gets\r\n54\r\n => \"54\\n\"\r\nirb > $stdout.puts \'hi\'\r\nhi\r\n```\r\n\r\nStep 2\r\n----------\r\n\r\nWe can combine the standard input and standard output into a console object. By definition, console is a monitor or keyboard in a multiuser computer system. We can call this new class StandardConsole. Create a file `standard_console.rb` with the following contents:\r\n\r\n```ruby\r\nclass StandardConsole\r\n  def output(message)\r\n    puts message\r\n  end\r\n\r\n  def prompt(message)\r\n    output(message)\r\n    puts \'>\'\r\n  end\r\n\r\n  def input\r\n    gets.chomp.to_i\r\n  end\r\nend\r\n```\r\n\r\nThe input() method gets the user input, removes the new line and converts to an integer. Even though, StandardConsole looks like a generic class, it\'s not. It is specific to our guess game. So ideally we want to encapsulate this class within Gaming module.\r\n\r\nStep 3\r\n----------\r\n\r\nChange the get_user_guess method in `guess_game.rb` as follows:\r\n\r\n```ruby\r\ndef get_user_guess\r\n  @console.input\r\nend\r\n```\r\n\r\nDiscussion\r\n===========\r\n-----------\r\n\r\nAll the specs still pass. This change was not driven by a test. If we had written an end to end test, then it would have been driven by a failing acceptance test. The same issue can also be discovered simply by playing the game in the irb. Another alternative is to use highline gem to develop a command line interface to play the guess game.\r\n\r\n\r\nStep 4\r\n-----------\r\n\r\nThe following is one way to refactor the code. Here is the refactored `guess_game_spec.rb`.\r\n\r\n```ruby\r\nrequire_relative \'guess_game\'\r\n\r\ndescribe GuessGame do\r\n  let(:fake_console) { double(\'Console\').as_null_object }\r\n\r\n  context \'Start the game\' do\r\n    it \"display greeting when the game begins\" do\r\n      fake_console.should_receive(:output).with(\"Welcome to the Guessing Game\")\r\n      game = GuessGame.new(fake_console)\r\n      game.start\r\n    end\r\n    \r\n    it \"prompt the user to enter the number representing their guess.\" do\r\n      fake_console.should_receive(:prompt).with(\'Enter a number between 1 and 100\')\r\n      game = GuessGame.new(fake_console)\r\n      game.start    \r\n    end\r\n  end      \r\n  \r\n  context \'Validation\' do\r\n    it \"validates user guess : lower than 1\" do\r\n      game = GuessGame.new\r\n      game.stub(:get_user_guess) { 0 }\r\n      game.start\r\n\r\n      game.error.should == \'The number must be between 1 and 100\'            \r\n    end\r\n    \r\n    it \"validates user guess : higher than 100\" do\r\n      game = GuessGame.new\r\n      game.stub(:get_user_guess) { 101 }\r\n      game.start\r\n\r\n      game.error.should == \'The number must be between 1 and 100\'            \r\n    end    \r\n  end\r\n  \r\n  context \'Gaming Engine\' do\r\n    it \"give clue : input is valid and is less than the computer pick\" do\r\n      fake_console.should_receive(:output).with(\'Your guess is lower\')\r\n      game = GuessGame.new(fake_console)\r\n      game.computer_pick = 25\r\n      game.stub(:get_user_guess) { 10 }\r\n\r\n      game.start\r\n    end\r\n    \r\n    it \"give clue : input is valid and is greater than the computer pick\" do\r\n      fake_console.should_receive(:output).with(\'Your guess is higher\')\r\n      game = GuessGame.new(fake_console)\r\n      game.computer_pick = 25\r\n      game.stub(:get_user_guess) { 50 }\r\n\r\n      game.start\r\n    end\r\n    \r\n    it \"recognize the correct answer when the guess is correct\" do\r\n      fake_console.should_receive(:output).with(\'Your guess is correct\')\r\n      game = GuessGame.new(fake_console)\r\n      game.computer_pick = 25\r\n      game.stub(:get_user_guess) { 25 }\r\n\r\n      game.start\r\n    end    \r\n  end\r\nend\r\n```\r\n\r\nStep 5\r\n---------\r\n\r\nWe realized that we need to get input from the user and provide output to the user, so having an object for StandardOutput alone is not sufficient. We need StandardInput as well. StandardOutput and StandardInput is combined into one StandardConsole object. This new object encapsulates the interaction with the standard input and standard output (monitor & keyboard).\r\n\r\nWe have modified the constructor for the guess game to reflect this bidirectional data flow with an user by using the StandardConsole. Here is the refactored `guess_game.rb`:\r\n\r\n```ruby\r\nrequire_relative \'standard_console\'\r\nrequire_relative \'randomizer\'\r\n\r\nclass GuessGame\r\n  attr_accessor :computer_pick\r\n  attr_accessor :error\r\n\r\n  def initialize(console=StandardConsole.new, randomizer=Randomizer.new)\r\n    @console = console\r\n    @computer_pick = randomizer.get\r\n  end\r\n  \r\n  def start\r\n    @console.output(\"Welcome to the Guessing Game\")\r\n    @console.prompt(\"Enter a number between 1 and 100\")\r\n    guess = get_user_guess\r\n    valid = validate(guess)\r\n    give_clue if valid\r\n  end\r\n  \r\n  def get_user_guess\r\n    @console.input  \r\n  end\r\n  \r\n  private\r\n  \r\n  def validate(n)\r\n    if (n < 1) or (n > 100)\r\n      @error = \'The number must be between 1 and 100\'\r\n      false\r\n    else\r\n      true\r\n    end\r\n  end\r\n  \r\n  def give_clue\r\n    if get_user_guess < @computer_pick\r\n      @console.output(\'Your guess is lower\')\r\n    elsif get_user_guess > @computer_pick\r\n      @console.output(\'Your guess is higher\')\r\n    else\r\n      @console.output(\'Your guess is correct\')  \r\n    end\r\n  end  \r\nend\r\n```\r\n\r\nStep 6\r\n-----------\r\n\r\nThe following code listings remain the same as before. Here is the `randomizer_spec.rb`.\r\n\r\n```ruby\r\nrequire_relative \'guess_game\'\r\n\r\ndescribe Randomizer do\r\n  it \"generate random number between 1 and 100 inclusive\" do\r\n    result = Randomizer.new.get\r\n  \r\n    expected = 1..100\r\n    expected.should cover(result)\r\n  end\r\nend\r\n```\r\n\r\nHere is the randomizer.rb\r\n\r\n```ruby\r\nclass Randomizer\r\n  def get\r\n    Random.new.rand(1..100)\r\n  end\r\nend\r\n```\r\n\r\nHere is the `standard_console_spec.rb`:\r\n\r\n```ruby\r\nrequire_relative \'console_interface_spec\'\r\nrequire_relative \'standard_console\'\r\n\r\ndescribe StandardConsole do\r\n  before(:each) do\r\n    @object = StandardConsole.new\r\n  end\r\n  \r\n  it_behaves_like \"Console Interface\"\r\nend\r\n```\r\n\r\nHere is the `standard_console.rb`:\r\n\r\n```ruby\r\nclass StandardConsole\r\n  def output(message)\r\n    puts message\r\n  end\r\n  def prompt(message)\r\n    output(message)\r\n    puts \">\"\r\n  end\r\n  def input\r\n    gets.chomp.to_i\r\n  end  \r\nend\r\n```\r\n\r\nDiscussion\r\n===========\r\n-----------\r\n\r\nWe have found some missing abstractions and refactored our code to use the new abstractions. We can now have different implementations of the console object such as NetworkConsole, GraphicalConsole etc. Our system is extensible to different user interfacing code as long as it conforms to our console interface. Specs are more readable since they are grouped into their own context.\r\n\r\nStep 7\r\n-----------\r\n\r\nThe output of the specs have the puts statement output because the default console used is StandardConsole. To cleanup the output let\'s create a FakeConsole for testing purposes. Create `fake_console.rb` with the following contents:\r\n\r\n```ruby\r\nclass FakeConsole\r\n  def output(message)\r\n    message\r\n  end\r\n\r\n  def prompt(message)\r\n    output(message + \'\\n\' + \">\")\r\n  end  \r\nend\r\n```\r\n\r\nStep 8\r\n--------------\r\n\r\nChange the `guess_game_spec.rb` to use the FakeConsole class to suppress the output to the standard out like this:\r\n\r\n```ruby\r\ncontext \'Validation\' do\r\n  let(:game) { game = GuessGame.new(FakeConsole.new) }\r\n  \r\n  it \"perform validation of the guess entered by the user : lower than 1\" do\r\n    game.stub(:get_user_guess) { 0 }\r\n    game.start\r\n\r\n    game.error.should == \'The number must be between 1 and 100\'            \r\n  end\r\n  \r\n  it \"perform validation of the guess entered by the user : higher than 100\" do\r\n    game.stub(:get_user_guess) { 101 }\r\n    game.start\r\n\r\n    game.error.should == \'The number must be between 1 and 100\'            \r\n  end    \r\nend\r\n```\r\n\r\nStep 9\r\n----------------\r\n\r\nRun the specs, you will see clean output like this:\r\n\r\n```ruby\r\nGuessGame\r\n  Start the game\r\n    should display greeting when the game begins\r\n    should prompt the user to enter the number representing their guess.\r\n  Validation\r\n    should perform validation of the guess entered by the user : lower than 1\r\n    should perform validation of the guess entered by the user : higher than 100\r\n  Gaming Engine\r\n    should give clue when the input is valid and is less than the computer pick\r\n    should give clue when the input is valid and is greater than the computer pick\r\n    should recognize the correct answer when the guess is correct\r\n\r\nFinished in 0.0058 seconds\r\n7 examples, 0 failures\r\n```\r\n\r\nStep 10\r\n-------------\r\n\r\nHere is the actual usage of our guess game.\r\n\r\n```ruby\r\n$irb\r\n> load \'./guess_game.rb\'\r\n   => true \r\n> g = GuessGame.new\r\n   => #<GuessGame:0xb0 @console=StandardConsole:0x088>, @computer_pick=42> \r\n> g.start\r\nWelcome to the Guessing Game\r\nEnter a number between 1 and 100 to guess the number\r\n> \r\n> g.get_user_guess\r\n20\r\nYour guess is lower\r\n \r\n> g.get_user_guess\r\n30\r\nYour guess is lower\r\n \r\n> g.get_user_guess\r\n80\r\nYour guess is higher\r\n \r\n> g.get_user_guess\r\n70\r\nYour guess is higher\r\n \r\n> g.get_user_guess\r\n42\r\nYour guess is correct\r\n\r\n```\r\n\r\nOops, you can see when we create an instance of the GuessGame class, we see the value of the number we need to guess, the value of the `computer_pick`, 42 in this case. We were focused on implementing the requirements. By doing exploratory testing we can find bugs or enhancements that we can implement. We experimented in the irb and saw that `StandardConsole#input` works. This is a change in the production code that is not driven by test.\r\n\r\nStep 11\r\n--------------\r\n\r\nLet\'s add a `to_s` method to the StandardConsole and GuessGame classes so that the secret number is not revealed while playing the game. This change was driven by exploratory testing.\r\n\r\nAdd the following to_s method to `guess_game.rb`:\r\n\r\n```ruby\r\ndef to_s\r\n  \"You have chosen : #{@console} to play the guess game\"\r\nend\r\n```\r\n\r\nAdd the following `to_s` method to `standard_console.rb`:\r\n\r\n```ruby\r\ndef to_s\r\n  \"Standard Console\"\r\nend\r\n```\r\n\r\nSummary\r\n=========\r\n---------\r\n\r\nIn this article you learned about exploratory testing and how sometimes you make changes that is not driven by a test. You may not need a test for that change if you are confident or you feel that the consequences are not critical. You also learned about seams in a system.\r\n\r\nExercises\r\n===========\r\n-----------\r\n\r\n1) Use the highline gem to develop a command line interface to the guess game.\r\n\r\n2) Play the game with Guess game and make sure you can use it\'s interface and it works as expected. Use any feedback to write new specs. \r\n\r\n3) What if the client were to use the GuessGame like this :\r\n\r\n```ruby\r\n	game = GuessGame.new\r\n	game.play\r\n```\r\n\r\nThis raises the level of abstraction and we use gaming domain specific method instead of reaching into implementation level methods. \r\n\r\n- What changes do you need to make for this to work? \r\n- Can start and `get_user_guess` methods be made into private methods?\r\n\r\nBonus\r\n=======\r\n-------\r\n\r\n1) 	It would be nice to be able to say: result.should be_between(expected_range). Implement a custom matcher be_between for a given range.\r\n\r\n2) Write `fake_console_spec.rb` that uses the shared examples to make sure it implements the abstract console interface. This will allow us to keep the FakeConsole in sync with any changes to the interface of the abstract console.\r\n\r\n3) Version 2 of our game has to satisfy the following new requirements:\r\n \r\n  Once the user has guessed the target number correctly, you should display a \"report\" to them on their performance. This report should provide the following information:\r\n	- The target number\r\n	- The number of guesses it took the user to guess the target number\r\n	- A list of all the valid values guessed by the user in the order in which they were guessed.\r\n	- A calculated value called \"Cumulative error\". Cumulative error is defined as the sum of the absolute value of the difference between the target number and the values guessed. For example : if the target number was 30 and the user guessed 50, 25, 35, and 30, the cumulative error would be calculated as follows:\r\n\r\n	|50-30| + |25-30| + |35-30| + |30-30| = 35\r\n\r\n	Hint: See [Abs method](http://www.w3schools.com/jsref/jsref_abs.asp \"Abs method\") for assistance\r\n	- A calculated value called \"Average Error\" which is calculated as follows: cumulative error / number of valid guesses. Using the above number set, the average error is 8.75.\r\n	- A text feedback response based on the following rules:\r\n	- If average error is 10.0 or lower, the message \"Incredible guessing!\"\r\n	- If average error is higher than above but under 20.0, \"Good job!\"\r\n	- If average error is higher than 20 but under 30.0, \"Fair!\"\r\n	- Anything other score: \"You are horrible at this game!\"','2014-07-29 21:27:10','2016-12-22 07:43:49'),(261,'TDD Beyond Basics : How to Use Fakes to Speed Up Tests','Objective\r\n=========\r\n----------\r\n\r\n- To learn how to use fakes to speed up tests.\r\n\r\nDiscussion\r\n==========\r\n---------------\r\n\r\nLet\'s write a program that ignores comments in the ruby program file and reads only statements that is not a comment.\r\n  \r\nThe Ugly Before Version\r\n========================\r\n------------------------\r\n\r\nThis version is stolen from : The Well Grounded Rubyist by David Black. Given a test_file.rb with the following contents :\r\n\r\n```ruby\r\n# This is a comment\r\nThis is not a comment\r\n# Another comment\r\n```\r\n\r\nWe want to read only the line \'This is not a comment\'. Here is the uncommenter_spec.rb:\r\n\r\n```ruby\r\nrequire_relative \'uncommenter\'\r\n\r\ndescribe Uncommenter do\r\n  it \"should uncomment a given file\" do\r\n    infile = File.new(Dir.pwd + \"/uncommenter/test_file.rb\")\r\n    outfile = File.new(Dir.pwd + \"/uncommenter/test_file.rb.out\", \"w\")\r\n    \r\n    Uncommenter.uncomment(infile, outfile)\r\n    outfile.close\r\n    \r\n    resultfile = File.open(Dir.pwd + \"/uncommenter/test_file.rb.out\",\"r\")\r\n    result_string = resultfile.read\r\n    result_string.should == \"This is not a comment\\n\"\r\n    resultfile.close\r\n  end\r\nend\r\n```\r\n\r\nHere is the uncommenter.rb\r\n\r\n```ruby\r\nclass Uncommenter\r\n  def self.uncomment(infile, outfile)\r\n    infile.each do |line|\r\n      outfile.print line unless line =~ /\\A\\s*#/\r\n    end\r\n  end\r\nend\r\n```\r\n\r\nThis works but it requires manual deleting of the file test_file.rb.out after test run. You could delete it at the end of the test. That does not change the fact that whenever you access a file system, it\'s not a unit test anymore. It will run slow. It becomes an integration test and requires setup and cleanup of external resources. \r\n\r\nThe Sexy After Version\r\n======================\r\n----------------------\r\n\r\nHere is the uncommenter_spec.rb that runs fast:\r\n\r\n```ruby\r\nrequire_relative \'uncommenter\'\r\nrequire \'stringio\'\r\n\r\ndescribe Uncommenter do\r\n  it \"should uncomment a given file\" do\r\n    input = <<-EOM\r\n    # This is a comment.\r\n      This is not a comment.\r\n    # This is another comment\r\n    EOM\r\n    infile = StringIO.new(input)\r\n    outfile = StringIO.new(\"\")\r\n    \r\n    Uncommenter.uncomment(infile, outfile)\r\n    \r\n    result_string = outfile.string\r\n    result_string.strip.should == \"This is not a comment.\"\r\n  end\r\nend\r\n```\r\n\r\nThis example illustrates using Ruby builtin StringIO as a Fake object. A better name for StringIO is VirtualFile. File accessing is involved. It requires the right read or write mode. It also requires closing and opening the file at the appropriate times. \r\n\r\nStringIO is a ruby builtin class that mimics the interface of the file. This version of spec runs faster than the file accessing version. The spec is also smaller. In this case, StringIO is a real object acting as a Fake object. You don\'t have to manually write and maintain a Fake object for file processing. Just use the StringIO.\r\n\r\nRun the spec as follows:\r\n\r\n```ruby\r\nrspec uncommenter/uncommenter_spec.rb --format doc --color\r\n```\r\n\r\nSummary\r\n=========\r\n---------\r\n\r\nIn this article you learned about using Ruby\'s builtin StringIO as a Fake object for any file accessing operations. Since StringIO mimics the file interface we were able to use it to avoid accessing the file system and we were able to speed up the test.\r\n\r\nThis concept can be used for writing tests that needs to access external systems. Ideally the external service provider like Twitter, Stripe etc must provide us a Fake version of their API that it can be used in our tests. Our tests will not have to go over the network and it will run very fast. It should be the responsibility of the vendors to maintain the Fake implementation for different versions of their API.','2014-07-29 21:28:12','2014-09-11 06:29:57'),(271,'TDD Advanced Concepts : Test Spy','Objective\r\n=========\r\n----------\r\n\r\n- Learn how to use stubs with Test Spy in Ruby.\r\n\r\nDiscussion\r\n==============\r\n---------------\r\n\r\nI came across a problem during testing. I had to test the cookie setting logic of my controllers. It was straightforward to test that the cookie was set for the happy path. For the alternative scenario it became tricky to test because RSpec and Rails framework did not play well together. I even read Devise Rails plugin code to see how Jose Valim handled cookie related problems during testing. No luck. One solution I found was on Stackoverflow: How do I test cookie expiry?\r\n  \r\nHere is the app/controllers/widget_controller.rb\r\n\r\n```ruby\r\ndef index\r\n    cookies[:expiring_cookie] = { :value   => \'All that we see or seem...\', \r\n                                  :expires => 1.hour.from_now }\r\nend\r\n```\r\n\r\nHere is the spec/controllers/widget_controller_spec.rb\r\n\r\n```ruby\r\nit \"sets the cookie\" do\r\n  get :index\r\n  response.cookies[\'expiring_cookie\'].should eq(\'All that we see or seem...\')\r\nend\r\n\r\nit \"sets the cookie expiration\" do\r\n  stub_cookie_jar = HashWithIndifferentAccess.new\r\n  controller.stub(:cookies) { stub_cookie_jar }\r\n\r\n  get :index\r\n  expiring_cookie = stub_cookie_jar[\'expiring_cookie\']\r\n  expiring_cookie[:expires].to_i.should be_within(1).of(1.hour.from_now.to_i)\r\nend\r\n```\r\n\r\nThis technique is a great example of Test Spy described in Gerard Meszaros book, xUnit Test Patterns. Basically, you install a spy and check the results collected by the test spy in the verification phase. In this case the Hash is the Test Spy that collects data. See how the stub is used to install the spy in the SUT? It overcomes the problems and isolates the SUT from the Rails framework and allows the code to be tested easily. \r\n\r\nIn my TDD bootcamps, the topic on Stubs and Mocks generates lot of discussion. To clear confusion that surrounds the stubs and mocks, I would tell them to read Martin Fowler\'s paper on Mocks Aren\'t Stubs. You can read the concise version of that paper [Mocks Aren\'t Stubs](http://www.rubyplus.com/articles/401 \"Mocks Are Not Stubs\").\r\n\r\nStub can never fail your test, only mocks can fail your test. Using stubs in combination with a spy like this makes stubs seem like they can in fact fail your test. But only the data collected by the Test Spy decides whether the test passes or not. So the stub\'s main purpose is to just isolate the production code from Rails framework and allow access to the internal state of the SUT when there is no direct way to access it.\r\n\r\n','2014-07-29 21:29:07','2014-08-14 06:21:57'),(281,'TDD Advanced Concepts : Command Query Separation Principle','Objectives\r\n=========\r\n---------------------\r\n\r\n- How to fix violation of Command Query Separation principle?\r\n- How to fix abuse of mocks?\r\n- How to write focused tests? \r\n- How to deal with external dependencies in your domain code?\r\n\r\nSide Effect\r\n=============\r\n-------------\r\n\r\nA function or expression modifies some state or has an observable interaction with calling functions or the outside world in addition to returning a value. For example, a function might modify a global or static variable, modify one of its arguments, raise an exception, write data to a display or file, read data, or call other side-effecting functions. In the presence of side effects, a program\'s behavior depends on history; that is, the order of evaluation matters. Understanding a program with side effects requires knowledge about the context and its possible histories; and is therefore hard to read, understand and debug.\r\n\r\nSide effects are the most common way to enable a program to interact with the outside world (people, file systems, other computers on networks). But the degree to which side effects are used depends on the programming paradigm. Imperative programming is known for its frequent utilization of side effects. In functional programming, side effects are rarely used. \r\n\r\nSource: Wikipedia\r\n\r\nRails Example\r\n=============\r\n-------------\r\n\r\nBefore\r\n--------\r\n\r\nHere is an example of a badly designed API that violates command query separation principle:\r\n\r\n```ruby\r\nuser = User.new(params)\r\n\r\nif user.save\r\n  do something\r\nelse\r\n  do something else\r\nend\r\n```\r\n\r\nThe save is inserting the record in the database. It is a command because it has a side effect. It is also returning true or false, so it is also a query.\r\n\r\nAfter\r\n-------\r\n\r\n```ruby\r\nuser = User.new(params)\r\nuser.save\r\n\r\nif user.persisted?\r\n  do something\r\nelse\r\n  do something else\r\nend\r\n```\r\n\r\nCalculator Example\r\n==================\r\n------------------\r\n\r\nBefore\r\n-------\r\n\r\nLet\'s look at the calculator example that violates command query separation principle. Here is the `calculator_spec.rb`:\r\n\r\n```ruby\r\nrequire_relative \'calculator\'\r\n\r\ndescribe Calculator, \"Computes addition of given two numbers\" do\r\n  \r\n  it \"should add given two numbers that are not trivial\" do\r\n    calculator = Calculator.new\r\n    result = calculator.add(1,2)\r\n    \r\n    expect(result).to eq(3)\r\n  end\r\nend\r\n```\r\n\r\nHere is the calculator.rb\r\n\r\n```ruby\r\nclass Calculator\r\n  def add(x,y)\r\n    x+y\r\n  end\r\nend\r\n```\r\n\r\nAfter\r\n-------\r\n\r\nThis version fixes the command query separation violation. Here is the `calculator_spec.rb`:\r\n\r\n```ruby\r\nrequire_relative \'calculator\'\r\n\r\ndescribe Calculator, \"Computes addition of given two numbers\" do\r\n  it \"should add given two numbers that are not trivial\" do\r\n    calculator = Calculator.new\r\n    calculator.add(1,2) \r\n    result = calculator.result\r\n    \r\n    expect(result).to eq(3)\r\n  end\r\nend\r\n```\r\n\r\nThe add(x,y) method is a command. The calculator.result call is a query. Here is the calculator.rb\r\n\r\n```ruby\r\nclass Calculator\r\n  attr_reader :result\r\n  \r\n  def add(x,y)\r\n    @result = x + y\r\n    nil\r\n  end  \r\nend\r\n```\r\n\r\nWe have two choices : we can either return nil or the client can ignore the return value. If the API is for the public then returning nil explicitly will force the client to obey the CQS principle. If it is within a small team we can get away with ignoring the return value and making sure we obey the CQS principle.\r\n\r\nTweet Analyser Example\r\n======================\r\n----------------------\r\n\r\nThis is another example that violates Command Query Separation Principle. This is actually published by the Pragmatic Programmer\'s book on testing. If an author can write bad code like this then it is easy for other developers to write similar smelling code. \r\n\r\nBefore\r\n-------\r\n\r\nVersion 1 - `tweet_analyser_spec.rb` as found in the Pragmatic Programmer\'s book on testing:\r\n\r\n```ruby\r\nclass TweetAnalyzer\r\n  def initialize(user)\r\n    @user = user\r\n  end\r\n  def word_frequency\r\n    {\"one\" => 1}\r\n  end  \r\nend\r\n\r\ndescribe TweetAnalyzer do\r\n  it \"finds the frequency of words in a user\'s tweets\" do\r\n    user = double(\'user\')\r\n    analyzer = TweetAnalyzer.new(user)\r\n    histogram = analyzer.word_frequency\r\n    histogram[\"one\"].should == 1\r\n  end\r\nend\r\n```\r\n\r\nIt looks like client is tied to the implementation details (it is accessing a data structure) but it is actually any class that can respond to [] method. The command `word_frequency` is not only calculating the frequency but also returns a result.\r\n\r\nAfter\r\n-------\r\n\r\nVersion 2 - `tweet_analyser_spec.rb`:\r\n\r\n```ruby\r\nclass TweetAnalyzer\r\n  attr_reader :histogram\r\n  \r\n  def initialize(user)\r\n    @user = user\r\n  end  \r\n  def word_frequency\r\n    @histogram = {\"one\" => 1}\r\n  end  \r\nend\r\n\r\ndescribe TweetAnalyzer do\r\n  it \"finds the frequency of words in a user\'s tweets\" do\r\n    user = double(\'user\')\r\n    analyzer = TweetAnalyzer.new(user)\r\n    analyzer.word_frequency\r\n    \r\n    analyzer.histogram[\"one\"].should == 1\r\n  end\r\nend\r\n```\r\n\r\nIn this version, the command `word_frequency()` does not return a result. Is executes the logic to calculate word frequency. The histogram is now an exposed attribute that returns word frequency. So the command and query has been separated.\r\n\r\nVersion 3\r\n------------\r\n\r\nLet\'s add a second spec that will force us to replace the fake implementation with a real one.\r\n\r\n```ruby\r\nit \"should return 2 as the frequency for the word two\" do\r\n  expected_tweets = [\"one two\", \"two\"]\r\n  user = double(\'user\')\r\n  user.should_receive(:recent_tweets).and_return expected_tweets\r\n  analyzer = TweetAnalyzer.new(user)\r\n\r\n  analyzer.word_frequency  \r\n\r\n  analyzer.histogram[\"two\"].should == 2\r\nend\r\n```\r\n\r\nThis fails with the error:\r\n\r\n```ruby\r\n  1) TweetAnalyzer asks the user for recent tweets\r\n     Failure/Error: analyzer.histogram[\"two\"].should == 2\r\n       expected: 2\r\n            got: nil (using ==)\r\n     # ./tweet_analyzer_spec.rb:28:in `block (2 levels) in <top (required)>\'\r\n\r\nFinished in 0.00128 seconds\r\n2 examples, 1 failure\r\n```\r\n\r\nLet\'s now implement the `word_frequency` for real. Change the `word_frequency` implementation like this:\r\n\r\n```ruby\r\nclass TweetAnalyzer\r\n  # rest of the code same as before\r\n  def word_frequency\r\n    @histogram = Hash.new{0}\r\n    @user.recent_tweets.each do |tweet|\r\n      tweet.split(/\\s/).each do |word|\r\n        @histogram[word] += 1\r\n      end\r\n    end\r\n  end  \r\nend\r\n```\r\n\r\nRun the spec:\r\n\r\n```ruby\r\n$rspec tweet_analyzer_spec.rb --color --format documentation\r\n```\r\n\r\nWe get the failure message:\r\n\r\n```ruby\r\nTweetAnalyzer\r\n  finds the frequency of words in a user\'s tweets (FAILED - 1)\r\n  should return 2 as the frequency for the word two\r\n\r\nFailures:\r\n  1) TweetAnalyzer finds the frequency of words in a user\'s tweets\r\n     Failure/Error: @user.recent_tweets.each do |tweet|\r\n       Double \"user\" received unexpected message :recent_tweets with (no args)\r\n     # ./tweet_analyzer_spec.rb:10:in `word_frequency\'\r\n     # ./tweet_analyzer_spec.rb:22:in `block (2 levels) in <top (required)>\'\r\n\r\nFinished in 0.00132 seconds\r\n2 examples, 1 failure\r\n\r\nFailed examples:\r\n\r\nrspec ./tweet_analyzer_spec.rb:19 # TweetAnalyzer finds the frequency of words in a user\'s tweets\r\n```\r\n\r\nWe see that the second spec passed but now our first spec is broken. Let\'s fix this broken spec.\r\n\r\nVersion 4\r\n--------------\r\n\r\nChange the first spec in `tweet_analyzer_spec.rb` like this:\r\n\r\n```ruby\r\ndescribe TweetAnalyzer do\r\n  it \"finds the frequency of words in a user\'s tweets\" do\r\n    expected_tweets = [\"one two\", \"two\"]\r\n    user = double(\'user\')\r\n    user.stub(:recent_tweets).and_return expected_tweets\r\n    analyzer = TweetAnalyzer.new(user)\r\n    analyzer.word_frequency\r\n   \r\n    analyzer.histogram[\"one\"].should == 1\r\n   end\r\n   # same code as before\r\nend\r\n```\r\n\r\nNow both the specs pass. Note that we were able to make our tests pass without using a real user object. Our focus is only on testing the word frequency calculation not the user. User is a collaborator that the TweetAnalyzer interacts with to fulfill it\'s responsibility of frequency calculation. \r\n\r\nWe still have mocking going on in the second spec. Why should we care that `recent_tweets` method gets called on the user? We don\'t care about this in the second spec because our focus is not asserting on the outgoing message to the user collaborator object. This is an example of how mocks are abused. In this case mock is used instead of stub. Let\'s fix this in the second spec like this:\r\n\r\n```ruby\r\nit \"should return 2 as the frequency for the word two\" do\r\n  expected_tweets = [\"one two\", \"two\"]\r\n  user = double(\'user\')\r\n  user.stub(:recent_tweets).and_return expected_tweets\r\n  analyzer = TweetAnalyzer.new(user)\r\n\r\n  analyzer.word_frequency  \r\n\r\n  analyzer.histogram[\"two\"].should == 2\r\nend\r\n```\r\n\r\nThis solution does not use mocking. It uses a user stub to enable the tests to run. This fixes abuse of mocks.\r\n\r\nVersion 5\r\n------------\r\n\r\nLet\'s extract common setup to before() method.\r\n\r\ntweet_analyzer_spec.rb\r\n\r\n```ruby\r\nclass TweetAnalyzer\r\n  attr_reader :histogram\r\n  \r\n  def initialize(user)\r\n    @user = user\r\n  end  \r\n  def word_frequency\r\n    @histogram = Hash.new{0}\r\n    @user.recent_tweets.each do |tweet|\r\n      tweet.split(/\\s/).each do |word|\r\n        @histogram[word] += 1\r\n      end\r\n    end\r\n  end\r\nend\r\n\r\ndescribe TweetAnalyzer do\r\n  before do\r\n    expected_tweets = [\"one two\", \"two\"]\r\n    @user = double(\'user\')\r\n    @user.stub(:recent_tweets).and_return expected_tweets    \r\n  end  \r\n  it \"finds the frequency of words in a user\'s tweets\" do\r\n    analyzer = TweetAnalyzer.new(@user)\r\n\r\n    analyzer.word_frequency\r\n    \r\n    analyzer.histogram[\"one\"].should == 1\r\n  end\r\n  it \"should return 2 as the frequency for the word two\" do\r\n    analyzer = TweetAnalyzer.new(@user)\r\n\r\n    analyzer.word_frequency  \r\n\r\n    analyzer.histogram[\"two\"].should == 2\r\n  end\r\n    \r\nend\r\n```\r\n\r\nWe were green before and after refactoring.\r\n\r\nVersion 6\r\n-----------\r\n\r\nFocused spec test only one thing. If it is important that the user\'s recent tweets are used to calculate the frequency, write a separate test for that: `tweet_analyzer_spec.rb`:\r\n\r\n```ruby\r\ndescribe TweetAnalyzer do\r\n  ...  \r\n  it \"asks the user for recent tweets\" do    \r\n    expected_tweets = [\"one two\", \"two\"]\r\n    user = double(\'user\')\r\n    user.should_receive(:recent_tweets).and_return expected_tweets\r\n    \r\n    analyzer = TweetAnalyzer.new(user)\r\n    analyzer.word_frequency\r\n  end  \r\nend\r\n```\r\n\r\nIn this case we are only interested in asserting on the message sent to the collaborating user object. We are not asserting on the state like the first two specs.\r\n\r\nVersion 7\r\n----------\r\n\r\nHere is the refactored version of `tweet_analyzer_spec.rb`:\r\n\r\n```ruby\r\nrequire_relative \'tweet_analyzer\'\r\n\r\ndescribe TweetAnalyzer do\r\n  context \'Calculate word frequency\' do\r\n    before do\r\n      expected_tweets = [\"one two\", \"two\"]\r\n      @user = double(\'user\')\r\n      @user.stub(:recent_tweets).and_return expected_tweets    \r\n    end\r\n\r\n    it \"finds the frequency of words in a user\'s tweets\" do\r\n      analyzer = TweetAnalyzer.new(@user)\r\n\r\n      analyzer.word_frequency\r\n\r\n      analyzer.histogram[\"one\"].should == 1\r\n    end\r\n\r\n    it \"should return 2 as the frequency for the word two\" do\r\n      analyzer = TweetAnalyzer.new(@user)\r\n\r\n      analyzer.word_frequency  \r\n\r\n      analyzer.histogram[\"two\"].should == 2\r\n    end    \r\n  end\r\n  \r\n  context \'Collaboration with User\' do\r\n    it \"asks the user for recent tweets\" do    \r\n      expected_tweets = [\"one two\", \"two\"]\r\n      user = double(\'user\')\r\n      user.should_receive(:recent_tweets).and_return expected_tweets\r\n\r\n      analyzer = TweetAnalyzer.new(user)\r\n      analyzer.word_frequency\r\n    end    \r\n  end\r\nend\r\n```\r\n\r\n`tweet_analyzer.rb` remains unchanged:\r\n\r\n```ruby\r\nclass TweetAnalyzer\r\n  attr_reader :histogram\r\n  \r\n  def initialize(user)\r\n    @user = user\r\n  end  \r\n  def word_frequency\r\n    @histogram = Hash.new{0}\r\n    @user.recent_tweets.each do |tweet|\r\n      tweet.split(/\\s/).each do |word|\r\n        @histogram[word] += 1\r\n      end\r\n    end\r\n  end\r\nend\r\n```\r\n\r\nAgain we are green before and after refactoring. So when do we stub and when do we mock? We can use the Command Query Separation Principle in conjunction with a simple guideline : Stub queries and mock commands. Ideal design will not stub and mock at the same time, since it will violate Command Query Separation Principle. See appendix of [Essential TDD book](http://www.rubyplus.com/etdd.pdf \"Essential TDD\") for notes from Martin Fowler\'s article and jMock Home Page.\r\n','2014-07-29 21:29:56','2016-12-22 07:48:16'),(291,'TDD Advanced Concepts : Angry Rock Kata','Objectives\r\n============\r\n------------\r\n\r\n- What is Command Query Separation Principle?\r\n- How to fix Command Query Separation violation?\r\n- Refactoring : Retaining the old interface and the new one at the same time to avoid old tests from failing.\r\n- Semantic quirkiness of Well Grounded Rubyist book solution exposed by specs.\r\n- Using domain specific terms to make the code expressive\r\n\r\nDifficulty Level\r\n=========\r\n----------------\r\n\r\nMedium\r\n\r\nCommand Query Separation Principle\r\n=========\r\n----------------\r\n \r\nThe term \'command query separation\' was coined by Bertrand Meyer in his book \"Object Oriented Software Construction\". The fundamental idea is that we should divide an object\'s methods into two categories:\r\n\r\n    Queries: Return a result and do not change the observable state of the system (are free of side effects).\r\n    Commands: Change the state of a system but do not return a value.\r\n\r\nBecause the term \'command\' is widely used in other contexts, Martin Fowler refers to it as \'modifiers\' and \'mutators\'. It\'s useful if you can clearly separate methods that change state from those that don\'t. This is because you can use queries in many situations with much more confidence, changing their order. You have to be careful with modifiers.\r\n\r\nThe return type is the give-away for the difference. It\'s a good convention because most of the time it works well. Consider iterating through a collection in Java: the next method both gives the next item in the collection and advances the iterator. It\'s preferable to separate advance and current methods. There are exceptions. Popping a stack is a good example of a modifier that modifies state. Meyer correctly says that you can avoid having this method, but it is a useful idiom. Follow this principle when you can.\r\n\r\nSource : [Command Query Separation] (http://martinfowler.com/bliki/CommandQuerySeparation.html \'Command Query Separation\') by Martin Fowler.\r\n\r\nTesting and Command Query Separation Principle\r\n=========\r\n---------------------\r\n\r\nTests are kept flexible when we follow this rule of thumb: Stub queries and expect commands, where a query is a method with no side effects that does nothing but query the state of an object and a command is a method with side effects that may, or may not, return a result. Of course, this rule does not hold all the time, but it\'s a useful starting point.\r\n\r\nSource : [jMock Home Page] (http://jmock.org \'jMock Home Page\')\r\n\r\nViolation of Command Query Separation Principle\r\n==========================================\r\n------------------\r\n\r\nSteps\r\n=========\r\n---------\r\n\r\nStep 1\r\n-----------\r\n\r\nCreate `angry_rock_spec.rb` with the following contents:\r\n\r\n```ruby\r\nrequire_relative \'angry_rock\'\r\n\r\nmodule Game\r\n  describe AngryRock do\r\n   it \"should pick paper as the winner over rock\" do\r\n     choice_1 = Game::AngryRock.new(:paper)\r\n     choice_2 = Game::AngryRock.new(:rock)\r\n     winner = choice_1.play(choice_2)\r\n     result = winner.move\r\n     \r\n     expect(result).to eq(:paper)\r\n   end    \r\n  end\r\nend\r\n```\r\n\r\nStep 2\r\n----------\r\n\r\nCreate `angry_rock.rb` with the following contents:\r\n\r\n```ruby\r\nmodule Game\r\n  class AngryRock\r\n    \r\n  end\r\nend\r\n```\r\n\r\nStep 3\r\n-----------\r\n\r\nRun the spec and watch it fail:\r\n\r\n```ruby\r\n$rspec angry_rock_spec.rb --color --format doc\r\n\r\nGame::AngryRock\r\n  should pick paper as the winner over rock (FAILED - 1)\r\nFailures:\r\n  1) Game::AngryRock should pick paper as the winner over rock\r\n     Failure/Error: choice_1 = Game::AngryRock.new(:paper)\r\n     ArgumentError:\r\n       wrong number of arguments(1 for 0)\r\n```\r\n\r\nStep 4\r\n-----------\r\n\r\nLet\'s get past this error by changing the `angry_rock.rb` as follows:\r\n\r\n```ruby\r\nmodule Game\r\n  class AngryRock\r\n    def initialize(move)\r\n      @move = move\r\n    end\r\n  end\r\nend\r\n```\r\n\r\nNow we get the error:\r\n\r\n```ruby\r\n1) Game::AngryRock should pick paper as the winner over rock\r\n   Failure/Error: winner = choice_1.play(choice_2)\r\n   NoMethodError:\r\n     undefined method `play\' for #<Game::AngryRock:0xb0 @move=:paper>\r\n```\r\n\r\nStep 5\r\n------------\r\n\r\nSo, let\'s define a empty play method as follows:\r\n\r\n```ruby\r\nmodule Game\r\n  class AngryRock\r\n    # other code same as before\r\n    def play\r\n      \r\n    end\r\n  end\r\nend\r\n```\r\n\r\nStep 6\r\n-----------\r\n\r\nNow we get:\r\n\r\n```ruby\r\n1) Game::AngryRock should pick paper as the winner over rock\r\n   Failure/Error: winner = choice_1.play(choice_2)\r\n   ArgumentError:\r\n     wrong number of arguments (1 for 0)\r\n```\r\n\r\nStep 7\r\n----------\r\n\r\nChange the play method signature like this:\r\n\r\n```ruby\r\ndef play(other)\r\n  \r\nend\r\n```\r\n\r\nStep 8\r\n------------\r\n\r\nNow we get:\r\n\r\n```ruby\r\n1) Game::AngryRock should pick paper as the winner over rock\r\n    Failure/Error: result = winner.move\r\n    NoMethodError:\r\n      undefined method `move\' for nil:NilClass\r\n```\r\n\r\nStep 9\r\n----------\r\n\r\nChange the play method like this:\r\n\r\n```ruby\r\ndef play(other)\r\n  self\r\nend\r\n```\r\n\r\nStep 10\r\n-----------\r\n\r\n```ruby\r\n1) Game::AngryRock should pick paper as the winner over rock\r\n    Failure/Error: result = winner.move\r\n    NoMethodError:\r\n      undefined method `move\' for #<Game::AngryRock:0xd8 @move=:paper>\r\n```\r\n\r\nStep 11\r\n----------\r\n\r\nChange the `angry_rock.rb` as follows:\r\n\r\n```ruby\r\nmodule Game\r\n  class AngryRock\r\n    attr_accessor :move\r\n    \r\n    # rest of the code same as before \r\n  end\r\nend\r\n```\r\n\r\nStep 12\r\n----------\r\n\r\nThe first spec now passes. Add the second spec:\r\n\r\n```ruby\r\nit \"picks scissors as the winner over paper\" do\r\n  choice_1 = Game::AngryRock.new(:scissors)\r\n  choice_2 = Game::AngryRock.new(:paper)\r\n  winner = choice_1.play(choice_2)\r\n  result = winner.move\r\n  \r\n  result.should == :scissors   \r\nend\r\n```\r\n\r\nStep 13\r\n----------\r\n\r\nIt passes immediately. Make it fail by mutating the `angry_rock.rb` like this:\r\n\r\n```ruby\r\nmodule Game\r\n  class AngryRock\r\n    # other code same as before\r\n    def play(other)\r\n      return other if other.move == :paper\r\n      self\r\n    end\r\n  end\r\nend\r\n```\r\n\r\nIt now fails with :\r\n\r\n```ruby\r\n1) Game::AngryRock picks scissors as the winner over paper\r\n   Failure/Error: result.should == :scissors\r\n     expected: :scissors\r\n          got: :paper (using ==)\r\n```\r\n\r\nStep 14\r\n-------\r\n\r\nRemove the short circuit statement:      \r\n\r\n```ruby\r\nreturn other if other.move == :paper \r\n```\r\n\r\nfrom `angry_rock.rb`. The spec will now pass.\r\n\r\nStep 15\r\n----------\r\n\r\nLet\'s add the third spec:\r\n\r\n```ruby\r\nit \"picks rock as the winner over scissors \" do\r\n  choice_1 = Game::AngryRock.new(:rock)\r\n  choice_2 = Game::AngryRock.new(:scissors)\r\n  winner = choice_1.play(choice_2)\r\n  result = winner.move\r\n  \r\n  expect(result).to eq(:rock)  \r\nend\r\n```\r\n\r\nStep 16\r\n----------\r\n\r\nThis spec also passes without failing. Add a short circuit statement for the third spec and make the test fail and then make it pass again.\r\n\r\nStep 17\r\n----------\r\n\r\nLet\'s now add the spec for the tie case:\r\n\r\n```ruby\r\nit \"results in a tie when both players pick rock\" do\r\n  choice_1 = Game::AngryRock.new(:rock)\r\n  choice_2 = Game::AngryRock.new(:rock)\r\n  winner = choice_1.play(choice_2)\r\n  result = winner.move\r\n\r\n  winner.should be_false\r\nend\r\n```\r\n\r\nStep 18\r\n----------\r\n\r\nThis fails with the error:\r\n\r\n```ruby\r\n1) Game::AngryRock results in a tie when both players pick rock\r\n   Failure/Error: winner.should be_false\r\n     expected: false value\r\n          got: #<Game::AngryRock:0xc0 @move=:rock>\r\n```\r\n\r\nStep 19\r\n----------\r\n\r\nChange the implementation of play method like this:\r\n\r\n```ruby\r\ndef play(other)\r\n  return false if self.move == other.move\r\n  self\r\nend\r\n```\r\n\r\nDiscussion\r\n===========\r\n-----------\r\n\r\nNow all the specs will pass. This implementation of play method is a lousy design. The false case breaks the consistency of the returned value and violates the semantics of the API. Also the play method is a “Command” not a “Query”. This method violates the Command Query Separation Principle.\r\n\r\n![alt text](https://images.rubyplus.com/angry-rock.jpg \"Angry Rock\")\r\n\r\nFixing the Bad Design\r\n=====================\r\n-----------------------\r\n\r\nStep 1\r\n----------\r\n\r\nChange the spec for tie case to:\r\n\r\n```ruby\r\nit \"results in a tie when both players pick rock\" do\r\n  choice_1 = Game::AngryRock.new(:rock)\r\n  choice_2 = Game::AngryRock.new(:rock)\r\n  winner = choice_1.play(choice_2)\r\n  result = winner.move\r\n    \r\n  expect(result).to eq(\"TIE!\") \r\nend\r\n```\r\n\r\nStep 2\r\n----------\r\n\r\nThis fails with the error:\r\n\r\n```ruby\r\n1) Game::AngryRock results in a tie when both players pick rock\r\n   Failure/Error: result = winner.move\r\n   NoMethodError:\r\n     undefined method `move\' for false:FalseClass\r\n```\r\n\r\nStep 3\r\n----------\r\n\r\nChange the implementation of the play method as follows:\r\n\r\n```ruby\r\ndef play(other)\r\n  return AngryRock.new(\"TIE!\") if self.move == other.move\r\n  self\r\nend\r\n```\r\n\r\nStep 4\r\n----------\r\n\r\nNow all specs pass. The play method now returns a AngryRock tie object for the tie case. \r\n\r\nStep 5\r\n----------\r\n\r\nAdd two more specs for the remaining tie cases one by one. \r\n\r\n```ruby\r\nit \"results in a tie when both players pick paper\" do\r\n  choice_1 = Game::AngryRock.new(:paper)\r\n  choice_2 = Game::AngryRock.new(:paper)\r\n  winner = choice_1.play(choice_2)\r\n  result = winner.move\r\n    \r\n  expect(result).to eq(\"TIE!\")      \r\nend\r\n\r\nit \"results in a tie when both players pick scissors\" do\r\n  choice_1 = Game::AngryRock.new(:scissors)\r\n  choice_2 = Game::AngryRock.new(:scissors)\r\n  winner = choice_1.play(choice_2)\r\n  result = winner.move\r\n    \r\n  expect(result).to eq(\"TIE!\")      \r\nend\r\n```\r\n\r\nStep 6\r\n----------\r\n\r\nMake them fail and then make it pass one by one. The last three specs show three possible tie scenarios.\r\n\r\nRemoving the Duplication in Specs\r\n===============\r\n---------------\r\n\r\nThe Before Picture\r\n-------------------\r\n\r\n```ruby\r\nit \"results in a tie when the same choice is made by both players\" do\r\n  [:rock, :paper, :scissors].each do |choice|\r\n    choice_1 = Game::AngryRock.new(choice)\r\n    choice_2 = Game::AngryRock.new(choice)\r\n    winner = choice_1.play(choice_2)\r\n    result = winner.move\r\n    \r\n    expect(result).to eq(\"TIE!\")      \r\n  end     \r\nend   \r\n```\r\n\r\nThe duplication in specs is removed by using a loop. We can do better than that, let\'s apply what we learned in Eliminating Loops chapter.\r\n\r\nThe After Picture\r\n----------------\r\n\r\nStep 1\r\n----------\r\n\r\nReplace the loop version of the tie case with the following spec:\r\n\r\n```ruby\r\nit \"results in a tie when the same choice is made by both players\" do\r\n  data_driven_spec([:rock, :paper, :scissors]) do |choice|\r\n    choice_1 = Game::AngryRock.new(choice)\r\n    choice_2 = Game::AngryRock.new(choice)\r\n    winner = choice_1.play(choice_2)\r\n    result = winner.move\r\n    \r\n    expect(result).to eq(\"TIE!\")      \r\n  end     \r\nend   \r\n```\r\n\r\nStep 2\r\n----------\r\n\r\nAdd a helper method in `spec_helper.rb`:\r\n\r\n```ruby\r\ndef data_driven_spec(container)\r\n  container.each do |element|\r\n   yield element\r\n  end\r\nend\r\n```\r\n\r\nStep 3\r\n----------\r\n\r\nAdd :\r\n\r\n```ruby\r\nrequire_relative \'spec_helper\'\r\n```\r\n\r\nto the top of the `angry_rock_spec.rb`.\r\n\r\nStep 4\r\n----------\r\n\r\nNow all the specs should still pass. Let\'s now improve the design. \r\n\r\nStep 5\r\n----------\r\n\r\nTo make the specs more readable change specs and production code as follows:\r\n\r\n```ruby\r\nrequire_relative \'angry_rock\'\r\nrequire_relative \'spec_helper\'\r\n\r\nmodule AngryRock\r\n  describe Choice do\r\n   it \"picks paper as the winner over rock\" do\r\n     choice_1 = AngryRock::Choice.new(:paper)\r\n     choice_2 = AngryRock::Choice.new(:rock)\r\n     winner = choice_1.play(choice_2)\r\n     result = winner.move\r\n     \r\n     expect(result).to eq(:paper)      \r\n   end    \r\n   it \"picks scissors as the winner over paper\" do\r\n     choice_1 = AngryRock::Choice.new(:scissors)\r\n     choice_2 = AngryRock::Choice.new(:paper)\r\n     winner = choice_1.play(choice_2)\r\n     result = winner.move\r\n     \r\n     expect(result).to eq(:scissors)      \r\n   end\r\n   it \"picks rock as the winner over scissors \" do\r\n     choice_1 = AngryRock::Choice.new(:rock)\r\n     choice_2 = AngryRock::Choice.new(:scissors)\r\n     winner = choice_1.play(choice_2)\r\n     result = winner.move\r\n     \r\n     expect(result).to eq(:rock)  \r\n   end\r\n   it \"results in a tie when the same choice is made by both players\" do\r\n     data_driven_spec([:rock, :paper, :scissors]) do |choice|\r\n       choice_1 = AngryRock::Choice.new(choice)\r\n       choice_2 = AngryRock::Choice.new(choice)\r\n       winner = choice_1.play(choice_2)\r\n       result = winner.move\r\n\r\n       expect(result).to eq(\"TIE!\")\r\n     end     \r\n   end   \r\n  end\r\nend\r\n\r\nmodule AngryRock \r\n  class Choice\r\n    attr_accessor :move\r\n    \r\n    def initialize(move)\r\n      @move = move\r\n    end\r\n    def play(other)\r\n      return Choice.new(\"TIE!\") if self.move == other.move\r\n      self\r\n    end    \r\n  end\r\nend\r\n```\r\n\r\nThe specs should still pass. The specs now read well and make much more sense than the previous version. Note: Don\'t make changes both to production and test code at the same time without running the tests. Unless you have a good reason, we always run tests after we modify either the specs or the production code.\r\n\r\nViolation of Command Query Separation Principle\r\n==================================\r\n----------------------------------\r\n\r\nIs the play() method a command or a query? It is ambiguous because play() seems to be a name of a command and it is returning the winning AngryRock object (result of a query operation). It combines command and query. \r\n\r\nSteps\r\n=========\r\n---------\r\n\r\nStep 1\r\n----------\r\n\r\nLet\'s refactor while we stay green. What if the specs that we wrote was intelligent enough to use CQS principle like this:\r\n\r\n```ruby\r\nrequire_relative \'angry_rock\'\r\nrequire_relative \'spec_helper\'\r\n\r\nmodule AngryRock\r\n  describe Game do\r\n   it \"should pick paper as the winner over rock\" do\r\n     game = AngryRock::Game.new(:paper, :rock)\r\n     game.play\r\n     winning_move = game.winning_move\r\n     \r\n     expect(winning_move).to eq(:paper)\r\n   end\r\nend\r\n```\r\n\r\nStep 2\r\n----------\r\n\r\nWe create a game object by providing two choices, we play the game by using the command method play and we query the winning_move. Then we make our assertion on the winning move. To make this spec pass, change the implementation of the game as follows:\r\n\r\n```ruby\r\nmodule AngryRock \r\n  class Game\r\n    WINS = {rock: :scissors, scissors: :paper, paper: :rock}\r\n    \r\n    def initialize(choice_1, choice_2)\r\n      @choice_1 = choice_1\r\n      @choice_2 = choice_2\r\n    end\r\n    def play\r\n      @winner = winner\r\n    end\r\n    def winning_move\r\n      @winner\r\n    end\r\n    def winner\r\n      if WINS[@choice_1]\r\n        @choice_1\r\n      else\r\n        @choice_2\r\n      end\r\n    end\r\n  end  \r\nend\r\n```\r\n\r\nStep 3\r\n----------\r\n\r\nLet\'s add the second and third specs and make sure they pass:\r\n\r\n```ruby\r\nit \"picks scissors as the winner over paper\" do\r\n  game = AngryRock::Game.new(:scissors, :paper)\r\n\r\n  game.play\r\n\r\n  winning_move = game.winning_move  \r\n  expect(winning_move).to eq(:scissors)\r\nend\r\n\r\nit \"picks rock as the winner over scissors \" do\r\n  game = AngryRock::Game.new(:rock, :scissors)\r\n\r\n  game.play\r\n\r\n  winning_move = game.winning_move  \r\n  expect(winning_move).to eq(:rock)\r\nend\r\n```\r\n\r\nStep 4\r\n----------\r\n\r\nLet\'s add the tie case spec:\r\n\r\n```ruby\r\nit \"results in a tie when the same choice is made by both players\" do\r\n  data_driven_spec([:rock, :paper, :scissors]) do |choice|\r\n    game = AngryRock::Game.new(choice, choice)\r\n\r\n    game.play\r\n\r\n    winning_move = game.winning_move   \r\n    expect(winning_move).to eq(:tie)    \r\n  end     \r\nend\r\n```\r\n\r\nStep 5\r\n----------\r\n\r\nTo make it pass change the production code as follows:\r\n\r\n```ruby\r\ndef winner\r\n  return :tie if @choice_1 == @choice_2\r\n  if WINS[@choice_1]\r\n    @choice_1\r\n  else\r\n    @choice_2\r\n  end\r\nend\r\n```\r\n\r\nStep 6\r\n----------\r\n\r\nNow all specs should pass. Now the play() is a command and winner() is a query. The command and query are now separated and the code obeys the CQS principle.\r\n\r\nHandling Illegal Inputs\r\n=======================\r\n-----------------------\r\n\r\nSteps\r\n======\r\n---------\r\n\r\nStep 1\r\n----------\r\n\r\nLet\'s make the code robust by checking for illegal inputs. Add the following spec:\r\n\r\n```ruby\r\nit \"should raise exception when illegal input is provided\" do\r\n  expect do\r\n    game = AngryRock::Game.new(:punk, :hunk)\r\n    game.play\r\n  end.to raise_error\r\nend\r\n```\r\n\r\nStep 2\r\n--------\r\n\r\nIt fails with the following error:\r\n\r\n```ruby\r\n1) AngryRock::Game should raise exception when illegal input is provided\r\n    Failure/Error: expect do\r\n      expected Exception but nothing was raised\r\n```\r\n\r\nStep 3\r\n--------\r\n\r\nTo make this spec pass change the winner method like this:\r\n\r\n```ruby\r\ndef winner\r\n  return :tie if @choice_1 == @choice_2\r\n  if WINS.fetch(@choice_1)\r\n    @choice_1\r\n  else\r\n    @choice_2\r\n  end\r\nend\r\n```\r\n\r\nStep 4\r\n----------\r\n\r\nAll specs will now pass. \r\n\r\nStep 5\r\n----------\r\n\r\nLet\'s hide the implementation details by making the winner method private. All specs should still pass.\r\n\r\nStep 6\r\n----------\r\n\r\nLet\'s make the exception user friendly, change the illegal input spec as follows:\r\n\r\n```ruby\r\nit \"should raise exception when illegal input is provided\" do\r\n  expect do\r\n    game = AngryRock::Game.new(:punk, :hunk)\r\n    game.play\r\n  end.to raise_error(IllegalChoice)\r\nend\r\n```\r\n\r\nStep 7\r\n----------\r\n\r\nThis fails with the error:\r\n\r\n```ruby\r\n1) AngryRock::Game should raise exception when illegal input is provided\r\n   Failure/Error: end.to raise_error(IllegalChoice)\r\n   NameError:\r\n     uninitialized constant AngryRock::IllegalChoice\r\n```\r\n\r\nStep 8\r\n----------\r\n\r\nChange the `angry_rock.rb` as follows:\r\n\r\n```ruby\r\nmodule AngryRock \r\n  class IllegalChoice < Exception ; end;\r\n  \r\n  class Game\r\n   # rest of the code is same as before \r\n    def winner\r\n      return :tie if @choice_1 == @choice_2\r\n      begin\r\n        if WINS.fetch(@choice_1)\r\n          @choice_1\r\n        else\r\n          @choice_2\r\n        end\r\n      rescue\r\n        raise IllegalChoice\r\n      end\r\n    end\r\n  end  \r\nend\r\n```\r\n\r\nStep 9\r\n----------\r\n\r\nAll specs now pass. This concise solution is based on Sinatra Up and Running By Alan Harris, Konstantin Haase. \r\n\r\nExercise\r\n===========\r\n-----------\r\n\r\n1. Look at the following alternative specs and implementation. This solution is based on Well Grounded Rubyist by David Black. It has been refactored to a better design. Make it even better by making the code expressive with readable specs. Compare your solution with the solutions given in the appendix of [Essential TDD book](https://www.rubyplus.com/etdd.pdf \"Essential TDD\") book.\r\n\r\nHere is the angry_rock_spec.rb\r\n\r\n```ruby\r\nrequire \'spec_helper\'\r\n\r\nmodule Game\r\n  describe AngryRock do\r\n   it \"should pick paper as the winner over rock\" do\r\n     play = Play.new(:paper, :rock)\r\n     \r\n     play.should have_winner\r\n     expect(play.winning_move).to eq(\"paper\")\r\n   end \r\n   it \"picks scissors as the winner over paper\" do\r\n     play = Play.new(:scissors, :paper)\r\n     \r\n     play.should have_winner\r\n     expect(play.winning_move).to eq(\"scissors\")  \r\n   end   \r\n   it \"picks rock as the winner over scissors \" do\r\n     play = Play.new(:rock, :scissors)\r\n     \r\n     play.should have_winner\r\n     expect(play.winning_move).to eq(\"rock\")       \r\n   end\r\n   it \"results in a tie when the same choice is made by both players\" do\r\n     data_driven_spec([:rock, :paper, :scissors]) do |choice|\r\n       play = Play.new(choice, choice)\r\n\r\n       play.should_not have_winner\r\n     end     \r\n   end   \r\n  end\r\nend\r\n```\r\n\r\nHere is the angry_rock.rb\r\n\r\n```ruby\r\nmodule Game\r\n  class AngryRock\r\n    include Comparable\r\n\r\n    WINS = [ %w{rock scissors}, %w{scissors paper}, %w{paper rock}]\r\n\r\n    attr_accessor :move\r\n\r\n    def initialize(move)\r\n      @move = move.to_s\r\n    end\r\n    def <=>(opponent)\r\n      if move == opponent.move\r\n        0\r\n      elsif WINS.include?([move, opponent.move])\r\n        1\r\n      elsif WINS.include?([opponent.move, move])\r\n        -1\r\n      else\r\n        raise ArgumentError, \"Something\'s wrong\"\r\n      end\r\n    end\r\n    def winner(opponent)\r\n      if self > opponent\r\n        self\r\n      elsif opponent > self\r\n        opponent\r\n      end\r\n    end\r\n  end\r\n  \r\n  class Play\r\n    def initialize(first_choice, second_choice)\r\n      choice_1 = AngryRock.new(first_choice)\r\n      choice_2 = AngryRock.new(second_choice)\r\n      \r\n      @winner = choice_1.winner(choice_2)\r\n    end\r\n    def has_winner?\r\n      !@winner.nil?\r\n    end\r\n    def winning_move\r\n      @winner.move\r\n    end\r\n  end\r\nend  \r\n```','2014-07-29 21:30:47','2016-12-22 07:52:58'),(301,'TDD Basics : Bowling Game Kata','Objectives\r\n==========\r\n----------\r\n\r\n- Learn why you should not make changes to both production code and specs and then run specs.\r\n- Learn how to find abstractions in the domain to make your code expressive.\r\n\r\nDifficulty Level\r\n================\r\n----------------\r\n\r\nDifficult\r\n\r\nDiscussion\r\n==========\r\n----------\r\n\r\nWe will use the scoring rules found at http://www.bowling2u.com/trivia/game/scoring.asp for our specs. You can also refer the rules Scoring Bowling.html at https://github.com/bparanj/polgar/tree/master/13-bowling-game-gem\r\n  \r\nSteps\r\n=========\r\n---------\r\n\r\nStep 1\r\n-------\r\n\r\nCreate a file` bowling_game_spec.rb` with the following contents:\r\n\r\n```ruby\r\ndescribe BowlingGame do\r\nend\r\n```\r\n\r\nStep 2\r\n--------\r\n\r\nRun the spec:\r\n\r\n```ruby\r\n$rspec bowling_game_spec.rb --color\r\n```\r\n\r\nYou get the error:\r\n\r\n```ruby\r\nuninitialized constant Object::BowlingGame (NameError)\r\n```\r\n\r\nStep 3\r\n-------\r\n\r\nAdd the following code to the top of the `bowling_game_spec.rb`:\r\n\r\n```ruby\r\nclass BowlingGame\r\nend\r\n\r\ndescribe BowlingGame do\r\nend\r\n```\r\n\r\nStep 4\r\n-------\r\n\r\nRun the spec :\r\n\r\n```ruby\r\n$rspec bowling_game_spec.rb --color\r\nNo examples found.\r\n\r\nFinished in 0.00005 seconds\r\n0 examples, 0 failures\r\n```\r\n\r\nStep 5\r\n-------\r\n\r\nLet\'s write our first spec:\r\n\r\n```ruby\r\nclass BowlingGame\r\nend\r\n\r\ndescribe BowlingGame do\r\n  it \'scores all gutters with 0\'\r\nend\r\n```\r\n\r\nStep 6\r\n-------\r\n\r\nWhen you run the spec, you now get the output:\r\n\r\n```ruby\r\nBowlingGame\r\n  scores all gutters with 0 (PENDING: Not yet implemented)\r\n\r\nPending:\r\n  BowlingGame scores all gutters with 0\r\n    # Not yet implemented\r\n    # ./bowling_game_spec.rb:6\r\n\r\nFinished in 0.00029 seconds\r\n1 example, 0 failures, 1 pending\r\n```\r\n\r\nStep 7\r\n-------\r\n\r\nYou can use the **it** block to get things out of your head as a to do list to implement. Add another spec:\r\n\r\n```ruby\r\nclass BowlingGame\r\nend\r\n\r\ndescribe BowlingGame do\r\n  it \'scores all gutters with 0\'\r\n  it \"scores all 1\'s with 20\"\r\nend\r\n```\r\n\r\nStep 8\r\n--------\r\n\r\nWhen you run the specs, you now get the output:\r\n\r\n```ruby\r\nBowlingGame\r\n  scores all gutters with 0 (PENDING: Not yet implemented)\r\n  scores all 1\'s with 20 (PENDING: Not yet implemented)\r\n\r\nPending:\r\n  BowlingGame scores all gutters with 0\r\n    # Not yet implemented\r\n    # ./bowling_game_spec.rb:6\r\n  BowlingGame scores all 1\'s with 20\r\n    # Not yet implemented\r\n    # ./bowling_game_spec.rb:7\r\n\r\nFinished in 0.0003 seconds\r\n2 examples, 0 failures, 2 pending\r\n```\r\n\r\nStep 9\r\n-------------\r\n\r\nLet\'s now express our first requirement as follows:\r\n\r\n```ruby\r\nclass BowlingGame\r\nend\r\n\r\ndescribe BowlingGame do\r\n  it \'scores all gutters with 0\' do\r\n    game = BowlingGame.new\r\n  \r\n    20.times { game.roll(0) }\r\n  \r\n    expect(game.score).to eq(0)\r\n  end\r\n  \r\n  it \"scores all 1\'s with 20\"\r\nend\r\n```\r\n\r\nStep 10\r\n--------------\r\n\r\nWhen you run the specs, you now get the output:\r\n\r\n```ruby\r\n1) BowlingGame scores all gutters with 0\r\n   Failure/Error: 20.times { game.roll(0) }\r\n   NoMethodError:\r\n     undefined method `roll\' for BowlingGame\r\n```\r\n\r\nThe test is not failing for the right reason because it is due to an error in not defining roll method. We are in yellow state. \r\n\r\nStep 11\r\n-----------\r\n\r\nLet\'s do the minimal thing to get past this error message by defining the roll() method in BowlingGame class :\r\n\r\n```ruby\r\nclass BowlingGame\r\n  def roll\r\n  end\r\nend\r\n\r\ndescribe BowlingGame do\r\n  # same code as before\r\nend\r\n```\r\n\r\nStep 12\r\n------------\r\n\r\nWhen you run the specs, you now get the output:\r\n\r\n```ruby\r\n1) BowlingGame scores all gutters with 0\r\n   Failure/Error: def roll\r\n   ArgumentError:\r\n     wrong number of arguments (1 for 0)\r\n```\r\n\r\nThe test is not failing for the right reason because it is due to an error in the definition of roll method. We are in yellow state. \r\n\r\nStep 13\r\n-----------\r\n\r\nLet\'s do the minimal thing required to get past this error by changing the roll method to take an input argument:\r\n\r\n```ruby\r\nclass BowlingGame\r\n  def roll(number)\r\n    \r\n  end\r\nend\r\n\r\ndescribe BowlingGame do\r\n  # same code as before\r\nend\r\n```\r\n\r\nStep 14\r\n----------\r\n\r\nWhen you run the specs, you now get the output:\r\n\r\n```ruby\r\n1) BowlingGame scores all gutters with 0\r\n    Failure/Error: expect(game.score).to eq(0)\r\n    NoMethodError:\r\n      undefined method `score\' for BowlingGame\r\n```\r\n\r\nThe test is not failing for the right reason because it is due to an error in the syntax of score() method. We are in yellow state. \r\n\r\nStep 15\r\n---------\r\n\r\nLet\'s define a score method for the BowlingGame class.\r\n\r\n```ruby\r\nclass BowlingGame\r\n  def roll(number)\r\n    \r\n  end\r\n  \r\n  def score\r\n    \r\n  end\r\nend\r\n\r\ndescribe BowlingGame do\r\n  # same code as before\r\nend\r\n```\r\n\r\nStep 16\r\n---------\r\n\r\nWhen you run the specs, you now get the output:\r\n\r\n```ruby\r\n1) BowlingGame scores all gutters with 0\r\n    Failure/Error: expect(game.score).to eq(0) \r\n      expected: 0\r\n           got: nil\r\n```\r\n\r\nOur test is failing for the right reason. We are now in red state. \r\n\r\nStep 17\r\n----------\r\n\r\nLet\'s change the score method like this:\r\n\r\n```ruby\r\nclass BowlingGame\r\n  def roll(number)\r\n    \r\n  end\r\n  \r\n  def score\r\n    0    \r\n  end\r\nend\r\n\r\ndescribe BowlingGame do\r\n  # same code as before\r\nend\r\n```\r\n\r\nStep 18\r\n-----------\r\n\r\nWhen you run the specs, you now get the output:\r\n\r\n```ruby\r\nBowlingGame\r\n  scores all gutters with 0\r\n  scores all 1\'s with 20 (PENDING: Not yet implemented)\r\n\r\nPending:\r\n  BowlingGame scores all 1\'s with 20\r\n    # Not yet implemented\r\n    # ./bowling_game_spec.rb:20\r\n\r\nFinished in 0.00138 seconds\r\n2 examples, 0 failures, 1 pending\r\n```\r\n\r\nThe first spec now passes. We are now green. \r\n\r\nStep 19\r\n---------\r\n\r\nLet\'s now express our second requirement:\r\n\r\n```ruby\r\nclass BowlingGame\r\n  def roll(number)\r\n    \r\n  end\r\n  \r\n  def score\r\n    0    \r\n  end\r\nend\r\n\r\ndescribe BowlingGame do\r\n  it \'scores all gutters with 0\' do\r\n  # same code as before\r\n  end\r\n  \r\n  it \"scores all 1\'s with 20\" do\r\n    game = BowlingGame.new\r\n  \r\n    20.times { game.roll(1) }\r\n  \r\n    expect(game.score).to eq(20)    \r\n  end\r\nend\r\n```\r\n\r\nStep 20\r\n-----------\r\n\r\nWhen you run the specs, you now get the output:\r\n\r\n```ruby\r\n1) BowlingGame scores all 1 s with 20\r\n    Failure/Error: expect(game.score).to eq(20)\r\n      \r\n      expected: 20\r\n           got: 0\r\n```\r\n\r\nThe spec is failing for the right reason. \r\n\r\nStep 21\r\n-----------\r\n\r\nChange the implementation as follows: \r\n\r\n```ruby\r\nclass BowlingGame\r\n  def initialize\r\n    @score = 0\r\n  end\r\n  \r\n  def roll(number)\r\n    @score += number\r\n  end\r\n  \r\n  def score\r\n    @score\r\n  end\r\nend\r\n\r\ndescribe BowlingGame do\r\n  # same code as before\r\nend\r\n```\r\n\r\nStep 22\r\n----------\r\n\r\nWhen you run the specs, you now get the output:\r\n\r\n```ruby\r\nBowlingGame\r\n  scores all gutters with 0\r\n  scores all 1 s with 20\r\n\r\nFinished in 0.00145 seconds\r\n2 examples, 0 failures\r\n```\r\n\r\nWe are now green. We did not go to the yellow state before we went green. This is ok. \r\n\r\nStep 23\r\n---------\r\n\r\nLet\'s cleanup our BowlingGame class like this:\r\n\r\n```ruby\r\nclass BowlingGame\r\n  attr_reader :score\r\n  \r\n  def initialize\r\n    @score = 0\r\n  end\r\n  def roll(number)\r\n    @score += number\r\n  end\r\nend\r\n\r\ndescribe BowlingGame do\r\n  # same code as before\r\nend\r\n```\r\n\r\nAll the specs still pass. \r\n\r\nStep 24\r\n-----------\r\n\r\nNow there is no duplication in the production code, but what can we do to make it more expressive of the domain? Let\'s rename the number argument to pin like this:\r\n\r\n```ruby\r\nclass BowlingGame\r\n  attr_reader :score\r\n  \r\n  def initialize\r\n    @score = 0\r\n  end\r\n  def roll(pins)\r\n    @score += pins\r\n  end\r\nend\r\n\r\ndescribe BowlingGame do\r\n  # same code as before\r\nend\r\n```\r\n\r\nThe specs still passes since it does not depend on this implementation detail. \r\n\r\nStep 25\r\n----------\r\n\r\nLet\'s move the BowlingGame class into its own file `bowling_game.rb`. Add the `require_relative` to the top of the `bowling_game_spec.rb`:\r\n\r\n```ruby\r\nrequire_relative \'bowling_game\'\r\n\r\ndescribe BowlingGame do\r\n  # same code as before\r\nend\r\n```\r\n\r\nRun the specs again. It should pass. We cleaned up one thing after another, we were green before refactoring and ended in green after refactoring. Why should we not refactor in red state? Refer the appendix of the Essential TDD book for the answer.\r\n\r\nStep 26\r\n-----------\r\n\r\nNow let\'s look the spec and see if we can refactor. The refactored specs look like this:\r\n\r\n```ruby\r\nrequire_relative \'bowling_game\'\r\n\r\ndescribe BowlingGame do\r\n  before do\r\n    @game = BowlingGame.new\r\n  end\r\n  \r\n  it \'scores all gutters with 0\' do\r\n    20.times { @game.roll(0) }\r\n    \r\n    expect(@game.score).to eq(0)\r\n  end\r\n  \r\n  it \"scores all 1\'s with 20\" do\r\n    20.times { @game.roll(1) }\r\n    \r\n    expect(@game.score).to eq(20)    \r\n  end\r\nend\r\n```\r\n\r\nThe specs still pass. In the tests where we are looping 20 times, this test is taken from the rspec home page example for bowling game. In the next article we will see why this is a bad idea and how to refactor it to a better solution.\r\n\r\nExercise\r\n==========\r\n----------\r\n\r\nReplace the before() method with let() method and make all the specs pass.\r\n\r\nDiscussion\r\n============\r\n------------\r\n\r\n**Do you always need to take small steps when writing tests?** \r\n\r\nIf you notice, we change either production code or the spec but not both at the same time. Regardless of whether we are refactoring or driving the design of our code. If we change both the spec and the production code at the same time we will not know which file is causing the problem. If we take small steps, we will be able to immediately fix the problem. Because we know what we just changed. If you are confident you can take bigger steps as long as the duration of the red state is minimum and you get to green and stay in green longer.\r\n\r\n![alt text](https://images.rubyplus.com/footprints-in-sand1.jpg \"Steps\")\r\n\r\n\r\nSummary\r\n=========\r\n---------\r\n\r\nIn this article you learned about why you need to run specs as soon as you make changes to either the production code or the specs. You also learned how to find abstractions to make your code expressive. In this example, it was a simple change in the name of the variable to make it intention revealing. In the next article we will continue working on the bowling game to discuss more topics.','2014-07-29 21:32:47','2016-12-22 07:55:52'),(311,'TDD Basics : Bowling Game Kata Part 2','Objective\r\n=========\r\n----------\r\n\r\n- To learn how to maintain a growing test suite.\r\n\r\nDiscussion\r\n==========\r\n----------\r\n\r\nLet\'s review the production code. What\'s the 20.times { something } code doing? Can we raise the level of abstraction? Missing all the pins is a gutter game and striking all the pins is a strike. Can we change the first spec to call a gutter method and the second spec to call the strike method? If we do so, then we will be focusing on the **WHAT** instead of **HOW**. Looping is a sign that the spec is focusing on the implementation rather than specifying the behavior.\r\n  \r\nSteps\r\n=========\r\n---------\r\n\r\nStep 1\r\n-------\r\n\r\nLet\'s start over and apply what we have learned about the domain. Create game_spec.rb with the following code:\r\n\r\n```ruby\r\nrequire_relative \'game\'\r\n\r\nmodule Bowling\r\n  describe Game do\r\n    it \"return 0 for a miss (no pins are knocked down)\" do\r\n      game = Game.new\r\n      game.miss\r\n      \r\n      expect(game.score).to eq(0)\r\n    end\r\n  end  \r\nend\r\n```\r\n\r\nStep 2\r\n------\r\n\r\nCreate game.rb file with the following contents:\r\n\r\n```ruby\r\nmodule Bowling\r\n  \r\n  class Game\r\n    attr_reader :score\r\n    \r\n    def miss\r\n      @score = 0\r\n    end\r\n  end\r\n  \r\nend\r\n```\r\n\r\nStep 3\r\n----------\r\n\r\nRun the spec:\r\n\r\n```ruby\r\n$rspec game_spec.rb --color\r\n```\r\n\r\nDiscussion\r\n==========\r\n-----------\r\n\r\nThe miss() method implementation helped to setup the require statements and get the spec working. When you are in a green state, you can checkin the code on a regular basis as you make progress. If you want to experiment with an alternative solution you can revert to an older version. This gives us the courage to experiment since we don\'t have to worry about losing our previous work. Here, we intelligently update our specs to reflect our understanding as we learn more about our gaming domain. \r\n\r\nStep 4\r\n-----------\r\n\r\nLet\'s add the second spec:\r\n\r\n```ruby\r\nit \"return 10 for a strike (knocking down all ten pins)\" do\r\n  game = Game.new\r\n  game.strike\r\n  \r\n  expect(game.score).to eq(10)\r\nend\r\n```\r\n\r\nWe get undefined method strike when we run the spec. \r\n\r\nStep 5\r\n-----------\r\n\r\nAdd the strike method to game.rb:\r\n\r\n```ruby\r\ndef strike\r\n  @score = 10\r\nend\r\n```\r\n\r\nStep 6\r\n-----------\r\n\r\nThe spec now passes. Let\'s write the third spec:\r\n\r\n```ruby\r\nit \"return the number of pins hit for a spare\" do\r\n  game = Game.new\r\n  game.spare(8)\r\n  \r\n  expect(game.score).to eq(8)\r\nend\r\n```\r\n\r\nStep 7\r\n--------------\r\n\r\nWe now get the error : undefined method `spare\'. Let\'s define this method like this:\r\n\r\n```ruby\r\ndef spare(pins)\r\n  @score = pins\r\nend\r\n```\r\n\r\nStep 8\r\n----------------\r\n\r\nThe spec now passes. \r\n\r\nDiscussion\r\n==========\r\n-----------\r\n\r\nWe took a bigger step by providing a non trival implementation of the spare() method. When the implementation is straight forward you can just type in the real implementation. There is no need to triangulate or Fake It Till You Make it. Since this method is just a one-liner we went ahead and implemented it. You can learn more by reading the article on [Obvious Implementation](http://www.rubyplus.com/articles/521 \"Obvious Implementation\")\r\n\r\nStep 9\r\n-------------\r\n\r\nLet\'s write the fourth spec.\r\n\r\n```ruby\r\nit \"when a strike is bowled, the total score is 10 + \r\n    the total of the next two roll to that frame\" do\r\n  game = Game.new\r\n  game.strike\r\n  \r\n  game.roll(7)\r\n  game.roll(5)\r\n  \r\n  expect(game.score).to eq(22)\r\nend\r\n```\r\n\r\nStep 10\r\n--------------\r\n\r\nTo make this spec pass, add the roll() method to game.rb as follows:\r\n\r\n```ruby\r\ndef roll(pins)\r\n  @score += pins\r\nend\r\n```\r\n\r\nStep 11\r\n-----------\r\n\r\nAll the specs now pass. Let\'s review the doc string.\r\n\r\n```ruby\r\n$rspec game_spec.rb --color --format doc\r\n\r\nBowling::Game\r\n  should return 0 for a miss (not knocking down any pins)\r\n  should return 10 for a strike (knocking down all ten pins)\r\n  should return the number of pins hit for a spare\r\n  when a strike is bowled, the total score is 10 + \r\n        the total of the next two roll to that frame\r\n\r\nFinished in 0.0019 seconds\r\n4 examples, 0 failures\r\n```\r\n\r\nStep 12\r\n------------\r\n\r\nAs you can see the second and fourth spec are the same scenario. It is for a strike. We can now delete the second spec because it is now superseded by the fourth spec. So our specs now looks like this:\r\n\r\n```ruby\r\nrequire_relative \'game\'\r\n\r\nmodule Bowling\r\n  describe Game do\r\n    it \"return 0 for a miss (not knocking down any pins)\" do\r\n      game = Game.new\r\n      game.miss\r\n      \r\n      expect(game.score).to eq(0)\r\n    end\r\n        \r\n    it \"return the number of pins hit for a spare\" do\r\n      game = Game.new\r\n      game.spare(8)\r\n      \r\n      expect(game.score).to eq(8)\r\n    end\r\n    \r\n    it \"when a strike is bowled, the total score is 10 + \r\n        the total of the next two roll to that frame\" do\r\n      game = Game.new\r\n      game.strike\r\n      \r\n      game.roll(7)\r\n      game.roll(5)\r\n      \r\n      expect(game.score).to eq(22)\r\n    end\r\n  end  \r\nend\r\n```\r\n\r\nIn this version we have implemented miss(), strike(), spare() and roll() methods. We deleted the spec that gave us momentum but is no longer needed.\r\n\r\n>> The purpose of TDD is to express the intent of code in as few tests as possible.\"\r\n>>		-- David Bernstein blog post about [Triangulation](http://tobeagile.com/2009/12/08/triangulation/ \'Triangulation\')\r\n\r\nStep 13\r\n-----------\r\n\r\nLet\'s read the definition of the spare:\r\n\r\nWhen a bowler knocks all ten pins down on the second ball roll they are said to have rolled a spare. The score keeper will mark a / for that frame and the bowlers score is the ten pins that they just knocked down plus they get to add to that what they knock down on their next ball roll. Consequently, you will not know what the bowler\'s score is until the next frame!\r\n\r\nStep 14\r\n----------\r\n\r\nLet\'s update our second spec to reflect our understanding of the spare concept in the game_spec.rb as follows:\r\n\r\n```ruby\r\nit \"return 10 + number of pins knocked down in next roll for a spare\" do\r\n  game = Game.new\r\n  game.spare\r\n  game.roll(2)\r\n  \r\n  expect(game.score).to eq(12)\r\nend\r\n```\r\n\r\nStep 15\r\n--------\r\n\r\nWe now have to change the spare method signature and implementation as follows:\r\n\r\nHere is the game.rb\r\n\r\n```ruby\r\ndef spare\r\n  @score = 10\r\nend\r\n```\r\n\r\nThe specs now pass. Notice that we are not blindly appending to our specs, we are updating the specs intelligently to reflect our new understanding of the domain as we drive the design of our bowling gaming class. We may also delete the test if it is no longer required.\r\n\r\nSummary\r\n=========\r\n---------\r\n\r\nIn this article you learned about intelligently updating the specs as you learn more about the domain instead of blindly adding more specs to your existing test suite. In the next article we will continue development of the bowling game.','2014-07-29 22:31:55','2014-08-14 06:36:08'),(321,'TDD Basics : Bowling Game Kata Part 3','Objective\r\n=========\r\n----------\r\n\r\n- To learn why to fail loudly when something goes wrong.\r\n  \r\nSteps\r\n=========\r\n---------\r\n\r\nStep 1\r\n-------\r\n\r\nLet\'s write a spec to find the score for a perfect game. Here is the game_spec.rb:\r\n\r\n```ruby\r\nit \"return 300 for a perfect game\" do\r\n  game = Game.new\r\n  30.times { game.strike }\r\n    \r\n  game.score.should == 300\r\nend\r\n```\r\n\r\nThis fails with the error:\r\n\r\n```ruby\r\n1) Bowling::Game return 300 for a perfect game\r\n   Failure/Error: game.score.should == 300\r\n     expected: 300\r\n          got: 10 (using ==)\r\n```\r\n\r\nStep 2\r\n----------\r\n\r\nTo make this spec pass, we add the constructor and change strike method in game.rb as follows:\r\n\r\n```ruby\r\nmodule Bowling  \r\n  class Game\r\n    attr_reader :score\r\n    \r\n    def initialize\r\n      @score = 0  \r\n    end\r\n    def strike\r\n      @score += 10\r\n    end\r\n        \r\n	  # rest of the code same as before\r\n  end\r\nend\r\n```\r\n\r\nAll specs now pass. The looping in the spec is not good. Let\'s now tackle it.\r\n\r\nStep 3\r\n----------\r\n\r\nAdd repeat method to the spec_helper.rb :\r\n\r\n```ruby\r\ndef repeat(n)\r\n   n.times { yield }\r\nend\r\n```\r\n\r\nStep 4\r\n-----------\r\n\r\nChange the spec to use the repeat method like this:\r\n\r\ngame_spec.rb\r\n\r\n```ruby    \r\n  it \"return 300 for a perfect game\" do\r\n    game = Game.new\r\n    repeat(30) { game.strike } \r\n    \r\n    game.score.should == 300\r\n  end\r\n```\r\n\r\nStep 5\r\n-----------\r\n\r\nAdd\r\n\r\n```ruby\r\nrequire_relative \'spec_helper\'\r\n```\r\n\r\nto the top of the game_spec.rb. Now all the specs will pass. There is no change to the game.rb during this refactoring. We have now removed looping for the perfect game spec.\r\n\r\nStep 6\r\n-----------\r\n\r\nLet\'s now implement the feature to get scores for given frame. Add the fifth spec to game_spec.rb as follows:\r\n\r\n```ruby\r\nrequire_relative \'spec_helper\'\r\nrequire_relative \'game\'\r\n\r\nmodule Bowling\r\n  describe Game do\r\n\r\n    it \"should return a score of 8 for first hit of 6 pins and the\r\n 				second hit of 2 pins for the first frame\" do\r\n      game = Game.new\r\n      game.frame = 1\r\n      \r\n      game.roll(6)\r\n      game.roll(2)\r\n      \r\n      game.score.should == 8\r\n    end\r\n    \r\n  end  \r\nend\r\n```\r\n\r\nStep 7\r\n--------------\r\n\r\nTo make this spec pass, add \r\n\r\n```ruby\r\nattr_accessor :frame\r\n```\r\n\r\nto the game.rb. The game ignores the frame during score calculation. \r\n\r\nStep 8\r\n----------------\r\n\r\nWe will drive the implementation to use the frame now by adding the following spec:\r\n\r\n```ruby\r\nit \"return the score for a given frame to allow display of score\" do\r\n  game = Game.new\r\n  \r\n  game.roll(6)\r\n  game.roll(2)\r\n  \r\n  game.score_for(1).should == [6, 2]      \r\nend\r\n```\r\n\r\nStep 9\r\n-------------\r\n\r\nChange the game.rb as follows:\r\n\r\n```ruby\r\nmodule Bowling\r\n  \r\n  class Game\r\n    attr_reader :score\r\n    attr_accessor :frame\r\n    \r\n    def initialize\r\n      @score = 0\r\n      @score_card = []\r\n    end    \r\n    \r\n    def miss\r\n      @score = 0\r\n    end\r\n    \r\n    def strike\r\n      @score += 10\r\n    end\r\n    \r\n    def spare\r\n      @score = 10\r\n    end\r\n    \r\n    def roll(pins, frame = 1)\r\n      @score += pins   \r\n      update_score_card(pins, frame)   \r\n    end    \r\n    \r\n    def score_for(frame)\r\n      @score_card[frame]\r\n    end\r\n    \r\n    private\r\n    \r\n    def update_score_card(pins, frame)\r\n      if @score_card[frame].nil?\r\n        @score_card[frame] = []\r\n        @score_card[frame][0] = pins\r\n      else\r\n        @score_card[frame][1] = pins\r\n      end\r\n    end\r\n  end\r\nend\r\n```\r\n\r\nThis implementation was arrived after playing in the irb with some sample data. All specs will now pass.\r\n\r\nStep 10\r\n--------------\r\n\r\nLet\'s now tackle the scoring of multiple frames. Add the spec shown below:\r\n\r\ngame_spec.rb\r\n\r\n```ruby\r\nrequire_relative \'spec_helper\'\r\nrequire_relative \'game\'\r\n\r\nmodule Bowling\r\n  describe Game do\r\n    # other tests same as before\r\n    \r\n    it \"return the total score for first two frames of a game\" do\r\n      g = Game.new\r\n      # Frame #1\r\n      g.roll(6)\r\n      g.roll(2)\r\n      # Frame #2\r\n      g.roll(7, 2)\r\n      g.roll(1,2)\r\n      \r\n      g.score.should == 16\r\n    end\r\n    \r\n  end  \r\nend\r\n```\r\n\r\nStep 11\r\n-----------\r\n\r\nThis new spec passes without failing. This means the feature is already implemented. Comments in the spec is bugging me. How can we make the code expressive so that we don\'t need any comments to clarify it\'s intention? To make the intent clear, we can make the second argument in the roll method a hash like this: roll(pins, args)\r\n\r\n```ruby\r\nit \"return the total score for first two frames of a game\" do\r\n  game = Game.new\r\n  game.roll(6)\r\n  game.roll(2)\r\n  game.roll(7, frame: 2)\r\n  game.roll(1, frame: 2)\r\n  \r\n  expect(game.score).to eq(16)\r\nend\r\n```\r\n\r\nStep 12\r\n------------\r\n\r\nThe error is now:\r\n\r\n```ruby\r\nBowling::Game return the total score for first two frames of a game\r\n  Failure/Error: g.roll(7, frame: 2)\r\n  TypeError:\r\n      can t convert Hash into Integer\r\n```\r\n\r\nStep 13\r\n----------\r\n\r\nChange the roll method implementation in game.rb like this:\r\n\r\n```ruby\r\ndef roll(pins, args={})\r\n  if args.empty?\r\n    frame = 1\r\n  else\r\n    frame = args[:frame]\r\n  end\r\n  @score += pins   \r\n  update_score_card(pins, frame)   \r\nend\r\n```\r\n\r\nAll the specs will pass. \r\n\r\nStep 14\r\n-------------\r\n\r\nLet\'s extract the initializing code from the roll method to a private method:\r\n\r\n```ruby\r\ndef initialize_frame(args)\r\n  return 1 if args.empty?\r\n\r\n  args.fetch(:frame)\r\nend\r\n```\r\n\r\nDiscussion\r\n=========\r\n---------\r\n\r\nIn the initialize_frame() method, we are using the fetch method which throws an exception if the value for a given key is not found. If we use [] method, then we will get a nil value which will crash our program due to nil value. When we fail we should fail loudly with verbose failure messages. Message must say what went wrong and if it is a recoverable error, it should tell you how to fix it. If we fail silently, then the cause of the failure will be hidden and will be difficult to track down.\r\n\r\nExercise\r\n=========\r\n---------\r\n\r\nImprove the following code:\r\n\r\n```ruby\r\nrepeat(30) { game.strike } \r\n```','2014-07-30 04:44:24','2014-08-14 06:39:47'),(331,'TDD Basics : Bowling Game Kata Final Solution','Getting Unstuck\r\n===============\r\n---------------\r\n\r\n>> Ideas must be put to the test. That’s why we make things; otherwise they would be no more than ideas. There is often a huge difference between an idea and its realisation. \r\n\r\n>> —Andy Goldsworthy\r\n\r\nIf you are spending too much time on requirements and you are stuck, break down big statements into smaller statements and test your ideas by writing a small and focused test. \r\n  \r\nSteps\r\n=========\r\n---------\r\n\r\nStep 1\r\n-------\r\n\r\nLet\'s consider the scenario of rolling a strike on the second frame. Add the spec:\r\n\r\n```ruby\r\nit \"Rolling a strike : All 10 pins are hit on the first ball roll. \r\n			Score is 10 pins + Score for the next two ball rolls\" do\r\n  game = Game.new\r\n  game.roll(6)\r\n  game.roll(2)\r\n  game.roll(10, frame: 2)\r\n  game.roll(9, frame: 3)\r\n  game.roll(0, frame: 3)\r\n\r\n  expect(game.score).to eq(8 + 10 + 9 + 0)        \r\nend\r\n```\r\n\r\nThe spec passes. It can handle this scenario without making any changes to the existing implementation. \r\n\r\nStep 2\r\n----------\r\n\r\nLet\'s add a new spec to calculate total score up to a given frame:\r\n\r\n```ruby\r\nit \"Rolling a strike : should return the score upto a given frame that is\r\n		  running total + 10 + the score for next two balls\" do\r\n  game = Game.new\r\n  game.roll(6)\r\n  game.roll(2)\r\n  game.roll(7, frame: 2)\r\n  game.roll(1, frame: 2)\r\n  game.roll(10, frame: 3)\r\n  game.roll(9, frame: 4)\r\n  game.roll(0, frame: 4)\r\n  \r\n  total_score_upto_frame_3 = game.score_total_upto_frame(3)\r\n  \r\n  expect(total_score_upto_frame_3).to eq(6 + 2 + 7 + 1 + 10 + 9 + 0)\r\nend\r\n```\r\n\r\nWe get undefined method score_total_upto_frame error. \r\n\r\nStep 3\r\n----------\r\n\r\nLet\'s implement this method as follows:\r\n\r\n```ruby\r\ndef score_total_upto_frame(n)\r\n  @score_card.flatten.inject{|x, sum| x += sum}\r\nend\r\n```\r\n\r\nStep 4\r\n-----------\r\n\r\nAfter fixing off by one error due to array index in frame numbers and fixing scoring logic bug for a strike, the game.rb is:\r\n\r\n```ruby\r\nmodule Bowling\r\n  \r\n  class Game\r\n    attr_reader :score\r\n    attr_accessor :frame\r\n    \r\n    def initialize\r\n      @score = 0\r\n      @score_card = []\r\n    end\r\n    \r\n    def miss\r\n      @score = 0\r\n    end\r\n    \r\n    def strike\r\n      @score += 10\r\n    end\r\n    \r\n    def spare\r\n      @score = 10\r\n    end\r\n    \r\n    def roll(pins, args={})\r\n      frame = initialize_frame(args)\r\n      @score += pins   \r\n      update_score_card(pins, frame)   \r\n      handle_strike_scoring(pins, frame) \r\n    end\r\n    \r\n    def score_for(n)\r\n      @score_card[n - 1]\r\n    end\r\n    \r\n    def score_total_upto_frame(n)\r\n      @score_card.flatten.inject{|x, sum| x += sum}\r\n    end\r\n    \r\n    private\r\n    \r\n    def update_score_card(pins, frame)\r\n      if @score_card[frame - 1].nil?\r\n        @score_card[frame - 1] = []\r\n        @score_card[frame - 1][0] = pins\r\n      else\r\n        @score_card[frame - 1][1] = pins        \r\n      end\r\n    end\r\n    \r\n    def initialize_frame(args)\r\n      return 1 if args.empty?\r\n\r\n      args.fetch(:frame)\r\n    end\r\n    \r\n    def handle_strike_scoring(pins, frame)\r\n      # Check previous frame for a strike and update the score card\r\n      if frame > 1\r\n        score_array = score_for(frame - 2)\r\n        # Is the previous hit a strike?\r\n        if score_array && score_array.include?(10) \r\n          score_array << pins\r\n        end\r\n      end\r\n    end\r\n  end\r\nend\r\n```\r\n\r\nStep 5\r\n-----------\r\n\r\nLet\'s consider a scenario where we hit a strike and then a spare. Add the following spec:\r\n\r\n```ruby\r\nit \"return the score_total_upto_frame for a game that includes a strike and a spare\" do\r\n  game = Game.new\r\n  game.roll(6)\r\n  game.roll(2)\r\n    \r\n  game.roll(7, frame: 2)\r\n  game.roll(1, frame: 2)\r\n    \r\n  game.roll(10, frame: 3)\r\n    \r\n  game.roll(9, frame: 4)\r\n  game.roll(0, frame: 4)\r\n  # A spare happens on the fifth frame\r\n  game.roll(8, frame: 5)\r\n  game.roll(2, frame: 5)\r\n    \r\n  game.roll(1, frame: 6)      \r\n  \r\n  game.score_total_upto_frame(5).should == \r\n		(6 + 2) + (7 + 1) + (10 + 9 + 0) + (9 + 0) + (8 + 2 + 1)      \r\nend\r\n```\r\n\r\nStep 6\r\n-----------\r\n\r\nThis fails with the error:\r\n\r\n```ruby\r\nexpected: 55\r\n     got: 56 (using ==)\r\n```\r\n\r\nStep 7\r\n--------------\r\n\r\nLet\'s change the implementation of game.rb as follows:\r\n\r\n```ruby\r\nmodule Bowling\r\n  \r\n  class Game\r\n    attr_reader :score\r\n    attr_accessor :frame\r\n    \r\n    def initialize\r\n      @score = 0\r\n      @score_card = []\r\n    end\r\n    \r\n    def miss\r\n      @score = 0\r\n    end\r\n    \r\n    def strike\r\n      @score += 10\r\n    end\r\n    \r\n    def spare\r\n      @score += 10\r\n    end\r\n    \r\n    def roll(pins, args={})\r\n      frame = initialize_frame(args)\r\n      @score += pins   \r\n      update_score_card(pins, frame)   \r\n      update_strike_score\r\n      update_spare_score\r\n    end\r\n    \r\n    def score_for(n)\r\n      @score_card[n - 1]\r\n    end\r\n    \r\n    def score_total_upto_frame(n)\r\n      @score_card.take(n).flatten.inject{|x, sum| x += sum}\r\n    end\r\n    \r\n    private\r\n    \r\n    def update_score_card(pins, frame)\r\n      if @score_card[frame - 1].nil?\r\n        @score_card[frame - 1] = []\r\n        @score_card[frame - 1][0] = pins\r\n      else\r\n        @score_card[frame - 1][1] = pins        \r\n      end\r\n    end\r\n    \r\n    def initialize_frame(args)\r\n      return 1 if args.empty?\r\n\r\n      args.fetch(:frame)\r\n    end\r\n    \r\n    def update_strike_score\r\n      strike_index = 100\r\n\r\n      @score_card.each_with_index do |e, i|\r\n       # Update the strike score only once\r\n       if e.include?(10) and (e.size == 1)\r\n         strike_index = i\r\n       end\r\n      end\r\n\r\n      last_element_index = (@score_card.size - 1)\r\n      if strike_index < last_element_index\r\n        @score_card[strike_index] +=  @score_card[strike_index + 1]\r\n      end\r\n    end\r\n\r\n    def update_spare_score\r\n      spare_index = 100\r\n\r\n      @score_card.each_with_index do |e, i|\r\n        # Skip strike score\r\n        unless e.include?(10)\r\n          if (e.size == 2) and (e.inject(:+) == 10)\r\n            spare_index = i\r\n          end\r\n        end\r\n      end\r\n\r\n      last_element_index = (@score_card.size - 1)\r\n      if spare_index < last_element_index\r\n        @score_card[spare_index] +=  [@score_card[last_element_index][0]]\r\n      end\r\n    end\r\n  end\r\nend\r\n```\r\n\r\nStep 8\r\n----------------\r\n\r\nThe spec now passes. Let\'s calculate the score for the same scenario.\r\n\r\n```ruby\r\nit \"should return the score for a game that includes a strike and a spare\" do\r\n   game = Game.new\r\n   game.roll(6)\r\n   game.roll(2)\r\n     \r\n   game.roll(7, frame: 2)\r\n   game.roll(1, frame: 2)\r\n     \r\n   game.roll(10, frame: 3)\r\n     \r\n   game.roll(9, frame: 4)\r\n   game.roll(0, frame: 4)\r\n   # A spare happens on the fifth frame\r\n   game.roll(8, frame: 5)\r\n   game.roll(2, frame: 5)\r\n     \r\n   game.roll(1, frame: 6)      \r\n   \r\n   game.score.should == \r\n			(6 + 2) + (7 + 1) + (10 + 9 + 0) + (8 + 2 + 1)      \r\n end\r\n```\r\n\r\nThis spec passes without failing.\r\n\r\nStep 9\r\n-------\r\n\r\nLet\'s use context to group related specs together. Here is the game_spec.rb:\r\n\r\n```ruby\r\nrequire_relative \'spec_helper\'\r\nrequire_relative \'game\'\r\n\r\nmodule Bowling\r\n  describe Game do\r\n    it \"return 0 for a miss (not knocking down any pins)\" do\r\n      game = Game.new\r\n      game.miss\r\n      \r\n      expect(game.score).to eq(0)\r\n    end\r\n            \r\n    it \"return a score of 8 for first hit of 6 pins and the\r\n 				second hit of 2 pins for the first frame\" do\r\n      game = Game.new\r\n      game.frame = 1\r\n      \r\n      game.roll(6)\r\n      game.roll(2)\r\n      \r\n      expect(game.score).to eq(8)\r\n    end\r\n    \r\n    it \"return the score for a given frame to allow display of score\" do\r\n      game = Game.new\r\n\r\n      game.roll(6)\r\n      game.roll(2)\r\n\r\n      game.score_for(1).should == [6, 2]      \r\n    end\r\n    \r\n    it \"return the total score for first two frames of a game\" do\r\n      game = Game.new\r\n      game.roll(6)\r\n      game.roll(2)\r\n      game.roll(7, frame: 2)\r\n      game.roll(1, frame: 2)\r\n      \r\n      expect(game.score).to eq(16)\r\n    end\r\n    \r\n    it \"return 10 + number of pins knocked down in next roll for a spare\" do\r\n      game = Game.new\r\n      game.spare\r\n      game.roll(2)\r\n      \r\n      expect(game.score).to eq(12)\r\n    end\r\n    \r\n    context \'Strike\' do\r\n      it \"return 300 for a perfect game\" do\r\n        game = Game.new\r\n        repeat(30) { game.strike }\r\n\r\n        expect(game.score).to eq(300)\r\n      end\r\n\r\n      it \"when a strike is bowled, the total score is 10 + \r\n          the total of the next two roll to that frame\" do\r\n        game = Game.new\r\n        game.strike\r\n\r\n        game.roll(7)\r\n        game.roll(5)\r\n\r\n        expect(game.score).to eq(22)\r\n      end\r\n\r\n      it \"Rolling a strike : All 10 pins are hit on the first ball roll. \r\n  				Score is 10 pins + Score for the next two ball rolls\" do\r\n        game = Game.new\r\n        game.roll(6)\r\n        game.roll(2)\r\n        game.roll(10, frame: 2)\r\n        game.roll(9, frame: 3)\r\n        game.roll(0, frame: 3)\r\n\r\n        expect(game.score).to eq(8 + 10 + 9 + 0)        \r\n      end\r\n\r\n      it \"Rolling a strike : should return the score upto a given frame that is\r\n  			  running total + 10 + the score for next two balls\" do\r\n        game = Game.new\r\n        game.roll(6)\r\n        game.roll(2)\r\n        game.roll(7, frame: 2)\r\n        game.roll(1, frame: 2)\r\n        game.roll(10, frame: 3)\r\n        game.roll(9, frame: 4)\r\n        game.roll(0, frame: 4)\r\n\r\n        total_score_upto_frame_3 = game.score_total_upto_frame(3)\r\n\r\n        expect(total_score_upto_frame_3).to eq(6 + 2 + 7 + 1 + 10 + 9 + 0)\r\n      end      \r\n    end\r\n    \r\n    context \'Strike and a Spare\' do\r\n      it \"return the score_total_upto_frame for a game that \r\n          includes a strike and a spare\" do\r\n        game = Game.new\r\n        game.roll(6)\r\n        game.roll(2)\r\n\r\n        game.roll(7, frame: 2)\r\n        game.roll(1, frame: 2)\r\n\r\n        game.roll(10, frame: 3)\r\n\r\n        game.roll(9, frame: 4)\r\n        game.roll(0, frame: 4)\r\n        # A spare happens on the fifth frame\r\n        game.roll(8, frame: 5)\r\n        game.roll(2, frame: 5)\r\n\r\n        game.roll(1, frame: 6)      \r\n\r\n        expect(game.score_total_upto_frame(5)).to eq((6 + 2) + (7 + 1) + (10 + 9 + 0) + (9 + 0) + (8 + 2 + 1))\r\n      end\r\n\r\n      it \"return the score for a game that includes a strike and a spare\" do\r\n        game = Game.new\r\n        game.roll(6)\r\n        game.roll(2)\r\n\r\n        game.roll(7, frame: 2)\r\n        game.roll(1, frame: 2)\r\n\r\n        game.roll(10, frame: 3)\r\n\r\n        game.roll(9, frame: 4)\r\n        game.roll(0, frame: 4)\r\n        # A spare happens on the fifth frame\r\n        game.roll(8, frame: 5)\r\n        game.roll(2, frame: 5)\r\n\r\n        game.roll(1, frame: 6)      \r\n\r\n        expect(game.score).to eq((6 + 2) + (7 + 1) + (10 + 9 + 0) + (8 + 2 + 1))\r\n      end      \r\n    end\r\n\r\n  end  \r\nend\r\n``` \r\n\r\nNotice that I did\'t jump into rspec tricks like let, nested contexts, one-liner specs etc. My focus has always been on improving the design of the domain code. At the end, I group the specs to make it more readable. Feel free to make this version use any rspec constructs that you think makes it better. \r\n\r\nExercises\r\n=========\r\n-----------\r\n\r\n1. Use bundler gem command to generate a skeleton for bowling gem and covert the final bowling game version to a gem.\r\n2. Make sure all the specs pass after converting it to a gem.\r\n3. Compare your solution with https://github.com/bparanj/Bowing-Game\r\n	- git clone https://github.com/bparanj/Bowing-Game\r\n	- git log\r\n	- You will see the commit hash for each commit like : \r\n	 		commit 5102f45b2c584cf2f5efaa17e9640c0c288bcf8d\r\n		 You can checkout a particular commit by :\r\n		  git co 5102f45b2c584cf2f5efaa17e9640c0c288bcf8d\r\n4. Private methods are not tested. Why?\r\n\r\nReference\r\n==========\r\n----------\r\n\r\n1. Design for Test by Rebecca J. Wirfs-Brock','2014-07-30 04:58:24','2014-09-01 06:10:43'),(341,'TDD Advanced Concepts : Double Dispatch','Objective\r\n==========\r\n----------\r\n\r\n- Learn how to use double dispatch to make your code object oriented.  \r\n  \r\nProblem Domain Analysis\r\n=======================\r\n-----------------------\r\n\r\nWe are going to develop the Rock, Paper, Scissor game. In this game there are 3 items:\r\n\r\n Rock \r\n Paper\r\n Scissor\r\n\r\nThere are 9 possible combinations. They are as follows:\r\n\r\n Rock  Rock\r\n Rock  Paper\r\n Rock  Scissor\r\n\r\n Paper Rock\r\n Paper Paper\r\n Paper Scissor\r\n\r\n Scissor Rock\r\n Scissor Paper\r\n Scissor Scissor\r\n\r\nSteps\r\n=========\r\n---------\r\n\r\nStep 1\r\n-------\r\n\r\nCreate angry_rock_spec.rb with the following contents:\r\n\r\n```ruby\r\nmodule AngryRock\r\n  describe Game do\r\n    it \"picks paper as the winner over rock\" do\r\n      player_one = Player.new(\"Green Day\")\r\n      player_one.choice = :paper\r\n      player_two = Player.new(\"Blue Planet\")  \r\n      player_two.choice = :rock\r\n      \r\n      game = Game.new(player_one, player_two)\r\n      game.winner.should == \'Green Day\'   \r\n    end\r\n  end\r\nend\r\n```\r\n\r\nStep 2\r\n----------\r\n\r\nCreate angry_rock.rb with the following contents:\r\n\r\n```ruby\r\nmodule AngryRock\r\n  class Game\r\n\r\n  end  \r\nend\r\n```\r\n\r\nStep 3\r\n----------\r\n\r\nThe spec fails with the error:\r\n\r\n```ruby\r\n1) AngryRock::Game picks paper as the winner over rock\r\n    Failure/Error: player_one = Player.new(\"Green Day\")\r\n    NameError:\r\n      uninitialized constant AngryRock::Player\r\n```\r\n\r\nStep 4\r\n-----------\r\n\r\nChange the angry_rock.rb to :\r\n\r\n```ruby\r\nmodule AngryRock\r\n  class Game\r\n    \r\n  end\r\n  class Player\r\n    \r\n  end\r\nend\r\n```\r\n\r\nStep 5\r\n-----------\r\n\r\nThe spec fails with the error:\r\n\r\n```ruby\r\n1) AngryRock::Game picks paper as the winner over rock\r\n    Failure/Error: player_one = Player.new(\"Green Day\")\r\n    ArgumentError:\r\n      wrong number of arguments(1 for 0)\r\n```\r\n\r\nStep 6\r\n-----------\r\n\r\nChange the player class like this:\r\n\r\n```ruby\r\nclass Player\r\n  def initialize(name)\r\n    @name = name\r\n  end    \r\nend\r\n```\r\n\r\nStep 7\r\n--------------\r\n\r\nThe spec fails with the error:\r\n\r\n```ruby\r\n1) AngryRock::Game picks paper as the winner over rock\r\n   Failure/Error: player_one.choice = :paper\r\n   NoMethodError:\r\n     undefined method `choice=\' for #<AngryRock::Player:0xf0 @name=\"Green Day\">\r\n```\r\n\r\nStep 8\r\n----------------\r\n\r\nAdd the setter for choice by changing the player class as follows:\r\n\r\n```ruby\r\nclass Player\r\n  attr_writer :choice\r\n  # rest of the code same as before \r\nend\r\n```\r\n\r\nStep 9\r\n-------------\r\n\r\nThe spec fails with the error:\r\n\r\n```ruby\r\n1) AngryRock::Game picks paper as the winner over rock\r\n   Failure/Error: game = Game.new(player_one, player_two)\r\n   ArgumentError:\r\n     wrong number of arguments(2 for 0)\r\n```\r\n\r\nStep 10\r\n--------------\r\n\r\nChange the game class as follows:\r\n\r\n```ruby\r\nclass Game\r\n  def initialize(player_1, player_2)\r\n    \r\n  end    \r\nend\r\n```\r\n\r\nStep 11\r\n-----------\r\n\r\nThe spec fails with the error:\r\n\r\n```ruby\r\n1) AngryRock::Game picks paper as the winner over rock\r\n    Failure/Error: game.winner.should == \'Green Day\'\r\n    NoMethodError:\r\n      undefined method `winner\' for #<AngryRock::Game:0x80>\r\n```\r\n\r\nStep 12\r\n------------\r\n\r\nDefine the winner method in the game class like this:\r\n\r\n```ruby\r\nclass Game\r\n  # rest of the code same as before   \r\n  def winner\r\n    \r\n  end \r\nend\r\n```\r\n\r\nStep 13\r\n------------\r\n\r\nThe spec fails with the error:\r\n\r\n```ruby\r\n1) AngryRock::Game picks paper as the winner over rock\r\n   Failure/Error: game.winner.should == \'Green Day\'\r\n     expected: \"Green Day\"\r\n          got: nil (using ==)\r\n```\r\n\r\nStep 14\r\n----------\r\n\r\nChange the winner method of the Game like this:\r\n\r\n```ruby\r\ndef winner\r\n  \'Green Day\'\r\nend\r\n```\r\n\r\nThe first spec now passes. \r\n\r\nStep 15\r\n----------\r\n\r\nLet\'s add the second spec:\r\n\r\n```ruby\r\nit \"picks scissors as the winner over paper\" do\r\n  player_one = Player.new(\"Green Day\")\r\n  player_one.choice = :paper\r\n  player_two = Player.new(\"Blue Planet\")  \r\n  player_two.choice = :scissor \r\n  \r\n  game = Game.new(player_one, player_two)\r\n  game.winner.should == \'Blue Planet\'   \r\nend\r\n```\r\n\r\nStep 16\r\n---------\r\n\r\nThe spec fails with the error:\r\n\r\n```ruby\r\n1) AngryRock::Game picks scissors as the winner over paper\r\n   Failure/Error: game.winner.should == \'Blue Planet\'\r\n     expected: \"Blue Planet\"\r\n          got: \"Green Day\" (using ==)\r\n```\r\n\r\nStep 17\r\n---------\r\n\r\nLet\'s encapsulate the game rules in rock, paper and scissor classes as follows. Here is paper.rb\r\n\r\n```ruby\r\nclass Paper\r\n  def beats(item)\r\n    !item.beatsPaper\r\n  end\r\n  def beatsRock\r\n    true\r\n  end\r\n  def beatsPaper\r\n    false\r\n  end\r\n  def beatsScissor\r\n    false\r\n  end\r\nend\r\n```\r\n\r\nHere is rock.rb\r\n\r\n```ruby\r\nclass Rock\r\n  def beats(item)\r\n    !item.beatsRock\r\n  end\r\n  def beatsRock\r\n    false\r\n  end  \r\n  def beatsPaper\r\n    false\r\n  end\r\n  def beatsScissor\r\n    true\r\n  end\r\nend\r\n```\r\n\r\nHere is scissor.rb\r\n\r\n```ruby\r\nclass Scissor\r\n  def beats(item)\r\n    !item.beatsScissor\r\n  end\r\n  def beatsRock\r\n    false\r\n  end  \r\n  def beatsPaper\r\n    true\r\n  end\r\n  def beatsScissor\r\n    false\r\n  end\r\nend\r\n```\r\n\r\nStep 18\r\n-----------\r\n\r\nChange the angry_rock.rb implementation like this:\r\n\r\n```ruby\r\nrequire_relative \'paper\'\r\nrequire_relative \'rock\'\r\nrequire_relative \'scissor\'\r\n\r\nmodule AngryRock\r\n  class Game\r\n    def initialize(player_1, player_2)\r\n      @player_1 = player_1\r\n      @player_2 = player_2\r\n    end   \r\n    \r\n    def winner\r\n      receiver = Object.const_get(@player_1.choice.capitalize).new\r\n      target = Object.const_get(@player_2.choice.capitalize).new\r\n      yes = receiver.beats(target)      \r\n      if yes\r\n        @player_1.name\r\n      else\r\n        @player_2.name\r\n      end\r\n    end \r\n  end\r\n  \r\n  class Player\r\n    attr_reader :name\r\n    attr_accessor :choice\r\n    \r\n    def initialize(name)\r\n      @name = name\r\n    end    \r\n  end\r\nend\r\n```\r\n\r\nStep 19\r\n---------\r\n\r\nNow both specs should pass. Go the irb console and type:\r\n\r\n```ruby\r\nObject.const_get(\"String\")\r\n => String \r\n```\r\n\r\nAs you can see if you give a string as the parameter to the Object.const_get method you get back a constant. In Ruby the name of a class is a constant. So we instantiate the class by doing:\r\n\r\n```ruby\r\nObject.const_get(@player_1.choice.capitalize).new\r\n```\r\n\r\nIf the first choice is :paper the receiver becomes and instance of the Paper class. We can now call the beats method on the receiver to check whether the receiver can beat the target object. If so, we know player one won otherwise player two won.\r\n\r\nWhen we first make the :\r\n\r\n```ruby\r\nreceiver.beats(target)\r\n```\r\n\r\ncall, it calls back one of the following methods on the appropriate game item:\r\n\r\n```ruby\r\nbeatsPaper\r\nbeatsRock\r\nbeatsScissor\r\n```\r\n\r\nand inverts the boolean flag to return the result. This is double dispatch in action. Comparing this solution to the [Angry Rock Kata](http://www.rubyplus.com/articles/291 \"Angry Rock Kata\"), it might seem that this solution is complex. For this problem, it is true. If the problem involves objects with complicated logic, this solution is better. By using double dispatch we minimized conditional statements like if-else.\r\n\r\nExercises\r\n=========\r\n---------\r\n\r\n1. Clean up the dirty implementation by making the methods small and expressive. \r\n2. Add more specs for scenarios that we found in analysis section of this chapter.\r\n3. Compare your solution to the solution shown in the appendix of the appendix of the [Essential TDD book](http://www.rubyplus.com/etdd.pdf \"Essential TDD\") book. \r\n4. Are we ready to deploy this code to production?\r\n5. All tests pass. Test code is bad. Production code is bad. Can you ship the product ?\r\n','2014-07-30 05:10:39','2014-08-14 07:00:46'),(351,'TDD Advanced Concepts : Dealing with External API','Objectives\r\n==========\r\n----------\r\n\r\n- How to deal with third party API?\r\n- How to use thin adapter layer to insulate domain code from external API?\r\n- What does abusing mocks look like?\r\n- Example of brittle tests that break even when the behavior does not change, caused by mock abuse.\r\n- Integration tests should test the layer that interacts with external API.\r\n- Using too many mocks indicate badly designed API. \r\n\r\nDiscussion \r\n==========\r\n----------\r\n\r\nThe focus of this article is to fix the bad coding practices found in the Twitter Client example from the Pragmatic Programmer\'s Continuous Testing book.\r\n  \r\nSteps\r\n=========\r\n---------\r\n\r\nStep 1\r\n-------\r\n\r\nFollow the steps below for installation:\r\n\r\n```ruby\r\n$gem install jeweler\r\n$jeweler --rspec twits\r\n$cd twits\r\n$bundle\r\n```\r\n\r\nThe source code for this article can be found at : https://github.com/bparanj/twits\r\n\r\nStep 2\r\n-------\r\n\r\nRun\r\n\r\n```ruby\r\n$rspec spec/twits_spec.rb \r\n```\r\n\r\nfrom the root of the project to run the specs. The generated code fails with the error:\r\n\r\n```ruby\r\n1) Twits fails\r\n   Failure/Error: fail \r\n     \"hey buddy, you should probably rename this file and start specing for real\"\r\n   RuntimeError:\r\n      hey buddy, you should probably rename this file and start specing for real\r\n```\r\n\r\nStep 3\r\n--------\r\n\r\nThe following twits_spec.rb hits the live server.\r\n\r\n```ruby\r\nrequire File.expand_path(File.dirname(__FILE__) + \'/spec_helper\')\r\nrequire \'user\'\r\n\r\ndescribe \"Twitter User\" do\r\n  context \"with a username\" do\r\n    before(:each) do\r\n      @user = User.new\r\n      @user.twitter_username = \'logosity\'\r\n    end\r\n    \r\n    it \"provides the last five tweets from twitter\" do\r\n      tweets = [\"race day! http://t.co/nHVyd7s3 #fb\",\r\n                \"toy to inspire: http://t.co/koMadie2 #fb\",\r\n                \"just drove the route: http://t.co/nHVyd7s3 #fb\",\r\n                \"Son is declaring that the Honey Badger is his second favorite animal.\",\r\n                \"If you want to sail your ship in a different direction.\"]\r\n      \r\n      @user.last_five_tweets.should == tweets \r\n    end\r\n  end\r\nend\r\n```\r\n\r\nStep 4\r\n---------\r\n\r\nCreate user.rb under lib directory with the following code:\r\n\r\n```ruby\r\nrequire \'twitter\'\r\n\r\nclass User\r\n  attr_accessor :twitter_username\r\n  \r\n  def last_five_tweets\r\n    return Twitter::Search.new.per_page(5).from(@twitter_username).map do |tweet|\r\n      tweet[:text]\r\n    end.to_a\r\n  end\r\nend\r\n```\r\n\r\nStep 5\r\n-----------\r\n\r\nThere is no change to user.rb from previous step. The twits_spec.rb now looks like this:\r\n\r\n```ruby\r\nrequire File.expand_path(File.dirname(__FILE__) + \'/spec_helper\')\r\nrequire \'user\'\r\n\r\ndescribe \"Twitter User\" do\r\n  context \"with a username\" do\r\n    before(:each) do\r\n      @user = User.new\r\n      @user.twitter_username = \'logosity\'\r\n    end\r\n    \r\n    it \"provides the last five tweets from twitter\" do\r\n      tweets = [\r\n        {text: \'tweet1\'},\r\n        {text: \'tweet2\'},\r\n        {text: \'tweet3\'},\r\n        {text: \'tweet4\'},\r\n        {text: \'tweet5\'},\r\n        ]\r\n      \r\n      mock_client = mock(\'client\')\r\n      mock_client.should_receive(:per_page).with(5).and_return(mock_client)\r\n      mock_client.should_receive(:from).with(\'logosity\').and_return(tweets)\r\n      Twitter::Search.should_receive(:new).and_return(mock_client)\r\n      \r\n      @user.last_five_tweets.should == %w{tweet1 tweet2 tweet3 tweet4 tweet5} \r\n    end\r\n  end\r\nend\r\n```\r\n\r\nThere is too much mocking in this version. The intent of the test gets lost in the noise. This version abuses mocks. Spec is tightly coupled to the implementation of the method and is brittle. It will break even when the behavior does not change but the implementation changes. That can happen when you upgrade Twitter gem.\r\n\r\nStep 6\r\n--------\r\n\r\nLet\'s fix the mock abuse problem in twits_spec.rb as follows:\r\n\r\n```ruby\r\nrequire File.expand_path(File.dirname(__FILE__) + \'/spec_helper\')\r\nrequire \'user\'\r\n\r\ndescribe \"Twitter User\" do\r\n  context \"with a username\" do\r\n    before(:each) do\r\n      @user = User.new\r\n      @user.twitter_username = \'logosity\'\r\n    end\r\n\r\n    it \"provides the last five tweets from twitter\" do\r\n      tweets = %w{tweet1 tweet2 tweet3 tweet4 tweet5} \r\n      Twits.stub(:fetch_tweets).and_return(tweets)\r\n\r\n      @user.last_five_tweets.should == tweets \r\n    end\r\n  end\r\nend\r\n```\r\n\r\nStub is used to disconnect from Twitter client API. The test now depends on our API, fetch_tweets in our Twits class. This is stable than having a direct dependency on a third party API.\r\n\r\nStep 7\r\n--------\r\n\r\nCreate twits.rb with the following code:\r\n\r\n```ruby\r\nrequire \'twitter\'\r\n\r\nclass Twits\r\n  def self.fetch_tweets(username)\r\n    Twitter::Search.new.per_page(5).from(username).map do |tweet|\r\n      tweet[:text]\r\n    end.to_a\r\n  end\r\nend\r\n```\r\n\r\nThe fetch_tweets method must hit the Twitter sandbox in the integration test so that we can make sure our code can integrate with the third-party API. The API provided by Twits is a thin wrapper around the actual Twitter API. It insulates the changes in Twitter API from impacting the domain code.\r\n\r\nStep 8\r\n--------\r\n\r\nChange the user.rb to delegate the fetching of tweets to the Twits class like this:\r\n\r\n```ruby\r\nrequire \'twits\'\r\n\r\nclass User\r\n  attr_accessor :twitter_username\r\n  \r\n  def last_five_tweets\r\n    Twits.fetch_tweets(@twitter_username)\r\n  end\r\nend\r\n```\r\n\r\nNow the domain object user does not directly deal with communicating to a remote service. That is the job of the service layer implemented in Twits class.\r\n\r\nStep 9\r\n-------------\r\n\r\nThe twits_spec.rb now uses dependency injection to inject a fake twitter client to break the dependency. \r\n\r\n```ruby\r\nrequire File.expand_path(File.dirname(__FILE__) + \'/spec_helper\')\r\nrequire \'user\'\r\nrequire \'fake_twitter_client\'\r\n\r\ndescribe \"Twitter User\" do\r\n  context \"with a username\" do\r\n    before(:each) do\r\n      @user = User.new\r\n      @user.twitter_username = \'logosity\'\r\n    end \r\n\r\n    it \"should provide the last five tweets from twitter\" do\r\n      twits = Twits.new(FakeTwitterClient.new)\r\n			\r\n			expected_tweets = %w{tweet1 tweet2 tweet3 tweet4 tweet5} \r\n      @user.last_five_tweets.should == expected_tweets\r\n    end\r\n  end\r\nend\r\n```\r\n\r\nHere is the code for twits.rb:\r\n\r\n```ruby\r\nclass Twits\r\n   \r\n  def initialize(client)\r\n    @client = client\r\n  end\r\n \r\n  def fetch_five(username)\r\n   @client.per_page(5).from(username).map do |tweet|\r\n     tweet[:text]\r\n   end.to_a  \r\n  end\r\nend\r\n```\r\n\r\nThis version does not hard code the name of the class. So we don\'t have dependency on a specific class. This technique gives us more flexibility. Here is the code for fake_twitter_client.rb.\r\n\r\n```ruby\r\nclass FakeTwitterClient\r\n  def per_page(n)\r\n    self\r\n  end\r\n  \r\n  def from(username)\r\n    tweets = [{ :text => \'tweet1\'},\r\n              { :text => \'tweet2\'},\r\n              { :text => \'tweet3\'},\r\n              { :text => \'tweet4\'},\r\n              { :text => \'tweet5\'}]\r\n  end\r\nend\r\n```\r\n\r\nIf there are lot of methods, then using the FakeTwitterClient is not a good idea due to the headache of keeping the fake class in synch with Twitter API changes. Ideally FakeTwitterClient must be developed and maintained by Twitter. Twitter should provide the fake version for developers to use in test environment. The focus in this version is to show how to use dependency injection.\r\n\r\nDiscussion\r\n===========\r\n-----------\r\n\r\nThe book Continuous Testing with Ruby, Rails and Javascript by Ben Rady & Rod Coffin uses mocks in the tests to write the tests for Mongodb. Because we have never used this db before, it shows breaking dependencies by testing against a real service and then replacing those interactions with mocks. This results in lot of mocks in the tests. \r\n\r\nUsing mocks in this case is improper usage of mocks. Because you cannot drive the design of a third-party API (Mongodb API in this case). There is a better way to breaking the external dependencies. \r\n	\r\n1. First write [learning specs](http://www.rubyplus.com/articles/361 \"Learning Specs\"). \r\n2. Then create a thin adapter layer that has well defined interface. This adapter layer will encapsulate the interaction with Mongodb. Now you can mock the thin adapter layer in your code and write integration tests for the adapter that will interact with Mongodb. \r\n\r\nThis prevents the changes in Mongodb API from impacting the domain code. It also prevents technical terminology from leaking into our domain code. This is discussed in more detail in the book, Growing Object Oriented System Guided by Tests by Nat Pryce. \r\n\r\nExercise\r\n========\r\n---------\r\n\r\nRead the learning specs for mongodb https://github.com/bparanj/mongodb_specs','2014-07-30 06:46:18','2014-08-14 07:07:19'),(361,'TDD Basics : Learning Specs','Objectives\r\n============\r\n------------\r\n\r\n - Why do we need learning specs?\r\n - How to write learning specs?\r\n\r\nDiscussion\r\n==============\r\n--------------\r\n\r\nJ. B. Rainsberger says in this blog post at http://blog.thecodewhisperer.com/2011/12/14/when-to-write-learning-tests/ :\r\n\r\nWhen you try to learn a new library at the same time as you explore the behavior and design of your application, you slow down more than you think.\r\n\r\nWhen you can’t figure out how to make the new library work for this thing you want to build, you might spend hours fighting, debugging, swearing.\r\n\r\nStop. Write a Learning Test.\r\n\r\n1. Write a new test.\r\n2. Write a test that checks the things you tried to check earlier with debug statements.\r\n3. Write a test that has nothing to do with your application and its domain.\r\n4. Remove unnecessary details from your test.\r\n\r\nWhen this test passes, then you understand what that part of the library does. If it behaves strangely, then you have the perfect test to send to the maintainers of the library.\r\n\r\nExample 1 : Mongodb Koans\r\n==========================\r\n--------------------------\r\n\r\nStep 1\r\n--------\r\n\r\nThe Mongodb koans are focused on learning Mongodb. \r\n\r\n```ruby\r\n$git clone https://github.com/bparanj/mongodb-koans\r\n```\r\n\r\nStep 2\r\n---------\r\n\r\nRead the README file for more instructions.\r\n\r\nVersion 1\r\n==========\r\n----------\r\n\r\nStep 1\r\n--------\r\n\r\nFirst version contains the exercises. Go to the directory where you have mongodb-koans checked out and switch to the initial version by:\r\n\r\n```ruby\r\n$git co 578061ea13bfb2afd85ca7bcf2f3f92a908caa69\r\n```\r\n\r\nStep 2\r\n--------\r\n\r\nTo run the tests:\r\n\r\n```ruby\r\n$ruby path_to_enlightenment.rb\r\n```\r\n\r\nVersion 2\r\n==========\r\n----------\r\n\r\nSecond version is the solution to all the exercises. You can compare your solution by browsing the source at https://github.com/bparanj/mongodb-koans\r\n\r\nExample 2 : Mongodb Learning Specs\r\n==================================\r\n----------------------------------\r\n\r\nStep 1\r\n--------\r\n\r\nDownload learning Mongodb specs:\r\n\r\n```ruby\r\n$git clone https://github.com/bparanj/mongodb_specs\r\n```\r\n\r\nStep 2\r\n--------\r\n\r\nThe specs needs Mongodb version v1.6.2. to be running. Follow the installation instructions for Mongodb on its home page. To run Mongo daemon:\r\n\r\n```ruby\r\n$mongod --dbpath /Users/bparanj/data/mongodb\r\n```\r\n\r\nStep 3\r\n--------\r\n\r\nTo run the spec:\r\n\r\n```ruby\r\n$rspec mongodb_queries_spec.rb \r\n```\r\n\r\nExample 3 : RSpec Learning Specs\r\n================================\r\n--------------------------------\r\n\r\nRead the specs to describe features of RSpec at https://www.relishapp.com/rspec\r\nHere is an example:  https://www.relishapp.com/rspec/rspec-mocks/v/2-10/docs/method-stubs/as-null-object\r\n\r\nExercise\r\n=========\r\n---------\r\n\r\nWrite learning specs for a gem that you would like to learn.','2014-07-30 07:14:48','2014-08-14 07:13:14'),(371,'TDD Basics : String Calculator Kata','Objectives\r\n==========\r\n----------\r\n\r\n- Triangulate to solve the problem\r\n- Experiment to learn and explore possible solution\r\n- Refactoring when there is no duplication to write intent revealing code\r\n- Simplifying method signature\r\n\r\nDifficulty Level\r\n=========\r\n----------------\r\n\r\nMedium\r\n\r\nProblem Statement\r\n=================\r\n-----------------\r\n\r\n- Try not to read ahead.\r\n- Do one task at a time. The trick is to learn to work incrementally.\r\n- Make sure you only test for correct inputs. There is no need to test for invalid inputs for this kata.\r\n\r\n```ruby\r\n1. Create a simple String Calculator with a method add(string containing numbers)\r\n  - The method can take 0, 1 or 2 numbers, and will return their sum (for an empty string it will return 0) for example \'\', \'1\' or \'1,2\'.\r\n  - Start with the simplest test case of an empty string and move to 1 and two numbers.\r\n  - Remember to solve things as simply as possible so that you force yourself to write tests you did not think about.\r\n  - Remember to refactor after each passing test.\r\n2. Allow the add method to handle an unknown amount of numbers.\r\n3. Allow the add method to handle newlines between numbers (instead of commas)\r\n	- The following input is ok: \'1\\n2,3\' (will equal 6)\r\n	- The following input is NOT ok: \'1,\\n\' (no need to prove it - just clarifying)\r\n4. Support different delimiters\r\n	- To change a delimiter, the beginning of the string will contain a separate line that looks like this: \'//[delimiter]\\n[numbers...]\' for example \'//;\\n1;2\' should return three where the default delimiter is \';\'\r\n	- The first line is optional. All existing scenarios should still be supported.\r\n```\r\n\r\nThis TDD Kata is by Roy Osherove found at : http://osherove.com/tdd-kata-1/. Follow the guidelines and write the specs. Compare your solution to the following solution.\r\n  \r\nSteps\r\n=========\r\n---------\r\n\r\nStep 1\r\n-------\r\n\r\n```ruby\r\nclass Calculator\r\n  def calculate(input)\r\n	  input.to_i\r\n  end\r\nend\r\n\r\ndescribe Calculator do\r\n  let(:calculator) {  Calculator.new }\r\n\r\n  it \"returns 0 for an empty string\" do\r\n    result = calculator.calculate(\"\")\r\n    \r\n    result.should == 0\r\n  end\r\n  \r\n  it \"returns 1 for a string containing 1\" do\r\n    result = calculator.calculate(\"1\")\r\n    \r\n    result.should == 1    \r\n  end\r\n    \r\nend\r\n```\r\n\r\nDiscussion\r\n===========\r\n-----------\r\n\r\n>> If I get stuck and I don’t know how a complex algorithm should work I’ll write a test for an error case. Then I’ll write a test for the simplest non-error case I can think of and return a hard coded value. Then I’ll write another test case and see if I can figure out the algorithm at that point. In doing so I gain some momentum and perhaps some insight in how the algorithm should behave on an edge case and a few normal cases.\r\n\r\n>> This is called triangulation and it was used in celestial navigation for thousands of years. It is easier to see you are moving when you compare your position to two or more points on the horizon rather than just one. The same applies to coding; it is often easier to figure out the behavior of an algorithm by examining a couple of test cases instead of just one.\r\n\r\nFrom a blog post on [Triangulation](http://tobeagile.com/2009/12/08/triangulation/ \"Triangulation\") by David Bernstein. Let\'s now triangulate and implement the real solution. \r\n\r\nStep 2\r\n----------\r\n\r\n```ruby\r\nclass Calculator\r\n  def calculate(input)\r\n    strings = input.split(\',\')\r\n    numbers = strings.map{|x| x.to_i}\r\n    numbers.inject{|sum, n| sum + n}\r\n  end\r\nend\r\n\r\ndescribe Calculator do\r\n  let(:calculator) {  Calculator.new }\r\n\r\n  it \"returns 0 for an empty string\" do\r\n    result = calculator.calculate(\"\")\r\n    \r\n    result.should == 0\r\n  end\r\n  \r\n  it \"returns 1 for a string containing 1\" do\r\n    result = calculator.calculate(\"1\")\r\n    \r\n    result.should == 1    \r\n  end\r\n  \r\n  it \"returns the sum of the numbers for \'1,2\'\" do\r\n    result = calculator.calculate(\"1,2\")\r\n    \r\n    result.should == 3        \r\n  end\r\n  \r\nend\r\n```\r\n\r\nStarted with the simplest test case of an empty string and moved to 1 and two numbers. Experimented in irb to get the generic solution working. Copied the code to calculate method to get the test passing. This broke the test #1. Let\'s fix that now.\r\n\r\nStep 3\r\n----------\r\n\r\nAdded a guard condition to handle the blank string edge case.\r\n\r\n```ruby\r\nclass Calculator\r\n  def calculate(input)\r\n    if input.include?(\',\')\r\n      strings = input.split(\',\')\r\n      numbers = strings.map{|x| x.to_i}\r\n      numbers.inject{|sum, n| sum + n}\r\n    else\r\n      input.to_i\r\n    end\r\n  end\r\nend\r\n```\r\n\r\nStep 4\r\n-----------\r\n\r\nRefactored in green state. Made the methods smaller. Method names expressive and focused on doing just one thing.\r\n\r\n```ruby\r\nclass Calculator\r\n  def calculate(input)\r\n    if input.include?(\',\')\r\n      numbers = convert_string_to_integers(input)\r\n      calculate_sum(numbers)\r\n    else\r\n      input.to_i\r\n    end\r\n  end\r\n  \r\n  private\r\n  \r\n  def convert_string_to_integers(input)\r\n    strings = input.split(\',\')\r\n    strings.map{|x| x.to_i}\r\n  end\r\n  \r\n  def calculate_sum(numbers)\r\n    numbers.inject{|sum, n| sum + n}\r\n  end\r\nend\r\n```\r\n\r\nNote that this refactoring was not about duplication. The focus was to write intent revealing code.\r\n\r\nStep 5\r\n-----------\r\n\r\nFrom the requirements, the spec for the next task:\r\n\r\n```ruby\r\nit \'can add unknown amount of numbers\' do\r\n  result = calculator.calculate(\"1,2,3,4\")\r\n  \r\n  result.should == 10           \r\nend\r\n```\r\n\r\nStep 6\r\n-----------\r\n\r\nThis test passes without failing. So we mutate the code to make the test fail:\r\n\r\n```ruby\r\ndef calculate_sum(numbers)\r\n  return 0 if numbers.size == 4\r\n  numbers.inject{|sum, n| sum + n}\r\nend\r\n```\r\n\r\nStep 7\r\n--------------\r\n\r\nNow we make the test pass by removing the short-circuit statement : \r\n\r\n```ruby\r\nreturn 0 if numbers.size == 4\r\n```\r\n\r\n```ruby\r\ndef calculate_sum(numbers)\r\n  numbers.inject{|sum, n| sum + n}\r\nend\r\n```\r\n\r\nStep 8\r\n----------------\r\n\r\nAdd the following statement to the calculator_spec.rb:\r\n\r\n```ruby\r\nrequire_relative \'calculator\' \r\n```\r\n\r\nStep 9\r\n-------------\r\n\r\nMove the calculator class to its own file. All specs should pass.\r\n\r\nStep 10\r\n--------------\r\n\r\n```ruby\r\nit \'allows new line also as a delimiter\' do\r\n  result = calculator.calculate(\"1\\n2,3\")\r\n  \r\n  result.should == 6\r\nend\r\n```\r\n\r\nThis test fails. \r\n\r\nStep 11\r\n-----------\r\n\r\nTo make it pass the calculator method now calls normalize_delimiter() method:\r\n\r\n```ruby\r\nclass Calculator\r\n\r\n  def calculate(input)\r\n    normalize_delimiter(input)\r\n    if input.include?(\',\')\r\n      numbers = convert_string_to_integers(input)\r\n      calculate_sum(numbers)\r\n    else\r\n      input.to_i\r\n    end\r\n  end\r\n  \r\n  private\r\n    \r\n  def normalize_delimiter(input)\r\n    input.gsub!(\"\\n\", \',\')\r\n  end\r\n  ... Other methods are the same ...\r\nend\r\n```\r\n\r\nStep 12\r\n------------\r\n\r\nAfter experimenting in the irb and learning about the String API, the quick and dirty implementation looks like this:\r\n\r\n```ruby\r\nclass Calculator\r\n\r\n  def calculate(input)\r\n    if input.start_with?(\'//\')\r\n      @delimiter = input[2]\r\n      @string = input[4, input.length - 1]\r\n    else\r\n      @delimiter = \"\\n\"\r\n      @string = input\r\n    end\r\n      \r\n    normalize_delimiter\r\n    if @string.include?(\',\')\r\n      numbers = convert_string_to_integers\r\n      calculate_sum(numbers)\r\n    else\r\n      @string.to_i\r\n    end\r\n  end\r\n  \r\n  private\r\n  \r\n  def convert_string_to_integers\r\n    strings = @string.split(\',\')\r\n    strings.map{|x| x.to_i}\r\n  end\r\n  \r\n  def calculate_sum(numbers)\r\n    numbers.inject{|sum, n| sum + n}\r\n  end\r\n  \r\n  def normalize_delimiter\r\n    @string.gsub!(@delimiter, \',\')\r\n  end\r\nend\r\n```\r\n\r\nStep 13\r\n---------\r\n\r\nAfter Cleanup :\r\n\r\n```ruby\r\nclass Calculator\r\n\r\n  def calculate(input)\r\n    initialize_delimiter_and_input(input)  \r\n    normalize_delimiter\r\n    if @string.include?(\',\')\r\n      numbers = convert_string_to_integers\r\n      calculate_sum(numbers)\r\n    else\r\n      @string.to_i\r\n    end\r\n  end\r\n  \r\n  private\r\n  \r\n  def initialize_delimiter_and_input(input)\r\n    if input.start_with?(\'//\')\r\n      @delimiter = input[2]\r\n      @string = input[4, input.length - 1]\r\n    else\r\n      @delimiter = \"\\n\"\r\n      @string = input\r\n    end\r\n  end\r\n\r\n  def convert_string_to_integers\r\n    strings = @string.split(\',\')\r\n    strings.map{|x| x.to_i}\r\n  end\r\n  \r\n  def calculate_sum(numbers)\r\n    numbers.inject{|sum, n| sum + n}\r\n  end\r\n  \r\n  def normalize_delimiter\r\n    @string.gsub!(@delimiter, \',\')\r\n  end\r\nend\r\n```\r\n\r\nWe are not passing in the string to be processed into methods anymore. Since it is needed by most of the methods, it is now an instance variable. We removed the argument to the private methods to simplify the interface.\r\n\r\nSummary\r\n===========\r\n-----------\r\n\r\nIn this article you learned about Triangulation. When you apply Triangulation, you write tests for 0, 1, 2 element cases and finally generalize by extending the solution to any number of **n** elements. ','2014-07-30 08:00:14','2014-09-07 17:39:49'),(381,'Essential Skills for TDD','Essential Skills for TDD Presentation Videos\r\n============================================\r\n--------------------------------------------\r\n\r\n[Essential Skills for TDD Part 1](https://www.youtube.com/watch?v=y5j_nHzWkeg \"Essential Skills for TDD Part 1\")\r\n[Essential Skills for TDD Part 2](https://www.youtube.com/watch?v=vVcC6iRHMkM \"Essential Skills for TDD Part 2\")\r\n\r\nEssential Skills for TDD Terminology\r\n=====================================\r\n-------------------------------------\r\n \r\nDomain\r\n==========\r\n----------\r\n\r\nA specified sphere of activity or knowledge.\r\n\r\nExamples\r\n---------\r\n\r\n - Contour\r\n - Contrast\r\n - Opacity\r\n - Form\r\n \r\nThese concepts can be grouped into the Visual Communication domain. Visual communication is the domain of the graphic designers.\r\n\r\nIn Finance domain you find terms such as:\r\n\r\n - Equity\r\n - Debt\r\n - Gross Margin\r\n - Net Income\r\n\r\nThese concepts can be grouped into the Finance domain. \r\n\r\n - Parallel\r\n - Ordinate\r\n - Arc\r\n - Angle\r\n\r\nThese concepts can be grouped into the Math domain. \r\n\r\nProblem Domain\r\n==============\r\n--------------\r\n\r\nProblem domain refers to real-world things and concepts related to the problem.\r\n\r\nProblem Domain Analysis\r\n=======================\r\n-----------------------\r\n\r\nProblem Domain Analysis is the process of creating a mental model that describes the problem. The focus is on understanding the problem domain.\r\n\r\nSolution Domain \r\n===============\r\n---------------\r\n\r\nSolution Domain refers to real-world things and concepts related to the solution.\r\n\r\nSolution Domain Analysis\r\n========================\r\n------------------------\r\n\r\nSolution Domain Analysis is the process of arriving at a solution. It describes the sequence of steps used to solve a given problem. Finding abstractions helps us to solve problems.','2014-08-01 16:38:28','2014-08-14 07:21:53'),(391,'Destroy All Software Screencast Reviews','Fast Tests With and Without Rails Episode Review\r\n===================================================\r\n\r\nThe specs in the final solution abuses mock by mocking the ActiveRecord API. The expectation mocks update_attributes. He says the solution only depends on RSpec and specs run outside of Rails, so the specs run fast. The problem is that the dependency on Rails exists because of the coupling created by the mocking of ActiveRecord. The tests are now brittle and can break when you upgrade Rails if the active record API changes.\r\n\r\nBefore\r\n-------\r\n\r\n```ruby\r\nalice.should_receive(:update_attributes).with(happiness => 60)\r\n```\r\n\r\nThis ties the test to implementation. Here is a better way:\r\n\r\nAfter\r\n--------\r\n\r\n```ruby\r\nexpect do\r\n  alice.nice_walk\r\nend.to increase(:happiness).by(60)\r\n```\r\n\r\nThis simplifies outcomes and does not break when implementation of ActiveRecord changes (for instance, when you upgrade the Rails framework).\r\n\r\nGrowing a Test Suite Episode Review\r\n===================================================\r\n\r\nThis is the review of the solution discussed in Growing a Test Suite screencast. Here is a list of things that the solution violates:\r\n\r\n1. [Separate Command from Query](http://www.rubyplus.com/articles/281 \"Command Query Separation Principle\").\r\n     digest() method is a command. digest() method should not return any value\r\n2. Allocate responsibilities to the right class.\r\n    digest() method does not belong to the Cheese class. Semantically it does not make any sense. Only a living organism can digest food.\r\n3. Law of Demeter.\r\n\r\nHere is my solution:\r\n\r\n```ruby\r\nclass Walrus\r\n  attr_reader :energy\r\n \r\n  def initialize\r\n    @energy = 0\r\n  end\r\n \r\n  def eat(food)\r\n    digest\r\n    @energy += food.energy\r\n  end\r\n \r\n  private\r\n \r\n  def digest\r\n    p \'Digesting happens inside my body...\'\r\n  end\r\nend\r\n\r\nclass Cheese\r\n  def energy\r\n    100\r\n  end\r\nend\r\n\r\n\r\ncheese = Cheese.new\r\nw  = Walrus.new\r\n\r\np \"Energy before eating is : #{w.energy}\"\r\n\r\nw.eat(cheese)\r\n\r\np \"Energy now is : #{w.energy}\" \r\n```','2014-08-01 16:43:32','2014-08-13 04:56:30'),(401,'Stubs are not Mocks - Concise Version of Martin Fowler\'s Article','Stubs\r\n================\r\n----------------\r\n\r\nA common helper to testing environments. There is a difference in how test results are verified: a distinction between state verification and behavior verification. Focusing on one element of the software at a time -hence the common term unit testing. The problem is that to make a single unit work, you often need other units.\r\n\r\nStubs provide canned answers to calls made during the test, usually not responding at all to anything outside what\'s programmed in for the test. Stubs may also record information about calls, such as an email gateway stub that remembers the messages it \'sent\', or maybe only how many messages it \'sent\'.\r\n\r\nDummy Objects\r\n================\r\n----------------\r\n\r\nDummy objects are passed around but never actually used. Usually they are just used to fill parameter lists.\r\n\r\nFake Objects\r\n================\r\n----------------\r\n\r\nFake objects actually have working implementations, but usually take some shortcut which makes them not suitable for production (an in memory database is a good example). For a concrete example, read the article [How to Use Fakes to Speed Up Tests](http://www.rubyplus.com/articles/261 \"How to Use Fakes to Speed Up Tests\")\r\n\r\nMocks\r\n================\r\n----------------\r\n\r\nMocks are what we are talking about here: objects pre-programmed with expectations which form a specification of the calls they are expected to receive.\r\n\r\nOnly mocks insist upon behavior verification. The other doubles can, and usually do, use state verification. For a concrete example, read the article on [Fake and Mocks] (http://www.rubyplus.com/articles/141 \"Fakes and Mocks\")\r\n\r\nDiscussion\r\n================\r\n----------------\r\n\r\nThe classical TDD style is to use real objects if possible and a double if it\'s awkward to use the real thing. A mockist TDD practitioner, however, will always use a mock for any object with interesting behavior.\r\n\r\nAn acknowledged issue with state-based verification is that it can lead to creating query methods only to support verification. It\'s never comfortable to add methods to the API of an object purely for testing, using behavior verification avoids that problem. ','2014-08-04 06:37:22','2014-08-14 06:11:00'),(411,'What vs How in Test Driven Development','Example #1 for What vs How\r\n===========================\r\n---------------------------\r\n\r\nMusic sheet is not music. It is the description of music. This is the **What** or Logical Design.\r\n\r\n![Music Sheet](https://images.rubyplus.com/music_sheet.png \"Music Sheet\")\r\n\r\nMusic is played using musical instruments. This is the \'How\' or the Physical Design. There are many physical designs for a given logical design. This means a musician can use different instruments at different times to play the music from the same music sheet.\r\n\r\nExample #2 for What vs How\r\n===========================\r\n---------------------------\r\n\r\nJohn Lennon wrote the song Come Together. This is the **What**. The examples of **How** in this case are the performances of :\r\n\r\n- Beatles\r\n- Aerosmith\r\n- Michael Jackson\r\n\r\nto the same song Come Together.\r\n\r\nWhat vs How\r\n===========================\r\n---------------------------\r\n\r\n![alt text](https://images.rubyplus.com/what-vs-how.png \"What vs How\")\r\n\r\nIf you find this diagram overwhelming, don\'t worry, I will build this diagram gradually in my upcoming TDD course. \r\n\r\nSeparate Logical Design from Physical Design \r\n============================================\r\n--------------------------------------------\r\n\r\nWhy do we need to separate logical design from physical design? Because it allows us to change implementation without breaking the tests. \r\n\r\n![alt text](https://images.rubyplus.com/bigstock_Time_For_Change.jpg \"Time to Change\")\r\n\r\nSo, how do you separate What from How in our code? Chris Stevenson\'s TestDox style expresses the subject in the code as part of a sentence.\r\n\r\n- A Sheep eats grass\r\n- A Sheep bleats when frightened\r\n- A Sheep produces delicious milk\r\n- A Sheep moves away from sheep dogs\r\n\r\nThis can be automatically converted to specifications in code :\r\n\r\n```ruby\r\ndescribe Sheep do\r\n  it \'eats grass\'\r\n  it \'bleats when frightened\'\r\n  it \'produces delicious milk\'\r\n  it \'moves away from sheep dogs\'\r\nend\r\n```\r\n\r\nWhen you think about the system from outside-in fashion you focus on intent. You focus on what you are doing rather than the implementation which is the \'how\'. Now that we understand the difference between the What and How. We know how to write the doc string. But what code should go between the do-end block of the it() method? To answer that question, let\'s look at the difference between imperative vs declarative programming.\r\n\r\nTechnique : Seeing at Different Abstract Levels\r\n===============================================\r\n-----------------------------------------------\r\n\r\nWe can see object and behavior at different levels:\r\n\r\n- At the **conceptual** level - a set of responsibilities.\r\n- At the **specification** level - set of methods that can be invoked. \r\n- At the **implementation** level - code and data. \r\n\r\nResponsibility is defined as an obligation to perform a task or know information. At the conceptual and specification level we are focused on **WHAT**. At the implementation level we deal with the **HOW**\r\n\r\nImperative Programming\r\n========================\r\n------------------------\r\n\r\nImperative programming is the oldest programming paradigm. It is based on the Von Neumann-Eckley model of a computer. Programs written in imperative programming languages consist of a program state and instructions that change the program state through assignment statements. Program instructions are imperative in the sense of imperative verbs that express a command.\r\n\r\nYou tell the machine HOW to do something and as a result what you want to happen will happen. Examples of imperative languages are assembly, Fortran, Algol, Cobol, Java, C/C++. These languages specify a sequence of operations for the computer to execute.\r\n\r\n>> Imperative Program = Algorithms + Data Structures\r\n>>  -- Nicholas Wirth\r\n\r\n```sh\r\nImperative Programming + Procedures = Procedural Programming\r\n```\r\n\r\nProcedural abstraction and structured programming are its design techniques. Procedural abstraction allows the programmer to be concerned mainly with the interface between the procedure and what it computes, ignoring the details of how the computation is accomplished. \r\n\r\nAbstraction allows us to think about \'what\' is being done, not \'how\' it is implemented. Imperative language constructs : assignment, conditionals, looping and data structures. Flowchart can be used to model imperative programs. For example flowchart for computing Fibonacci numbers.\r\n\r\nDeclarative Programming\r\n=========================\r\n-------------------------\r\n\r\nFunctional languages and logic languages are declarative. Declarative languages such as SQL, Haskell, Prolog describe the solution space. They provide the knowledge required to get there. They don\'t describe the steps needed to get there.\r\n\r\nYou tell the machine WHAT you would like to happen, let the machine figure out how to do it. \r\n\r\nDiscussion\r\n==========\r\n-----------\r\n\r\nThe tests that we write must be declarative. It should not be imperative. This means no implementation level details such as loops, conditionals or data structure should be in the tests. For an example illustrating how to eliminate loops in a test, read the article [Eliminating Loops in Specs](https://rubyplus.com/articles/111-TDD-Best-Practice-Eliminating-Loops-in-Tests \'Eliminating Loops in Tests\')\r\n\r\nReferences\r\n==========\r\n-----------\r\n\r\n1. [Test Driven Development: Ten Years Later](http://www.infoq.com/presentations/tdd-ten-years-later \"Ten Years Later by Michael Feathers and Steve Freeman\") by Michael Feathers and Steve Freeman\r\n\r\n2. [Presentation by Computer Science Assistant Professor Mary Ellen Weisskopf](http://www.cs.uah.edu/~weisskop/ \"Presentation by Computer Science Assistant Professor Mary Ellen\") \r\n\r\n3. A Brief Tour of Responsibility Driven Design. Presentation by Rebecca Wirfs-Brock.\r\n\r\nExercises\r\n==========\r\n----------\r\n1) Does the blueprint for a car focus on What or How ?\r\n\r\n![alt text](https://images.rubyplus.com/car-blueprint.jpg \"Car Blueprint\")\r\n\r\n2) Search YouTube and watch the videos for Come Together performed by The Beatles, Michael Jackson, Aerosmith and Elton John ','2014-08-04 07:16:17','2016-12-22 08:06:47'),(421,'TDD Basics : FizzBuzz Kata','Objectives\r\n============\r\n------------\r\n\r\n- To practice Test Driven Development.\r\n- TDD and Double Entry Bookkeeping.\r\n- Learn how to order test cases.\r\n\r\nDifficulty Level\r\n================\r\n----------------\r\n\r\nEasy\r\n\r\nSoftware Version\r\n================\r\n----------------\r\n\r\nRuby 2.1.2, rspec 3.0\r\n\r\nProblem Statement\r\n=================\r\n-----------------\r\n\r\nWrite a program that prints the numbers from 1 to 100. But for multiples of three print \'Fizz\' instead of the number and for the multiples of five print \"Buzz\". For numbers which are multiples of both three and five print \"FizzBuzz\". Sample output:\r\n\r\n```sh\r\n1\r\n2\r\nFizz\r\n4\r\nBuzz\r\n7\r\n8\r\nFizz\r\nBuzz\r\n11\r\nFizz\r\n13\r\n14\r\nFizzBuzz\r\n16\r\n17\r\nFizz\r\n19\r\nBuzz\r\n\r\n... upto 100.\r\n```\r\n\r\nSteps\r\n============\r\n------------\r\n\r\nStep 1\r\n------------\r\n\r\nCreate a file `fizz_buzz_spec.rb` with the following contents:\r\n\r\n```ruby\r\ndescribe FizzBuzz do\r\n  \r\nend\r\n```\r\n\r\nStep 2\r\n------------\r\n\r\nRun the spec with the following command:\r\n\r\n```ruby\r\n $spec fizz_buzz_spec.rb \r\n```\r\n\r\nWe get the error:\r\n\r\n```sh\r\n can\'t find gem rspec-core ([\">= 0\"]) with executable spec (Gem::GemNotFoundException)\r\n	from /usr/local/bin/spec:19:in `<main>\'\r\n```\r\n\r\nStep 3\r\n------------\r\n\r\nYou will get that error if you use spec instead of rspec. Run the spec with the correct command as follows:\r\n\r\n```ruby\r\n$rspec fizz_buzz_spec.rb \r\n```\r\n\r\nStep 4\r\n------------\r\n\r\nNow we are failing for the right reason with the following error:\r\n\r\n```ruby\r\nfizz_buzz_spec.rb:3:in `<top (required)>\': uninitialized constant FizzBuzz (NameError)\r\n```\r\n\r\nStep 5\r\n------------\r\n\r\nDefine an empty class on top of the `fizz_buzz_spec.rb` as follows:\r\n\r\n```ruby\r\nclass FizzBuzz\r\nend\r\n```\r\n\r\nStep 6\r\n------------\r\n\r\nWhen you run the spec now, you get 0 passed and 0 failures. \r\n\r\n```ruby\r\n$rspec fizz_buzz_spec.rb \r\nNo examples found.\r\n\r\nFinished in 0.00019 seconds (files took 0.14497 seconds to load)\r\n0 examples, 0 failures\r\n```\r\n\r\nStep 7\r\n------------\r\n\r\nChange the `fizz_buzz_spec.rb` as follows:\r\n\r\n```ruby\r\ndescribe FizzBuzz do\r\n  it \'should print Fizz for multiples of 3\'\r\nend\r\n```\r\n\r\nStep 8\r\n------------\r\n\r\nWe now get the following not implemented pending message with 1 pending example.\r\n\r\n```ruby\r\n$rspec fizz_buzz_spec.rb \r\n\r\nFizzBuzz\r\n  should print Fizz for multiples of 3 (PENDING: Not yet implemented)\r\n\r\nPending:\r\n  FizzBuzz should print Fizz for multiples of 3\r\n    # Not yet implemented\r\n    # ./fizz_buzz_spec.rb:5\r\n\r\nFinished in 0.00054 seconds (files took 0.11491 seconds to load)\r\n1 example, 0 failures, 1 pending\r\n```\r\n\r\nStep 9\r\n------------\r\n\r\nLet\'s write our first test. Change the `fizz_buzz_spec.rb` to :\r\n\r\n```ruby\r\n  it \'should print Fizz for multiples of 3\' do\r\n    game = FizzBuzz.new\r\n    \r\n    # How should I check the printing output here?\r\n  end\r\n```\r\n\r\nWhile writing the test, I got stuck after creating the instance of the FizzBuzz class. I faced difficulty in writing the test. The pain is an indication of a bad design. It is providing us feedback. We need to listen in order to come up with a better design that will make it easy to test our code. \r\n\r\nWhy should the sequence generation logic be tied to how it is displayed to the user? What if we obeyed the [Single Purpose Principle](https://rubyplus.com/articles/2641-Single-Purpose-Principle- \"Single Purpose Principle\") and separate displaying the sequence to the user from sequence generation logic?\r\n\r\nYou could also argue that this problem is due to wrong order of test cases. If we had thought about sequence of test cases that gradually increase in complexity, we would not have encountered this issue.\r\n\r\nStep 10\r\n------------\r\n\r\nLet\'s simplify our problem and write a test for sequence generation as follows:\r\n\r\n```ruby\r\ndescribe FizzBuzz do\r\n  it \'should generate numbers from 1 to 100\' do\r\n    game = FizzBuzz.new\r\n    \r\n    result = game.numbers\r\n    \r\n    expect(result).to eq((1..100).to_a)\r\n  end\r\n  \r\n  xit \'should print Fizz for multiples of 3\' do\r\n    \r\n  end\r\nend\r\n```\r\n\r\nI have commented out the previous test and added a new test that solves a smaller problem that\'s easier to solve.\r\n\r\nStep 11\r\n------------\r\n\r\nI experimented in the irb with the code:\r\n\r\n```ruby\r\n(1..100).to_a\r\n```\r\n\r\nto make sure it creates an array with the number 1 to 100. This is used in the assertion.\r\n\r\nStep 12\r\n------------\r\n\r\nWe now fail with the error:\r\n\r\n```ruby\r\n$rspec fizz_buzz_spec.rb \r\n\r\nFizzBuzz\r\n  should generate numbers from 1 to 100 (FAILED - 1)\r\n  should print Fizz for multiples of 3 (PENDING: Temporarily skipped with xit)\r\n\r\nPending:\r\n  FizzBuzz should print Fizz for multiples of 3\r\n    # Temporarily skipped with xit\r\n    # ./fizz_buzz_spec.rb:13\r\n\r\nFailures:\r\n\r\n  1) FizzBuzz should generate numbers from 1 to 100\r\n     Failure/Error: result = game.numbers\r\n     NoMethodError:\r\n       undefined method numbers for #<FizzBuzz:0x008c0>\r\n     # ./fizz_buzz_spec.rb:8:in block (2 levels) in <top (required)>\r\n\r\nFinished in 0.00059 seconds (files took 0.12402 seconds to load)\r\n2 examples, 1 failure, 1 pending\r\n\r\nFailed examples:\r\n\r\nrspec ./fizz_buzz_spec.rb:5 # FizzBuzz should generate number from 1 to 100\r\n```\r\n\r\nStep 13\r\n------------\r\n\r\nAdd the numbers method as follows:\r\n\r\n```ruby\r\nclass FizzBuzz\r\n  def numbers\r\n    \r\n  end\r\nend\r\n```\r\n\r\nStep 14\r\n------------\r\n\r\nRun the spec again.\r\n\r\n```ruby\r\n$rspec fizz_buzz_spec.rb \r\n\r\nFizzBuzz\r\n  should generate numbers from 1 to 100 (FAILED - 1)\r\n  should print Fizz for multiples of 3 (PENDING: Temporarily skipped with xit)\r\n\r\nPending:\r\n  FizzBuzz should print Fizz for multiples of 3\r\n    # Temporarily skipped with xit\r\n    # ./fizz_buzz_spec.rb:17\r\n\r\nFailures:\r\n\r\n  1) FizzBuzz should generate numbers from 1 to 100\r\n     Failure/Error: expect(result).to eq((1..100).to_a)\r\n       \r\n       expected: [1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, ... , 100]\r\n            got: nil\r\n       \r\n       (compared using ==)\r\n     # ./fizz_buzz_spec.rb:14:in `block (2 levels) in <top (required)>\'\r\n\r\nFinished in 0.00348 seconds (files took 0.28728 seconds to load)\r\n2 examples, 1 failure, 1 pending\r\n\r\nFailed examples:\r\n\r\nrspec ./fizz_buzz_spec.rb:9 # FizzBuzz should generate numbers from 1 to 100\r\n```\r\n\r\nStep 15\r\n------------\r\n\r\nWe are now failing for the right reason. Let\'s implement the numbers method as follows:\r\n\r\n```ruby\r\nclass FizzBuzz\r\n  \r\n  def numbers\r\n    (1..100).to_a\r\n  end\r\nend\r\n```\r\n\r\nWhat is the point of doing the same thing (1..100).to_a that is done in the test? A good explanation is Robert C. Martin\'s discussion of how [TDD is like double entry bookkeeping](http://butunclebob.com/ArticleS.UncleBob.TheSensitivityProblem \'Double Entry\') system in accounting. \r\n\r\n![alt text](https://images.rubyplus.com/sample_acctg_equation.gif \"Accounting Example\")\r\n\r\nIdeally if I had followed his suggestion I should have used a different way to create an array of 1 to 100. Since this is just a one-liner I have verified it manually and since my confidence level is high, I did not bother spending more time to find another way of generating the list of numbers.\r\n\r\nThis concept is even used in aircraft cockpit where the microprocessor from different companies are used in redundant circuits to increase reliability.\r\n\r\nStep 16\r\n------------\r\n\r\nRun the tests.\r\n\r\n```ruby\r\nFizzBuzz\r\n  should generate numbers from 1 to 100\r\n  should print Fizz for multiples of 3 (PENDING: Temporarily skipped with xit)\r\n\r\nPending:\r\n  FizzBuzz should print Fizz for multiples of 3\r\n    # Temporarily skipped with xit\r\n    # ./fizz_buzz_spec.rb:17\r\n\r\nFinished in 0.00117 seconds (files took 0.12041 seconds to load)\r\n2 examples, 0 failures, 1 pending\r\n```\r\n\r\nStep 17\r\n------------\r\n\r\nLet\'s explore in the irb to see how to implement the multiples of 3 functionality.\r\n\r\n```ruby\r\n $irb\r\n > 3 % 3\r\n => 0 \r\n > 6 % 3\r\n => 0 \r\n > 1 % 3\r\n => 1 \r\n > 2 % 3\r\n => 2 \r\n > 4 % 3\r\n => 1 \r\n > 5 % 3\r\n => 2 \r\n > 7 % 3\r\n => 1 \r\n > 8 % 3\r\n => 2 \r\n > 9 % 3\r\n => 0 \r\n```\r\nHere, I am using modulo operator % to check the remainder for numbers that are multiples of 3 vs numbers that are not multiples of 3. I see a pattern emerge that I can use in my code. Anything is a multiple of 3 has a remainder of 0.\r\n\r\nStep 18\r\n------------\r\n\r\nUncomment the pending spec. Change the spec as follows:\r\n\r\n```ruby\r\n  it \'should replace multiples of 3 with Fizz\' do\r\n    game = FizzBuzz.new\r\n    \r\n    result = game.sequence\r\n    \r\n    expect(result[2]).to eq(\'Fizz\')\r\n  end\r\n```\r\n\r\nStep 19\r\n---------\r\n\r\nRun all the tests again. You get the error:\r\n\r\n```ruby\r\nundefined method `sequence\' for #<FizzBuzz:0x01010>\r\n```\r\n\r\nStep 20\r\n------------\r\n\r\nAdd the sequence method as follows:\r\n\r\n```ruby\r\n  def sequence\r\n    numbers.collect do |x|\r\n      if (x % 3) == 0\r\n        \'Fizz\' \r\n      else\r\n        x\r\n      end\r\n    end\r\n  end\r\n```\r\n\r\nStep 21\r\n------------\r\n\r\nRun the specs.\r\n\r\n```ruby\r\nFizzBuzz\r\n  should generate numbers from 1 to 100\r\n  should replace multiples of 3 with Fizz\r\n\r\nFinished in 0.00174 seconds (files took 0.16374 seconds to load)\r\n2 examples, 0 failures\r\n```\r\n\r\nDiscussion\r\n============\r\n------------\r\n\r\nWhy only one assertion in second test? Why not have multiple assertions? I am confident that one assertion is sufficient. Eventually we will write a story test that will cover checking an element somewhere in the middle to give us more confidence in our code. This story test will is the acceptance criteria. Since we will know that we have solved the entire problem. Also during exploratory testing, when we print the output we can manually verify several elements to convince ourselves that our code is satisfying all the requirements.\r\n\r\nStep 22\r\n------------\r\n\r\nWe now fail for the right reason.\r\n\r\n```ruby\r\n  1) FizzBuzz should replace multiples of 5 with Buzz\r\n     Failure/Error: expect(result[4]).to eq(\'Buzz\')\r\n       \r\n       expected: \"Buzz\"\r\n            got: 5\r\n       \r\n       (compared using ==)\r\n     # ./fizz_buzz_spec.rb:39:in `block (2 levels) in <top (required)>\'\r\n\r\nFinished in 0.0014 seconds (files took 0.11513 seconds to load)\r\n3 examples, 1 failure\r\n```\r\n\r\nDiscussion\r\n============\r\n------------\r\n\r\nWhat is the minimum modification that we can make to the sequence method and still pass the test? I considered using collect! as well as storing the value of collect in another variable that required more code than just adding another else-if conditional.\r\n\r\nStep 23\r\n---------\r\n\r\nChange the implementation of sequence generation as follows:\r\n\r\n```ruby\r\n  def sequence\r\n    numbers.collect do |x|\r\n      if (x % 3) == 0\r\n        \'Fizz\' \r\n      elsif (x % 5) == 0\r\n        \'Buzz\'\r\n      else\r\n        x\r\n      end\r\n    end\r\n  end\r\n```\r\n\r\nStep 24\r\n------------\r\n\r\nRun the specs.\r\n\r\n```ruby\r\nFizzBuzz\r\n  should generate numbers from 1 to 100\r\n  should replace multiples of 3 with Fizz\r\n  should replace multiples of 5 with Buzz\r\n\r\nFinished in 0.00134 seconds (files took 0.12621 seconds to load)\r\n3 examples, 0 failures\r\n```\r\n\r\nWe are green now.\r\n\r\nStep 25\r\n------------\r\n\r\nAdd the fourth spec.\r\n\r\n```ruby\r\n  it \'should replace multiples of both 3 and 5 with FizzBuzz\' do\r\n    game = FizzBuzz.new\r\n    \r\n    result = game.sequence\r\n    \r\n    expect(result[14]).to eq(\'FizzBuzz\')\r\n  end\r\n```\r\n\r\nStep 26\r\n------------\r\n\r\nRun the specs again.\r\n\r\n```ruby\r\nFailure/Error: expect(result[14]).to eq(\'FizzBuzz\')\r\n       \r\n   expected: \"FizzBuzz\"\r\n        got: \"Fizz\"\r\n```\r\n\r\nWe are failing for the right reason.\r\n\r\nStep 27\r\n------------\r\n\r\nChange the implementation of sequence method as follows:\r\n\r\n```ruby\r\n  def sequence\r\n    numbers.collect do |x|\r\n      if ((x % 3) == 0) and ((x % 5) == 0)\r\n        \'FizzBuzz\'\r\n      elsif (x % 3) == 0\r\n        \'Fizz\' \r\n      elsif (x % 5) == 0\r\n        \'Buzz\'\r\n      else\r\n        x\r\n      end\r\n    end\r\n  end\r\n```\r\n\r\nStep 28\r\n------------\r\n\r\nRun the specs.\r\n\r\n```ruby\r\nFizzBuzz\r\n  should generate numbers from 1 to 100\r\n  should replace multiples of 3 with Fizz\r\n  should replace multiples of 5 with Buzz\r\n  should replace multiples of both 3 and 5 with FizzBuzz\r\n\r\nFinished in 0.00148 seconds (files took 0.11847 seconds to load)\r\n4 examples, 0 failures\r\n```\r\n\r\nWe are green now.\r\n\r\nStep 29\r\n------------\r\n\r\nIn the irb console:\r\n\r\n```ruby\r\n$irb\r\nload \'fizz_buzz.rb\'\r\n\r\ngame = FizzBuzz.new\r\ngame.output\r\n```\r\n\r\nshows the correct answer.\r\n\r\nStep 30\r\n----------\r\n\r\nLet\'s cleanup the code. Change the implementation as follows:\r\n\r\n```ruby\r\nclass FizzBuzz\r\n  \r\n  def initialize\r\n    @numbers = (1..100).to_a\r\n  end\r\n  \r\n  def sequence\r\n    @numbers.collect do |x|\r\n      if ((x % 3) == 0) and ((x % 5) == 0)\r\n        \'FizzBuzz\'\r\n      elsif (x % 3) == 0\r\n        \'Fizz\' \r\n      elsif (x % 5) == 0\r\n        \'Buzz\'\r\n      else\r\n        x\r\n      end\r\n    end\r\n  end\r\n  \r\n  def output\r\n    sequence.each do |element|  \r\n      puts element\r\n    end\r\n  end\r\n  \r\n  def numbers\r\n    (1..100).to_a\r\n  end\r\nend\r\n```\r\n\r\nWe were green before refactoring, we are green after refactoring.\r\n\r\nStep 31\r\n---------\r\n\r\nDelete the first spec.\r\n\r\n```ruby\r\n  it \'should generate numbers from 1 to 100\' do\r\n    game = FizzBuzz.new\r\n    \r\n    result = game.numbers\r\n    \r\n    expect(result).to eq((1..100).to_a)\r\n  end\r\n```\r\n\r\nRun all the specs. It passes.\r\n\r\nStep 32\r\n-------\r\n\r\nDelete the numbers method and run all the specs. We are still green. Notice that I run tests after I refactor either the tests or the code but I don\'t refactor both at the same time.\r\n\r\nStep 33\r\n-------\r\n\r\nLet\'s make the code more expressive. Change the implementation as follows:\r\n\r\n```ruby\r\nclass FizzBuzz\r\n  \r\n  def initialize\r\n    @numbers = (1..100).to_a\r\n  end\r\n  \r\n  def sequence\r\n    @numbers.collect do |x|\r\n      if (multiple_of(3, x)) and (multiple_of(5, x))\r\n        \'FizzBuzz\'\r\n      elsif multiple_of(3, x)\r\n        \'Fizz\' \r\n      elsif multiple_of(5, x)\r\n        \'Buzz\'\r\n      else\r\n        x\r\n      end\r\n    end\r\n  end\r\n  \r\n  def output\r\n    sequence.each do |element|  \r\n      puts element\r\n    end\r\n  end\r\n  \r\n  private\r\n  \r\n  def multiple_of(n, x)\r\n    (x % n) == 0\r\n  end\r\nend\r\n```\r\n\r\nStep 34\r\n---------\r\n\r\nStack overflow search results in an elegant code for `multiple_of` method:\r\n\r\n```ruby\r\n  def multiple_of(n, x)\r\n    x.modulo(n).zero?\r\n  end\r\n```\r\n\r\nDiscussion\r\n============\r\n------------\r\n\r\nThis code has user interfacing code as well as the core logic for sequence generation. Since the class is small and output method is a small method, we can leave the solution as it is. If this class grows big due to new requirements we have to revisit our design decision at that time and consider splitting the class. We will avoid over engineering for now.\r\n\r\nReference\r\n============\r\n------------\r\n\r\nThis Kata is from \'The Coding Dojo Handbook\' by Emily Bache.\r\n\r\nExercises\r\n============\r\n------------\r\n\r\n1. Add a story test that checks the 74th element in the array for the string \'FizzBuzz\'.\r\n2. The specs are indexing into an array and looking for an element. Is this a good idea? Why?','2014-08-04 17:53:15','2016-12-22 08:11:47'),(431,'TDD Advanced Concepts : Sum Kata','Problem Statement\r\n=================\r\n-----------------\r\n\r\nSum a set of numbers.\r\n\r\nProblem Domain Analysis\r\n=========================\r\n-------------------------\r\n\r\nLet\'s consider the set of numbers, numbers = (1, 2, 7, ... n)\r\n\r\n```sh\r\nSum s = 1 + 2 + 7 + ... + n\r\n```\r\n\r\nLet\'s formulate an algorithm that takes into account that computers can add two numbers at a time. So the algorithm needs to be repetitive to sum all the given numbers.\r\n\r\n```sh\r\ns = a1 + a2 ------> 1\r\ns = s + a3  ------> 2\r\n...\r\ns = s + (a)n \r\n```\r\n\r\nAll sums for n >= 1 can be generated iteratively. \r\n\r\nSolution Domain Analysis\r\n========================\r\n------------------------\r\n\r\nIn Ruby, this problem can be solved in just one line by using the inject method. We must implement our own version of inject method. The reason for this is twofold, number one is that we will learn new concepts that we can use to program in any language. We will also come up with an algorithm that can be used to implement the summing function in any language. This gives us one logical design with many physical design possibilities.\r\n\r\nInitial Condition\r\n-----------------\r\n\r\nWe observe that for n = 0 and n = 1, the initial condition is s = 0.\r\n\r\nSteps to Solve the Problem\r\n---------------------------\r\n\r\n1. Compute first sum (s = 0) as special case.\r\n2. Build each of the n remaining sums from its predecessor by an iterative process.\r\n3. Return the sum of n numbers.\r\n\r\nAlgorithm Description\r\n=====================\r\n---------------------\r\n\r\n1. Take the list of numbers to be summed.\r\n2. Initialize sum for 0 numbers\r\n3. while < n numbers have been summed repeatedly do\r\n     a) Read the number\r\n     b) Compute current sum by adding the number read to the most recent sum.\r\n     c) Go to the next number.\r\n4. Return the result.\r\n\r\nWe have solved the problem by giving the stupid computer specific steps to find the sum. \r\n\r\nAssumptions\r\n==========\r\n----------\r\n\r\n- Numbers in the list are whole numbers\r\n- Numbers will not cause stack overflow issues when added\r\n\r\nTest Cases\r\n===========\r\n-----------\r\n\r\n1. Pick a degenerate case first.\r\n2. Simple one element case.\r\n3. Extend the solution to 2 elements.\r\n4. Generalize to n elements.\r\n  \r\nWe will see why we choose the test cases in this order as we work through the problem now. \r\n\r\nSteps\r\n=========\r\n---------\r\n\r\nStep 1\r\n-------\r\n\r\nCreate a sum_spec.rb file with the following contents:\r\n\r\n```ruby\r\nrequire_relative \'sum\'\r\n\r\ndescribe Sum do\r\n  it \'should return 0 for empty list\' do\r\n    s = Sum.new\r\n    result = s.calculate([])\r\n    \r\n    expect(result).to eq(0)\r\n  end\r\nend\r\n```\r\n\r\nStep 2\r\n------\r\n\r\nCreate a sum.rb file with the following contents:\r\n\r\n```ruby\r\nclass Sum\r\n  def calculate(numbers)\r\n    \r\n  end\r\nend\r\n```\r\n\r\nStep 3\r\n--------\r\n\r\nWe are now failing for the right reason with the following error:\r\n\r\n```ruby\r\nSum\r\n  should return 0 for empty list (FAILED - 1)\r\n\r\nFailures:\r\n\r\n  1) Sum should return 0 for empty list\r\n     Failure/Error: expect(result).to eq(0)\r\n       \r\n       expected: 0\r\n            got: nil\r\n       \r\n       (compared using ==)\r\n     # ./sum_spec.rb:8:in `block (2 levels) in <top (required)>\'\r\n\r\nFinished in 0.00111 seconds (files took 0.11323 seconds to load)\r\n1 example, 1 failure\r\n\r\nFailed examples:\r\n\r\nrspec ./sum_spec.rb:4 # Sum should return 0 for empty list\r\n```\r\n\r\nStep 4\r\n-------\r\n\r\nReturn 0 from the calculate method.\r\n\r\n```ruby\r\nclass Sum\r\n  def calculate(numbers)\r\n    0\r\n  end\r\nend\r\n```\r\n\r\nThe test passes.\r\n\r\nStep 5\r\n-------\r\n\r\nLooking at our test case list, we see we now have a simple one element case. So if we take a list that contains just one element which is 0. We know that the existing fake implementation will pass. So what is the next simplest value that will force the fake implementation to go away? How about a list that contains 1?\r\n\r\n```ruby\r\nrequire_relative \'sum\'\r\n\r\ndescribe Sum do\r\n  # First spec same as before\r\n    \r\n  it \'should return 1 for a list containing 1\' do\r\n    s = Sum.new\r\n    result = s.calculate([1])\r\n    \r\n    expect(result).to eq(1)\r\n  end\r\nend\r\n```\r\n\r\nStep 6\r\n------\r\n\r\nWe now fail for the right reason with the following error:\r\n\r\n```ruby\r\nSum\r\n  should return 0 for empty list\r\n  should return 1 for a list containing 1 (FAILED - 1)\r\n\r\nFailures:\r\n\r\n  1) Sum should return 1 for a list containing 1\r\n     Failure/Error: expect(result).to eq(1)\r\n       \r\n       expected: 1\r\n            got: 0\r\n       \r\n       (compared using ==)\r\n     # ./sum_spec.rb:15:in `block (2 levels) in <top (required)>\'\r\n\r\nFinished in 0.0012 seconds (files took 0.11431 seconds to load)\r\n2 examples, 1 failure\r\n\r\nFailed examples:\r\n\r\nrspec ./sum_spec.rb:11 # Sum should return 1 for a list containing 1\r\n```\r\n\r\nStep 7\r\n------\r\n\r\nHere is a quick and dirty implementation that gets us to green quickly.\r\n\r\n```ruby\r\nclass Sum\r\n  def calculate(numbers)\r\n    if numbers.empty?\r\n      0\r\n    else\r\n      numbers[0]\r\n    end\r\n  end\r\nend\r\n```\r\n\r\nDiscussion \r\n==========\r\n----------\r\n\r\nAccording to our test case list, next we have to extend the solution to two element case. What should be the values of these two elements? We could choose any two numbers but I am choosing [1,1]. Why use [1,1] instead of set of larger numbers? Because the simplest set of numbers is sufficient to make our production code evolve towards an abstract solution. We have an if-else statement for the fake implementation version. Remember this, because this is going to evolve into another programming construct that we will discuss why when that happens.\r\n\r\nStep 8\r\n------\r\n\r\nAdd the next test as follows:\r\n\r\n```ruby\r\n  it \'should return 2 for a list containing 1 and 1\' do\r\n    s = Sum.new\r\n    result = s.calculate([1,1])\r\n    \r\n    expect(result).to eq(2)\r\n  end\r\n```\r\n\r\nStep 9\r\n-----\r\n\r\nThis fails with the following error:\r\n\r\n```ruby\r\nSum\r\n  should return 0 for empty list\r\n  should return 1 for a list containing 1\r\n  should return 2 for a list containing 1 and 1 (FAILED - 1)\r\n\r\nFailures:\r\n\r\n  1) Sum should return 2 for a list containing 1 and 1\r\n     Failure/Error: expect(result).to eq(2)\r\n       \r\n       expected: 2\r\n            got: 1\r\n       \r\n       (compared using ==)\r\n     # ./sum_spec.rb:22:in `block (2 levels) in <top (required)>\'\r\n\r\nFinished in 0.00138 seconds (files took 0.11749 seconds to load)\r\n3 examples, 1 failure\r\n\r\nFailed examples:\r\n\r\nrspec ./sum_spec.rb:18 # Sum should return 2 for a list containing 1 and 1\r\n```\r\n\r\nStep 10\r\n-----\r\n\r\nReplace the else condition as follows:\r\n\r\n```ruby\r\nclass Sum\r\n  def calculate(numbers)\r\n    if numbers.empty?\r\n      0\r\n    else\r\n      index = 0\r\n      result = 0\r\n      \r\n      while index < numbers.size\r\n       result += numbers[index]\r\n       index += 1\r\n      end\r\n      result\r\n    end\r\n  end\r\nend\r\n```\r\n\r\nThe test now passes. How can we cleanup the mess in calculate() method?\r\n\r\nDiscussion\r\n===========\r\n-----------\r\n\r\nLet\'s refer to our algorithm to guide our cleaned up version of our implementation. \r\n\r\n1. Take the list of numbers to be summed.\r\n2. Initialize sum for 0 numbers\r\n3. while < n numbers have been summed repeatedly do\r\n     a) Read the number\r\n     b) Compute current sum by adding the number read to the most recent sum.\r\n     c) Go to the next number.\r\n4. Return the result.\r\n\r\nFirst step is the argument to the calculate() method. The second step is the initial condition before we enter the iterative construct to process the elements one by one untill we process all the elements in the list. In order for us to go to the next number in step 3c of the algorithm, we must increment the index everytime an element is processed successfully. This makes us reach the terminating condition what is evaluated in the beginning of the loop, so that we can terminate the loop and return the final result.\r\n\r\nStep 11\r\n-------\r\n\r\nSo we know what needs to be initialized before we enter the loop, the index of the array that will be incremented within the loop and the result. Change the code as follows:\r\n\r\n```ruby\r\nclass Sum\r\n  \r\n  def calculate(numbers)\r\n    result = 0\r\n    index = 0\r\n\r\n    while index < numbers.size\r\n     result += numbers[index]\r\n     index += 1\r\n    end\r\n    result\r\n  end\r\n  \r\nend\r\n```\r\n\r\nOur tests now pass. \r\n\r\nDiscussion\r\n==========\r\n----------\r\n\r\nDid you see how the first if conditional that was handling the boundary case disappeared? It is now handled by the intial conditions that initialize the index and result variables. It\'s now clear why degenerate test case is the first test case in our test cases list. Degenerate test cases establish initial conditions for loops. We establish index and result values that handle degenerate cases. The if-else construct has been replaced by while loop to generalize the solution.  \r\n\r\nIf you see the transformations list in the [Transformation Priority Premise](http://blog.8thlight.com/uncle-bob/2013/05/27/TheTransformationPriorityPremise.html \'Transformation Priority Premise\') article, we have evolved our code from if-else to a more generic while loop. We always look for transformations higher in the Transformation Priority Premise List. We did Incremental Algorithm Design by going one by one from top of the test cases list. We also made simplyfing assumptions to delineate the scope of the problem. We know under what conditions our solution is valid by looking at the assumptions.\r\n\r\nStep 12\r\n-------\r\n\r\nThe last test case in our test cases list is a story test. It generalizes the solution. Add the story test as follows:\r\n\r\n```ruby\r\nrequire_relative \'sum\'\r\n\r\ndescribe Sum do\r\n  \r\n  it \'should return 20 for a list containing 2,2,2,2,2,2,2,2,2 and 2\' do\r\n    s = Sum.new\r\n    result = s.calculate([2,2,2,2,2,2,2,2,2,2])\r\n    \r\n    expect(result).to eq(20)\r\n  end\r\nend\r\n```\r\n\r\nOur acceptance test passes.\r\n\r\nExploratory Testing \r\n-------------------\r\n\r\n```ruby\r\n$irb\r\nload \'sum.rb\'\r\n```\r\n\r\nand test using any data. Verify the answer by using the inject method.\r\n\r\nSummary\r\n===========\r\n-----------\r\n\r\nIn this example we wrote the tests in the order of increasing complexity, ie., 0, 1, 2 and n elements. This is called [Triangulation](http://www.rubyplus.com/articles/371 \'Triangulation\'). We also discussed about how to choose data for test cases.\r\n\r\nExercises\r\n==========\r\n----------\r\n\r\n1. Why random data in test data is not a good idea?\r\n2. How to write a story test? Why?','2014-08-05 03:12:20','2014-08-14 15:53:45'),(441,'TDD Beyond Basics : Factorial Kata','Problem Statement\r\n================\r\n----------------\r\n\r\nCompute factorial of a given number n, where n >= 0.\r\n\r\nProblem Domain Analysis\r\n================\r\n----------------\r\n\r\nFactorial is defined as follows:\r\n\r\n```sh\r\nn! = 1 x 2 x 3 x ... n for n >= 1\r\n```\r\n\r\nGiven that 0! = 1\r\n\r\n![alt text](https://images.rubyplus.com/pda-factorial.png \"Problem Domain Analysis Factorial\")\r\n\r\nSolution Domain Analysis\r\n================\r\n----------------\r\n\r\n![alt text](https://images.rubyplus.com/sda-factorial3.png \"Solution Domain Analysis Factorial\")\r\n\r\nWe observe a pattern, so we can rewrite 4! as :\r\n\r\n```sh\r\n4! = 3! x 4\r\n\r\nif n = 4, \r\n\r\nn! = (n-1)! x n\r\n```\r\n\r\n![alt text](https://images.rubyplus.com/sda-factorial2.png \"Solution Domain Analysis Factorial\")\r\n\r\nWe can rewrite the examples as :\r\n\r\n```sh\r\nStep 1 : 0! = 1\r\nStep 2 : 1! = 1 x 0!\r\nStep 3 : 2! = 2 x 1!\r\nStep 4 : 3! = 3 x 2!\r\nStep 5 : 4! = 4 x 3!\r\n```\r\n\r\nYou can make these examples executable. Numbers cannot be negative. If the contract is broken you raise an exception. This problem lends itself to writing specs directly from the examples. We did not have to come up with a well ordered sequence of test cases before we start writing the tests.\r\n\r\nAlgorithm\r\n================\r\n----------------\r\n\r\n1. Take the input number n\r\n2. Treat 0! as a special case\r\n3. \r\n\r\n![alt text](https://images.rubyplus.com/sda-factorial.png \"Factorial Index and Increment\")\r\n\r\n```sh\r\nwhile less than n products has been calculated, repeatedly do\r\n  a) Increment index count\r\n  b) Compute the product for current index by multiplying index by the current product\r\nend\r\n\r\nReturn the result\r\n``` \r\n\r\nSteps\r\n=========\r\n---------\r\n\r\nStep 1\r\n---------\r\n\r\nIn our case the class name will be Factorial. Create a file called `factorial_spec.rb` with the following contents:\r\n\r\n```ruby\r\ndescribe Factorial do\r\n\r\n  it \'0 factorial is 1\' do\r\n    factorial = Factorial.new(0)\r\n    \r\n    result = factorial.calculate\r\n    \r\n    expect(result).to eq(1)\r\n  end\r\n  \r\nend\r\n```\r\n\r\nThe describe() is a rspec method. It takes a class name in this case, Factorial as the parameter. \r\n\r\nStep 2\r\n--------\r\n\r\nRun the spec. \r\n\r\n```ruby\r\n$rspec factorial_spec.rb\r\n```\r\n\r\nStep 3\r\n-------\r\n\r\nDefine an empty Factorial class at the top of the `factorial_spec.rb` as follows:\r\n\r\n```ruby\r\nclass Factorial\r\n\r\nend\r\n```\r\n\r\nStep 4\r\n---------\r\n\r\nWhen you run the spec, you will get error related to constructor argument. Change the Factorial class as follows:\r\n\r\n```ruby\r\nclass Factorial\r\n  def initialize(n)\r\n    @n = n\r\n  end\r\nend\r\n```\r\n\r\nStep 5\r\n-------\r\n\r\nNow you get an error due to undefined method \'calculate\'. Let\'s define the method now as follows:\r\n\r\n```ruby\r\nclass Factorial\r\n  def initialize(n)\r\n    @n = n\r\n  end\r\n  \r\n  def calculate\r\n\r\n  end\r\nend\r\n```\r\n\r\nStep 6\r\n--------\r\n\r\nYou see an error \'expected 1 got nil\'. We are now failing for the right reason. \r\n\r\nStep 7\r\n---------\r\n\r\nReturn a hardcoded 1 from the calculate method.\r\n\r\n```ruby\r\nclass Factorial\r\n  def initialize(n)\r\n    @n = n\r\n  end\r\n  \r\n  def calculate\r\n    1\r\n  end\r\nend\r\n```\r\n\r\nNow we are green.\r\n\r\nDiscussion\r\n==========\r\n----------\r\n\r\nWe went from no code at all (missing calculate method) to code that returns nil. This is the very first transformation in the Transformation Priority Premise transformations list. Then we went from nil to constant. This is the second transformation from TPP transformations list. We also discovered the public API for the Factorial class.\r\n\r\nStep 8\r\n-------\r\n\r\nLet\'s write a executable spec for the second example that we came up with in the solution domain analysis section. Add the second spec as follows:\r\n\r\n```ruby\r\ndescribe Factorial do\r\n  # first test same as before\r\n  it \'1 factorial is 1\' do\r\n    factorial = Factorial.new(1)\r\n  \r\n    result = factorial.calculate\r\n  \r\n    expect(result).to eq(1)\r\n  end\r\nend\r\n```\r\n\r\nThe test passes. It\'s obvious why, we still have fake implementation that returns 1.\r\n\r\nStep 9\r\n-------\r\n\r\nLet\'s add the third spec as follows:\r\n\r\n```ruby\r\ndescribe Factorial do\r\n  # first two tests same as before  \r\n  it \'2 factorial is 2\' do\r\n    factorial = Factorial.new(2)\r\n  \r\n    result = factorial.calculate\r\n  \r\n    expect(result).to eq(2)\r\n  end\r\nend\r\n```\r\n\r\nThis fails with expected 2 got 1 error.\r\n\r\nStep 10\r\n--------\r\n\r\nHow can we make the new spec pass without making the old ones fail? Change the implementation as follows:\r\n\r\n```ruby\r\ndef calculate\r\n  if @n == 0\r\n    1\r\n  else\r\n    @n\r\n  end\r\nend\r\n```\r\n\r\nAll specs pass.\r\n\r\nDiscussion\r\n==========\r\n----------\r\n\r\nWe transformed our code from no conditional to splitting the execution path by using if-else construct. This transformation is somewhere in the middle of the TPP transformations list.\r\n\r\nStep 11\r\n--------\r\n\r\nLet\'s add the next spec as follows:\r\n\r\n```ruby\r\ndescribe Factorial do\r\n  # first three tests same as before\r\n  it \'3 factorial is 6\' do\r\n    factorial = Factorial.new(3)\r\n  \r\n    result = factorial.calculate\r\n  \r\n    expect(result).to eq(6)\r\n  end\r\nend\r\n```\r\n\r\nThe test fails with the error \'expected 6 got 3\' message.\r\n\r\nStep 12\r\n--------\r\n\r\nSolution 1 : We can use recursion and use the formula we came up with by recognizing the pattern. Formula for recursive solution:\r\n\r\n```sh\r\nn! = (n-1)! x n\r\n```\r\n\r\nSolution 2 : We can use our algorithm we developed earlier:\r\n\r\n```sh\r\nwhile less than n products has been calculated, repeatedly do\r\n  a) Increment index count\r\n  b) Compute the product for current index by multiplying index by the current product\r\nend\r\n\r\nreturn the result\r\n```\r\n\r\nThe terminating condition is that we reach 1 as we reduce the number by 1 inside the loop. The initial value of the result is set to 1. Here is the pseudocode:\r\n\r\n```sh\r\nresult = 1\r\nwhile n > 1 do\r\n  result = result * n\r\n  n = n - 1  \r\nend\r\n```\r\n\r\nChange the implementation as follows:\r\n\r\n```ruby\r\nclass Factorial\r\n  def initialize(n)\r\n    @n = n\r\n  end\r\n  \r\n  def calculate\r\n    if @n == 0\r\n      1\r\n    else\r\n      result = 1\r\n      while @n > 1 do\r\n        result = result * @n\r\n        @n = @n - 1  \r\n      end\r\n      result\r\n    end\r\n  end\r\nend\r\n```\r\n\r\nAll specs pass. \r\n\r\nStep 13\r\n------\r\n\r\nLet\'s cleanup the code as follows:\r\n\r\n```ruby\r\nclass Factorial\r\n  def initialize(n)\r\n    @n = n\r\n  end\r\n  \r\n  def calculate\r\n    result = 1\r\n    while @n > 1 do\r\n      result = result * @n\r\n      @n = @n - 1  \r\n    end\r\n    result\r\n  end\r\nend\r\n```\r\n\r\nDiscussion\r\n==========\r\n-----------\r\n\r\nYou can now see that the if-else became a while construct. This is in the bottom of the TPP transformations list. While is much more generic construct than if-else. We no longer need a special case to handle the 0!. The boundary case is handled by the initial condition. If you observe the changes that happened in the above steps, you can see how Robert Martin\'s insight \'As the tests get more and more specific, the code gets more and more generic\' is true in our case.\r\n\r\nExercises\r\n===========\r\n-----------\r\n\r\n1. Change the implementation to use recursive solution. Make sure all tests pass. Watch out for the common mistake of forgetting terminating condition for recursive solution.\r\n2. Watch the [Factorial screencast](https://www.youtube.com/watch?v=Tmp-viKFOJw \"Factorial screencast\") or download [Factorial screencast](https://s3.amazonaws.com/clickplan.com/download/RecursionRuby.mov.zip \"Factorial screencast\")\r\n3. Write the following contract test.\r\n\r\n```ruby\r\nit \'should raise exception for negative numbers\'\r\n```\r\n\r\nYou can implement it by using the following code:\r\n\r\n```ruby\r\nraise ArgumentError, \'Negative number is not allowed\' if number < 0\r\n```\r\n','2014-08-05 17:39:23','2016-12-22 08:15:45'),(451,'TDD Beyond Basics : Counting','Problem Statement\r\n================\r\n-----------------\r\n\r\nImplement a method called my_count that takes a number and an array of numbers and returns the count representing the total number of elements in the array that is equal or greater than the given number.\r\n\r\nProblem Domain Analysis\r\n=======================\r\n-----------------------\r\n\r\nLet\'s say our method takes two parameters, first parameter n for the number used for comparison and an array for the second parameter a that contains a list of numbers to be processed.\r\n\r\n![alt text](https://images.rubyplus.com/pda-mycount.png \"My Count Example\")\r\n\r\nThe result in this case = 3, since there are only three numbers 10, 15 and 25 that are equal or above 10. We can accomplish this in Ruby in just one line, in the irb:\r\n\r\n```ruby\r\n$irb\r\na = [2, 7, 10, 15, 25]\r\na.count{|x| x >= 10}\r\n=> 3\r\n```\r\n\r\nWe need to implement our own version of the Ruby\'s count method called `my_count`. In this irb console session we only focus on specifying what needs to be done. The details of counting such as how many elements are in the list to be counted, when we need to terminate the loop etc has been hidden inside the count method. As you already know, what needs to be done is the focus of the problem domain analysis.\r\n\r\nSolution Domain Analysis\r\n=========\r\n---------\r\n\r\n![alt text](https://images.rubyplus.com/sda-mycount2.png \"Solution Domain Analysis MyCount\")\r\n\r\n\r\n![alt text](https://images.rubyplus.com/sda-mycount.png \"Solution Domain Analysis MyCount\")\r\n\r\nSteps to Solve the Problem\r\n---------------------------\r\n\r\n```\r\nwhile < n numbers have been examined do\r\n  1. Read the number\r\n  2. If current number satisfies the condition then add one to count.\r\nend\r\n```\r\n\r\nAlgorithm\r\n=========\r\n---------\r\n\r\n1. Read the number of elements to be processed.\r\n2. Initialize the count to 0\r\n3. While there are still elements to be processed repeatedly do:\r\n   a) Read the number\r\n   b) If it satisfies the condition (>= 10) then add one to count.\r\n4. Return the total number of elements that satisfies the condition.\r\n\r\nLogical Design\r\n==============\r\n--------------\r\n  \r\n1. Read n and the array\r\n2. Take the first element in the array\r\n3. Check if element x >= n\r\n\r\n    Yes --> Increment counter\r\n\r\n4. Go to the next element\r\n\r\nSkeleton Code\r\n=============\r\n-------------\r\n\r\n```ruby\r\ncount = 0\r\ni = 0\r\n\r\nwhile i < n do\r\n\r\nend\r\n```\r\n\r\nTerminating Condition\r\n---------------------\r\n\r\ni == n is the terminating condition.\r\n\r\nConsideration of the problem at its lowest limit (i.e., n=0) leads to a mechanism that can be extended to larger values of n by simple repetition. This is a very common technique in algorithm design.\r\n\r\nInitial Condition\r\n-----------------\r\n\r\nindex = 0 \r\ncount = 0\r\n\r\nPseudo Code\r\n===========\r\n-----------\r\n\r\n```\r\nwhile index < (size of array - 1)\r\n  extract the element from the array\r\n  compare --> increment counter if yes\r\nend\r\n\r\nreturn count\r\n```\r\n\r\nSteps\r\n========\r\n--------\r\n\r\nStep 1\r\n-------\r\n\r\nLet\'s write our first test that is the minimum we have to do for making the test fail. Create `my_count_spec.rb` with the following contents:\r\n\r\n```ruby\r\ndescribe MyCount do\r\n  \r\n  it \"should return 0 for n = 0 and an empty list\" do\r\n    my_count = MyCount.new\r\n    \r\n    result = my_count.calculate(0, [])\r\n    \r\n    expect(result).to eql(0)\r\n  end\r\n  \r\nend\r\n```\r\n\r\nStep 2\r\n------\r\n\r\nTo make the test fail for the right reason, add the MyCount class to the top of the `my_count_spec.rb` as follows:\r\n\r\n```ruby\r\nclass MyCount\r\n  def calculate(n, a)\r\n    \r\n  end\r\nend\r\n```\r\n\r\nYou will get expected 0 got nil error message.\r\n\r\nStep 3\r\n-------\r\n\r\nReturn 0 to make the test pass.\r\n\r\n```ruby\r\nclass MyCount\r\n  def calculate(n, a)\r\n    0\r\n  end\r\nend\r\n```\r\n\r\nStep 4\r\n--------\r\n\r\nLet\'s add the second test as follows:\r\n\r\n```ruby\r\ndescribe MyCount do\r\n  # first test same as before\r\n  \r\n  it \"should return 1 for 0, [0]\" do\r\n    my_count = MyCount.new\r\n    \r\n    result = my_count.calculate(0, [0])\r\n    \r\n    expect(result).to eql(1)\r\n  end\r\nend\r\n```\r\n\r\nThis fails with the error \'expected 1, got 0\' message.\r\n\r\nStep 5\r\n--------\r\n\r\nThe quick and dirty way to make both test pass is as follows:\r\n\r\n```ruby\r\nclass MyCount\r\n  def calculate(n, a)\r\n    if a.include? n\r\n      1\r\n    else\r\n      0\r\n    end\r\n  end\r\nend\r\n```\r\n\r\nStep 6\r\n-------\r\n\r\nLet\'s add the third spec that checks the opposite of what the second spec checked as follows:\r\n\r\n```ruby\r\ndescribe MyCount do\r\n  # first two tests same as before\r\n  \r\n  it \"should return 0 for 1, [0]\" do\r\n    my_count = MyCount.new\r\n    \r\n    result = my_count.calculate(1, [0])\r\n    \r\n    expect(result).to eql(0)\r\n  end\r\nend\r\n```\r\n\r\nThis test passes because the include? method returns false.\r\n\r\nStep 7\r\n--------\r\n\r\nAdd the fourth spec as follows:\r\n\r\n```ruby\r\ndescribe MyCount do\r\n  # first three tests same as before\r\n  \r\n  it \"should return 2 for 1, [1,1]\" do\r\n    my_count = MyCount.new\r\n    \r\n    result = my_count.calculate(1, [1,1])\r\n    \r\n    expect(result).to eql(2)  \r\n  end\r\nend\r\n```\r\n\r\nThis fails with \"expected 2, got 1\" error.\r\n\r\nStep 8\r\n-------\r\n\r\nBy reading the algorithm we developed earlier and the skeleton code, let\'s stop faking and implement the real solution as follows:\r\n\r\n```ruby\r\nclass MyCount\r\n  def calculate(n, a)\r\n    count = 0\r\n    index = 0\r\n    \r\n    while index < a.size\r\n      if a[index] == n\r\n        count += 1\r\n      end\r\n      index += 1\r\n    end\r\n    count\r\n  end\r\nend\r\n```\r\n\r\nAll the test passes.\r\n\r\nWarning\r\n--------\r\n\r\nIf you forget to increment the index or use the wrong terminating condition, your program will just hang.\r\n\r\nStep 9\r\n-------\r\n\r\nLet\'s add the story test as follows:\r\n\r\n```ruby\r\ndescribe MyCount do\r\n  # first four tests same as before\r\n  \r\n  it \"should return 5 for 3, [1,1,2,3,4,3,6,6,1]\" do\r\n    my_count = MyCount.new\r\n    \r\n    result = my_count.calculate(3, [1,1,2,3,4,3,6,6,1])\r\n    \r\n    expect(result).to eql(5)      \r\n  end\r\nend\r\n```\r\n\r\nThis fails gloriously with the error message \'expected 5, got 2\'.\r\n\r\nStep 10\r\n--------\r\n\r\nThis test has exposed a bug in our code. By inspecting our solution we find that the if condition is wrong. Correct it as follows:\r\n\r\n```ruby\r\nif a[index] >= n\r\n```\r\n\r\nAll our tests passes.\r\n\r\nHere is the final solution:\r\n\r\n```ruby\r\nclass MyCount\r\n  def calculate(n, a)\r\n    count = 0\r\n    index = 0\r\n    \r\n    while index < a.size\r\n      if a[index] >= n\r\n        count += 1\r\n      end\r\n      index += 1\r\n    end\r\n    count\r\n  end\r\nend\r\n\r\ndescribe MyCount do\r\n  \r\n  it \"should return 0 for n = 0 and an empty list\" do\r\n    my_count = MyCount.new\r\n    \r\n    result = my_count.calculate(0, [])\r\n    \r\n    expect(result).to eql(0)\r\n  end\r\n  \r\n  it \"should return 1 for 0, [0]\" do\r\n    my_count = MyCount.new\r\n    \r\n    result = my_count.calculate(0, [0])\r\n    \r\n    expect(result).to eql(1)\r\n  end\r\n  \r\n  it \"should return 0 for 1, [0]\" do\r\n    my_count = MyCount.new\r\n    \r\n    result = my_count.calculate(1, [0])\r\n    \r\n    expect(result).to eql(0)\r\n  end\r\n  \r\n  it \"should return 2 for 1, [1,1]\" do\r\n    my_count = MyCount.new\r\n    \r\n    result = my_count.calculate(1, [1,1])\r\n    \r\n    expect(result).to eql(2)  \r\n  end\r\n  \r\n  it \"should return 5 for 3, [1,1,2,3,4,3,6,6,1]\" do\r\n    my_count = MyCount.new\r\n    \r\n    result = my_count.calculate(3, [1,1,2,3,4,3,6,6,1])\r\n    \r\n    expect(result).to eql(5)      \r\n  end\r\nend\r\n```\r\n\r\nDiscussion\r\n==========\r\n----------\r\n\r\nThe code evolved from:\r\n\r\n1. No code at all       --> Returning nil\r\n2. Returning nil        --> Returning a constant\r\n3. Returning a constant --> If-else condition\r\n4. If-else condition    --> While loop\r\n\r\nWhile is a more generic construct than if-else. If-else is more generic than returning a constant and so on. We see that the code became more generic as our tests became more specific. For an in-depth discussion read about Transformation Priority Premise by Robert Martin on his blog.\r\n\r\nRefactoring is changing the structure without changing the behavior. Transformation is changing the behavior with the least change in the structure. This forces us to write minimal code to pass the current test. Transformation and Refactoring are the two sides of the same coin. Red to Green is transformation. Green to Green is refactoring.\r\n\r\nQ & A\r\n=========\r\n---------\r\n\r\n**I am having difficulty writing a test. Do you have any suggestions?**\r\n\r\nUse the Arrange, Act, Assert structure. Also work backwards by writing the assert first, then write the code for \'Act\' phase and finally for Arrange. \r\n\r\n**When do I use Transformation Priority Premise?**\r\n\r\nTransformation Priority Premise is not a silver bullet. It\'s a work in progress. Designing algorithms to solve a given problem and drawing flow charts will always help you write complex programs.','2014-08-06 04:31:36','2016-12-22 08:18:25'),(461,'TDD Basics : Generate Prime Numbers','Problem Statement\r\n===================\r\n-------------------\r\n\r\nFind the primes in the first n positive integers. \r\n\r\nProblem Domain Analysis\r\n===================\r\n-------------------\r\n\r\nA prime number is a positive integer that is exactly divisible only by 1 and itself. The first few primes are:\r\n\r\n```sh\r\n2,3,5,7,11,13,17,19,23,29,31,37\r\n```\r\n\r\nAll primes apart from 2 are odd.  \r\n\r\nSolution Domain Analysis\r\n=======================\r\n-----------------------\r\n\r\nExample 1\r\n---------\r\n\r\nLet\'s check if 13 is a prime. If the number we are testing is prime it will have no exact divisors other than 1 and itself. To determine if 13 is prime, we need to divide it in turn by the set of numbers\r\n\r\n```sh\r\n2,3,4,5,.....12\r\n```\r\n\r\nIf any of these numbers divide into 13 without remainder, we will know it cannot be prime. This requires 11 calls to mod function. This is very inefficient. Let\'s look at a different approach.\r\n\r\nExample 2\r\n----------\r\n\r\nLet\'s look at an example problem. If n = 37, we don\'t need to test all of the numbers 3 through 36 to determine whether n is prime. Instead, we can test only the numbers between 2 and sqrt(37), rounded up. sqrt(37) = 6.08 - we\'ll round up to 7.\r\n\r\n37 is not evenly divisible by 3, 4, 5, 6, and 7, so we can say confidently that it is prime. You can check it in the irb:\r\n\r\n```ruby\r\n$irb\r\n> 37 % 2\r\n => 1 \r\n> 37 % 3\r\n => 1 \r\n> 37 % 4\r\n => 1 \r\n> 37 % 5\r\n => 2 \r\n> 37 % 6\r\n => 1 \r\n> 37 % 7\r\n => 2 \r\n```\r\n  \r\nWe did not get 0 as the remainder, so it is not evenly divisible by any of the numbers from 3,4,5,6, and 7. To double check our solution, we can check if a number is prime in Ruby. Go to irb :\r\n\r\n```ruby\r\n> require \'prime\'\r\n => true\r\n> Prime.prime?(37)\r\n => true\r\n```\r\n\r\nSteps\r\n=========\r\n---------\r\n\r\nStep 1\r\n-----------\r\n\r\nLet\'s write our first test. We know we have to generate a list of divisors before we can check if the given number is prime or not by using the modulo operator. The first spec in find_prime_spec.rb will be something like:\r\n\r\n```ruby\r\ndescribe FindPrime do\r\n  it \'should generate a list of divisors for the given number\' do\r\n   # 1. Given a number 37\r\n   # 2. I expect the list of divisors to be [2,3,4,5,6,7]\r\n\r\n  end\r\nend\r\n```\r\n\r\nStep 2\r\n-----------\r\n\r\nThis is tough for a first test. Can we simplify this even further? How about we find the upper number? Change the first spec as follows:\r\n\r\n```ruby\r\ndescribe FindPrime do\r\n  it \'should find the upper factor to test the prime\' do\r\n    find_prime = FindPrime.new(37)\r\n    \r\n    upper_factor = find_prime.upper_factor\r\n    expect(upper_factor).to eq(7)\r\n  end\r\nend\r\n```\r\n\r\nThis is testing the implementation. We will come back to this issue later.\r\n\r\nStep 3\r\n-----------\r\n\r\n```ruby\r\nclass FindPrime\r\n  def initialize(n)\r\n    @n = n\r\n  end\r\n  \r\n  def upper_factor\r\n    Math.sqrt(@n)  \r\n  end\r\nend\r\n```\r\n\r\nThis fails with the error message \'expected 7 got 6.08\'.\r\n\r\nStep 4\r\n--------\r\n\r\nChange the upper_factor method as follows:\r\n\r\n```ruby\r\ndef upper_factor\r\n  Math.sqrt(@n).ceil  \r\nend\r\n```\r\n\r\nThe test now passes.\r\n\r\nStep 5\r\n-------\r\n\r\nNow we are ready to tackle what we had in Step 1:\r\n\r\n```ruby\r\ndescribe FindPrime do\r\n  it \'should generate a list of divisors for the given number\' do\r\n   # 1. Given a number 37\r\n   # 2. I expect the list of divisors to be [2,3,4,5,6,7]\r\n\r\n  end\r\nend\r\n```\r\n\r\nThe above spec now becomes the second spec as follows:\r\n\r\n```ruby\r\ndescribe FindPrime do\r\n  it \'should generate a list of divisors for the given number\' do\r\n    find_prime = FindPrime.new(37)\r\n    \r\n    divisors_list = find_prime.divisors_list\r\n    expect(divisors_list).to eq([2,3,4,5,6,7])\r\n  end\r\nend\r\n```\r\n\r\nStep 6\r\n------\r\n\r\nAdd the divisors_list method to FindPrime class as follows:\r\n\r\n```ruby\r\nclass FindPrime\r\n  def initialize(n)\r\n    @n = n\r\n  end\r\n  \r\n  def upper_factor\r\n    Math.sqrt(@n).ceil  \r\n  end\r\n  \r\n  def divisors_list\r\n    (2..upper_factor).to_a\r\n  end\r\nend\r\n```\r\n\r\nThe test now passes.\r\n\r\nStep 7\r\n-------\r\n\r\nLet\'s add the third spec as follows:\r\n\r\n```ruby\r\nit \'should return true given a number input of 37\' do\r\n  find_prime = FindPrime.new(37)\r\n  \r\n  is_prime = find_prime.prime?\r\n  expect(is_prime).to eq(true)\r\nend\r\n```\r\n\r\nStep 8\r\n------\r\n\r\nBased on what we learned in the solution domain analysis section, we can now add the prime? method to the FindPrime class as follows:\r\n\r\n```ruby\r\n# 1. Get the list of factors to use for the modulo check\r\n# 2. Find the modulo using the first number\r\n# 3. Repeat modulo for all numbers\r\n# 4. If all the numbers\' modulo returns remainder, then return true otherwise false\r\ndef prime?\r\n  divisors_list.each do |e|\r\n    remainder = @n % e\r\n     return false if remainder == 0\r\n  end\r\n  return true\r\nend\r\n```\r\n\r\nStep 9\r\n-------\r\n\r\nHide the divisors_list method by making it private. So the following test is not required because the method is now private and it gets indirectly tested.\r\n\r\n```ruby\r\nit \'should generate a list of divisors for the given number\' do\r\n  find_prime = FindPrime.new(37)\r\n  \r\n  divisors_list = find_prime.divisors_list\r\n  expect(divisors_list).to eq([2,3,4,5,6,7])\r\nend\r\n```\r\n\r\nDelete that test. Now the entire listing looks like this:\r\n\r\n```ruby\r\nclass FindPrime\r\n  def initialize(n)\r\n    @n = n\r\n  end\r\n  \r\n  def prime?\r\n    divisors_list.each do |e|\r\n      remainder = @n % e\r\n       return false if remainder == 0\r\n    end\r\n    return true\r\n  end\r\n  \r\n  def upper_factor\r\n    Math.sqrt(@n).ceil  \r\n  end\r\n  \r\n  private\r\n  \r\n  def divisors_list\r\n    (2..upper_factor).to_a\r\n  end\r\nend\r\n\r\ndescribe FindPrime do\r\n  it \'should find the upper factor to test the prime\' do\r\n    find_prime = FindPrime.new(37)\r\n    \r\n    upper_factor = find_prime.upper_factor\r\n    expect(upper_factor).to eq(7)\r\n  end\r\n    \r\n  it \'should return true given a number input of 37\' do\r\n    find_prime = FindPrime.new(37)\r\n    \r\n    is_prime = find_prime.prime?\r\n    expect(is_prime).to eq(true)\r\n  end\r\n  \r\nend\r\n```\r\n\r\nStep 10\r\n--------\r\n\r\nWe can do the same to the upper_factor method. The listing now looks like this:\r\n\r\n```ruby\r\nclass FindPrime\r\n  def initialize(n)\r\n    @n = n\r\n  end\r\n  \r\n  def prime?\r\n    divisors_list.each do |e|\r\n      remainder = @n % e\r\n       return false if remainder == 0\r\n    end\r\n    return true\r\n  end\r\n    \r\n  private\r\n  \r\n  def divisors_list\r\n    (2..upper_factor).to_a\r\n  end\r\n  \r\n  def upper_factor\r\n    Math.sqrt(@n).ceil  \r\n  end\r\n  \r\nend\r\n\r\ndescribe FindPrime do\r\n    \r\n  it \'should return true given a number input of 37\' do\r\n    find_prime = FindPrime.new(37)\r\n    \r\n    is_prime = find_prime.prime?\r\n    expect(is_prime).to eq(true)\r\n  end\r\n  \r\nend\r\n```\r\n\r\nThe first two tests we wrote is like scaffold of a building. Once the building construction is done, scaffold goes away.\r\n\r\nStep 11\r\n----------\r\n\r\nLet\'s get rid of the magic number 2 by making it a constant. The FindPrime now looks like this:\r\n\r\n```ruby\r\nclass FindPrime\r\n  LOWER_BOUND = 2\r\n  \r\n  def initialize(n)\r\n    @n = n\r\n  end\r\n\r\n  def prime?\r\n    divisors_list.each do |e|\r\n      remainder = @n % e\r\n       return false if remainder == 0\r\n    end\r\n    return true\r\n  end\r\n    \r\n  private\r\n  \r\n  def divisors_list\r\n    (LOWER_BOUND..upper_factor).to_a\r\n  end\r\n  \r\n  def upper_factor\r\n    Math.sqrt(@n).ceil  \r\n  end\r\n  \r\nend\r\n```\r\n\r\nSummary\r\n=======\r\n-------\r\n\r\nIn this article we saw how the tests that test the implementation eventually is deleted. We hide the implementation details by making it private to the class. Sometimes, you will have many private methods that operates on the same set of data and might be hiding an abstraction. In such cases, you can extract the functionality in the private methods into it\'s own class that can be tested separately. \r\n\r\nExercises\r\n=========\r\n---------\r\n\r\n1. Is it a good idea to check the data structure that is used for the implementation?\r\n2. In the tests we have divisors_list that is checked with the elements in an Array. Is this a good idea? Why?\r\n','2014-08-06 06:30:43','2014-08-14 16:04:58'),(471,'TDD Basics : The Sieve of Erastosthenes','The Sieve of Erastosthenes\r\n=========================\r\n-------------------------\r\n\r\nThe most efficient way to find all of the small primes is by using a sieve such as Sieve of Eratosthenes.\r\n\r\n1. Make a list of all the integers <= n and > 1\r\n2. Strike out the multiples of all primes <= sqrt(n), then the numbers that are left are the primes.\r\n\r\nExample\r\n===================\r\n-------------------\r\n\r\nFind all the primes upto a given number n. For 30 the result is 2,3,5,7,11,13,17,19,23,29. Let\'s find all the primes <= 30\r\n\r\n1) First list the numbers from 2 to 30\r\n\r\n![alt text](https://images.rubyplus.com/sieve-1.png \"Sieve Step 1\")\r\n\r\n2) First number is prime, so keep it\r\n3) Cross out multiples of 2\r\n\r\n![alt text](https://images.rubyplus.com/sieve-3.png \"Sieve Step 3\")\r\n\r\n4) The first number left is 3, so it is the first odd prime, keep it.\r\n5) Cross out all multiples of 3\r\n\r\n![alt text](https://images.rubyplus.com/sieve-5.png \"Sieve Step 5\")\r\n\r\n6) Now the first number left is 5, the second odd prime, keep it.\r\n7) Cross out all multiples of 5\r\n\r\n![alt text](https://images.rubyplus.com/sieve-6.png \"Sieve Step 6\")\r\n\r\n8) The next number 7 is larger than the square root of 30, so there are no multiples of 7 to eliminate. Therefore the sieve is complete.\r\n\r\n\r\nErastostenes Javascript Demo\r\n===========================\r\n---------------------------\r\n\r\n[Erastostenes Javascript Demo](http://www.hbmeyer.de/eratclass.htm \"Erastostenes Javascript Demo\")\r\n\r\n\r\nAlgorithm\r\n============\r\n------------\r\n\r\n```\r\nwhile square of(current_prime) <= n\r\n  apply the sieve\r\nend\r\n```\r\n\r\nTerminating Condition is square of(current_prime) > or = n\r\n  \r\nSteps\r\n=========\r\n---------\r\n\r\nStep 1\r\n-------\r\n\r\nLet\'s write the test for step 1 of the example. Create `erastosthenes_spec.rb` file with  the following content:\r\n\r\n```ruby\r\ndescribe Erastostenes do\r\n  it \'makes a list of all integers <= 30 and greater than 1\' do\r\n    e = Erastostenes.new(30)\r\n    number_list = e.number_list\r\n    expect(number_list).to eq([2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30])\r\n  end\r\nend\r\n```\r\n\r\nStep 2\r\n-------\r\n\r\nHere is the empty implementation that fails for the right reason:\r\n\r\n```ruby\r\nclass Erastostenes\r\n  def initialize(n)\r\n    @n = n\r\n  end\r\n  \r\n  def number_list\r\n    \r\n  end\r\nend\r\n```\r\n\r\nStep 3\r\n------\r\n\r\nImplement the `number_list` as follows:\r\n\r\n```ruby\r\ndef number_list\r\n  (2..@n).to_a\r\nend\r\n```\r\n\r\nThe test passes.\r\n\r\nStep 4\r\n--------\r\n\r\nLet\'s add the test for the second step in the example as follows:\r\n\r\n```ruby\r\nit \'should cross out multiples of 2\' do\r\n  e = Erastostenes.new(30)\r\n  cross_out_multiples_of_two = e.cross_out_multiples_of_two\r\n  \r\n  expect(cross_out_multiples_of_two).to eq([2,3,5,7,9,11,13,15,17,19,21,23,25,27,29])\r\nend\r\n```\r\n\r\nThis test fails.\r\n\r\nStep 5\r\n------\r\n\r\nHere is the implementation that passes the test.\r\n\r\n```ruby\r\ndef cross_out_multiples_of_two\r\n  number_list.reject do |x|\r\n    unless x == 2\r\n     x % 2 == 0 \r\n    end\r\n  end    \r\nend\r\n```\r\n\r\nStep 6\r\n------\r\n\r\nLet\'s write the test for the next step as follows:\r\n\r\n```ruby\r\nit \'should cross out multiples of 2 and 3\' do\r\n  e = Erastostenes.new(30)\r\n  cross_out_multiples_of_three = e.cross_out_multiples_of_three\r\n  \r\n  expect(cross_out_multiples_of_three).to eq([2,3,5,7,11,13,17,19,23,25,29])    \r\nend\r\n```\r\n\r\nStep 7\r\n------\r\n\r\nWe are not just testing step 2 by itself. We are developing the algorithm incrementally so it needs to build on top of the previous step. The following implementation passes the test.\r\n\r\n```ruby\r\ndef cross_out_multiples_of_three\r\n  list = cross_out_multiples_of_two\r\n  list.reject do |x|\r\n    unless x == 3\r\n     x % 3 == 0 \r\n    end\r\n  end        \r\nend\r\n```\r\n\r\nStep 8\r\n--------\r\n\r\nThe following implementation passes the test.\r\n\r\n```ruby\r\ndef cross_out_multiples_of_five\r\n  list = cross_out_multiples_of_three\r\n  list.reject do |x|\r\n    unless x == 5\r\n     x % 5 == 0 \r\n    end\r\n  end\r\nend\r\n```\r\n\r\nStep 9\r\n--------\r\n\r\nLet\'s refactor by eliminating the duplication in Erastostenes class.\r\n\r\n```ruby\r\nclass Erastostenes \r\n  def initialize(n)\r\n    @n = n\r\n    @list = (2..@n).to_a  \r\n  end\r\n  \r\n  def number_list\r\n      (2..@n).to_a  \r\n  end\r\n  \r\n  def cross_out_multiples_of_two\r\n    cross_out_multiples_of(2)\r\n  end\r\n  \r\n  def cross_out_multiples_of_three\r\n    @list = cross_out_multiples_of(2)\r\n    cross_out_multiples_of(3)\r\n  end\r\n  \r\n  def cross_out_multiples_of_five\r\n    list = cross_out_multiples_of_three\r\n    list.reject! do |x|\r\n      unless x == 5\r\n       x % 5 == 0 \r\n      end\r\n    end\r\n  end\r\n  \r\n  private\r\n  \r\n  def cross_out_multiples_of(number)\r\n    @list.reject! do |x|\r\n      unless x == number\r\n       x % number == 0 \r\n      end\r\n    end    \r\n  end\r\n  \r\nend\r\n```\r\n\r\nWe are still green. \r\n\r\nStep 10\r\n----------\r\n\r\nHere is the complete listing as of now, `erastosthenes_spec.rb`:\r\n\r\n```ruby\r\ndescribe Erastostenes do\r\n  it \'makes a list of all integers <= 30 and greater than 1\' do\r\n    e = Erastostenes.new(30)\r\n    number_list = e.number_list\r\n    expect(number_list).to eq([2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30])\r\n  end\r\n  \r\n  it \'should cross out multiples of 2\' do\r\n    e = Erastostenes.new(30)\r\n    cross_out_multiples_of_two = e.cross_out_multiples_of_two\r\n    \r\n    expect(cross_out_multiples_of_two).to eq([2,3,5,7,9,11,13,15,17,19,21,23,25,27,29])\r\n  end\r\n  \r\n  it \'should cross out multiples of 2 and 3\' do\r\n    e = Erastostenes.new(30)\r\n    cross_out_multiples_of_three = e.cross_out_multiples_of_three\r\n    \r\n    expect(cross_out_multiples_of_three).to eq([2,3,5,7,11,13,17,19,23,25,29])    \r\n  end\r\n  \r\n  it \'should cross out multiples of 2, 3 and 5\' do\r\n    e = Erastostenes.new(30)\r\n    cross_out_multiples_of_five = e.cross_out_multiples_of_five\r\n    \r\n    expect(cross_out_multiples_of_five).to eq([2,3,5,7,11,13,17,19,23,29])\r\n  end\r\n\r\nend\r\n```\r\n\r\nerastosthenes.rb:\r\n\r\n```ruby\r\nclass Erastostenes \r\n  def initialize(n)\r\n    @n = n\r\n    @list = (2..@n).to_a  \r\n  end\r\n  \r\n  def number_list\r\n    (2..@n).to_a  \r\n  end\r\n  \r\n  def cross_out_multiples_of_two\r\n    cross_out_multiples_of(2)\r\n  end\r\n  \r\n  def cross_out_multiples_of_three\r\n    @list = cross_out_multiples_of(2)\r\n    cross_out_multiples_of(3)\r\n  end\r\n  \r\n  def cross_out_multiples_of_five\r\n    list = cross_out_multiples_of_three\r\n    list.reject! do |x|\r\n      unless x == 5\r\n       x % 5 == 0 \r\n      end\r\n    end\r\n  end\r\n  \r\n  private\r\n  \r\n  def cross_out_multiples_of(number)\r\n    @list.reject! do |x|\r\n      unless x == number\r\n       x % number == 0 \r\n      end\r\n    end    \r\n  end\r\n  \r\nend\r\n```\r\n\r\nStep 11\r\n--------\r\n\r\nLet\'s add the story test as follows:\r\n\r\n```ruby\r\nit \'should calculate the prime numbers for 30\' do\r\n  e = Erastostenes.new(30)\r\n  result = e.calculate\r\n      \r\n  expect(result).to eq([2,3,5,7,11,13,17,19,23,29])\r\nend\r\n```\r\n\r\nStep 12\r\n--------\r\n\r\nBy looking at our discussion in the algorithm section and the terminating condition we came up with, we know what the real implementation will be like.\r\n\r\n```ruby\r\ndef calculate\r\n  list = number_list\r\n  list.each do |x|\r\n    unless x >= Math.sqrt(@n)\r\n      cross_out_multiples_of(x)\r\n    end\r\n  end\r\n  @list\r\nend\r\n```\r\n\r\nThis passes all our tests.\r\n\r\nStep 13\r\n--------\r\n\r\nLet\'s cleanup. Here is the listing after deleting unnecessary code and tests.\r\n\r\n```ruby\r\nclass Erastostenes \r\n  def initialize(n)\r\n    @n = n\r\n    @list = (2..@n).to_a  \r\n  end\r\n  \r\n  def number_list\r\n      (2..@n).to_a  \r\n  end\r\n    \r\n  def calculate\r\n    list = number_list\r\n    list.each do |x|\r\n      unless x >= Math.sqrt(@n)\r\n        cross_out_multiples_of(x)\r\n      end\r\n    end\r\n    @list\r\n  end\r\n  \r\n  private\r\n  \r\n  def cross_out_multiples_of(number)\r\n    @list.reject! do |x|\r\n      unless x == number\r\n       x % number == 0 \r\n      end\r\n    end    \r\n  end\r\n  \r\nend\r\n\r\ndescribe Erastostenes do\r\n  it \'makes a list of all integers <= 30 and greater than 1\' do\r\n    e = Erastostenes.new(30)\r\n    number_list = e.number_list\r\n    expect(number_list).to eq([2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30])\r\n  end\r\n    \r\n  it \'should calculate the prime numbers for 30\' do\r\n    e = Erastostenes.new(30)\r\n    result = e.calculate\r\n        \r\n    expect(result).to eq([2,3,5,7,11,13,17,19,23,29])\r\n  end\r\n  \r\nend\r\n```\r\n\r\nThe deleted tests were necessary in the beginning to get us moving in the right direction to solving the problem. Now they are no longer required.\r\n\r\nStep 14\r\n-------\r\n\r\nFinal cleanup.\r\n\r\n```ruby\r\nclass Erastostenes \r\n  def initialize(n)\r\n    @n = n\r\n    @list = number_list\r\n  end\r\n      \r\n  def calculate\r\n    list = number_list\r\n    list.each do |x|\r\n      unless x >= Math.sqrt(@n)\r\n        cross_out_multiples_of(x)\r\n      end\r\n    end\r\n    @list\r\n  end\r\n  \r\n  private\r\n  \r\n  def cross_out_multiples_of(number)\r\n    @list.reject! do |x|\r\n      unless x == number\r\n       x % number == 0 \r\n      end\r\n    end    \r\n  end\r\n  \r\n  def number_list\r\n    (2..@n).to_a  \r\n  end\r\n  \r\nend\r\n\r\n\r\ndescribe Erastostenes do\r\n    \r\n  it \'should calculate the prime numbers for 30\' do\r\n    e = Erastostenes.new(30)\r\n    result = e.calculate\r\n        \r\n    expect(result).to eq([2,3,5,7,11,13,17,19,23,29])\r\n  end\r\n  \r\nend\r\n```\r\n\r\nWe are green after refactoring. Remember to modify either the test code or the production code and run the tests. Do not modify both at the same time without running the tests.\r\n\r\nDiscussion\r\n============\r\n------------\r\n\r\nIf you see the specs there are lot of arrays. I always think twice before coupling the specs to the data structure choice in the production code. Do not write tests that are dependent on data structures. Because, the data structures are implementation details and can change to optimize performance without changing the behavior. If we couple our tests to the implementation details, our tests will be brittle and break even when the behavior remains the same but when the implementation changes.\r\n\r\nExercise\r\n=========\r\n---------\r\n\r\nThe spec used 30 as the example. What is the minimum number that we can use and still have high confidence that our code works?','2014-08-06 16:30:49','2016-12-22 08:21:08'),(481,'TDD Beyond Basics : Greatest Common Divisor','Objective\r\n=========\r\n---------\r\n\r\nLearn how to apply the reduction process to solve problems.\r\n\r\nProblem Statement\r\n===================\r\n-------------------\r\n\r\nGiven two positive non-zero integers n and m, find their greatest common divisor (gcd). The gcd of two integers is the largest integer that will divide exactly into the two integers with no remainder.\r\n\r\nExample 1\r\n========\r\n--------\r\n\r\nHere is a worked out example of GCD of 8 and 12.\r\n\r\n![alt text](https://images.rubyplus.com/gcd-example.png \"GCD Example\")\r\n\r\nIn the second division, we can divide both numbers without any remainder. So GCD of 8 and 12 is 4.\r\n\r\nExample 2\r\n========\r\n--------\r\n\r\nLet\'s consider the GCD of 54 and 24. The number 54 can be expressed as a product of two other integers in several different ways.\r\n\r\n```sh\r\n54 x 1 = 27 x 2 = 18 x 3 = 9 x 6\r\n```\r\n\r\nThus the divisors of 54 are \r\n\r\n```sh\r\n1,2,3,6,9,18,27,54\r\n```\r\n\r\nSimilarly the divisors of 24 are:\r\n\r\n```sh\r\n1,2,3,4,6,8,12,24\r\n```\r\n\r\nThe number that these two lists share in common are the common divisors of 54 & 24. In this case, they are : 1,2,3,6. The greatest of these is 6. That is the GCD of 54 & 24. \r\n\r\nSteps to Solve the Problem\r\n==========================\r\n--------------------------\r\n\r\nBasic strategy for computing the gcd of two numbers:\r\n\r\n1. Divide the larger of the two numbers by the smaller number.\r\n\r\n2. If the smaller number exactly divides into the larger number then the smaller number is the GCD else : remove from the larger number the part common to the smaller number and repeat the whole procedure with the new pair of numbers.\r\n\r\nLet\'s apply the above steps to calcaulate gcd(18,30):\r\n\r\n![alt text](https://images.rubyplus.com/sda-gcd.png \"GCD Example\")\r\n\r\nThe above diagram shows the **reduction** process. Reduction is process where the original problem is reduced to a smaller problem in each iteration until the given problem is solved. \r\n\r\n![alt text](https://images.rubyplus.com/sda-gcd2.png \"GCD Worked Out Example\")\r\n\r\nIterative Construct\r\n===================\r\n-------------------\r\n\r\nWith each **reduction** in the problem size the smaller integer assumes the role of the larger integer and the remainder assumes the role of the smaller integer. The **reduction** in problem size and role changing steps change the divisor, dividend and the remainder. The exact division will correspond to a 0 remainder. \r\n\r\n```ruby\r\nwhile non-zero remainder do\r\n  continue search for gcd\r\nend\r\n```\r\n\r\nInitial Conditions\r\n===================\r\n-------------------\r\n\r\nBefore entering the loop we need remainder for **terminating condition** check, So: \r\n\r\n1. Compute remainder for original pair of integers\r\n2. Search for gcd until 0 remainder\r\n\r\n```ruby\r\nwhile non-zero remainder\r\n  continue search for gcd\r\nend\r\n```\r\n\r\nEuclidean Algorithm\r\n===================\r\n-------------------\r\n\r\n1. Take the two positive non-zero integers smaller and larger.\r\n2. Repeat\r\n- Get the remainder from dividing the larger integer by the smaller integer.\r\n- Let the smaller integer assume the role of the divisor until a 0 remainder is obtained.\r\n3. Return the GCD\r\n\r\n![alt text](https://images.rubyplus.com/euclidean.png \"Euclidean Algorithm\")\r\n\r\nThese three steps is illustrated in a 2 minutes video of [Euclidean Algorithm](https://www.youtube.com/watch?v=AJn843kplDw \"Euclidean Algorithm\") on YouTube.\r\n\r\nSteps\r\n=========\r\n---------\r\n\r\nStep 1\r\n----------\r\n\r\nCreate `gcd_spec.rb` and add the first test as follows:\r\n\r\n```ruby\r\ndescribe \'Gcd\' do\r\n  it \'should find the bigger number\' do\r\n    gcd = Gcd.new(12,30)\r\n    result = gcd.bigger_number\r\n    \r\n    expect(result).to eq(30)    \r\n  end\r\nend\r\n```\r\n\r\nStep 2\r\n-------\r\n\r\nHere is the minimal implementation that will make the test pass.\r\n\r\n```ruby\r\nclass Gcd\r\n  def initialize(x, y)\r\n    @x = y\r\n    @y = y\r\n  end\r\n  \r\n  def bigger_number\r\n    if @x > @y\r\n      @x\r\n    else\r\n      @y\r\n    end\r\n  end\r\nend\r\n```\r\n\r\nStep 3\r\n-------\r\n\r\nAdd the second test as follows:\r\n\r\n```ruby\r\nit \'should return 4 for 8 and 12\' do\r\n  gcd = Gcd.new(8,12)\r\n  result = gcd.calculate\r\n  \r\n  expect(result).to eq(4)    \r\nend\r\n```\r\n\r\nStep 4\r\n------\r\n\r\nLook at the algorithm we developed earlier. Here is the quick and dirty implementation based on that algorithm that passes.\r\n\r\n```ruby\r\nclass Gcd\r\n  def initialize(x, y)\r\n    @x = x\r\n    @y = y\r\n  end\r\n  \r\n  def bigger_number\r\n    if @x > @y \r\n      @bigger_number = @x\r\n      @smaller_number = @y\r\n    else\r\n      @bigger_number = @y\r\n      @smaller_number = @x      \r\n    end\r\n    @bigger_number\r\n  end\r\n  \r\n  def reduce\r\n    bigger_number\r\n    remainder = 1\r\n    divident = @bigger_number\r\n    divisor = @smaller_number  \r\n    while remainder != 0\r\n      remainder = divident % divisor\r\n      divident = divisor\r\n      divisor = remainder\r\n    end\r\n    divident\r\n  end\r\n  \r\n  def calculate\r\n    reduce\r\n  end\r\nend\r\n```\r\n\r\nStep 5\r\n--------\r\n\r\nLet\'s change the while to until to make it idiomatic. In this case we keep looping as long as the remainder is not zero.\r\n\r\n```ruby\r\nwhile remainder != 0\r\n```\r\n\r\nbecomes\r\n\r\n```ruby\r\nuntil remainder == 0\r\n```\r\n\r\nwhich says, keep looping and exit loop when the remainder becomes zero.\r\n\r\nStep 6\r\n--------\r\n\r\nLet\'s add another example:\r\n\r\n```ruby\r\nit \'should return 6 for 54 and 24\' do\r\n  gcd = Gcd.new(24,54)\r\n  result = gcd.calculate\r\n  \r\n  expect(result).to eq(6)    \r\nend\r\n```\r\n\r\nIt passes. \r\n\r\nStep 7\r\n--------\r\n\r\nLet\'s add another example:\r\n\r\n```ruby\r\nit \'should return 6 for 12,30\' do\r\n  gcd = Gcd.new(12,30)\r\n  result = gcd.calculate\r\n\r\n  expect(result).to eq(6)\r\nend\r\n```\r\n\r\nIt passes. Our solution is generic to handle any cases.\r\n\r\nStep 8\r\n------\r\n\r\nHere is the final version after cleanup, `gcd_spec.rb`:\r\n\r\n```ruby\r\nclass Gcd\r\n  def initialize(x, y)\r\n    @x = x\r\n    @y = y\r\n    initialize_numbers\r\n  end\r\n  \r\n  def initialize_numbers\r\n    if @x > @y \r\n      @bigger_number = @x\r\n      @smaller_number = @y\r\n    else\r\n      @bigger_number = @y\r\n      @smaller_number = @x      \r\n    end\r\n  end\r\n  \r\n  def calculate\r\n    remainder = 1\r\n    divident = @bigger_number\r\n    divisor = @smaller_number  \r\n    until remainder == 0\r\n      remainder = divident % divisor\r\n      divident = divisor\r\n      divisor = remainder\r\n    end\r\n    divident\r\n  end\r\n  \r\nend\r\n\r\n\r\ndescribe \'Gcd\' do  \r\n  it \'should return 4 for 8 and 12\' do\r\n    gcd = Gcd.new(8,12)\r\n    result = gcd.calculate\r\n    \r\n    expect(result).to eq(4)    \r\n  end\r\n  \r\n  it \'should return 6 for 54 and 24\' do\r\n    gcd = Gcd.new(24,54)\r\n    result = gcd.calculate\r\n    \r\n    expect(result).to eq(6)    \r\n  end\r\n  \r\n  it \'should return 6 for 12,30\' do\r\n    gcd = Gcd.new(12,30)\r\n    result = gcd.calculate\r\n\r\n    expect(result).to eq(6)\r\n  end\r\n\r\nend\r\n```\r\n\r\nWe have deleted the test that was coupled to the implementation. It is now in the constructor. The reduce method is deleted.\r\n\r\nExercise\r\n========\r\n--------\r\n\r\nAdd the following test:\r\n\r\n```ruby\r\nit \'should return 6 for 12,30\' do\r\n  gcd = Gcd.new(12,30)\r\n  result = gcd.calculate\r\n  \r\n  expect(result).to eq(6)\r\nend\r\n```\r\n\r\nDoes it pass? Do you want to retain or delete this new test? Why?','2014-08-06 18:23:06','2016-12-22 08:24:06'),(491,'TDD Beyond Basics : Tennis Kata','Problem Statement\r\n=================\r\n-----------------\r\n\r\nWrite a program to output correct score for a tennis game. Here is the summary of tennis scores:\r\n\r\n1. A game is won by the first player to if the player has won at least four points in total and at least two points more than the opponent. \r\n2. The running score of each game is describe as \'Love\', \'Fifteen\', \'Thirty\' and \'Forty\' for points from zero to three.\r\n3. If at least three points is scored by both players and the scores are equal, the score is \'Deuce\'.\r\n4. If at least three points is scored by both players and a player has one more point than his opponent, the score of the game is \'Advantage\' for the player with more points.\r\n\r\nSets and matches are out of scope. We only need to report the score for the current game. \r\n\r\nDifficulty Level\r\n================\r\n----------------\r\n\r\nMedium\r\n\r\nSteps\r\n=====\r\n-----\r\n\r\nStep 1\r\n======\r\n------\r\n\r\nCreate tennis_game_spec.rb with the following code:\r\n\r\n```ruby\r\nclass TennisGame\r\n  \r\n  def player_one_score\r\n    \r\n  end\r\n  \r\n  def player_two_score\r\n    \r\n  end\r\nend\r\n\r\ndescribe TennisGame do\r\n  it \'initial scores for both players must be Love\' do\r\n    game = TennisGame.new\r\n    \r\n    player_one_score = game.player_one_score\r\n    player_two_score = game.player_two_score\r\n    \r\n    expect(player_one_score).to eq(\'Love\')\r\n    expect(player_two_score).to eq(\'Love\')\r\n  end\r\nend\r\n```\r\n\r\nThis test fails for the right reason with the error message \'Expected Love got nil\'.\r\n\r\nStep 2\r\n------\r\n\r\nMake the test pass by returning hard-coded value as follows:\r\n\r\n```ruby\r\nclass TennisGame  \r\n  def player_one_score\r\n    \'Love\'\r\n  end\r\n  \r\n  def player_two_score\r\n    \'Love\'\r\n  end\r\nend\r\n```\r\n\r\nStep 3\r\n------\r\n\r\nAdd the second spec as follows:\r\n\r\n```ruby\r\nit \'returns 15 for player one when player one wins the point\' do\r\n  game = TennisGame.new\r\n  game.wins_point(1)\r\n  \r\n  player_one_score = game.player_one_score\r\n  player_two_score = game.player_two_score\r\n  \r\n  expect(player_one_score).to eq(\'Fifteen\')\r\n  expect(player_two_score).to eq(\'Love\')\r\nend\r\n```\r\n\r\nThis test fails. The line:\r\n\r\n```ruby\r\ngame.wins_point(1)\r\n```\r\n\r\ndoes not make any sense. \r\n\r\nStep 4\r\n------\r\n\r\nLet\'s rewrite our spec as follows:\r\n\r\n```ruby\r\nit \'returns 15 for player one when player one wins the point\' do\r\n  player_one = Player.new(\'McEnroe\')\r\n  player_two = Player.new(\'Borg\')\r\n  \r\n  game = TennisGame.new(player_one, player_two)\r\n  player_one.wins_point\r\n  \r\n  player_one_score = game.player_one_score\r\n  player_two_score = game.player_two_score\r\n  \r\n  expect(player_one_score).to eq(\'Fifteen\')\r\n  expect(player_two_score).to eq(\'Love\')\r\nend\r\n```\r\n\r\nThis breaks the first test also. Let\'s comment out the second test and focus on getting the first spec to pass.\r\n\r\nStep 5\r\n------\r\n\r\nComment out the second spec and change the first spec as follows:\r\n\r\n```ruby\r\nit \'initial scores for both players must be Love\' do\r\n  player_one = Player.new(\'McEnroe\')\r\n  player_two = Player.new(\'Borg\')\r\n  \r\n  game = TennisGame.new(player_one, player_two)\r\n  \r\n  player_one_score = game.player_one_score\r\n  player_two_score = game.player_two_score\r\n  \r\n  expect(player_one_score).to eq(\'Love\')\r\n  expect(player_two_score).to eq(\'Love\')\r\nend\r\n\r\nxit \'returns 15 for player one when player one wins the point\' do\r\n  # same code as before\r\nend\r\n```\r\n\r\nThe minimal implementation to make this test pass is as follows:\r\n\r\n```ruby\r\nclass Player\r\n  attr_reader :points\r\n  \r\n  def initialize(name)\r\n    @name = name\r\n    @points = 0\r\n  end  \r\n  \r\n  def wins_point\r\n    @points += 1\r\n  end\r\nend\r\n\r\nclass TennisGame  \r\n  def initialize(player_one, player_two)\r\n    @player_one = player_one\r\n    @player_two = player_two  \r\n  end\r\n  \r\n  def wins_point(player)\r\n    @player_one.wins_point\r\n  end\r\n  \r\n  def player_one_score\r\n    if @player_one.points == 0\r\n      \'Love\'\r\n    end\r\n  end\r\n  \r\n  def player_two_score\r\n    if @player_two.points == 0\r\n      \'Love\'\r\n    end\r\n  end\r\nend\r\n```\r\n\r\nStep 6\r\n------\r\n\r\nUncomment the second spec and run it. It now fails for the right reason with the error message \'expected Fifteen, got nil\'. Change the implementation for TennisGame as follows:\r\n\r\n```ruby\r\nclass TennisGame  \r\n  def initialize(player_one, player_two)\r\n    @player_one = player_one\r\n    @player_two = player_two  \r\n  end\r\n  \r\n  def wins_point(player)\r\n    @player_one.wins_point\r\n  end\r\n  \r\n  def player_one_score\r\n    @player_one.score\r\n  end\r\n  \r\n  def player_two_score\r\n    @player_two.score\r\n  end\r\nend\r\n```\r\n\r\nThe test passes.\r\n\r\nStep 7\r\n-----\r\n\r\nLet\'s tackle the duplication of player score code in TennisGame class.\r\n\r\n```ruby\r\nclass Player\r\n  attr_reader :points\r\n  \r\n  def initialize(name)\r\n    @name = name\r\n    @points = 0\r\n  end  \r\n  \r\n  def wins_point\r\n    @points += 1\r\n  end\r\n  \r\n  def score\r\n    if @points == 0\r\n      \'Love\'\r\n    elsif @points == 1\r\n      \'Fifteen\'\r\n    end\r\n  end\r\nend\r\n\r\nclass TennisGame  \r\n  def initialize(player_one, player_two)\r\n    @player_one = player_one\r\n    @player_two = player_two  \r\n  end\r\n  \r\n  def wins_point(player)\r\n    @player_one.wins_point\r\n  end\r\n  \r\n  def player_one_score\r\n    @player_one.score\r\n  end\r\n  \r\n  def player_two_score\r\n    @player_two.score\r\n  end\r\nend\r\n```\r\n\r\nThe TennisGame class delegates the score computation to the player class. The tests still pass.\r\n\r\nStep 8\r\n------\r\n\r\nThe name has been removed from the player class because it is not relevant in scoring a game. All tests pass after the refactoring. Add the third test as follows:\r\n\r\n\r\n```ruby\r\nit \'returns 30 for player one when player one wins two points\' do\r\n  player_one = Player.new\r\n  player_two = Player.new\r\n  \r\n  game = TennisGame.new(player_one, player_two)\r\n  player_one.wins_point\r\n  player_one.wins_point\r\n  \r\n  player_one_score = game.player_one_score\r\n  player_two_score = game.player_two_score\r\n  \r\n  expect(player_one_score).to eq(\'Thirty\')\r\n  expect(player_two_score).to eq(\'Love\')    \r\nend\r\n```\r\n\r\nIt fails for the right reason with the error message \'expected: Thirty, got nil\'.\r\n\r\nStep 9\r\n------\r\n\r\nTo make the test pass, change the score method as follows:\r\n\r\n```ruby\r\ndef score\r\n  if @points == 0\r\n    \'Love\'\r\n  elsif @points == 1\r\n    \'Fifteen\'\r\n  elsif @points == 2\r\n    \'Thirty\'\r\n  end\r\nend\r\n```\r\n\r\nStep 10\r\n------\r\n\r\nAdd the fourth test as follows:\r\n\r\n```ruby\r\nit \'returns 40 for player one when player one wins three points\' do\r\n  player_one = Player.new\r\n  player_two = Player.new\r\n  \r\n  game = TennisGame.new(player_one, player_two)\r\n  player_one.wins_point\r\n  player_one.wins_point\r\n  player_one.wins_point\r\n  \r\n  player_one_score = game.player_one_score\r\n  player_two_score = game.player_two_score\r\n  \r\n  expect(player_one_score).to eq(\'Forty\')\r\n  expect(player_two_score).to eq(\'Love\')    \r\nend\r\n```\r\n\r\nIt fails for the right reason with the error message \'expected Forty, got nil\'.\r\n\r\nStep 11\r\n-------\r\n\r\nYou can make the test pass by changing the score method as follows:\r\n\r\n```ruby\r\ndef score\r\n  if @points == 0\r\n    \'Love\'\r\n  elsif @points == 1\r\n    \'Fifteen\'\r\n  elsif @points == 2\r\n    \'Thirty\'\r\n  elsif @points == 3\r\n    \'Forty\'\r\n  end\r\nend\r\n```\r\n\r\nStep 12\r\n-------\r\n\r\nLet\'s add a test to check when both players have won one point, the scores are 15-all.\r\n\r\n```ruby\r\nit \'returns 15 for both players when both have won one point\' do\r\n  player_one = Player.new\r\n  player_two = Player.new\r\n  \r\n  game = TennisGame.new(player_one, player_two)\r\n  player_one.wins_point\r\n  player_two.wins_point\r\n  \r\n  player_one_score = game.player_one_score\r\n  player_two_score = game.player_two_score\r\n  \r\n  expect(player_one_score).to eq(\'Fifteen\')\r\n  expect(player_two_score).to eq(\'Fifteen\')        \r\nend\r\n```\r\n\r\nThis test passes.\r\n\r\nStep 13\r\n-------\r\n\r\nLet\'s consider the duece case:\r\n\r\n```ruby\r\nit \'returns duece both players have won three points\' do\r\n  player_one = Player.new\r\n  player_two = Player.new\r\n  \r\n  game = TennisGame.new(player_one, player_two)\r\n  player_one.wins_point\r\n  player_one.wins_point\r\n  player_one.wins_point\r\n  \r\n  player_two.wins_point\r\n  player_two.wins_point\r\n  player_two.wins_point\r\n    \r\n  expect(game.score).to eq(\'Duece\')\r\nend\r\n```\r\n\r\nThis fails with no score method for TennisGame error.\r\n\r\nStep 14\r\n-------\r\n\r\nAdd the score method to the TennisGame class as follows:\r\n\r\n```ruby\r\ndef score\r\n  if @player_one.points == 3 and @player_two.points == 3\r\n    \'Duece\'\r\n  end\r\nend\r\n```\r\n\r\nThe test passes.\r\n\r\nStep 15\r\n------\r\n\r\nLet\'s tackle the \'Advantage\' case now. This is the fourth rule in the problem statement:\r\n\r\nIf at least three points is scored by both players and a player has one more point than his opponent, the score of the game is \'Advantage\' for the player with more points.\r\n\r\n\r\nAdd the new test for this case with the code as follows:\r\n\r\n```ruby\r\nit \'returns Advantage for the player with one more point after 3 points by both\' do\r\n\r\n  player_one = Player.new\r\n  player_two = Player.new\r\n  \r\n  game = TennisGame.new(player_one, player_two)\r\n  player_one.wins_point\r\n  player_one.wins_point\r\n  player_one.wins_point\r\n  \r\n  player_two.wins_point\r\n  player_two.wins_point\r\n  player_two.wins_point\r\n\r\n  player_one.wins_point\r\n  \r\n  expect(game.score).to eq(\"Advantage #{player_one.name}\")\r\nend \r\n```\r\n\r\nThis fails. \r\n\r\nStep 16\r\n-------\r\n\r\nChange the test as follows:\r\n\r\n```ruby\r\nit \'returns Advantage for the player with one more point after 3 points by both\' do\r\n\r\n  player_one = Player.new(\'McEnroe\')\r\n  player_two = Player.new(\'Borg\')\r\n  \r\n  game = TennisGame.new(player_one, player_two)\r\n  player_one.wins_point\r\n  player_one.wins_point\r\n  player_one.wins_point\r\n  \r\n  player_two.wins_point\r\n  player_two.wins_point\r\n  player_two.wins_point\r\n\r\n  player_one.wins_point\r\n  \r\n  expect(game.score).to eq(\"Advantage #{player_one.name}\")\r\nend \r\n```\r\n\r\nStep 17\r\n-------\r\n\r\nChange the player class as follows:\r\n\r\n```ruby\r\nclass Player\r\n  attr_reader :points, :name\r\n  \r\n  def initialize(name=\'\')\r\n    @name = name\r\n    @points = 0\r\n  end  \r\n  \r\n  def wins_point\r\n    @points += 1\r\n  end\r\n  \r\n  def score\r\n    if @points == 0\r\n      \'Love\'\r\n    elsif @points == 1\r\n      \'Fifteen\'\r\n    elsif @points == 2\r\n      \'Thirty\'\r\n    elsif @points == 3\r\n      \'Forty\'\r\n    end\r\n  end\r\nend\r\n```\r\n\r\nThe test now fails for the right reason.\r\n\r\nStep 18\r\n-------\r\n\r\nChange the score method of the TennisGame as follows:\r\n\r\n```ruby\r\ndef score\r\n  if @player_one.points == 3 and @player_two.points == 3\r\n    \'Duece\'\r\n  elsif (@player_one.points == @player_two.points + 1) and (@player_two.points >=3)\r\n    \"Advantage #{@player_one.name}\"\r\n  end\r\nend\r\n```\r\n\r\nAll tests now pass.\r\n\r\nStep 19\r\n-------\r\n\r\nLet\'s tackle the winning game with the following rule:\r\n\r\nA game is won by the first player to if the player has won at least four points in total and at least two points more than the opponent. \r\n\r\nAdd the new test for the winning game as follows:\r\n\r\n```ruby\r\nit \"Game \'winner name\' when a player wins 4 points with no points by the opponent\" do\r\n\r\n  player_one = Player.new(\'McEnroe\')\r\n  player_two = Player.new(\'Borg\')\r\n  \r\n  game = TennisGame.new(player_one, player_two)\r\n  player_one.wins_point\r\n  player_one.wins_point\r\n  player_one.wins_point\r\n  player_one.wins_point\r\n  \r\n  expect(game.score).to eq(\"Game #{player_one.name}\")\r\nend \r\n```\r\n\r\nThis fails for the right reason with the error message \'expected: Game McEnroe got nil\'.\r\n\r\nStep 20\r\n--------\r\n\r\nChange the score method of the TennisGame class as follows:\r\n\r\n```ruby\r\ndef score\r\n  if @player_one.points == 3 and @player_two.points == 3\r\n    \'Duece\'\r\n  elsif (@player_one.points == @player_two.points + 1) and (@player_two.points >=3)\r\n    \"Advantage #{@player_one.name}\"\r\n  elsif (@player_one.points >= 4) and (@player_one.points >= (@player_two.points + 2))\r\n    \"Game #{@player_one.name}\"\r\n  end\r\nend\r\n```\r\n\r\nAll tests now pass.\r\n\r\nDiscussion\r\n==========\r\n----------\r\n\r\nIn this kata we discovered a missing collaborator when we found that the allocation of responsibilities were not in the right class. We found the missing abstraction Player when we eliminated the duplication is scoring logic. We also found that the scores must provide player\'s name in order to say who won the game. The attributes and behavior associated with a player is encapsulated in it\'s own class. \r\n\r\nTennisGame class can be renamed to TennisUmpire class to better represent the abstraction. Because it knows which player won the point and has the knowledge to decide who wins the game based on the points scored by the players.\r\n\r\nSome of the tests has two assertions. In a real tennis game, the score is determined based on who is serving. Since we have not taken that into account, we ended up with two assertions. We will keep the two assertions in the tests.\r\n\r\nExercise\r\n=========\r\n---------\r\n\r\nWrite tests for the missing cases and make them pass.\r\n\r\n','2014-08-07 03:53:03','2014-08-14 06:05:44'),(501,'How to Install Redis','Development Environment\r\n================\r\n------------------------\r\n\r\n```sh\r\n$brew install redis\r\n```\r\n\r\nRun the commands shown after the installation is complete to start redis automatically on startup. To start the server manually, run:\r\n\r\n```sh\r\n$redis-server /usr/local/etc/redis.conf\r\n```\r\n\r\nProduction Environment\r\n================\r\n------------------------\r\n\r\nInstall Redis using Moonshine Redis plugin.\r\n------------------------\r\n\r\nFor Rails 4.x application:\r\n\r\n```sh\r\nplugger install git://github.com/railsmachine/moonshine_redis.git\r\n```\r\n\r\nSpecify the redis version to install, by adding the following configuration to moonshine.yml in your Rails project:\r\n\r\n```ruby\r\n:redis:\r\n  :version: 2.8.9\r\n```\r\n\r\nYou don\'t have to specify other settings, Moonshine will use default settings.\r\n  \r\nInclude the recipe in your Moonshine manifest, in app/manifests/application_manifest.rb:\r\n\r\n```ruby\r\nrecipe :redis\r\n```\r\n\r\nCheck in the code to git and do a cap deploy.\r\n\r\nManual Installation\r\n------------------------\r\n\r\nIf you are not managing your server using Moonshine, you can skip the above four steps and install it manually by reading [How To Install and Use Redis](https://www.digitalocean.com/community/tutorials/how-to-install-and-use-redis \"How To Install and Use Redis\")\r\n\r\nVerify Installation\r\n---------------------\r\n\r\nYou can check the redis server version as follows:\r\n\r\n```ruby\r\n$redis-server --version\r\nRedis server v=2.8.9 sha=00000000:0 malloc=libc bits=64 build=9ccc8119ea98f6e1\r\n```\r\n\r\nTo check if redis is working properly. You can ssh into your server and run:\r\n\r\n```ruby\r\n$redis-cli ping\r\nPONG\r\n```\r\n\r\nYou can also play with it in an interactive mode to make sure it\'s working as follows:\r\n\r\n```ruby\r\n$redis-cli\r\n127.0.0.1:6379> ping\r\nPONG\r\n127.0.0.1:6379> set foo bar\r\nOK\r\n127.0.0.1:6379> get foo\r\n\"bar\"\r\n127.0.0.1:6379> \r\n```','2014-08-08 18:44:51','2014-08-14 05:52:12'),(511,'TDD Beyond Basics : Prime Factors Kata','Objective\r\n=========\r\n---------\r\n\r\nLearn to evaluate whether the amount of test code to production code is reasonable or not. \r\n\r\nDiscussion\r\n==========\r\n----------\r\n\r\nThe principle of Ensure Commensurate Effort and Responsibility states that the amount of effort it takes to to write or modify tests should not exceed the effort it takes to implement the corresponding functionality. This principle is discussed in depth in xUnit Test Patterns by Gerard Meszaros.\r\n\r\nProblem Statement\r\n=================\r\n-----------------\r\n\r\nFactorize a positive integer number into its prime factors.\r\n\r\nProblem Domain Analysis\r\n=========\r\n---------\r\n\r\nHere is some sample input and output.\r\n\r\n![alt text](https://images.rubyplus.com/pda-prime-factors.png \"Prime Factors\")\r\n\r\nSolution Domain Analysis\r\n=================\r\n-----------------\r\n\r\nStart with the divisor 2 and repeatedly reduce n by a factor of 2 until 2 is no longer an exact divisor. We then try 3 as a divisor and again repeat the reduction process and so son until n has been reduced to 1.\r\n\r\nConsider n = 60. Marking with an * the unsuccessful attempts to divide, we have:\r\n\r\n![alt text](https://images.rubyplus.com/sda-prime-factors.png \"Prime Factors\")\r\n\r\nThat is, 60 = 2 x 2 x 3 x 5, and those numbers are primes.\r\n\r\nSteps\r\n========\r\n--------\r\n\r\nStep 1\r\n---------\r\n\r\nCreate `prime_factor_spec.rb`:\r\n\r\n```ruby\r\ndescribe PrimeFactor do\r\n  it \'should return 2 for input of 2\' do\r\n    prime_factorial = PrimeFactor.new(2)\r\n    \r\n    prime = prime_factorial.calculate\r\n    \r\n    expect(prime).to eq([2])\r\n  end\r\nend\r\n```\r\n\r\nCreate `prime_factor.rb` :\r\n\r\n```ruby\r\nclass PrimeFactor\r\n  def initialize(n)\r\n    @n = n\r\n  end\r\n  \r\n  def calculate\r\n\r\n  end\r\nend\r\n```\r\n\r\nThe test fails for the right reason.\r\n\r\nStep 2\r\n---------\r\n\r\nChange `prime_factor.rb` :\r\n\r\n```ruby\r\nclass PrimeFactor\r\n  def initialize(n)\r\n    @n = n\r\n  end\r\n  \r\n  def calculate\r\n    [2]\r\n  end\r\nend\r\n```\r\n\r\nThe test passes.\r\n\r\nStep 3\r\n---------\r\n\r\nAdd the next test:\r\n\r\n```ruby\r\n  it \'should return 3 for input of 3\' do\r\n    prime_factorial = PrimeFactor.new(3)\r\n\r\n    prime = prime_factorial.calculate\r\n\r\n    expect(prime).to eq([3])\r\n  end\r\n```\r\n\r\nThe test fails.\r\n\r\nStep 4\r\n---------\r\n\r\nChange the calculate method as follows:\r\n\r\n```ruby\r\n  def calculate\r\n    [@n]\r\n  end\r\n```\r\n\r\nBoth tests pass.\r\n\r\nStep 5\r\n---------\r\n\r\nAdd the next test:\r\n\r\n```ruby\r\n  it \'should return [2,2] for input of 4\' do\r\n    prime_factorial = PrimeFactor.new(4)\r\n\r\n    prime = prime_factorial.calculate\r\n\r\n    expect(prime).to eq([2,2])\r\n  end\r\n```\r\n\r\nThis test fails.\r\n\r\nStep 6\r\n---------\r\n\r\nAdd the following quick and dirty implementation.\r\n\r\n```ruby\r\n  def calculate\r\n    result = []\r\n    \r\n    remainder = @n / 2\r\n    result << 2\r\n    result << remainder if Prime.prime?(remainder)\r\n    \r\n    result\r\n  end\r\n```\r\n\r\nThis test now passes. But it breaks the second spec. We will make it pending for now.\r\n\r\nStep 7\r\n---------\r\n\r\nHere is some notes from [Prime Factor](http://www.mathsisfun.com/prime-factorization.html \"Prime Factor\") discussion:\r\n\r\n```sh\r\nn = 12\r\n12 / 2 = 6\r\n```\r\n\r\nIs 12 evenly divisible by 2? Yes. Add 2 to the result list.\r\n\r\nThe remainder 6 is not a prime number, so we need to continue processing. Try 2 again:\r\n\r\n```sh\r\n6 / 2 = 3\r\n```\r\n\r\n6 is evenly divisible by 2, so add 2 to the result list. Is the remainder 3 a prime? Yes. Add it to the result list and STOP. Using this as the reference, here is the implementation that passes the test:\r\n\r\n```ruby\r\n  def calculate\r\n    result = []\r\n    \r\n    until Prime.prime?(@n)\r\n      if (@n % 2) == 0\r\n        result << 2\r\n        @n = @n / 2\r\n      elsif (@n % 3) == 0\r\n        result << 3  \r\n        @n = @n / 3\r\n        elsif \r\n      end\r\n    end\r\n    result << @n\r\n        \r\n    result\r\n  end\r\n```\r\n\r\nFrom the notes, we have found the terminating condition for our algorithm. We are also using the concept of reduction we learned in an earlier article.\r\n\r\nStep 8\r\n---------\r\n\r\nUncomment the second test. This test passes without making any changes because our code is generic enough to handle the edge case of one element.\r\n\r\nStep 9\r\n----------\r\n\r\n```ruby\r\n  it \'should return [3,7,7] for input of 147\' do\r\n    prime_factorial = PrimeFactor.new(147)\r\n\r\n    prime = prime_factorial.calculate\r\n\r\n    expect(prime).to eq([3,7,7])    \r\n  end\r\n```\r\n\r\nStep 10\r\n--------\r\n\r\nHere is the quick and dirty implementation that makes all the tests pass.\r\n\r\n```ruby\r\ndef calculate\r\n  result = []\r\n  \r\n  until Prime.prime?(@n)\r\n    if (@n % 2) == 0\r\n      result << 2\r\n      @n = @n / 2\r\n    elsif (@n % 3) == 0\r\n      result << 3\r\n      @n = @n / 3\r\n    elsif (@n % 7) == 0        \r\n      result << 7\r\n      @n = @n / 7\r\n    end\r\n  end\r\n  result << @n\r\n      \r\n  result\r\nend\r\n```\r\n\r\nStep 11\r\n--------\r\n\r\nReading the mathisfun.com worked out examples and converting them into tests has given us more insight into the problem. We see that we need to continuously look for the given number is evenly divisible by a series of prime numbers. \r\n\r\nWe have already discussed how to generate primes using The Sieve of Erastosthenes in a previous article. Let\'s adapt that function so that given a number, erastosthenes function will give us the next prime for us to use in the divisible by prime check condition. For an in-depth discussion on how the Sieve of Erastosthenes can be used to solve prime factor problem read the book How to Solve It by Computer (Prentice-Hall International Series in Computer Science) by R. G. Dromey.\r\n\r\nAfter experimenting in the irb, here is a function that assumes we only need a list of primes upto 100, it takes a number and gives the next prime in the list. This function is added to our existing Erastostenes class.\r\n\r\n```ruby\r\ndef self.next(n)\r\n  e = Erastostenes.new(100)  \r\n  primes = e.calculate\r\n  primes.detect{|x| x > n}\r\nend\r\n```\r\n\r\nStep 12\r\n-------\r\n\r\nLet\'s refactor our code so that it uses our Sieve of Erastostenes for the evenly divisible check. Here is a partial refactoring:\r\n\r\n```ruby\r\ndef calculate\r\n  result = []\r\n  \r\n  current_prime = 2\r\n  \r\n  until Prime.prime?(@n)\r\n    if (@n % current_prime) == 0\r\n      result << current_prime\r\n      @n = @n / current_prime\r\n    elsif (@n % 3) == 0\r\n      result << 3\r\n      @n = @n / 3\r\n    elsif (@n % 7) == 0        \r\n      result << 7\r\n      @n = @n / 7\r\n    end\r\n  end\r\n  result << @n\r\n      \r\n  result\r\nend\r\n```\r\n\r\nAll tests passes. Let\'s continue the refactoring.\r\n\r\nStep 13\r\n--------\r\n\r\nHere is the cleaned up version of the calculate method:\r\n\r\n```ruby\r\ndef calculate\r\n  result = []\r\n  \r\n  current_prime = 2\r\n  \r\n  until Prime.prime?(@n)\r\n    if (@n % current_prime) == 0\r\n      result << current_prime\r\n      @n = @n / current_prime\r\n    else\r\n      current_prime = Erastostenes.next(current_prime)\r\n    end\r\n  end\r\n  result << @n\r\n      \r\n  result\r\nend\r\n```\r\n\r\nAll tests pass.\r\n\r\nStep 14\r\n----------\r\n\r\nI added more specs one by one to check the answer for different numbers, here is the new specs:\r\n\r\n```ruby\r\nit \'should return [2,3] for input of 6\' do\r\n  prime_factorial = PrimeFactor.new(6)\r\n\r\n  prime = prime_factorial.calculate\r\n\r\n  expect(prime).to eq([2, 3])\r\nend\r\n\r\nit \'should return [2,2, 2] for input of 8\' do\r\n  prime_factorial = PrimeFactor.new(8)\r\n\r\n  prime = prime_factorial.calculate\r\n\r\n  expect(prime).to eq([2, 2, 2])\r\nend\r\n\r\nit \'should return [2,7] for input of 14\' do\r\n  prime_factorial = PrimeFactor.new(14)\r\n\r\n  prime = prime_factorial.calculate\r\n\r\n  expect(prime).to eq([2, 7])\r\nend\r\n\r\nit \'should handle any number\' do\r\n  prime_factorial = PrimeFactor.new(168)\r\n\r\n  prime = prime_factorial.calculate\r\n\r\n  expect(prime).to eq([2, 2, 2, 3, 7])\r\nend\r\n```\r\n\r\nAll the tests pass without making any modification to our solution.\r\n\r\nComplete Code Listing\r\n=====================\r\n---------------------\r\n\r\n```ruby\r\nrequire_relative \'erastosthenes.rb\'\r\nrequire \'prime\'\r\n\r\nclass PrimeFactor\r\n  def initialize(n)\r\n    @n = n\r\n  end\r\n    \r\n  def calculate\r\n    result = []\r\n    \r\n    current_prime = 2\r\n    \r\n    until Prime.prime?(@n)\r\n      if (@n % current_prime) == 0\r\n        result << current_prime\r\n        @n = @n / current_prime\r\n      else\r\n        current_prime = Erastostenes.next(current_prime)\r\n      end\r\n    end\r\n    result << @n\r\n        \r\n    result\r\n  end\r\nend\r\n\r\ndescribe PrimeFactor do\r\n  it \'should return 2 for input of 2\' do\r\n    prime_factorial = PrimeFactor.new(2)\r\n    \r\n    prime = prime_factorial.calculate\r\n    \r\n    expect(prime).to eq([2])\r\n  end\r\n  \r\n  it \'should return 3 for input of 3\' do\r\n    prime_factorial = PrimeFactor.new(3)\r\n\r\n    prime = prime_factorial.calculate\r\n\r\n    expect(prime).to eq([3])\r\n  end\r\n\r\n  it \'should return [2,2] for input of 4\' do\r\n    prime_factorial = PrimeFactor.new(4)\r\n\r\n    prime = prime_factorial.calculate\r\n\r\n    expect(prime).to eq([2,2])\r\n  end\r\n\r\n  it \'should return [2, 2, 3] for input of 12\' do\r\n    prime_factorial = PrimeFactor.new(12)\r\n\r\n    prime = prime_factorial.calculate\r\n\r\n    expect(prime).to eq([2,2,3])\r\n  end\r\n\r\n  it \'should return [3,7,7] for input of 147\' do\r\n    prime_factorial = PrimeFactor.new(147)\r\n\r\n    prime = prime_factorial.calculate\r\n\r\n    expect(prime).to eq([3,7,7])    \r\n  end\r\n\r\n  it \'should return [2,3] for input of 6\' do\r\n    prime_factorial = PrimeFactor.new(6)\r\n\r\n    prime = prime_factorial.calculate\r\n\r\n    expect(prime).to eq([2, 3])\r\n  end\r\n  \r\n  it \'should return [2,2, 2] for input of 8\' do\r\n    prime_factorial = PrimeFactor.new(8)\r\n\r\n    prime = prime_factorial.calculate\r\n\r\n    expect(prime).to eq([2, 2, 2])\r\n  end\r\n  \r\n  it \'should return [2,7] for input of 14\' do\r\n    prime_factorial = PrimeFactor.new(14)\r\n\r\n    prime = prime_factorial.calculate\r\n\r\n    expect(prime).to eq([2, 7])\r\n  end\r\n\r\n  it \'should handle any number\' do\r\n    prime_factorial = PrimeFactor.new(168)\r\n\r\n    prime = prime_factorial.calculate\r\n\r\n    expect(prime).to eq([2, 2, 2, 3, 7])\r\n  end\r\n  \r\n  it \'should handle any number\' do\r\n    prime_factorial = PrimeFactor.new(330)\r\n\r\n    prime = prime_factorial.calculate\r\n\r\n    expect(prime).to eq([2, 3, 5, 11])\r\n  end\r\n  \r\nend\r\n```\r\n\r\nDiscussion\r\n==========\r\n----------\r\n\r\nWe have 20 lines of production code and almost 70 lines of test code. Ideally we want the minimal number of tests that gives us enough confidence in our code. After you write the story test, do some exploratory testing and write some tests based on exploratory tests, evaluate whether the test to code ratio is reasonable. \r\n\r\nWe made a simplifying assumption in generating a prime factors list by limiting it to 100. You can improve this implementation by reading the Prime Factors Analysis article.\r\n\r\nExercises\r\n==========\r\n----------\r\n\r\n1. Can you delete some of the tests? What is the minimum number of tests for this problem?\r\n2. Study the [Prime Factors Analysis](https://rubyplus.com/articles/541-Prime-Factors-Kata-Analysis \'Prime Factors Analysis\'). Compute the prime number required only up to a certain number discussed in that article.\r\n3. To find prime factors of a given number, you can use this online tool [Find the Prime Factors of a Number](http://www.math.wustl.edu/cgi-bin/primes \"Find the Prime Factors of a Number\")','2014-08-11 04:08:59','2016-12-22 08:56:20'),(521,'TDD Basics : Obvious Implementation','Problem Statement\r\n=================\r\n-----------------\r\n\r\nGiven two variables a and b, exchange the values assigned to them.\r\n\r\nObjective\r\n==========\r\n----------\r\n\r\nLearn when to use Obvious Implementation instead of Fake it Till You Make it or Triangulation.\r\n\r\nProblem Domain Analysis\r\n=======================\r\n-----------------------\r\n\r\nIn this phase, we define the problem clearly. \r\n\r\nBefore exchange, the initial values are : a = 1  and b = 2\r\nAfter exchange, the final values are : a = 2  and b = 1\r\n\r\n![alt text](https://images.rubyplus.com/pda-exchange.png \"Exchange Digits\")\r\n\r\nSolution Domain Analysis\r\n========================\r\n------------------------\r\n\r\n It\'s very easy to exchange values in Ruby. Here is the irb session that shows how to swap the values of a and b using just one line.\r\n \r\n ```ruby\r\n $irb\r\n > a = 1\r\n => 1 \r\n > b = 2\r\n => 2 \r\n > a,b=b,a\r\n => [2, 1] \r\n > a\r\n => 2 \r\n > b\r\n => 1 \r\n```\r\n\r\nLet\'s solve the problem in a way that allows implementing it in any language. This means we can implement the solution in languages that requires more work to swap values. Let a = 1, b = 2, here is an experiment for exchanging the values in the irb session:\r\n\r\n```ruby\r\n$irb\r\n > a = 1\r\n => 1 \r\n > b = 2\r\n => 2 \r\n > a = b\r\n => 2 \r\n > b = a\r\n => 2 \r\n > a\r\n => 2 \r\n > b\r\n => 2 \r\n```\r\n\r\nThis means we cannot do the following:\r\n\r\n```sh\r\na = b\r\nb = a\r\n```\r\n\r\n![alt text](https://images.rubyplus.com/sda-exchange3.png \"Exchange Digits\")\r\n\r\nBecause both a and b values end up with the value of 2. Our objective in this phase is to create a model and test the model to make sure that it works. Here is a model that fixes the above problem:\r\n\r\n```sh\r\nnew value of a = original value of b\r\nnew value of b = original value of a\r\n```\r\n\r\nThis means we need to preserve the old value of a. Let\'s consider the following model:\r\n\r\n```sh\r\nt = a\r\na = b\r\nb = t\r\n```\r\n\r\n![alt text](https://images.rubyplus.com/sda-exchange2.png \"Exchange Digits\")\r\n\r\nLet\'s test this model in the irb session:\r\n\r\n```ruby\r\n > a = 1\r\n => 1 \r\n > b = 2\r\n => 2 \r\n > t = a\r\n => 1 \r\n > a = b\r\n => 2 \r\n > b = t\r\n => 1 \r\n > a\r\n => 2 \r\n > b\r\n => 1 \r\n```\r\n\r\nThe revised model works.\r\n\r\nAlgorithm Description\r\n-----------------------\r\n\r\n1. Save the original value of \'a\' in a temporary variable \'t\'.\r\n2. Assign to \'a\' the original value of \'b\'.\r\n3. Assign to \'b\' the original value of \'a\' that is stored in \'t\'.\r\n\r\nSteps\r\n======\r\n------\r\n\r\nStep 1\r\n------\r\n\r\n```ruby\r\nclass Exchange\r\n  attr_reader :a, :b\r\n  \r\n  def initialize(a, b)\r\n    @a = a\r\n    @b = b\r\n  end\r\n  \r\n  def perform\r\n    \r\n  end\r\nend\r\n\r\ndescribe Exchange do\r\n  it \'should swap the values of the given two variables\' do\r\n    e = Exchange.new(1, 2)\r\n    e.perform\r\n    \r\n    expect(e.a).to eq(2)\r\n  end\r\nend\r\n```\r\n\r\nThis test fails.\r\n\r\nStep 2\r\n-------\r\n\r\nImplementing our algorithm makes our test pass.\r\n\r\n```ruby\r\ndef perform\r\n  t = @a\r\n  @a = @b\r\n  @b = t\r\nend\r\n```\r\n\r\nDiscussion\r\n==========\r\n----------\r\n\r\nWe did not use **Fake It Till You Make It** in this case because the implementation was obvious, so we just typed in the correct implementation. **Fake It Till You Make It** and **Triangulation** are helpful when you the solution is not obvious and you need to take small steps to learn more about the problem. \r\n\r\nThis problem is small. For big problems, you want to decompose it into smaller problems and solve the smaller problems first and combine the solution to smaller problems to solve the big problem. This divide and conquer strategy becomes necessary when the problem is unfamiliar or complex. **Obvious Implementation** is also called as **Right Solution**.\r\n\r\nSummary\r\n==========\r\n----------\r\n\r\nIn this article you learned when it\'s ok to take big steps and not use Triangulation or Fake It Till You Make It. You can also see that the test code to the production code seems to be reasonable.','2014-08-11 18:24:49','2016-12-22 08:57:33'),(531,'How to Install and Configure Resque to Handle Background Jobs in Rails 4.1','How to Install and Configure Resque to Handle Background Jobs in Rails 4.1\r\n\r\nDiscussion\r\n==========\r\n----------\r\n\r\n**Why Resque instead of Sidekiq?**\r\n\r\nHosting on a Linode gives you 2 GB of RAM for just $20/month. There is no need to worry about memory footprint for now for my application needs. So there is no need to use Sidekiq because it requires you to use only threadsafe gems. I don\'t want to check if all the gems that is used in the background jobs is thread safe or not.\r\n\r\nSteps\r\n======\r\n------\r\n\r\nStep 1 \r\n------\r\n\r\nAdd \r\n\r\n```ruby\r\ngem \'resque\' \r\ngem \'resque-web\', require: \'resque_web\'\r\n```\r\n\r\nto the Gemfile and run bundle install.\r\n\r\nStep 2\r\n------\r\n\r\nCreate /lib/tasks/resque.rake with:\r\n\r\n```sh\r\nrequire \'resque/tasks\'\r\n\r\ntask \'resque:setup\' => :environment\r\n```\r\n\r\nThe require line will give you three rake tasks related to resque. The task line loads the Rails environment so that we can access ActiveRecord in the workers.\r\n\r\nYou can see the new tasks added by resque by doing:\r\n\r\n```ruby\r\n$rake -T resque\r\nrake resque:failures:sort  # Sort the \'failed\' queue for the redis_multi_queue failure backend\r\nrake resque:work           # Start a Resque worker\r\nrake resque:workers        # Start multiple Resque workers\r\n```\r\n\r\nIf you skip this step, you will get the error: \r\n\r\n```sh\r\nDon\'t know how to build task \'resque:work\' in rails 4.x.\r\n```\r\n\r\nStep 3\r\n------\r\n\r\nCreate app/jobs directory.\r\n\r\nStep 4\r\n------\r\n\r\nCreate a class sleeping_job.rb in app/jobs directory that will sleep as follows:\r\n\r\n```ruby\r\nclass SleepingJob\r\n  \r\n  def self.perform\r\n    puts \'I like to sleep\'\r\n    sleep 2\r\n  end\r\nend\r\n```\r\n\r\nStep 5 \r\n------\r\n\r\nTo get the job from any queue and do the work, run the following command. \r\n\r\n```sh\r\nrake resque:work QUEUE=\'*\'\r\n```\r\n\r\nThis command helps to test background jobs in development environment. For production:\r\n\r\n```sh\r\nrake production resque:work QUEUE=\'*\'\r\n```\r\n\r\nYou will get the error: LoadError: No such file to load -- application_controller, if you don\'t have the line:\r\n\r\n```ruby\r\ntask \'resque:setup\' => :environment\r\n```\r\n\r\nin lib/tasks/resque_tasks.rake.\r\n\r\nStep 6 \r\n------\r\n\r\nTo put the job in the queue:\r\n\r\n```ruby\r\nResque.enqueue(SleepingJob)\r\n```\r\n\r\nIf the perform method in the background job takes an id argument:\r\n\r\n```ruby\r\nResque.enqueue(SleepingJob, some_peristence_object_id)\r\n```\r\n\r\nStep 7 \r\n------\r\n\r\nLet\'s put some jobs in the queue:\r\n\r\n```ruby\r\n$rails c\r\nLoading development environment (Rails 4.1.4)\r\n> Resque.enqueue(SleepingJob)\r\nResque::NoQueueError: Jobs must be placed onto a queue\r\n```\r\n\r\nStep 8 \r\n------\r\n\r\nChange the test background job as follows:\r\n\r\n```ruby\r\nclass SleepingJob\r\n  def self.queue\r\n    :sloth\r\n  end\r\n  \r\n  def self.perform\r\n    puts \'I like to sleep\'\r\n    sleep 2\r\n  end\r\nend\r\n```\r\n\r\nThe class method queue specifies the name for this background job.\r\n\r\nStep 9\r\n------\r\n\r\nNow, let\'s test it in the rails console:\r\n\r\n```ruby\r\n$rails c\r\n > SleepingJob.queue\r\n => :sloth \r\n > Resque.enqueue(SleepingJob)\r\n => true \r\n```\r\n\r\nStep 10\r\n-------\r\n\r\nYou will see the output \'I like to sleep\' in the terminal where you are running the rake resque:work task.\r\n\r\n\r\nUsing Moonshine to Install and Manage Resque on Production Environment\r\n======================================================\r\n------------------------------------------------------\r\n\r\nStep 1\r\n------ \r\n\r\nInstall Moonshine Resque Plugin\r\n\r\n```ruby\r\n$plugger install git://github.com/railsmachine/moonshine_resque.git\r\n```\r\n\r\nStep 2 \r\n------\r\n\r\nGenerate Moonshine resque configuration files.\r\n\r\n```ruby\r\n $rails g moonshine_resque\r\n      plugin  moonshine_redis\r\nremote: Counting objects: 256, done.\r\nremote: Total 256 (delta 0), reused 0 (delta 0)\r\nReceiving objects: 100% (256/256), 39.49 KiB | 0 bytes/s, done.\r\nResolving deltas: 100% (92/92), done.\r\nFrom git://github.com/railsmachine/moonshine_redis\r\n * branch            HEAD       -> FETCH_HEAD\r\n      create  config/resque.yml\r\n     gemfile  resque\r\n     gemfile  redis\r\n    rakefile  resque_tasks.rake\r\n initializer  resque.rb\r\n```\r\nThe generated config/resque.yml file looks like this:\r\n\r\n```ruby\r\ndevelopment: localhost:6379\r\ntest: localhost:6379\r\ncucumber: localhost:6379\r\nstaging: localhost:6379\r\nproduction: localhost:6379\r\n```\r\n\r\nThe config/initializer/resque.rb looks like this:\r\n\r\n```ruby\r\nrequire \'resque\'\r\n\r\nrails_root = ENV[\'RAILS_ROOT\'] || File.dirname(__FILE__) + \'/../..\'\r\nrails_env = ENV[\'RAILS_ENV\'] || \'development\'\r\n\r\nresque_config = YAML.load_file(rails_root + \'/config/resque.yml\')\r\nResque.redis = resque_config[rails_env]\r\n```\r\n\r\nThe lib/tasks/resque_tasks.rake looks like this:\r\n\r\n```ruby\r\nrequire \'resque/tasks\'\r\n```\r\n\r\nThe following line is missing for Rails 4.1. We can manually add it to the generated rake task to get resque working.\r\n\r\n```ruby\r\ntask \'resque:setup\' => :environment\r\n```\r\n\r\nStep 3\r\n------\r\n\r\nAdd the resque and resque_web recipes to the application to app/manifests/application_manifest.rb, within the ApplicationManifest class as follows:\r\n\r\n```ruby\r\nrecipe :resque\r\nrecipe :resque_web \r\n```\r\n\r\nStep 4\r\n------\r\n\r\nConfigure the admin interface for resque_web by defining the password in moonshine.yml.\r\n\r\n```ruby\r\n:resque:\r\n  :web:\r\n    :username: resque     # default none\r\n    :password: sekrit     # default none\r\n    :port: 5678           # default 8282\r\n```\r\n\r\nStep 5\r\n------\r\n\r\nMount Sinatra Resque Admin app in routes.rb:\r\n\r\n```ruby\r\nmount ResqueWeb::Engine => \"/resque_web\"\r\n```\r\n\r\nStep 6\r\n------\r\n\r\nHTTP Basic Authentication is supported out of the box. Simply set the environment variables RESQUE_WEB_HTTP_BASIC_AUTH_USER and RESQUE_WEB_HTTP_BASIC_AUTH_PASSWORD to turn it on. You can add the following lines to the ~/.profile on the production server:\r\n\r\nYou can set the environment variable in a terminal like this:\r\n\r\n```ruby\r\n$export RESQUE_PASSWORD=\'resque-secret\'\r\n$irb\r\n > ENV[\'RESQUE_PASSWORD\']\r\n => \"resque-secret\" \r\n```\r\n\r\nNow, you access this in the irb session using ruby\'s ENV hash. If you open a new terminal this environment variable value will be lost.\r\n\r\nTo preserve the value across different sessions, you can add the export statement to ~/.profile file. Every terminal session will now have value defined for this environment variable.\r\n\r\n```sh\r\nexport RESQUE_WEB_HTTP_BASIC_AUTH_USER=\'user-name\'\r\nexport RESQUE_WEB_HTTP_BASIC_AUTH_PASSWORD=\'very-secret\'\r\n```\r\n\r\nRails environment will not be loaded in moonshine.yml runs so you cannot do this:\r\n\r\n```ruby\r\n:resque:\r\n  :web:\r\n    :username: resque     # default none\r\n    :password: <%= Rails.application.secrets.resque_web_admin_password %>     # default none\r\n    :port: 5678           # default 8282\r\n```\r\n\r\nin moonshine.yml. However you can read from the environment variable like this:\r\n\r\n```ruby\r\n:resque:\r\n  :web:\r\n    :username: resque     # default none\r\n    :password: <%= ENV[\"RESQUE_PASSWORD\"] %>     # default none\r\n    :port: 5678           # default 8282\r\n```\r\n\r\nStep 7\r\n------\r\n\r\nIf you are using Moonshine, you must specify the reque_web variables:\r\n\r\n```ruby\r\n:resque:\r\n  :web:\r\n    :username: <%= ENV[\"RESQUE_WEB_HTTP_BASIC_AUTH_USER\"] %>     # default none\r\n    :password: <%= ENV[\"RESQUE_WEB_HTTP_BASIC_AUTH_PASSWORD\"] %>     # default none\r\n    :port: 5678           # default 8282\r\n```\r\n\r\nYou can view the resque dashboard at the url: `http://www.example.com/resque_web`\r\n\r\nNOTE : If you are using Moonshine to manage your server, it does not automatically upload the secrets.yml whenever you make a change. You must either scp the latest secrets.yml to your shared/secrets.yml or ssh into your server and manually update the secrets.yml.\r\n\r\nReferences\r\n==========\r\n----------\r\n\r\n[Resque Retry](https://gist.github.com/PatrickTulskie/1104922 \"Resque Retry\")\r\n[Background Jobs with Resque ](http://tutorials.jumpstartlab.com/topics/performance/background_jobs.html \"Background Jobs with Resque\")\r\n[Resque](http://railscasts.com/episodes/271-resque?view=asciicast \"Resque\")','2014-08-12 04:31:44','2016-12-22 08:58:25'),(541,'Prime Factors Kata Analysis','Problem Domain Analysis\r\n=======================\r\n-----------------------\r\n\r\nEvery integer can be expressed as a product of prime numbers. The prime factors of an integer n can be expressed as:\r\n\r\n```sh\r\nn = f1 * f2 * f3 * .... fk\r\n```\r\n\r\nThe elements f1, f2, ... fk are all prime factors.\r\n\r\nExamples\r\n---------\r\n\r\n8  = 2 . 2 . 2\r\n12 = 2 . 2 . 3\r\n18 = 2 . 3 . 3\r\n20 = 2 . 2 . 5\r\n60 = 2 . 2 . 3 . 5\r\n\r\nSolution Domain Analysis\r\n=======================\r\n-----------------------\r\n\r\nStart with the divisor 2 and repeatedly reduce n by a factor of 2 until 2 is no longer an exact divisor. We then try 3 as a divisor and again repeat the reduction process and so on until n has been reduced to 1.\r\n\r\nConsider n = 60 :\r\n\r\nMarking with an * the unsuccessful attempts to divide, we have:\r\n\r\n```\r\n2   2   2   3   3   4   5\r\n60 30  15* 15   5*  5*  5  1\r\n```\r\n\r\n![alt text](https://images.rubyplus.com/sda-prime-factors.png \"Prime Factors\")\r\n\r\nObservations\r\n------------\r\n\r\n1. 2 is the only even number that we need to try. \r\n2. By definition only prime numbers should be considered as candidate divisors. \r\n3. Generation of a set of prime numbers is an integral part of our algorithm. From our previous discussion on primes, we know that all prime factors of n must be <= square root of n. This suggests a better strategy: Compute prime divisors as they are needed. For this purpose we can include a modified version of the Sieve of Eratosthenes. \r\n4. As soon as we have discovered n is prime we can terminate.\r\n\r\nPseudo Code\r\n-----------\r\n\r\n```\r\nwhile it has not been established that n is prime do\r\n  a) if current_prime is divisor of n, then save current_prime as a factor and reduce n by current_prime else get next value for the current_prime.\r\n  b) Try current_prime as a divisor of n\r\nend\r\n```\r\n\r\nWe now must work out how the \'not prime\' test for our outer loop should be implemented. The technique used earlier : to use integer division and test for 0 remainder can be used. We also know that as soon as the prime divisor we are using in our test becomes > square root of n, the process can terminate.\r\n\r\nInitially when the prime divisors we are using are much < square root of n, we know that the testing must continue. In carrying out this process, we want to avoid having to calculate square root of n repeatedly. Each time we make the division n div current_prime (eg., 60 div 2) we know the process must continue until the quotient q resulting from the division is < current_prime. At this point we will have:\r\n\r\n```\r\n(current_prime)squared > n \r\n```\r\n\r\nwhich will indicate that n is prime. The conditions for it not yet being established that n is prime are therefore:\r\n\r\n```\r\na) Exact division (ie., r = n modulo current_prime = 0)\r\nb) quotient > divisor (ie., q = n modulo current_prime > current_prime)\r\n```\r\n\r\nThe truth of either condition is sufficient to require that the test be repeated again. \r\n\r\nNow we need to explore how the algorithm will terminate. If we follow the factorization process through for a number of examples, we discover that there are two ways in which the algorithm can terminate. One way for termination is where n is eventually reduced to 1. This can happen when the largest prime factor is present more than once (eg., as in the case of 18 where the factors are 2 * 3 * 3). The other possible situation is where we terminate with a prime factor that only occurs once (eg., the factors of 70 are 2 * 5 * 7). In this instance we have a termination condition where n > 1. Therefore, after our loop terminates we must check which termination condition applies and adjust the prime factors accordingly. \r\n\r\nThe only other considerations are the initialization conditions and the dynamic generation of primes as required. Since we have already considered the prime number generation problem before, we will assume there is a function available which when given a particular prime as an argument returns the next prime.\r\n\r\nReference\r\n=========\r\n---------\r\n\r\nHow to Solve It by Computer (Prentice-Hall International Series in Computer Science) by R. G. Dromey.','2014-08-14 03:09:32','2016-12-22 09:00:29'),(551,'How to use Mailchimp API to subscribe users in Rails 4.1','Let\'s use the simple solution that is easy to setup and get it up and running quickly. The solution uses sucker_punch gem to subscribe user to mailing list in a background job. Read the article on [Sucker Punch](http://www.rubyplus.com/articles/571 \'Sucker Punch\') to learn how to set it up.\r\n\r\nSteps\r\n=====\r\n------\r\n\r\nStep 1 \r\n-------\r\n\r\nSignup for API key here : http://kb.mailchimp.com/article/where-can-i-find-my-api-key\r\n\r\nStep 2\r\n-------\r\n\r\nAdd gibbon gem to Gemfile.\r\n\r\n```ruby\r\ngem \'gibbon\', github: \"amro/gibbon\"\r\n```\r\n\r\nStep 3\r\n-------\r\n\r\nInstall the gem.\r\n\r\n```ruby\r\nbundle install\r\n```\r\n\r\nStep 4\r\n-------\r\n\r\nIn secrets.yml, set the Mailchimp API key. Here is a sample config file: \r\n\r\n```ruby\r\ndevelopment:\r\n  mailchimp_api_key: your-secret-api-key-goes-here \r\n\r\ntest:\r\n  mailchimp_api_key: your-secret-api-key-goes-here \r\n\r\nproduction:\r\n  mailchimp_api_key: your-secret-api-key-goes-here \r\n```\r\n\r\nStep 5\r\n-------\r\n\r\nCreate gibbon.rb in config/initializers/ directory with the following contents:\r\n\r\n```ruby\r\nGibbon::API.api_key = Rails.application.secrets.mailchimp_api_key\r\nGibbon::API.timeout = 15\r\n```\r\n \r\nRails.application.secrets.mailchimp_api_key reads the mailchimp API Key from secrets.yml file.\r\n\r\nStep 6\r\n-------\r\n\r\nMake sure secrets.yml is added to your .gitignore file. Here is a sample .gitignore file to use in the rails root directory:\r\n\r\n```ruby\r\n# Ignore bundler config.\r\n/.bundle\r\n\r\n# Ignore the default SQLite database.\r\n/db/*.sqlite3\r\n/db/*.sqlite3-journal\r\n\r\n# Ignore all config files\r\nconfig/amazon_s3.yml\r\nconfig/database.yml\r\nconfig/secrets.yml\r\n\r\n# Ignore all logfiles and tempfiles.\r\n/log/*.log\r\n/tmp\r\n/upload\r\n/coverage\r\n/log/.development.log.swp\r\n/public/uploads/tmp/*\r\n/public/assets/*\r\n```\r\n\r\nNow the secrets.yml will not get checked in to your project\'s git repository. You must either use capistrano or manually scp the secrets.yml to your server to shared/config directory of your Rails application. Another alternative is to use the environment variables to set the values for api credentials. \r\n\r\nStep 7\r\n-------\r\n \r\nCreate a background job in app/jobs folder called subscribe_job.rb:\r\n\r\n```ruby\r\nclass SubscribeJob\r\n  include SuckerPunch::Job\r\n\r\n  def perform(id)\r\n    ActiveRecord::Base.connection_pool.with_connection do\r\n      user = User.find(id)\r\n      mailchimp_list_id = Rails.application.secrets.mailchimp_list_id\r\n      email = email.email\r\n    \r\n      begin          \r\n        g = Gibbon::API.new\r\n        g.lists.subscribe({ id: mailchimp_list_id, email:  {email: email}})\r\n      \r\n        SubscribeMailer.confirmation_email(user).deliver\r\n      rescue Gibbon::MailChimpError => mce\r\n        SuckerPunch.logger.error(\"subscribe failed: due to #{mce.message}\")\r\n        raise mce\r\n      rescue Exception => e\r\n        SuckerPunch.logger.error(\"subscribe failed: due to #{e.message}\")\r\n        raise e\r\n      end      \r\n    end\r\n  end\r\n  \r\nend    \r\n```\r\n\r\nYou can also define the mailchimp_list_id as a constant in your User model.\r\n \r\nStep 8\r\n-------\r\n\r\nIn your controller, you can put the job in the background by:\r\n\r\n```ruby\r\nSubscribeJob.new.async.perform(user.id)\r\n```\r\n\r\nStep 9\r\n-------\r\n\r\nIf you are using Resque, you can run the failed job again as follows:\r\n\r\n```ruby\r\nResque::Failure.count.times do |i|\r\n  Resque::Failure.requeue(i)\r\nend\r\n```\r\n\r\nReferences\r\n==========\r\n------------\r\n\r\n[Mailchimp API 2.0](docshttp://apidocs.mailchimp.com/api/2.0/vip/add.php \"Mailchimp API 2.0\")','2014-08-15 02:42:31','2014-08-17 02:07:39'),(561,'Sending Emails using SendGrid API in Rails 4.1','Discussion\r\n======\r\n------\r\n\r\nThere are many Ruby gems available for sending emails using SendGrid API. I choose sendgrid-rails gem due to its simplicity. It was easy to setup and get it working on the production system.\r\n\r\nSteps\r\n======\r\n------\r\n\r\nStep 1\r\n------\r\n\r\nCreate a SendGrid account first at : http://sendgrid.com/\r\n\r\nStep 2\r\n------\r\n\r\nAdd the sendgrid-rails gem to the Gemfile:\r\n\r\n```ruby\r\ngem \'sendgrid-rails\', \'~> 2.0\'\r\n```\r\n\r\nrun \r\n\r\n```ruby\r\nbundle install\r\n```\r\n\r\nStep 3\r\n------\r\n\r\nUse secrets.yml to define the SendGrid API credentials:\r\n\r\n```ruby\r\nproduction:\r\n  sendgrid_username: your-sendgrid-username\r\n  sendgrid_password: your-sendgrid-password\r\n```\r\n  \r\nEmails are not sent in development and test environments. So you can define it only for production.\r\n\r\nStep 4\r\n------\r\n\r\nIn config/initializers/mail.rb:\r\n\r\n```ruby\r\nActionMailer::Base.register_interceptor(SendGrid::MailInterceptor)\r\n\r\nActionMailer::Base.smtp_settings = {\r\n  :address => \'smtp.sendgrid.net\',\r\n  :port => \'25\',\r\n  :domain => \'example.com\',\r\n  :authentication => :plain,\r\n  :user_name => Rails.application.secrets.sendgrid_username,\r\n  :password => Rails.application.secrets.sendgrid_password\r\n}\r\n```\r\n\r\nStep 5\r\n------\r\n\r\nIn config/initializers/mail.rb:\r\n\r\n```ruby\r\nSendGrid.configure do |config|\r\n  config.dummy_recipient = \'noreply@example.com\'\r\nend\r\n```\r\n\r\nI use my support email so that I can reply to any questions. You can use whatever email you wish for the dummy_recipient.\r\n\r\nStep 6\r\n------\r\n\r\nCreate mailer class using rails generator.\r\n\r\n```ruby\r\nclass WelcomeMailer < ActionMailer::Base\r\n  default :from => \'no-reply@example.com\',\r\n          :subject => \'An email sent via SendGrid with substitutions\'\r\n\r\n  def confirmation_email\r\n    category \'SendGridRocks\'\r\n    mail :to => \'email1@email.com\'\r\n  end\r\nend\r\n```\r\n\r\nHere category is used to tag the emails so that you can organize your email analytics. When you login to your SendGrid dashboard, it will be easier to analyze.\r\n\r\nStep 7\r\n--------\r\n\r\nSend email using ActionMailer as usual. It is better to send it in a background job.\r\n\r\n```ruby\r\nWelcomeMailer.confirmation_email(user).deliver\r\n```\r\n\r\nOf course, you need to create the email content in `app/views/welcome_mailer.html.erb` and `app/views/welcome_mailer.text.erb`.\r\n','2014-08-16 22:44:23','2015-12-19 04:17:09'),(571,'Using Sucker Punch gem for Background Job Processing in Rails 4.1','The sucker_punch gem is easy to setup and get it working on production quickly. It does not have any dependency on Redis or some other library that requires maintenance work on the production server. It uses Celluloid for processing the background jobs in the same process as the Rails process.\r\n\r\nSteps\r\n=====\r\n--------\r\n\r\nStep 1\r\n-------\r\n\r\nAdd the gem to the Gemfile:\r\n\r\n```ruby\r\ngem \'sucker_punch\', \'~> 1.0\'\r\n```\r\n\r\nStep 2\r\n-------\r\n\r\nFrom rails root directory:\r\n\r\n```ruby\r\n$bundle install\r\n```\r\n\r\nStep 3\r\n-------\r\n\r\nIn `app/jobs/my_background_job.rb`:\r\n\r\n```ruby\r\nclass MyBackgroundJob\r\n  include SuckerPunch::Job\r\n\r\n  def perform(user_id)\r\n    ActiveRecord::Base.connection_pool.with_connection do\r\n      user = User.find(user_id)\r\n      user.update_attributes(is_awesome: true)\r\n    end\r\n  end\r\nend\r\n```\r\n\r\nStep 4\r\n-------\r\n\r\nIn application.rb\r\n\r\n```ruby\r\nSuckerPunch.logger = Logger.new(\"#{Rails.root}/log/sucker_punch.log\")\r\n```\r\n\r\nDefine this line outside the module-end block.\r\n\r\nStep 5\r\n-------\r\n\r\nIn your controller, put the job in the background:\r\n\r\n```ruby\r\nMyBackgroundJob.new.async.perform(user.id)\r\n```\r\n\r\nStep 6\r\n-------\r\n\r\nYou can log messages in your jobs like this:\r\n\r\n```ruby\r\nSuckerPunch.logger.info \'log some message to sucker_punch.log here\'\r\n```\r\n\r\nSince it delegates the logging to Celluloid, it is duck-typed to the Rails logger and can respond to info, debug, warn, and error.','2014-08-16 23:43:50','2016-12-22 09:01:35'),(581,'TDD Basics : Reverse the Digits of an Integer','Objective\r\n===========\r\n-----------\r\n\r\nLearn the importance of designing test cases before writing tests.\r\n\r\nDiscussion\r\n===========\r\n-----------\r\n\r\nThis problem uses reduction process. It is a common interview question. So, this is a good problem to practice your TDD skills. Read the article on GCD if you want to refresh your memory on [reduction](https://rubyplus.com/articles/481-TDD-Beyond-Basics-Greatest-Common-Divisor \'reduction\')\r\n\r\nProblem Statement\r\n=================\r\n-----------------\r\n\r\nReverse the order of digits of a given positive integer.\r\n\r\nProblem Domain Analysis\r\n=================\r\n-----------------\r\n\r\n![alt text](https://images.rubyplus.com/pda-reverse.png \"Reverse Digits\")\r\n\r\nSolution Domain Analysis\r\n=================\r\n-----------------\r\n\r\nThe given number can be expressed as follows:\r\n\r\n![alt text](https://images.rubyplus.com/pda-reverse-equation.png \"Reverse Digits\")\r\n\r\nTo extract the rightmost digit, we can divide the given number by 10:\r\n\r\n![alt text](https://images.rubyplus.com/pda-reverse-mod.png \"Reverse Digits\")\r\n\r\nPlaying in the irb:\r\n\r\n```ruby\r\n$irb\r\n> 79815 / 10\r\n=> 7981 \r\n> 79815 / 10.0\r\n=> 7981.5 \r\n```\r\n \r\nWe can extract the digit programmatically by using the modulo operator like this:\r\n \r\n```ruby\r\n> 79815 % 10\r\n => 5 \r\n```\r\n\r\nAfter we extract the rightmost digit, we need to reduce the original number to a number without the rightmost digit so that we can extract the next digit. To accomplish that we already know that we can divide the original number by 10.\r\n\r\n![alt text](https://images.rubyplus.com/pda-reverse-table.png \"Reverse\")\r\n\r\nExtract         : 5\r\nTransform       : 5 x 10*0\r\nReversed Number : 5\r\n\r\nExtract         : 51\r\nTransform       : 5 x 10 + 1\r\nReversed Number : 51\r\n\r\nExtract         : 5\r\nTransform       : 51 x 10 + 8 \r\nReversed Number : 518\r\n\r\nFrom these examples, we can generalize the steps as follows:\r\n\r\nreversed number = (previous reverse value) x 10 + (recently extracted digit)\r\n\r\n![alt text](https://images.rubyplus.com/pda-reverse-iterate.png \"Reverse Digits\")\r\n\r\nAlgorithm Description\r\n=====================\r\n---------------------\r\n\r\n```\r\nwhile there are still digits in the number to be reversed do\r\n  1. Extract the rightmost digit from the number\r\n  2. Append this digit to right hand end of the reversed number\r\n  3. Remove the rightmost digit from number\r\nend\r\n```\r\n\r\n![alt text](https://images.rubyplus.com/pda-reverse-terminate.png \"Reverse\")\r\n\r\nTerminating condition is that the last number divided by 10 becomes 0.x so :\r\n\r\n```\r\nwhile n > 0\r\n\r\nend\r\n```\r\n\r\nSteps\r\n=====\r\n----------\r\n\r\nStep 1\r\n--------\r\n\r\n```ruby\r\nclass ReverseDigit\r\n  def initialize(n)\r\n    @n = n\r\n  end\r\n  \r\n  def reverse\r\n    @n\r\n  end\r\nend\r\n\r\ndescribe ReverseDigit do\r\n  it \'should return the same number for single digit number\' do\r\n    rd = ReverseDigit.new(1)\r\n    \r\n    result = rd.reverse\r\n    \r\n    expect(result).to eq(1)\r\n  end  \r\nend\r\n```\r\n\r\nThis test passes. \r\n\r\nStep 2\r\n--------\r\n\r\n```ruby\r\n  it \'should return the reversed number for a two digit number\' do\r\n    rd = ReverseDigit.new(15)\r\n    \r\n    result = rd.reverse\r\n    \r\n    expect(result).to eq(51)\r\n  end  \r\n```\r\n\r\nLet\'s play in the irb to see how we can tackle the two digit number case:\r\n\r\n```ruby\r\n  >   x = 15\r\n => 15 \r\n  > x / 10\r\n => 1 \r\n  > x\r\n => 15 \r\n  > x % 10\r\n => 5 \r\n  > 1 % 10\r\n => 1 \r\n  > 2 % 10\r\n => 2 \r\n  > 3 % 10\r\n => 3 \r\n  > 4 % 10\r\n => 4 \r\n  > 5 % 10\r\n => 5 \r\n  > 6 % 10\r\n => 6 \r\n  > 7 % 10\r\n => 7 \r\n  > 8 % 10\r\n => 8 \r\n  > 9 % 10\r\n => 9 \r\n  > 10 % 10\r\n => 0 \r\n  > 15 % 10\r\n => 5 \r\n```\r\n\r\nStep 3\r\n------\r\n\r\n```ruby\r\n  def reverse\r\n    if @n % 10 == @n\r\n      @n\r\n    else\r\n      d = @n % 10\r\n      result = 5\r\n      while (@n / 10) > 0\r\n        result = (result * 10) + (@n / 10)\r\n        @n = @n / 10\r\n      end\r\n    end\r\n    result\r\n  end\r\n```\r\n\r\nThis passes the second test but fails the first test.\r\n\r\nStep 4\r\n-------\r\n\r\nAfter referring our algorithm and playing the irb console, here is the solution that passes both tests:\r\n\r\n```ruby\r\n  def reverse\r\n    result = @n % 10\r\n      while (@n / 10) > 0\r\n        result = (result * 10) + (@n / 10)\r\n        @n = @n / 10\r\n      end\r\n    result\r\n  end\r\n```\r\n\r\nStep 5\r\n-------\r\n\r\nStory test fails:\r\n\r\n```ruby\r\n  it \'shourd return 51897 for 79815\' do\r\n    rd = ReverseDigit.new(79815)\r\n    \r\n    result = rd.reverse\r\n    \r\n    expect(result).to eq(51897)    \r\n  end\r\n```\r\n\r\nWhat went wrong with our implementation? We took big steps. \r\n\r\nStep 6\r\n-------\r\n\r\nI was in red for a long time. So, use that feedback. Let\'s step back and see if we can write some tests to extract the rightmost digit of any given number.\r\n\r\n```ruby\r\nclass ReverseDigit\r\n  def initialize(n)\r\n    @n = n\r\n  end\r\n  \r\n  def reverse\r\n    return @n if @n < 10\r\n  end\r\n  \r\n  def extract_rightmost_digit\r\n    @n % 10\r\n  end\r\nend\r\n\r\ndescribe ReverseDigit do\r\n  it \'should return the same number for single digit number\' do\r\n    rd = ReverseDigit.new(1)\r\n    \r\n    result = rd.reverse\r\n    \r\n    expect(result).to eq(1)\r\n  end  \r\n  \r\n  it \'should extract rightmost digit\' do\r\n    rd = ReverseDigit.new(1)  \r\n    \r\n    expect(rd.extract_rightmost_digit).to eq(1)\r\n  end\r\n\r\n  it \'should extract rightmost digit for two digit numbers\' do\r\n    rd = ReverseDigit.new(15)  \r\n    \r\n    expect(rd.extract_rightmost_digit).to eq(5)\r\n  end\r\n\r\n  it \'should extract rightmost digit for three digit numbers\' do\r\n    rd = ReverseDigit.new(158)  \r\n    \r\n    expect(rd.extract_rightmost_digit).to eq(8)\r\n  end\r\n  \r\n  it \'should return the reversed number for a two digit number\' do\r\n    rd = ReverseDigit.new(15)\r\n    \r\n    result = rd.reverse\r\n    \r\n    expect(result).to eq(51)\r\n  end  \r\n\r\n  xit \'shourd return 897 for 798\' do\r\n    rd = ReverseDigit.new(798)\r\n\r\n    result = rd.reverse\r\n\r\n    expect(result).to eq(897)\r\n  end\r\n\r\n  xit \'shourd return 51897 for 79815\' do\r\n    rd = ReverseDigit.new(79815)\r\n\r\n    result = rd.reverse\r\n\r\n    expect(result).to eq(51897)\r\n  end\r\nend\r\n```\r\n\r\nCan I extract rightmost digit for any given number? Yes. The two failing tests are marked as pending for now.\r\n\r\nStep 7\r\n------\r\n\r\nLet\'s experiment with the new implementation and see if we can make the pending test pass.\r\n\r\n```ruby\r\n  def reverse\r\n    return @n if @n < 10\r\n    \r\n    extracted_digit = extract_rightmost_digit\r\n    extracted_digit * 10 + extract_rightmost_digit\r\n    @n = @n / 10\r\n  end\r\n```\r\n\r\nTwo tests fail. The following implementation passes the two digit tests.\r\n\r\n```ruby\r\n  def reverse\r\n    return @n if @n < 10\r\n    while (@n / 10) > 0\r\n      extracted_digit = extract_rightmost_digit\r\n      @n = @n / 10\r\n      reversed_digit = extracted_digit * 10 + extract_rightmost_digit\r\n    end\r\n    reversed_digit\r\n  end\r\n```\r\n\r\nStep 8\r\n------\r\n\r\nRefactored in red and still the new test is red. This is not a good practice.\r\n\r\n```ruby\r\nclass ReverseDigit\r\n  def initialize(n)\r\n    @n = n\r\n  end\r\n  \r\n  def reverse\r\n    reversed_digit = @n\r\n    \r\n    while (@n / 10) > 0\r\n      extracted_digit = extract_rightmost_digit\r\n      @n = @n / 10\r\n      reversed_digit = extracted_digit * 10 + extract_rightmost_digit\r\n    end\r\n    reversed_digit\r\n  end\r\n  \r\n  def extract_rightmost_digit\r\n    @n % 10\r\n  end\r\nend\r\n```\r\n\r\nStep 9\r\n-------\r\n\r\nAfter muddling through different approaches and referring the solution domain analysis section, here is the final solution:\r\n\r\n```ruby\r\n  def reverse\r\n    reversed_digit = extract_rightmost_digit * 1\r\n    \r\n    while (@n / 10) > 0\r\n      extracted_digit = extract_rightmost_digit\r\n      @n = @n / 10\r\n      reversed_digit = reversed_digit * 10 + extract_rightmost_digit\r\n    end\r\n    reversed_digit\r\n  end\r\n  \r\n  def extract_rightmost_digit\r\n    @n % 10\r\n  end\r\n```\r\n\r\nThe story test also passes.\r\n\r\nStep 10\r\n-------\r\n\r\nHere is the final solution after refactoring.\r\n\r\n```ruby\r\nclass ReverseDigit\r\n  def initialize(n)\r\n    @n = n\r\n  end\r\n  \r\n  def reverse\r\n    reversed_digit = extract_rightmost_digit\r\n    \r\n    while digits_remain_to_be_reversed?\r\n      remove_rightmost_digit\r\n      reversed_digit = reversed_digit * 10 + extract_rightmost_digit\r\n    end\r\n    reversed_digit\r\n  end\r\n  \r\n  private\r\n    \r\n  def extract_rightmost_digit\r\n    @n % 10\r\n  end\r\n  \r\n  def remove_rightmost_digit\r\n    @n = @n / 10\r\n  end\r\n  \r\n  def digits_remain_to_be_reversed?\r\n    (@n / 10) > 0\r\n  end\r\nend\r\n\r\ndescribe ReverseDigit do\r\n  it \'should return the same number for single digit number\' do\r\n    rd = ReverseDigit.new(1)\r\n    \r\n    result = rd.reverse\r\n    \r\n    expect(result).to eq(1)\r\n  end  \r\n    \r\n  it \'should return the reversed number for a two digit number\' do\r\n    rd = ReverseDigit.new(15)\r\n    \r\n    result = rd.reverse\r\n    \r\n    expect(result).to eq(51)\r\n  end  \r\n\r\n  it \'shourd return 897 for 798\' do\r\n    rd = ReverseDigit.new(798)\r\n\r\n    result = rd.reverse\r\n\r\n    expect(result).to eq(897)\r\n  end\r\n\r\n  it \'should return 51897 for 79815\' do\r\n    rd = ReverseDigit.new(79815)\r\n\r\n    result = rd.reverse\r\n\r\n    expect(result).to eq(51897)\r\n  end\r\nend\r\n```\r\n\r\nStep 11\r\n---------\r\n\r\nHere is a solution that makes the loop idiomatic.\r\n\r\n```ruby\r\nclass ReverseDigit\r\n  def initialize(n)\r\n    @n = n\r\n  end\r\n  \r\n  def reverse\r\n    reversed_digit = extract_rightmost_digit\r\n    \r\n    until all_digits_reversed?\r\n      remove_rightmost_digit\r\n      reversed_digit = reversed_digit * 10 + extract_rightmost_digit\r\n    end\r\n    reversed_digit\r\n  end\r\n  \r\n  private\r\n    \r\n  def extract_rightmost_digit\r\n    @n % 10\r\n  end\r\n  \r\n  def remove_rightmost_digit\r\n    @n = @n / 10\r\n  end\r\n  \r\n  def all_digits_reversed?\r\n    (@n / 10) == 0\r\n  end\r\nend\r\n```\r\n\r\nExercises\r\n==========\r\n----------\r\n\r\n1. We skipped the designing test cases and got into problematic situations. Design sequence of test cases that gradually increases in complexity and minimizes ending up in dead-end situations.\r\n2. Write the tests first to develop the algorithm discussed above by following your list of test cases.','2014-08-19 00:22:12','2016-12-22 09:06:09'),(591,'SSH Kit Gem Basics','Background\r\n==========\r\n----------\r\n\r\nThe Problem\r\n------------------\r\nHow to make sure that the code is ready to be deployed to a server? Whatever tool you use, Capistrano, Moonshine, Chef, Puppet, we will end up with problems after deployment. I was looking to answer these questions:\r\n\r\n1) What is the configuration for a given software?\r\n2) Is it running?\r\n\r\nI need to connect using the correct credentials for the external services, database etc and also test the connectivity to make sure that the process is running. My application dependencies such as Mailchimp, Redis, Resque, Amazon S3, Stripe etc must be configured properly and the processes must be running on the correct port and URL.\r\n\r\nWhy should I as a developer care? This is the job of Devops guy. The reason is if we have a way to test the configuration and the connectivity then we can quickly fix issues in any environment (QA, Staging, Acceptance, Production). We can also isolate and tell whether the problem is due to the code or configuration / connectivity issue. We also avoid deploying code to the server that blows up due to configuration issues. \r\n\r\nIt\'s like the washing machine problem. You put the coins in, the detergent and you expect the machine to work. Sometimes it takes your money and the detergent but does not work. You can kick it, curse and scream. You become more frustrated when you find out you cannot get your clothes out since the door gets jammed.\r\n\r\n![alt text](https://images.rubyplus.com/washing-machine.jpg \"Washing Machine\")\r\n\r\nWhat if you had a switch that you could push to find out whether it\'s in good status or not? You will not waste your money or energy on an inoperative washing machine.\r\n\r\n![alt text](https://images.rubyplus.com/checklist.jpg \"Check List\")\r\n\r\nPilots use checklist before takeoff. Why can\'t software engineers use tools that automates the checklist review and gives us the confidence that the deployed application will work on the target environment even before we deploy it?\r\n\r\n![alt text](https://images.rubyplus.com/smoke-alarm.png \"Smoke Alarm\")\r\n\r\nSmoke Alarm with a Self-Test Button\r\n\r\nWhy not use Monit or God?\r\n------------------------------------\r\n\r\nThose are monitoring tools. We need something to check dependencies and to make sure the application will work when we deploy. Once the application is up and running we can use those monitoring tools. Most of the time these tools are used by system admins and Devops. Also note that if your application runs on only one server, Monit or any other tool on that server will go down if that machine goes down for some reason. It would be better to use those tools in combination with some other external monitoring services.\r\n\r\nWhy SSH Kit?\r\n-------------------\r\n\r\nYou can use any Capistrano version to deploy your code. Since I use Moonshine and it depends on Capistrano 2, I cannot take advantage of Capistrano 3 features. So, if I develop my own tools then I can avoid some hairy problems on production. My desire for a tool was fueled by [Docker](https://www.docker.com/ \'Docker\'). Developing our own tools to solve these problem allows us to make these tools available for certain people in QA and other departments. This removes the bottlenecks in the organization and speeds up the software release process. SSHKit was extracted from Capistrano and is a very good tool for interacting with remote servers.\r\n\r\nSo, let\'s learn SSHKit by examples. We will eventually have enough knowledge about SSHKit to solve our application installation problems.\r\n\r\nExample 1\r\n=========\r\n---------\r\n\r\nIn this example we will see how to run a command on a terminal on the local machine and display the output of the command. Create sk.rb with the following contents:\r\n\r\n```ruby\r\nrequire \'sshkit\'\r\nrequire \'sshkit/dsl\'\r\n\r\nrun_locally do\r\n  puts capture(:whoami)  \r\nend\r\n```\r\n\r\nRun this program.\r\n\r\n```ruby\r\n$ruby sk.rb\r\n```\r\n\r\nThe capture method runs the given command and captures the resulting output. This is printed on the screen. You need to include both the sshkit and sshkit/dsl in the require statements. The run_locally tells SSHKit to run the capture command on your local machine.\r\n\r\nExample 2\r\n========= \r\n---------\r\n\r\nIn this example we will see how to use the within() method to execute a command in a certain directory. Create ls.rb with:\r\n\r\n```ruby\r\nrun_locally do\r\n  within \'/tmp\' do\r\n    puts capture(:ls)\r\n  end\r\nend\r\n```\r\n\r\nIt lists the files in /tmp directory. This is equivalent to :\r\n\r\n```sh\r\n$cd /tmp\r\n$ls\r\n```\r\n\r\nExample 3\r\n=========\r\n--------\r\n\r\nStep 1\r\n------\r\n\r\nIn this example you will learn how to call a rake task from another rake task that uses sshkit dsl. Create lib/tasks/sshkit.rake in your Rails project.\r\n\r\n```ruby\r\ntask :hello do  \r\n  puts \"Hello world\"\r\nend\r\n```\r\n\r\nRun:\r\n\r\n```sh\r\n$rake hello\r\n```\r\n\r\nStep 2\r\n------\r\n\r\nAdd gem \'sshkit\' in Gemfile. Since Capistrano has sshkit dependency it is already installed if you are using Capistrano to deploy your application.\r\n\r\n```ruby\r\nrequire \'sshkit/dsl\'\r\n\r\ntask :hello do  \r\n  puts \"Hello world\"\r\nend\r\n\r\ntask :sshkit_hello do  \r\n  run_locally do\r\n    rake \"hello\"  \r\n  end\r\nend\r\n```\r\n\r\nRun the second rake task:\r\n\r\n```sh\r\n$rake sshkit_hello\r\nINFO[dead2d1d] Running /usr/bin/env rake hello on localhost\r\nINFO[dead2d1d] Finished in 2.688 seconds with exit status 0 (successful).\r\n```\r\n\r\nThis did not have to be a rake task because this example\'s functionality can be achieved by writing a script using SSHKit API.\r\n\r\nExample 4\r\n==========\r\n----------\r\n\r\nIn this example you will learn the execute() command. Add the echo rake task to your .rake file:\r\n\r\n```ruby\r\ntask :echo  do  \r\n  run_locally do\r\n    execute \"echo \'hi\'\"\r\n  end\r\nend\r\n```\r\n\r\n```sh\r\n$rake echo\r\nINFO[bba26bc5] Running /usr/bin/env echo \'hi\' on localhost\r\nINFO[bba26bc5] Finished in 0.005 seconds with exit status 0 (successful).\r\n```\r\nThis does not show the output of echo the \'hi\'. To display the output, configure SSHKit as follows:\r\n\r\n\r\n```ruby\r\nSSHKit.config.output_verbosity = :debug\r\n\r\ntask :echo  do  \r\n  run_locally do\r\n    execute \"echo \'hi\'\"\r\n  end\r\nend\r\n```\r\n\r\nNow you can see the output of the echo command.\r\n\r\n```sh\r\n$rake echo\r\nINFO[dc3b8278] Running /usr/bin/env echo \'hi\' on localhost\r\nDEBUG[dc3b8278] Command: echo \'hi\'\r\nDEBUG[dc3b8278] 	hi\r\nINFO[dc3b8278] Finished in 0.007 seconds with exit status 0 (successful).\r\n```\r\n\r\nIf you provide two arguments to the echo command, the first argument is command to run and the second argument becomes the argument to the command given in the first argument. Here is an example:\r\n\r\n```ruby\r\ntask :hi  do  \r\n  run_locally do\r\n    execute \"echo\", \'hi\'\r\n  end\r\nend\r\n```\r\n\r\n```sh\r\n$rake hi\r\nINFO[04a6d78d] Running /usr/bin/env echo hi on localhost\r\nDEBUG[04a6d78d] Command: /usr/bin/env echo hi\r\nDEBUG[04a6d78d] 	hi\r\nINFO[04a6d78d] Finished in 0.006 seconds with exit status 0 (successful).\r\n```\r\n\r\nSummary\r\n========\r\n--------\r\n\r\nIn this article we discussed the problems encountered during deployment of a web application and how we can address them before it happens on the target environment. We saw simple examples that shows how to use SSHKit gem. In the next article we will see more examples about how to use SSHKit to develop our own probes and self-test diagnostic tools.','2014-08-19 00:52:53','2016-12-22 09:08:42'),(601,'SSH Kit Gem Part 2','We will explore more examples on SSHKit usage. Finally we will apply our new skills to keep the secrets.yml file synchronized between the local and server.\r\n\r\nExample 1\r\n============\r\n------------\r\n\r\nIn this example, you will learn how to run commands on a remote server. Create remote-hello.rake in the lib/tasks folder.\r\n\r\n```ruby\r\nrequire \'sshkit/dsl\'\r\n\r\nSSHKit::Backend::Netssh.configure do |ssh|\r\n  ssh.ssh_options = {\r\n      user: \'rails\',\r\n      auth_methods: [\'publickey\']\r\n  }\r\nend\r\n\r\ndesc \'Who am I on the server\'\r\ntask :who do\r\n\r\n  on \'www.rubyplus.com\' do\r\n    as :root do\r\n      execute \'whoami\'\r\n    end\r\n  end\r\n\r\nend\r\n```\r\n\r\nI have copied my public key to my server so that I can securely connect to it without having to enter my password. You can see that I have specified auth_methods: [\'publickey\'] in the setup. The on() method takes the server name to run the command. The as() method takes the user as the argument. So the execute command will run the whoami as root. This is a trivial example, but it shows how to remotely execute commands on a given server.\r\n\r\n```sh\r\n$rake who\r\nDEBUG[853f1298] Finished in 1.634 seconds with exit status 0 (successful).\r\nINFO[a7d95d3d] Running /usr/bin/env whoami on www.rubyplus.com\r\nDEBUG[a7d95d3d] Command: sudo -u root -- sh -c \'/usr/bin/env whoami\'\r\nDEBUG[a7d95d3d] 	root\r\nINFO[a7d95d3d] Finished in 0.155 seconds with exit status 0 (successful).\r\n```\r\n\r\nThe output shows that I am \'root\' as the result of running the whoami command. You can accomplish the same thing by using capture command instead of execute command:\r\n\r\n```ruby\r\ntask :whoami do\r\n  on \'www.rubyplus.com\' do \r\n    as \'root\' do\r\n      puts capture(:whoami)\r\n    end\r\n  end\r\nend\r\n```\r\n\r\n```sh\r\n$rake whoami\r\nDEBUG[ef246db2] Finished in 1.427 seconds with exit status 0 (successful).\r\nDEBUG[46f56882] Running /usr/bin/env whoami on www.rubyplus.com\r\nDEBUG[46f56882] Command: sudo -u root -- sh -c \'/usr/bin/env whoami\'\r\nDEBUG[46f56882] 	root\r\nDEBUG[46f56882] Finished in 0.156 seconds with exit status 0 (successful).\r\nroot\r\n```\r\n\r\nExample 2\r\n==========\r\n---------------\r\n\r\nAdd the following task:\r\n\r\n```ruby\r\ntask :check_env do\r\n  on \'www.rubyplus.com\' do \r\n    puts capture(:env)\r\n  end  \r\nend\r\n```\r\n\r\nThis prints the env variables set on the server. \r\n\r\nExample 3\r\n========\r\n--------------\r\n\r\nHere is a task to check the log file:\r\n\r\n```ruby\r\ntask :check_log do\r\n  on \'www.rubyplus.com\' do\r\n    within \'/var/www/blog/shared/log\' do\r\n      puts capture(:head, \'-n5\', \'sucker_punch.log\')\r\n    end\r\n  end\r\nend\r\n```\r\n\r\n```sh\r\n$rake check_log\r\nDEBUG[a97e36b2] Running /usr/bin/env if test ! -d /var/www/blog/shared/log; then echo \"Directory does not exist \'/var/www/blog/shared/log\'\" 1>&2; false; fi on www.rubyplus.com\r\nDEBUG[a97e36b2] Command: if test ! -d /var/www/blog/shared/log; then echo \"Directory does not exist \'/var/www/blog/shared/log\'\" 1>&2; false; fi\r\nDEBUG[a97e36b2] Finished in 1.397 seconds with exit status 0 (successful).\r\nDEBUG[6ef963e1] Running /usr/bin/env head -n5 sucker_punch.log on www.rubyplus.com\r\nDEBUG[6ef963e1] Command: cd /var/www/blog/shared/log && /usr/bin/env head -n5 sucker_punch.log\r\nDEBUG[6ef963e1] 	# Logfile created on 2014-08-16 20:28:41 +0000 by logger.rb/44203\r\nDEBUG[6ef963e1] Finished in 0.147 seconds with exit status 0 (successful).\r\n# Logfile created on 2014-08-16 20:28:41 +0000 by logger.rb/44203\r\n```\r\n\r\nExample 4\r\n========\r\n--------------\r\n\r\nTo check how long the server has been up.\r\n\r\n```ruby\r\ntask :check_uptime do\r\n  on \'rubyplus.com\' do\r\n    execute :uptime\r\n  end\r\nend\r\n```\r\n\r\n```sh\r\n$rake check_uptime\r\nINFO[799d57f4] Running /usr/bin/env uptime on rubyplus.com\r\nDEBUG[799d57f4] Command: /usr/bin/env uptime\r\nDEBUG[799d57f4] 	 10:32:43 up 38 days,  9:45,  0 users,  load average: 0.00, 0.01, 0.05\r\nINFO[799d57f4] Finished in 1.560 seconds with exit status 0 (successful).\r\n```\r\n\r\nExample 5\r\n=========\r\n--------------\r\n\r\nHere is a task to print the working directory.\r\n\r\n```ruby\r\ntask :pwd do\r\n  on \'rubyplus.com\' do\r\n    execute :pwd\r\n  end  \r\nend\r\n```\r\n\r\n```sh\r\n$rake pwd\r\nINFO[a870efb4] Running /usr/bin/env pwd on rubyplus.com\r\nDEBUG[a870efb4] Command: /usr/bin/env pwd\r\nDEBUG[a870efb4] 	/home/rails\r\nINFO[a870efb4] Finished in 1.609 seconds with exit status 0 (successful).\r\n```\r\n\r\nExample 6\r\n=========\r\n---------\r\n\r\nHere is an example on how to execute command with flags.\r\n\r\n```ruby\r\ntask :unameit do\r\n  on \'rubyplus.com\' do\r\n    execute(\'uname -a\')\r\n  end\r\nend\r\n```\r\n\r\n```sh\r\n$rake unameit\r\nINFO[def8cdee] Running /usr/bin/env uname -a on rubyplus.com\r\nDEBUG[def8cdee] Command: uname -a\r\nDEBUG[def8cdee] 	Linux li552-13 3.15.4-x86_64-linode45 #1 SMP Mon Jul 7 08:42:36 EDT 2014 x86_64 x86_64 x86_64 GNU/Linux\r\nINFO[def8cdee] Finished in 1.506 seconds with exit status 0 (successful).\r\n```\r\n\r\nYou can accomplish the same thing using capture command. Let\'s run the \'uname -a\' command on the remote server using capture.\r\n\r\n```ruby\r\non \'rubyplus.com\' do\r\n  capture(:uname, \'-a\')\r\nend\r\n```\r\n\r\n```sh\r\n$ruby lib/tasks/apache.rb\r\n\r\nDEBUG[d116fd09] Running /usr/bin/env uname -a on rubyplus.com\r\nDEBUG[d116fd09] Command: /usr/bin/env uname -a\r\nDEBUG[d116fd09] 	Linux li552-13 3.15.4-x86_64-linode45 #1 SMP Mon Jul 7 08:42:36 EDT 2014 x86_64 x86_64 x86_64 GNU/Linux\r\nDEBUG[d116fd09] Finished in 1.592 seconds with exit status 0 (successful).\r\n```\r\n\r\nExample 7\r\n=========\r\n----------------\r\n\r\nHere is an example for using a flag and an argument in the execute() method.\r\n\r\n```ruby\r\nrequire \'sshkit\'\r\nrequire \'sshkit/dsl\'\r\n\r\nSSHKit::Backend::Netssh.configure do |ssh|\r\n  ssh.ssh_options = {\r\n      user: \'rails\',\r\n      auth_methods: [\'publickey\']\r\n  }\r\nend\r\n\r\nSSHKit.config.output_verbosity = :debug\r\n\r\non \'rubyplus.com\' do\r\n  execute :ls, \'-l\', \'/home/rails\'\r\nend  \r\n```\r\n\r\n```sh\r\n$ruby lib/tasks/apache.rb\r\n\r\nINFO[c43630e8] Running /usr/bin/env ls -l /home/rails on rubyplus.com\r\nDEBUG[c43630e8] Command: /usr/bin/env ls -l /home/rails\r\n\r\nDEBUG[c43630e8] 	total 4\r\nDEBUG[c43630e8] 	-rw-r--r-- 1 rails rails 401 Jul  9 05:02 my_key.pub\r\nINFO[c43630e8] Finished in 2.367 seconds with exit status 0 (successful).\r\n```\r\n\r\nThis is not a rake task, this is just a ruby script.\r\n\r\nExample 8\r\n=========\r\n----------\r\n\r\nLet\'s run echo command on the remote server.\r\n\r\n```ruby\r\non \'rubyplus.com\' do\r\n  capture(:echo, \'hello sshkit\')\r\nend\r\n```\r\n\r\n```sh\r\nruby lib/tasks/apache.rb\r\nDEBUG[b1e5c25d] Running /usr/bin/env echo hello sshkit on rubyplus.com\r\nDEBUG[b1e5c25d] Command: /usr/bin/env echo hello sshkit\r\nDEBUG[b1e5c25d] 	hello sshkit\r\nDEBUG[b1e5c25d] Finished in 1.538 seconds with exit status 0 (successful).\r\n```\r\n\r\nExample 9\r\n=========\r\n---------\r\n\r\nHere is an useful check to see if all the gem dependencies are satisfied on the remote server.\r\n\r\n```ruby\r\non \'rubyplus.com\' do\r\n  within(\'/var/www/blog/current\') do\r\n    capture(:bundle, \'check\')\r\n  end\r\nend\r\n```\r\n\r\n```sh\r\n$ruby lib/tasks/apache.rb\r\n\r\nDEBUG[e126b7e1] Running /usr/bin/env if test ! -d /var/www/blog/current; then echo \"Directory does not exist \'/var/www/blog/current\'\" 1>&2; false; fi on rubyplus.com\r\nDEBUG[e126b7e1] Command: if test ! -d /var/www/blog/current; then echo \"Directory does not exist \'/var/www/blog/current\'\" 1>&2; false; fi\r\n\r\nDEBUG[e126b7e1] Finished in 1.506 seconds with exit status 0 (successful).\r\nDEBUG[bb8eb516] Running /usr/bin/env bundle check on rubyplus.com\r\nDEBUG[bb8eb516] Command: cd /var/www/blog/current && /usr/bin/env bundle check\r\nDEBUG[bb8eb516] 	The Gemfile\'s dependencies are satisfied\r\nDEBUG[bb8eb516] Finished in 0.537 seconds with exit status 0 (successful).\r\n```\r\n\r\nKeeping Files in Synch\r\n=========\r\n---------\r\n\r\nLet\'s now see how to keep the secrets.yml in Synch. Add show_secrets rake task to your .rake file.\r\n\r\n```ruby\r\nSSHKit.config.output_verbosity = :debug\r\n\r\ntask :show_secrets  do  \r\n  run_locally do\r\n    execute \"cat ~/projects/blog/config/secrets.yml\"\r\n  end\r\nend\r\n```\r\n\r\nThis will show the contents of Rails blog project\'s secrets.yml file on your local machine.\r\n\r\n```ruby\r\ntask :remote_secrets do\r\n  on \'rubyplus.com\' do\r\n    within(\'/var/www/blog/shared\') do\r\n      capture(:cat, \'config/secrets.yml\')\r\n    end\r\n  end\r\nend\r\n```\r\n\r\nThis will display the contents of the secrets.yml file on the server. You can run `rake :show_secrets` and `rake :remote_secrets` from your local machine rails root directory. Let\'s keep the secrets.yml synchronized between the local and the server.\r\n\r\nIf it is not the same, then upload the local secrets to the remote /shared/config/secrets.yml by running `rake upload_secrets`.\r\n\r\n```ruby\r\ntask :upload_secrets do\r\n  on \'www.rubyplus.com\' do |host|\r\n    file = File.open(\"#{Rails.root}/config/secrets.yml\")\r\n    upload! file, \'/var/www/blog/shared/secrets.yml\'\r\n  end\r\nend\r\n```','2014-08-19 18:21:57','2016-12-22 09:11:37'),(611,'Availability Tests','Discussion\r\n==========\r\n----------\r\n\r\nIn this article we will discuss how to check the credentials and connectivity for SQL database, Sendgrid SMTP API and Mailchimp API.\r\n\r\n![alt text](https://images.rubyplus.com/scope-probe.png \"Probe\"). \r\n\r\nMailchimp Probe\r\n----------------\r\n\r\nMailchimp gem Helper class defines ping. This is perfect for our purpose. Reading the docs, we see:\r\n\r\n> \"Ping\" the MailChimp API - a simple method you can call that will return a constant value as long as everything is good. Note than unlike most all of our methods, we don\'t throw an Exception if we are having issues. You will simply receive a different string back that will explain our view on what is going on.\r\n\r\n```sh\r\n@return [Hash] a with a \"msg\" key {\"msg\"=>\"Everything\'s Chimpy!\"}\r\n- [String] msg containing \"Everything\'s Chimpy!\" if everything is chimpy, otherwise throws an exception :  Excon::Errors::SocketError: hostname \"api.mailchimp.com\" does not match the server certificate (OpenSSL::SSL::SSLError)\r\n```\r\n\r\nSendgrid Probe\r\n---------------\r\n\r\nCreate `send_grid_probe.rb` in lib folder of your Rails project.\r\n\r\n```ruby\r\nrequire \'net/smtp\'\r\n\r\nclass SendGridProbe\r\n  def self.test(domain, username, password)\r\n    # Replacing :login with :plain will also work\r\n    begin          \r\n      Net::SMTP.start(\'smtp.sendgrid.net\', 587, domain, username, password, :login)\r\n      \"SendGrid connectivity success\"\r\n    rescue Net::SMTPAuthenticationError => smtpe\r\n      \"Bad username / password\"\r\n    rescue Exception => e\r\n      \"#{e.message}\"\r\n    end\r\n  end  \r\nend\r\n```\r\n\r\nAccording to the Ruby docs: The Net::SMTP class supports three authentication schemes; PLAIN, LOGIN and CRAM MD5. (SMTP Authentication: [RFC2554]) To use SMTP authentication, pass extra arguments to ::start/SMTP#start. Here I have used :login authentication scheme.  \r\n\r\nMySQL Database Probe\r\n----------------------\r\n\r\nYou can read the database for the current environment by doing:\r\n\r\n```ruby\r\nActiveRecord::Base.connection.current_database\r\n```\r\n\r\nYou can test the database connectivity as follows:\r\n\r\n```ruby\r\nActiveRecord::Base.connection.active?\r\n```\r\n  \r\nComplete Code Listing\r\n=====================\r\n---------------------\r\n\r\nAvailabilityController\r\n----------------------\r\n\r\n```ruby\r\nclass AvailabilityController < ApplicationController  \r\n  http_basic_authenticate_with name: Rails.application.secrets.http_basic_user,\r\n                               password: Rails.application.secrets.http_basic_password\r\n  \r\n  def index\r\n    @secret_key_env = secret_key_env_check\r\n    @secret_key_base = secret_key_base_check\r\n    \r\n    @yaml_config_files_check, @yaml_config_file_errors = check_yaml_config_files\r\n    \r\n    @js_runtime = check_jsruntime\r\n    \r\n    @current_db = current_database\r\n    @db_connection = check_db\r\n    \r\n    @mailchimp = check_mailchimp\r\n    \r\n    @sucker_punch_version = SuckerPunch::VERSION\r\n    \r\n    @send_grid_status_message = check_sendgrid\r\n  end\r\n  \r\n  private \r\n  \r\n  def check_jsruntime\r\n    require \'v8\'\r\n    cxt = V8::Context.new\r\n    x = cxt.eval(\'7 * 6\')\r\n    x == 42\r\n  end\r\n  \r\n  def check_db\r\n    # ActiveRecord::Base.connected? will also work\r\n    begin\r\n      ActiveRecord::Base.connection.active?\r\n    rescue Exception => e\r\n      logger.error \"Exception db connection :  #{e.message} \"\r\n      false\r\n    end\r\n  end\r\n  \r\n  def current_database\r\n    begin\r\n      ActiveRecord::Base.connection.current_database\r\n    rescue Exception => e\r\n      e.message\r\n    end\r\n  end\r\n  \r\n  def check_mailchimp\r\n    require \'mailchimp\'\r\n    \r\n    begin\r\n      mc = Mailchimp::API.new(Gibbon::API.api_key)\r\n      res = mc.helper.ping\r\n      res\r\n    rescue Mailchimp::InvalidApiKeyError => e\r\n      \"The API key is invalid.\"\r\n    rescue Mailchimp::Error => mce      \r\n       mce.message\r\n    rescue Exception => e\r\n      e.message\r\n    end\r\n  end\r\n          \r\n  def check_sendgrid\r\n    require_relative \"#{Rails.root}/lib/send_grid_probe\"\r\n    \r\n    domain = \'rubyplus.com\'\r\n    username = Rails.application.secrets.sendgrid_username\r\n    password = Rails.application.secrets.sendgrid_password\r\n    \r\n    SendGridProbe.test(domain, username, password)\r\n  end\r\n\r\n  def secret_key_base_check    \r\n    Lafon::Application.config.secret_key_base.present?\r\n  end\r\n  \r\n  def secret_key_env_check\r\n    ENV[\'SECRET_KEY_BASE\'].present?\r\n  end\r\n  \r\n  def check_yaml_config_files\r\n    result = true\r\n    errors = []\r\n    require \'yaml\'\r\n    d = Dir[\"./**/*.yml\"]\r\n    d.each do |file|\r\n      begin\r\n        logger.info \"Checking : #{file}\"\r\n        f =  YAML.load_file(file)\r\n      rescue Exception\r\n        errors << \"Failed to read #{file}: #{$!}\"\r\n        result = false\r\n      end\r\n    end\r\n    [result, errors]\r\n  end\r\nend\r\n```\r\n\r\nI am using `require_relative \"#{Rails.root}/lib/send_grid_probe\"` because I have not added all the files in lib folder to the autoload path in application.rb.\r\n\r\nIt\'s a good idea to list versions of all libraries. Why? You can use it to compare versions in different environment. It helps to isolate the problem and answer the question: Is this problem related to code or software version differences? Here I am only checking the sucker_punch gem version. Here is the routes.rb.\r\n\r\n```ruby\r\nget \'/availability\' => \'availability#index\'\r\n```\r\n\r\nHere is the view in app/views/availability/index.html.erb\r\n\r\n```ruby\r\n<% if @js_runtime %>\r\n\r\nJavscript Runtime Check Success\r\n\r\n<% else %>\r\n\r\nJavscript Runtime Check Failed\r\n\r\n<% end %>\r\n\r\n<br/><br/>\r\n\r\nCurrent Database <%= @current_db %> Connectivity Status <%= @db_connection %>    \r\n\r\n<br/><br/>\r\n\r\nMailchimp <%= @mailchimp %>\r\n\r\n<br/><br/>\r\n\r\nSucker Punch Version : <%= @sucker_punch_version %>    \r\n\r\n<br/><br/>\r\n\r\n<%= @send_grid_status_message %>\r\n\r\n<br/><br/>\r\n\r\n<% if @secret_key_env %>\r\n  ENV[\'SECRET_KEY_BASE\'] is defined.\r\n<% else %>\r\n  ENV[\'SECRET_KEY_BASE\'] is NOT defined.\r\n<% end %>\r\n\r\n<br/><br/>\r\n\r\nSecret Key Base : <%= @secret_key_base %>\r\n\r\n<br/><br/>\r\n\r\nYaml config files syntax check : <%= @yaml_config_files_check %>\r\n\r\n<br/><br/>\r\n\r\nYaml config files syntax check errors : \r\n\r\n<% @yaml_config_file_errors.each do |error| %> \r\n  <%= error %> <br/><br/>\r\n<% end %>\r\n```\r\n\r\nGemfile\r\n---------\r\n\r\nThe Gemfile has the following gems that is used for availability checks only:\r\n\r\n```ruby\r\ngem \'mailchimp-api\'\r\ngem \'sshkit\'\r\n```\r\n\r\nSuckerPunch \r\n-------------\r\n\r\nSucker punch does not crash the application on deploy. So there is no need for doing a PING equivalent of background processing.\r\n\r\nSyntax Highlighter\r\n-------------------\r\n\r\nCheck is not required because the worst case scenario is that the code will not be syntax highlighted. It will not crash the application at runtime. \r\n\r\nConclusion\r\n==========\r\n----------\r\n\r\nIn this article we discussed how we can write tests to check the credentials and connectivity. These tests reduces deployment risk and makes the deployment a bit painless. Troubleshooting in different environments also becomes easier with these tools. You can write similar tests for other dependencies that are specific to your Rails application.\r\n\r\nExercise\r\n=========\r\n----------\r\n\r\nDevelop a gem that will allow developers to specify the application dependencies in a file, the gem will provide methods to check the connectivity, installation and version information.','2014-08-20 00:00:54','2016-12-22 09:23:23'),(621,'How to Install Alpha SSL certificate using Moonshine for Rails 4.1 ','Steps\r\n======\r\n-------\r\n\r\nStep 1\r\n-------\r\n\r\nWhen you generate the CSR request, do not provide pass phrase. If you provide the passphrase you can still install successfully by removing the password from the key:\r\n\r\n```sh\r\nopenssl rsa -in /path/to/originalkeywithpass.key -out /path/to/newkeywithnopass.key\r\n```\r\nUse the newkeywithnopass.key in moonshine.yml. This is explained below. \r\n\r\nStep 2\r\n-------\r\n\r\nWhen you purchase your SSL certificate from Alpha SSL, you will get the following certificates:\r\n\r\n1. GlobalSign Root CA Certificate\r\n2. AlphaSSL intermediate Certificate (intermediate_domain.crt)\r\n3. Your domain SSL Certificate (yourdomain.com.crt)\r\n\r\nCopy the intermediate certificate, your domain certificate and the key file to your server /home/rails/certs folder.\r\n\r\nStep 3\r\n---------\r\n\r\nSpecify the values in moonshine.yml:\r\n\r\n```ruby\r\n:ssl:\r\n  :certificate_file: /home/rails/certs/yourdomain.com.crt\r\n  :certificate_key_file: /home/rails/certs/yourdomain.key\r\n  :certificate_chain_file: /home/rails/certs/intermediate_domain.crt\r\n```\r\n\r\nStep 4\r\n------\r\n\r\nUncomment:\r\n\r\n```ruby\r\nconfig.force_ssl = true\r\n```\r\n\r\nin production.rb of your Rails application.\r\n\r\nStep 5\r\n--------\r\n\r\nCheck in your code and do a cap deploy. That\'s it.\r\n\r\nTip\r\n-------\r\nIf you have problems getting green bar for SSL connection on browsers due to some links not using https, you can find out which links are non https by using the online tool [whynopadlock.com](http://www.whynopadlock.com \'nopadlock\')','2014-08-24 03:42:47','2014-08-26 01:07:21'),(641,'TDD Beyond Basics : Character to Number Conversion','Objective\r\n=========\r\n---------\r\n\r\nLearn what happens when you don\'t have an algorithm to guide your implementation of the solution.\r\n\r\nProblem Statement\r\n=========\r\n---------\r\n\r\nConvert the character representation of an integer to it\'s decimal format.\r\n\r\nDiscussion\r\n=========\r\n---------\r\n\r\nComputers can store data in bits (zeroes and ones) which are numbers that can be converted to decimal, octal etc. They cannot store letters or other special symbols. ASCII character encoding allows computers to store letters, text, symbols and control characters.\r\n\r\nSolution Domain Analysis\r\n=========\r\n---------\r\n\r\nLet\'s convert 4 character sequence \'1984\' to the decimal number 1984.\r\n\r\n![alt text](https://images.rubyplus.com/character-number-conversion.png \"Character to Number\")\r\n\r\nHere is the ASCII table, you can see the decimal representation of the characters \'0\' to \'9\'.\r\n\r\n![alt text](https://images.rubyplus.com/ascii-table.png \"ASCII Table\")\r\n\r\nTo convert, 49 needs to be converted to 1000, 57 to 900, 56 to 80 and 52 to 4 units. To get the decimal digit we have to subtract 48 (ASCII value of character \'0\') from each of the decimal value for the character.\r\n\r\nTo convert the one-character string to it\'s decimal representation in ASCII we can use the ord method of String class in Ruby. Playing in the irb:\r\n\r\n```ruby\r\n  > \'0\'.ord\r\n => 48 \r\n  > \'1\'.ord\r\n => 49 \r\n  > \'9\'.ord\r\n => 57 \r\n  > \'8\'.ord\r\n => 56 \r\n  > \'4\'.ord\r\n => 52 \r\n```\r\n\r\nFirst number  = 49 - 48 = 1\r\nSecond number = 57 - 48 = 9\r\nThird number  = 56 - 48 = 8\r\nFourth number = 52 - 48 = 4\r\n\r\n![alt text](https://images.rubyplus.com/character-number-conversion2.png \"Character to Number\")\r\n\r\nThe shifting to the left mechanism can be obtained at each step by multiplying the previous decimal value by 10 and adding it to current decimal digit.\r\n\r\nTest Cases\r\n==========\r\n----------\r\n\r\n```ruby\r\nclass CharacterConverter\r\n  \r\nend\r\n\r\ndescribe CharacterConverter do\r\n  it \"should convert \'0\' to 0\" \r\n  it \"should convert \'1\' to 1\"\r\n  it \"should convert \'10\' to 10\"\r\n  it \"should convert \'100\' to 100\"\r\n  it \"should convert \'1000\' to 1000\"\r\nend\r\n```\r\n\r\nHere I have listed the tests in increasing level of difficulty. I have also chosen the data set that is lowest to test that the solution works.\r\n\r\nSteps\r\n======\r\n------\r\n\r\nStep 1\r\n------\r\n\r\n```ruby\r\nclass CharacterConverter\r\n  def initialize(n)\r\n    @n = n\r\n  end\r\n  \r\n  def to_i\r\n    @n.to_i\r\n  end\r\nend\r\n\r\ndescribe CharacterConverter do\r\n  it \"should convert \'0\' to 0\" do\r\n    cc = CharacterConverter.new(\'0\')\r\n    result = cc.to_i\r\n    expect(result).to eq(0)\r\n  end\r\n  \r\n  it \"should convert \'1\' to 1\"\r\n  it \"should convert \'10\' to 10\"\r\n  it \"should convert \'100\' to 100\"\r\n  it \"should convert \'1000\' to 1000\"\r\nend\r\n```\r\n\r\nSimplest implementation passes.\r\n\r\nStep 2\r\n-------\r\n\r\nLet\'s tackle the second test.\r\n\r\n```ruby\r\n  it \"should convert \'1\' to 1\" do \r\n    cc = CharacterConverter.new(\'1\')\r\n    result = cc.to_i\r\n    expect(result).to eq(1)    \r\n  end\r\n```\r\n\r\nThis passes without any change to the code.\r\n\r\nStep 3\r\n-------\r\n\r\nLet\'s add the story test:\r\n\r\n```ruby\r\n  it \"should convert \'1984\' to 1984\" do\r\n    cc = CharacterConverter.new(\'1984\')\r\n    result = cc.to_i\r\n    expect(result).to eq(1984)        \r\n  end\r\n```\r\n\r\nAlso passes. We don\'t want to use Ruby\'s `to_i` method which does the conversion. We want to develop our own implementation of `to_i`. \r\n\r\nStep 4\r\n------\r\n\r\nLet\'s not call the `to_i` on the String.\r\n\r\n```ruby\r\n  def to_i\r\n    \'0\'.ord - @n.ord\r\n  end\r\n```\r\n\r\nThis passes first test. \r\n\r\nStep 5\r\n------\r\n\r\nAdd the second test. \r\n\r\n```ruby \r\n  it \"should convert \'10\' to 10\" do\r\n    cc = CharacterConverter.new(\'10\')\r\n    result = cc.to_i\r\n    expect(result).to eq(10)    \r\n  end\r\n```\r\n\r\nIt fails. There is gap in our problem domain analysis. We have not thought about how many digits there are in a given string, so we don\'t know when to terminate. Reading the Ruby documentation, I found a method that solves that problem for us. Playing in the irb:\r\n\r\n```ruby\r\n > n = \'1984\'\r\n > n.bytes\r\n => [49, 57, 56, 52] \r\n```\r\n\r\nStep 6\r\n------- \r\n \r\n```ruby\r\nclass CharacterConverter\r\n  def initialize(n)\r\n    @n = n\r\n    @numbers = n.bytes\r\n  end\r\n  \r\n  def to_i\r\n    first_element = @numbers.shift\r\n    first_number = (first_element.ord - \'0\'.ord)\r\n\r\n    if @numbers.size > 0    \r\n      next_element = @numbers.shift\r\n      next_number = (next_element.ord - \'0\'.ord)\r\n      puts \'inside if\'\r\n      first_number * 10 + next_number\r\n    else\r\n      puts \'hi\'\r\n      first_number\r\n    end\r\n  end\r\nend\r\n\r\ndescribe CharacterConverter do\r\n  it \"should convert \'0\' to 0\" do\r\n    cc = CharacterConverter.new(\'0\')\r\n    result = cc.to_i\r\n    expect(result).to eq(0)\r\n  end\r\n  \r\n  it \"should convert \'1\' to 1\" do \r\n    cc = CharacterConverter.new(\'1\')\r\n    result = cc.to_i\r\n    expect(result).to eq(1)    \r\n  end\r\n\r\n  it \"should convert \'10\' to 10\" do\r\n    cc = CharacterConverter.new(\'10\')\r\n    result = cc.to_i\r\n    expect(result).to eq(10)    \r\n  end\r\n\r\n  xit \"should convert \'1984\' to 1984\" do\r\n    cc = CharacterConverter.new(\'1984\')\r\n    result = cc.to_i\r\n    expect(result).to eq(1984)        \r\n  end\r\n  \r\nend\r\n```\r\n\r\nThis implementation passes all three tests. I had to add puts statements to evolve the logic to get the tests passing. The puts statement is the simplest debugging tool. Why do we need debugger when we are using TDD? The test was forcing the code to evolve fast so I had to see what was happening. Adding assertion to check our code is another alternative. But the implementation details cannot be exposed to the test, so I used the print statements. This happened because that I did not have an algorithm as a guide for my code. I had to come up with the solution by trial and error.\r\n\r\nStep 7\r\n------\r\n\r\nAdd the story test:\r\n\r\n```ruby\r\n  it \"should convert \'1984\' to 1984\" do\r\n    cc = CharacterConverter.new(\'1984\')\r\n    result = cc.to_i\r\n    expect(result).to eq(1984)        \r\n  end\r\n```\r\n  \r\nIt fails.\r\n\r\nStep 8\r\n-------\r\n\r\nLet\'s take a step back. Make the failing test pending for now. Let\'s refactor to get the code ready to be generalized. After cleanup:\r\n\r\n```ruby\r\n  def to_i\r\n    first_element = @numbers.shift\r\n    first_number = (first_element.ord - \'0\'.ord)\r\n    result = first_number\r\n    \r\n    if @numbers.size > 0    \r\n      next_element = @numbers.shift\r\n      next_number = (next_element.ord - \'0\'.ord)\r\n      result = first_number * 10 + next_number\r\n    end\r\n    result\r\n  end\r\n```  \r\n\r\nStep 9\r\n------\r\n\r\nRun the story test now. It will fail. Change the implementation.\r\n\r\n```ruby\r\n  def to_i\r\n    first_element = @numbers.shift\r\n    first_number = (first_element.ord - \'0\'.ord)\r\n    \r\n    previous_number = first_number\r\n    while @numbers.size > 0    \r\n      next_element = @numbers.shift\r\n      next_number = (next_element.ord - \'0\'.ord)\r\n      previous_number = previous_number * 10 + next_number\r\n    end\r\n    previous_number\r\n  end\r\n```\r\n\r\nThe story test passes. This is a 1-2-3 punch, `BOOM` here is the solution example. In order to arrive at this solution, you must know how to apply reduction process, terminating condition and initial condition that we have discussed in previous articles.\r\n\r\nStep 10\r\n--------\r\n\r\nLet\'s cleanup.\r\n\r\n```ruby\r\n  def to_i\r\n    first_element = @numbers.shift\r\n    first_number = ascii_value(first_element)\r\n    \r\n    previous_number = first_number\r\n    while not_complete?   \r\n      next_element = @numbers.shift\r\n      next_number = ascii_value(next_element)\r\n      previous_number = previous_number * 10 + next_number\r\n    end\r\n    previous_number\r\n  end\r\n  \r\n  private\r\n  \r\n  def ascii_value(n)\r\n    n.ord - \'0\'.ord\r\n  end\r\n  \r\n  def not_complete?\r\n    @numbers.size > 0\r\n  end\r\n```  \r\n  \r\nIdiomatic loop:\r\n\r\n```ruby\r\n  def to_i\r\n    first_element = @numbers.shift\r\n    first_number = ascii_value(first_element)\r\n    \r\n    previous_number = first_number\r\n    until complete?   \r\n      next_element = @numbers.shift\r\n      next_number = ascii_value(next_element)\r\n      previous_number = previous_number * 10 + next_number\r\n    end\r\n    previous_number\r\n  end\r\n  \r\n  private\r\n  \r\n  def ascii_value(n)\r\n    n.ord - \'0\'.ord\r\n  end\r\n  \r\n  def complete?\r\n    !(@numbers.size > 0)\r\n  end\r\n```\r\n\r\nExercises\r\n========\r\n--------\r\n\r\n1) Write the tests:\r\n\r\n```\r\nit \"should convert \'100\' to 100\"\r\nit \"should convert \'1000\' to 1000\"\r\n```\r\n\r\nDoes it pass without making any modifications to the solution? Do you need these two tests?\r\n\r\n2) Solve the problem without using Ruby\'s builtin bytes method.\r\n\r\nReferences\r\n=========\r\n---------\r\n\r\n1. [Table of ASCII Characters](http://web.cs.mun.ca/~michael/c/ascii-table.html \'ASCII Table\')\r\n2. How to Solve it Using Computers by R. G. Dromey','2014-08-31 17:27:17','2016-12-22 09:25:20'),(651,'Simple Direct File Upload to Amazon S3 in Rails','Problem\r\n=======\r\n-------\r\n\r\nI watched the railscast episode on uploading to S3 that uses carrierwave, carrierwave_direct, fog and more gems. I was not satisfied with his solution. I wanted something simple that has the benefits of offloading the upload from the passenger process to Amazon S3. I also wanted a nice looking progress bar for upload process. In this article I discuss my simple direct File Upload to Amazon S3 using Javascript, jQuery, Amazon S3 CORS support, Simple Form with progress bar. Designed by me in Silicon Valley and developed by Denny: https://github.com/dennybritz or https://github.com/bparanj/s3-cors-upload-rails. \r\n\r\nIf you are looking for an elegant solution to this problem without unnecessary indirect dependencies forced by gems in Ryan Bate\'s solution, read on.\r\n\r\nSteps\r\n=====\r\n-----\r\n\r\nStep 1 - Configure S3 for CORS\r\n---------\r\n\r\n1. Create an Amazon S3 Bucket\r\n2. Click on Properties -> Permissions -> Edit CORS\r\n3. Enter a CORS configuration, such as the following. For security purposes you should restrict the origin further.\r\n\r\n```xml\r\n<?xml version=\"1.0\" encoding=\"UTF-8\"?>\r\n<CORSConfiguration xmlns=\"http://s3.amazonaws.com/doc/2006-03-01/\">\r\n    <CORSRule>\r\n        <AllowedOrigin>*</AllowedOrigin>\r\n        <AllowedMethod>PUT</AllowedMethod>\r\n        <MaxAgeSeconds>3000</MaxAgeSeconds>\r\n        <AllowedHeader>*</AllowedHeader>\r\n    </CORSRule>\r\n</CORSConfiguration>\r\n```\r\n\r\nStep 2 - Set your AWS Keys and bucket\r\n------------\r\n\r\nThe application can be configured via the following environment variables.\r\n\r\n- `AWS_ACCESS_KEY_ID`\r\n- `AWS_SECRET_ACCESS_KEY`\r\n- `AWS_S3_BUCKET`\r\n\r\nGeneral Flow\r\n-------------\r\n\r\nThis project uses client-side JavaScript and server-side Ruby. In general, the completed file-upload process follows these steps:\r\n\r\n1. A file is selected for upload by the user in their web browser.\r\n2. JavaScript is then responsible for making a request to your web application, which produces a temporary signature with which to sign the upload request.\r\n3. The temporary signed request is returned to the browser in JSON format.\r\n4. JavaScript then uploads the file directly to Amazon S3 using the signed request supplied by your Rails application.\r\n\r\nCode Overview\r\n---------------\r\n\r\nThe application flow is as follows:\r\n\r\n1. [Client] When the user chooses a file, a callback (defined in `app/assets/javascripts/products.js`) contacts the server to request a signed URL that can be used for uploading to S3.\r\n2. [Server] AWSController generates a signed URL according to [Amazon S3 Docs](http://docs.aws.amazon.com/AmazonS3/latest/dev/RESTAuthentication.html \"Amazon S3\") and returns it using a JSON hash.\r\n3. [Client] The `uploadToS3` function (defined in `app/assets/javascripts/cors.js`), takes the signed URL and the file, and PUTs the file onto S3.\r\n4. [Client] Once the upload is finished, the URL of the uploaded file is appended to the form as a hidden field.\r\n5. [Client] When the user submits the form, the file field is removed (to avoid uploading the file again). Name, price and the file URL are POSTed to the server.\r\n6. [Server] A new product record is created. \r\n\r\nThe most important files are are:\r\n\r\n- `app/helpers/aws_helper` - Builds the AWS authentication signature as described in [Amazon S3 Docs](http://docs.aws.amazon.com/AmazonS3/latest/dev/RESTAuthentication.html \"Amazon S3\") It required the Amazon keys, as well as options about the request (request type, resource, etc).\r\n- `app/controllers/aws_controller` - Given a filename and content type, returns a JSON of the form:\r\n   \r\n```JSON\r\n{\r\n  \"put_url\": \"The *signed* URL that must be used to make the request from the client side]\",\r\n  \"file_url\": \"The url the file will be uploaded to. A random number is appended to the file name to avoid name collisions.\"\r\n}\r\n```\r\n\r\n- `app/assets/javascripts/cors.js` - Performs the actual upload using an XMLHttpRequest. Required the signed URL, and the file to perform the request.\r\n- `app/assets/javascripts/products.js` - Handles UI callbacks, such as updating the progress bar. Also handles the file-upload callback. When the user chooses a file, the server is contacted to generate a signed URL, which is then passed to the CORS script described above to complete the upload.\r\n\r\nComplete Source Code\r\n====================\r\n--------------------\r\n\r\nThe source code is available from : [s3-cors-upload-rails](https://github.com/bparanj/s3-cors-upload-rails \'s3-cors-upload-rails\')','2014-09-05 04:37:11','2014-09-05 05:49:57'),(661,'Object Oriented Design Basics : Flexible Design','Software does not exist in a vacuum. It interacts with environment and the environment interacts with it. The environment is market forces, users, external systems, operating systems, competing software, changes in law etc. It evolves, either it improves or decays over time. The only thing that is constant is change demanded by the environment. \r\n\r\n>> The Law of Change: The longer your program exists, the more probable it is that any piece of it will have to change.\r\n>> Max Kanat-Alexander in Code Simplicity book\r\n\r\nYou need to work on a existing code base in order to :\r\n\r\n1. Improve Performance\r\n2. Improve the Design\r\n3. Fix Bugs\r\n4. Enhance existing features\r\n5. Upgrade to newer software it depends on\r\n6. Add features\r\n7. Remove features\r\n\r\nHow do we evaluate a design that will make the software easy to do all of the above? If we order from the most to least desirable ways to achieve quality, they are:\r\n\r\n1. Data driven or meta-programming\r\n2. Additive change\r\n3. Localized modification.\r\n\r\n Just because meta-programming is on the top of the list, I am not advocating that is the first choice for every design problem. As long as meta-programming is used to achieve a good design that obeys good design principles, it is ok.\r\n\r\nRemember the two golden rules from `Code Simplicity` book:\r\n\r\n- It is more important to reduce the effort of maintenance than it is to reduce the effort of implementation. \r\n- The effort of maintenance is proportional to the complexity of the system.\r\n\r\nLocalized Modification\r\n=============\r\n-----------\r\n\r\nAccording to the dictionary, localized means restrict something to a particular area. We change only one specific location in our existing code base to implement a new feature. The changed code must be deployed. Before you can run the example code, you need to install highline and clipboard gems.\r\n\r\n```ruby\r\n$gem install highline\r\n$gem install clipboard\r\n```\r\n\r\nHere is the localized modification version of the password recall script:\r\n\r\n```ruby\r\n#!/usr/local/bin/ruby\r\nrequire \'digest/sha1\'\r\nrequire \'highline/import\'\r\nrequire \'clipboard\'\r\n\r\n\r\ndef unlock_password(account, domain)\r\n  salt = ask(\"Enter your secret key : \") do |q|\r\n    q.echo = false\r\n    q.verify_match = true\r\n    q.gather = {\"Enter your secret key\" => \'\', \"\" => \'\'}\r\n  end\r\n  \r\n  password = Digest::SHA1.hexdigest(domain + account + salt)\r\n  Clipboard.copy(password)  \r\nend\r\n\r\nchoose do |menu|\r\n  domain = ask(\"Enter the website : \")\r\n  menu.prompt = \"Please make a selection : \"\r\n  \r\n  menu.choice :yahoo do \r\n    unlock_password(\'email\', domain)\r\n    say(\"Yahoo password copied.\") \r\n  end\r\n\r\n  menu.choice :google do \r\n    unlock_password(\'email\', domain)\r\n    say(\"Gmail password copied.\") \r\n  end\r\n\r\n  menu.choice :microsoft do \r\n    unlock_password(\'email\', domain)\r\n    say(\"Live password copied.\") \r\n  end\r\n    \r\nend\r\n```\r\n\r\nHere we modify just one file and we add a new site to menu.choice call.\r\n\r\nAdditive\r\n=============\r\n-----------\r\n\r\nWe add new code to the existing system without modifying the existing code to implement a new feature. Risk of introducing bugs to existing code is very low. New code must be deployed. This will use polymorphism so that the new object introduced will have the same interface that the existing code uses.\r\n\r\nHere is an example from Rails Antipatterns by Chad Pytel and Tammer Saleh book that I have improved the design by moving it from localized modification to additive change. \r\n\r\nBefore (Solution in the Book)\r\n-------\r\n\r\n```ruby\r\nclass OrderConverter\r\n  def initialize(order)\r\n    @order = order\r\n  end\r\n  \r\n  def to_xml\r\n  end\r\n  \r\n  def to_json\r\n  end\r\n  \r\n  def to_csv\r\n  end\r\n  \r\n  def to_pdf\r\n  end\r\nend\r\n\r\noc = OrderConverter.new(order)\r\noc.to_xml\r\n```\r\n\r\nThis solution needs localized changes to add a new conversion format for the order. \r\n\r\nAfter (My Improved Solution)\r\n-------\r\n\r\nHere is my solution that allows additive changes:\r\n\r\n```ruby\r\nclass Order\r\n  attr_reader :amount, :number\r\n  \r\n  def initialize(amount, number)\r\n    @amount = amount\r\n    @number = number\r\n  end\r\nend\r\n\r\nclass OrderXmlConverter\r\n  def initialize(order)\r\n    @order = order\r\n  end\r\n  def convert\r\n    \"<order><amount>#{@order.amount}</amount><number>#{@order.number}</number></order>\"\r\n  end\r\nend\r\n```\r\n\r\nInstead of hard-coding class name, you can use const_get to dynamically instantiate a class:\r\n\r\n```ruby\r\norder = Order.new(19, 2)\r\nformat = \'Xml\'\r\nclass_name = Object.const_get(\"Order#{format}Converter\")\r\nconverter = class_name.new(order)\r\nputs converter.convert\r\n```\r\n\r\nIn rails, you can use **constantize** method: \r\n\r\n```ruby\r\nclass_name = \"Order#{format}Converter\".constantize\r\n```\r\n\r\nBy following a convention in naming the converter class, we eliminate dependency on a specific class name. In order to add a new format, for instance json, we add a new class OrderJsonConverter which has the same interface **convert** that returns JSON representation. Uniform interface allows additive change. We end up with small classes that is focused on doing one thing really well, they all have the same interface, **convert** in our example.\r\n\r\nData Driven\r\n=============\r\n-----------\r\n\r\nNew data is added to make the system implement a new feature. This is the most flexible design. Probably this design will demand the highest effort of implementation. No code deployment necessary. The example below requires reading the value of the array items from an external configuration file.\r\n\r\n```ruby\r\n#!/usr/local/bin/ruby\r\n\r\nrequire \'digest/sha1\'\r\nrequire \'highline/import\'\r\nrequire \'clipboard\'\r\n\r\ndef unlock_password(account, domain)\r\n  salt = ask(\"Enter your secret key : \") do |q|\r\n    q.echo = false\r\n    q.verify_match = true\r\n    q.gather = {\"Enter your secret key\" => \'\', \"\" => \'\'}\r\n  end\r\n  \r\n  password = Digest::SHA1.hexdigest(domain + account.to_s + salt)\r\n  Clipboard.copy(password)  \r\nend\r\n\r\nchoose do |menu|\r\n  domain = ask(\"Enter the website : \")\r\n  menu.prompt = \"Please make a selection : \"\r\n\r\n  # This is hard-coded. You must read the values of the list from an external configuration file to make it data driven that does not require source code changes to add a new site.\r\n  items = [:yahoo, :google, :microsoft]\r\n  \r\n  items.each do |item|\r\n    menu.choice item do \r\n      unlock_password(item, domain)\r\n      say(\"#{item.to_s} password copied to clipboard.\") \r\n    end\r\n  end\r\n      \r\nend\r\n```\r\n\r\nDesign Techniques\r\n===========\r\n-----------\r\n\r\nWhat are the design techniques to achieve these three kinds of design?\r\n\r\n1. Localized changes are better than changes that ripple across your code base.\r\n2. Additive changes use polymorphism, meta-programming etc. It obeys Open Closed Principle if properly designed. New code is added with no modification to existing code.\r\n3. Data driven technique obeys Open Closed Principle. No change is made in existing code. No new code is added.\r\n\r\nSummary\r\n======\r\n-------\r\n\r\nIn this article we saw three different kinds of design that gives different levels of flexibility. Sometimes you have to make a trade off between complexity and flexibility. You can recognize these different types of flexibility in your code and make decisions based on your current requirements. \r\n\r\nReference\r\n=========\r\n---------\r\n\r\nRails Antipatterns by Chad Pytel and Tammer Saleh','2014-09-05 05:31:08','2015-10-25 06:24:21'),(671,'Spiking and TDD','Etymology\r\n==========\r\n----------\r\n\r\nThe term spike comes from Extreme Programming, where \"A spike solution is a very simple program to explore potential solutions.\" Ward Cunningham says: \"I would often ask Kent, \'What is the simplest thing we can program that will convince us we are on the right track?’ Such stepping outside the difficulties at hand often led us to simpler and more compelling solutions. Kent dubbed this a Spike. I found the practice particularly useful while maintaining large frameworks.\"\r\n\r\n>>    Sometimes I call this a \"spike,\" because we are driving a spike through the entire design. We are not searching for completeness. Instead, we want to illustrate the kinds of responsibilities accepted by all the major ojbects in the system.  Because people variously associate \"spike\" with volleyball, railroads, or dogs, I have begun using \"architectural prototype\" to describe this implementation.\r\n>>             ---- Guide to Better Smalltalk by Kent Beck\r\n\r\nWhen to Spike\r\n=============\r\n--------------\r\n \r\nWhen you come across problems that you don\'t know how to solve, using TDD can lead to a dead-end. You have to start over by deleting all the code. Create a spike, a single vertical slice of functionality that does not use TDD. This helps you to learn what is possible. The code is not production quality and will be thrown away. It provides enough information to build the functionality that is production quality.\r\n\r\nIt\'s called a spike because we\'re driving a spike through all layers of the application. We\'re building a very thin slice of functionality. It is an architectural prototype.\r\n\r\nTDD is a design activity, and if you don’t know how to design something, you need to have a better understanding of the problem and solution domain or you’ll end up in a horrible mess.\r\n\r\nSpikes in Sprint\r\n================\r\n----------------\r\n\r\nA story or task aimed at answering a question or gathering information, rather than at producing shippable product. Sometimes a user story is generated that cannot be estimated until the development team does some actual work to resolve a technical question or a design problem. The solution is to create a **spike**, which is a story whose purpose is to provide the answer or solution. Like any other story or task, the spike is then given an estimate and included in the sprint backlog.\r\n\r\nReferences\r\n===========\r\n-----------\r\n\r\n[Spike](http://agiledictionary.com/209/spike/  \'Spike\')\r\n[Spike to Learn, TDD to Build](http://joneaves.wordpress.com/2004/02/18/spike_to_learn_tdd_to_build/ \'Spike to Learn\')\r\nGuide to Better Smalltalk by Kent Beck\r\n','2014-09-07 17:30:58','2014-09-07 17:33:39'),(681,'Unix Tips','Discussion\r\n===========\r\n-----------\r\n\r\nThese tips are the result of online search to solve problems arising from working on real projects at work.\r\n\r\nCurl\r\n============\r\n------------\r\n\r\nDownload CSV File using Curl\r\n---------------\r\n\r\n```sh\r\ncurl -H \"Accept:text/csv\" http://localhost:3000/report_jobs/9\r\n```\r\n\r\nThis will invoke the format.csv block to download the csv file.\r\n\r\nUsing curl to Post xml Document\r\n---------------\r\n\r\n```sh\r\ncurl -X POST -d \'<run><log encoding=\"hexBinary\">4142430A</log><result>0</result><duration>2000</duration></run>\' http://www.example.com/rest/api \r\n```\r\n\r\nVi Editor Tips\r\n===============\r\n---------------\r\n\r\nGo to a given line in vi\r\n---------------\r\n\r\n```sh\r\n:15\r\n```\r\n\r\ngoes to line 15\r\n\r\nMove to the end of the file in vi\r\n---------------\r\n\r\n```sh\r\n$ then A\r\n```\r\n\r\nDelete in vi\r\n---------------\r\n\r\n```sh\r\nd$\r\n```\r\n\r\nThis deletes from the current position to the end of the line in vi editor\r\n\r\nMiscellaneous Tips\r\n===========\r\n-----------\r\n\r\nCheck how long a process has been running\r\n---------------\r\n\r\n```sh\r\n$ps -p 64622 -o etime=\r\n\r\nPID is 64622\r\n\r\n16-19:18:35\r\nDD-HH:MM:SS\r\n```\r\n\r\nHow to search for last occurrence of a string in a file\r\n---------------\r\n\r\n```sh\r\ngrep \'string to search\' log-file-name.log | tail -1\r\n```\r\n\r\nCount the Number of Occurrences of a Given String\r\n----------------\r\n\r\n```sh\r\ngrep -c \'string to search\' file-name.log \r\n```\r\n\r\nList Processes Running with the Ports on Mac OS\r\n---------------\r\n\r\n```sh\r\nlsof -i | grep LISTEN\r\n```\r\n\r\nFind Files\r\n---------------\r\n\r\n```sh\r\nfind . -name \'*.sql\' -print\r\n```\r\n\r\n','2014-09-13 01:19:39','2014-09-13 01:19:39'),(691,'Subversion Tips','Tree conflicts in SVN\r\n---------------\r\n\r\n```sh\r\nsvn resolve --accept working -R .\r\n```\r\n\r\nWhere . is the directory in conflict\r\n\r\n\r\nCompare \r\n---------------\r\n\r\nTo compare working copy with all of its local changes to the latest version of that tree in the repository\r\n\r\n```sh\r\nsvn diff -r HEAD\r\n```\r\n\r\nCreate a Branch\r\n---------------\r\n\r\n```sh\r\nsvn copy svn+ssh://host.example.com/repos/project/trunk \\\r\n           svn+ssh://host.example.com/repos/project/branches/NAME_OF_BRANCH \\\r\n      -m \"Creating a branch of project\"\r\n```\r\n\r\nLimit Log Output\r\n---------------\r\n\r\nHow to limit svn log output to a given number of entries. Use limit option:\r\n\r\n```sh\r\nsvn log -l 5\r\n```\r\n\r\nMoving a Repo from SVN to GIT\r\n---------------\r\n\r\nStep 1\r\n\r\nUse git-svn to clone the repository:\r\n\r\n```sh\r\ngit svn clone --stdlayout svn+ssh:/svn/srv/svn/zephoinc/<your repo>\r\n```\r\n\r\nThis will take a while.\r\n\r\nStep 2\r\n\r\nRun this script to create git tags from svn tags\r\n\r\n```sh\r\ncd <your repo>\r\n\r\ngit for-each-ref --format=\"%(refname:short) %(objectname)\" refs/remotes/tags |  cut -d / -f 2- |\r\nwhile read ref\r\ndo\r\n  echo git tag -a $ref -m \'import tag from svn\'\r\ndone\r\n```\r\n\r\nRemove the echo to make it actually do work. Run \r\n\r\n```sh\r\ngit tag \r\n```\r\n\r\nto verify that the tags were actually created.\r\n\r\nStep 3\r\n\r\nAdd a remote repo and push everything.\r\n\r\n```sh\r\ngit remote add origin git@github.com:zepho-inc/<your repo>.git\r\ngit push\r\ngit push --tags\r\n```\r\n','2014-09-13 01:24:56','2014-09-13 01:26:11'),(701,'Ruby Gem Tips','Discussion\r\n==========\r\n----------\r\n\r\nThe following tips are the result of searching for solutions for problems encountered during work. So these tips are tested solutions discussed in the online forum and blogs.\r\n\r\nRubyGems\r\n========\r\n---------\r\n\r\nHow to Downgrade Rubygems using rvm.\r\n-----------------\r\n\r\n```sh\r\n$ rvm rubygems 1.8.10\r\n```\r\n\r\nThis command will downgrade rubygems to 1.8.10. \r\n\r\nDowngrading System Wide Installed Rubygems\r\n-----------------\r\n\r\n```sh\r\ngem update --system x.y.z.gem \r\n```\r\n\r\nGems\r\n=====\r\n------\r\n\r\nInstall a Specific Version of Gems \r\n-----------------\r\n\r\nTo install a specific version of gems from a list of gems in a file:\r\n\r\n```sh\r\ncat gems.txt | while read x; do rvm use @@global && gem install $x -v=2.3.8 ; done\r\n```\r\n\r\nThis command installs the gems with version 2.3.8 in the global rvm gemset.\r\n\r\nHow to Install Local Gem\r\n-----------------\r\n\r\nStep 1\r\n \r\nDownload the .gem file.\r\n\r\nStep 2\r\n \r\n```sh\r\ngem unpack gem-name.gem .\r\n```\r\n\r\nwhere . is the current directory\r\n\r\nStep 3\r\n\r\nSpecify in Gemfile:\r\n\r\n```sh\r\n   gem \'name-of-gem\', \'0.1.0\', :path => \"/path/to/the/unpacked/gem/directory\"\r\n```\r\nStep 4\r\n\r\nbundle install\r\n\r\nUninstall a List of Gems \r\n-----------------\r\n\r\nTo install a list of gems from a given gems.txt file:\r\n\r\n```sh\r\ncat gems.txt | while read x; do rvm use @@global && gem uninstall $x -a; done\r\n```\r\n\r\nUninstall all Gems\r\n-----------------\r\n\r\n```sh\r\ngem install bundler -v 1.1.2\r\ngem list | cut -d\" \" -f1 | xargs gem uninstall -aIx\r\nrvm use @global && gem uninstall\r\n```\r\n\r\nTurn Off ssl-verify When Accessing Private Gem Repo\r\n-----------------\r\n\r\nCreate a file .gemrc in your login directory. Its contents should be:\r\n\r\n```sh\r\n:ssl_verify_mode: 0\r\n```\r\n\r\nSuppressing Deprecation Warnings:\r\n-----------------\r\n\r\nAdd\r\n\r\n```sh\r\nGem::Deprecate.skip = true\r\n```\r\n\r\nto preinitializer.rb in a Rails project.','2014-09-13 01:29:35','2014-09-13 01:29:35'),(711,'Git Command Quick Reference','Discussion\r\n==========\r\n----------\r\n\r\nThe commands in this article is the result of searching online for solution to common tasks during a project.\r\n\r\nList all Tags\r\n---------------\r\n\r\n```sh\r\ngit tag -l\r\n```\r\n\r\nCheckout a Specific Tag\r\n---------------\r\n\r\n```sh\r\ngit checkout tag-name\r\n```\r\n\r\nColor the Git Output\r\n---------------\r\n\r\n```sh\r\ngit config --global color.ui true\r\n```\r\n\r\nCreate a Branch and Push\r\n---------------\r\n\r\n```sh\r\ngit co branch-name\r\ngit push -u https://github.com/repo-name.git branch-name\r\n```\r\n\r\nCreate a Tag from a Branch\r\n---------------\r\n\r\n```sh\r\ngit tag -a tag-name -m \'commit message\'\r\n```\r\n\r\nHow to Push Tag\r\n---------------\r\n\r\n```sh\r\ngit push --tags\r\n```','2014-09-13 01:31:19','2014-09-13 01:31:19'),(721,'How to install Nokogiri on Lion','STEPS\r\n=================\r\n-----------------\r\n\r\nStep 1\r\n-----------------\r\n\r\n```sh\r\nbrew install libxml2 libxslt\r\nbrew link libxml2 libxslt\r\n\r\nbrew link -f libxml2\r\n```\r\n\r\nLink with force flag if needed.\r\n\r\nStep 2 \r\n----------------\r\n\r\nInstall libiconv :\r\n\r\n```sh\r\nwget http://ftp.gnu.org/pub/gnu/libiconv/libiconv-1.13.1.tar.gz\r\ntar xvfz libiconv-1.13.1.tar.gz\r\ncd libiconv-1.13.1\r\n./configure --prefix=/usr/local/Cellar/libiconv/1.13.1\r\nmake\r\nsudo make install\r\n```\r\n\r\nStep 3\r\n-----------------\r\n\r\nInstall libxslt from source\r\n\r\n```sh\r\nwget ftp://xmlsoft.org/libxml2/libxslt-1.1.26.tar.gz\r\ntar -zxvf libxslt-1.1.26.tar.gz\r\ncd libxslt-1.1.26\r\n./configure --prefix=/usr/local/Cellar/libxslt/1.1.26 --with-libxml-prefix=/usr/local/Cellar/libxml2/2.8.0\r\nmake\r\nsudo make install\r\n```\r\n\r\nStep 4\r\n-----------------\r\n\r\nInstall Nokogiri\r\n\r\n```sh\r\ngem install nokogiri -- --with-xml2-include=/usr/local/Cellar/libxml2/2.8.0/include/libxml2 \r\n                        --with-xml2-lib=/usr/local/Cellar/libxml2/2.8.0/lib \r\n                        --with-xslt-dir=/usr/local/Cellar/libxslt/1.1.26 \r\n                        --with-iconv-include=/usr/local/Cellar/libiconv/1.13.1/include \r\n                        --with-iconv-lib=/usr/local/Cellar/libiconv/1.13.1/lib\r\n```\r\n\r\nMake sure that you have the versions of libxml2 as you have them in /usr/local/Cellar/libxml (in my case it was 2.8.0).\r\n\r\nReferences\r\n==========\r\n----------\r\n\r\nhttp://nokogiri.org/tutorials/installing_nokogiri.html\r\nhttps://github.com/schacon/git-scribe/issues/20','2014-09-13 01:32:32','2014-09-13 01:32:32'),(731,'Installing Ruby 1.9.3 using RVM in Lion','Notes\r\n======\r\n------\r\n\r\n1. To install readline without using any package managers. Follow this [link](https://rvm.io/packages/readline \'link\')\r\n2. XCode must be installed after the GCC and Command line tools are installed.\r\n\r\n-----------------\r\n\r\nSTEP 1\r\n\r\nUninstall XCode. Drag the Xcode from applications folder to the trash.\r\n\r\nSTEP 2\r\n\r\nInstall GCC 10.7-v2 dmg\r\n\r\nSTEP 3\r\n\r\nInstall command line tools for Lion. Command Line Tools (Lion).mpkg\r\n\r\nSTEP 4\r\n\r\n```sh\r\nbrew install automake\r\n```\r\n\r\nSTEP 5\r\n\r\n```sh\r\nbrew install readline\r\n```\r\n\r\nSTEP 6\r\n\r\n```sh\r\nbrew link readline\r\n```\r\n\r\nSTEP 7\r\n\r\n```sh\r\nbrew install libxml2\r\n```\r\n\r\nSTEP 8\r\n\r\n```sh\r\nbrew link libxml2\r\n```\r\n\r\nSTEP 9\r\n\r\nAdd :\r\n\r\n```sh\r\nexport ARCHFLAGS=\"-arch x86_64\" \r\n```\r\n\r\nto ~/.bash_profile\r\n\r\nSTEP 10\r\n\r\n```sh\r\nrvm install 1.9.2 -C --with-readline-dir=/usr/local/Cellar/readline/6.2.4/ --with-libxml2-dir=/usr/local/Cellar/libxml2/2.8.0\r\n```\r\n\r\nReferences:\r\n----------\r\n\r\n[How to Install XCode, Homebrew, Git, rvm, Ruby on Mac](http://www.moncefbelyamani.com/how-to-install-xcode-homebrew-git-rvm-ruby-on-mac/ \'XCode, Ruby\')\r\n[OSX GCC Installer](https://github.com/kennethreitz/osx-gcc-installer/downloads \'OS X GCC Installer\')','2014-09-13 01:37:35','2014-09-13 01:37:35'),(741,'Memcache and Redis Installation','Memcache\r\n==========\r\n-----------------\r\n\r\nInstallation:\r\n\r\n```sh\r\nbrew install memcached\r\n```\r\n\r\nIf you get error message during linking: \r\n\r\n```sh\r\nbrew link -f memcached \r\n```\r\n\r\nTo Start Memcache\r\n-----------------\r\n\r\n```sh\r\nmemcached -vv\r\n```\r\n\r\nRedis\r\n==========\r\n-----------------\r\n\r\nInstallation :\r\n\r\n```sh\r\nwget http://redis.googlecode.com/files/redis-2.6.9.tar.gz\r\ntar xvzf redis-2.6.9.tar.gz\r\ncd redis-2.6.9\r\nmake\r\nsudo mv src/redis-server /usr/bin\r\nsudo mv src/redis-cli /usr/bin\r\nmkdir ~/.redis\r\ntouch ~/.redis/redis.conf\r\n```\r\n\r\nStarting Redis Server\r\n-----------------\r\n\r\n```sh\r\n$cd /Users/zepho/temp/redis-2.6.9\r\n$redis-server\r\n```\r\n\r\nInteract with Redis:\r\n-----------------\r\n\r\n```sh\r\nredis-cli\r\nredis> set foo bar\r\nOK\r\nredis> get foo\r\n\"bar\"\r\n```\r\n\r\nReference\r\n=========\r\n-----------------\r\n\r\n[Installing Redis on Mac OS] (http://jasdeep.ca/2012/05/installing-redis-on-mac-os/ \'Install Redis\')','2014-09-13 01:42:45','2014-09-13 01:44:01'),(751,'RabbitMQ on Mac OS X','STEPS\r\n=====\r\n--------\r\n\r\nStep 1 \r\n--------\r\n\r\nDownload the latest [Mac OS X package](https://www.erlang-solutions.com/downloads/download-erlang-otp \'OS X package\') and install Erlang.\r\n\r\nStep 2\r\n--------\r\n\r\nDownload RabbitMQ from : https://www.rabbitmq.com/releases/rabbitmq-server/v2.8.7/rabbitmq-server-generic-unix-2.8.7.tar.gz\r\n\r\nStep 3\r\n--------\r\n\r\nUnpackage it with : \r\n\r\n```sh\r\ntar -xzvf rabbitmq-server-generic-unix-2.8.7.tar.gz\r\n```\r\n\r\nStep 4\r\n--------\r\n\r\n```sh\r\nrabbitmq_server-2.8.7/sbin/rabbitmq-plugins enable rabbitmq_management\r\n```\r\n\r\nStep 5\r\n--------\r\n\r\nStart the Server : \r\n\r\n```sh\r\n$ rabbitmq_server-2.8.7/sbin/rabbitmq-server -detached\r\n```\r\n\r\nStep 6\r\n--------\r\n\r\nStop the Server: \r\n\r\n```sh\r\n$ rabbitmq_server-2.8.7/sbin/rabbitmqctl stop\r\n```\r\n\r\nStep 7\r\n--------\r\n\r\nTo access management console. Go to http://localhost:55672/mgmt/. User name and password is guest, guest.\r\n\r\nOptional\r\n----------\r\n\r\nSetup alias in your ~/.bash_profile to stop and start the server:\r\n\r\n```sh\r\nalias mq=\'/Users/zepho/Downloads/rabbitmq_server-2.8.7/sbin/rabbitmq-server -detached\'\r\nalias mqd=\'/Users/zepho/Downloads/rabbitmq_server-2.8.7/sbin/rabbitmqctl stop\'\r\n```\r\n\r\n','2014-09-13 01:45:21','2014-09-13 01:46:45'),(761,'RSpec Tips','Discussion\r\n==========\r\n----------\r\n\r\nThe following tips are the result of searching for solutions for problems encountered during work. So these tips are tested solutions discussed in the online forum and blogs.\r\n\r\nHow to post XML data in controller spec\r\n=============\r\n--------------\r\n\r\n```sh\r\nXML=<<-xml_string\r\n<payment>\r\n  <transaction-time>2012-05-16T21:02:08Z</transaction-time>\r\n  <payment-amount>20000</payment-amount>\r\n</payment>\r\nxml_string\r\n```\r\n\r\n```ruby\r\nrequest.env[\'content_type\'] = \'application/xml\' \r\nrequest.env[\'RAW_POST_DATA\'] =  some_long_xml_string \r\npost :create\r\n```\r\n\r\nUse VCR Webmock with RSpec\r\n=============\r\n------------------\r\n\r\nStep 1\r\n-------\r\n\r\nAdd the gems to the Gemfile under test group:\r\n\r\n```ruby\r\ngem \"webmock\"\r\ngem \"vcr\"\r\n```\r\n\r\nStep 2\r\n-------\r\n\r\n```sh\r\nbundle\r\n```\r\n\r\nStep 3\r\n-------\r\n\r\n```ruby\r\nrequire \'vcr\' \r\n```\r\n\r\nas the first line in spec_helper.rb\r\n\r\nStep 4\r\n-------\r\n\r\nAdd\r\n\r\n```ruby\r\nVCR.configure do |c|\r\n  c.cassette_library_dir = \'spec/fixtures/cassettes\'\r\n  c.hook_into :webmock\r\n  c.ignore_localhost = false\r\n  c.allow_http_connections_when_no_cassette = true\r\nend\r\n```\r\n\r\ninside the configure block.\r\n\r\n','2014-09-13 01:53:18','2014-09-13 01:53:18'),(771,'Rails Tips','Discussion\r\n==========\r\n----------\r\n\r\nThe following tips are the result of searching for solutions for problems encountered during work. So these tips are tested solutions discussed in the online forum and blogs. \r\n\r\nArray in MySQL Database\r\n=====\r\n-----\r\n\r\nSteps\r\n=====\r\n-----\r\n\r\nHere are the steps to Store Array in MySQL database in a Rails project.\r\n\r\nStep 1\r\n-----------\r\n\r\nThe column type should be text\r\n\r\nStep 2\r\n-----------\r\n\r\nSerialize the column. In the active record class : \r\n\r\n```ruby\r\nserialize :your_field\r\n```\r\n\r\nStep 3\r\n-----------\r\n\r\n```ruby\r\nBook.new(:your_field => [1,2])\r\n```\r\n\r\nHow to load nested models in Rails 3.2\r\n==========\r\n-----------\r\n\r\n```ruby\r\nconfig.autoload_paths += Dir[Rails.root.join(\'app\', \'models\', \'{**}\')]\r\n```\r\n\r\nHow to setup Authlogic 3.1.3, Rails 3.2, Rspec 2.11\r\n==========\r\n-----------\r\n\r\nAdd the following two lines to spec_helper.rb\r\n\r\n```ruby\r\nrequire \"authlogic/test_case\"\r\ninclude Authlogic::TestCase\r\n```\r\n\r\nin the controller spec add : before { activate_authlogic }\r\n\r\nPry\r\n=========\r\n---------\r\n\r\nStep 1 \r\n---------\r\n\r\nAdd \r\n\r\n```ruby\r\ngem \'pry\' \r\n```\r\n  \r\nto Gemfile in the development group\r\n\r\nStep 2\r\n---------\r\n\r\n```ruby\r\nbundle\r\n```\r\n\r\nStep 3\r\n---------\r\n\r\nIn the source : \r\n\r\n```ruby\r\nbinding.pry \r\n```\r\n\r\nto halt execution. Type \'exit\' to pop from the binding. The pry-nav gem provides step, next, and continue to create a simple debugger.\r\n\r\nTurn off generating css.sass and js.coffee files\r\n==========\r\n-----------\r\n\r\n```ruby\r\nconfig.generators.stylesheets = false\r\nconfig.generators.javascripts = false\r\n```\r\n\r\nin application.rb\r\n\r\nDecode URL Parameters \r\n==========\r\n-------------------\r\n\r\n```ruby\r\n> u = URI.unescape(\'2013-03-01%2000:00Z\')\r\n=> \"2013-03-01 00:00Z\"\r\n```','2014-09-13 01:58:03','2014-09-13 02:05:12'),(781,'RVM Tips','Uninstall RVM\r\n=============\r\n-----------------\r\n\r\n```sh\r\nrvm implode \r\n```\r\n\r\nor\r\n\r\n```sh\r\nrm -rf ~/.rvm\r\n```\r\n\r\nList all .rvmrc contents and save it to a file.\r\n=============\r\n-----------------\r\n\r\nI had to list .rvmrc contents for a lot of rails projects. Instead of doing it manually, here is the power of unix commands solving that problem.\r\n\r\nStep 1\r\n-----------------\r\n\r\nList all directories. \r\n\r\n```sh\r\nls -l | cut -c 47-\r\n```\r\n\r\nGrab the string from character position 47 to the end of the string \r\n\r\nStep 2\r\n-----------------\r\n\r\nFor each directory\r\n	a) cd to that directory\r\n	a) cat .rvmrc\r\n	b) append output to rvm.txt file\r\n	\r\nSolution\r\n-----------------\r\n\r\n```sh\r\nls -l | cut -c 47- | xargs -I {} cat {}/.rvmrc\r\n```\r\n\r\nTo sort and save only unique entries: \r\n\r\n```sh\r\nls -l | cut -c 47- | xargs -I {} cat {}/.rvmrc | sort | uniq > rvmrc.txt\r\n```','2014-09-13 02:08:04','2014-09-13 02:08:56'),(791,'MySql2 Gem Basics','Connecting to the Database\r\n===========\r\n-------------\r\n\r\nExperimenting in the rails console:\r\n\r\n```sh\r\n> client = Mysql2::Client.new(:host => \"localhost\", :username => \"root\")\r\n> client.query(\"SELECT count(*) from articles\")\r\n```\r\n\r\nThis gives the error: \'Mysql2::Error: No database selected\'. Searching the error message in the mysql2 gem source code does not give any result. Reading the lib/mysql2/client.rb constructor shows the key required for specifying the database name. So let\'s specify the database as follows:\r\n\r\n```sh\r\n> client = Mysql2::Client.new(:host => \"localhost\", :username => \"root\", :database => \'lafon\')\r\n\r\n=> #<Mysql2::Client:0x007f58 @read_timeout=nil, @query_options={:as=>:hash, :async=>false, :cast_booleans=>false, :symbolize_keys=>false, :database_timezone=>:local, :application_timezone=>nil, :cache_rows=>true, :connect_flags=>2147525125, :cast=>true, :default_file=>nil, :default_group=>nil, :host=>\"localhost\", :username=>\"root\", :database=>\"lafon\"}>\r\n```\r\n\r\nQuerying the Database\r\n===========\r\n-------------\r\n\r\n```sh\r\n> result = client.query(\"SELECT count(*) from articles\")\r\n\r\n=> #<Mysql2::Result:0x007f38 @query_options={:as=>:hash, :async=>false, :cast_booleans=>false, :symbolize_keys=>false, :database_timezone=>:local, :application_timezone=>nil, :cache_rows=>true, :connect_flags=>2147525125, :cast=>true, :default_file=>nil, :default_group=>nil, :host=>\"localhost\", :username=>\"root\", :database=>\"lafon_production\"}>\r\nirb(main):010:0> result.class\r\n=> Mysql2::Result\r\n```\r\n\r\nViewing the Result\r\n===========\r\n-------------\r\n\r\nHow do we see the result? Looking at the lib/mysql2/result.rb:\r\n\r\n```sh\r\nmodule Mysql2\r\n  class Result\r\n    include Enumerable\r\n  end\r\nend\r\n```\r\n\r\nAhh, any methods in enumerable can be used. Let\'s see what\'s in the result variable now.\r\n\r\n```sh\r\n>result.class\r\n=> Mysql2::Result\r\n> result.superclass\r\n```\r\n\r\nThis gives : NoMethodError: undefined method superclass for <Mysql2::Result:0x007b38>. That makes sense since, Mysql2::Result is not a subclass of any other class.\r\n\r\n```sh\r\n> result.size\r\n=> 1\r\n> result[0]\r\n```\r\n\r\nThis gives \'NoMethodError: undefined method [] for <Mysql2::Result:0x007f5>\'\r\n\r\n```sh\r\n> result.each do |row|\r\n*   puts row.class\r\n> end\r\nHash\r\n=> [{\"count(*)\"=>72}]\r\n```\r\n\r\nWe see the Mysql2::Result acts like a hash, in this case the key is \'count(*)\' with the result 72.\r\n\r\nSelecting a Record\r\n===========\r\n-------------\r\n\r\n```sh\r\n> result = client.query(\"SELECT title from articles where id=711\")\r\n=> #<Mysql2::Result:0x00fde0 @query_options={:as=>:hash, :async=>false, :cast_booleans=>false, :symbolize_keys=>false, :database_timezone=>:local, :application_timezone=>nil, :cache_rows=>true, :connect_flags=>2147525125, :cast=>true, :default_file=>nil, :default_group=>nil, :host=>\"localhost\", :username=>\"root\", :database=>\"lafon\"}>\r\n> puts result\r\n#<Mysql2::Result:0x007de0>\r\n=> nil\r\n> result.each do |row|\r\n*   puts row\r\n> end\r\n{\"title\"=>\"Git Command Quick Reference\"}\r\n=> [{\"title\"=>\"Git Command Quick Reference\"}]\r\n```\r\n\r\nDiscussion\r\n===========\r\n-----------\r\n\r\nFirst thing I did was to read the tests of the mysql2 gem to learn how to use the gem. The tests were very difficult to read and understand. It is not a good place for learning about the gem. So, I browsed the code with specific question in my mind to find an answer. This allowed me to focus on learning something about the gem without getting distracted by bad coding practices. For instance the constructor of the Mysql2::Client class is about 50 lines long with some clever meta-programming to make it more confusing.\r\n\r\nExercises\r\n===========\r\n-------------\r\n\r\n1. Print the result for the query: select * from articles where id=711;\r\n2. For more details read the [README](https://github.com/brianmario/mysql2 \'mysql2\')\r\n3. Download the source code of the gem. Read the source code. Read the examples in the examples directory.','2014-09-13 06:48:13','2014-09-13 06:51:12'),(801,'SQLite Basics','Discussion\r\n==========\r\n----------\r\n\r\nOn a Mac, SQLite is already installed. You can run sqlite3 and play at the interactive console. Here is the session where I play with Rails application development database in sqlite3 interactive console:\r\n\r\n```sh\r\n$cd ~/projects/lafon/db \r\n$sqlite3 development.sqlite3\r\nSQLite version 3.7.13 2012-07-17 17:46:21\r\nEnter \".help\" for instructions\r\nEnter SQL statements terminated with a \";\"\r\nsqlite> select count(*) from articles;\r\n25\r\nsqlite> select id from articles;\r\n15\r\n20\r\n22\r\n26\r\n...\r\nmore output snipped\r\n```\r\n\r\nSelecting a Record\r\n------------------\r\n\r\n```sh\r\nsqlite> select * from articles where id=15;\r\n15|TDD Basics : Writing your First Test|Pre-requisites\r\n=========\r\n\r\n  - Ruby 2 or above must be installed\r\n  - Your favorite text editor\r\n  - RSpec gem 2 or above. Testing\r\n\r\nObjective\r\n==========\r\n...\r\nmore output snipped\r\n```\r\n\r\nDot-Commands\r\n============\r\n------------\r\n\r\nWe don\'t know the database fields from the output. Let\'s use the shell-specific command **.headers**:\r\n\r\n```sh\r\nsqlite> .headers on\r\n\r\nsqlite> select * from articles where id=15;\r\nid|title|body|created_at|updated_at\r\n15|TDD Basics : Writing your First Test|Pre-requisites\r\n=========\r\n\r\n  - Ruby 2 or above must be installed\r\n  - Your favorite text editor\r\n  - RSpec gem 2 or above. Testing\r\n\r\nObjective\r\n==========\r\n...\r\nmore output snipped\r\n```\r\n\r\nTo view the help you can run the **.help** dot-command:\r\n\r\n```sh\r\nsqlite> .help\r\n```\r\n\r\n\r\nShow Tables\r\n===========\r\n-----------\r\n\r\nTo view all tables:\r\n\r\n```sh\r\nsqlite> .tables\r\narticles           users              schema_migrations\r\n```\r\n\r\nFormatting Output\r\n==================\r\n-------------------\r\n\r\nUsing the column mode, we see the results are displayed as a table:\r\n\r\n```sh\r\nsqlite> .mode column\r\nsqlite> select id, name, email from users;\r\nid          name        email     \r\n----------  ----------  ----------\r\n1           Duck        duck@examp\r\n2           Bugs        bunny@disn\r\n3           Carrot      lover@disn\r\n```\r\n\r\nThe email column is snipped off after 10 characters.\r\n\r\nDeclarative vs Imperative\r\n================\r\n----------------\r\n\r\n\r\nJay A Kreibich in Using SQLite book says:\r\n>> In a declarative language, you state what you want the results to be and allow the language processor to figure out how to deliver the desired results.\r\n>> In imperative languages, each step of an operation must be explicitly written out, leaving it up to the programmer to lead the program, step by step, to the correct conclusion.\r\n\r\nSQL is a declarative language whereas languages like C, C++, Perl, Java are imperative languages. Most SQL commands has the verb-subject form such as CREATE TABLE, DROP INDEX etc. The English-like, declarative nature of SQL makes it easy to understand.\r\n\r\nSummary\r\n=======\r\n--------\r\n\r\nIn this article you learned the SQLite basics. You can learn more by experimenting in the SQLite interactive console. Read the documentation for the details of all the available commands.\r\n\r\nReference\r\n=========\r\n---------\r\n\r\nUsing SQLite by Jay A. Kreibich\r\n\r\n\r\n','2014-09-13 16:08:31','2014-09-13 16:08:31'),(811,'Top 20 Things a Programmer Should Know','I applied the 80/20 principle to the 97 Things a Programmer Should Know book. I have eliminated things that are too obvious or trivial to me. Some of the tips will make sense only if you get the context by reading the book. This is a good book, buy it.  There were 16 more that was almost good enough to be in this list but did not make it. Here is my top 20:\r\n\r\n1. Apply Functional Programming Principles \r\n==========\r\n-----------\r\n\r\nReferential transparency is a very desirable property. It implies that functions consistently yield the same results given the same input, irrespective of where and why they are invoked. That is, function evaluation does not depend on the side effects of mutable state.\r\n\r\n2. Ask, \"What would the user do?\". \r\n==========\r\n-----------\r\n\r\nYou are not the user. We all tend to assume that others think like us. This is not true. Spending an hour watching users is more informative than spending a day guessing what they want.\r\n\r\n3. Your customers do not mean what they say. \r\n==========\r\n-----------\r\n\r\nDiscuss topics numerous times with your customers before you decide that you understand their needs. Try restating the problem two or three times. Talk to them about the things that happen just before or just after the topic you’re talking about to get better context. If at all possible, have multiple people tell you about the same topic in separate conversations. You will hear different stories, which will uncover separate yet related facts. Two people telling you about the same topic will often contradict each other. Your best chance for success is to hash out the differences before you start development.\r\n\r\nUse visual aids in your conversation. You could use whiteboard, visual mockup early in the design phase or a complex functional prototype. Visual aids lengthen attention span and increases the retention rate of the information.  \r\n\r\n4. Start with Why\r\n==========\r\n-----------\r\n\r\nInstead of starting with a yes or no, start with why. Find the reason behind the request. Usually when you know the context of the request, new possibilities open up. It’s common for the request to be accomplished with the existing product in some other way, allowing you to say yes with no work.\r\n\r\nSometimes their idea might be incompatible with your view of the product. Turn that ‘Why?’ on yourself. Sometimes the act of voicing the reason will make it clear that your first reaction doesn’t make sense. If not, bring in other key decision makers. Remember, the goal of all of this is to say yes to the other person and try to make it work, not just for him but for you and your team as well. \r\n\r\nIf you explain why the feature request is incompatible with the existing product, then you can have a productive conversation about whether you are building the right product. \r\n\r\n5. Hard work does not pay off. \r\n==========\r\n-----------\r\n\r\nYou are working too hard if you are trying to be focused and productive for more than 30 hours a week. Reduce your workload to become more effective and get more done. This is a direct consequence of the fact that programming and software development involve a continuous learning process. As you work on a project, you will understand more of the problem domain and find effective ways of reaching the goal. To avoid wasted work, you must allow time to observe the effects of what you are doing, reflect on the things that you see and change your behavior accordingly.\r\n\r\nMost software projects are like a long orienteering marathon. In the dark, with a sketchy map as guidance. If you set off in one direction, running as fast as you can, you might impress some, but you are not likely to succeed. You need to keep a sustainable pace, and you need to adjust the course when you learn more about where you are and where you are heading.\r\n\r\nLearn more about software development and programming techniques. Read books, go to conferences, communicate with other professionals, experiment with new implementation techniques and learn about powerful tools that simplify your job. Keep yourself updated in your field of expertise. Preparation and education are an essential part of our profession. \r\n\r\nBe focused on the project, contribute as much as you can by finding smart solutions, improve your skills, reflect on what you are doing and adapt your behavior. Being focused and productive 60 hours a week is not a sensible thing to do. Prepare, effect, observe, reflect and change.\r\n\r\n6. Do lots of deliberate practice.\r\n==========\r\n-----------\r\n\r\nYou do deliberate practice to improve your ability to perform a task. It’s about skill and technique. Deliberate practice means repetition. It means performing the task with the aim of increasing your mastery of one or more aspects of the task. It means repeating the repetition. Slowly, over and over again, until you achieve your desired level of mastery. You do deliberate practice to master the task, not to complete the task. The principal aim of deliberate practice is to improve your performance.\r\n \r\n>> The key to developing expertise is deliberate practice: not just doing it again and again, but challenging yourself with a task that is just beyond your current ability, trying it, analyzing your performance while and after doing it and correcting any mistakes.\r\n>> Peter Norvig\r\n\r\n7. Reinvent the wheel often. \r\n==========\r\n-----------\r\n\r\nThe same way that watching a movie about sailing is very different from going sailing, so too is using existing code versus designing your own software from the ground up, testing it, breaking it, repairing it and improving it along the way. Reinventing the wheel is about how to get an intimate knowledge of the inner workings of various components that already exist. \r\n\r\nMost developers have never created core software libraries and therefore do not have an intimate knowledge of how they work. The consequence is that all these kinds of software are viewed as mysterious black boxes that just work. Understanding only the surface of the water is not enough to reveal the hidden dangers beneath. Not knowing the deeper things in software development will limit your ability to create stellar work.\r\n\r\nReinventing the wheel and getting it wrong is more valuable than nailing it first time. There are lessons learned from trial and error that have an emotional component to them that reading a technical book alone just cannot deliver.\r\n\r\nLearned facts and book smarts are crucial, but becoming a great programmer is as much about acquiring experience as it is about collecting facts. Reinventing the wheel is as important to a developer’s education and skill as weightlifting is to a body builder.\r\n\r\n8. Continuous learning.\r\n==========\r\n-----------\r\n\r\nRead. Join mailing list. Get hands on and write code. Find a mentor and work. Get to know the frameworks and libraries you use. When you make a mistake, fix a bug or run into a problem, understand what happened. Teaching is a good way to learn. Participate in lunch-and-learn, user group or local conference. Join or start a study group. Go to conferences or watch the talks online. Learn a new language. Branching out gives you new ideas you can use in your current technology stack. Learn about your domain. It helps you to understand the requirements and solve business problems. \r\n\r\n9. Know how to use command line tools. \r\n==========\r\n-----------\r\n\r\nThe search and replace capabilities provided by the grep and sed utilities are often more powerful than IDEs.\r\n\r\nTo find classes with same name:\r\n\r\n```sh\r\nfind . -name ‘*.rb’ | see ’s/.*\\///‘ | sort | uniq -c | grep -v “^ *1” | sort -r\r\n```\r\n\r\n10. The Unix tools are your friends. \r\n==========\r\n-----------\r\n\r\nIt’s very easy to extend the world of the Unix tools. Just write a program in any language that plays by a few simple rules:\r\n\r\n1. Your program should perform just a single task\r\n2. It should read data as text lines from its standard input\r\n3. It should display its results unadorned by headers and other noise on its standard output\r\n4. Parameters affecting the tool’s operation are given in the command line. \r\n\r\n11. Step back and automate, automate, automate. \r\n==========\r\n-----------\r\n\r\nYou can go a long way with a shell language such as bash or PowerShell and a build automation system. If you need to interact with websites, use a tool such as iMacros or Selenium.\r\n\r\nYou don’t have to learn all of bash to get started. Learn as you go. When you have a task that you think can be automated, learn just enough about your tools to do it. And do it early in a project when time is usually easier to find. \r\n\r\n12. Put everything under version control. \r\n==========\r\n-----------\r\n\r\nTag a software release with a symbolic name so that you can easily revisit in the future the exact version of the software your customer runs. You can create branches of parallel development: most projects have an active development branch and one or more maintenance branches for released versions that are actively supported.\r\n\r\nCommit each logical change in a separate operation. Lumping many changes together in a single commit will make it difficult to disentangle them in the future. This is especially important when you make project-wide refactorings or style changes, which can easily obscure other modifications.\r\n\r\n13. Put the mouse down and step away from the keyboard. \r\n==========\r\n-----------\r\n\r\nWhile coding, the logical part of your brain is active and the creative side is shut out. It can’t present anything to you until the logical side takes a break.\r\n\r\nNext time you hit a nasty problem, do yourself a favor. Once you really understand the problem, go do something involving the creative side of your brain - sketch out the problem, listen to music or go for a walk. Sometimes the best thing you can do to solve a problem is to put the mouse down and step away from the keyboard.\r\n\r\n14. Missing opportunities for polymorphism. \r\n==========\r\n-----------\r\n\r\nPolymorphism creates tiny localized execution contexts that let us work without the need for if-else blocks. Being in a context allows us to do the right thing directly, whereas being outside of that context forces us to reconstruct it so that we can then do the right thing. With careful use of alternate implementations, we can capture context that can help us produce less code that is more readable. Command and Double Dispatch play well together. By applying polymorphism, we reduce the if-else blocks in our code.\r\n\r\n15. Prefer domain-specific types to primitive types. \r\n==========\r\n-----------\r\n\r\nThe code becomes more readable, as it expresses concepts of a domain, not just Float or String. The code becomes more testable, as the code encapsulates behavior that is easily testable. The code facilities reuse across applications and systems. Start exploring domain-specific types for the purpose of developing quality software.\r\n\r\n16. Test for required behavior, not incidental behavior. \r\n==========\r\n-----------\r\n\r\nA common pitfall in testing is to hardwire tests to the specifics of an implementation, where those specifics are incidental and have no bearing on the desired functionality. \r\n\r\nWhen tests are hardwired to implementation incidentals, changes to the implementation that are actually compatible with the required behavior may cause tests to fail, leading to false positives.\r\n\r\nTo be effective, tests need to state contractual obligations rather than parrot implementations. They need to take a blackbox view of the units under test, sketching out the interface contracts in executable form. Therefore, align tested behavior with required behavior.\r\n\r\n17. Test precisely and concretely. \r\n==========\r\n-----------\r\n\r\nIn specifying behavior, tests should not simply be accurate: they must also be precise. The result of adding an item to an empty collection is not simply that it is not empty: it is that the collection now has a single item and that the single item held is the item added. Two or more items would qualify as not empty and would also be wrong. A single item of a different value would also be wrong. \r\n\r\n18. The golden rule of API design. \r\n==========\r\n-----------\r\n\r\nIt’s not enough to write tests for an API you develop; you have to write unit tests for code that uses your API. When you follow this rule, you learn firsthand the hurdles that your users will have to overcome when they test their code independently.\r\n\r\n19. Write Tests for People\r\n==========\r\n-----------\r\n\r\nGood tests act as documentation for the code they are testing. They describe how the code works. For each usage scenario, the tests:\r\n\r\n1. Describe the context, starting point or preconditions that must be satisfied\r\n2. Illustrate how the software is invoked.\r\n3. Describe the expected results or post conditions to be verified\r\n\r\nDifferent usage scenarios will have slightly different versions of each of these. Others should be able to look at a few tests and by comparing these three parts of the tests, be able to see what causes the software to behave differently. Each test should clearly illustrate the cause-and-effect relationship among these three parts.\r\n\r\nGive each test a meaningful name that describes the particular usage scenario. It is a good idea to test your tests. You can verify that they detect the errors you think they detect by inserting those errors into the production code. Make sure they report errors in a meaningful way. You should also verify that your tests speak clearly to a person trying to understand your code. The only way to do this is to have someone who isn’t familiar with your code read your tests and tell you what they learned. \r\n\r\n20. One binary rule. \r\n==========\r\n-----------\r\n\r\nBuild a single binary that you can identify and promote through all the stages in the release pipeline. Hold environment-specific details in the environment. This could mean, keeping them in a file or in the path. Keep the environment information versioned too. If the environment configuration breaks, without versioning we cannot figure out what changed. The environmental information should be versioned separately from the code, since they’ll change at different rates and for different reasons. ','2014-09-14 16:51:53','2014-09-18 04:16:24'),(821,'Code Simplicity Book Review','This is one of my favorite book. You can finish it during a plane ride. Some of the notes here make not make sense to you unless you read the discussion in the book that gives you context. It also has diagrams with makes it easier to understand the concepts.\r\n\r\nTalent involved in programming - reducing complexity to simplicity. Think about reducing the complexity for other programmers. The more people who don\'t act to reduce the complexity, the more incomprehensible the program becomes. As the program approaches infinite complexity, it becomes impossible to find all the problems with it.\r\n\r\nSo, a good programmer writes as simple as possible to other programmers. A good programmer creates things that are easy to understand, so that it\'s really easy to fix all the bugs. \r\n\r\nSimplicity is misunderstood to mean that programs should not have a lot of code, or shouldn\'t use advanced technologies. But that\'s not true. Sometimes a lot of code actually leads to simplicity; it just means more writing and more reading, which is fine. \r\n\r\nUsually more advanced technologies lead to more simplicity, even though you have to learn about them first, which can be troublesome. \r\n\r\nSpending a little more time writing simple code turns out to be faster than writing lots of code quickly at the beginning and then spending a lot of time trying to understand it later. Many great programs have stagnated in their development because it took so long to add features to the complex beasts they had become.\r\n\r\nThe quality of the end result is dependent entirely upon the quality of the machine, the quality of our ideas and the quality of our code. The quality of the code is the largest problem faced by software projects today. Improving the code is the most important problem we must solve in order to improve the result.\r\n\r\nEvery programmer is a designer. Any given decision must be made by an individual, not by a group of people. Experienced programmers have to figure out how to design a system and split up the tasks between different people. \r\n\r\nWhen we are making decisions about software, our guiding principle can be how we can help. You can prioritize feature requests by asking : Which feature will help people the most? This is a good question to ask about any proposed change to your software system.\r\n\r\nThe goals of software design. \r\n-----------\r\n\r\n1. To allow us to write software that is as helpful as possible. \r\n2. To allow our software to continue to be as helpful as possible. \r\n3. To design systems that can be created and maintained as easily as possible by their programmers, so that they can be - and continue to be - as helpful as possible.\r\n\r\nThe equation of software design. \r\n-----------\r\n\r\nThe desirability of any change is directly proportional to the value of the change and inversely proportional to the effort involved in making the change. There is a very good discussion on this topic as well as on the topic of value. It seems to me that this discussion is basically centered around the 80/20 principle. \r\n\r\nHe recommends that when considering value, you also have to consider:\r\n\r\n1. How many users (what percentage) will this change be valuable to?\r\n2. How often will this feature be valuable?\r\n3. When it is valuable, how valuable will it be?\r\n\r\nWhen considering the effort involved in change, it\'s important to take into account all the effort that might be involved, not just the time you\'re going to spend programming. \r\n\r\n1. How much research will it take? \r\n2. How much communication will all of the developers have to do with each other? \r\n3. How much time will you spend thinking about the change?\r\n\r\nIn short, every single piece of time connected with a change is part of the effort cost. The desirability of a change is directly proportional to the value now plus the future value and inversely proportional to the effort of implementation plus the effort of maintenance. In fact, nearly all decisions in software design reduce entirely to measuring the future value of a change versus its effort of maintenance.\r\n\r\nThe ideal solution and the only way to guarantee success is to design your systems such that the effort of maintenance decreases over time and eventually becomes zero. Changes with higher future value are still more desirable, but as long as every decision has a maintenance cost that approaches zero over time, you can\'t get yourself into a dangerous future situation.\r\n\r\nOften, designing a system that will have decreasing maintenance effort requires a significantly larger effort of implementation - quite a bit more design work and planning are required. The effort of implementation is an insignificant factor in making design decisions and should be ignored. \r\n\r\nIn short, it is more important to reduce the effort of maintenance than it is to reduce the effort of implementation.\r\n\r\nThe quality level of your design should be proportional to the length of future time in which your system will continue to help people. Don\'t lock yourself into any one method of doing things, keep it flexible, don\'t make any decisions you can\'t ever change and put a lot of attention on design.\r\n\r\nThe future is the most important thing to consider in making design decisions. But there is a difference between designing in a way that allows for future change and attempting to predict the future.\r\n\r\nIn software design we can make certain decisions based on information that we have now, for the purpose of making a better future (decreasing maintenance effort and increasing value), without having to predict the specifics of what\'s going to happen in that future.\r\n\r\nThe longer your program exists, the more probable it is that any piece of it will have to change. Software must be as flexible as reasonably possible so that you can adapt it to future changes.\r\n\r\nThere are three mistakes that software designers make when attempting to cope with the Law of Change:\r\n\r\n1. Writing code that isn\'t needed.\r\n2. Not making the code easy to change.\r\n3. Being too generic.\r\n\r\nWriting Code That Isn\'t Needed\r\n-----------\r\n\r\nDon\'t write code until you actually need it. Remove any code that isn\'t being used. That is, you should also get rid of any code that is no longer needed. You can always add it back later if it becomes needed again.\r\n\r\nNot Making the Code Easy to Change.\r\n-----------\r\n\r\nRigid design makes changes to code difficult. There are two ways to get a rigid design:\r\n\r\n1. Make too many assumptions about the future.\r\n2. Write code without enough design.\r\n\r\nCode should be designed based on what you know now, not on what you think will happen in the future. A certain amount of planning is very valuable in software design. Even if you don\'t write detailed plans, you\'ll be fine as long as the changes are small and code stays easily adaptable for the unknown future.\r\n\r\nBeing too Generic\r\n-----------\r\n\r\nThis involves writing a lot of code that isn\'t needed. Over engineering occurs when your design makes things more complex instead of simplifying things. Be only as generic as you know you need to be right now. Use the right level of abstraction. Don\'t speculate customer needs. I have run into problems when I make the generic right from the beginning, instead of waiting for duplication to emerge.\r\n\r\nIncremental Development and Design\r\n-----------\r\n\r\nPick whatever is simplest to work on at each step, when you get there. Sometimes you may even need to take a single feature and break it down into many small, simple, logical steps so that it can be implemented easily.\r\n\r\nIncremental development is a method of building up a whole system by doing work in small pieces. Incremental design is similarly a method of creating and improving the system\'s design in small increments. \r\n\r\nIn the context of TDD, it looks like this:\r\n\r\nIncremental Development ----> Make it Green\r\nIncremental Design      ----> Refactor\r\n\r\nThe chance of introducing a defect into your program is proportional to the size of the changes you make to it.\r\n\r\nThe best design is the one that allows for the most change in the environment with the least change in the software.\r\n\r\nNever fix anything unless it\'s a problem and you have evidence showing that the problem really exists. Premature optimization is an example. Get real evidence that a problem is valid before you address it. \r\n\r\nLaw of Defect Probability\r\n-----------\r\n\r\nIf we can reuse old code, we don\'t have to write or change as much code when we add new features, so we introduce fewer defects.\r\n\r\nThe ease of maintenance of any piece of software is proportional to the simplicity of its individual pieces.\r\n\r\nContinually work to make the code simpler to make the effort of maintenance decrease over time. Simplicity is relative. It\'s good to have sections in code documentation like \'New to This Code?\' that contain some simple explanations that will help people understand code. These should be written as if the reader knows nothing about the program, because if people are new to something, they probably don\'t know anything about it.\r\n\r\nContext is important, for example in the context of program code, advanced technologies often lead to simplicity, if used right. Sometimes what seems complex in one context is simple in another. There are lots of ways to make your code easy to learn: simple documentation, simple design, step-by-step tutorials, etc.\r\n\r\nBe Consistent\r\n-----------\r\n\r\nCode that isn\'t consistent is harder for a programmer to understand and read.\r\n\r\nReadability\r\n-----------\r\n\r\nReadability of code depends primarily on how space is occupied by letters and symbols.\r\n\r\nNaming Things\r\n-----------\r\n\r\nNames should be long enough to fully communicate what something is or does without being so long that they become hard to read.\r\n\r\nComments\r\n-----------\r\n\r\nThe purpose of comments is to explain why you did something.\r\n\r\nComplexity\r\n-----------\r\n\r\nSome projects start out with such a complex set of requirements that they never get a first version out. If you\'re in this situation, you should trim features. Don\'t shoot for the moon in first release - get out something that works and make it work better over time.\r\n\r\nCommon ways to add complexity are:\r\n\r\n- Expanding the purpose of the software. Stick to the existing purpose of your software - it just has to do what it does well, and you will succeed.\r\n\r\n- Adding programmers. You are more likely to be successful with a small group of expert programmers than a large group of inexpert programmers.\r\n\r\n- Changing things that don\'t need to be changed. \r\n- Being locked into bad technologies.\r\n- Misunderstanding. Understand the systems and tools you work with.\r\n- Poor design or no design.\r\n- Reinventing the wheel.\r\n\r\nComplexity and Purpose\r\n-----------\r\n\r\nThink about the user\'s purpose. Users are happiest with a focused, simple product that never violates its basic purpose.\r\n\r\nBad Technologies\r\n-----------\r\n\r\nThere are three factors you can look at to determine if a technology is bad before you start using it: survival potential, interoperability and attention to quality.\r\n\r\nSurvival potential is the likelihood that it will continue to be maintained. Interoperability is a measure of how easy it is to switch from a technology. Ask yourself, \'Can we interact with this technology in some standard way, so it would be easy to switch to another system that follows the same standard?\r\n\r\nAttention to Quality\r\n-----------\r\n\r\nIs it becoming easier to use or more complex? Do the people who maintain the technology care about the quality of their product? Have there recently been a lot of serious security vulnerabilities in the software that seem like they were the result of poor programming.\r\n\r\nComplexity and the Wrong Solution\r\n-----------\r\n\r\nOften, if something is getting very complex, that means there is an error in the design somewhere far below the level where the complexity appears.\r\n\r\nWhat Problem Are You Trying to Solve?\r\n-----------\r\n\r\nWhen things get complex, backup and take a look at the problem you are trying to solve. Take a really big step back. You are allowed to question everything. Any method of solving that problem is acceptable, so what you need to do is figure out what the best method would be for your situation. Discard assumptions. Really look at the problem you\'re trying to solve. Make sure that you fully understand every aspect of it. Then figure out the simplest way to solve it. Ask yourself: \'How, in general, in a perfect world, should this sort of problem be solved?\'\r\n\r\nComplex Problems\r\n-----------\r\n\r\nTo solve a complex problem doesn\'t mean solution has be complex. It does mean that you will have to work harder than usual to simplify code. If you\'re having trouble with a complex problem, write it down on paper in plain language or draw it out as a diagram. Most difficult design problems can be solved by simply drawing or writing them out on paper.\r\n\r\nHandling Complexity\r\n-----------\r\n\r\nIn some part of your system is too complex, there is a specific way to fix it - redesign the individual pieces, in small steps. Each fix should be as small as you can safely make it without introducing further complexity. More often, the steps involve splitting one complex piece into multiple simple pieces.\r\n\r\nYou must first conceive of a system that is simpler than the one you have now - even if just in a small way. Then you work toward that simpler system, step by step. Once you reach that simpler system, you again conceive an even simpler system and work toward that. You don\'t every have to conceive the perfect system, because there is no such thing. You just have to continuously work toward a system that is better than the one you have now and eventually you will reach a highly manageable level of simplicity.\r\n\r\nYou cannot stop implementing features to spend time on redesigning. The Law of Change tells us that the environment around your program will be continuously changing and thus your program\'s functionality must adapt. If you fail to adapt and improve from the user\'s perspective for any significant length of time, you risk the loss of your user base and project failure.\r\n\r\nThere are various ways to balance these two needs of writing features and handling complexity. One of the best ways is to do your redesigning purely with the goal of making some specific feature easier to implement and then implementing that feature. That way, you switch regularly between redesign work and feature work. This also helps your new design fit your needs well, because you\'re creating it with a real use in mind. Your system will slowly get less complex over time and you will still keep pace with your user\'s needs. You can even do this for bugs - if you see that some bug would be easier to fix with a different design, redesign the code before fixing it.\r\n\r\nMaking One Piece Simpler\r\n-----------\r\n\r\nStudy design patterns, methods of dealing with legacy code and all the tools of software engineering in general. It can be particularly helpful to know multiple programming languages and be familiar with many different libraries, because each involves different ways of thinking about problems that could be applicable to your situation, even if you\'re not using those languages or libraries. Studying those materials will give you many options to choose from when you are faced with a complexity. Sometimes, thought, you many look at a piece of code and not know any tools to use to simplify it. Ask yourself: How could this be easier to deal with or more understandable? That\'s the key question behind every simplification. Any true answer to it is a valid way of making your code simpler; the tools and techniques of software design just help us come up with better answers.\r\n\r\nUnfixable Complexity\r\n-----------\r\n\r\nWhen you are working on simplifying your system, you may find that some complexity is hard to avoid, like the complexity of the underlying hardware. If you run into an unfixable complexity like this, your goal is to hide the complexity. Put a wrapper around it that is simple for other programmers to use and understand.\r\n\r\nRewriting\r\n-----------\r\n\r\nYou should only rewrite if all of the following are true:\r\n1. You have developed an accurate estimate that shows that rewriting the system will be a more efficient use of time than redesigning the existing system.\r\n2. You have a tremendous amount of time to spend on creating a new system.\r\n3. You are somehow a better designer than the original designer of the system or if you are the original designer, your design skills have improved drastically since you designed the original system.\r\n4. You fully intend to design this new system in a series of simple steps and have users who give you feedback for each step along the way.\r\n5. You have the resources available to both maintain the existing system and design a new system at the same time. Never stop maintaining a system that is currently in use so that the programmer’s can rewrite it. Systems must always be maintained if the are in use. Remember that your personal attention is also a resource that must be taken into account here - do you have enough time available in each day to be a designer on both the new system and the old system simultaneously, if you are going to work on both?\r\n\r\n','2014-09-18 03:27:00','2014-09-18 03:30:00'),(831,'TDD Beyond Basics : Test Precisely and Concretely','Objective\r\n=========\r\n---------\r\n\r\n- Learn how to test precisely and concretely.\r\n\r\nDiscussion\r\n==========\r\n-----------\r\n\r\nTest precisely and concretely. \r\n-----------\r\n\r\n>> In specifying behavior, tests should not simply be accurate: they must also be precise. The result of adding an item to an empty collection is not simply that it is not empty: it is that the collection now has a single item and that the single item held is the item added. Two or more items would qualify as not empty and would also be wrong. A single item of a different value would also be wrong. \r\n>> Tip by Kevlin Henny from the book 97 Things a Programmer Should Know \r\n\r\nIn a previous article discussing [how to identify Given, When and Then](http://rubyplus.com/articles/91 \'Given When Then\') we used a stack example. Here is that example:\r\n\r\n```ruby\r\nrequire_relative \'stack\'\r\n\r\ndescribe Stack do\r\n  it \'should push a given item\' do\r\n    stack = Stack.new\r\n	\r\n    stack.push(1)\r\n	\r\n    stack.size.should == 1\r\n  end \r\n\r\n  it \'should pop from the stack\' do\r\n    stack = Stack.new\r\n    stack.push(2)\r\n	\r\n    result = stack.pop\r\n	\r\n    result.should == 2\r\n    stack.size.should == 0\r\n  end\r\nend\r\n```\r\n\r\nHere is the file stack.rb:\r\n\r\n```ruby\r\nclass Stack\r\n  def initialize\r\n	  @elements = []\r\n  end\r\n	\r\n  def push(item)\r\n	  @elements << item\r\n  end\r\n	\r\n  def	pop\r\n	  @elements.pop\r\n  end\r\n	\r\n  def size\r\n	  @elements.size\r\n  end\r\nend\r\n```\r\n\r\nYou can see in this example, the first test does not follow the \'Test precisely and concretely\' guideline. The reason is that we implemented the push first, so we did not have the pop to check the value that was pushed. If you read some of the online implementations of the stack, you will see you could use \r\n\r\n```ruby\r\nstack.instance_variable_get(:@elements).should == [1]\r\n```\r\n\r\nThis couples your test with the implementation details, so when you change the elements variable during refactor, the behavior does not change but your tests will fail. The tests become brittle.\r\n\r\nYou have another option of exposing the elements using attr_reader just for testability. This does not break encapsulation since it is read only. It needs a custom implementation of getting **elements** in order to avoid breaking existing clients using the attr_reader if there is a refactor that affects the naming of elements. Another option is to just update your first test, so that it uses the pop to make the test more precise. This option results in less production code. Less mass results in lean system capable of changing faster to requirements in future. The updated first test looks like this:\r\n\r\n```ruby\r\n  it \'should push a given item\' do\r\n    stack = Stack.new\r\n	\r\n    stack.push(1)\r\n	\r\n    expect(stack.size).to eq(1)\r\n    expect(stack.pop).to eq(1)\r\n  end \r\n```\r\n\r\nHere is Jim Weirich\'s stack implementation:\r\n\r\n```ruby\r\nclass Stack\r\n  class StackError < StandardError; end\r\n  class UnderflowError < StackError; end\r\n\r\n  def initialize\r\n    @items = []\r\n  end\r\n\r\n  def depth\r\n    @items.size\r\n  end\r\n\r\n  def empty?\r\n    @items.empty?\r\n  end\r\n\r\n  def top\r\n    @items.last\r\n  end\r\n\r\n  def push(item)\r\n    @items << item\r\n  end\r\n\r\n  def pop\r\n    fail UnderflowError, \"Cannot pop an empty stack\" if empty?\r\n    @items.pop\r\n  end\r\nend\r\n```\r\n\r\nHe uses the **top** method in order to follow the good advice from Kevlin Henny. You can read his stack_spec from his git repo (examples directory) : https://github.com/jimweirich/rspec-given \r\n\r\nSummary\r\n========\r\n--------\r\n\r\nIn this article we looked at a simple implementation of Stack and we analyzed several options and picked a solution that required least amount of code that still satisfies the good practice tip \'Test Precisely and Concretely\'.','2014-09-18 05:10:16','2014-09-19 04:26:25'),(841,'Ruby Thread Basics','Create One Thread\r\n=================\r\n-----------------\r\n\r\n```ruby\r\nt = Thread.new\r\n```\r\n\r\nWhen you run this program, you get: \r\n\r\n```sh\r\nThreadError: must be called with a block\r\n```\r\n\r\nLet\'s use a block when we create the thread:\r\n\r\n```ruby\r\nt = Thread.new { puts \'hello thread\' }\r\n```\r\n\r\nHere we create a new thread separate from the main thread\'s execution using Thread.new. If you run this you will **not** see the \'hello thread\' in the output. The reason is that the new thread gets killed when the main thread exits the program.\r\n\r\nJoining a Thread\r\n================\r\n----------------\r\n\r\n```ruby\r\nt = Thread.new { puts \'hello thread\' }\r\nt.join\r\n```\r\n\r\nNow you will see the output. The main thread waits for the child thread to finish before it exits the program.\r\n\r\nMultiple Threads\r\n================\r\n----------------\r\n\r\nLet\'s use an array for handling multiple threads at once.\r\n\r\n```ruby\r\nthreads = []\r\nthreads << Thread.new { puts \'hello from thread\' }\r\nthreads << Thread.new { 3.times { puts \'I will not talk during the class\' } }\r\n```\r\n\r\nWhen you run this, there is no output.\r\n\r\nJoining Multiple Threads\r\n=========================\r\n-------------------------\r\n\r\n```ruby\r\nthreads = []\r\nthreads << Thread.new { puts \'hello from thread\' }\r\nthreads << Thread.new { 3.times { puts \'I will not talk during the class\' } }\r\n\r\nthreads.each { |t| t.join }\r\n```\r\n\r\nYou can see now the threads run by taking turns. Run this program several times. Here I show only the output that is different from each run.\r\n\r\n```sh\r\nI will not talk during the classhello from thread\r\n\r\nI will not talk during the class\r\nI will not talk during the class\r\n```\r\n\r\n```sh\r\nhello from threadI will not talk during the class\r\n\r\nI will not talk during the class\r\nI will not talk during the class\r\n```\r\n\r\n```sh\r\nhello from thread\r\nI will not talk during the class\r\nI will not talk during the class\r\nI will not talk during the class\r\n```\r\n\r\nAs you can see from the output, you cannot predict which thread will run first. The scheduler picks one of the threads that is in ready to run state and gives it time to run in the CPU.\r\n\r\nLong Running Thread\r\n===================\r\n-------------------\r\n\r\n```ruby\r\nresult = 0\r\n\r\nv = Thread.new do\r\n  puts \'Other Thread : A long process goes here\'\r\n  sleep 5\r\n  result = 10\r\nend\r\n\r\nputs \'Main Thread : do other stuff while other thread is running\'\r\nputs \'Main Thread : now wait for the thread to finish\'\r\nv.join\r\n\r\nputs \"Main Thread : The result is #{result}\"\r\n```\r\n\r\nHere is the output of this program for one of my runs:\r\n\r\n```sh\r\nMain Thread : do other stuff while other thread is running\r\nMain Thread : now wait for the thread to finish\r\nOther Thread : A long process goes here\r\nMain Thread : The result is 10\r\n```\r\n\r\nThe main thread will wait for the long running thread to finish before the program exits. Though you don\'t have to, it\'s a good idea to always use #join to close the threads that you create to ensure that any cleanup code in your threads runs before your program exits. \r\n\r\nQuiz\r\n----\r\n\r\n1. What is the value of the result before the join call? Why do you see that value?\r\n2. What is the value of the result after the join call? Why do you see that value?\r\n\r\nYou can add the puts statement to verify your answers to these questions.\r\n\r\nCurrent Thread\r\n==============\r\n--------------\r\n\r\n```ruby\r\nresult = 0\r\n\r\nv = Thread.new do\r\n  puts \"Child Thread : #{Thread.current} \"\r\n  puts \'Other Thread : A long process goes here\'\r\n  sleep 5\r\n  result = 10\r\nend\r\n\r\nputs \"Main Thread : #{Thread.current} do other stuff in main thread\"\r\nputs \'Main Thread : now wait for the thread to finish\'\r\nv.join\r\nputs Thread.current\r\nputs \"Main Thread : The result is #{result}\"\r\n```\r\nHere is the output from one of the runs of this program:\r\n\r\n```sh\r\nMain Thread : <Thread:0x000001010cb7d0> do other stuff in main thread\r\nChild Thread : <Thread:0x0000010123c8f8> \r\nOther Thread : A long process goes here\r\nMain Thread : now wait for the thread to finish\r\n<Thread:0x000001010cb7d0>\r\nMain Thread : The result is 10\r\n```\r\n\r\nIf you run this program several times, you will see the thread gets its turn based on when it gets a chance to run. There is no guarantee the output you see will be the same everytime you run this program. We are using the Thread.current method to identify the thread. It is unique for any given thread.\r\n\r\nSummary\r\n=======\r\n--------\r\n\r\nIn this article, you learned how to create one thread, many threads, using join and current. In the next article we will learn about deadlocks and how to use strace to view details about a program that is in deadlock.','2014-09-24 06:14:33','2014-09-24 06:19:37'),(851,'MongoDB Basics','CAP Theorem\r\n============\r\n------------\r\n\r\nThe CAP Theorem states that, in a distributed system (a collection of interconnected nodes that share data), you can only have two out of the three guarantees across a write/read pair: Consistency, Availability, and Partition Tolerance.\r\n\r\n**Consistency**   - If a value is written and then fetched, I will always get back the new value.\r\n**Availability**  - If a value is written, a success message should always be returned. If a subsequent read returns a stale value, it\'s ok.\r\n**Partition Tolerance** - The system will continue to function when network partitions occur.\r\n\r\nWhy Mongodb?\r\n===========\r\n-----------\r\n\r\nHere is a visual guide to NoSQL systems:\r\n\r\n![alt text](https://images.rubyplus.com/cap.png \"NoSQL Visual Guide\")\r\n\r\nYou can see that mongodb has picked consistency and partition tolerance. This diagram also gives you a good big picture view of how different NoSQL databases fit in the CAP triangle.\r\n\r\nWhen to Use Mongodb?\r\n===========\r\n-----------\r\n\r\nFor most modern web apps that requires:\r\n\r\n1. Account and user profiles\r\n2. CMS\r\n3. Form data\r\n4. Blogs / user-generated content\r\n5. Messaging\r\n6. System configuration\r\n7. Log data of any kind\r\n8. Graphs\r\n9. Location based data\r\n\r\nInstalling on Mac\r\n==============\r\n------------------\r\n\r\n```sh\r\nbrew install mongodb\r\n```\r\n\r\nInitial Setup\r\n==========\r\n-------------\r\n\r\nCreate the data directory:\r\n\r\n```sh\r\n$ sudo mkdir -p /data/db\r\n```\r\n\r\n```sh\r\n$ ls -ld /data/db\r\ndrwxr-xr-x  2 root  wheel  68 Sep 25 17:03 /data/db\r\n```\r\n\r\nThe data directory must have read / write permission for the user who will run the mongoid process. Here you see only root has all the permission. Let\'s provide the current logged in user the permission to read and write:\r\n\r\n```sh\r\nsudo chown -R $USER /data/db\r\n```\r\n\r\nYou will get : \'10309 Unable to create/open lock file: /data/db/mongod.lock errno:13 Permission denied Is a mongod instance already running?, terminating\' error if you don\'t have the read / write privileges.\r\n\r\nRunning Mongodb\r\n=============\r\n-------------\r\n\r\n```sh\r\n$mongodb\r\n```\r\n\r\nConnect to Mongod\r\n================\r\n----------------\r\n\r\n```sh\r\n$mongo\r\n```\r\n\r\nThis will open mongodb shell that allows you to interact with mongodb.\r\n\r\n```sh\r\n~$ mongo\r\nMongoDB shell version: 2.6.3\r\nconnecting to: test\r\nWelcome to the MongoDB shell.\r\nFor interactive help, type \"help\".\r\nFor more comprehensive documentation, see\r\nhttp://docs.mongodb.org/\r\nQuestions? Try the support group\r\nhttp://groups.google.com/group/mongodb-user\r\nServer has startup warnings:\r\n2014-09-25T17:13:59.763-0700 [initandlisten]\r\n2014-09-25T17:13:59.763-0700 [initandlisten] ** WARNING: soft rlimits too low. Number of files is 256, should be at least 1000\r\n>\r\n```\r\n\r\nCurrent Database\r\n-----------\r\n\r\nBy default, mongodb uses test database, you can see the current database by using the \'db\' command:\r\n\r\n```sh\r\n> db\r\ntest\r\n```\r\n\r\nList all Databases\r\n-----------\r\n\r\nTo see a list of all databases:\r\n\r\n```sh\r\n> show dbs\r\nadmin  (empty)\r\nlocal  0.078GB\r\n```\r\n\r\nNew Database\r\n-----------\r\n\r\nTo use a new database \'mydb\':\r\n\r\n```sh\r\n> use mydb\r\nswitched to db mydb\r\n```\r\n\r\nTo check the current database:\r\n\r\n```sh\r\n> db\r\nmydb\r\n```\r\n\r\nWhen you use a new database, the current database changes to the new database.\r\n\r\n```sh\r\n> show dbs\r\nadmin  (empty)\r\nlocal  0.078GB\r\n```\r\n\r\nBut the show dbs command does not show the mydb in it\'s list. Let\'s create two new documents using javascript functions:\r\n\r\n```sh\r\n j = { name : \'Mongo\' }\r\n{ \"name\" : \"Mongo\" }\r\n> k = { x : 3 }\r\n{ \"x\" : 3 }\r\n```\r\n\r\nInsert Documents\r\n-----------\r\n\r\nTo insert the two documents into the mydb database:\r\n\r\n```sh\r\n> db.testData.insert(j)\r\nWriteResult({ \"nInserted\" : 1 })\r\n> db.testData.insert(k)\r\nWriteResult({ \"nInserted\" : 1 })\r\n```\r\n\r\nHere the testData is a collection that can hold documents. In this case we have two documents in the testData collection. The collection is equivalent to table in relational databases.\r\n\r\nView Collections\r\n-----------\r\n\r\nTo view all the collections:\r\n\r\n```sh\r\n> show collections\r\nsystem.indexes\r\ntestData\r\n```\r\n\r\nYou can see we have testData collection.\r\n\r\n```sh\r\n> show dbs\r\nadmin  (empty)\r\nlocal  0.078GB\r\nmydb   0.078GB\r\n```\r\n\r\nNow we also see the mydb database, it was created when new documents were inserted into the testData collection. Let\'s check the two new documents we created exists in the database:\r\n\r\n```sh\r\n> db.testData.find()\r\n{ \"_id\" : ObjectId(\"5424b92e0b73fd80bdd0724a\"), \"name\" : \"Mongo\" }\r\n{ \"_id\" : ObjectId(\"5424b9380b73fd80bdd0724b\"), \"x\" : 3 }\r\n```\r\n\r\n_id has unique value for every document. Mongodb automatically generates the value and assigns to a document when it is created.\r\n\r\nReferences:\r\n==========\r\n----------\r\n\r\n1. [MongoDb and the \"10309 Unable to create/open lock file\" on Ubuntu ] (http://www.marcusoft.net/2014/05/mongodb-and-10309-unable-to-createopen.html \'10309 Unable to create/open lock file\')\r\n2. [Getting Started with MongoDB] (http://docs.mongodb.org/manual/tutorial/getting-started/ \'Mongodb Getting Started\')\r\n3. [Install MongoDB on OS X] (http://docs.mongodb.org/manual/tutorial/install-mongodb-on-os-x/ \'Install MongoDB on OS X\')\r\n4. [CAP Theorem: Revisited](http://robertgreiner.com/2014/08/cap-theorem-revisited/ \'CAP Theorem: Revisited\')\r\n5. [Why is MongoDB wildly popular?](http://blog.mongolab.com/2012/08/why-is-mongodb-wildly-popular/ \'Why MongoDB\')\r\n6. [Where does MongoDB stand in CAP Theorem](http://stackoverflow.com/questions/11292215/where-does-mongodb-stand-in-the-cap-theorem \'cap theorem mongodb\')\r\n','2014-10-08 00:48:40','2016-12-22 09:31:42'),(861,'MongoDB Basics Part 2','In this article, we will continue to work with MongoDB by interacting with the MongoDB shell.\r\n\r\nInsert Document\r\n========\r\n---------\r\n\r\nThe db.collection.insert() method inserts new documents to a collection.\r\n\r\n```sh\r\n> db.inventory.insert(\r\n...    {\r\n...      item: \"ABC1\",\r\n...      details: {\r\n...         model: \"14Q3\",\r\n...         manufacturer: \"XYZ Company\"\r\n...      },\r\n...      stock: [ { size: \"S\", qty: 25 }, { size: \"M\", qty: 50 } ],\r\n...      category: \"clothing\"\r\n...    }\r\n... )\r\nWriteResult({ \"nInserted\" : 1 })\r\n```\r\n\r\nThe result is a WriteResult object that shows the number of documents inserted.\r\n\r\nRead Document\r\n========\r\n--------\r\n\r\n```sh\r\n> db.inventory.find()\r\n{ \"_id\" : ObjectId(\"5425a7730b73fd80bdd0724c\"), \"item\" : \"ABC1\",\r\n\"details\" : { \"model\" : \"14Q3\", \"manufacturer\" : \"XYZ Company\" },\r\n\"stock\" : [ { \"size\" : \"S\", \"qty\" : 25 }, { \"size\" : \"M\", \"qty\" : 50 } ], \"category\" : \"clothing\" }\r\n```\r\n\r\nInsert Multiple Documents\r\n===========\r\n-----------\r\n\r\nCreate an array that holds multiple documents to insert.\r\n\r\n```sh\r\n> var mydocuments =\r\n...     [\r\n...       {\r\n...         item: \"ABC2\",\r\n...         details: { model: \"14Q3\", manufacturer: \"M1 Corporation\" },\r\n...         stock: [ { size: \"M\", qty: 50 } ],\r\n...         category: \"clothing\"\r\n...       },\r\n...       {\r\n...         item: \"MNO2\",\r\n...         details: { model: \"14Q3\", manufacturer: \"ABC Company\" },\r\n...         stock: [ { size: \"S\", qty: 5 }, { size: \"M\", qty: 5 }, { size: \"L\", qty: 1 } ],\r\n...         category: \"clothing\"\r\n...       },\r\n...       {\r\n...         item: \"IJK2\",\r\n...         details: { model: \"14Q2\", manufacturer: \"M5 Corporation\" },\r\n...         stock: [ { size: \"S\", qty: 5 }, { size: \"L\", qty: 1 } ],\r\n...         category: \"houseware\"\r\n...       }\r\n...     ];\r\n```\r\n\r\nInsert the documents.\r\n\r\n```sh\r\n> db.inventory.insert(mydocuments)\r\nBulkWriteResult({\r\n\"writeErrors\" : [ ],\r\n\"writeConcernErrors\" : [ ],\r\n\"nInserted\" : 3,\r\n\"nUpserted\" : 0,\r\n\"nMatched\" : 0,\r\n\"nModified\" : 0,\r\n\"nRemoved\" : 0,\r\n\"upserted\" : [ ]\r\n})\r\n```\r\n\r\nQuery Documents\r\n=========\r\n---------\r\n\r\nSelect all documents in a collection.\r\n\r\n```sh\r\n> db.inventory.find()\r\n{ \"_id\" : ObjectId(\"5425a7730b73fd80bdd0724c\"), \"item\" : \"ABC1\",\r\n\"details\" : { \"model\" : \"14Q3\", \"manufacturer\" : \"XYZ Company\" },\r\n\"stock\" : [ { \"size\" : \"S\", \"qty\" : 25 }, { \"size\" : \"M\", \"qty\" : 50 } ], \"category\" : \"clothing\" }\r\n{ \"_id\" : ObjectId(\"5425a9080b73fd80bdd0724d\"), \"item\" : \"ABC2\",\r\n\"details\" : { \"model\" : \"14Q3\", \"manufacturer\" : \"M1 Corporation\" },\r\n\"stock\" : [ { \"size\" : \"M\", \"qty\" : 50 } ], \"category\" : \"clothing\" }\r\n{ \"_id\" : ObjectId(\"5425a9080b73fd80bdd0724e\"), \"item\" : \"MNO2\",\r\n\"details\" : { \"model\" : \"14Q3\", \"manufacturer\" : \"ABC Company\" },\r\n\"stock\" : [ { \"size\" : \"S\", \"qty\" : 5 }, { \"size\" : \"M\", \"qty\" : 5 }, { \"size\" : \"L\", \"qty\" : 1 } ], \"category\" : \"clothing\" }\r\n{ \"_id\" : ObjectId(\"5425a9080b73fd80bdd0724f\"), \"item\" : \"IJK2\",\r\n\"details\" : { \"model\" : \"14Q2\", \"manufacturer\" : \"M5 Corporation\" },\r\n\"stock\" : [ { \"size\" : \"S\", \"qty\" : 5 }, { \"size\" : \"L\", \"qty\" : 1 } ], \"category\" : \"houseware\" }\r\n```\r\n\r\nSpecify Equality Condition\r\n-----------\r\n\r\nTo retrieve from the inventory collection all documents where the category field is houseware:\r\n\r\n```sh\r\n> db.inventory.find({category: \'houseware\'})\r\n{ \"_id\" : ObjectId(\"5425a9080b73fd80bdd0724f\"), \"item\" : \"IJK2\", \"details\" : { \"model\" : \"14Q2\", \"manufacturer\" : \"M5 Corporation\" }, \"stock\" : [ { \"size\" : \"S\", \"qty\" : 5 }, { \"size\" : \"L\", \"qty\" : 1 } ], \"category\" : \"houseware\" }\r\n```\r\n\r\nSpecify Conditions Using Query Operators\r\n-----------\r\n\r\nTo find documents in the inventory collection where the value of category field is either \'houseware\' or \'clothing\'.\r\n\r\n```sh\r\n> db.inventory.find({category: {$in: [\'houseware\', \'clothing\']}})\r\n{ \"_id\" : ObjectId(\"5425a7730b73fd80bdd0724c\"), \"item\" : \"ABC1\", \"details\" : { \"model\" : \"14Q3\", \"manufacturer\" : \"XYZ Company\" }, \"stock\" : [ { \"size\" : \"S\", \"qty\" : 25 }, { \"size\" : \"M\", \"qty\" : 50 } ], \"category\" : \"clothing\" }\r\n{ \"_id\" : ObjectId(\"5425a9080b73fd80bdd0724d\"), \"item\" : \"ABC2\", \"details\" : { \"model\" : \"14Q3\", \"manufacturer\" : \"M1 Corporation\" }, \"stock\" : [ { \"size\" : \"M\", \"qty\" : 50 } ], \"category\" : \"clothing\" }\r\n{ \"_id\" : ObjectId(\"5425a9080b73fd80bdd0724e\"), \"item\" : \"MNO2\", \"details\" : { \"model\" : \"14Q3\", \"manufacturer\" : \"ABC Company\" }, \"stock\" : [ { \"size\" : \"S\", \"qty\" : 5 }, { \"size\" : \"M\", \"qty\" : 5 }, { \"size\" : \"L\", \"qty\" : 1 } ], \"category\" : \"clothing\" }\r\n{ \"_id\" : ObjectId(\"5425a9080b73fd80bdd0724f\"), \"item\" : \"IJK2\", \"details\" : { \"model\" : \"14Q2\", \"manufacturer\" : \"M5 Corporation\" }, \"stock\" : [ { \"size\" : \"S\", \"qty\" : 5 }, { \"size\" : \"L\", \"qty\" : 1 } ], \"category\" : \"houseware\" }\r\n```\r\n\r\nYou can also use $or operator to achieve the same result :\r\n\r\n```sh\r\n> db.inventory.find({ $or: [{ category: \'houseware\'}, {category: \'clothing\'}]})\r\n{ \"_id\" : ObjectId(\"5425a7730b73fd80bdd0724c\"), \"item\" : \"ABC1\", \"details\" : { \"model\" : \"14Q3\", \"manufacturer\" : \"XYZ Company\" }, \"stock\" : [ { \"size\" : \"S\", \"qty\" : 25 }, { \"size\" : \"M\", \"qty\" : 50 } ], \"category\" : \"clothing\" }\r\n{ \"_id\" : ObjectId(\"5425a9080b73fd80bdd0724d\"), \"item\" : \"ABC2\", \"details\" : { \"model\" : \"14Q3\", \"manufacturer\" : \"M1 Corporation\" }, \"stock\" : [ { \"size\" : \"M\", \"qty\" : 50 } ], \"category\" : \"clothing\" }\r\n{ \"_id\" : ObjectId(\"5425a9080b73fd80bdd0724e\"), \"item\" : \"MNO2\", \"details\" : { \"model\" : \"14Q3\", \"manufacturer\" : \"ABC Company\" }, \"stock\" : [ { \"size\" : \"S\", \"qty\" : 5 }, { \"size\" : \"M\", \"qty\" : 5 }, { \"size\" : \"L\", \"qty\" : 1 } ], \"category\" : \"clothing\" }\r\n{ \"_id\" : ObjectId(\"5425a9080b73fd80bdd0724f\"), \"item\" : \"IJK2\", \"details\" : { \"model\" : \"14Q2\", \"manufacturer\" : \"M5 Corporation\" }, \"stock\" : [ { \"size\" : \"S\", \"qty\" : 5 }, { \"size\" : \"L\", \"qty\" : 1 } ], \"category\" : \"houseware\" }\r\n```\r\n\r\nThe $or operator is not preferred when performing equality checks on the same field.\r\n\r\nSpecify AND Conditions\r\n-----------\r\n\r\n```sh\r\n> db.inventory.find({ category: \'houseware\', item: \'IJK2\'} )\r\n{ \"_id\" : ObjectId(\"5425a9080b73fd80bdd0724f\"), \"item\" : \"IJK2\", \"details\" : { \"model\" : \"14Q2\", \"manufacturer\" : \"M5 Corporation\" }, \"stock\" : [ { \"size\" : \"S\", \"qty\" : 5 }, { \"size\" : \"L\", \"qty\" : 1 } ], \"category\" : \"houseware\" }\r\n```\r\n\r\nThis query selects all documents where category is houseware and the item value is IKJ2.\r\n\r\nSpecify OR Conditions\r\n-----------\r\n\r\n```sh\r\n> db.inventory.find(    {      $or: [ { qty: { $gt: 1 } }, { category: \'houseware\' } ]    } )\r\n{ \"_id\" : ObjectId(\"5425a9080b73fd80bdd0724f\"), \"item\" : \"IJK2\", \"details\" : { \"model\" : \"14Q2\", \"manufacturer\" : \"M5 Corporation\" }, \"stock\" : [ { \"size\" : \"S\", \"qty\" : 5 }, { \"size\" : \"L\", \"qty\" : 1 } ], \"category\" : \"houseware\" }\r\n```\r\n\r\nReferences\r\n===========\r\n-----------\r\n\r\n1. [MongoDB Map Reduce](http://docs.mongodb.org/manual/core/map-reduce/ \'MongoDB Map Reduce\')\r\n2. [MongoDB Ruby Driver Tutorial](https://github.com/mongodb/mongo-ruby-driver/wiki/Tutorial \'MongoDB Ruby Driver\')','2014-10-08 02:40:56','2014-10-13 22:43:56'),(871,'The Next 17 Things a Programmer Should Know','Things that did not make the [Top 20 Things a Programmer Should Know] (http://rubyplus.com/articles/811 \'Top 20 Things a Programmer Should Know\') list. Some of the items in this list will not make any sense if you have not read the book. Read the book to get the context.\r\n\r\n1) Beauty is in simplicity. Beauty of style, harmony, grace and good rhythm depends on simplicity.\r\n\r\n2) Comments should say something code does not and cannot say.\r\n\r\n3) Code Layout Matters. Optimize for navigating and reading code. Easy to scan. Expressive layout. Compact format.\r\n\r\n4) The purpose of code reviews should be to share knowledge and establish common coding guidelines.\r\n\r\n5) Encapsulate behavior, not just state. An object encapsulates both state and behavior, where the behavior is defined by the actual state.\r\n\r\n6) Fulfill your ambitions with open source. If you want to get involved, you could offer to help out with the documentation. Volunteer to write test code. You learn much faster by writing test code for other people’s software. Find bugs, suggest fixes, make friends, work on software you like and fulfill your software development ambitions.\r\n\r\n7) How to use a bug tracker. A good bug report conveys three things: \r\n\r\n    a) How to reproduce the bug, as precisely as possible and how often this will make the bug appear.\r\n    b) What should have happened. \r\n    c) What actually happened.\r\n\r\n8) Interprocess communication affects application response time. \r\n\r\n9) Just because the problems are difficult does not mean solutions will be difficult for everyone to understand and maintain.\r\n\r\nThink of every line of code you write as a message for someone in the future. Pretend you’re explaining to this smart person how to solve this tough problem. Can you write code that solves a difficult problem but will also be beautiful? \r\n\r\n10) If you need to explain a change, do so in the version control system check-in message and not in the code. Decouple your code to achieve orthogonality. \r\n\r\n11) Thinking in states. \r\n\r\n12) Read Donald Knuth’s : The Art of Computer Programming\r\n\r\nOne of the developer at work had developed a reporting web application in GO language. He said : I want you to ‘proxy’ the reporting app html output through a Rails app that handling authentication of users. \r\n\r\nI had no idea what he meant by proxing his web app content through the Rails app. What does this reporting app do? It displays reports in an ugly table. By the way it also has table sorting feature and searching by date range. What are you using for the interactive UI? I am using AngularJS. How many users are there for this reporting app? Three internal users. This is not a simple change that can just work. So I asked why not expose this application through http basic authentication applied at the web server?\r\n\r\n13) Decouple your code to achieve orthogonality. \r\n\r\n14) Pay off technical debt as soon as possible.\r\n\r\n15) The Boy Scout Rule. Always check a module in cleaner than when you checked it out.\r\n\r\n16) Learn to estimate.\r\n\r\nEstimate\r\n---------\r\n\r\nAn estimate is an approximate calculation or judgment of the value, number, quantity or extent of something. This definition implies that an estimate is a factual measure based on hard data and previous experience - hopes and wishes must be ignored when calculating it. The definition also implies that, being approximate, and estimate cannot be precise, e.g., a development task cannot be estimated to last 234.14 days.\r\n\r\nTarget\r\n---------\r\n\r\nA target is a statement of a desirable business objective, e.g., ‘The system must support at least 400 concurrent users’.\r\n\r\nCommitment\r\n---------\r\n\r\nA commitment is a promise to deliver specified functionality at a certain level of quality by a certain date or event. Example: The search functionality will be available in the next release of the product.\r\n\r\n>> The primary purpose of software estimation is not to predict a project’s outcome; it is to determine whether a project’s targets are realistic enough to allow the project to be controlled to meet them. \r\n>> Steve McConnell\r\n\r\nThus the purpose of estimation is to make proper project management and planning possible, allowing the project stakeholders to make commitments based on realistic targets.\r\n\r\n17) Writing unit tests provides evidence about how easy the code is to unit test. It helps reveal the presence or absence of good design elements such as low coupling and high cohesion.\r\n\r\nRunning unit tests provides evidence about the code’s behavior. It helps reveal the presence of absence of desirable runtime qualities such as robustness and correctness.\r\n\r\n\r\n**Question from a Pointy Haired Boss**  \r\n\r\nWhy should I write tests that is obvious to me when I look at my code?\r\n\r\n**Answer**\r\n\r\nIt may be obvious to you, since you are very intelligent. Also, you cannot manually eye-ball the entire code base whenever someone makes a change. ','2014-10-08 02:44:34','2014-10-08 02:49:57'),(881,'TDD Basics : Make Your Code Robust','Objective\r\n==========\r\n----------\r\n\r\n- Learn to make the code robust\r\n\r\nDiscussion\r\n==========\r\n----------\r\n\r\nIn the previous article [TDD Beyond Basics : Test Precisely and Concretely](http://rubyplus.com/articles/831 \'TDD Beyond Basics : Test Precisely and Concretely\') we worked on a simple stack implementation that deals with normal cases. To make that code robust, it\'s time to think about cases such as:\r\n\r\n- Extreme cases: 0, negative, null, maximums, etc\r\n- User error: What happens if the user passes in null or a negative value?\r\n\r\nThese cases do not seem to be relevant to our stack example but it\'s a good starting point. So, here is the list of relevant test cases:\r\n\r\n-  A stack is empty on construction\r\n-  After n pushes to an empty stack, n > 0, the stack is not empty and its size is n\r\n-  If one pushes x then pops, the value popped is x.\r\n-  If one pushes x then peeks, the value returned is x, but the size stays the same\r\n-  If the size is n, then after n pops, the stack is empty and has a size 0\r\n-  Popping from an empty stack throws an Exception\r\n-  Peeking into an empty stack throws an Exception\r\n\r\nSteps\r\n=======\r\n-------\r\n\r\nStep 1\r\n-------\r\n\r\n```ruby\r\n  it \'should be empty on construction\' do\r\n    stack = Stack.new\r\n    \r\n    expect(stack.empty?).to be(true)\r\n  end\r\n```\r\n\r\nLet\'s define empty? method to get past \'undefined method empty?\' error.\r\n\r\nStep 2\r\n-------\r\n\r\n```ruby\r\n  def empty?\r\n    @elements.empty?\r\n  end\r\n```\r\n\r\nThe test passes. Split the second test case into two tests in order to test one thing at a time.\r\n\r\nStep 3\r\n-------\r\n\r\n```ruby\r\n  it \'after n pushes to an empty stack, n > 0, the stack is not empty\' do\r\n    \r\n  end\r\n\r\n  it \'after n pushes to an empty stack, n > 0, its size is n\' do\r\n    \r\n  end\r\n```\r\n\r\nStep 4\r\n-------\r\n\r\n```ruby\r\n  it \'after n pushes to an empty stack, n > 0, the stack is not empty\' do\r\n    stack = Stack.new\r\n    stack.push(1)\r\n    stack.push(2)\r\n    \r\n    expect(stack.empty?).to be(false)\r\n  end\r\n```\r\n\r\nThis test passes due to existing implementation.\r\n\r\nStep 5\r\n-------\r\n\r\n```ruby\r\n  it \'after n pushes to an empty stack, n > 0, its size is n\' do\r\n    stack = Stack.new\r\n    stack.push(1)\r\n    stack.push(2)\r\n    \r\n    expect(stack.size).to eq(2)\r\n  end\r\n```\r\n\r\npasses.\r\n\r\nLet\'s update the existing test as follows:\r\n\r\nStep 6\r\n-------\r\n\r\n```ruby\r\n  it \'should push a given item\' do\r\n    stack = Stack.new\r\n	\r\n    stack.push(1)\r\n	\r\n    expect(stack.pop).to eq(1)\r\n  end \r\n```\r\n\r\nHere we only have one assertion. We updated this test to eliminate overlap in the tests.\r\n\r\n\r\nStep 7\r\n-------\r\n\r\n```ruby\r\n  it \'if one pushes x then peeks, the value returned is x, but the size stays the same\' do\r\n    stack = Stack.new\r\n    stack.push(1)\r\n    \r\n    expect(stack.peek).to eq(1)\r\n    expect(stack.size).to eq(1)\r\n  end\r\n```\r\n\r\nThis fails.\r\n\r\n\r\n```ruby\r\n  def peek\r\n    @elements.last\r\n  end\r\n```\r\n\r\nSince I had two assertions, I made the test fail by changing the assertion to eq(2) to make the test fail for the second assertion.\r\n\r\nStep 8\r\n------\r\n\r\n```ruby\r\n  it \'If the size is n, then after n pops, the stack is empty and has a size 0\' do\r\n    stack = Stack.new\r\n    stack.push(1)\r\n    stack.push(2)\r\n    \r\n    stack.pop\r\n    stack.pop\r\n    \r\n    expect(stack.empty?).to be(true)\r\n    expect(stack.size).to eq(0)\r\n  end\r\n```\r\n\r\nExercises\r\n=========\r\n---------\r\n\r\nImplement the last two test cases:\r\n\r\n-  Popping from an empty stack throws an Exception\r\n-  Peeking into an empty stack throws an Exception\r\n\r\nGive clear message in the exception why the failure occurred and how to overcome the failure.\r\n\r\nReferences\r\n==========\r\n----------\r\n\r\n1. Cracking the Coding Interview by Gayle Laakmann McDowell\r\n2. [Stacks](http://cs.lmu.edu/~ray/notes/stacks/ \'Stacks\')','2014-10-08 03:59:52','2014-10-08 03:59:52'),(891,'TDD Basics : Testing computation involving floating-point numbers','Objective\r\n=========\r\n---------\r\n\r\n- Floating-point numbers are not real. \r\n\r\nDiscussion\r\n=========\r\n---------\r\n\r\n>> They are approximation of real numbers, there is inevitably a little error present. This error, called roundoff, can lead to surprising results. You should not use floating-point numbers for financial applications. They are intended for efficient scientific computation.\r\n\r\n>> Tip by Chuck Allison from the book 97 Things a Programmer Should Know\r\n\r\nWe can compare adding two floats as follows:\r\n\r\n```ruby\r\n > (0.25 + 0.79)\r\n => 1.04 \r\n > (0.25 + 0.79) == 1.04\r\n  => true\r\n ```\r\n\r\nYou see that the result of adding these two numbers is a Float:\r\n\r\n```ruby\r\n(139.25 + 74.79).class\r\n => Float \r\n```\r\n\r\nLet\'s now consider this example:\r\n \r\n ```ruby\r\n > 139.25 + 74.79\r\n => 214.04000000000002 \r\n > (139.25 + 74.79)\r\n => 214.04000000000002 \r\n > (139.25 + 74.79) == 214.04\r\n => false \r\n```\r\n\r\nFloats cannot store decimal numbers precisely. If we are interested only in comparing upto two decimal places, we can do so in our test like this:\r\n\r\n```ruby\r\ndescribe \'Float accuracy\' do\r\n  it \'should be within a given decimal places\' do\r\n    x = 139.25\r\n    y = 74.79\r\n    \r\n    expect(x + y).to be_within(0.001).of(214.04)\r\n  end  \r\nend\r\n```\r\n\r\nRun the spec:\r\n\r\n```sh\r\nrspec float_spec.rb\r\n```\r\n\r\nIt will pass.\r\n\r\nReferences\r\n=========\r\n---------\r\n\r\n[Ruby Float quirks] (http://www.rails-troubles.com/2011/12/ruby-float-quirks.html \'Ruby Float quirks\')\r\n[be_within matcher] (https://www.relishapp.com/rspec/rspec-expectations/docs/built-in-matchers/be-within-matcher \'rspec docs\')','2014-10-08 17:42:29','2014-10-22 04:58:05'),(901,'HBase Basics','Discussion\r\n==========\r\n----------\r\n\r\nThis tutorial is based on the [Quick Start - Standalone HBase] (http://hbase.apache.org/book/quickstart.html \'Quick Start - Standalone HBase\') guide. I have explained the difficulties that I encountered when following this guide. The intention is to help you get it up and running quickly, so that you can play with HBase. If you need more explanation for the **Playing with HBase** section, read the HBase quick start guide.\r\n\r\nWhy HBase?\r\n==========\r\n----------\r\n\r\nThe visual guide to NoSQL systems shows you where HBase fits into the CAP theorem triangle:\r\n\r\n![alt text](https://images.rubyplus.com/cap.png \"NoSQL Visual Guide\")\r\n\r\nYou can also read why you would use Apache HBase and its features on its home page : http://hbase.apache.org/\r\n\r\nPrerequisites\r\n=========\r\n---------\r\n\r\nYou need Java 7 for HBase 1.0 version.\r\n\r\nInstallation\r\n=========\r\n---------\r\n\r\nDownload\r\n---------\r\n\r\n1) Go to [Apache Download Mirrors] (http://www.apache.org/dyn/closer.cgi/hbase/ \'Download HBase\') \r\n2) Click on the suggested download link at the top of the page.\r\n3) Click on the stable directory.\r\n4) Download hbase-0.98.6.1-hadoop2-bin.tar.gz file. This corresponds to the Hadoop version 2.\r\n\r\nExtract\r\n---------\r\n\r\n```sh\r\n$tar xzvf hbase-0.98.6.1-hadoop2-bin.tar.gz\r\n$cd hbase-0.98.6.1-hadoop2-bin\r\n```\r\n\r\nConfigure\r\n---------\r\n\r\n1) Edit conf/hbase-env.sh, uncomment JAVA_HOME and set it to the appropriate location for your machine.\r\n\r\n```sh\r\n$which java\r\n/usr/bin/java\r\n```\r\n\r\n```sh\r\nexport JAVA_HOME=/usr\r\n```\r\n\r\nYes, it\'s twisted and it will crash when you start the server. \r\n\r\n```sh\r\n~/Downloads/hbase-0.98.6.1-hadoop2 $bin/start-hbase.sh\r\n/Users/bparanj/Downloads/hbase-0.98.6.1-hadoop2/bin/hbase: line 386: /usr/bin/java/bin/java: Not a directory\r\n/Users/bparanj/Downloads/hbase-0.98.6.1-hadoop2/bin/hbase: line 386: exec: /usr/bin/java/bin/java: cannot execute: Not a directory\r\n/Users/bparanj/Downloads/hbase-0.98.6.1-hadoop2/bin/hbase: line 386: /usr/bin/java/bin/java: Not a directory\r\n/Users/bparanj/Downloads/hbase-0.98.6.1-hadoop2/bin/hbase: line 386: exec: /usr/bin/java/bin/java: cannot execute: Not a directory\r\nstarting master, logging to /Users/bparanj/Downloads/hbase-0.98.6.1-hadoop2/bin/../logs/hbase-bparanj-master-Millions.local.out\r\n/Users/bparanj/Downloads/hbase-0.98.6.1-hadoop2/bin/../bin/hbase: line 386: /usr/bin/java/bin/java: Not a directory\r\n/Users/bparanj/Downloads/hbase-0.98.6.1-hadoop2/bin/../bin/hbase: line 386: exec: /usr/bin/java/bin/java: cannot execute: Not a directory\r\nlocalhost: ssh: connect to host localhost port 22: Connection refused\r\n```\r\n\r\nJust specify /usr and not the entire path to java. For some reason even that does not work but it uses system-provided Java on Mac OS 10.9.4.\r\n\r\n2) Edit conf/hbase-site.xml and specify the directory to store data.\r\n\r\n```xml\r\n<configuration>\r\n  <property>\r\n    <name>hbase.rootdir</name>\r\n    <value>file:///home/user/hbase</value>\r\n  </property>\r\n  <property>\r\n    <name>hbase.zookeeper.property.dataDir</name>\r\n    <value>/home/user/zookeeper</value>\r\n  </property>\r\n</configuration>     \r\n```\r\n\r\nDo not create this directory. For explanation on why, read: http://hbase.apache.org/book/quickstart.html#d4063e153. This is not user friendly.\r\n\r\nStart HBase\r\n===========\r\n-----------\r\n\r\nRun bin/start-hbase.sh script to start the server.\r\n\r\n```sh\r\n~/Downloads/hbase-0.98.6.1-hadoop2 $bin/start-hbase.sh\r\nUnable to find a $JAVA_HOME at \"/usr\", continuing with system-provided Java...\r\nstarting master, logging to /Users/bparanj/Downloads/hbase-0.98.6.1-hadoop2/bin/../logs/hbase-bparanj-master-Millions.local.out\r\nUnable to find a $JAVA_HOME at \"/usr\", continuing with system-provided Java...\r\n```\r\n\r\nVerify if the server is running.\r\n\r\n```sh\r\n$jps\r\n16079 Jps\r\n15653 HMaster\r\n```\r\n\r\nWe see HMaster process running. So HBase server is now running.\r\n\r\nPlaying with HBase\r\n===========\r\n-----------\r\n\r\nConnect to HBase\r\n-----------------\r\n\r\nHBase console:\r\n\r\n```sh\r\n~/Downloads/hbase-0.98.6.1-hadoop2 $bin/hbase shell\r\nUnable to find a $JAVA_HOME at \"/usr\", continuing with system-provided Java...\r\n2014-10-09 11:00:29,079 INFO  [main] Configuration.deprecation: hadoop.native.lib is deprecated. Instead, use io.native.lib.available\r\nHBase Shell; enter \'help<RETURN>\' for list of supported commands.\r\nType \"exit<RETURN>\" to leave the HBase Shell\r\nVersion 0.98.6.1-hadoop2, r96a1af660b33879f19a47e9113bf802ad59c7146, Sun Sep 14 21:27:25 PDT 2014\r\n```\r\n\r\nCheck Version\r\n-----------------\r\n\r\n```sh\r\n1.8.7-p357 :002 >   version\r\n0.98.6.1-hadoop2, r96a1af660b33879f19a47e9113bf802ad59c7146, Sun Sep 14 21:27:25 PDT 2014\r\n```\r\n\r\nCheck Server Status\r\n-----------------\r\n\r\nInstead of using jps command in the terminal, you can also use the status command in the hbase shell.\r\n\r\n```sh\r\n1.8.7-p357 :003 > status\r\n2014-10-09 14:23:00.873 java[33633:d0f] Unable to load realm info from SCDynamicStore\r\n2014-10-09 14:23:16,363 WARN  [main] util.NativeCodeLoader: Unable to load native-hadoop library for your platform... using builtin-java classes where applicable\r\n1 servers, 0 dead, 2.0000 average load\r\n```\r\n\r\nGetting Help\r\n-----------------\r\n\r\n```sh\r\n1.8.7-p357 :001 > help\r\nHBase Shell, version 0.98.6.1-hadoop2, r96a1af660b33879f19a47e9113bf802ad59c7146, Sun Sep 14 21:27:25 PDT 2014\r\nType \'help \"COMMAND\"\', (e.g. \'help \"get\"\' -- the quotes are necessary) for help on a specific command.\r\nCommands are grouped. Type \'help \"COMMAND_GROUP\"\', (e.g. \'help \"general\"\') for help on a command group.\r\n```\r\n\r\nCreate a Table\r\n-----------------\r\n\r\n```sh\r\n1.8.7-p357 :003 >   create \'test\', \'cf\'\r\n2014-10-09 11:02:21.435 java[17305:1407] Unable to load realm info from SCDynamicStore\r\n2014-10-09 11:02:22,164 WARN  [main] util.NativeCodeLoader: Unable to load native-hadoop library for your platform... using builtin-java classes where applicable\r\n0 row(s) in 4.0640 seconds\r\n\r\n => Hbase::Table - test \r\n ```\r\n\r\nList Details about a Table\r\n-----------------\r\n \r\n```sh\r\n1.8.7-p357 :004 > list \'test\'\r\nTABLE                                                                                                                                                             \r\ntest                                                                                                                                                              \r\n1 row(s) in 0.0650 seconds\r\n\r\n=> [\"test\"] \r\n```\r\n\r\nPopulate Data\r\n-----------------\r\n\r\nThe put command is used to put data into table.\r\n\r\n```sh\r\n1.8.7-p357 :005 > put \'test\', \'row1\', \'cf:a\', \'value1\'\r\n0 row(s) in 0.2750 seconds\r\n\r\n1.8.7-p357 :006 > put \'test\', \'row2\', \'cf:b\', \'value2\'\r\n0 row(s) in 0.0090 seconds\r\n\r\n1.8.7-p357 :007 > put \'test\', \'row3\', \'cf:c\', \'value3\'\r\n0 row(s) in 0.0110 seconds\r\n```\r\n\r\nView All Data at Once\r\n-----------------\r\n\r\n```sh\r\n1.8.7-p357 :008 > scan \'test\'\r\nROW                                       COLUMN+CELL                                                                                                             \r\n row1                                     column=cf:a, timestamp=1412877863749, value=value1                                                                      \r\n row2                                     column=cf:b, timestamp=1412877877347, value=value2                                                                      \r\n row3                                     column=cf:c, timestamp=1412877889991, value=value3                                                                      \r\n3 row(s) in 0.0810 seconds\r\n```\r\n\r\nGet a Single Row \r\n-----------------\r\n\r\n```sh\r\n1.8.7-p357 :009 > get \'test\', \'row1\'\r\nCOLUMN                                    CELL                                                                                                                    \r\n cf:a                                     timestamp=1412877863749, value=value1                                                                                   \r\n1 row(s) in 0.0250 seconds\r\n```\r\n\r\nDisable a Table\r\n-----------------\r\n\r\n```sh\r\n1.8.7-p357 :010 > disable \'test\'\r\n0 row(s) in 1.3810 seconds\r\n```\r\n\r\n```sh\r\n1.8.7-p357 :011 > get \'test\', \'row1\'\r\nCOLUMN                                    CELL                                                                                                                    \r\n\r\nERROR: test is disabled.\r\n```\r\n\r\nEnable a Table\r\n-----------------\r\n\r\n```sh\r\n1.8.7-p357 :012 > enable \'test\'\r\n0 row(s) in 0.3170 seconds\r\n```\r\n\r\n```sh\r\n1.8.7-p357 :013 > get \'test\', \'row1\'\r\nCOLUMN                                    CELL                                                                                                                    \r\n cf:a                                     timestamp=1412877863749, value=value1                                                                                   \r\n1 row(s) in 0.0180 seconds\r\n```\r\n\r\nDelete a Table\r\n-----------------\r\n\r\n```sh\r\n1.8.7-p357 :014 > drop \'test\'\r\n\r\nERROR: Table test is enabled. Disable it first.\'\r\n\r\nHere is some help for this command:\r\nDrop the named table. Table must first be disabled:\r\n  hbase> drop \'t1\'\r\n  hbase> drop \'ns1:t1\'\r\n```\r\n\r\n```sh\r\n1.8.7-p357 :015 > disable \'test\'\r\n0 row(s) in 1.3160 seconds\r\n\r\n1.8.7-p357 :016 > drop \'test\'\r\n0 row(s) in 0.2100 seconds\r\n```\r\n\r\n```sh\r\n1.8.7-p357 :017 > scan \'test\'\r\nROW                                       COLUMN+CELL                                                                                                             \r\n\r\nERROR: Unknown table test!\r\n```\r\n\r\nExit the Console\r\n-----------------\r\n\r\n```sh\r\n1.8.7-p357 :018 > quit\r\n```\r\n\r\nStop the Server\r\n-----------------\r\n\r\n```sh\r\n~/Downloads/hbase-0.98.6.1-hadoop2 $bin/stop-hbase.sh\r\nstopping hbase............................\r\nUnable to find a $JAVA_HOME at \"/usr\", continuing with system-provided Java...\r\n```\r\n\r\nSummary\r\n=======\r\n-------\r\n\r\nIn this article we installed HBase and played in the console to create a table, insert records, retrieve record and view all data. I found HBase easier to install, configure and get it working than Riak.\r\n\r\nReferences\r\n=========\r\n----------\r\n\r\n1) [Quick Start - Standalone HBase] (http://hbase.apache.org/book/quickstart.html \'Standalone HBase\')\r\n2) Seven Databases in Seven Weeks by Eric Redmond and Jim R. Wilson','2014-10-09 18:24:59','2016-12-22 09:35:13'),(911,'TDD Basics : Base Conversion ','Objective\r\n========\r\n------------------\r\n\r\n- Learn the consequence of not cleaning up in the refactor phase.\r\n\r\nPrerequisites\r\n===========\r\n------------------\r\n\r\n- Read the article on GCD if you want to refresh your memory on [reduction](https://rubyplus.com/articles/481-TDD-Beyond-Basics-Greatest-Common-Divisor \'reduction\')\r\n\r\n- Read these articles to learn about terminating condition:\r\n\r\n1) [TDD Basics : The Sieve of Erastosthenes] (https://rubyplus.com/articles/471-TDD-Basics-The-Sieve-of-Erastosthenes \'The Sieve of Erastosthenes\')\r\n2) [Facotrial] (https://rubyplus.com/articles/441-TDD-Beyond-Basics-Factorial-Kata \'Facotrial\')\r\n3) [TDD Basics : Reverse the Digits of an Integer] (https://rubyplus.com/articles/581-TDD-Basics-Reverse-the-Digits-of-an-Integer \'Reverse\')\r\n4) [TDD Advanced Concepts : Sum Kata] (https://rubyplus.com/articles/431-TDD-Advanced-Concepts-Sum-Kata \'Sum Kata\')\r\n\r\nProblem Statement\r\n==================\r\n------------------\r\n\r\nConvert a decimal integer to octal representation. \r\n\r\nProblem Domain Analysis\r\n==================\r\n------------------\r\n\r\n```sh\r\n(891) in base 10 = ? in base 8\r\n```\r\n\r\n![alt text](https://images.rubyplus.com/problem-octal.png \"Octal Problem\")\r\n\r\nSolution Domain Analysis\r\n==================\r\n------------------\r\n\r\nStep 1\r\n-----\r\n\r\n![alt text](https://images.rubyplus.com/sda-octal-1.png \"Octal Problem\")\r\n\r\nStep 2\r\n-----\r\n\r\n![alt text](https://images.rubyplus.com/sda-octal-2.png \"Octal Problem\")\r\n\r\n\r\nStep 3\r\n-----\r\n\r\n![alt text](https://images.rubyplus.com/sda-octal-3.png \"Octal Problem\")\r\n\r\nStep 4\r\n-----\r\n\r\n![alt text](https://images.rubyplus.com/sda-octal-4.png \"Octal Problem\")\r\n\r\nStep 5\r\n-----\r\n\r\n![alt text](https://images.rubyplus.com/sda-octal.png \"Octal Problem\")\r\n\r\nStep 6\r\n-----\r\n\r\n![alt text](https://images.rubyplus.com/sda-octal2.png \"Octal Problem\")\r\n\r\n\r\nAlgorithm\r\n=========\r\n---------\r\n\r\nThis will use the concept of reduction to reach the terminating condition. The terminating condition is reached when the remainder becomes less than 8. \r\n\r\n1) Find the remainder of the given number by using mod 8. This is first digit of the new base.\r\n2) Divide the given number by 8, the reduced number becomes the new quotient.\r\n3) The two steps are repeated until the reduced quotient becomes < 8.\r\n\r\nStep 2 is the reduction step.\r\n\r\nCode\r\n=====\r\n------\r\n\r\nThe implementation is trivial until we hit the number 8.\r\n\r\n```ruby\r\ndescribe OctalConverter do\r\n  it \'should return 1 for 1\' do\r\n    converter = OctalConverter.new(1)\r\n    \r\n    expect(converter.result).to eq(1)\r\n  end\r\n\r\n  it \'should return 2 for 2\' do\r\n    converter = OctalConverter.new(2)\r\n    \r\n    expect(converter.result).to eq(2)\r\n  end\r\n  \r\n  it \'should return 10 for 8\' do\r\n    converter = OctalConverter.new(8)\r\n    \r\n    expect(converter.result).to eq(10)    \r\n  end\r\nend\r\n```\r\n\r\nThe current implementation that fails :\r\n\r\n```ruby\r\nclass OctalConverter\r\n  def initialize(number)\r\n    @number = number\r\n  end\r\n  \r\n  def result\r\n    if @number < 8\r\n      @number\r\n    else\r\n      remainder = @number % 8\r\n      @number = @number / 8 \r\n    end\r\n  end\r\nend\r\n```\r\n\r\nThis brings up a question. The converter takes a decimal number as it\'s argument so the what is the base of the converted number? It should be 8. How do you return a value that is octal base? Let\'s store the digits of the octal number in an array and return that as the result. Here is the implementation that works for the third test case:\r\n\r\n```ruby\r\nclass OctalConverter\r\n  def initialize(number)\r\n    @number = number\r\n  end\r\n  \r\n  def result\r\n    if @number < 8\r\n      [@number]\r\n    else\r\n      remainder = @number % 8\r\n      @number = @number / 8 \r\n      octal = [@number, remainder]\r\n    end\r\n  end\r\nend\r\n\r\ndescribe OctalConverter do\r\n  it \'should return 1 for 1\' do\r\n    converter = OctalConverter.new(1)\r\n    \r\n    expect(converter.result).to eq([1])\r\n  end\r\n\r\n  it \'should return 2 for 2\' do\r\n    converter = OctalConverter.new(2)\r\n    \r\n    expect(converter.result).to eq([2])\r\n  end\r\n  \r\n  it \'should return 10 for 8\' do\r\n    converter = OctalConverter.new(8)\r\n    \r\n    expect(converter.result).to eq([1,0])    \r\n  end\r\nend\r\n```\r\n\r\nThe current logic works until we hit a number that needs to generate three digits for the octal number.\r\n\r\n```ruby\r\n  it \'should return 137 for 95\' do\r\n    converter = OctalConverter.new(95)\r\n    \r\n    expect(converter.result).to eq([1,3, 7])    \r\n  end\r\n```\r\n\r\nThe failure message is :\r\n\r\n```sh\r\nexpected: [1, 3, 7]\r\n  got: [11, 7]\r\n```\r\n\r\nAfter some print statements and thinking through the logic, here is the solution that works for the fifth test case:\r\n\r\n```ruby\r\nclass OctalConverter\r\n  def initialize(number)\r\n    @number = number\r\n  end\r\n  \r\n  def result\r\n    octal = []\r\n    if @number < 8\r\n      octal << @number\r\n    else\r\n      \r\n      if (@number % 8) == 0\r\n        remainder = @number % 8\r\n        @number = @number / 8 \r\n        \r\n        octal << @number\r\n        octal << remainder\r\n      end\r\n      \r\n      until remainder == 0\r\n        remainder = @number % 8\r\n        @number = @number / 8 \r\n        octal << remainder unless remainder == 0\r\n        \r\n        octal.sort!\r\n      end\r\n      octal\r\n    end\r\n  end\r\nend\r\n\r\n\r\ndescribe OctalConverter do\r\n  it \'should return 1 for 1\' do\r\n    converter = OctalConverter.new(1)\r\n    \r\n    expect(converter.result).to eq([1])\r\n  end\r\n\r\n  it \'should return 2 for 2\' do\r\n    converter = OctalConverter.new(2)\r\n    \r\n    expect(converter.result).to eq([2])\r\n  end\r\n  \r\n  it \'should return 10 for 8\' do\r\n    converter = OctalConverter.new(8)\r\n    \r\n    expect(converter.result).to eq([1,0])    \r\n  end\r\n  \r\n  it \'should return 20 for 16\' do\r\n    converter = OctalConverter.new(16)\r\n    \r\n    expect(converter.result).to eq([2,0])    \r\n  end\r\n  \r\n  it \'should return 137 for 95\' do\r\n    converter = OctalConverter.new(95)\r\n    \r\n    expect(converter.result).to eq([1, 3, 7])    \r\n  end\r\n    \r\nend\r\n```\r\n\r\nOnce I got the right terminating condition, the ugliness in the solution was reduced by the following solution:\r\n\r\n```ruby\r\nclass OctalConverter\r\n  def initialize(number)\r\n    @number = number\r\n  end\r\n  \r\n  def result\r\n    octal = []\r\n    if @number < 8\r\n      octal << @number\r\n    else\r\n      \r\n      until @number == 0\r\n        remainder = @number % 8\r\n        @number = @number / 8 \r\n        octal.unshift(remainder)\r\n      end\r\n      \r\n      octal\r\n    end\r\n  end\r\n  \r\nend\r\n\r\ndescribe OctalConverter do\r\n  it \'should return 1 for 1\' do\r\n    converter = OctalConverter.new(1)\r\n    \r\n    expect(converter.result).to eq([1])\r\n  end\r\n\r\n  it \'should return 2 for 2\' do\r\n    converter = OctalConverter.new(2)\r\n    \r\n    expect(converter.result).to eq([2])\r\n  end\r\n  \r\n  it \'should return 10 for 8\' do\r\n    converter = OctalConverter.new(8)\r\n    \r\n    expect(converter.result).to eq([1,0])    \r\n  end\r\n  \r\n  it \'should return 20 for 16\' do\r\n    converter = OctalConverter.new(16)\r\n    \r\n    expect(converter.result).to eq([2,0])    \r\n  end\r\n  \r\n  it \'should return 137 for 95\' do\r\n    converter = OctalConverter.new(95)\r\n    \r\n    expect(converter.result).to eq([1, 3, 7])    \r\n  end\r\n  \r\n  it \'should return 4000 for 2048\' do\r\n    converter = OctalConverter.new(2048)\r\n    \r\n    expect(converter.result).to eq([4, 0, 0, 0])    \r\n  end\r\n  \r\nend\r\n```\r\n\r\nSurprisingly the last test (an acceptance test) also passes when it is uncommented. This is a very good example how cleaning up the code in refactoring stage allows us to handle more complicated test cases. Here is the final refactored solution:\r\n\r\n```ruby\r\nclass OctalConverter\r\n  def initialize(number)\r\n    @number = number\r\n  end\r\n  \r\n  def result\r\n    octal = []\r\n    until finished?\r\n      digit = extract_octal_digit\r\n      reduce\r\n        \r\n      octal.unshift(digit)\r\n    end\r\n      \r\n    octal\r\n  end\r\n  \r\n  private\r\n  \r\n  def extract_octal_digit\r\n    @number % 8\r\n  end\r\n  \r\n  def reduce\r\n    @number = @number / 8 \r\n  end\r\n  \r\n  def finished?\r\n    @number == 0\r\n  end\r\nend\r\n```\r\n\r\nReferences\r\n=========\r\n---------\r\n\r\n1. How to Solve it Using Computer by R.G. Dromney\r\n2. [Decimal to Octal Converter](http://www.binaryhexconverter.com/decimal-to-octal-converter \'Decimal to Octal Converter\')','2014-10-10 01:47:24','2016-12-22 09:41:02'),(921,'CouchDB Basics','Why CouchDB?\r\n=============\r\n-------------\r\n\r\nHere is a visual guide to NoSQL systems:\r\n\r\n![alt text](https://images.rubyplus.com/cap.png \"NoSQL Visual Guide\")\r\n\r\nYou can see that CouchDB has picked availability and partition tolerance. This diagram also gives you a good big picture view of how different NoSQL databases fit in the CAP triangle.\r\n\r\nInstallation\r\n=============\r\n-------------\r\n\r\nHere is the installation instructions for Mac using the Apache CouchDB native application. \r\n\r\n1) Download from Apache website:\r\nhttp://www.apache.org/dyn/closer.cgi?path=/couchdb/binary/mac/1.6.1/Apache-CouchDB-1.6.1.zip\r\n2) Unzip the Apache-CouchDB-1.6.1.zip file.\r\n3) Move the unzipped \'Apache CouchDB\' to Applications folder.\r\n\r\nRun CouchDB\r\n===========\r\n-----------\r\n\r\nClick on the \'Apache CouchDB\' application in the Applications folder. It will open the CouchDB admin interface in the browser `http://localhost:5984/_utils/`. We will play with Futon admin web interface later. For now, let\'s interact with CouchDB from a terminal using Curl command.\r\n\r\nWelcome CouchDB\r\n-------------\r\n\r\n```sh\r\n$curl http://127.0.0.1:5984\r\n{\"couchdb\":\"Welcome\",\"uuid\":\"d53285f595c9133f3ba9e5599b951410\",\"version\":\"1.6.1\",\"vendor\":{\"version\":\"1.6.1-1\",\"name\":\"Homebrew\"}}\r\n```\r\n\r\nList All Databases\r\n------------------\r\n\r\n```sh\r\n$curl -X GET http://127.0.0.1:5984/_all_dbs\r\n[\"_replicator\",\"_users\",\"test_suite_db\",\"test_suite_db2\"]\r\n```\r\n\r\nCreate a Database\r\n-----------------\r\n\r\n```sh\r\n$curl -X PUT http://127.0.0.1:5984/espresso\r\n{\"ok\":true}\r\n$curl -X GET http://127.0.0.1:5984/_all_dbs\r\n[\"_replicator\",\"_users\",\"espresso\",\"test_suite_db\",\"test_suite_db2\"]\r\n```\r\n\r\nIf you create a database that already exists:\r\n\r\n```sh\r\n$curl -X PUT http://127.0.0.1:5984/espresso\r\n{\"error\":\"file_exists\",\"reason\":\"The database could not be created, the file already exists.\"}\r\n```\r\n\r\nDelete a Database\r\n-----------------\r\n\r\nLet\'s create a new database called wave, view all the databases and delete the new database wave.\r\n\r\n```sh\r\n$curl -X PUT http://127.0.0.1:5984/wave\r\n{\"ok\":true}\r\n$curl -X GET http://127.0.0.1:5984/_all_dbs\r\n[\"_replicator\",\"_users\",\"espresso\",\"test_suite_db\",\"test_suite_db2\",\"wave\"]\r\n$curl -X DELETE http://127.0.0.1:5984/wave\r\n{\"ok\":true}\r\n$curl -X GET http://127.0.0.1:5984/_all_dbs\r\n[\"_replicator\",\"_users\",\"espresso\",\"test_suite_db\",\"test_suite_db2\"]\r\n```\r\n\r\nFuton Interface\r\n===========\r\n-----------\r\n\r\nGo to `http://localhost:5984/_utils/` URL in a browser. Click \'Verify Installation\' link. Follow the [quick tour](http://guide.couchdb.org/draft/tour.html \'Futon tour\'). The only difference is that this version of CouchDB will show you _rev only after you save the document. \r\n\r\nThe web interface has changed for this version of CouchDB, so you will not be able to follow the instructions for \'Running a Query using MapReduce\'. However you will be able to follow the instructions for \'Triggering Replication\'.\r\n\r\nThe beam.smp process was using 80% of CPU and my MacBook Pro fan was spinning loudly with lot of heat from the laptop. Just go to activity monitor and kill the beam.smp process your laptop will get back to normal within a few minutes. I had to kill two beam.smp processes that had taken over most of the CPU time. After killing both processes, since CouchDB was still running it created a new beam.smp process that did not create any problems. I was able to interact with CouchDB.\r\n\r\nSummary\r\n===========\r\n-----------\r\n\r\nI found CouchDB easy to install and play with it from a terminal. It uses a standard HTTP verbs to interact with the CouchDB server. It would be a great fit for developing your own [ESCAPE](https://code.google.com/p/escservesconfig/ \'ESCAPE\') server for serving configuration information. CouchDB picks availability and partition tolerance. Since consistency is not issue for this type of applications, it\'s a great fit. \r\n\r\nReferences\r\n===========\r\n-----------\r\n\r\n1) [Installation on Mac OS X](http://docs.couchdb.org/en/1.6.1/install/mac.html \'CouchDB Installation\')\r\n2) [CouchDB Definitive Guide] (http://guide.couchdb.org/draft/tour.html \'CouchDB Definitive Guide\')\r\n3) Continuous Delivery: Reliable Software Releases through Build, Test, and Deployment Automation by Jez Humble and David Farley \r\n4) Diagram from [Stack Exchange](http://stackexchange.com/ \'stack exchange\')\r\n5) [Runaway applications can shorten battery runtime, affect performance, and increase heat and fan activity](http://support.apple.com/kb/TS1473 \'High Heat, Fan noise in Mac OS\')','2014-10-10 19:36:18','2016-12-22 09:43:03'),(931,'MongoDB Ruby Driver Tutorial','Installation\r\n============\r\n------------\r\n\r\n```sh\r\n$gem install mongo\r\nFetching: bson-1.11.1.gem (100%)\r\nSuccessfully installed bson-1.11.1\r\nFetching: mongo-1.11.1.gem (100%)\r\nSuccessfully installed mongo-1.11.1\r\n2 gems installed\r\n```\r\n\r\nLet\'s use it in irb.\r\n\r\n```ruby\r\n$irb\r\n> require \'mongo\'\r\n      ** Notice: The native BSON extension was not loaded. **\r\n\r\n      For optimal performance, use of the BSON extension is recommended.\r\n\r\n      To enable the extension make sure ENV[\'BSON_EXT_DISABLED\'] is not set\r\n      and run the following command:\r\n\r\n        gem install bson_ext\r\n\r\n      If you continue to receive this message after installing, make sure that\r\n      the bson_ext gem is in your load path.\r\n => true \r\n```\r\n\r\nFor improved performance:\r\n\r\n```sh\r\n$gem install bson_ext\r\nFetching: bson_ext-1.11.1.gem (100%)\r\nBuilding native extensions.  This could take a while...\r\nSuccessfully installed bson_ext-1.11.1\r\n1 gem installed\r\n```\r\n\r\nUsing the Gem\r\n============\r\n------------\r\n\r\n\r\n```sh\r\n$irb\r\n> require \'mongo\'\r\n => true \r\n```\r\n\r\nCreating a Database Client\r\n============\r\n------------\r\n\r\n\r\n```ruby\r\nmongo_client = MongoClient.new(\'localhost\', 27017)\r\nMongo::ConnectionFailure: Failed to connect to a master node at localhost:27017\r\n```\r\n\r\nLet\'s start the server.\r\n\r\n```sh\r\n$mongod\r\nmongod --help for help and startup options\r\nSat Oct 11 15:06:47 MongoDB starting : pid=61878 port=27017 dbpath=/data/db/ 64-bit \r\nSat Oct 11 15:06:47 db version v1.6.2, pdfile version 4.5\r\nSat Oct 11 15:06:47 git version: aef371ecf5d2a824f16ccdc3b745f3702165602f\r\nSat Oct 11 15:06:47 sys info: Darwin erh2.10gen.cc 9.6.0 Darwin Kernel Version 9.6.0: Mon Nov 24 17:37:00 PST 2008; root:xnu-1228.9.59~1/RELEASE_I386 i386 BOOST_LIB_VERSION=1_37\r\nSat Oct 11 15:06:47 exception in initAndListen std::exception: dbpath (/data/db/) does not exist, terminating\r\nSat Oct 11 15:06:47  dbexit: \r\n\r\nSat Oct 11 15:06:47 	 shutdown: going to close listening sockets...\r\nSat Oct 11 15:06:47 	 shutdown: going to flush oplog...\r\nSat Oct 11 15:06:47 	 shutdown: going to close sockets...\r\nSat Oct 11 15:06:47 	 shutdown: waiting for fs preallocator...\r\nSat Oct 11 15:06:47 	 shutdown: closing all files...\r\nSat Oct 11 15:06:47      closeAllFiles() finished\r\n\r\nSat Oct 11 15:06:47  dbexit: really exiting now\r\n```\r\n\r\nTo resolve this problem, I created /data/db directory manually. Now, mongod brings up the MongoDB server.\r\n\r\n```sh\r\n~ $mongod\r\nmongod --help for help and startup options\r\nSat Oct 11 15:09:03 MongoDB starting : pid=62610 port=27017 dbpath=/data/db/ 64-bit \r\nSat Oct 11 15:09:03 db version v1.6.2, pdfile version 4.5\r\nSat Oct 11 15:09:03 git version: aef371ecf5d2a824f16ccdc3b745f3702165602f\r\nSat Oct 11 15:09:03 sys info: Darwin erh2.10gen.cc 9.6.0 Darwin Kernel Version 9.6.0: Mon Nov 24 17:37:00 PST 2008; root:xnu-1228.9.59~1/RELEASE_I386 i386 BOOST_LIB_VERSION=1_37\r\nSat Oct 11 15:09:03 [initandlisten] waiting for connections on port 27017\r\nSat Oct 11 15:09:03 [websvr] web admin interface listening on port 28017\r\n```\r\n\r\nLet\'s create a connection to the server.\r\n\r\n```ruby\r\n> mongo_client = MongoClient.new(\'localhost\', 27017)\r\n => #<Mongo::MongoClient:0x00000101312318 @host=\"localhost\", @port=27017, \r\n => [\"admin\", \"local\"] \r\n> mongo_client.database_info.each {|info| puts info.inspect}\r\n[\"admin\", 1]\r\n[\"local\", 1]\r\n => {\"admin\"=>1, \"local\"=>1} \r\n```\r\n\r\nHere you see the database sizes in bytes.\r\n\r\nCreate a New Database\r\n============\r\n------------\r\n\r\n```ruby\r\n> db = mongo_client.db(\'mydb\')\r\n```\r\n\r\nUsing a Collection\r\n============\r\n------------\r\n \r\n```ruby\r\n> coll = mydb_conn.collection(\'testCollection\')\r\n```\r\n\r\nThe collection method provides you with a collection object. This is used to interact with the persistent storage.\r\n\r\nInsert Document\r\n============\r\n------------ \r\n\r\n```ruby\r\n> doc = {\'name\' => \'MongoDB\', \'type\' => \'database\', \'count\' => 1, \'info\' => {\'x\' => 203, \'y\' => \'102\'}}\r\n => {\"name\"=>\"MongoDB\", \"type\"=>\"database\", \"count\"=>1, \"info\"=>{\"x\"=>203, \"y\"=>\"102\"}} \r\n> id = coll.insert(doc)\r\n => BSON::ObjectId(\'5439ac843a10e7ef65000001\') \r\n```\r\n\r\nRetrieve Collections\r\n============\r\n------------\r\n\r\n```ruby\r\n> mydb_conn.collection_names\r\n => [\"testCollection\", \"system.indexes\"] \r\n```\r\n\r\nInsert Multiple Documents\r\n============\r\n------------\r\n\r\n```ruby\r\n> 100.times {|i| coll.insert(\'i\' => i)}\r\n => 100 \r\n```\r\n \r\nFinding a Document\r\n============\r\n------------\r\n\r\n```ruby\r\n> coll.find_one\r\n => {\"_id\"=>BSON::ObjectId(\'5439ac843a10e7ef65000001\'), \"name\"=>\"MongoDB\", \"type\"=>\"database\", \"count\"=>1, \"info\"=>{\"x\"=>203, \"y\"=>\"102\"}} \r\n```\r\n\r\n```ruby\r\n > coll.find.each {|row| puts row.inspect}\r\n{\"_id\"=>BSON::ObjectId(\'5439ac843a10e7ef65000001\'), \"name\"=>\"MongoDB\", \"type\"=>\"database\", \"count\"=>1, \"info\"=>{\"x\"=>203, \"y\"=>\"102\"}}\r\n{\"_id\"=>BSON::ObjectId(\'5439ae2b3a10e7ef65000002\'), \"i\"=>0}\r\n{\"_id\"=>BSON::ObjectId(\'5439ae2b3a10e7ef65000003\'), \"i\"=>1}\r\n{\"_id\"=>BSON::ObjectId(\'5439ae2b3a10e7ef65000004\'), \"i\"=>2}\r\n{\"_id\"=>BSON::ObjectId(\'5439ae2b3a10e7ef65000005\'), \"i\"=>3}\r\n{\"_id\"=>BSON::ObjectId(\'5439ae2b3a10e7ef65000006\'), \"i\"=>4}\r\n{\"_id\"=>BSON::ObjectId(\'5439ae2b3a10e7ef65000007\'), \"i\"=>5}\r\n{\"_id\"=>BSON::ObjectId(\'5439ae2b3a10e7ef65000008\'), \"i\"=>6}\r\n```\r\n\r\nOutput goes till i => 100.\r\n\r\n\r\nSpecific Query\r\n============\r\n------------\r\n\r\n```ruby\r\n> id\r\n => BSON::ObjectId(\'5439ac843a10e7ef65000001\') \r\n```\r\n\r\n```ruby\r\n > coll.find(\'_id\' => id).to_a\r\n => [{\"_id\"=>BSON::ObjectId(\'5439ac843a10e7ef65000001\'), \"name\"=>\"MongoDB\", \"type\"=>\"database\", \"count\"=>1, \"info\"=>{\"x\"=>203, \"y\"=>\"102\"}}] \r\n```\r\n\r\nSorting Documents\r\n============\r\n------------\r\n\r\n```ruby\r\n> coll.find.sort(:i)\r\n => <Mongo::Cursor:0x808a5d9c namespace=\'mydb.testCollection\' @selector={} @cursor_id=> \r\n > coll.find.sort(:i => :desc)\r\n => <Mongo::Cursor:0x808948a8 namespace=\'mydb.testCollection\' @selector={} @cursor_id=> \r\n```\r\n\r\nCounting Documents\r\n============\r\n------------\r\n\r\n```ruby\r\n> coll.count\r\n => 101\r\n``` \r\n \r\nGet a Set of Documents\r\n============\r\n------------\r\n\r\n```ruby\r\n> puts coll.find(\'i\' => {\'$gt\' => 95}).to_a\r\n{\"_id\"=>BSON::ObjectId(\'5439ae2b3a10e7ef65000062\'), \"i\"=>96}\r\n{\"_id\"=>BSON::ObjectId(\'5439ae2b3a10e7ef65000063\'), \"i\"=>97}\r\n{\"_id\"=>BSON::ObjectId(\'5439ae2b3a10e7ef65000064\'), \"i\"=>98}\r\n{\"_id\"=>BSON::ObjectId(\'5439ae2b3a10e7ef65000065\'), \"i\"=>99}\r\n => nil \r\n```\r\n\r\n```ruby\r\n> puts coll.find(\'i\' => {\'$gt\' => 20, \'$lte\' => 30}).to_a\r\n{\"_id\"=>BSON::ObjectId(\'5439ae2b3a10e7ef65000017\'), \"i\"=>21}\r\n{\"_id\"=>BSON::ObjectId(\'5439ae2b3a10e7ef65000018\'), \"i\"=>22}\r\n{\"_id\"=>BSON::ObjectId(\'5439ae2b3a10e7ef65000019\'), \"i\"=>23}\r\n{\"_id\"=>BSON::ObjectId(\'5439ae2b3a10e7ef6500001a\'), \"i\"=>24}\r\n{\"_id\"=>BSON::ObjectId(\'5439ae2b3a10e7ef6500001b\'), \"i\"=>25}\r\n{\"_id\"=>BSON::ObjectId(\'5439ae2b3a10e7ef6500001c\'), \"i\"=>26}\r\n{\"_id\"=>BSON::ObjectId(\'5439ae2b3a10e7ef6500001d\'), \"i\"=>27}\r\n{\"_id\"=>BSON::ObjectId(\'5439ae2b3a10e7ef6500001e\'), \"i\"=>28}\r\n{\"_id\"=>BSON::ObjectId(\'5439ae2b3a10e7ef6500001f\'), \"i\"=>29}\r\n{\"_id\"=>BSON::ObjectId(\'5439ae2b3a10e7ef65000020\'), \"i\"=>30}\r\n => nil \r\n```\r\n\r\nSelect a Subset of Fields\r\n============\r\n------------\r\n\r\n```ruby\r\n> coll.find({\'_id\' => id}, :fields => [\'name\', \'type\']).to_a\r\n => [{\"_id\"=>BSON::ObjectId(\'5439ac843a10e7ef65000001\'), \"name\"=>\"MongoDB\", \"type\"=>\"database\"}] \r\n```\r\n\r\nQuery with Regex\r\n============\r\n------------\r\n\r\n```ruby\r\n> coll.find({\'name\' => /^M/}).to_a\r\n => [{\"_id\"=>BSON::ObjectId(\'5439ac843a10e7ef65000001\'), \"name\"=>\"MongoDB\", \"type\"=>\"database\", \"count\"=>1, \"info\"=>{\"x\"=>203, \"y\"=>\"102\"}}] \r\n```\r\n\r\nUpdate Document\r\n============\r\n------------\r\n\r\n```ruby\r\n> doc\r\n => {\"name\"=>\"MongoDB\", \"type\"=>\"database\", \"count\"=>1, \"info\"=>{\"x\"=>203, \"y\"=>\"102\"}, :_id=>BSON::ObjectId(\'5439ac843a10e7ef65000001\')} \r\n\r\n doc[\'name\']\r\n => \"MongoDB\" \r\n\r\n doc[\'name\'] = \'MongoDB Ruby\'\r\n => \"MongoDB Ruby\" \r\n > coll.update({\'_id\' => id}, doc)\r\n => {\"err\"=>nil, \"updatedExisting\"=>true, \"n\"=>1, \"ok\"=>1.0} \r\n```\r\n\r\nVerify update \r\n------------\r\n\r\n```ruby\r\n > coll.find(\'_id\' => id).to_a\r\n => [{\"_id\"=>BSON::ObjectId(\'5439ac843a10e7ef65000001\'), \"name\"=>\"MongoDB Ruby\", \"type\"=>\"database\", \"count\"=>1, \"info\"=>{\"x\"=>203, \"y\"=>\"102\"}}] \r\n \r\n > coll.count\r\n => 101 \r\n > coll.remove(\'i\' => 70)\r\n => {\"err\"=>nil, \"n\"=>1, \"ok\"=>1.0} \r\n > coll.count\r\n => 100 \r\n > coll.find(\'i\' => 70).to_a\r\n => [] \r\n``` \r\n \r\ncoll.remove will delete everything. This is a badly named method. It should have been named remove_all.\r\n\r\nCreate Index\r\n============\r\n------------\r\n\r\nLet\'s see what we have in the testCollection.\r\n\r\n```ruby\r\n > db_client = MongoClient.new(\'localhost\', 27017)\r\n > db = db_client.db(\'mydb\')\r\n > coll = db.collection(\'testCollection\')\r\n > coll.count\r\n```\r\n\r\nLet\'s now create an index on i.\r\n\r\n```ruby\r\n > coll.create_index(\'i\')\r\n => \"i_1\" \r\n > coll.find(\'i\' => 10).explain\r\n => {\"cursor\"=>\"BtreeCursor i_1\", \"nscanned\"=>1, \"nscannedObjects\"=>1, \"n\"=>1, \"millis\"=>0, \"indexBounds\"=>{\"i\"=>[[10, 10]]}, \"allPlans\"=>[{\"cursor\"=>\"BtreeCursor i_1\", \"indexBounds\"=>{\"i\"=>[[10, 10]]}}]} \r\n```\r\n\r\nThe output shows faster indexed BtreeCursor is used for i.\r\n\r\n```ruby\r\ncoll.find({\'name\' => \'MongoDB Ruby\'}).explain\r\n => {\"cursor\"=>\"BasicCursor\", \"nscanned\"=>100, \"nscannedObjects\"=>100, \"n\"=>1, \"millis\"=>0, \"indexBounds\"=>{}, \"allPlans\"=>[{\"cursor\"=>\"BasicCursor\", \"indexBounds\"=>{}}], \"oldPlan\"=>{\"cursor\"=>\"BasicCursor\", \"indexBounds\"=>{}}} \r\n > coll.find(\'type\' => \'database\').explain\r\n  => {\"cursor\"=>\"BasicCursor\", \"nscanned\"=>100, \"nscannedObjects\"=>100, \"n\"=>1, \"millis\"=>0, \"indexBounds\"=>{}, \"allPlans\"=>[{\"cursor\"=>\"BasicCursor\", \"indexBounds\"=>{}}]} \r\n```\r\n\r\nIf there is no index then a slower BasicCursor is used.\r\n \r\n\r\nList Indexes on a Collection\r\n============\r\n------------\r\n\r\n```ruby\r\n > coll.index_information\r\n  => {\"_id_\"=>{\"name\"=>\"_id_\", \"ns\"=>\"mydb.testCollection\", \"key\"=>{\"_id\"=>1}}, \"i_1\"=>{\"name\"=>\"i_1\", \"key\"=>{\"i\"=>1}, \"ns\"=>\"mydb.testCollection\"}}\r\n```  \r\n  \r\nDrop an Index\r\n============\r\n------------\r\n\r\n```ruby\r\n > coll.drop_index(\'i_1\')\r\n   => true \r\n > coll.index_information\r\n   => {\"_id_\"=>{\"name\"=>\"_id_\", \"ns\"=>\"mydb.testCollection\", \"key\"=>{\"_id\"=>1}}} \r\n```\r\n\r\nDrop all Indexes\r\n============\r\n------------\r\n\r\n```ruby\r\n > coll.drop_indexes\r\n   => true \r\n > coll.index_information\r\n   => {\"_id_\"=>{\"name\"=>\"_id_\", \"ns\"=>\"mydb.testCollection\", \"key\"=>{\"_id\"=>1}}} \r\n > coll.drop_indexes\r\n```\r\n\r\nDrop a Collection\r\n============\r\n------------\r\n\r\n```ruby\r\n > coll.drop\r\n   => true \r\n > db.collection_names\r\n   => [\"system.indexes\"] \r\n```\r\n  \r\nReference\r\n===========\r\n-----------\r\n\r\n[MongoDB Ruby Driver Tutorial](https://github.com/mongodb/mongo-ruby-driver/wiki/Tutorial \'MongoDB Ruby Driver\')','2014-10-13 22:50:21','2014-10-13 22:50:21'),(941,'Recurring Billing using Stripe API','Objective\r\n----------\r\n\r\nTo develop monthly subscription feature using Stripe API.\r\n\r\nSteps\r\n=====\r\n------\r\n\r\nStep 1\r\n-----\r\n\r\nSignup for Stripe Account. See your keys here https://dashboard.stripe.com/account. Copy the API credentials:\r\n\r\nTest Secret Key : sk_test_fIq8gFSbcYVu329\r\nTest publishable Key : pk_test_I5yWcRN8OyFkr\r\n\r\nStep 2\r\n-----\r\n\r\nInstall the stripe gem. \r\n\r\n```ruby\r\ngem install stripe. \r\n```\r\n\r\nIf you are using bundler:\r\n\r\n```ruby \r\ngem \'stripe\', :git => \'https://github.com/stripe/stripe-ruby\'\r\n```\r\n\r\nStep 3\r\n-----\r\n\r\nI have all Stripe related logic in app/gateways/stripe folder in my Rails project.\r\n\r\nStep 4\r\n-----\r\n\r\nCreate a Stripe plan. Playing in the irb:\r\n\r\n```ruby\r\nrequire \"stripe\"\r\nStripe.api_key = \"sk_test_BQokikJOvB2\"\r\n\r\nStripe::Plan.create(\r\n  :amount => 2000,\r\n  :interval => \'month\',\r\n  :name => \'Amazing Gold Plan\',\r\n  :currency => \'usd\',\r\n  :id => \'gold\'\r\n)\r\n```\r\n\r\nThe amount is in cents. The interval specifies frequency of billing for subscription. The id is a unique string that identifies this plan when subscribing a customer. It could be a string or a primary key from your own database. For more details on the fields, read the docs: https://stripe.com/docs/api#plans \r\n\r\nDelete a Plan\r\n---------------\r\n\r\n```ruby\r\nplan = Stripe::Plan.retrieve({PLAN_ID}) \r\nplan.delete\r\n```\r\n\r\nPLAN_ID is from your database or stored as a constant in your server side code.\r\n\r\n\r\nCreate a Customer\r\n-------------------\r\n\r\nYou need a token before you can create a customer. Create a token:\r\n\r\n```ruby\r\ncard = { :number => \"4242424242424242\", :exp_month => 8, :exp_year => 2015, :cvc => \"314\" }\r\nresponse = Stripe::Token.create(:card => card)\r\nputs response[\'id\']\r\n\r\n> tok_14Tj2w2eRoTz\r\n```\r\n\r\nLater, we will use Stripe.js in our web application to create token because it makes PCI compliance easy. Now, create a customer using the token generated in the above call as follows:\r\n\r\n```ruby\r\nresponse = Stripe::Customer.create(:description => \"Customer for test@example.com\",\r\n                                   :card => \"tok_14Tj2w2e3RoTz\")\r\nputs response\r\nputs response.class\r\nputs response[\'id\']\r\n```\r\n\r\nThe JSON response is :\r\n\r\n```json\r\n{\r\n  \"id\": \"cus_4cz7I6SnCZIrYF\",\r\n  \"object\": \"customer\",\r\n  \"created\": 1408579761,\r\n  \"livemode\": false,\r\n  \"description\": \"Customer for test@example.com\",\r\n  \"email\": null,\r\n  \"delinquent\": false,\r\n  \"metadata\": {},\r\nat top level in \"subscriptions\": {\"object\":\"list\",\"total_count\" at line 0\r\n  \"discount\": null,\r\n  \"account_balance\": 0,\r\n  \"currency\": null,\r\nat top level in \"cards\": {\"object\":\"list\",\"total_count\" at line 1\r\n  \"default_card\": \"card_14Tj2w2eZvKYlCh\"\r\n}\r\n```\r\n\r\nStripe::Customer id is cus_4cz7IYF. For writing tests, check this id is not nil.\r\n\r\nSubscribe a Customer to a Plan\r\n--------------------------------\r\n\r\n```ruby\r\ncustomer = Stripe::Customer.retrieve(\'cus_4cz7rYF\')\r\nsubscription = customer.subscriptions.create({:plan => \'gold\'})\r\n\r\nputs subscription.class\r\nputs subscription.id\r\nputs subscription\r\n```\r\n\r\nThe output is :\r\n\r\n```ruby\r\nStripe::Subscription\r\nsub_4dFhXZsN\r\n{\r\n  \"id\": \"sub_4dFhAPa595XZsN\",\r\n  \"plan\": {\"id\":\"gold\",\"interval\":\"month\",\"name\":\"Basic\",\"created\" }\r\n  \"object\": \"subscription\",\r\n  \"start\": 1408641490,\r\n  \"status\": \"active\",\r\n  \"customer\": \"cus_4cz7IYF\",\r\n  \"cancel_at_period_end\": false,\r\n  \"current_period_start\": 1408641490,\r\n  \"current_period_end\": 1411319890,\r\n  \"ended_at\": null,\r\n  \"trial_start\": null,\r\n  \"trial_end\": null,\r\n  \"canceled_at\": null,\r\n  \"quantity\": 1,\r\n  \"application_fee_percent\": null,\r\n  \"discount\": null,\r\n  \"metadata\": {}\r\n}\r\n```\r\n\r\nFor writing tests, check subscription.id has some value. Later, we will get the Stripe token as a result of the form that is submitted to Stripe, the code will look something like this:\r\n\r\n```ruby\r\n# Set your secret key: remember to change this to your live secret key in production\r\nStripe.api_key = \"sk_test_BQogH4olfQ2\"\r\n\r\n# Get the credit card details submitted by the form\r\ntoken = params[:stripeToken]\r\n\r\n# Create a Customer\r\ncustomer = Stripe::Customer.create(\r\n  :card => token,\r\n  :plan => \"gold\",\r\n  :email => \"payinguser@example.com\"\r\n)\r\n```\r\n\r\nSummary\r\n============\r\n------------\r\n\r\nIn this article, we played in the irb to get familiar with Stripe API for charging a customer for a subscription. To make the PCI compliance easy, we need to use Stripe.js to create the Stripe token instead of creating it manually by providing the credit card value in the irb. We also need to handle form validation, notifying customers about their upcoming credit card expiry etc. We will discuss them in upcoming articles on Stripe.\r\n\r\nReferences\r\n============\r\n------------\r\n\r\n1. [Stripe Examples] (https://stripe.com/docs/examples \'Stripe Examples\')\r\n2. [Stripe Gem] (https://github.com/stripe/stripe-ruby \'Stripe Gem\')\r\n\r\n','2014-10-14 17:45:44','2014-10-14 17:48:28'),(951,'TDD Beyond Basics : Mutation Testing','Objective\r\n----------\r\n\r\n- How to test your test\r\n\r\nDiscussion\r\n==========\r\n----------\r\n\r\n>> It is a good idea to test your tests. You can verify that they detect the errors you think they detect by inserting those errors into the production code. Make sure they report errors in a meaningful way. You should also verify that your tests speak clearly to a person trying to understand your code. The only way to do this is to have someone who isn’t familiar with your code read your tests and tell you what they learned. \r\n>> Tip by Gerard Meszaros in 97 Things a Programmer Should Know\r\n\r\nWhat is Mutation Testing?\r\n==========\r\n----------\r\n\r\nMutation testing is the process re-writing code to flush out ambiguities in the code. These ambiguities can cause failures. Since these faults are often very subtle, it can easily pass testing and debugging and end up in production.\r\n\r\nWhat Can be Mutated?\r\n==========\r\n----------\r\n\r\n- Changes if to unless, while to until etc.\r\n- Replace logical operator with its inverse. Ex: && with || etc.\r\n- Replace arithmetic operations with others. Ex: + with -, * with / etc.\r\n- Replace boolean relations with others. Ex: == becomes !=, < becomes > etc.\r\n- Replace true with false and vice-versa\r\n\r\nConditonals Boundary Mutator\r\n----------\r\n\r\n![alt text](https://images.rubyplus.com/conditionals-boundary-mutator.png \"Conditionals Boundary Mutator\")\r\n\r\nNegate Conditionals Mutator\r\n----------\r\n\r\n![alt text](https://images.rubyplus.com/negate-conditionals-mutator.png \"Negate Conditionals Mutator\")\r\n\r\nRemove Conditionals Mutator\r\n----------\r\n\r\nReplace conditional statement with true.\r\n\r\n```ruby\r\nif (a == b) {\r\n // do something \r\n}\r\n```\r\n\r\nbecomes:\r\n\r\n```ruby\r\nif true {\r\n  // do something\r\n}\r\n```\r\n\r\nMath Mutator\r\n----------\r\n\r\n![alt text](https://images.rubyplus.com/math-mutator.png \"Math Mutator\")\r\n\r\nIncrements Mutator\r\n----------\r\n\r\nReplace += with -=.\r\n\r\nInvert Negatives Mutator\r\n----------\r\n\r\nThe return values will be inverted. So a positive number will be changed to negative and vice-versa.\r\n\r\nMutation in Ruby Projects\r\n==========\r\n----------\r\n\r\nRuby has heckle and mutant gems for mutation testing.\r\n\r\n```ruby\r\ngem install heckle --pre\r\n```\r\n\r\nFails with :\r\n\r\n```sh\r\nERROR:  Error installing heckle:\r\n	ZenTest requires RubyGems version ~> 1.8. Try \'gem update --system\' to update RubyGems itself.\r\n```\r\n\r\nHeckle is outdated and has installation problems because it depends on ruby gems 1.8. My Ruby gems version is 2.2. The alternative to Heckle is Mutant. I had difficulties running the Mutant gem with my project. Reading the tests for Heckle and Mutant gems does not provide any information on what gets mutated. The tests and the code are difficult to understand. These two gems has failed the Gerard Meszaros tip mentioned in the beginning of this article. So, let\'s do the mutation testing manually and see if our test fails to catch the bugs. Here is the code from previous article:\r\n\r\n```ruby\r\nclass OctalConverter\r\n  def initialize(number)\r\n    @number = number\r\n  end\r\n  \r\n  def result\r\n    octal = []\r\n    until finished?\r\n      digit = extract_octal_digit\r\n      reduce\r\n        \r\n      octal.unshift(digit)\r\n    end\r\n      \r\n    octal\r\n  end\r\n  \r\n  private\r\n  \r\n  def extract_octal_digit\r\n    @number % 8\r\n  end\r\n  \r\n  def reduce\r\n    @number = @number / 8 \r\n  end\r\n  \r\n  def finished?\r\n    @number == 0\r\n  end\r\nend\r\n```\r\n\r\nThe mutations that I made manually are: changing \'until\' to \'while\', / to *, == to !=. The tests either failed or was caught in an infinite loop. So our tests break when the code is mutated.\r\n\r\nReferences\r\n==========\r\n----------\r\n\r\n1. [Mutation Testing] (https://www.simple-talk.com/dotnet/.net-tools/mutation-testing/ \'Mutation Testing\')\r\n2. [Mutation Testing: A New Approach to Automatic Error-Detection] (http://www.parasoft.com/products/article.jsp?articleId=291 \'Mutation Testing\')\r\n3. [Mutators] (http://pitest.org/quickstart/mutators/ \'Mutators\')','2014-10-15 00:03:08','2016-12-22 09:45:39'),(961,'Stripe Recurring Billing Part 2','Assumptions\r\n==========\r\n----------\r\n\r\n1) The user is already logged in.\r\n2) The user model will have email field.\r\n3) You can define : User `has_one :subscription`, Subscription `belongs_to :user` after you integrate with Devise, Authlogic etc.\r\n4) Move access over the network to a background job in a later version. \r\n5) To make the demo simple, the stripe related code is in the application wide layout. This should be moved to a separate app/views/layouts/subscriptions.html.erb layout file. Use this layout in subscriptions controller by using the Rails layout method.\r\n6) The subscription page must be loaded using https.\r\n\r\nSteps\r\n==========\r\n----------\r\n\r\nStep 1\r\n----------\r\n\r\nCreate a Rails 4.2.4 project.\r\n\r\nStep 2\r\n----------\r\n\r\nTurn off Coffeescript, in application.rb:\r\n\r\n```ruby\r\nconfig.generators.javascripts = false\r\n```\r\n\r\nStep 3\r\n----------\r\n\r\nAdd : \r\n\r\n```ruby\r\ngem \'stripe\' \r\n```\r\n\r\nto Gemfile. Run bundle.\r\n\r\nStep 4\r\n----------\r\n\r\nSetup Stripe keys. In config/initializers/stripe.rb:\r\n\r\n```ruby\r\nRails.configuration.stripe = {\r\n  publishable_key: ENV[\'STRIPE_PUBLISHABLE_KEY\'],\r\n  secret_key:      ENV[\'STRIPE_SECRET_KEY\']\r\n}\r\n\r\nStripe.api_key = Rails.configuration.stripe[:secret_key]\r\nSTRIPE_PUBLIC_KEY = Rails.configuration.stripe[:publishable_key]\r\n```\r\n\r\nStep 5\r\n----------\r\n\r\nLogin to your stripe account. Copy the API Keys and set Stripe environment variables on your development machine.\r\n\r\n```sh\r\nexport STRIPE_PUBLISHABLE_KEY=\'pk_test_your publishable key\' \r\nexport STRIPE_SECRET_KEY=\'sk_test_your secret key\' \r\n```\r\n\r\nYou can add it to your ~/.bash_profile file.\r\n\r\nStep 6 \r\n----------\r\n\r\nGo to Rails console and type:\r\n\r\n```ruby\r\nStripe.api_key = Rails.configuration.stripe[:secret_key] \r\n```\r\n\r\nVerify the value of `secret_key` for the `Stripe.api_key` variable is initialized correctly.\r\n\r\nStep 7\r\n----------\r\n\r\nIn the application.html.erb file, within the head tag add:\r\n\r\n```ruby\r\n<%= javascript_include_tag \'https://js.stripe.com/v2/\' %>\r\n```\r\n\r\nRefer [Building a Custom Payment Form] (https://stripe.com/docs/tutorials/forms \'Building a Custom Payment Form\') for more explanation. The final layout file looks like this:\r\n\r\n```ruby\r\n<!DOCTYPE html>\r\n<html>\r\n<head>\r\n  <title>Striped</title>\r\n  <%= stylesheet_link_tag    \'application\', media: \'all\', \'data-turbolinks-track\' => true %>\r\n  <%= javascript_include_tag \'application\', \'data-turbolinks-track\' => true %>\r\n  \r\n  <%= javascript_include_tag \'https://js.stripe.com/v2/\' %>\r\n  <%= tag :meta, :name => \"stripe-key\", :content => STRIPE_PUBLIC_KEY %>\r\n\r\n  <script type=\"text/javascript\">\r\n    // This identifies your website in the createToken call below\r\n    Stripe.setPublishableKey($(\'meta[name=\"stripe-key\"]\').attr(\'content\'));\r\n  \r\n    var stripeResponseHandler = function(status, response) {\r\n      var $form = $(\'#payment-form\');\r\n\r\n      if (response.error) {\r\n        // Show the errors on the form\r\n        $form.find(\'.payment-errors\').text(response.error.message);\r\n        $form.find(\'button\').prop(\'disabled\', false);\r\n      } else {\r\n        // token contains id, last4, and card type\r\n        var token = response.id;\r\n        // Insert the token into the form so it gets submitted to the server\r\n        $form.append($(\'<input type=\"hidden\" name=\"stripeToken\" />\').val(token));\r\n        // and re-submit\r\n        $form.get(0).submit();\r\n      }\r\n    };\r\n    \r\n    jQuery(function($) {\r\n      $(\'#payment-form\').submit(function(event) {\r\n        var $form = $(this);\r\n\r\n        // Disable the submit button to prevent repeated clicks\r\n        $form.find(\'button\').prop(\'disabled\', true);\r\n\r\n        Stripe.card.createToken($form, stripeResponseHandler);\r\n\r\n        // Prevent the form from submitting with the default action\r\n        return false;\r\n      });\r\n    });\r\n      \r\n  </script>\r\n\r\n  \r\n  <%= csrf_meta_tags %>\r\n</head>\r\n<body>\r\n\r\n<%= yield %>\r\n\r\n</body>\r\n</html>\r\n```\r\n\r\nHere the meta-tag stripe-key defines the Stripe public key. Refer railscasts for more details.\r\n\r\nStep 8\r\n-------\r\n\r\nRun the server and go to localhost:3000/subscriptions/new. Enter 4242424242424242 for the credit card. Click on the \'Submit Payment\' button. You will get the error: No route matches [POST] \"/subscriptions/new\" in the browser. Login to your Stripe account, in the test mode, click on the Logs under the REQUESTS tab. You should see that your request has reached Stripe servers.\r\n\r\nStep 9\r\n-------\r\n\r\nChange routes.rb:\r\n\r\n```ruby\r\npost \'subscriptions/create\' => \'subscriptions#create\'\r\n```\r\n\r\nStep 10\r\n-------\r\n\r\nChange create action in subscriptions controller:\r\n\r\n```ruby\r\n  def create\r\n    logger.info \"*\" * 80\r\n    logger.info params\r\n    logger.info \"*\" * 80\r\n  end\r\n```\r\n\r\nIn the log file we see:\r\n\r\n```sh\r\n Parameters: {\"stripeToken\"=>\"tok_4xfQ0TwMvzJIh9\"}\r\nCan\'t verify CSRF token authenticity\r\nCompleted 422 Unprocessable Entity in 1m\r\n```\r\n\r\nYou will see : ActionController::InvalidAuthenticityToken error in the browser.\r\n\r\nStep 11\r\n-------\r\n\r\nAdd the authenticity_token in the subscriptions/new.html.erb file:\r\n\r\n```ruby\r\n<%= hidden_field_tag :authenticity_token, form_authenticity_token -%>\r\n```\r\n\r\nYou can now see the stripe token in the log file:\r\n\r\n```sh\r\n********************************************************************************\r\n{\"authenticity_token\"=>\"9v7mQSZPHGn2CMn3TBBbIfCa8I5SzbPHQm+LMOh2kMw=\", \"stripeToken\"=>\"tok_4xfbyn7meV5eUH\", \"controller\"=>\"subscriptions\", \"action\"=>\"create\"}\r\n********************************************************************************\r\n```\r\n\r\nStep 12\r\n-------\r\n\r\nYou could put the `current_user.id` and stripeToken in a background job and process subscription later. For simplicity, let\'s create a Stripe::Customer object with `current_user.email`, `plan_id` and the stripeToken that we get from Stripe response. \r\n\r\nInstead of creating a Stripe::Customer, retrieving it and then creating a subscription (two network calls), we can create the customer and subscription object at once by using the optional plan attribute in the Stripe::Customer class. Like this:\r\n\r\n```ruby\r\ncustomer = Stripe::Customer.create(description: \"This must be current_user.email\", card:  params[:stripToken], plan: Subscription::GOLD)\r\n```\r\n\r\nThe plan should be based on the plan selected by the `current_user`. This could happen when they click on a specific pricing plan. For now, it is hard-coded to the plan that is already created in the test account.\r\n\r\nStep 13\r\n-------\r\n\r\nThere is no need to validate email because the `current_user.email` will have value. The email validation will be done when the user creates an account.\r\n\r\n```ruby\r\ncustomer = Stripe::Customer.create(description: \"This must be current_user.email\", card:  params[:stripToken], plan: Subscription::GOLD)\r\nputs \"Save #{customer.id} as the stripe_customer_token in Subscription model\"\r\n```\r\n    \r\nTo make code robust, handle Stripe related exceptions. For example, if the plan does not exist you will get: Stripe::InvalidRequestError : \"No such plan: gold\" error. The plan is case sensitive.\r\n\r\nStep 14\r\n-------\r\n\r\nMove the subscription creation to app/gateways/stripe_gateway.rb. \r\n\r\nStep 15\r\n-------\r\n\r\nCreate the subscription model and migrate the database.\r\n\r\n```ruby\r\n$rails g model subscription plan_name:string stripe_customer_token:string\r\n$rake db:migrate\r\n```\r\n\r\nStep 16\r\n-------\r\n\r\n```ruby\r\n  def create\r\n    stripe = StripeGateway.new(Rails.logger)\r\n    @subscription = stripe.create_subscription(email, stripe_token, plan_id)\r\n  end\r\n```\r\n\r\nStripeGateway constructor takes a logger object, since it should not have any dependency on web application framework. It depends only on the Logger interface.\r\n\r\nStep 17\r\n-------\r\n\r\nDisplay the feedback message in subscriptions/create.html.erb.\r\n\r\n```ruby\r\n<% if @subscription.complete? %>\r\nYou have been subscribed to <%= @subscription.plan_display_name %>.\r\n<% end %>\r\n```\r\n\r\nYou can view the details of the newly created customer in Stripe account by clicking the Customers tab.\r\n\r\n**Tip** : If you have problem with disabled \'Submit Payment\' button, in FireFox press the shift and refresh button to reload the page.\r\n\r\nComplete Source Code \r\n=============\r\n-------------\r\n\r\nHere is the complete source code:\r\n\r\nsubscriptions_controller.rb\r\n\r\n```ruby\r\nclass SubscriptionsController < ApplicationController\r\n  def new\r\n  end\r\n  \r\n  def create\r\n    stripe = StripeGateway.new(Rails.logger)\r\n    @subscription = stripe.create_subscription(\'current_user.email\', params[:stripeToken], Subscription::GOLD)\r\n  end\r\n  \r\nend\r\n```\r\n\r\nroutes.rb\r\n\r\n```ruby\r\nRails.application.routes.draw do\r\n  get \'subscriptions/new\'\r\n  post \'subscriptions/create\' => \'subscriptions#create\'\r\nend\r\n```\r\n\r\napplication.html.erb\r\n\r\n```html\r\n<!DOCTYPE html>\r\n<html>\r\n<head>\r\n  <title>Striped</title>\r\n  <%= stylesheet_link_tag    \'application\', media: \'all\', \'data-turbolinks-track\' => true %>\r\n  <%= javascript_include_tag \'application\', \'data-turbolinks-track\' => true %>\r\n  \r\n  <%= javascript_include_tag \'https://js.stripe.com/v2/\' %>\r\n  <%= tag :meta, :name => \"stripe-key\", :content => STRIPE_PUBLIC_KEY %>\r\n\r\n  <script type=\"text/javascript\">\r\n    // This identifies your website in the createToken call below\r\n    Stripe.setPublishableKey($(\'meta[name=\"stripe-key\"]\').attr(\'content\'));\r\n  \r\n    var stripeResponseHandler = function(status, response) {\r\n      var $form = $(\'#payment-form\');\r\n\r\n      if (response.error) {\r\n        // Show the errors on the form\r\n        $form.find(\'.payment-errors\').text(response.error.message);\r\n        $form.find(\'button\').prop(\'disabled\', false);\r\n      } else {\r\n        // token contains id, last4, and card type\r\n        var token = response.id;\r\n        // Insert the token into the form so it gets submitted to the server\r\n        $form.append($(\'<input type=\"hidden\" name=\"stripeToken\" />\').val(token));\r\n        // and re-submit\r\n        $form.get(0).submit();\r\n      }\r\n    };\r\n    \r\n    jQuery(function($) {\r\n      $(\'#payment-form\').submit(function(event) {\r\n        var $form = $(this);\r\n\r\n        // Disable the submit button to prevent repeated clicks\r\n        $form.find(\'button\').prop(\'disabled\', true);\r\n\r\n        Stripe.card.createToken($form, stripeResponseHandler);\r\n\r\n        // Prevent the form from submitting with the default action\r\n        return false;\r\n      });\r\n    });\r\n      \r\n  </script>\r\n\r\n  \r\n  <%= csrf_meta_tags %>\r\n</head>\r\n<body>\r\n\r\n<%= yield %>\r\n\r\n</body>\r\n</html>\r\n```\r\n\r\nconfig/initializers/stripe.rb\r\n\r\n```ruby\r\nRails.configuration.stripe = {\r\n  publishable_key: ENV[\'STRIPE_PUBLISHABLE_KEY\'],\r\n  secret_key:      ENV[\'STRIPE_SECRET_KEY\']\r\n}\r\n\r\nStripe.api_key = Rails.configuration.stripe[:secret_key]\r\nSTRIPE_PUBLIC_KEY = Rails.configuration.stripe[:publishable_key]\r\n```\r\n\r\napp/gateways/stripe_gateway.rb\r\n\r\n```ruby\r\nclass StripeGateway\r\n  def initialize(logger)\r\n    @logger = logger\r\n  end\r\n  \r\n  def create_subscription(email, stripe_token, plan_id)\r\n    begin\r\n      customer = Stripe::Customer.create(description: email, card: stripe_token, plan: plan_id)\r\n      subscription = Subscription.new\r\n      subscription.stripe_customer_token = customer.id\r\n      subscription.plan_name = plan_id\r\n      subscription.save!\r\n      subscription\r\n    rescue Stripe::InvalidRequestError => e\r\n      @logger.error \"Create subscription failed due to : #{e.message}\"\r\n    rescue Exception => ex\r\n      @logger.error \"Create subscription failed due to : #{ex.message}\"  \r\n    end\r\n  end\r\n  \r\nend\r\n```\r\n\r\napplication.rb\r\n\r\n```ruby\r\nrequire File.expand_path(\'../boot\', __FILE__)\r\n\r\nrequire \'rails/all\'\r\n\r\n# Require the gems listed in Gemfile, including any gems\r\n# you\'ve limited to :test, :development, or :production.\r\nBundler.require(*Rails.groups)\r\n\r\nmodule Striped\r\n  class Application < Rails::Application\r\n    # Settings in config/environments/* take precedence over those specified here.\r\n    # Application configuration should go into files in config/initializers\r\n    # -- all .rb files in that directory are automatically loaded.\r\n\r\n    # Set Time.zone default to the specified zone and make Active Record auto-convert to this zone.\r\n    # Run \"rake -D time\" for a list of tasks for finding time zone names. Default is UTC.\r\n    # config.time_zone = \'Central Time (US & Canada)\'\r\n\r\n    # The default locale is :en and all translations from config/locales/*.rb,yml are auto loaded.\r\n    # config.i18n.load_path += Dir[Rails.root.join(\'my\', \'locales\', \'*.{rb,yml}\').to_s]\r\n    # config.i18n.default_locale = :de\r\n    \r\n    # Turn off Coffeescript\r\n    config.generators.javascripts = false    \r\n  end\r\nend\r\n```\r\n\r\napp/models/subscription.rb\r\n\r\n```ruby\r\nclass Subscription < ActiveRecord::Base\r\n  GOLD = 2\r\n  \r\n  def plan_display_name\r\n    case self.plan_name\r\n    when 1\r\n      \'Silver\'\r\n    when 2\r\n      \'Gold\'\r\n    when 3\r\n      \'Platinum\'\r\n    else\r\n      \'Unknown\'\r\n    end\r\n  end\r\n  \r\n  def complete?\r\n    self.stripe_customer_token.present?\r\n  end\r\nend\r\n```\r\n\r\nmigration file:\r\n\r\n```ruby\r\nclass CreateSubscriptions < ActiveRecord::Migration\r\n  def change\r\n    create_table :subscriptions do |t|\r\n      t.string :plan_name\r\n      t.string :stripe_customer_token\r\n\r\n      t.timestamps\r\n    end\r\n  end\r\nend\r\n```\r\n\r\nYou can download the entire source code from Bitbucket: `git@bitbucket.org:bparanj/striped.git`.\r\n\r\nReferences\r\n==========\r\n----------\r\n\r\n1. https://gist.github.com/briancollins/6365455\r\n2. https://stripe.com/docs/tutorials/forms\r\n3. Mastering Modern Payments by Pete Keen\r\n4. [Billing with Stripe](http://railscasts.com/episodes/288-billing-with-stripe \'Stripe\')\r\n5. [Creating a Form for Handling Payments with Stripe] (http://www.larryullman.com/2012/11/28/creating-a-form-for-handling-payments-with-stripe/ \'Stripe\')\r\n6. [Subscriptions javascript] (https://gist.github.com/justinthiele/1307748 \'Stripe\')','2014-10-15 16:24:19','2016-06-30 21:28:26'),(971,'Troubleshooting Thread Deadlocks using strace','In this article you will learn how to identify thread deadlocks using UNIX strace command. This is a very useful command that you can use to troubleshoot problems in production. It will trace all system calls and can slow down your system, so run it during slow periods. Sometimes you don\'t see any log messages in any of the servers when you are troubleshooting, this command becomes very useful in such cases. \r\n\r\nCreate chopstick.rb with the following code:\r\n\r\n```ruby\r\nclass Chopstick\r\n  def initialize\r\n    @mutex = Mutex.new\r\n  end\r\n\r\n  def take\r\n    @mutex.lock\r\n  end\r\n\r\n  def drop\r\n    @mutex.unlock\r\n\r\n  rescue ThreadError\r\n    puts \"Trying to drop a chopstick not acquired\"\r\n  end\r\n\r\n  def in_use?\r\n    @mutex.locked?\r\n  end\r\nend\r\n```\r\n\r\nCreate philosopher.rb with the following code:\r\n\r\n```ruby\r\nclass Philosopher\r\n  def initialize(name)\r\n    @name = name\r\n  end\r\n\r\n  def dine(table, position)\r\n    @left_chopstick  = table.left_chopstick_at(position)\r\n    @right_chopstick = table.right_chopstick_at(position)\r\n\r\n    loop do\r\n      think\r\n      eat\r\n    end\r\n  end\r\n\r\n  def think\r\n    puts \"#{@name} is thinking\"\r\n  end\r\n\r\n  def eat\r\n    take_chopsticks\r\n\r\n    puts \"#{@name} is eating.\"\r\n\r\n    drop_chopsticks\r\n  end\r\n\r\n  def take_chopsticks\r\n    @left_chopstick.take\r\n    @right_chopstick.take\r\n  end\r\n\r\n  def drop_chopsticks\r\n    @left_chopstick.drop\r\n    @right_chopstick.drop\r\n  end\r\nend\r\n```\r\n\r\nCreate table.rb with the following code:\r\n\r\n```ruby\r\nrequire_relative \'chopstick\'\r\n\r\nclass Table\r\n  def initialize(num_seats)\r\n    @chopsticks  = num_seats.times.map { Chopstick.new }\r\n  end\r\n\r\n  def left_chopstick_at(position)\r\n    index = (position - 1) % @chopsticks.size\r\n    @chopsticks[index]\r\n  end\r\n\r\n  def right_chopstick_at(position)\r\n    index = position % @chopsticks.size\r\n    @chopsticks[index]\r\n  end\r\n\r\n  def chopsticks_in_use\r\n    @chopsticks.select { |f| f.in_use? }.size\r\n  end\r\nend\r\n```\r\n\r\nCreate driver.rb with the following code:\r\n\r\n```ruby\r\nrequire_relative \'philosopher\'\r\nrequire_relative \'table\'\r\n\r\nnames = %w{Heraclitus Aristotle Epictetus Schopenhauer Popper}\r\n\r\nphilosophers = names.map { |name| Philosopher.new(name) }\r\ntable        = Table.new(philosophers.size)\r\n\r\nthreads = philosophers.map.with_index do |philosopher, i|\r\n  Thread.new { philosopher.dine(table, i) }\r\nend\r\n\r\nthreads.each(&:join)\r\nsleep\r\n```\r\n\r\nRun the driver.rb.\r\n\r\nDiscussion\r\n================\r\n-----------\r\n\r\nWe have source code for the Dining Philosopher\'s problem. What if it is in a language that you are not familiar? What if you don\'t have the source code? How will you verify that program that is hanging is due to thread deadlocks? You can use strace to find thread deadlocks.\r\n\r\nStrace to View Deadlocks\r\n========================\r\n-------------------------\r\n\r\nLet\'s use strace command to view deadlocks. Start the driver program with the strace command like this: \r\n\r\n```ruby\r\n$strace -s 2000 -p ruby driver.rb\r\n```\r\nYou get lot of output, here is the output that is relevant to the deadlock. We can see the futex system call.\r\n\r\n```sh\r\n[pid  2299] select(4, [3], NULL, NULL, NULL <unfinished ...>\r\n[pid  2301] <... futex resumed> )       = -1 ETIMEDOUT (Connection timed out)\r\n[pid  2301] futex(0x989a8c8, FUTEX_WAKE_PRIVATE, 1) = 0\r\n[pid  2301] futex(0x96e38b8, FUTEX_WAKE_OP_PRIVATE, 1, 1, 0x96e38b4, {FUTEX_OP_SET, 0, FUTEX_OP_CMP_GT, 1}) = 1\r\n[pid  2298] <... futex resumed> )       = 0\r\n[pid  2301] futex(0x96e390c, FUTEX_WAKE_PRIVATE, 1 <unfinished ...>\r\n[pid  2298] futex(0x96e390c, FUTEX_WAIT_PRIVATE, 2, NULL <unfinished ...>\r\n[pid  2301] <... futex resumed> )       = 0\r\n[pid  2298] <... futex resumed> )       = -1 EAGAIN (Resource temporarily unavailable)\r\n[pid  2301] futex(0x989a8e4, FUTEX_WAIT_PRIVATE, 7, NULL <unfinished ...>\r\n[pid  2298] futex(0x96e390c, FUTEX_WAKE_PRIVATE, 1) = 0\r\n[pid  2298] time(NULL)                  = 1413743725\r\n[pid  2298] clock_gettime(CLOCK_MONOTONIC, {1621, 935083702}) = 0\r\n[pid  2298] clock_gettime(CLOCK_MONOTONIC, {1621, 935107966}) = 0\r\n[pid  2298] clock_gettime(CLOCK_MONOTONIC, {1621, 935128739}) = 0\r\n[pid  2298] futex(0x96e38b8, FUTEX_WAIT_PRIVATE, 3, {9, 999979227}) = -1 ETIMEDOUT (Connection timed out)\r\n[pid  2298] futex(0x96e390c, FUTEX_WAKE_PRIVATE, 1) = 0\r\n[pid  2298] clock_gettime(CLOCK_MONOTONIC, {1631, 935391621}) = 0\r\n[pid  2298] time(NULL)                  = 1413743735\r\n[pid  2298] write(1, \"Exception occured due to No live threads left. Deadlock?\", 56Exception occured due to No live threads left. Deadlock?) = 56\r\n[pid  2298] write(1, \"\\n\", 1\r\n)           = 1\r\n[pid  2298] write(1, \"#<Class:0x97163b8>\", 18#<Class:0x97163b8>) = 18\r\n[pid  2298] write(1, \"\\n\", 1\r\n)           = 1\r\n```\r\n\r\nIn Unix everything is a file or process. So what happens when a process uses multiple threads? There is no thread id to identify a specific thread, every new thread gets its own process id. How can we get the pids of all the threads executing in a single process? Run the following command:\r\n\r\n```sh\r\nps -efL|grep <Process Name>\r\n```\r\n\r\nNow, you can trace each of the thread using it\'s pid as follows:\r\n\r\n```sh\r\nstrace -p pid-of-a-thread\r\n```\r\n\r\nSo you can run strace for a specific thread using it\'s process id.\r\n \r\nReferences\r\n==========\r\n-----------\r\n\r\n1. [A gentle introduction to actor-based concurrency](https://practicingruby.com/articles/gentle-intro-to-actor-based-concurrency \'Concurrency\')\r\n2. [Strace Hanging at Futex](http://meenakshi02.wordpress.com/2011/02/02/strace-hanging-at-futex/ \'strace\')\r\n3. [The Magic of Strace](http://chadfowler.com/blog/2014/01/26/the-magic-of-strace/ \'Strace\')\r\n4. [GoRuCo 2014 - How to Debug Anything by James Golick ] (https://www.youtube.com/watch?v=VV7b7fs4VI8 \'GoRuCo 2014 - How to Debug Anything by James Golick \')','2014-10-19 19:34:17','2014-10-19 19:34:17'),(981,'SQL Basics : Create, Insert and Select Statements','Install Sqlite3\r\n-----------------\r\n\r\nInstall the sqlite3 gem.\r\n\r\n```sh\r\n$ gem install sqlite3\r\nFetching: sqlite3-1.3.9.gem (100%)\r\nBuilding native extensions.  This could take a while...\r\nSuccessfully installed sqlite3-1.3.9\r\n1 gem installed\r\n```\r\n\r\nCreate a Database\r\n-----------------\r\n\r\nWhen you type sqlite3 with a file name that ends in .sqlite3, sqlite3 gem will automatically create an empty database.\r\n\r\n```sh\r\n$ sqlite3 play.sqlite3\r\nSQLite version 3.7.7 2011-06-25 16:35:41\r\nEnter \".help\" for instructions\r\nEnter SQL statements terminated with a \";\"\r\n```\r\n\r\nTo view the tables:\r\n\r\n```sh\r\nsqlite> .tables\r\n```\r\n\r\nThis will return no output, since we don\'t have any tables yet.\r\n\r\nCreate a Table\r\n-----------------\r\n\r\nUse CREATE TABLE <table name> as follows:\r\n\r\n```sh\r\nsqlite> CREATE TABLE users(\r\n   ...>    id int primary key not null,\r\n   ...>    first_name char(50),\r\n   ...>    last_name char(50),\r\n   ...>    email char(50) not null);\r\nsqlite> .tables\r\nusers\r\n```\r\n\r\nWe see only one table called users.\r\n\r\nCounting Records\r\n-----------------\r\n\r\nTo count the number of records in a table, use count(*) in the select statement as follows:\r\n\r\n```sh\r\nsqlite> select count(*) from users;\r\n0\r\n```\r\n\r\nHere we see no records, since we don\'t have any data in the users table yet. \r\n\r\nInserting Rows \r\n-----------------\r\n\r\nLet\'s insert some rows in the user table.\r\n\r\n```sh\r\nsqlite> INSERT INTO users(first_name, last_name, email)\r\n   ...> VALUES(\'bugs\', \'bunny\', \'bbunny@disney.com\');\r\nError: users.id may not be NULL\r\n```\r\n\r\nWe get an error because we have a \'not null\' constraint on the primary key id of the users table. So, we need to provide it:\r\n\r\n```sh\r\nsqlite> INSERT INTO users(id, first_name, last_name, email)\r\n   ...> VALUES(1,\'bugs\', \'bunny\', \'bbunny@disney.com\');\r\n```\r\n\r\nNow if we count again, we get:\r\n\r\n```sh\r\nsqlite> select count(*) from users;\r\n1\r\n```\r\n\r\nRetrieving All Columns\r\n-----------------\r\n\r\nTo retrieve data for all columns, use * after the select keyword as follows:\r\n\r\n```sh\r\nsqlite> select * from users;\r\n1|bugs|bunny|bbunny@disney.com\r\n```\r\n\r\nLet\'s turn on the column names to be displayed.\r\n\r\n```sh\r\nsqlite> .headers on\r\nsqlite> select * from users;\r\nid|first_name|last_name|email\r\n1|bugs|bunny|bbunny@disney.com\r\n```\r\n\r\nLet\'s insert a second row into the users table.\r\n\r\n```sh\r\nsqlite> INSERT INTO users(id, first_name, last_name, email)\r\n   ...> VALUES(2,\'daffy\', \'duck\', \'daffy@disney.com\');\r\n\r\nsqlite> select count(*) from users;\r\ncount(*)\r\n2\r\n```\r\n\r\nNow we have two rows in the users table.\r\n\r\nRetrieving Single Column\r\n-----------------\r\n\r\n```sh\r\nsqlite> select first_name from users where id=2;\r\nfirst_name\r\ndaffy\r\n```\r\n\r\nLet\'s make the output pretty with the column name and it\'s data aligned.\r\n\r\n```sh\r\nsqlite> .mode column\r\nsqlite> select first_name from users where id=2;\r\nfirst_name\r\n----------\r\ndaffy\r\n```\r\n\r\nIf you retrieve all the columns, you will get a nice output:\r\n\r\n```sh\r\nsqlite> select * from users;\r\nid          first_name  last_name   email            \r\n----------  ----------  ----------  -----------------\r\n1           bugs        bunny       bbunny@disney.com\r\n2           daffy       duck        daffy@disney.com \r\n```\r\n\r\nRetrieving Multiple Columns\r\n-----------------\r\n\r\nTo retrieve data for multiple columns from a table, specify the column names after the select keyword separated by a comma, like this:\r\n\r\n```sh\r\nsqlite> select first_name, last_name from users;\r\nfirst_name  last_name \r\n----------  ----------\r\nbugs        bunny     \r\ndaffy       duck\r\n```\r\n\r\nExercise\r\n==========\r\n----------\r\n\r\nInsert three records into users table. One of the record must have the same first_name any one of the existing record.\r\n\r\nAnswer\r\n----------\r\n\r\n```sh\r\nsqlite> INSERT INTO users(id, first_name, last_name, email)\r\n   ...> VALUES(3,\'porky\', \'pig\', \'ppig@disney.com\');\r\nsqlite> INSERT INTO users(id, first_name, last_name, email)\r\n   ...> VALUES(4,\'pluto\', \'dog\', \'pdog@disney.com\');\r\nsqlite> INSERT INTO users(id, first_name, last_name, email)\r\n   ...> VALUES(5,\'pluto\', \'pet\', \'pdog@disney.com\');\r\nsqlite> select count(*) from users;\r\ncount(*)  \r\n----------\r\n5         \r\n```\r\n\r\nLimiting Results\r\n----------\r\n\r\nTo limit the number of rows to retrieve from the database, use the \'limit\' keyword:\r\n\r\n```sh\r\nsqlite> select * from users limit 2;\r\nid          first_name  last_name   email            \r\n----------  ----------  ----------  -----------------\r\n1           bugs        bunny       bbunny@disney.com\r\n2           daffy       duck        daffy@disney.com\r\n```\r\n\r\nTo get the next two rows, specify where to start and the number of rows to retrieve:\r\n\r\n```sh\r\nsqlite> select * from users limit 2 offset 2;\r\nid          first_name  last_name   email          \r\n----------  ----------  ----------  ---------------\r\n3           porky       pig         ppig@disney.com\r\n4           pluto       dog         pdog@disney.com\r\n```\r\n\r\nIn this example it starts from row 3 (offset = 2) and retrieves two records (limit = 2).\r\n\r\nRetrieving Distinct Rows\r\n----------\r\n\r\nWe have 5 records in the users table.\r\n\r\n```sh\r\nsqlite> select * from users;\r\nid          first_name  last_name   email            \r\n----------  ----------  ----------  -----------------\r\n1           bugs        bunny       bbunny@disney.com\r\n2           daffy       duck        daffy@disney.com \r\n3           porky       pig         ppig@disney.com  \r\n4           pluto       dog         pdog@disney.com  \r\n5           pluto       pet         pdog@disney.com  \r\n```\r\n\r\nIf we want to retrieve only unique user names :\r\n\r\n```sh\r\nsqlite> select DISTINCT(first_name) from users;\r\nfirst_name\r\n----------\r\nbugs      \r\ndaffy     \r\npluto     \r\nporky\r\n```\r\n\r\nSummary\r\n==========\r\n----------\r\n\r\nIn this article, you learned how to create a new database, create a table, populate the table with data and the basics of SQL SELECT statement. In the next article, you will learn how to sort the retrieved data.','2014-10-21 07:19:16','2014-10-21 07:21:28'),(991,'SQL Basics : Sorting','Objective\r\n==========\r\n----------\r\n\r\nLearn how to use ORDER By clause to sort retrieved data.\r\n\r\nSorting Single Column\r\n==========\r\n----------\r\n\r\nWhen you select a column, the data seems to be not ordered:\r\n\r\n```sh\r\nsqlite> select first_name from users;\r\nfirst_name\r\n----------\r\nbugs      \r\ndaffy     \r\nporky     \r\npluto     \r\npluto     \r\ntasmanian \r\ntweety    \r\nelmer     \r\nspeedy    \r\nyosemite\r\n```\r\n\r\nHowever, if you select the primary key and the first name:\r\n\r\n```sh\r\nsqlite> select id, first_name from users;\r\nid          first_name\r\n----------  ----------\r\n1           bugs      \r\n2           daffy     \r\n3           porky     \r\n4           pluto     \r\n5           pluto     \r\n6           tasmanian \r\n7           tweety    \r\n8           elmer     \r\n9           speedy    \r\n10          yosemite\r\n```\r\n\r\nYou see that it is displayed in the order the record was inserted into the database. You should not rely on this default behavior since the ordering can be changed when you delete and update records in the users table. It is a good practice to explicitly specify the sort order.\r\n\r\n```sh\r\nsqlite> select first_name from users order by first_name;\r\nfirst_name\r\n----------\r\nbugs      \r\ndaffy     \r\nelmer     \r\npluto     \r\npluto     \r\nporky     \r\nspeedy    \r\ntasmanian \r\ntweety    \r\nyosemite\r\n```\r\n\r\nYou can now see that these are ordered by the first_name and not by the primary key:\r\n\r\n```sh\r\nsqlite> select id, first_name from users order by first_name;\r\nid          first_name\r\n----------  ----------\r\n1           bugs      \r\n2           daffy     \r\n8           elmer     \r\n4           pluto     \r\n5           pluto     \r\n3           porky     \r\n9           speedy    \r\n6           tasmanian \r\n7           tweety    \r\n10          yosemite\r\n```\r\n\r\nSorting by Multiple Columns\r\n==========\r\n----------\r\n\r\nHere the data is not sorted in any order:\r\n\r\n```sh\r\nsqlite> select last_name, first_name from users;\r\nlast_name   first_name\r\n----------  ----------\r\nbunny       bugs      \r\nduck        daffy     \r\npig         porky     \r\ndog         pluto     \r\npet         pluto     \r\ndevil       tasmanian \r\nbird        tweety    \r\nfudd        elmer     \r\ngonzales    speedy    \r\nsam         yosemite\r\n```\r\n\r\nLet\'s sort the users first by last_name and then first_name:\r\n\r\n```sh\r\nsqlite> select last_name, first_name from users order by last_name, first_name;\r\nlast_name   first_name\r\n----------  ----------\r\nbird        tweety    \r\nbunny       bugs      \r\ndevil       tasmanian \r\ndog         pluto     \r\nduck        daffy     \r\nfudd        elmer     \r\ngonzales    speedy    \r\npet         pluto     \r\npig         porky     \r\nsam         yosemite\r\n```\r\n\r\nSpecifying Sort Direction\r\n==========\r\n----------\r\n\r\nIn the previous examples, the sorting by default was in ascending order, if you want to order by descending, you can use DESC keyword:\r\n\r\n```sh\r\nsqlite> select first_name from users order by first_name desc;\r\nfirst_name\r\n----------\r\nyosemite  \r\ntweety    \r\ntasmanian \r\nspeedy    \r\nporky     \r\npluto     \r\npluto     \r\nelmer     \r\ndaffy     \r\nbugs\r\n```\r\n\r\nHere is another example, this time with multiple columns:\r\n\r\n```sh\r\nselect last_name, first_name from users order by last_name desc, first_name;\r\nlast_name   first_name\r\n----------  ----------\r\nsam         yosemite  \r\npig         porky     \r\npet         pluto     \r\ngonzales    speedy    \r\nfudd        elmer     \r\nduck        daffy     \r\ndog         pluto     \r\ndevil       tasmanian \r\nbunny       bugs      \r\nbird        tweety\r\n```\r\n\r\nSummary\r\n==========\r\n----------\r\n\r\nIn this article, you learned how to sort data using the ORDER By clause in the SELECT statement. This clause must be the last in the SELECT statement. It can be used to sort data in ascending or descending order on one or more columns.','2014-10-22 05:19:23','2014-10-22 05:19:23'),(1001,'SQL Basics : Search Conditions','Objective\r\n==========\r\n----------\r\n\r\nIn this lesson, you will learn how to use the WHERE clause in SELECT statement to filter data.\r\n\r\nWhere Clause\r\n==========\r\n----------\r\n\r\nTo avoid retrieving large number of records we specify search criteria to extract a subset of the table\'s data.\r\n\r\n```sh\r\nsqlite> select * from users where id > 5;\r\nid          first_name  last_name   email            \r\n----------  ----------  ----------  -----------------\r\n6           tasmanian   devil       tdevil@disney.com\r\n7           tweety      bird        tweety@disney.com\r\n8           elmer       fudd        efudd@disney.com \r\n9           speedy      gonzales    gonzales@disney.c\r\n10          yosemite    sam         sam@disney.com\r\n```\r\n\r\nHere the where clause is used as the filter condition to retrieve records with primary key greater than 5. \r\n\r\nWhere Clause Operator\r\n==========\r\n----------\r\n\r\nThe example above used greater than as the operator for the search criteria. We can also use any of the following operators:\r\n\r\n1. Equality\r\n2. Non-Equality\r\n3. Less than\r\n4. Less than or equal to\r\n5. Not less than\r\n6. Greater than\r\n7. Greater than or equal to\r\n8. Not greater than\r\n9. Between two values\r\n10. Is a NULL value\r\n\r\nHere is the equality operator as the filter condition:\r\n\r\n```sh\r\nsqlite> select * from users where id = 5;\r\nid          first_name  last_name   email          \r\n----------  ----------  ----------  ---------------\r\n5           pluto       pet         pdog@disney.com\r\n```\r\n\r\nHere is the non-equality operator as the filter condition:\r\n\r\n```sh\r\nsqlite> select * from users where first_name <> \'pluto\';\r\nid          first_name  last_name   email            \r\n----------  ----------  ----------  -----------------\r\n1           bugs        bunny       bbunny@disney.com\r\n2           daffy       duck        daffy@disney.com \r\n3           porky       pig         ppig@disney.com  \r\n6           tasmanian   devil       tdevil@disney.com\r\n7           tweety      bird        tweety@disney.com\r\n8           elmer       fudd        efudd@disney.com \r\n9           speedy      gonzales    gonzales@disney.c\r\n10          yosemite    sam         sam@disney.com\r\n```\r\n\r\nThe result filters out two of the records which contains pluto as the first_name.\r\n\r\nExercise\r\n==========\r\n----------\r\n\r\nChange the above non-equality query to use != instead of <>. What do you see as the result?\r\n\r\nBetween a Range\r\n----------\r\n\r\nWe need to specify the beginning and end of the range as follows:\r\n\r\n```sh\r\nsqlite> select * from users where id between 5 and 10;\r\nid          first_name  last_name   email          \r\n----------  ----------  ----------  ---------------\r\n5           pluto       pet         pdog@disney.com\r\n6           tasmanian   devil       tdevil@disney.c\r\n7           tweety      bird        tweety@disney.c\r\n8           elmer       fudd        efudd@disney.co\r\n9           speedy      gonzales    gonzales@disney\r\n10          yosemite    sam         sam@disney.com\r\n```\r\n\r\nHere we retrieve all records between 5 and 10, where 5 is the beginning and 10 is the end of the range. The range values is separated by the AND keyword.\r\n\r\nNULL Value\r\n----------\r\n\r\nWhen a column does not have any value, it contains a NULL value. Since our database does not contain any record with NULL value, let\'s first insert a record with NULL value for last_name by not providing a value in the insert statement.\r\n\r\n```sh\r\nsqlite> select * from users where last_name is NULL;\r\nsqlite> INSERT INTO users(id, first_name, email)\r\n   ...> VALUES(12,\'bosko\', \'bosko@disney.com\');\r\nsqlite> select * from users where last_name is NULL;\r\nid          first_name  last_name   email         \r\n----------  ----------  ----------  --------------\r\n12          bosko                   bosko@disney.com\r\n```\r\n\r\nIn this case, bosko does not have any last_name, it is NULL in database terminology.\r\n\r\nExercise\r\n==========\r\n----------\r\n\r\nExperiment with the remaining where clause operators from the list shown in the Where Clause Operator section by querying the users table.\r\n\r\n\r\nSummary\r\n==========\r\n----------\r\n\r\nIn this article, you learned how to specify search criteria to filter data using the WHERE clause of the SELECT statement. You also learned how to use various WHERE clause operators.','2014-10-22 19:07:26','2014-10-22 19:11:07'),(1011,'SQL Basics : Advanced Search Conditions','Objective\r\n==========\r\n----------\r\n\r\nLearn how to combine WHERE clauses to create advanced data filters and how to use NOT and IN operators.\r\n\r\nMultiple Conditions in WHERE Clauses\r\n==========\r\n----------\r\n\r\nYou can use more than one search criteria by combining where clauses with AND or OR clauses. The AND and OR is known as logical operators.\r\n\r\nCreate the table and populate some data as follows:\r\n\r\n```sh\r\nsqlite> CREATE TABLE products(\r\n   ...> id int primary key not null,\r\n   ...> price int,\r\n   ...> name char(50),\r\n   ...> user_id int not null)\r\n   ...> ;\r\nsqlite> .tables\r\nproducts  users   \r\nsqlite> INSERT INTO products(id, price, name, user_id)\r\n   ...> VALUES(1, 10, \'Rock\', 1);\r\nsqlite> INSERT INTO products(id, price, name, user_id)\r\n   ...> VALUES(2, 20, \'Sand\', 1);\r\nsqlite> INSERT INTO products(id, price, name, user_id)\r\n   ...> VALUES(3, 30, \'Carrot\', 1);\r\nsqlite> INSERT INTO products(id, price, name, user_id)\r\n   ...> VALUES(4, 40, \'Hammer\', 1);\r\n```\r\n\r\nThe AND Operator\r\n==========\r\n----------\r\n\r\nYou can use AND operator to filter by more than one column as follows:\r\n\r\n```sh\r\nsqlite> select * from products where user_id = 1 AND price < 30;\r\nid          price       name        user_id   \r\n----------  ----------  ----------  ----------\r\n1           10          Rock        1         \r\n2           20          Sand        1\r\n```\r\n\r\nWe have two conditions that is joined by the AND logical operator. In this case the user_id must be 1 and the price must be less than 30. We have 4 records as demonstrated below:\r\n\r\n```sh\r\nsqlite> select * from products;\r\nid          price       name        user_id   \r\n----------  ----------  ----------  ----------\r\n1           10          Rock        1         \r\n2           20          Sand        1         \r\n3           30          Carrot      1         \r\n4           40          Hammer      1\r\n```\r\n\r\nWe found only two records when we applied the multiple conditions to the query. You can have as many conditions as you want separated by AND keyword.\r\n\r\nThe OR Operator\r\n==========\r\n----------\r\n\r\nThe OR operator is used to retrieve rows that match any of the condition in the WHERE clause. Insert two records for product that belongs to different users.\r\n\r\n```sh\r\nsqlite> INSERT INTO products(id, price, name, user_id)\r\n   ...> VALUES(5, 40, \'Tree\', 2);\r\nsqlite> INSERT INTO products(id, price, name, user_id)\r\n   ...> VALUES(6, 80, \'Cage\', 3);\r\n```\r\n\r\nLet\'s retrieve all products that belong to user with id 2 or 3:\r\n\r\n```sh\r\nsqlite> select id, name, price from products where user_id=2 OR user_id = 3;\r\nid          name        price     \r\n----------  ----------  ----------\r\n5           Tree        40        \r\n6           Cage        80\r\n```\r\n\r\nCombining AND and OR Operators\r\n==========\r\n----------\r\n\r\nUse parenthesis to group multiple conditions to avoid problems due to the order of evaluation of the logical operators. Here is an example to combine logical operators:\r\n\r\n```sh\r\nselect id, user_id, name, price from products where (user_id = 1 OR user_id = 2) AND price > 30;\r\nid          user_id     name        price     \r\n----------  ----------  ----------  ----------\r\n4           1           Hammer      40        \r\n5           2           Tree        40\r\n```\r\n\r\nYou can see that there are 5 products that does not have the condition to filter products with price greater than 30.\r\n\r\n```sh\r\nsqlite> select id, user_id, name, price from products where user_id = 1 OR user_id = 2;\r\nid          user_id     name        price     \r\n----------  ----------  ----------  ----------\r\n1           1           Rock        10        \r\n2           1           Sand        20        \r\n3           1           Carrot      30        \r\n4           1           Hammer      40        \r\n5           2           Tree        40\r\n```\r\n\r\nThe IN Operator\r\n==========\r\n----------\r\n\r\nThe IN operator is used to specify a range of conditions. The results contain matches that satisfy any of the conditions.\r\n\r\n```sh\r\nsqlite> select user_id, name, price from products where user_id IN (1,2,5);\r\nuser_id     name        price     \r\n----------  ----------  ----------\r\n1           Rock        10        \r\n1           Sand        20        \r\n1           Carrot      30        \r\n1           Hammer      40        \r\n2           Tree        40\r\n```\r\n\r\nIn this example there are four rows that match the first value in the comma separated list, just one row for the second value and  no rows for user_id = 5, because there is products that belongs to user_id = 5.\r\n\r\n```sh\r\nselect user_id from products;\r\nuser_id   \r\n----------\r\n1         \r\n1         \r\n1         \r\n1         \r\n2         \r\n3\r\n```\r\n\r\nThere are products only for user_id = 1, 2 and 3.\r\n\r\nThe NOT Operator\r\n==========\r\n----------\r\n\r\nThe NOT is a negation operator that is always used in conjunction with another operator.\r\n\r\n```sh\r\nsqlite> select * from products where NOT user_id = 1;\r\nid          price       name        user_id   \r\n----------  ----------  ----------  ----------\r\n5           40          Tree        2         \r\n6           80          Cage        3\r\n```\r\n\r\nHere we retrieve all rows that does not belong to user_id = 1. \r\n\r\nWe could have accomplished the same thing with the <> operator as follows:\r\n\r\n```sh\r\nsqlite> select * from products where user_id <> 1;\r\nid          price       name        user_id   \r\n----------  ----------  ----------  ----------\r\n5           40          Tree        2         \r\n6           80          Cage        3\r\n```\r\n\r\nSummary\r\n==========\r\n----------\r\n\r\nIn this article you learned how to use multiple conditions with WHERE clauses by combining AND and OR operators. You also learned how to use the IN and NOT operators.','2014-10-23 20:51:54','2014-10-23 20:59:33'),(1021,'SQL Basics : Wildcard Search','Objective\r\n==========\r\n----------\r\n\r\nIn this article you will learn how to use wildcard for searches using the LIKE operator.\r\n\r\nThe LIKE Operator\r\n==========\r\n----------\r\n\r\nThe Percent Wildcard\r\n----------\r\n\r\nLet\'s insert few more rows to the products table.\r\n\r\n```sh\r\nsqlite> INSERT INTO products(id, price, name, user_id)\r\n   ...> VALUES(7, 80, \'Cage Wire\', 3);\r\nsqlite> INSERT INTO products(id, price, name, user_id)\r\n   ...> VALUES(8, 80, \'Camel Rope\', 3);\r\n```\r\n\r\nThe wildcard search can only be used with string fields. Let\'s search for product names that has \'Ca\' in it.\r\n\r\n```sh\r\nsqlite> select id, name from products where name LIKE \'Ca%\';\r\nid          name      \r\n----------  ----------\r\n3           Carrot    \r\n6           Cage      \r\n7           Cage Wire \r\n8           Camel Rope\r\n```\r\n\r\nIf we do :\r\n\r\n```sh\r\nsqlite> select id, name from products where name LIKE \'age%\';\r\n```\r\n\r\nWe don\'t get any results, to find the product with Cage and Cage Wire, we can modify the query as follows:\r\n\r\n```sh\r\nsqlite> select id, name from products where name LIKE \'%age%\';\r\nid          name      \r\n----------  ----------\r\n6           Cage      \r\n7           Cage Wire\r\n```\r\n\r\nSo, the percent sign in the beginning matches any number of occurrences of any character before the letter \'a\'. The percent sign at the end of \'age\' matches any number of occurrences of any character after the string \'age\'.\r\n\r\n\r\nWe can use the wildcard character anywhere in the string:\r\n\r\n```sh\r\nsqlite> select id, name from products where name LIKE \'C%e\';\r\nid          name      \r\n----------  ----------\r\n6           Cage      \r\n7           Cage Wire \r\n8           Camel Rope\r\n```\r\n\r\nHere we search for products that begins with the letter \'C\' and has any number of characters after that and ends in the letter \'e\'.\r\n\r\nThe Underscore Wildcard\r\n----------\r\n\r\nThe underscore wildcard is used to match just a single character. Here is an example:\r\n\r\n```sh\r\nsqlite> select id, name from products where name LIKE \'_ock\';\r\nid          name      \r\n----------  ----------\r\n1           Rock\r\n```\r\n\r\nHere we match product with the name that has any letter before the \'ock\'. We can also combine both the wildcards:\r\n\r\n```sh\r\nsqlite> select id, name from products where name LIKE \'_am%\';\r\nid          name      \r\n----------  ----------\r\n4           Hammer    \r\n8           Camel Rope\r\n```\r\n\r\nSummary\r\n==========\r\n----------\r\n\r\nIn this article you learned how to use wildcards to search text fields in the WHERE clause. You learned about the percent and the underscore wildcards.\r\n','2014-10-23 22:49:07','2014-10-23 22:49:07'),(1031,'SQL Basics : Calculated Fields','Objective\r\n==========\r\n----------\r\n\r\nTo learn about calculated fields.\r\n\r\nCalculated Fields\r\n==========\r\n----------\r\n\r\nCalculated fields are useful to calculate total, averages or other calculations based on table data. The calculated field does not exist in the tables, it is created on demand within a SELECT statement. Why do we need to let the database do the calculation instead of doing it in your client code? Because it is faster to perform the calculations on the database server.\r\n\r\nConcatenating Fields\r\n==========\r\n----------\r\n\r\nLet\'s display the name of all the users by concatenating the first_name and last_name.\r\n\r\n```sh\r\nsqlite> select first_name || \' \' || last_name from users;\r\nfirst_name || \' \' || last_name\r\n------------------------------\r\nbugs bunny                    \r\ndaffy duck                    \r\nporky pig                     \r\npluto dog                     \r\npluto pet                     \r\ntasmanian devil               \r\ntweety bird                   \r\nelmer fudd                    \r\nspeedy gonzales               \r\nyosemite sam                  \r\nsylvester\r\n```\r\n\r\nHere we are using the two pipes || operator to concatenate first_name and last_name. You can change the name of the resulting header to name by using the AS keyword. The new header \'name\' is an alias for the concatenated field.\r\n\r\n```sh\r\nsqlite> select first_name || \' \' || last_name as name from users;\r\nname      \r\n----------\r\nbugs bunny\r\ndaffy duck\r\nporky pig \r\npluto dog \r\npluto pet \r\ntasmanian \r\ntweety bir\r\nelmer fudd\r\nspeedy gon\r\nyosemite s\r\nsylvester\r\n```\r\n\r\nThe last name is getting cut-off. Let\'s fix that by specifying the width for the columns.\r\n\r\n```sh\r\nsqlite> .width 20 20\r\nsqlite> select first_name || \' \' || last_name as name from users;\r\nname                \r\n--------------------\r\nbugs bunny          \r\ndaffy duck          \r\nporky pig           \r\npluto dog           \r\npluto pet           \r\ntasmanian devil     \r\ntweety bird         \r\nelmer fudd          \r\nspeedy gonzales     \r\nyosemite sam        \r\nsylvester           \r\n```                    \r\n\r\nPerforming Calculations\r\n==========\r\n----------\r\n\r\nLet\'s create a line_items table.\r\n\r\n```sh\r\nsqlite> CREATE TABLE line_items(\r\n   ...> id int primary key not null,\r\n   ...> product_id int not null,\r\n   ...> quantity int,\r\n   ...> price real,\r\n   ...> order_number int);\r\nsqlite> .tables\r\nline_items  products    users\r\n```\r\n\r\nPopulate line_times with some sample data.\r\n\r\n```sh\r\nsqlite> INSERT INTO line_items(id, product_id, quantity, price, order_number)\r\n   ...> VALUES(1, 1, 4, 10, 1);\r\nsqlite> INSERT INTO line_items(id, product_id, quantity, price, order_number)\r\n   ...> VALUES(2, 3, 10, 10, 1);\r\nsqlite> INSERT INTO line_items(id, product_id, quantity, price, order_number)\r\n   ...> VALUES(3, 2, 1, 40, 1);\r\nsqlite> INSERT INTO line_items(id, product_id, quantity, price, order_number)\r\n   ...> VALUES(4, 4, 15, 30, 1);\r\n```\r\n\r\nWe now have four rows in line_items table.\r\n\r\n```sh\r\nsqlite> select * from line_items;\r\nid                    product_id            quantity    price       order_number\r\n--------------------  --------------------  ----------  ----------  ------------\r\n1                     1                     4           10.0        1           \r\n3                     2                     1           40.0        1           \r\n2                     3                     10          10.0        1           \r\n4                     4                     15          30.0        1\r\n```\r\n\r\nLet\'s calculate line_item_price for each of the line_items :\r\n\r\n```sh\r\nsqlite> select product_id, quantity, price, quantity * price AS line_item_price from line_items;\r\nproduct_id            quantity              price       line_item_price\r\n--------------------  --------------------  ----------  ---------------\r\n1                     4                     10.0        40.0           \r\n2                     1                     40.0        40.0           \r\n3                     10                    10.0        100.0          \r\n4                     15                    30.0        450.0\r\n```\r\n\r\nThe last column shows the line_item_price for each row in the line_items table. You can add, subtract, multiply and divide to perform any mathematical calculations.\r\n\r\nSummary\r\n==========\r\n----------\r\n\r\nIn this article you learned how to use calculated fields and why it is used. You also learned about the aliases for the calculated fields.','2014-10-23 23:54:37','2014-10-23 23:54:37'),(1041,'SQL Basics : Aggregate Functions','Objective\r\n==========\r\n----------\r\n\r\nIn this article, you will learn how to use aggregate functions in SQL to summarize table data.\r\n\r\nAggregate Functions\r\n==========\r\n----------\r\n\r\nSQL provides functions to summarize data without retrieving data. This saves the bandwidth and avoids unnecessary retrieval of data. This is useful for analysis and reporting purposes. These functions can compute number of rows in a table, calculating sum of a set of rows in a table, finding highest, lowest and average values in a table column. \r\n\r\n\r\nThe AVG() Function\r\n==========\r\n----------\r\n\r\nHere is the average function :\r\n\r\n```sh\r\nsqlite> select AVG(price) AS average_price from products;\r\naverage_price       \r\n--------------------\r\n47.5\r\n```\r\n\r\nThis query calculates the average price of all the products. You can also calculate average price for a subset of rows.\r\n\r\n```sh\r\nsqlite> select AVG(price) AS average_price from products where user_id = 1;\r\naverage_price       \r\n--------------------\r\n25.0\r\n```\r\n\r\nIn this example we calculate the average price of all products for a user with user_id = 1.\r\n\r\nThe COUNT function\r\n==========\r\n----------\r\n\r\nLet\'s count the number of products in the products table.\r\n\r\n```sh\r\nsqlite> select count(*) from products;\r\ncount(*)            \r\n--------------------\r\n8\r\n```\r\n\r\nCurrently, we have 8 products. We have 12 rows in the users table.\r\n\r\n```sh\r\nsqlite> select * from users;\r\nid                    first_name            last_name   email            \r\n--------------------  --------------------  ----------  -----------------\r\n1                     bugs                  bunny       bbunny@disney.com\r\n2                     daffy                 duck        daffy@disney.com \r\n3                     porky                 pig         ppig@disney.com  \r\n4                     pluto                 dog         pdog@disney.com  \r\n5                     pluto                 pet         pdog@disney.com  \r\n6                     tasmanian             devil       tdevil@disney.com\r\n7                     tweety                bird        tweety@disney.com\r\n8                     elmer                 fudd        efudd@disney.com \r\n9                     speedy                gonzales    gonzales@disney.c\r\n10                    yosemite              sam         sam@disney.com   \r\n11                    sylvester                         sam@disney.com   \r\n12                    bosko                             sam@disney.com   \r\n```\r\n\r\nWe get 12 when we count the users table.\r\n\r\n```sh\r\nsqlite> select count(*) from users;\r\ncount(*)            \r\n--------------------\r\n12   \r\n```\r\n\r\nIf we want to ignore NULL values and count only the number of rows that have values in a specific column, we can use count(column_name).\r\n\r\n```sh               \r\nsqlite> select count(last_name) from users;\r\ncount(last_name)    \r\n--------------------\r\n11                  \r\n```\r\n\r\nAlthough we see two blank values in the last_name column, we see 11 because only one of the column is NULL. We can find out which row it is by firing this query:\r\n\r\n```sh\r\nsqlite> select * from users where last_name is NULL;\r\nid                    first_name            last_name   email         \r\n--------------------  --------------------  ----------  --------------\r\n12                    bosko                             sam@disney.com\r\n```\r\n\r\nThe other record contains a blank string, we can find the row with blank string using this query:\r\n\r\n```sh\r\nsqlite> select * from users where last_name =\'\';\r\nid                    first_name            last_name   email         \r\n--------------------  --------------------  ----------  --------------\r\n11                    sylvester                         sam@disney.com\r\n```\r\n\r\nWe can provide a different name for the column name using AS keyword:\r\n\r\n```sh\r\nsqlite> select count(last_name) as last_name_count from users;\r\nlast_name_count     \r\n--------------------\r\n11\r\n```\r\n\r\nThe MAX function\r\n==========\r\n----------\r\n\r\nLet\'s find the most expensive product.\r\n\r\n```sh\r\nsqlite> select MAX(price) from products;\r\nMAX(price)          \r\n--------------------\r\n80\r\n```\r\n\r\nExercise\r\n==========\r\n----------\r\n\r\nChange the above query so that the name of the column is called \'Most Expensive\'.\r\n\r\nThe MIN Function\r\n==========\r\n----------\r\n\r\nLet\'s find the cheapest product.\r\n\r\n```sh\r\nsqlite> select MIN(price) from products;\r\nMIN(price)          \r\n--------------------\r\n10\r\n```\r\n\r\nThe SUM Function\r\n==========\r\n----------\r\n\r\n```sh\r\nsqlite> select SUM(quantity) as ordered_items from line_items where order_number = 1;\r\nordered_items       \r\n--------------------\r\n30\r\n```\r\n\r\nThe SUM function returns the sum of all the quantity in the line_items table, the WHERE clause restricts it to the order_number = 1.\r\n\r\n```sh\r\nsqlite> select * from line_items where order_number = 1;\r\nid                    product_id            quantity    price       order_number\r\n--------------------  --------------------  ----------  ----------  ------------\r\n1                     1                     4           10.0        1           \r\n3                     2                     1           40.0        1           \r\n2                     3                     10          10.0        1           \r\n4                     4                     15          30.0        1           \r\n```\r\n\r\nThere is data for line_items for only one order. If you add all the columns under the quantity, you get 30. We can also use SUM to total calculated values. Here is an example to calculate the total amount for order with order_number = 1.\r\n\r\n```sh\r\nsqlite> select SUM(price * quantity) AS Total from line_items where order_number = 1;\r\nTotal               \r\n--------------------\r\n630.0               \r\n```\r\n\r\nThis is the total amount that a customer would pay when they checkout the cart on the online store. \r\n\r\n```sh\r\nsqlite> select * from line_items;\r\nid                    product_id            quantity    price       order_number\r\n--------------------  --------------------  ----------  ----------  ------------\r\n1                     1                     4           10.0        1           \r\n3                     2                     1           40.0        1           \r\n2                     3                     10          10.0        1           \r\n4                     4                     15          30.0        1           \r\n```\r\n\r\nYou can double check the calculated answer by multiplying the quantity and price and adding them up.\r\n\r\nCombining Aggregate Functions\r\n==========\r\n----------\r\n\r\nHere is an example that combines aggregate functions.\r\n\r\n```sh\r\nsqlite> select count(*) as count, \r\n			   avg(price) as average_price, \r\n			   max(price) as maximum_price, \r\n			   min(price) as minimum_price from products;\r\ncount                 average_price         maximum_price  minimum_price\r\n--------------------  --------------------  -------------  -------------\r\n8                     47.5                  80             10\r\n```\r\n\r\nSummary\r\n==========\r\n----------\r\n\r\nIn this article, you learned about aggregate functions. They are faster than if you were to calculate these values in your code. They can be combined together to perform powerful calculations quickly.','2014-10-24 00:50:57','2014-10-24 00:50:57'),(1051,'SQL Basics : Grouping Data','Objective\r\n==========\r\n----------\r\n\r\nTo learn how to group data using GROUP BY and HAVING clause in the SELECT statement.\r\n\r\nWhy Group Data?\r\n==========\r\n----------\r\n\r\nIn the previous article you learned aggregate functions that performed calculations on all the data in a table or on data that satisfied a specific condition of the WHERE clause. We were able to count the number of products. If we want to count the number of products for each user we need to use grouping. Grouping allows us to divide data into logical sets and perform aggregate calculations on each group.\r\n\r\nGroup By Clause\r\n==========\r\n----------\r\n\r\nLet\'s count the number of products that belong to each user in the products table.\r\n\r\n```sh\r\nsqlite> select user_id, count(*) as product_count from products group by user_id;\r\nuser_id               product_count       \r\n--------------------  --------------------\r\n1                     4                   \r\n2                     1                   \r\n3                     3                   \r\n```\r\n\r\nThe result shows that the user with user_id = 1 has 4 products, user_id = 2 has 1 product and user_id = 3 has 3 products. You can verify this by manually calculating the number of products from the following query.\r\n\r\n```sh\r\nsqlite> select * from products;\r\nid                    price                 name        user_id   \r\n--------------------  --------------------  ----------  ----------\r\n1                     10                    Rock        1         \r\n2                     20                    Sand        1         \r\n3                     30                    Carrot      1         \r\n4                     40                    Hammer      1         \r\n5                     40                    Tree        2         \r\n6                     80                    Cage        3         \r\n7                     80                    Cage Wire   3         \r\n8                     80                    Camel Rope  3\r\n```\r\nYou can see that the user with user_id has only one product whereas users with user_id 1 and 3 have 4 and 3 products respectively.\r\n\r\nHaving Clause\r\n==========\r\n----------\r\n\r\nYou can filter groups to include and exclude by using Having clause.\r\n\r\n```sh\r\nsqlite> select user_id, count(*) as count from products group by user_id having count(*) > 2;\r\nuser_id               count               \r\n--------------------  --------------------\r\n1                     4                   \r\n3                     3                   \r\n```\r\n\r\nThe having clause filters on the group and finds only the rows that has more than 2 products for the user. You can verify this by looking at the records.\r\n\r\n```sh\r\nsqlite> select * from products;\r\nid                    price                 name        user_id   \r\n--------------------  --------------------  ----------  ----------\r\n1                     10                    Rock        1         \r\n2                     20                    Sand        1         \r\n3                     30                    Carrot      1         \r\n4                     40                    Hammer      1         \r\n5                     40                    Tree        2         \r\n6                     80                    Cage        3         \r\n7                     80                    Cage Wire   3         \r\n8                     80                    Camel Rope  3\r\n```\r\n\r\nYou see there is only one user with user_id = 2 with the number of products less than or equal to 2.\r\n\r\nSummary\r\n==========\r\n----------\r\n\r\nIn this article you learned how to use the GROUP BY and HAVIN clauses to perform aggregate functions on groups of data.','2014-10-24 01:51:48','2014-10-24 01:53:56'),(1061,'SQL Basics : Subqueries','Objective\r\n==========\r\n----------\r\n\r\nTo learn how to use subqueries.\r\n\r\nSubqueries\r\n==========\r\n----------\r\n\r\nSubqueries are queries that are embedded into other queries. \r\n\r\nLet\'s create the orders table.\r\n\r\n```sh\r\nsqlite> CREATE TABLE orders(\r\n   ...> id int primary key not null,\r\n   ...> confirmation char(50),\r\n   ...> customer_id int not null,\r\n   ...> created_at datetime default current_timestamp\r\n   ...> );\r\n```\r\n\r\nLet\'s insert some records into the order table.\r\n\r\n```sh\r\nsqlite> INSERT INTO orders(id, confirmation, customer_id)\r\n   ...> VALUES(1, 1, 1);\r\nsqlite> INSERT INTO orders(id, confirmation, customer_id)\r\n   ...> VALUES(2, 2, 1);\r\nsqlite> INSERT INTO orders(id, confirmation, customer_id)   \r\n...> VALUES(3, 3, 2);\r\n```\r\n\r\nLet\'s create customers table.\r\n\r\n```sh\r\nsqlite> CREATE TABLE customers(\r\n   ...> id int primary key not null,\r\n   ...> name char(50),\r\n   ...> email char(50)\r\n   ...> );\r\n```\r\n\r\nLet\'s insert some records into the customers table.\r\n\r\n```sh\r\nsqlite> INSERT INTO customers(id, name, email)\r\n   ...> VALUES(1, \'Big Spender\', \'bspender@example.com\');\r\nsqlite> INSERT INTO customers(id, name, email)\r\n   ...> VALUES(2, \'Big Saver\', \'bsaver@example.com\');\r\n```\r\n\r\nProblem\r\n----------\r\n\r\nList all customers who ordered item with product_id = 1: \r\n\r\nStep 1\r\n----------\r\n\r\n```sh\r\nsqlite> select order_number from line_items where product_id = 1;\r\norder_number\r\n------------\r\n1\r\n```\r\n\r\nStep 2\r\n----------\r\n\r\n```sh\r\nsqlite> select customer_id from orders where id = 1;\r\ncustomer_id\r\n-----------\r\n1\r\n```\r\n\r\nWe use the order_number retrieved from step 1 as the value for id because, id is the primary key of orders and order_number in line_items is basically the order_id. It should have been named order_id to be clear.\r\n\r\nStep 3\r\n----------\r\n\r\n```sh\r\nsqlite> select customer_id from orders where id IN (select order_number from line_items where product_id = 1);\r\ncustomer_id\r\n-----------\r\n1\r\n```\r\n\r\nWe can have subquery that finds the primary key of orders as above. Now we can list the customer details as follows.\r\n\r\n```sh\r\nsqlite> select name, email from customers where id IN (select customer_id from orders where id IN (select order_number from line_items where product_id = 1));\r\nname         email               \r\n-----------  --------------------\r\nBig Spender  bspender@example.com\r\n```\r\n\r\nSubqueries as Calculated Fields\r\n==========\r\n----------\r\n\r\nLet\'s find out the total number of orders placed by every customer in the customers table. Orders table has the orders with the corresponding customer_id. We have two steps:\r\n\r\n1. Get the list of customers from customers table.\r\n2. For each customer, count the number of orders placed from the orders table. \r\n\r\n```sh\r\nsqlite> select count(*) as number_of_orders from orders where customer_id = 1;\r\nnumber_of_orders\r\n----------------\r\n2               \r\nsqlite> select count(*) as number_of_orders from orders where customer_id = 2;\r\nnumber_of_orders\r\n----------------\r\n1\r\n```\r\n\r\nHere is the subquery that uses calculated fields.\r\n\r\n```sh\r\nsqlite> select name, (select count(*) from orders where orders.customer_id = customers.id) as number_of_orders from customers;\r\nname         number_of_orders\r\n-----------  ----------------\r\nBig Spender  2               \r\nBig Saver    1\r\n```\r\n\r\nTo avoid ambiguity we have the order.customer_id = customers.id, this relates the orders table and the customers table.\r\n\r\nSummary\r\n==========\r\n----------\r\n\r\nIn this article, you learned how to use subqueries in WHERE clause IN operators and for populating calculated columns.\r\n','2014-10-25 01:33:55','2014-10-25 01:33:55'),(1071,'SQL Basics : Joins','Objective\r\n==========\r\n----------\r\n\r\nLearn the why and how to use joins.\r\n\r\nWhy Joins?\r\n==========\r\n----------\r\n\r\nWe currently have products and users table. Here is the list of records they contain.\r\n\r\n```sh\r\nsqlite> select * from products;\r\nid          price       name        user_id   \r\n----------  ----------  ----------  ----------\r\n1           10          Rock        1         \r\n2           20          Sand        1         \r\n3           30          Carrot      1         \r\n4           40          Hammer      1         \r\n5           40          Tree        2         \r\n6           80          Cage        3         \r\n7           80          Cage Wire   3         \r\n8           80          Camel Rope  3         \r\nsqlite> select * from users;\r\nid          first_name  last_name   email            \r\n----------  ----------  ----------  -----------------\r\n1           bugs        bunny       bbunny@disney.com\r\n2           daffy       duck        daffy@disney.com \r\n3           porky       pig         ppig@disney.com  \r\n4           pluto       dog         pdog@disney.com  \r\n5           pluto       pet         pdog@disney.com  \r\n6           tasmanian   devil       tdevil@disney.com\r\n7           tweety      bird        tweety@disney.com\r\n8           elmer       fudd        efudd@disney.com \r\n9           speedy      gonzales    gonzales@disney.c\r\n10          yosemite    sam         sam@disney.com   \r\n11          sylvester               sam@disney.com   \r\n12          bosko                   sam@disney.com\r\n```\r\n\r\nWe are storing the name and email in it\'s own table instead of storing it in products table. Updating the users information becomes easy since it is in just one place. This also saves storage space. The users and products table are related to each other through common values. In this case the user_id ties a row in the product to a user in the users table. The id in users and products uniquely identifies a row in that table. This id field is called a primary key. \r\n\r\nThe join is used to retrieve data from multiple tables with a single SELECT statement. A single set of output is returned by matching the correct rows in the multiple tables on the fly.\r\n\r\nJoin\r\n==========\r\n----------\r\n\r\nThe FROM clause in the SELECT select includes all the tables to be joined and they are related to each other. \r\n\r\n```sh\r\nsqlite> select first_name as user_name, name as product_name, price as product_price from users, products where users.id = products.user_id;\r\nuser_name   product_name  product_price\r\n----------  ------------  -------------\r\nbugs        Rock          10           \r\nbugs        Sand          20           \r\nbugs        Carrot        30           \r\nbugs        Hammer        40           \r\ndaffy       Tree          40           \r\nporky       Cage          80           \r\nporky       Cage Wire     80           \r\nporky       Camel Rope    80\r\n```\r\n\r\nThe first_name is in the users table whereas the product name and product price is in the products table. The FROM clause has tables separated by comma. These are the tables to be joined. The WHERE clause specifies that primary key in users table (users.id) must match the foreign key of the user in products table (products.user_id). The output shows data from two different tables retrieved using a single SELECT statement. Let\'s see what happens when we don\'t have the WHERE clause.\r\n\r\n```sh\r\nsqlite> select first_name, name, price from users, products;\r\nfirst_name  name        price     \r\n----------  ----------  ----------\r\nbugs        Rock        10        \r\nbugs        Sand        20        \r\nbugs        Carrot      30        \r\nbugs        Hammer      40        \r\nbugs        Tree        40        \r\nbugs        Cage        80        \r\nbugs        Cage Wire   80        \r\nbugs        Camel Rope  80        \r\ndaffy       Rock        10        \r\ndaffy       Sand        20        \r\ndaffy       Carrot      30        \r\ndaffy       Hammer      40        \r\ndaffy       Tree        40        \r\ndaffy       Cage        80        \r\ndaffy       Cage Wire   80        \r\ndaffy       Camel Rope  80        \r\nporky       Rock        10        \r\nporky       Sand        20        \r\nporky       Carrot      30        \r\nporky       Hammer      40        \r\nporky       Tree        40        \r\nporky       Cage        80        \r\nporky       Cage Wire   80        \r\nporky       Camel Rope  80        \r\npluto       Rock        10        \r\npluto       Sand        20        \r\npluto       Carrot      30        \r\npluto       Hammer      40        \r\npluto       Tree        40        \r\npluto       Cage        80        \r\npluto       Cage Wire   80        \r\npluto       Camel Rope  80        \r\npluto       Rock        10        \r\npluto       Sand        20        \r\npluto       Carrot      30        \r\npluto       Hammer      40        \r\npluto       Tree        40        \r\npluto       Cage        80        \r\npluto       Cage Wire   80        \r\npluto       Camel Rope  80        \r\ntasmanian   Rock        10        \r\ntasmanian   Sand        20        \r\ntasmanian   Carrot      30        \r\ntasmanian   Hammer      40        \r\ntasmanian   Tree        40        \r\ntasmanian   Cage        80        \r\ntasmanian   Cage Wire   80        \r\ntasmanian   Camel Rope  80        \r\ntweety      Rock        10        \r\ntweety      Sand        20        \r\ntweety      Carrot      30        \r\ntweety      Hammer      40        \r\ntweety      Tree        40        \r\ntweety      Cage        80        \r\ntweety      Cage Wire   80        \r\ntweety      Camel Rope  80        \r\nelmer       Rock        10        \r\nelmer       Sand        20        \r\nelmer       Carrot      30        \r\nelmer       Hammer      40        \r\nelmer       Tree        40        \r\nelmer       Cage        80        \r\nelmer       Cage Wire   80        \r\nelmer       Camel Rope  80        \r\nspeedy      Rock        10        \r\nspeedy      Sand        20        \r\nspeedy      Carrot      30        \r\nspeedy      Hammer      40        \r\nspeedy      Tree        40        \r\nspeedy      Cage        80        \r\nspeedy      Cage Wire   80        \r\nspeedy      Camel Rope  80        \r\nyosemite    Rock        10        \r\nyosemite    Sand        20        \r\nyosemite    Carrot      30        \r\nyosemite    Hammer      40        \r\nyosemite    Tree        40        \r\nyosemite    Cage        80        \r\nyosemite    Cage Wire   80        \r\nyosemite    Camel Rope  80        \r\nsylvester   Rock        10        \r\nsylvester   Sand        20        \r\nsylvester   Carrot      30        \r\nsylvester   Hammer      40        \r\nsylvester   Tree        40        \r\nsylvester   Cage        80        \r\nsylvester   Cage Wire   80        \r\nsylvester   Camel Rope  80        \r\nbosko       Rock        10        \r\nbosko       Sand        20        \r\nbosko       Carrot      30        \r\nbosko       Hammer      40        \r\nbosko       Tree        40        \r\nbosko       Cage        80        \r\nbosko       Cage Wire   80        \r\nbosko       Camel Rope  80\r\n```\r\n\r\nThe output now has every row in the users table paired with every row in the products table. They are paired without considering any logical relationship between them exists or not. The is called the Cartesian Product and the number of rows returned will be equal to the number of rows in users table multiplied by the number of rows in the products table. \r\n\r\nSummary\r\n==========\r\n----------\r\n\r\nIn this article you learned the basics of joins and how to use them. You also learned about Cartesian Product. In the next article we will explore inner joins. ','2014-10-25 18:54:04','2014-10-25 18:54:04'),(1081,'SQL Basics : Inner Join','Objective\r\n==========\r\n----------\r\n\r\nLearn how to use inner joins\r\n\r\nInner Joins\r\n==========\r\n----------\r\n\r\nIn the previous article on Joins, the join we used is called as equijoin or inner join. It is called inner join because it is the intersection of the two tables. If you had two circles to represent two tables, the common overlapping area is the inner join of those two tables. Here is an example:\r\n\r\n```sh\r\nsqlite> select first_name as user_name, name as product_name, price as product_price from users INNER JOIN products ON users.id = products.user_id;\r\nuser_name   product_name  product_price\r\n----------  ------------  -------------\r\nbugs        Rock          10           \r\nbugs        Sand          20           \r\nbugs        Carrot        30           \r\nbugs        Hammer        40           \r\ndaffy       Tree          40           \r\nporky       Cage          80           \r\nporky       Cage Wire     80           \r\nporky       Camel Rope    80\r\n```\r\n\r\nInstead of comma separating the tables as we saw in the previous article on join, here we have INNER JOIN between the table names. The WHERE clause is replaced by ON keyword. Here is the query we used in the previous article, you can compare both the queries and see the difference.\r\n\r\n```sh\r\nsqlite> select first_name as user_name, name as product_name, price as product_price from users, products WHERE users.id = products.user_id;\r\nuser_name   product_name  product_price\r\n----------  ------------  -------------\r\nbugs        Rock          10           \r\nbugs        Sand          20           \r\nbugs        Carrot        30           \r\nbugs        Hammer        40           \r\ndaffy       Tree          40           \r\nporky       Cage          80           \r\nporky       Cage Wire     80           \r\nporky       Camel Rope    80\r\n```\r\n\r\nThe query is different, but the output is the same in both cases.\r\n\r\nJoining Multiple Tables\r\n==========\r\n----------\r\n\r\nYou can join as many tables as you want. You have to list all the tables and define the relationship between them. Let\'s consider an example where we need to display product name, user name, product price and quantity for an order with order_number = 1. We know that product name and product price are stored in the products table. The user name is stored in the users table and the quantity is in the line_items table. Before we join these tables, let\'s take a look at the data to help us form the query.\r\n\r\n```sh\r\nsqlite> select * from line_items;\r\nid          product_id  quantity    price       order_number\r\n----------  ----------  ----------  ----------  ------------\r\n1           1           4           10.0        1           \r\n3           2           1           40.0        1           \r\n2           3           10          10.0        1           \r\n4           4           15          30.0        1           \r\nsqlite> select * from products;\r\nid          price       name        user_id   \r\n----------  ----------  ----------  ----------\r\n1           10          Rock        1         \r\n2           20          Sand        1         \r\n3           30          Carrot      1         \r\n4           40          Hammer      1         \r\n5           40          Tree        2         \r\n6           80          Cage        3         \r\n7           80          Cage Wire   3         \r\n8           80          Camel Rope  3         \r\nsqlite> select * from users;\r\nid          first_name  last_name   email            \r\n----------  ----------  ----------  -----------------\r\n1           bugs        bunny       bbunny@disney.com\r\n2           daffy       duck        daffy@disney.com \r\n3           porky       pig         ppig@disney.com  \r\n4           pluto       dog         pdog@disney.com  \r\n5           pluto       pet         pdog@disney.com  \r\n6           tasmanian   devil       tdevil@disney.com\r\n7           tweety      bird        tweety@disney.com\r\n8           elmer       fudd        efudd@disney.com \r\n9           speedy      gonzales    gonzales@disney.c\r\n10          yosemite    sam         sam@disney.com   \r\n11          sylvester               sam@disney.com   \r\n12          bosko                   sam@disney.com\r\n```\r\n\r\nLet\'s now join these three tables to get the data.\r\n\r\n```sh\r\nsqlite> select name, first_name, price, quantity from line_items, products, users \r\n   ...> where products.user_id = users.id\r\n   ...> and line_items.product_id = products.id\r\n   ...> and order_number = 1;\r\nError: ambiguous column name: price\r\n```\r\n\r\nWe get this error because we have price column in line_times as well as the products table. So we need to explicitly indicate which table the price column we are interested in resides. We can do that by prefixing the price with the name of the table as follows:\r\n\r\n```sh\r\nsqlite> select name, first_name, line_items.price, quantity from line_items, products, users\r\n   ...> where products.user_id = users.id\r\n   ...> and line_items.product_id = products.id\r\n   ...> and order_number = 1;\r\nname        first_name  price       quantity  \r\n----------  ----------  ----------  ----------\r\nRock        bugs        10.0        4         \r\nSand        bugs        40.0        1         \r\nCarrot      bugs        10.0        10        \r\nHammer      bugs        30.0        15\r\n```\r\n\r\nWe had to specify line_items.price to avoid ambiguity. The WHERE clauses are separated by AND keyword to specify the relationships between the tables. The foreign key in the products table user_id is the primary key in users table id. This is the first condition of the WHERE clause. The condition relates the foreign key product_id in the line_items table to the primary key of products, id in the products table. The final order_number = 1 condition filters the results only for that order.\r\n\r\nYou might be wondering why I picked line_items price column instead of products\' price column. The reason is that once the line_items is created the price column will not change. The price column in the products table can be changed by the user who owns it anytime. This avoids people who are shopping our products getting confused by sudden changes in the price of the product they are about to buy.\r\n\r\nExercise\r\n==========\r\n----------\r\n\r\nThe first column in the above output is the name of the product. Change the name of the column from \'name\' to \'product name\'.\r\n\r\nUsing Joins Instead of Subqueries\r\n==========\r\n----------\r\n\r\nIn the previous article on subqueries we had this query:\r\n\r\n```sh\r\nsqlite> select name, email from customers where id IN (select customer_id from orders where id IN (select order_number from line_items where product_id = 1));\r\nname         email               \r\n-----------  --------------------\r\nBig Spender  bspender@example.com\r\n```\r\n\r\nLet\'s use joins instead of subqueries. To create this query, it helps to list all the table to be joined so that you can see the relationship between them. This will be used in the WHERE clauses.\r\n\r\n```sh\r\nsqlite> select * from customers;\r\nid          name         email               \r\n----------  -----------  --------------------\r\n1           Big Spender  bspender@example.com\r\n2           Big Saver    bsaver@example.com  \r\nsqlite> select * from orders;\r\nid          confirmation  customer_id  created_at         \r\n----------  ------------  -----------  -------------------\r\n1           1             1            2014-10-25 00:11:51\r\n2           2             1            2014-10-25 00:14:29\r\n3           3             2            2014-10-25 01:16:10\r\nsqlite> select * from line_items;\r\nid          product_id  quantity    price       order_number\r\n----------  ----------  ----------  ----------  ------------\r\n1           1           4           10.0        1           \r\n3           2           1           40.0        1           \r\n2           3           10          10.0        1           \r\n4           4           15          30.0        1\r\n```\r\n\r\nHere is the query:\r\n\r\n```sh\r\nsqlite> select name, email \r\n   ...> from customers, orders, line_items\r\n   ...> where customers.id = orders.customer_id\r\n   ...> and line_items.order_number = orders.id\r\n   ...> and product_id = 1;\r\nname         email               \r\n-----------  --------------------\r\nBig Spender  bspender@example.com\r\n```\r\n\r\nAs you can see the result is the same as using the subquery. Which one should you use? Prefer joins because it more efficient.\r\n\r\nSummary\r\n==========\r\n----------\r\nIn this article you learned the basics of relationships between tables that is required to use joins. You also learned the most frequently used joins, the inner join. In the next article, we will explore other types of joins.','2014-10-25 20:17:54','2014-10-25 20:24:47'),(1091,'SQL Basics : Advanced Joins','Objective\r\n==========\r\n----------\r\n\r\nTo learn about outer joins and how to use them with aggregate functions.\r\n\r\nData Population\r\n==========\r\n----------\r\n\r\nPopulate a few records into the customers table as follows:\r\n\r\n```sh\r\nsqlite> INSERT INTO customers(id, name, email)\r\n   ...> VALUES(3, \'Big Saver\', \'bsaver2@example.com\');\r\nsqlite> INSERT INTO customers(id, name, email)\r\n   ...> VALUES(4, \'Big Browser\', \'browser@example.com\');\r\n```\r\n\r\nWe now have four records in the customers table.\r\n\r\n```sh\r\nsqlite> select * from customers;                                                                                          \r\nid          name         email               \r\n----------  -----------  --------------------\r\n1           Big Spender  bspender@example.com\r\n2           Big Saver    bsaver@example.com  \r\n3           Big Saver    bsaver2@example.com \r\n4           Big Browser  browser@example.com\r\n```\r\n\r\nSelf Join\r\n==========\r\n----------\r\n\r\nLet\'s get a list of customers who work for the same company for which \'bsaver@example.com\' works. The first query must find out the customer name for \'bsaver@example.com\', where he works. Then, find a list of customers who work for the same company. Here is one way of solving this problem using subquery:\r\n\r\n```sh\r\nsqlite> select id, name, email from customers \r\nwhere name = (select name from customers where email=\'bsaver@example.com\');\r\nid          name        email             \r\n----------  ----------  ------------------\r\n2           Big Saver   bsaver@example.com\r\n3           Big Saver   bsaver2@example.com\r\n```\r\n\r\nHere is another way of solving the problem that uses join.\r\n\r\n```sh\r\nsqlite> select c1.id, c1.name, c1.email from customers as c1, customers as c2 \r\n   ...> where c1.name = c2.name \r\n   ...> and c2.email = \'bsaver@example.com\';\r\nid          name        email             \r\n----------  ----------  ------------------\r\n2           Big Saver   bsaver@example.com\r\n3           Big Saver   bsaver2@example.com\r\n```\r\n\r\nInstead of joining two different tables, in this case we are joining with the same table. The c1 and c2 are aliases for the customers table. The WHERE clause condition filters the customer name that match on both customers table. The second condition of the WHERE clause finds records for the company where \'bsaver@example.com\' works.\r\n\r\nNatural Joins\r\n==========\r\n----------\r\n\r\n```sh\r\nsqlite> select c.*, o.id, o.created_at, li.product_id, li.quantity, li.price\r\n   ...> from customers as c, orders as o, line_items as li\r\n   ...> where c.id = o.customer_id\r\n   ...> and li.order_number = o.id\r\n   ...> and product_id = 1;\r\nid          name         email                 id          created_at           product_id  quantity    price     \r\n----------  -----------  --------------------  ----------  -------------------  ----------  ----------  ----------\r\n1           Big Spender  bspender@example.com  1           2014-10-25 00:11:51  1           4           10.0\r\n```\r\n\r\nIn this example, a wildcard is used for the customers table only. All other columns are explicitly specified to avoid retrieving duplicate columns.\r\n\r\nOuter Joins\r\n==========\r\n----------\r\n\r\nLet\'s find out how many orders is placed by every customer. You can use joins with aggregate functions like this:\r\n\r\n```sh\r\nsqlite> select customer_id, count(*) as number_of_order from orders group by customer_id;\r\ncustomer_id  number_of_order\r\n-----------  ---------------\r\n1            2              \r\n2            1\r\n```\r\n\r\nThis is same as the following query:\r\n\r\n```sh\r\nsqlite> select customers.id, orders.id \r\n   ...> from customers INNER JOIN orders\r\n   ...> ON customers.id = orders.customer_id;\r\ncustomer_id  order_id  \r\n-----------  ----------\r\n1            1         \r\n1            2         \r\n2            3\r\n```\r\n\r\nWe see only two customers who have placed orders. What if we want to include customers who have not placed any orders yet?\r\n\r\n```sh\r\nsqlite> select customers.id as customer_id, orders.id as order_id\r\n   ...> from customers LEFT OUTER JOIN orders\r\n   ...> on customers.id = orders.customer_id;\r\ncustomer_id  order_id  \r\n-----------  ----------\r\n1            1         \r\n1            2         \r\n2            3         \r\n3                      \r\n4\r\n```\r\n\r\nThe left outer join query returns customers who have not placed any order yet. It includes the rows in the left of the LEFT OUTER JOIN, customers, even if they don\'t have any corresponding value in the other table, in this case, orders table. Let\'s combine the joins with aggregate functions to list the number of orders placed by every customer.\r\n\r\n```sh\r\nsqlite> select customers.id as customer_id, count(orders.id) as number_of_orders\r\n   ...> from customers LEFT OUTER JOIN orders \r\n   ...> on customers.id = orders.customer_id\r\n   ...> group by customers.id;\r\ncustomer_id  number_of_orders\r\n-----------  ----------------\r\n1            2               \r\n2            1               \r\n3            0               \r\n4            0\r\n```\r\n\r\nIf you find any of the query difficult to follow, list all the data in all tables and refer them while you analyze the query. Here is the complete list of all data. For subqueries, run one query at a time and then combine them together.\r\n\r\n```sh\r\nsqlite> select * from orders;\r\nid          confirmation  customer_id  created_at         \r\n----------  ------------  -----------  -------------------\r\n1           1             1            2014-10-25 00:11:51\r\n2           2             1            2014-10-25 00:14:29\r\n3           3             2            2014-10-25 01:16:10\r\nsqlite> select * from line_items;\r\nid          product_id  quantity    price       order_number\r\n----------  ----------  ----------  ----------  ------------\r\n1           1           4           10.0        1           \r\n3           2           1           40.0        1           \r\n2           3           10          10.0        1           \r\n4           4           15          30.0        1           \r\nsqlite> select * from customers;\r\nid          name         email               \r\n----------  -----------  --------------------\r\n1           Big Spender  bspender@example.com\r\n2           Big Saver    bsaver@example.com  \r\n3           Big Saver    bsaver2@example.com \r\n4           Big Browser  browser@example.com \r\n```\r\n\r\nSummary\r\n==========\r\n----------\r\nIn this article you learned about self join where we join with the same table, outer join and natural joins. You also learned how to use them in combination with aggregate functions.','2014-10-26 01:45:13','2014-10-26 01:49:10'),(1101,'SQL Basics : Update and Delete','Objective\r\n==========\r\n----------\r\n\r\nTo learn how to use UPDATE and DELETE statements to update and delete rows in a table.\r\n\r\nUpdate\r\n==========\r\n----------\r\n\r\nTo update data in a table the UPDATE statement is used. Let\'s take a look at the existing data in the customers table.\r\n\r\n```sh\r\nsqlite> select * from customers;\r\nid          name         email               \r\n----------  -----------  --------------------\r\n1           Big Spender  bspender@example.com\r\n2           Big Saver    bsaver@example.com  \r\n3           Big Saver    bsaver2@example.com \r\n4           Big Browser  browser@example.com \r\n```\r\n\r\nLet\'s now update the email for the customer with id = 1.\r\n\r\n```sh\r\nsqlite> update customers\r\n   ...> set email = \'bspender@spender.com\'\r\n   ...> where id = 1;\r\n```\r\n\r\nThe update statement takes the name of table to be updated followed by the SET keyword with the column name set to a new value. In this example we are updating just one row because of the WHERE condition. Now the change made can be verified by looking at the customers table.\r\n\r\n```sh\r\nsqlite> select * from customers;\r\nid          name         email               \r\n----------  -----------  --------------------\r\n1           Big Spender  bspender@spender.com\r\n2           Big Saver    bsaver@example.com  \r\n3           Big Saver    bsaver2@example.com \r\n4           Big Browser  browser@example.com\r\n```\r\n\r\nLet\'s now look at updating more than one column. \r\n\r\n```sh\r\nsqlite> update customers\r\n   ...> set name = \'Bugs Bunny\',\r\n   ...>     email = \'bbunny@disney.com\'\r\n   ...> where id = 1;\r\n```\r\n\r\nThe only difference here is that we specify multiple columns to be updated separated by comma after the SET keyword.\r\n\r\n```sh\r\nsqlite> select * from customers;\r\nid          name        email            \r\n----------  ----------  -----------------\r\n1           Bugs Bunny  bbunny@disney.com\r\n2           Big Saver   bsaver@example.co\r\n3           Big Saver   bsaver2@example.c\r\n4           Big Browse  browser@example.c\r\n```\r\n\r\nWe see that both both the name and email has been changed to the new values. To display the entire value for email column, let\'s increase the width of that column.\r\n\r\n```sh\r\nsqlite> .width 2 25 25\r\nsqlite> select * from customers;\r\nid  name                       email                    \r\n--  -------------------------  -------------------------\r\n1   Bugs Bunny                 bbunny@disney.com        \r\n2   Big Saver                  bsaver@example.com       \r\n3   Big Saver                  bsaver2@example.com      \r\n4   Big Browser                browser@example.com\r\n```\r\n\r\nDelete\r\n==========\r\n----------\r\n\r\nThe DELETE statement is used to remove data from a table. Here is the list of customers before delete.\r\n\r\n```sh\r\nsqlite> select * from customers;\r\nid  name                       email                    \r\n--  -------------------------  -------------------------\r\n1   Bugs Bunny                 bbunny@disney.com        \r\n2   Big Saver                  bsaver@example.com       \r\n3   Big Saver                  bsaver2@example.com      \r\n4   Big Browser                browser@example.com      \r\n```\r\n\r\nLet\'s delete the last record in the customers table.\r\n\r\n```sh\r\nsqlite> delete from customers\r\n   ...> where id = 4;\r\n```\r\n\r\nYou can see that the customer \'Big Browser\' is not in customers table.\r\n\r\n```sh\r\nsqlite> select * from customers;\r\nid  name                       email                    \r\n--  -------------------------  -------------------------\r\n1   Bugs Bunny                 bbunny@disney.com        \r\n2   Big Saver                  bsaver@example.com       \r\n3   Big Saver                  bsaver2@example.com\r\n```\r\n\r\nIf you don\'t provide the WHERE clause in the delete statement, all records will be deleted.\r\n\r\n```sh\r\nsqlite> delete from customers;\r\nsqlite> select count(*) from customers;\r\ncount\r\n--\r\n0 \r\n```\r\n\r\nSummary\r\n==========\r\n----------\r\n\r\nIn this article you learned how to use the UPDATE and DELETE statements for changing and deleting rows in a table. ','2014-10-26 21:42:57','2014-10-26 21:42:57'),(1111,'SQL Basics : Constraints','Objective\r\n==========\r\n----------\r\n\r\nTo learn about constraints, primary keys, foreign keys and referential integrity.\r\n\r\nWhat are Constraints?\r\n==========\r\n----------\r\n\r\nRelational databases store data into multiple tables. There are relationships that exist between the tables. That\'s why it\'s called **Relational** database. Keys reference from one table to another. This is called **referential integrity**. In our example, when we store a record in the `line_items` table, the `order_number` references to the id of the orders table. There cannot be a `line_items` record that does not have a `order_number`. This would violate the referential integrity. \r\n\r\nRelational databases enforce referential integrity by imposing constraints on database tables. You can create the constraints when you use the CREATE TABLE or ALTER TABLE commands.\r\n\r\nPrimary Keys\r\n==========\r\n----------\r\n\r\nA primary key ensures that values in a column are unique. So, you can uniquely identify each row in a table. This makes the UPDATE or DELETE safe to use, ie., they don\'t affect other rows. Let\'s create a `credit_cards` table.\r\n\r\n```sh\r\nsqlite> CREATE TABLE credit_cards\r\n   ...> (\r\n   ...> id int primary key not null,\r\n   ...> type char(10) not null,\r\n   ...> user_id int not null\r\n   ...> );\r\n```\r\n\r\nThe keyword **primary key** in the table definition defines id as the primary key of the `credit_cards` table. We can see the new table.\r\n\r\n```sh\r\nsqlite> .tables\r\ncredit_cards  line_items    products    \r\ncustomers     orders        users\r\n```\r\n\r\nWe can also see the table structure.\r\n\r\n```sh\r\nsqlite> .schema credit_cards\r\nCREATE TABLE credit_cards\r\n(\r\nid int primary key not null,\r\ntype char(10) not null,\r\nuser_id int not null\r\n);\r\n```\r\n\r\nForeign Keys\r\n==========\r\n----------\r\n\r\nA foreign key is a column in a table that references the primary key in another table. They are used to enforce referential integrity. \r\n\r\nLet\'s delete the table we just created.\r\n\r\n```sh\r\nsqlite> drop table credit_cards;\r\nsqlite> .tables\r\ncustomers   line_items  orders      products    users\r\n```\r\n\r\nNow lets create the credit_cards table again that will use a foreign key.\r\n\r\n```sh\r\nsqlite> CREATE TABLE credit_cards\r\n   ...> (\r\n   ...> id int primary key not null,\r\n   ...> type char(10) not null,\r\n   ...> user_id int not null,\r\n   ...> FOREIGN KEY (user_id) REFERENCES users(id) \r\n   ...> );\r\n```\r\n\r\nWe can see the schema of the new table.\r\n\r\n```sh\r\nsqlite> .schema credit_cards\r\nCREATE TABLE credit_cards\r\n(\r\nid int primary key not null,\r\ntype char(10) not null,\r\nuser_id int not null,\r\nFOREIGN KEY (user_id) REFERENCES users(id) \r\n);\r\n```\r\n\r\nHere the table definition uses the FOREIGN KEY keyword to make the `user_id` field a foreign key, it uses REFERENCES to indicate that it references the id field in users table. Now, we cannot create any records in the `credit_cards` table that does not have a `user_id` value that does not exist in the users table. \r\n\r\nHere is an example that creates a new credit card for Yosemite Sam.\r\n\r\n```sh\r\nsqlite> INSERT INTO credit_cards(id, type, user_id)\r\n   ...> VALUES (1, \'VISA\', 10);\r\nsqlite> select * from credit_cards;\r\nid          type        user_id   \r\n----------  ----------  ----------\r\n1           VISA        10        \r\nsqlite> select * from users;\r\nid          first_name  last_name   email            \r\n----------  ----------  ----------  -----------------\r\n1           bugs        bunny       bbunny@disney.com\r\n2           daffy       duck        daffy@disney.com \r\n3           porky       pig         ppig@disney.com  \r\n4           pluto       dog         pdog@disney.com  \r\n5           pluto       pet         pdog@disney.com  \r\n6           tasmanian   devil       tdevil@disney.com\r\n7           tweety      bird        tweety@disney.com\r\n8           elmer       fudd        efudd@disney.com \r\n9           speedy      gonzales    gonzales@disney.c\r\n10          yosemite    sam         sam@disney.com   \r\n11          sylvester               sam@disney.com   \r\n12          bosko                   sam@disney.com\r\n```\r\n\r\nHere is an example that shows creating a row that violates the foreign key constraint results in an error.\r\n\r\n```sh\r\nsqlite> INSERT INTO credit_cards(id, type, user_id)\r\n   ...> VALUES (1, \'VISA\', 13);\r\nError: column id is not unique\r\n```\r\n\r\nWe can verify that there is only one record in the `credit_cards` table.\r\n\r\n```sh\r\nsqlite> select * from credit_cards;\r\nid          type        user_id   \r\n----------  ----------  ----------\r\n1           VISA        10\r\n```\r\n\r\nSummary\r\n==========\r\n----------\r\n\r\nIn this article you learned about constraints, primary key and foreign key. You also learned about how they enforce referential integrity.','2014-10-27 03:57:04','2016-12-22 19:40:45'),(1121,'SQL Basics : Indexes','Objective\r\n==========\r\n----------\r\n\r\nLearn how and when to use indexes on one or more columns in a table.\r\n\r\nWhat are Indexes?\r\n==========\r\n----------\r\n\r\nTables are sorted by primary key, so retrieving rows using primary key is fast. If you want to retrieve records where you use a filter condition that contains some other column other than the primary key, the database will start at the first row and look for matches from all the rows in the table. This is slow. Indexes improve searching and sorting speed. You can define an index on one or more columns so that the database server keeps a sorted list of the records for fast lookup.\r\n\r\nBut indexes come with a cost:\r\n\r\n- Indexes improve the lookup performance at the cost of degrading the performance of insert, update and delete operations. When any of the data manipulation operations are executed, the database server has to update the index dynamically.\r\n- Indexed data can take up more storage space than non-indexed data.\r\n- Data that is not unique such as country names will not be suitable for indexing.\r\n- If you frequently sort data in a specific order, it could be a good candidate for indexing.\r\n\r\nCreate Index\r\n==========\r\n----------\r\n\r\nCREATE INDEX statement is used to create indexes. Let\'s create an index on the name column of the products table.\r\n\r\n```sh\r\nsqlite> create index product_name_index\r\n   ...> on products (name);\r\n```\r\n\r\nIndexes must have unique name. In this example, product_name_index is the index name, ON is used to specify the table name to be indexed followed by the columns to include in the index inside parentheses. You can describe the schema of the products table to check if the index has been defined.\r\n\r\n```sh\r\nsqlite> .schema products\r\nCREATE TABLE products(\r\nid int primary key not null,\r\nprice int,\r\nname char(50),\r\nuser_id int not null);\r\nCREATE INDEX product_name_index\r\non products (name);\r\n```\r\n\r\nYou can see the index definition after the create table definition.\r\n\r\nSummary\r\n==========\r\n----------\r\n\r\nIn this article you learned how and when to use indexes in a table. ','2014-10-27 22:33:47','2014-10-27 22:33:47'),(1131,'SQL Basics : Introduction','What is a Database? \r\n==========\r\n----------\r\n\r\nA database is a container that helps us to organize data. Databases are good at storing large amounts of data in one place and make it easier to query the data, add, update and delete data.\r\n\r\nThere are many types of databases, relational, object-oriented and document-based. We will be focusing only on relational database. Most of the NoSQL databases are documented based systems. They have their own query language that have some similarity to SQL. So it is useful to learn SQL. \r\n\r\n\r\nWhat is Relational?\r\n==========\r\n----------\r\n\r\nAccording to the dictionary relational means things that relate to other things. The relational model is a way to describe the data and the relationship between those data. In a relational database, data is stored in a Table. A Table is something that has a name. The table names describe the type of data that is stored in that table. Every table also has a collection of columns that define data that are stored in the Table. \r\n\r\nData is stored in columns. Every column has a name. Every column also has a restriction that can restrict the size and the type of data that can be stored in that column. So columns can store numbers, strings, date etc based on their type. Columns can have restrictions on the value of data that could be stored in them. Every column can be required or optional. The required columns must have values whereas the optional columns do not force us to provide any value. It could be a blank string or NULL value.\r\n\r\nA column can be a Key. A Primary Key can uniquely identify that row. Because the value in that column for that row is unique. No other row in that table can have that same value. Now, if another table has a column that contains that same key, we can then merge those two tables together. We can query them together. A Foreign Key means that column\'s value is the same as the Primary Key in another table. This allows rows the related tables to be linked together. Keys establish the relationship between tables.\r\n\r\nWhat is SQL? \r\n==========\r\n----------\r\n\r\nSQL stands for Structured Query Language. SQL is what is a special-purpose programming language. SQL is specifically built to manipulate relational databases. It\'s a declarative language. So, we basically declare statements, and the database system executes those statements. SQL is based on English, so it is human readable. When we put SQL into a statement, we create an actionable sentence. So a valid SQL statement is made up of a set of valid actionable words. SQL is not case sensitive. Most SQL statements start with a command. Generally that command is some sort of a verb to tell the database to do something.  \r\n\r\nIt has two parts. One is a part that is for defining the data in a relational database, and the other part is a language for querying and manipulating that data. By the end of this series of articles, you will be able to create a database, query a database, add, update and delete data.\r\n\r\nSummary\r\n==========\r\n----------\r\n\r\nIn this article you learned the meaning of the terminology used in relational database. This gives you the background required to learn the SQL basics in subsequent articles.','2014-10-28 04:35:12','2014-10-28 04:35:12'),(1141,'SQL Basics : SQLite3 Ruby Driver Basics','Objective\r\n==========\r\n----------\r\n\r\nLearn how to create table, insert records and retrieve records from a Ruby program that connects to mysqlite database.\r\n\r\nSQLite3 Ruby Driver\r\n==========\r\n----------\r\n\r\nThe sqlite3-ruby gem is a SQLite3 database driver for Ruby programs to interact with the SQLite3 database. You must have the SQLite3 database installed to use this gem. Install the gem by running:\r\n\r\n```sh\r\ngem install sqlite3\r\n```\r\n\r\nThis installed sqlite3 gem version 1.3.9 on my machine.\r\n\r\nCreate Database\r\n==========\r\n----------\r\n\r\nCreate client.rb with the following code.\r\n\r\n```ruby\r\nrequire \'sqlite3\'\r\n\r\ndb = SQLite3::Database.new(\'test.db\')\r\n           \r\nrows = db.execute <<-SQL \r\n          create table users(\r\n           id int,\r\n           name varchar(30)\r\n         );\r\n        SQL\r\n\r\nputs rows\r\nputs rows.inspect\r\n```\r\n\r\nRun the client.rb.\r\n\r\n```sh\r\nruby client.rb.\r\n```\r\n\r\nThe output shows an empty array: []. Let\'s open the test.db database and check the users table.\r\n\r\n```sh\r\n$ sqlite3 test.db\r\nSQLite version 3.7.7 2011-06-25 16:35:41\r\nEnter \".help\" for instructions\r\nEnter SQL statements terminated with a \";\"\r\nsqlite> .tables\r\nusers\r\nsqlite> .schema users\r\nCREATE TABLE users(\r\n           id int,\r\n           name varchar(30)\r\n         );\r\nsqlite> \r\n```\r\n\r\nInsert Rows\r\n==========\r\n----------\r\n\r\nCurrently, there are no records in the users table. \r\n\r\n```sh\r\nsqlite> select count(*) from users;\r\n0\r\n```\r\n\r\nLet\'s insert a record. Create insert.rb.\r\n\r\n```ruby\r\nrequire \'sqlite3\'\r\n\r\ndb = SQLite3::Database.open(\'test.db\')\r\n           \r\ndb.execute(\"INSERT INTO users(id, name) VALUES(?, ?)\", [1, \'Bugs Bunny\'])\r\n```\r\n\r\nRun the insert.ruby. \r\n\r\n```sh\r\nruby insert.rb\r\n```\r\n\r\nNow we see the record we just inserted.\r\n\r\n```sh\r\nsqlite> select count(*) from users;\r\n1\r\nsqlite> select * from users;\r\n1|Bugs Bunny\r\n```\r\n\r\nYou can also use a hash to insert multiple records. Create insert2.rb.\r\n\r\n```ruby\r\nrequire \'sqlite3\'\r\n\r\ndb = SQLite3::Database.open(\'test.db\')\r\n\r\nrecords = {2 => \'Daffy Duck\', 3 => \'Porky Pig\'}           \r\n\r\nrecords.each do |record|\r\n  db.execute(\"INSERT INTO users(id, name) VALUES(?, ?)\", record)  \r\nend\r\n```\r\n\r\nNow, you will see three records.\r\n\r\n```sh\r\nsqlite> select * from users;\r\n1|Bugs Bunny\r\n2|Daffy Duck\r\n3|Porky Pig\r\n```\r\n\r\nSelect Rows\r\n==========\r\n----------\r\n\r\nLet\'s select the records from the users table. Create select.rb.\r\n\r\n```ruby\r\nrequire \'sqlite3\'\r\n\r\ndb = SQLite3::Database.open(\'test.db\')\r\n           \r\ndb.execute(\"select * from users\") do |result|\r\n  puts result\r\nend\r\n```\r\n\r\nRun select.rb.\r\n\r\n```sh\r\nruby select.rb\r\n1\r\nBugs Bunny\r\n2\r\nDaffy Duck\r\n3\r\nPorky Pig\r\n```\r\n\r\nYou can see that there are three records.\r\n\r\nSummary\r\n==========\r\n----------\r\n\r\nIn this article we saw examples on using sqlite3-ruby in a database client written in Ruby. You learned how to create tables, insert records and retrieve results from a table in a Ruby program.','2014-10-28 21:49:03','2014-10-28 21:49:03'),(1151,'SQL Basics : SQLite3 Ruby Driver Part 2','Objective\r\n==========\r\n----------\r\n\r\nTo learn about in-memory database, prepared statements and other features of SQLite Ruby gem.\r\n\r\nWhy in-memory Database?\r\n==========\r\n----------\r\n\r\nSQLite in-memory database can be used in testing environment to speed up the tests a little bit. It is also useful when you want to build your own lightweight diagnostics utility to troubleshoot problems. Let\'s create an in-memory database with an employees table that has one record. Create memory.rb with the following code.\r\n\r\n```ruby\r\nrequire \'sqlite3\'\r\n\r\ndb = SQLite3::Database.new(\':memory:\')\r\ndb.execute \'CREATE TABLE \"employees\" (\"token\" integer(8), \"name\" varchar(20) NOT NULL)\'\r\ndb.execute \"INSERT INTO employees(token, name) VALUES(\'employee-1\', ?)\", 5000\r\nrows = db.execute \'select token from employees\'\r\nputs rows\r\nputs rows.inspect\r\nputs \"Employee token is : #{rows.first.first}\"\r\n```\r\n\r\nThe Database#execute method will return the results in an array. In this example the rows is an array that contains the records. Each record is stored as an array inside. So we have an array that contains array of records. The execute method is used for insert, update and delete operations. \r\n\r\nTo iterate through the rows you can use the block form.\r\n\r\n```ruby\r\nrequire \'sqlite3\'\r\n\r\ndb = SQLite3::Database.new(\':memory:\')\r\ndb.execute \'CREATE TABLE \"employees\" (\"token\" integer(8), \"name\" varchar(20) NOT NULL)\'\r\ndb.execute \"INSERT INTO employees(token, name) VALUES(\'employee-1\', ?)\", 5000\r\ndb.execute \"INSERT INTO employees(token, name) VALUES(\'employee-2\', ?)\", 1000\r\ndb.execute(\'select * from employees\') do |row|\r\n  puts row\r\nend\r\n```\r\n\r\nIf you want to get just the first row, you can use get_first_row method.\r\n\r\n```ruby\r\nputs \'First row is \'\r\nputs db.get_first_row \'select token from employees\'\r\n```\r\n\r\nYou can check the encoding by using the encoding method.\r\n\r\n```ruby\r\nputs db.encoding\r\n```\r\n\r\nYou can get the table info by using the table_info method.\r\n\r\n```ruby\r\nputs db.table_info(\'employees\')\r\n```\r\n\r\nTo close the database and check if it\'s closed:\r\n\r\n```ruby\r\nputs db.close\r\nputs db.closed?\r\n```\r\n\r\nTo get the column names as wells as the rows use the execute2 method. Create headers.rb:\r\n\r\n```ruby\r\nrequire \'sqlite3\'\r\n\r\ndb = SQLite3::Database.new(\':memory:\')\r\ndb.execute \'CREATE TABLE \"employees\" (\"token\" integer(8), \"name\" varchar(20) NOT NULL)\'\r\ndb.execute \"INSERT INTO employees(token, name) VALUES(\'employee-1\', ?)\", 5000\r\ndb.execute \"INSERT INTO employees(token, name) VALUES(\'employee-2\', ?)\", 1000\r\n\r\ncolumns, *rows = db.execute2( \"select * from employees\" )\r\nputs columns\r\nrows.each do |row|\r\n  puts row\r\nend\r\n```\r\n\r\nRun this to see the columns and the rows. You can also use the block form. Create headers2.rb:\r\n\r\n```ruby\r\nrequire \'sqlite3\'\r\n\r\ndb = SQLite3::Database.new(\':memory:\')\r\ndb.execute \'CREATE TABLE \"employees\" (\"token\" integer(8), \"name\" varchar(20) NOT NULL)\'\r\ndb.execute \"INSERT INTO employees(token, name) VALUES(\'employee-1\', ?)\", 5000\r\ndb.execute \"INSERT INTO employees(token, name) VALUES(\'employee-2\', ?)\", 1000\r\n\r\ncolumns = nil\r\ndb.execute2( \"select * from employees\" ) do |row|\r\n  if columns.nil?\r\n    columns = row\r\n    puts columns\r\n  else\r\n    puts row\r\n  end\r\nend\r\n```\r\n\r\nTo get just the first value of the first row of the result set, use the get_first_value method. Create count.rb:\r\n\r\n```ruby\r\nrequire \'sqlite3\'\r\n\r\ndb = SQLite3::Database.new(\':memory:\')\r\ndb.execute \'CREATE TABLE \"employees\" (\"token\" integer(8), \"name\" varchar(20) NOT NULL)\'\r\ndb.execute \"INSERT INTO employees(token, name) VALUES(\'employee-1\', ?)\", 5000\r\ndb.execute \"INSERT INTO employees(token, name) VALUES(\'employee-2\', ?)\", 1000\r\n\r\ncount = db.get_first_value(\'select count(*) from employees\')\r\nputs count\r\n```\r\n\r\nRun this, you will the count value is 2. To get only the first row of the result set, use the get_first_row. Create first.rb:\r\n\r\n```ruby\r\nrequire \'sqlite3\'\r\n\r\ndb = SQLite3::Database.new(\':memory:\')\r\ndb.execute \'CREATE TABLE \"employees\" (\"token\" integer(8), \"name\" varchar(20) NOT NULL)\'\r\ndb.execute \"INSERT INTO employees(token, name) VALUES(\'employee-1\', ?)\", 5000\r\ndb.execute \"INSERT INTO employees(token, name) VALUES(\'employee-2\', ?)\", 1000\r\n\r\nrow = db.get_first_row(\'select * from employees\')\r\nputs row\r\n```\r\n\r\nThis will print only the first record in the employees table. To get the first value of the first row of the result set, use the get_first_value method:\r\n\r\n```ruby\r\nrequire \'sqlite3\'\r\n\r\ndb = SQLite3::Database.new(\':memory:\')\r\ndb.execute \'CREATE TABLE \"employees\" (\"token\" integer(8), \"name\" varchar(20) NOT NULL)\'\r\ndb.execute \"INSERT INTO employees(token, name) VALUES(\'employee-1\', ?)\", 5000\r\ndb.execute \"INSERT INTO employees(token, name) VALUES(\'employee-2\', ?)\", 1000\r\n\r\nvalue = db.get_first_value(\'select * from employees\')\r\nputs value\r\n```\r\n\r\nYou can use place holders in the SQL statement. Create bind.rb :\r\n\r\n```ruby\r\nrequire \'sqlite3\'\r\n\r\ndb = SQLite3::Database.new(\':memory:\')\r\ndb.execute \'CREATE TABLE \"employees\" (\"token\" integer(8), \"name\" varchar(20) NOT NULL)\'\r\ndb.execute \"INSERT INTO employees(token, name) VALUES(?, ?)\", \'employee-1\', 5000\r\ndb.execute \"INSERT INTO employees(token, name) VALUES(?, ?)\", \'employee-2\', 1000\r\n\r\nresult = db.execute(\"select count(*) from employees\")\r\nputs result\r\n```\r\n\r\nHere there are two bind variables for token and name in the employees table. These bind variables have \'?\' as the place holders for the column values. The values are provided as a comma separated list.\r\n\r\nPrepared Statements\r\n==========\r\n----------\r\n\r\nPrepare statement is a way to execute the same database statements repeatedly with high efficiency. The create a statement that take parameters and can be used with different values each time it is executed. Create prepare.rb with the following contents:\r\n\r\n```ruby\r\nrequire \'sqlite3\'\r\n\r\ndb = SQLite3::Database.new(\':memory:\')\r\ndb.execute \'CREATE TABLE \"employees\" (\"token\" integer(8), \"name\" varchar(20) NOT NULL)\'\r\n\r\nstmt = db.prepare(\"INSERT INTO employees(token, name) VALUES(:token, :name)\")\r\n\r\nstmt.bind_param(\'token\', 1)\r\nstmt.bind_param(\'name\', \'Bugs\')\r\nstmt.execute\r\nstmt.close\r\n\r\nrows = db.execute(\'select * from employees\')\r\n\r\nputs rows\r\n```\r\n\r\nHere the binding variables :token and :name is used to create a prepared statement. We then bind values to the place holders and execute the statement. You can see the inserted row in the output. We close the prepared statement as soon as we are done. This prevents memory leak.\r\n\r\nSummary\r\n==========\r\n----------\r\n\r\nIn this article you learned about in-memory database and why it is useful. You also learned about prepared statement and other features of sqlite ruby gem. Read the FAQ and the tests for sqlite3 ruby gem to learn more.\r\n\r\nReference\r\n==========\r\n----------\r\n\r\n1. [SQLite3 Ruby](https://github.com/sparklemotion/sqlite3-ruby \'SQLite3 Ruby\')','2014-10-29 05:15:42','2014-11-07 00:32:34'),(1161,'Stripe Recurring Billing Part 3 : Integration Testing using Capybara','Jeff Thomas has written a blog post on [Integration tests with Stripe](http://www.jeffthomas.xyz/integration-tests-with-stripe/ \'Integration tests with Stripe\'). I followed his instructions, but I was not able to get it working. So, I had to use just Capybara with RSpec. In this article you will learn how to check the API credentials using a rake task and how to write integration tests using Capybara for testing the subscription feature using Stripe API.\r\n\r\nCredentials Check\r\n==========\r\n----------\r\n\r\nHere is a rake task that you can use to make sure that the Stripe credentials are defined.\r\n\r\n```ruby\r\nnamespace :stripe do\r\n  task :credentials_check => :environment do\r\n    message = <<ERROR \r\nStripe Credentials is not set. Define the following Stripe Environment variables.\r\n\r\nexport STRIPE_PUBLISHABLE_KEY=\'pk_test_your publishable key\' \r\nexport STRIPE_SECRET_KEY=\'sk_test_your secret key\'\r\n\r\nCheck config/initializers/stripe.rb for more details on this works.\r\nERROR\r\n              \r\n    if Rails.configuration.stripe[:secret_key].blank?\r\n      puts message\r\n    else\r\n      begin\r\n        Stripe::Account.retrieve\r\n        puts \"Stripe Secret Key is defined properly\"\r\n      rescue  Stripe::AuthenticationError => e\r\n        puts \"Stripe Secret Key is not correct\"\r\n      end\r\n    end\r\n  end\r\n\r\nend\r\n```\r\n\r\nIdeally, the API should provide something similar to ping to verify the credentials. Unfortunately, there is no API for credentials check. The closest thing that I could find is retrieving the Stripe account details for the website owner who wants to charge their customers using Stripe API.\r\n\r\nIntegration Tests using Feature Specs\r\n==========\r\n----------\r\n\r\nStep 1\r\n----------\r\n\r\nAdd the following gems to the Gemfile.\r\n\r\n```ruby\r\ngroup :test do\r\n  gem \'capybara\'\r\n  gem \'selenium-webdriver\'\r\nend\r\n```\r\n\r\nStep 2\r\n----------\r\n\r\nRun bundle.\r\n\r\nStep 3\r\n----------\r\n\r\nCreate a features directory under spec folder. Create a file `subscribe_spec.rb` under the features directory with the following contents.\r\n\r\n```ruby\r\nrequire \'rails_helper\'\r\n\r\nfeature \'Subscription\' do\r\n  scenario \'Customer subscribes to Gold plan\', js: true do\r\n    visit \"/subscriptions/new\"\r\n    fill_in \"Card Number\", with: \'4242424242424242\'\r\n    page.select \'10\', from: \"card_month\"\r\n    page.select \'2029\', from: \'card_year\'\r\n    \r\n    click_button \'Subscribe Me\'\r\n    expect(page).to have_content(\'You have been subscribed to Gold.\')\r\n  end\r\nend\r\n```\r\n\r\nStep 4 \r\n----------\r\n\r\nRun the feature spec.\r\n\r\n```ruby\r\n$rspec spec/features/subscribe_spec.rb \r\n```\r\n\r\nIf the feature tests are not running on the browser, you can check the default driver in rails console:\r\n\r\n```ruby\r\n$rails c test\r\nLoading test environment (Rails 4.2.5)\r\n > Capybara.default_driver\r\n => :rack_test \r\n```\r\n\r\nYou can change it to selenium, poltergeist or anything else in `rails_helper.rb` file:\r\n\r\n```ruby\r\n# Default driver is :rack_test\r\nCapybara.default_driver = :selenium\r\n```\r\n\r\nNow the tests will run on the browser using the selenium-webdriver.  You can download the entire source code for this project from bitbucket: `git@bitbucket.org:bparanj/striped.git`.\r\n\r\nReferences\r\n===========\r\n-----------\r\n\r\n1. [Feature Spec] (https://www.relishapp.com/rspec/rspec-rails/docs/feature-specs/feature-spec \'Feature Spec\')\r\n2. [Stripe Ruby Mock] (https://github.com/rebelidealist/stripe-ruby-mock \'Stripe Ruby Mock\')\r\n3. [Integration tests with Stripe](http://www.jeffthomas.xyz/integration-tests-with-stripe/ \'Integration tests with Stripe\')\r\n4. [Capybara Docs](http://www.rubydoc.info/github/jnicklas/capybara/master/Capybara/Node/Actions#select-instance_method \'Capybara Docs\')','2014-11-06 00:34:25','2015-12-13 21:00:48'),(1171,'Calling Native Library Code from Ruby','Background\r\n===========\r\n-----------\r\n\r\nIf you have encountered a situation where you want to wrap C, C++ library in Ruby and create a gem that you can use anywhere, then ffi-gem is for you. Without this gem you have to write your own C extension for Ruby to wrap an existing C library (if it\'s not already available). This is not easy, especially if you are not familiar with C. \r\n\r\nWhat is FFI?\r\n============\r\n------------\r\n\r\nFFI stands for Foreign Function Interface. A foreign function interface is the popular name for the interface that allows code written in one language to call code written in another language. \r\n\r\nAdvantages of FFI\r\n------------------\r\n\r\n- You often don\'t have to write C/C++ code. \r\n- FFI will run on MRI, Rubinius and JRuby.\r\n- The end users don\'t need development headers or a C/C++ compiler.\r\n\r\nFor a discussion on when it is not the right tool, read the [Detecting Faces with Ruby: FFI in a Nutshell] (http://www.sitepoint.com/detecting-faces-with-ruby-ffi-in-a-nutshell/ \'Detecting Faces with Ruby: FFI in a Nutshell\') article.\r\n\r\nWhat is libffi?\r\n===============\r\n---------------\r\n\r\nThe libffi library provides a portable, high level programming interface to various calling conventions. This allows a programmer to call any function specified by a call interface description at run-time. The libffi library is useful to anyone trying to build a bridge between interpreted and natively compiled code. Some notable users include:\r\n\r\nJava Native Access (JNA) - the JNI-free way to call native code from Java.\r\nRuby-FFI - a Foreign Function Interface extension for Ruby.\r\n\r\nWhat is Ruby-FFI?\r\n===============\r\n---------------\r\n\r\nRuby-FFI is a ruby extension for programmatically loading dynamic libraries, binding functions within them, and calling those functions from Ruby code. Moreover, a Ruby-FFI extension works without changes on Ruby and JRuby.\r\n\r\nSimple Example\r\n==============\r\n--------------\r\n\r\nInstall the FFI gem.\r\n\r\n```ruby\r\n$ gem install ffi\r\n```\r\n\r\nLet\'s now write a program to use a function from LIBC. By the way, [LIBC] (http://www.gnu.org/software/libc/manual/html_mono/libc.html \'The GNU C Library\') is the GNU C Library. Our program will print the process ID of the current process. LIBC provides a [getpid](http://www.gnu.org/software/libc/manual/html_mono/libc.html#index-getpid \'Process Identification\') function that we can use in our program through FFI. According to the GNU docs, this function returns an integer and does not take any parameter.\r\n\r\n```c\r\nFunction: pid_t getpid (void)\r\n```\r\n\r\nWe use that fact in the attach_function, the first parameter is the symbol of the function inside the native library, the second parameter is empty since it does not take any input parameter. The third parameter is int, the return value from the function.\r\n\r\n```ruby\r\nrequire \'ffi\'\r\n\r\nmodule Foo\r\n  extend FFI::Library\r\n\r\n  ffi_lib FFI::Library::LIBC\r\n  attach_function :getpid, [ ], :int\r\nend\r\nputs \"My pid=#{Foo.getpid}\"\r\nputs $$\r\n\r\nMy pid=18185\r\n18185\r\n```\r\n\r\nWe first require the FFI gem. This will load and initialize the FFI library. We then define a module that extends the FFI::Library module. This attaches the native functions to the Foo module. The ffi_lib call can take multiple arguments to load native libraries. In this case we are loading just one native library, namely FFI::Library::LIBC. Now we can use the methods from this module to bind to the LIBC library. The attach_function will link the native C functions into the Foo module. In our example, it attaches the getpid function to our module. Now the getpid function can be accessed as a static function of our module. The value returned by the C function is the same as the Ruby global variable $$ that returns the process ID.\r\n\r\nExample 2\r\n==============\r\n--------------\r\n\r\nThe getuid function returns the real user ID of the process. Let\'s write a program to print this value.\r\n\r\n```ruby\r\nrequire \'ffi\'\r\n\r\nmodule RubyFFI\r\n  extend FFI::Library\r\n  attach_function :getuid, [], :uint\r\nend\r\n```\r\n\r\nYou will get the error:\r\n\r\n```ruby\r\nLoadError: no library specified\r\n    from /home/zepho/.rvm/gems/ruby-2.1.4@ffi/gems/ffi-1.9.6/lib/ffi/library.rb:162:in `ffi_libraries\'\r\n    from /home/zepho/.rvm/gems/ruby-2.1.4@ffi/gems/ffi-1.9.6/lib/ffi/library.rb:240:in `attach_function\'\r\n    from (irb):4:in `<module:RubyFFI>\'\r\n    from (irb):2\r\n    from /home/zepho/.rvm/rubies/ruby-2.1.4/bin/irb:11:in `<main>\'\r\n```\r\n\r\nWe know that getuid function is provided by the GNU C library. We need to specify this before the attach_function.\r\n\r\n```ruby\r\nrequire \'ffi\'\r\n\r\nmodule RubyFFI\r\n  extend FFI::Library\r\n  ffi_lib FFI::Library::LIBC\r\n\r\n  attach_function :getuid, [], :uint\r\nend\r\n```\r\n\r\nOn my machine the output is :\r\n\r\n```ruby\r\nUid is 1000\r\n```\r\n\r\nExample 3\r\n==============\r\n--------------\r\n\r\nLet\'s write a program to call the standard C library function puts().\r\n\r\n```ruby\r\nmodule MyLib\r\n  extend FFI::Library\r\n  ffi_lib \'c\'\r\n  \r\n  attach_function :puts, [ :string ], :int\r\nend\r\n\r\nMyLib.puts \'Hello, World using libc!\'\r\nHello, World using libc!\r\n => 25\r\n```\r\n\r\nExample 4\r\n==============\r\n--------------\r\n\r\nThe getlogin identifies who logged in. Let\'s write a program to print who is logged in.\r\n\r\n```ruby\r\nrequire \'ffi\'\r\nmodule Foo\r\n  extend FFI::Library\r\n  ffi_lib FFI::Library::LIBC\r\n\r\n  attach_function :getlogin, [ ], :string\r\nend\r\nputs \"getlogin=#{Foo.getlogin}\"\r\n\r\ngetlogin=zepho\r\n```\r\n\r\nExample 5\r\n==============\r\n--------------\r\n\r\nLet\'s write a program to wrap the power math function in Ruby.\r\n\r\n```ruby\r\nrequire \'ffi\'\r\n\r\nmodule FfiMathTest\r\n  extend FFI::Library\r\n  ffi_lib \'c\'\r\n  ffi_lib \'m\'\r\n  attach_function :pow, [ :double, :double ], :double\r\nend\r\nputs FfiMathTest.pow(2.2, 10)\r\n\r\n2655.99\r\n```\r\n\r\nIn this example we are using the ffi_lib \'m\' that loads the pow(double x, double, y) C library function in math.h that returns x raised to the power of y.\r\n\r\nExposing Native Libraries to Ruby\r\n=================\r\n-----------------\r\n\r\nWe now know enough to write programs using FFI to wrap the existing native code. What if we want to write Ruby wrapper for our custom native code? Let\'s know write a simple c program that calculates the power, square_root and factorial. Here is the simple_math.c\r\n\r\n```c\r\n#include <math.h>\r\n\r\ndouble power(double base, double power) {\r\n  return pow(base, power);\r\n}\r\n\r\ndouble square_root(double x) {\r\n  return sqrt(x);\r\n}\r\n\r\nlong ffi_factorial(int max) {\r\n  int i = max, result = 1;\r\n  while (i >= 2) {\r\n	result *= i--;\r\n  }\r\n  return result;\r\n}\r\n```\r\n\r\nLet\'s compile this as follows:\r\n\r\n```sh\r\n$gcc -shared -Wl,-soname,libsimplemath -o libsimplemath.so simple_math.c -lm\r\n```\r\n\r\nYou now see the .so file:\r\n\r\n```sh\r\n~/projects/ffi$ ll\r\ntotal 24\r\ndrwxrwxr-x 2 zepho zepho 4096 Nov  5 23:26 ./\r\ndrwxr-xr-x 5 zepho zepho 4096 Nov  5 23:15 ../\r\n-rwxrwxr-x 1 zepho zepho 6781 Nov  5 23:19 libsimplemath.so*\r\n-rw-rw-r-- 1 zepho zepho  262 Nov  5 23:18 simple_math.c\r\n```\r\n\r\nCreate simple_math.rb that will wrap the C code.\r\n\r\n```ruby\r\nrequire \'ffi\'\r\n\r\nclass FFIMath\r\n  extend FFI::Library\r\n\r\n  ffi_lib \"./libsimplemath.so\"\r\n\r\n  functions = [\r\n   [:power, [:double, :double], :double],\r\n   [:square_root, [:double], :double],\r\n   [:ffi_factorial, [:int], :long]\r\n  ]\r\n\r\n  functions.each do |func|\r\n	begin\r\n  	attach_function(*func)\r\n	rescue Object => e\r\n  	  puts \"Could not attach #{func}, #{e.message}\"\r\n	end\r\n  end\r\nend\r\n\r\nputs FFIMath.power(3, 5)\r\nputs FFIMath.square_root(81)\r\nputs FFIMath.ffi_factorial(10)\r\n```\r\n\r\nIf you don’t specify ‘./’ in the ffi_lib call, you will get the error:\r\n\r\n```sh\r\n~/projects/ffi$ ruby simple_math.rb\r\n/home/zepho/.rvm/gems/ruby-2.1.4@ffi/gems/ffi-1.9.6/lib/ffi/library.rb:133:in `block in ffi_lib\': Could not open library \'libsimplemath.so\': libsimplemath.so: cannot open shared object file: No such file or directory (LoadError)\r\n    from /home/zepho/.rvm/gems/ruby-2.1.4@ffi/gems/ffi-1.9.6/lib/ffi/library.rb:100:in `map\'\r\n    from /home/zepho/.rvm/gems/ruby-2.1.4@ffi/gems/ffi-1.9.6/lib/ffi/library.rb:100:in `ffi_lib\'\r\n    from simple_math.rb:6:in `<class:FFIMath>\'\r\n    from simple_math.rb:3:in `<main>\'\r\n```\r\n\r\nLet\'s look at another example. Create ffi_test.c with the following contents:\r\n\r\n```c\r\n#include <stdlib.h>\r\n#include <math.h>\r\n\r\nint ffi_pow(int a, int n) {\r\n  return pow(a,n);\r\n}\r\n\r\nint ffi_factorial(int max) {\r\n  int i=max, result=1;\r\n  while (i >= 2) { result *= i--; }\r\n  return result;\r\n}\r\n\r\nint ffi_fibonacci(int n) {\r\n  int a = 1, b = 1, c, i;\r\n  if (n == 0) {\r\n	return 0;\r\n  }\r\n\r\n  for (i= 3; i <= n; i++) {\r\n	c = a + b;\r\n	c = b;\r\n	b = c;\r\n  }\r\n\r\n  return b;\r\n}\r\n```\r\n\r\nCompile it :\r\n\r\n```sh\r\ngcc -c -fPIC ffi_test.c\r\ngcc -shared -o ffi_test.so ffi_test.o\r\n```\r\n\r\nCreate the Ruby wrapper ffi_test.rb.\r\n\r\n```ruby\r\nrequire \'ffi\'\r\n\r\nmodule FfiCustomTest\r\n  extend FFI::Library\r\n  ffi_lib \'c\'\r\n  ffi_lib \'./ffi_test.so\'\r\n\r\n  attach_function :ffi_pow, [ :int, :int ], :int\r\n  attach_function :ffi_factorial, [ :int ], :int\r\n  attach_function :ffi_fibonacci, [ :int ], :int\r\nend\r\n\r\nputs FfiCustomTest.ffi_factorial(5)\r\nputs FfiCustomTest.ffi_fibonacci(9)\r\nputs FfiCustomTest.ffi_pow(2, 10)\r\n\r\n~/projects/ffi$ ruby ffi_test.rb\r\n120\r\n1\r\n1024\r\n```\r\n\r\nExercises\r\n==========\r\n----------\r\n\r\n1. If you are using rvm, install jruby and rubinius. \r\n2. Run the code examples above on jruby, rubinius and mri. \r\n\r\nSummary\r\n==========\r\n----------\r\n\r\nIn this article we wrapped the native C code from standard library using ffi gem. We also wrapped our own C code so that we know how to wrap code that is developed within our company. If you have suffered due to gem installation problems due to native extensions, the ffi gem provides an easy way to share your native libraries by exposing it to your ruby programs via Ruby wrapper. You can also package your native libraries as a gem using this technique. \r\n\r\nReferences\r\n==========\r\n----------\r\n\r\n[Bridging MRI JRuby Rubinius with FFI](https://www.igvita.com/2009/01/15/bridging-mri-jruby-rubinius-with-ffi/ \'Bridging MRI JRuby Rubinius with FFI\')\r\n[Calling C, CPP from Ruby](https://www.amberbit.com/blog/2014/6/12/calling-c-cpp-from-ruby/ \'Calling C, CPP from Ruby\')\r\n[libffi] (http://sourceware.org/libffi/ \'libffi\')\r\n[libffi on github](https://github.com/atgreen/libffi \'libffi\')\r\n[Ruby-FFI](https://github.com/ffi/ffi \'Ruby FFI\')\r\n[Extending Ruby with C](http://www.sitepoint.com/extending-ruby-with-c/ \'Extending Ruby with C\')\r\n[FFI Ruby Docs](http://www.rubydoc.info/github/ffi/ffi/FFI/Library \'FFI Ruby Docs\')\r\n[ffi/samples directory in ffi github repo] (https://github.com/ffi/ffi/tree/master/samples \'FFI Samples\')','2014-11-07 00:10:34','2014-11-07 00:23:42'),(1181,'Stripe Recurring Billing Part 4 : Pricing Page','Discussion\r\n==========\r\n----------\r\n\r\nIn part 2 of the [Stripe Recurring Billing](http://rubyplus.com/articles/961 \'Stripe Recurring Billing\') series, we made the assumption: To make the demo simple, the stripe related code is in the application wide layout. This should be moved to a separate app/views/layouts/subscriptions.html.erb layout file. Use this layout in subscriptions controller by using the Rails layout method. \r\n\r\nIn this article, we will not make this assumption anymore. We will also create a separate pricing page where we display list of plans available for subscription. The customer will select the plan to subscribe and then fill out the credit card details to complete the subscription. \r\n\r\nSteps\r\n======\r\n------\r\n\r\nStep 1\r\n------\r\n\r\nCreate a separate layout file app/views/layouts/subscribe.html.erb for subscription. Here is the contents of this layout file:\r\n\r\n```ruby\r\n<!DOCTYPE html>\r\n<html>\r\n<head>\r\n  <title>Subscribe Now</title>\r\n\r\n  <%= stylesheet_link_tag    \'application\', media: \'all\', \'data-turbolinks-track\' => true %>\r\n  <%= javascript_include_tag \'application\' %>\r\n  \r\n  <%= javascript_include_tag \'https://js.stripe.com/v2/\' %>\r\n  <%= tag :meta, :name => \"stripe-key\", :content => STRIPE_PUBLIC_KEY %>\r\n\r\n  <script type=\"text/javascript\">\r\n    // This identifies your website in the createToken call below\r\n    Stripe.setPublishableKey($(\'meta[name=\"stripe-key\"]\').attr(\'content\'));\r\n  \r\n    var stripeResponseHandler = function(status, response) {\r\n      var $form = $(\'#payment-form\');\r\n\r\n      if (response.error) {\r\n        // Show the errors on the form\r\n        $form.find(\'.payment-errors\').text(response.error.message);\r\n        $form.find(\'button\').prop(\'disabled\', false);\r\n      } else {\r\n        // token contains id, last4, and card type\r\n        var token = response.id;\r\n        // Insert the token into the form so it gets submitted to the server\r\n        $form.append($(\'<input type=\"hidden\" name=\"stripeToken\" />\').val(token));\r\n        // and re-submit\r\n        $form.get(0).submit();\r\n      }\r\n    };\r\n    \r\n    jQuery(function($) {\r\n      $(\'#payment-form\').submit(function(event) {\r\n        var $form = $(this);\r\n\r\n        // Disable the submit button to prevent repeated clicks\r\n        $form.find(\'button\').prop(\'disabled\', true);\r\n\r\n        Stripe.card.createToken($form, stripeResponseHandler);\r\n\r\n        // Prevent the form from submitting with the default action\r\n        return false;\r\n      });\r\n    });\r\n      \r\n  </script>  \r\n\r\n  <%= csrf_meta_tags %>\r\n</head>\r\n<body>\r\n\r\n<%= yield %>\r\n\r\n</body>\r\n</html>\r\n```\r\n\r\nStep 2\r\n------\r\n\r\nUse the subscribe layout in the subscriptions controller.\r\n\r\n```ruby\r\nclass SubscriptionsController < ApplicationController\r\n  layout \'subscribe\'\r\n  \r\n  # rest of the code not shown\r\nend\r\n```\r\n\r\nStep 3\r\n------\r\n\r\nTurn off turbo links in app/views/layouts/subscribe.html.erb by adding data-no-turbolink to the body tag.\r\n\r\n```ruby\r\n<body data-no-turbolink>\r\n\r\n<%= yield %>\r\n\r\n</body>\r\n```\r\n\r\nOtherwise you will get the following error: \r\n\r\n```sh\r\nStripe::InvalidRequestError : This customer has no attached card. \r\n```\r\n\r\nThis poor error message does not tell you anything about the cause of the problem or the solution.\r\n\r\nRemove : \r\n\r\n```ruby\r\n\'data-turbolinks-track\' => true \r\n```\r\n\r\nfrom the javascript_include_tag in app/views/layouts/subscribe.html.erb file.\r\n\r\nStep 4\r\n------\r\n\r\nCreate a page where a user can select a plan to signup, app/views/subscriptions/pricing.html.erb\r\n\r\n```ruby\r\n<%= link_to \'Gold\', new_subscription_path(:plan_name => \'gold\') %> <br/>\r\n<%= link_to \'Silver\', new_subscription_path(:plan_name => \'silver\') %> <br/>\r\n<%= link_to \'Platinum\', new_subscription_path(:plan_name => \'platinum\') %> <br/>\r\n```\r\n\r\nMake sure the plan name you use here are available in your Stripe dashboard. In my case, I have \'gold\', \'silver\' and \'platinum\' plans in the Stripe \'Plans\' tab. In Stripe dashboard,  go to \'Plans\' tab and click on the details of a plan. The ID of the plan in the plan details page will correspond to the plan name \'gold\', \'silver\' and \'platinum\'.\r\n\r\nStep 5\r\n------\r\n\r\nAdd the code for the new method in subscriptions controller:\r\n\r\n```ruby\r\ndef new\r\n  @plan_name = params[:plan_name]\r\nend\r\n```\r\n\r\nWhen the user clicks on the plan they want to subscribe in the pricing plan page, let\'s say \'Gold\', the name-value pair will be` plan_name`=\'gold\'. This `plan_name` value will be used as the hidden field in the subscription form page. \r\n\r\nStep 6\r\n------\r\n\r\nChange the view to add hidden field for plan_name in app/views/subscriptions/new.html.erb file.\r\n\r\n```ruby\r\n<%= hidden_field_tag :plan_name, @plan_name %>\r\n```\r\n\r\nStep 7\r\n------\r\n\r\nReplace the hard-coded value of plan in the subscriptions controller with the value of hidden field for \'plan name\'. Here is the subscriptions controller:\r\n\r\n```ruby\r\nclass SubscriptionsController < ApplicationController\r\n    \r\n  def create\r\n    stripe = StripeGateway.new(logger)\r\n\r\n    @subscription = stripe.create_subscription(\'current_user.email\', params[:stripeToken], params[:plan_name])\r\n  end\r\n  \r\n  # other code not shown\r\nend\r\n```\r\n\r\nStep 8\r\n------\r\n\r\nDefine the route for pricing page in config/routes.rb file:\r\n\r\n```ruby\r\nget \'pricing\' => \'subscriptions#pricing\'\r\n```\r\n\r\nStep 9\r\n------\r\n\r\nGive named route for new subscription page so that `plan_name` can be passed as the name-value pair in the URL. Add the following to config/routes.rb:\r\n\r\n```ruby\r\nget \'subscriptions/new\' => \'subscriptions#new\', as: :new_subscription\r\n```\r\n\r\nStep 10\r\n------\r\n\r\nChange the integration test, spec/features/subscribe_spec.rb as follows:\r\n\r\n```ruby\r\nrequire \'rails_helper\'\r\n\r\nfeature \'Subscription\' do\r\n  scenario \'Customer subscribes to Gold plan\', js: true do\r\n    visit \"/pricing\"\r\n    click_link \'Gold\'\r\n    fill_in \"Card Number\", with: \'4242424242424242\'\r\n    page.select \'10\', from: \"card_month\"\r\n    page.select \'2029\', from: \'card_year\'\r\n    \r\n    click_button \'Subscribe Me\'\r\n    expect(page).to have_content(\'You have been subscribed to Gold.\')\r\n  end\r\nend\r\n```\r\n\r\nRun it.\r\n\r\n```ruby\r\n$rspec spec/features/subscribe_spec.rb\r\n```\r\n\r\nIt will pass.\r\n\r\nEntire Source Code\r\n================\r\n------------------\r\n\r\napp/controllers/subscriptions_controller.rb:\r\n\r\n```ruby\r\nclass SubscriptionsController < ApplicationController\r\n  layout \'subscribe\'\r\n  \r\n  def new\r\n    @plan_name = params[:plan_name]\r\n  end\r\n  \r\n  def create\r\n    stripe = StripeGateway.new(logger)\r\n\r\n    @subscription = stripe.create_subscription(\'current_user.email\', params[:stripeToken], params[:plan_name])\r\n  end\r\n  \r\n  def pricing\r\n  end\r\nend\r\n```\r\n\r\nconfig/routes.rb:\r\n\r\n```ruby\r\nRails.application.routes.draw do\r\n  get \'subscriptions/new\' => \'subscriptions#new\', as: :new_subscription\r\n  post \'subscriptions/create\' => \'subscriptions#create\'\r\n  \r\n  get \'pricing\' => \'subscriptions#pricing\'\r\nend\r\n```\r\n\r\nspec/features/subscribe_spec.rb:\r\n\r\n```ruby\r\nrequire \'rails_helper\'\r\n\r\nfeature \'Subscription\' do\r\n  scenario \'Customer subscribes to Gold plan\', js: true do\r\n    visit \"/pricing\"\r\n    click_link \'Gold\'\r\n    fill_in \"Card Number\", with: \'4242424242424242\'\r\n    page.select \'10\', from: \"card_month\"\r\n    page.select \'2029\', from: \'card_year\'\r\n    \r\n    click_button \'Subscribe Me\'\r\n    expect(page).to have_content(\'You have been subscribed to Gold.\')\r\n  end\r\nend\r\n```\r\n\r\napp/views/subscriptions/new.html.erb:\r\n\r\n```ruby\r\n<form action=\"create\" method=\"POST\" id=\"payment-form\">\r\n  <span class=\"payment-errors\">\r\n  	<noscript>JavaScript is not enabled and is required for this form. First enable it in your web browser settings.</noscript>\r\n	</div>\r\n  </span>\r\n  <%= hidden_field_tag :authenticity_token, form_authenticity_token -%>\r\n  <%= hidden_field_tag :plan_name, @plan_name %>\r\n\r\n  <div class=\"form-row\">\r\n    <label>\r\n      <span>Card Number</span>\r\n      <input type=\"text\" size=\"20\" data-stripe=\"number\"/>\r\n    </label>\r\n  </div>\r\n\r\n  <div class=\"form-row\">\r\n    <label>\r\n      <span>Expiration</span>\r\n<%= select_month nil, {add_month_numbers: true}, {name: nil, id: \"card_month\", data: {stripe: \"exp-month\"}} %>\r\n      \r\n    </label>\r\n    <span>/</span>\r\n	<%= select_year nil, {start_year: Date.today.year, end_year: Date.today.year+15}, {name: nil, id: \"card_year\", data: {stripe: \"exp-year\"}} %>\r\n	\r\n  </div>\r\n\r\n  <button type=\"submit\">Subscribe Me</button>\r\n</form>\r\n```\r\n\r\napp/views/layouts/subscriptions/pricing.html.erb:\r\n\r\n```ruby\r\n<%= link_to \'Gold\', new_subscription_path(:plan_name => \'gold\') %> <br/>\r\n<%= link_to \'Silver\', new_subscription_path(:plan_name => \'silver\') %> <br/>\r\n<%= link_to \'Platinum\', new_subscription_path(:plan_name => \'platinum\') %> <br/>\r\n```\r\n\r\napp/views/subscriptions/create.html.erb:\r\n\r\n```ruby\r\n<% if @subscription.complete? %>\r\nYou have been subscribed to <%= @subscription.plan_display_name %>.\r\n<% end %>\r\n```\r\n\r\nCode Download\r\n=======\r\n-------\r\n\r\nYou can download the entire source code from : git@bitbucket.org:bparanj/striped.git. Use the commit hash a58d293 to checkout the code for the version corresponding to this article.\r\n\r\nSummary\r\n=======\r\n-------\r\n\r\nIn this article, we created a separate layout to handle subscription. We also created a separate page to display pricing plans available for subscription and updated the integration test to test this new flow of the subscription feature using Capybara and RSpec.\r\n\r\nReference\r\n=========\r\n---------\r\n\r\n[Capybara Cheatsheet](https://gist.github.com/zhengjia/428105 \'Capybara Cheatsheet\')','2014-11-07 21:46:59','2016-12-22 19:44:27'),(1191,'Stripe Recurring Billing Part 5 : Testing using Stripe Ruby Mock Gem ','Discussion\r\n========\r\n--------\r\n\r\nTesting Stripe related code becomes difficult because of too much stubbing code. To make this easier, we will use stripe-ruby-mock gem. This gem does not make any network calls, so we don\'t hit stripe\'s servers. So, our tests run faster.\r\n\r\nSteps\r\n========\r\n--------\r\n\r\nStep 1\r\n--------\r\n\r\nAdd the stripe-ruby-mock gem to Gemfile and run bundle install.\r\n\r\n```ruby\r\ngroup :test do\r\n  gem \'capybara\'\r\n  gem \'selenium-webdriver\'\r\n  gem \'stripe-ruby-mock\'\r\nend\r\n```\r\n\r\nStep 2\r\n--------\r\n\r\nHere is the tests that checks if we are saving the subscription details in our database and if the customer subscribed to our gold plan.\r\n\r\n```ruby\r\nrequire \'stripe_mock\'\r\nrequire \'rails_helper\'\r\n\r\n\r\ndescribe StripeGateway do\r\n  let(:stripe_helper) { StripeMock.create_test_helper }\r\n  let(:plan) { stripe_helper.create_plan(:id => \'gold\', :amount => 1500) }\r\n  \r\n  before { StripeMock.start }\r\n  after { StripeMock.stop }\r\n  \r\n  it \'creates a stripe customer in our database\' do\r\n    sg = StripeGateway.new(Rails.logger)\r\n    \r\n    expect do\r\n      subscription = sg.create_subscription(\'test-email\', stripe_helper.generate_card_token, plan.id)\r\n    end.to change{Subscription.count}.by(1)\r\n  end\r\n\r\n  it \'customer should be subscribed to gold plan\' do\r\n    sg = StripeGateway.new(Rails.logger)\r\n    subscription = sg.create_subscription(\'test-email\', stripe_helper.generate_card_token, plan.id)\r\n    \r\n    expect(subscription.plan_name).to eq(\'gold\')\r\n  end\r\n  \r\nend\r\n```\r\n\r\nStep 3\r\n--------\r\n\r\nHere is the `spec/controllers/subscriptions_controller_spec.rb`:\r\n\r\n```ruby\r\nrequire \'rails_helper\'\r\n\r\ndescribe SubscriptionsController do\r\n  \r\n  it \'should delegate creating stripe customer and subscription record to stripe gateway\' do\r\n    stripe_gateway = instance_double(\'StripeGateway\')    \r\n    allow(StripeGateway).to receive_messages(:new => stripe_gateway)\r\n    allow(stripe_gateway).to receive(:create_subscription).with(\'current_user.email\', \'1\', \'gold\')\r\n\r\n    post :create, { stripeToken: \'1\', plan_name: \'gold\'}\r\n  end\r\n  \r\n  it \'should initialize plan name\' do\r\n    get :new, {plan_name: \'gold\'}\r\n    \r\n    expect(assigns(:plan_name)).to eq(\'gold\')\r\n  end\r\nend\r\n```\r\n\r\nStep 4\r\n-------\r\n\r\nHere is the test for the subscription model.\r\n\r\n```ruby\r\nrequire \'rails_helper\'\r\n\r\ndescribe Subscription do\r\n  it \'should display plan name in human readable form\' do\r\n    subscription = Subscription.new(plan_name: \'gold\')\r\n    \r\n    expect(subscription.plan_display_name).to eq(\'Gold\')\r\n  end\r\n  \r\n  it \'subscription is not complete when the customer is not in stripe system\' do\r\n    subscription = Subscription.new\r\n    \r\n    expect(subscription).not_to be_complete\r\n  end\r\n\r\n  it \'subscription is complete when the customer is in the strip system\' do\r\n    subscription = Subscription.new(stripe_customer_token: 1)\r\n    \r\n    expect(subscription).to be_complete\r\n  end  \r\n  \r\nend\r\n```\r\n\r\nThis spec uses the latest stubbing and mocking syntax for RSpec mocks version 3.0.4. See the link in the reference section for more details. You can checkout the code for this article by cloning 8aa4a8f commit of git repository `git@bitbucket.org:bparanj/striped.git`.\r\n\r\nReferences\r\n=========\r\n---------\r\n\r\n[Notable Changes in RSpec 3] (http://myronmars.to/n/dev-blog/2014/05/notable-changes-in-rspec-3 \'Notable Changes in RSpec 3\')\r\n[Stripe Ruby Mock Gem Home Page](https://github.com/rebelidealist/stripe-ruby-mock \'Stripe Ruby Mock Gem\')\r\n[RSpec Builtin Matchers](https://www.relishapp.com/rspec/rspec-expectations/docs/built-in-matchers \'RSpec Builtin Matchers\')','2014-11-08 21:22:05','2016-12-22 19:45:24'),(1201,'Stripe Recurring Billing Part 6 : Making Use Cases Explicit to Achieve Traceability in a System.','Discussion\r\n==========\r\n----------\r\n\r\nI had read the book written by I. Jacobson, `Object-Oriented Software Engineering: A Use Case Driven Approach` in the 1990s. But the problem is that once we write the use cases, it becomes documentation and it does not exist in the code. I have worked on many complex Rails projects. I have seen the lack of object oriented code. I have cleaned up the code to bring abstractions into the code base to make it stable. I was able to apply separation of concerns and other good design principles. But the use cases are cross cutting, so it cuts through layers and calls methods on objects in different layers.\r\n\r\nI was under the impression that code written by other developers is always bad. Then I realized that the projects that I had developed from scratch that evolved over a period of years lacked something. The code was very object oriented. But whenever I went back to the code base after some break, I had the `WTF` moments. I was not able to understand my own code base. I did not know what features were used by what actors. I had no idea which classes were involved in implementing a given use case. \r\n\r\nOf course, you might think BDD solves that problem. Where you have story in a specific format:\r\n\r\n```bash\r\nFeature : [Feature Name]\r\n\r\nAs an [Actor]\r\nI want to [some system behavior]\r\nSo that I can [have a tangible benefit]\r\n```\r\n\r\nThis does not solve the problems that I am talking about here. In my opinion Cucumber brings in additional complexity instead of helping to bring simplicity into our software. \r\n\r\nI had over 95% test coverage. Tests are executable documentation. But, there is a major flaw in the argument that tests can be an executable documentation. This might be true when you view the software in terms of class and group of classes collaborating with each other. But when you view the software as a system viewed from a user perspective, you do not see how the features are implemented in the system. The problems that I could not pinpoint became very clear as I read the papers that I have listed in the references section of this article. These problems are:\r\n\r\n1. Program Comprehension\r\n2. Debugging\r\n3. Re-engineering\r\n\r\nProgram comprehension is about forming a hypothesis about how the code functions. It also is about locating code that supports a hypothesis. This is a search in space. \r\n\r\nWhat is software re-engineering? Re-engineering is the examination, analysis and alteration of an existing software system to reconstitute it in a new form and the subsequent implementation of the new form. To a large extent, it involves maintenance activities:\r\n\r\n- Understanding (predictive)\r\n- Repairing (corrective)\r\n- Improving (perfective)\r\n- Evolving (adaptive)\r\n\r\nThe intentions of the user stated in the requirements is transformed to software architecture and source code. There is a gap in the representation of the software by the developers and the user\'s representation of the system. The repairing, improving and evolving requirements comes from users. It is represented in terms of user\'s perspective. We have a problem mapping these bug fixes, enhancements and changes demanded to the system implemented in terms of developer\'s view.\r\n\r\nThe main cause of all these problems is lack of traceability. Requirement tracing is about locating source code that corresponds to a program specification. It enables code inspection. So, here are the questions we need to ask ourselves:\r\n\r\n- How can we recover the intentions of the user\'s view of the system? \r\n- How do we make them explicit in the code? \r\n- How to associate source code with use cases? \r\n- How to easily map change requests and failure reports to use cases and source code entities? \r\n- How does change to one use-case implementation affect others? \r\n\r\nWe need to have program comprehension with use case traceability. Our aim is to achieve use case driven fault localization. This is a search problem in time (when) and space (where) of programs. So:\r\n\r\n- Is there an alternative to grep and find all files for given search string? \r\n- How to reduce the large result set of the search? \r\n- Can we reduce the effort required by the developer?\r\n\r\nActors and Use Cases\r\n==========\r\n----------\r\n\r\nHere is a list of actors and their use cases from a real project. Notice that the system is represented as an actor, since certain domain events triggers its corresponding use cases.\r\n\r\n- Seller\r\n	- Login\r\n	- Logout\r\n	- Register for a publisher account\r\n	- View sales report\r\n	- Upgrade to paid account\r\n	- Setup Product\r\n	- Get buy now link\r\n	- Setup profile\r\n- Buyer\r\n 	- Buy product\r\n	- View order confirmation\r\n- System\r\n	- Send order confirmation email to buyer\r\n	- Send digital product delivery email to buyer\r\n	- Fulfill order\r\n- Affiliate\r\n	- Register for an affiliate account\r\n	- View referrals\r\n	- View bounties\r\n	- Get affiliate link for a product\r\n\r\nAs you can see from this list, there are quite a few actors with lot of use cases. Each use case will have alternate scenarios. The alternate scenarios will make the code base even more difficult to understand. Especially when it is handled without making the use cases explicit in the source code. \r\n\r\nLet\'s look at some code where the structure of the code reflects what the system can do and for whom - the use cases and the actors. The use case and alternate scenarios can be encapsulated together to preserve traceability. Now, we can get a quick view of all use cases by looking at the file names.\r\n\r\nAlternate scenarios can go into the same use case. If you watch Robert Martin\'s clean code screencasts, he talks about making use cases explicit. We want our solution to be practical that achieves our traceability goal. So let\'s see how we can implement this in our Stripe Recurring Billing project.\r\n\r\nSteps\r\n==========\r\n----------\r\n\r\nStep 1\r\n----------\r\n\r\nThe directory structure we would like to have is `app/actors/{actor name}/use_cases/use_case_name.rb`. This allows several actors to be included inside the actors directory. Each actor will have list of use cases under use_cases directory. Each each `use-case-name.rb` file will provide an entry point to the fulfillment of the use case. \r\n\r\nOne nice side-effect of this is that we will now have an API layer that is just below the UI layer that the view layer, scripts and tests can invoke. This means our entire system can be tested without testing it through an UI. We can drop into Rails console and invoke this API to learn and debug our software.\r\n\r\nCreate `app/actors/customer/use_cases` directory. Create a file `subscribe_to_a_plan.rb` under this directory. The contents of this file is as follows:\r\n\r\n```ruby\r\nmodule Actors\r\n  module Customer\r\n    module UseCases\r\n      \r\n      def self.subscribe_to_a_plan(email, stripe_token, plan_name, logger)\r\n        stripe = StripeGateway.new(logger)\r\n        customer = stripe.create_subscription(email, stripe_token, plan_name)    \r\n        \r\n        subscription = Subscription.new\r\n        subscription.save_details(customer.id, plan_name)\r\n      end      \r\n      \r\n    end\r\n  end\r\nend\r\n```\r\n\r\nYou can see the use case delegates the implementation to the objects in the appropriate layer. We can now see clearly what methods in which classes are invoked to accomplish a given use case. We have achieved traceability. You can also easily see all the use cases for a given actor by expanding the use_cases folder for a given actor. We can quickly locate the relevant classes used to implement a given use case.\r\n\r\nBy the way, this is a great place to trigger active record call backs logic that delegates to appropriate objects. Having lot of active record call backs in the models in a Rails project can become a nightmare to maintain in big projects. This nightmare is due to the fact that you don\'t know which use case uses which call back, which needs to be skipped for which cases and the order in which the call backs execute. There can be lot of different combinations of use cases and call backs that can create lot of confusion, stress and slow down development. By encapsulating use case specific callbacks within the use case itself makes it easy to see the runtime behavior of the system and to reason about the code.\r\n\r\nStep 2\r\n==========\r\n----------\r\n\r\nAdd the following to the app/actors/customer/customer.rb file:\r\n\r\n```ruby\r\nrequire_relative \"#{Rails.root}/app/actors/customer/use_cases/subscribe_to_a_plan\"\r\n```\r\n\r\nStep 3\r\n==========\r\n----------\r\n\r\nThe StripeGateway is now more cohesive now and is the great implementation of Gateway pattern as described in [Patterns of Enterprise Application Architecture](http://martinfowler.com/books/eaa.html \'Patterns of Enterprise Application Architecture\'). \r\n\r\n```ruby\r\nclass StripeGateway\r\n  def initialize(logger)\r\n    @logger = logger\r\n  end\r\n  \r\n  def create_subscription(email, stripe_token, plan_id)\r\n    begin\r\n      customer = Stripe::Customer.create(description: email, card: stripe_token, plan: plan_id)\r\n    rescue Stripe::InvalidRequestError => e\r\n      @logger.error \"Create subscription failed due to Stripe::InvalidRequestError : #{e.message}\"\r\n    rescue Exception => ex\r\n      @logger.error \"Create subscription failed due to : #{ex.message}\"  \r\n    end\r\n  end\r\n  \r\nend\r\n```\r\n\r\nHere is the `stripe_gateway_spec.rb`.\r\n\r\n```ruby\r\nrequire \'stripe_mock\'\r\nrequire \'rails_helper\'\r\n\r\ndescribe StripeGateway do\r\n  let(:stripe_helper) { StripeMock.create_test_helper }\r\n  let(:plan) { stripe_helper.create_plan(:id => \'gold\', :amount => 1500) }\r\n  \r\n  before { StripeMock.start }\r\n  after { StripeMock.stop }\r\n  \r\n  it \'customer should be subscribed to gold plan\' do\r\n    sg = StripeGateway.new(Rails.logger)\r\n    customer = sg.create_subscription(\'test-email\', stripe_helper.generate_card_token, plan.id)\r\n    \r\n    expect(customer.id).to eq(\'test_cus_3\')\r\n  end\r\n  \r\nend\r\n```\r\n\r\nStep 4\r\n==========\r\n----------\r\n\r\nSubscriptions controller becomes simple.\r\n\r\n```ruby\r\nclass SubscriptionsController < ApplicationController\r\n  layout \'subscribe\'\r\n  \r\n  def new\r\n    @plan_name = params[:plan_name]\r\n  end\r\n  \r\n  def create\r\n    @subscription = Actors::Customer::UseCases.subscribe_to_a_plan(\'current_user.email\', \r\n                                                                   params[:stripeToken], \r\n                                                                   params[:plan_name], \r\n                                                                   logger)    \r\n  end\r\n  \r\n  def pricing\r\n  end\r\nend\r\n```\r\n\r\nStep 5\r\n==========\r\n----------\r\n\r\nUpdate the controller spec, `subscriptions_controller_spec.rb`:\r\n\r\n```ruby\r\nrequire \'rails_helper\'\r\n\r\ndescribe SubscriptionsController do\r\n  \r\n  it \'should delegate creating stripe customer to stripe gateway\' do    \r\n    allow(Actors::Customer::UseCases).to receive(:subscribe_to_a_plan).with(\'current_user.email\', \'1\', \'gold\', Rails.logger)\r\n\r\n    post :create, { stripeToken: \'1\', plan_name: \'gold\'}\r\n  end\r\n  \r\n  it \'should initialize plan name\' do\r\n    get :new, {plan_name: \'gold\'}\r\n    \r\n    expect(assigns(:plan_name)).to eq(\'gold\')\r\n  end\r\nend\r\n```\r\n\r\nStep 6\r\n==========\r\n----------\r\n\r\nHere is the latest code for subscription model.\r\n\r\n```ruby\r\nclass Subscription < ActiveRecord::Base\r\n  \r\n  def plan_display_name\r\n    self.plan_name.humanize\r\n  end\r\n  \r\n  def complete?\r\n    self.stripe_customer_token.present?\r\n  end\r\n  \r\n  def save_details(customer_id, plan_id)\r\n    self.stripe_customer_token = customer_id\r\n    self.plan_name = plan_id\r\n    self.save!\r\n    self\r\n  end\r\nend\r\n```\r\n\r\nNew spec is now added to subscription_spec.rb.\r\n\r\n```ruby\r\nrequire \'rails_helper\'\r\n\r\ndescribe Subscription do\r\n  it \'should display plan name in human readable form\' do\r\n    subscription = Subscription.new(plan_name: \'gold\')\r\n    \r\n    expect(subscription.plan_display_name).to eq(\'Gold\')\r\n  end\r\n  \r\n  it \'subscription is not complete when the customer is not in stripe system\' do\r\n    subscription = Subscription.new\r\n    \r\n    expect(subscription).not_to be_complete\r\n  end\r\n\r\n  it \'subscription is complete when the customer is in the strip system\' do\r\n    subscription = Subscription.new(stripe_customer_token: 1)\r\n    \r\n    expect(subscription).to be_complete\r\n  end  \r\n  \r\n  it \'should save customer subscription details\' do\r\n    subscription = Subscription.new\r\n    subscription.save_details(\'1\', \'gold\')\r\n    \r\n    expect(subscription.stripe_customer_token).to eq(\'1\')\r\n    expect(subscription.plan_name).to eq(\'gold\')\r\n  end\r\nend\r\n```\r\n\r\nIn `Code Complete 2`, Steve McConnell says:\r\n\r\n> \"Programmers who program \'in\' a language limit their thoughts to constructs that the language directly supports. If the language tools are primitive, the programmer’s thoughts will also be primitive.\r\n\r\n> Programmers who program \'into\' a language first decide what thoughts they want to express, and then they determine how to express those thoughts using the tools provided by their specific language.\r\n\r\n> Most of the important programming principles depend not on specific languages but on the way you use them. If your language lacks constructs that you want to use or is prone to other kinds of problems, try to compensate for them. Invent your own coding conventions, standards, class libraries, and other augmentations.\"\r\n \r\nI have augmented my code base by using use cases. You can download the entire source code for this article from bitbucket repository `git@bitbucket.org:bparanj/striped.git` using the commit hash a3829cf. \r\n\r\nThere are other approaches that I don\'t really like, such as [Writing Use Cases] (http://hawkins.io/2014/01/writing_use_cases/ \'Writing Use Cases\') blog post by Adam Hawkins and the horrible [Interactor Gem](https://github.com/collectiveidea/interactor \'interactor\'). For more details, read [Why using Interactor Gem is a Very Bad Idea](http://bparanj.blogspot.com/2014/06/why-using-interactor-gem-is-very-bad.html \'Why using Interactor Gem is a Very Bad Idea\'). I don\'t think it\'s a good idea to have use case name as the class name. It\'s just ugly.\r\n\r\nSummary\r\n==========\r\n----------\r\n\r\nIn this article we discussed about making use cases explicit in the source code to achieve traceability. The bigger your project more important it becomes to have traceability in the system. We refactored our existing code base and re-allocated responsibility to the appropriate layer in our system. This also had a nice benefit of simplifying the classes and the tests. \r\n\r\nReferences\r\n==========\r\n----------\r\n\r\n1. A Scenario-Driven Approach to Traceability. Paper by Alexander Egyed Teknowledge Corporation.\r\n2. Recovering Traceability Links Between Code and Documentation. Paper by Giuliano Antoniol, Gerardo Canfora, Gerardo Casazza, Andrea De Lucia and Ettore Merlo.\r\n3. Explicit Use-Case Representation in Object-Oriented Programming Languages. Paper by Robert Hirschfeld, Michael Perscheid, Michael Haupt. University of Potsdam, Germany.\r\n4. [Software Re-engineering Lecture Slides](http://www.cs.toronto.edu/~yijun/ece450h/handouts/lecture2.pdf \'Software Re-engineering\')\r\n5. [Software Reengineering](http://www.slideshare.net/awahid/software-reengineering \'Software Reengineering\')\r\n6. [Gateway Pattern](http://martinfowler.com/eaaCatalog/gateway.html \'Gateway Pattern\')\r\n7. [Why using Interactor Gem is a Very Bad Idea](http://bparanj.blogspot.com/2014/06/why-using-interactor-gem-is-very-bad.html \'Why using Interactor Gem is a Very Bad Idea\')','2014-11-09 05:32:56','2016-12-22 19:47:18'),(1211,'Stripe Recurring Billing Part 7 : Dealing with Exceptions','Objective\r\n=========\r\n---------\r\n\r\nTo learn how to handle exceptions and make the code robust.\r\n\r\nDiscussion\r\n=========\r\n---------\r\n\r\n>> Distinguish between business exceptions and technical. Create a specific exception so that the client can handle the situation on its own terms. \r\n\r\n>> Tip by Dan Bergh Johnsson from the book 97 Things a Programmer Should Know\r\n\r\nThe application should separate data access logic from business logic. We don\'t want our application to be dependent on the external systems such as database, API, messaging bus etc. We encapsulate the low-lever data manipulation logic in a data access layer. This is isolated from the domain model. External systems have their own errors and exceptions. These errors should not propagate to other layers, if it does, the other layers will become specific to the implementation details and will make switching to a different data source difficult. Therefore we lose flexibility. To prevent this, we can translate the technical exceptions to business exceptions in the data access layer. \r\n\r\nWe can also have a data mapper layer that maps the persistence objects to domain objects. Thus the data mapper layer protects the application from the data formats dictated by the persistence layer. It also makes the data access layer agnostic to how the domain model works. So, the application logic and data access logic are separated from each other. This means we have achieved Separation of Concerns. This also means that these layers can be developed in parallel by different teams without depending on each other. We can allocate work according to the strength in skills of the developers. Changes in one layer does not affect any changes to the other layers. Testing will also be easier since we test each layer in isolation. As long as we program to an interface that defines the communication between layers, changes do not ripple into other layers of the system. External systems are wrapped in a well defined interface.\r\n\r\nSteps\r\n=========\r\n---------\r\n\r\nStep 1\r\n---------\r\n\r\nThe credit card 4000000000000069 can be used to simulate a decline due to expired card. The Stripe API will throw a Stripe::CardError exception for this case. We must notify the user about the reason for the decline so that they can use a different card to subscribe to our SaaS application. The business exception in this case is CreditCardDeclined with the message \'Your card has expired\'. \r\n\r\nCreate a directory named exceptions/striped under app directory. Create application specific exception class, under this directory: `credit_card_declined.rb`:\r\n\r\n```ruby\r\nmodule Striped\r\n  class  CreditCardDeclined < Exception\r\n  end\r\nend\r\n```\r\n\r\nStep 2\r\n-------\r\n\r\nAdd rescue clause to handle Stripe::CardError in the `create_subscription` method of the StripeGateway class as follows:\r\n\r\n```ruby\r\ndef create_subscription(email, stripe_token, plan_id)\r\n  begin\r\n    customer = Stripe::Customer.create(description: email, card: stripe_token, plan: plan_id)\r\n  rescue Stripe::CardError => e\r\n    # Since it\'s a decline, Stripe::CardError will be caught\r\n    body = e.json_body\r\n    err  = body[:error]\r\n\r\n    @logger.error \"Status is: #{e.http_status}\"\r\n    @logger.error \"Type is: #{err[:type]}\"\r\n    @logger.error \"Code is: #{err[:code]}\"\r\n    # param is \'\' in this case\r\n    @logger.error \"Param is: #{err[:param]}\"\r\n    @logger.error \"Message is: #{err[:message]}\" \r\n\r\n    raise Striped::CreditCardDeclined.new(err[:message])     \r\n  rescue Stripe::InvalidRequestError => e\r\n    @logger.error \"Create subscription failed due to Stripe::InvalidRequestError : #{e.message}\"\r\n  rescue Exception => ex\r\n    @logger.error \"Create subscription failed due to : #{ex.message}\"  \r\n  end\r\nend\r\n```\r\n\r\nThe StripeGateway class now translates the external Stripe specific exception Stripe::CardError to our application specific Striped::CreditCardDeclined exception.\r\n\r\nStep 3\r\n-------\r\n\r\nChange the SubscriptionsController#create method to handle the credit card decline.\r\n\r\n```ruby\r\ndef create\r\n  begin\r\n    @subscription = Actors::Customer::UseCases.subscribe_to_a_plan(\'current_user.email\', \r\n                                                                   params[:stripeToken], \r\n                                                                   params[:plan_name], \r\n                                                                   logger)    \r\n  rescue Striped::CreditCardDeclined => e\r\n    @error_message = e.message\r\n    @subscription = Subscription.new\r\n                \r\n    render :new\r\n  end\r\nend\r\n```\r\n\r\nOur application now depends on our application specific exception class, Striped::CreditCardDeclined. \r\n\r\nStep 4\r\n-------\r\n\r\nChange the app/views/subscriptions/new.html.erb to display the error message above the credit card number text field:\r\n\r\n```ruby\r\n<% if @error_message %>\r\n	<%= @error_message %>\r\n<% end %>\r\n```\r\n\r\nStep 5\r\n-------\r\n\r\nUsing stripe mock to simulate a declined credit card gets very messy. So we will use Capybara integration test to test the credit card decline. Let\'s add a new scenario to `spec/features/subscribe_spec.rb`:\r\n\r\n```ruby\r\nscenario \'Customer subscription credit card decline\', js: true do\r\n  visit \"/pricing\"\r\n  click_link \'Gold\'\r\n  fill_in \"Card Number\", with: \'4000000000000069\'\r\n  page.select \'10\', from: \"card_month\"\r\n  page.select \'2029\', from: \'card_year\'\r\n  \r\n  click_button \'Subscribe Me\'\r\n  expect(page).to have_content(\'Your card has expired.\')\r\nend\r\n```\r\n\r\nAll tests will pass. \r\n\r\nStep 6\r\n-------\r\n\r\nCreate `credit_card_exception.rb` in app/exceptions/striped directory.\r\n\r\n```ruby\r\nmodule Striped\r\n  class  CreditCardException < Exception\r\n  end\r\nend\r\n```\r\n\r\nStep 7\r\n-------\r\n\r\nLet\'s add more tests to make the controller robust. Here is the complete source code for `subscriptions_controller_spec.rb`.\r\n\r\n```ruby\r\nrequire \'rails_helper\'\r\n\r\ndescribe SubscriptionsController do\r\n  \r\n  it \'should delegate creating stripe customer to stripe gateway\' do    \r\n    allow(Actors::Customer::UseCases).to receive(:subscribe_to_a_plan).with(\'current_user.email\', \'1\', \'gold\', Rails.logger)\r\n\r\n    post :create, { stripeToken: \'1\', plan_name: \'gold\'}\r\n  end\r\n  \r\n  it \'should initialize plan name\' do\r\n    get :new, {plan_name: \'gold\'}\r\n    \r\n    expect(assigns(:plan_name)).to eq(\'gold\')\r\n  end\r\n\r\n  it \'should handle credit card exception\' do\r\n    post :create, {stripeToken: \'bogus\', plan_name: \'junk\' }\r\n    \r\n    expect(assigns(:error_message)).to eq(\'Subscription failed. We have been notified about this problem.\')\r\n  end\r\n  \r\n  it \'should render the form when credit card exception occurs\' do\r\n    post :create, {stripeToken: \'bogus\', plan_name: \'junk\' }\r\n    \r\n    expect(response).to render_template(:new)\r\n  end\r\n  \r\n  it \'should raise credit card exception when authentication error occurs\' do\r\n    Stripe.api_key = \'junk\'\r\n\r\n    post :create, {stripeToken: \'bogus\', plan_name: \'junk\' }\r\n    \r\n    expect(assigns(:error_message)).to eq(\'Subscription failed. We have been notified about this problem.\')\r\n  end\r\nend\r\n```\r\n\r\nStep 8\r\n-------\r\n\r\nHere is the complete source code for `subscriptions_controller.rb`.\r\n\r\n```ruby\r\ndef create\r\n  begin\r\n    @subscription = Actors::Customer::UseCases.subscribe_to_a_plan(\'current_user.email\', \r\n                                                                   params[:stripeToken], \r\n                                                                   params[:plan_name], \r\n                                                                   logger)    \r\n  rescue Striped::CreditCardDeclined => e\r\n    redisplay_form(e.message)\r\n  rescue Striped::CreditCardException, Exception => e\r\n    redisplay_form(\"Subscription failed. We have been notified about this problem.\")\r\n  end\r\nend\r\n```\r\n\r\nStep 9\r\n-------\r\n\r\nHere is the complete source code for `stripe_gateway_spec.rb`.\r\n\r\n```ruby\r\nrequire \'stripe_mock\'\r\nrequire \'rails_helper\'\r\nrequire \'stripe\'\r\n\r\ndescribe StripeGateway do\r\n  context \'success scenario\' do\r\n    let(:stripe_helper) { StripeMock.create_test_helper }\r\n    let(:plan) { stripe_helper.create_plan(:id => \'gold\', :amount => 1500) }\r\n\r\n    before { StripeMock.start }\r\n    after { StripeMock.stop }\r\n\r\n    it \'customer should be subscribed to gold plan\' do\r\n      sg = StripeGateway.new(Rails.logger)\r\n      customer = sg.create_subscription(\'test-email\', stripe_helper.generate_card_token, plan.id)\r\n\r\n      expect(customer.id).to eq(\'test_cus_3\')\r\n    end\r\n  end\r\n\r\n  it \'should raise credit card exception when Stripe::InvalidRequestError occurs\' do\r\n    sg = StripeGateway.new(Rails.logger)\r\n\r\n    expect do\r\n      customer = sg.create_subscription(\'fake\', \'bogus\', \'junk\')\r\n    end.to raise_error Striped::CreditCardException\r\n\r\n  end\r\n  \r\nend\r\n```\r\n\r\nStep 10\r\n-------\r\n\r\nHere is the complete source code for `stripe_gateway.rb`.\r\n\r\n```ruby\r\nclass StripeGateway\r\n  def initialize(logger)\r\n    @logger = logger\r\n  end\r\n  \r\n  def create_subscription(email, stripe_token, plan_id)\r\n    begin\r\n      customer = Stripe::Customer.create(description: email, card: stripe_token, plan: plan_id)\r\n    rescue Stripe::CardError => e\r\n      # Since it\'s a decline, Stripe::CardError will be caught\r\n      body = e.json_body\r\n      err  = body[:error]\r\n\r\n      @logger.error \"Status is: #{e.http_status}\"\r\n      @logger.error \"Type is: #{err[:type]}\"\r\n      @logger.error \"Code is: #{err[:code]}\"\r\n      # param is \'\' in this case\r\n      @logger.error \"Param is: #{err[:param]}\"\r\n      @logger.error \"Message is: #{err[:message]}\" \r\n\r\n      raise Striped::CreditCardDeclined.new(err[:message])     \r\n    rescue Stripe::InvalidRequestError => e\r\n      @logger.error \"Create subscription failed due to Stripe::InvalidRequestError : #{e.message}\"\r\n      \r\n      raise Striped::CreditCardException.new(e.message)\r\n    rescue Stripe::AuthenticationError => e\r\n      @logger.error \"Authentication with Stripe\'s API failed\"\r\n      @logger.error \"(maybe you changed API keys recently)\"\r\n      \r\n      raise Striped::CreditCardException.new(e.message)\r\n    rescue Stripe::APIConnectionError => e\r\n      @logger.error \"Network communication with Stripe failed\"\r\n    \r\n      raise Striped::CreditCardException.new(e.message)\r\n    rescue Stripe::StripeError => e\r\n      @logger.error \"Display a very generic error to the user, and maybe send yourself an email\"\r\n      \r\n      raise Striped::CreditCardException.new(e.message)\r\n    rescue Exception => ex\r\n      @logger.error \"Create subscription failed due to : #{ex.message}\"  \r\n      \r\n      raise\r\n    end\r\n  end  \r\nend\r\n```\r\n\r\nYou can download the entire source code for this article using the commit hash 31652ff from : `git@bitbucket.org:bparanj/striped.git`.\r\n\r\nSummary\r\n=======\r\n-------\r\n\r\nIn this article you learned how to make the code robust by defining application specific exceptions to handle edge cases. You also learned not to depend upon technical exceptions and how to use application specific exceptions.','2014-11-11 02:50:55','2016-12-22 19:49:55'),(1221,'Riak Basics ','Background\r\n============\r\n------------\r\n\r\nRiak installation on Mac OS is a big headache. I installed it on 64 bit Ubuntu 12.04 running in Virtual Box. Riak runs only on 64 bit Ubuntu. I setup a shared folder between the Mac OS and the Ubuntu. This allows me to edit on Mac OS using Textmate and run the program on Ubuntu environment. \r\n\r\nWhat is Riak?\r\n============\r\n------------\r\n\r\nRiak is an open source, distributed database. What is a distributed database? In order to answer that question let\'s take a look at different types of network computing. In centralized computing, there is one location where the functions are carried out. This results in single point of failure. In decentralized computing, there can be many locations where the functions are carried out. So, we don\'t have a single point of failure anymore. In distributed computing, each node is connected to every other node. It provides very high fault tolerance.\r\n\r\n![alt text](http://cffn.ca/img/articles/Centralized-Decentralized-And-Distributed-System.jpg \"NoSQL Visual Guide\")\r\n\r\nWhy Riak?\r\n============\r\n------------\r\n\r\nHere is a visual guide to NoSQL systems:\r\n\r\n![alt text](https://images.rubyplus.com/cap.png \"NoSQL Visual Guide\")\r\n\r\nYou can see that Riak has picked availability and partition tolerance. This diagram also gives you a good big picture view of how different NoSQL databases fit in the CAP triangle.\r\n\r\nAdvantages of Riak are:\r\n\r\n- Availability\r\n- Fault-Tolerance\r\n- Operational Simplicity\r\n- Low-Latency\r\n- Scalability\r\n\r\nWe already know the first two advantages from looking at the NoSQL visual guide. You can read more about the advantages from the [Riak](http://basho.com/riak/ \'Riak\') home page.\r\n\r\nInstallation\r\n============\r\n------------\r\n\r\nRiak 2.0.0.1 Installation on Ubuntu 12.04.\r\n\r\n```sh\r\ncurl https://packagecloud.io/install/repositories/basho/riak/script.deb | sudo bash\r\nsudo apt-get install riak=2.0.0-1\r\n```\r\n\r\nChecking Installation\r\n============\r\n------------\r\n\r\nTo check the installed version.\r\n\r\n```sh\r\nroot@riak:~# riak version\r\n2.0.0\r\n```\r\n\r\nTo check if the Riak node is running, use the ping command.\r\n\r\n```sh\r\nroot@riak:~# riak ping\r\npong\r\n```\r\n\r\nPrints pong for success.\r\n\r\n```sh\r\n~ $riak ping\r\nNode \'riak@127.0.0.1\' not responding to pings.\r\n```\r\nThis is the error when then node is not responding or running.\r\n\r\nRiak console starts the Riak node in the foreground and gives access to the Erlang shell.\r\n\r\n```sh\r\nroot@riak:~# riak console\r\nNode is already running - use \'riak attach\' instead\r\n```\r\n\r\nThis means that the node is running in the background.\r\n\r\n```sh\r\nroot@riak:~# riak attach\r\nRemote Shell: Use \"Ctrl-C a\" to quit. q() or init:stop() will terminate the riak node.\r\nErlang R16B02-basho5 (erts-5.10.3) [source] [64-bit] [async-threads:10] [kernel-poll:false]\r\n\r\nEshell V5.10.3  (abort with ^G)\r\n(riak@127.0.0.1)1> \r\n```\r\n\r\nRiak attach command attaches to the console of a Riak node running in the background. The console gives you access to the Erlang shell. You can exit out of the shell by pressing CTRL+C twice.\r\n\r\nTo run a test of a few standard Riak operations against the running node, you can use riak-admin command.\r\n\r\n```sh\r\nroot@riak:~# riak-admin test\r\nSuccessfully completed 1 read/write cycle to \'riak@127.0.0.1\'\r\n```\r\n\r\nThis shows the output for successful test.\r\n\r\n```sh\r\n~ $riak-admin test\r\nNode is not running!\r\n```\r\n\r\nThis is the output for failed test.\r\n\r\nPlaying with Riak in Ruby\r\n==========================\r\n--------------------------\r\n\r\nInstall the riak-client gem.\r\n\r\n```sh\r\n$gem install riak-client\r\n```\r\n\r\nLet\'s now play with riak in the irb console.\r\n\r\n```sh\r\n# irb\r\n01 > require \'riak\'\r\n => true \r\n02 > client = Riak::Client.new\r\n => #<Riak::Client [#<Node 127.0.0.1:8087>]> \r\n```\r\n\r\nCreating Objects\r\n----------------\r\n\r\nLet\'s create a bucket called \'test\' and store a few objects in it.\r\n\r\n```sh\r\n03 > bucket = client.bucket(\'test\')\r\n => #<Riak::Bucket {test}> \r\n04 > val1 = 1\r\n => 1 \r\n05 > obj1 = bucket.new(\'one\')\r\n => #<Riak::RObject {test,one} [#<Riak::RContent [application/json]:nil>]> \r\n06 > obj1.data = val1\r\n => 1 \r\n07 > obj1.store\r\n => #<Riak::RObject {test,one} [#<Riak::RContent [application/json]:1>]> \r\n08 > val2 = \'two\'\r\n => \"two\" \r\n09 > obj2 = bucket.new(\'two\')\r\n => #<Riak::RObject {test,two} [#<Riak::RContent [application/json]:nil>]> \r\n10 > obj2.data = val2\r\n => \"two\" \r\n11 > obj2.store\r\n => #<Riak::RObject {test,two} [#<Riak::RContent [application/json]:\"two\">]> \r\n12 > val3 = { foo: 3 }\r\n => {:foo=>3} \r\n13 > obj3 = bucket.new(\'three\')\r\n => #<Riak::RObject {test,three} [#<Riak::RContent [application/json]:nil>]> \r\n14 > obj3.data = val3\r\n => {:foo=>3} \r\n15 > obj3.store\r\n => #<Riak::RObject {test,three} [#<Riak::RContent [application/json]:{\"foo\"=>3}>]> \r\n```\r\n\r\nReading Objects\r\n----------------\r\n\r\nWe have three objects in the test bucket. Let\'s read them to verify the stored values.\r\n\r\n```sh\r\n16 > fetched1 = bucket.get(\'one\')\r\n => #<Riak::RObject {test,one} [#<Riak::RContent [application/json]:1>]> \r\n17 > fetched2 = bucket.get(\'two\')\r\n => #<Riak::RObject {test,two} [#<Riak::RContent [application/json]:\"two\">]> \r\n18 > fetched3 = bucket.get(\'three\')\r\n => #<Riak::RObject {test,three} [#<Riak::RContent [application/json]:{\"foo\"=>3}>]> \r\n19 > fetched1.data == val1\r\n => true \r\n20 > val1\r\n => 1 \r\n21 > fetched1.data\r\n => 1 \r\n22 > fetched2.data\r\n => \"two\" \r\n23 > val2\r\n => \"two\" \r\n24 > fetched3.data\r\n => {\"foo\"=>3} \r\n25 > fetched3.data.class\r\n => Hash \r\n26 > fetched3.data.to_json\r\n => \"{\\\"foo\\\":3}\" \r\n27 > val3.class\r\n => Hash \r\n28 > val3.to_json\r\n => \"{\\\"foo\\\":3}\" \r\n29 > fetched3.data.to_json == val3.to_json\r\n => true \r\n```\r\n\r\nUpdating Objects\r\n-----------------\r\n\r\nUpdating objects is easy. We set the new value of a stored hash like this:\r\n\r\n```sh\r\n30 > fetched3.data[\'foo\'] = 42\r\n => 42 \r\n31 > fetched3.store\r\n => #<Riak::RObject {test,three} [#<Riak::RContent [application/json]:{\"foo\"=>42}>]> \r\n32 > fetched3.data\r\n => {\"foo\"=>42} \r\n```\r\n\r\nDeleting Objects\r\n-----------------\r\n\r\nWe can either delete the bucket or the objects.\r\n\r\n```sh\r\n33 > bucket.delete(\'one\')\r\n => true \r\n34 > obj2.delete\r\n => #<Riak::RObject {test,two} [#<Riak::RContent [application/json]:\"two\">]> \r\n35 > obj3.delete\r\n => #<Riak::RObject {test,three} [#<Riak::RContent [application/json]:{\"foo\"=>3}>]> \r\n36 > obj2\r\n => #<Riak::RObject {test,two} [#<Riak::RContent [application/json]:\"two\">]> \r\n37 > f1 = bucket.get(\'one\')\r\nRiak::ProtobuffsFailedRequest: Expected success from Riak but received not_found. The requested object was not found.\r\n38 > f2 = bucket.get(\'two\')\r\nRiak::ProtobuffsFailedRequest: Expected success from Riak but received not_found. The requested object was not found.\r\n39 > f2 = bucket.get(\'three\')\r\nRiak::ProtobuffsFailedRequest: Expected success from Riak but received not_found. The requested object was not found.\r\n```\r\n\r\nComplex Objects\r\n----------------\r\n\r\nLet\'s store a hash that contains details about a book.\r\n\r\n```sh\r\n40 > book = { isbn: \'11111876755\', title: \'Get Rick Quick\', author: \'Scam Artist\', body: \'Sell something to people that they do not need\', copies_owned: 4 }\r\n => {:isbn=>\"11111876755\", :title=>\"Get Rick Quick\", :author=>\"Scam Artist\", :body=>\"Sell something to people that they do not need\", :copies_owned=>4} \r\n41 > books_bucket = client.bucket(\'books\')\r\n => #<Riak::Bucket {books}> \r\n42 > new_book = books_bucket.new(book[:isbn])\r\n => #<Riak::RObject {books,11111876755} [#<Riak::RContent [application/json]:nil>]> \r\n43 > new_book.data = book\r\n => {:isbn=>\"11111876755\", :title=>\"Get Rick Quick\", :author=>\"Scam Artist\", :body=>\"Sell something to people that they do not need\", :copies_owned=>4} \r\n44 > new_book.store\r\n => #<Riak::RObject {books,11111876755} [#<Riak::RContent [application/json]:{\"isbn\"=>\"11111876755\", \"title\"=>\"Get Rick Quick\", \"author\"=>\"Scam Artist\", \"body\"=>\"Sell something to people that they do not need\", \"copies_owned\"=>4}>]> \r\n45 > fetched_book = books_bucket.get(book[:isbn])\r\n => #<Riak::RObject {books,11111876755} [#<Riak::RContent [application/json]:{\"isbn\"=>\"11111876755\", \"title\"=>\"Get Rick Quick\", \"author\"=>\"Scam Artist\", \"body\"=>\"Sell something to people that they do not need\", \"copies_owned\"=>4}>]> \r\n46 > fetched_book.class\r\n => Riak::RObject \r\n47 > p fetched_book\r\n#<Riak::RObject {books,11111876755} [#<Riak::RContent [application/json]:{\"isbn\"=>\"11111876755\", \"title\"=>\"Get Rick Quick\", \"author\"=>\"Scam Artist\", \"body\"=>\"Sell something to people that they do not need\", \"copies_owned\"=>4}>]>\r\n => #<Riak::RObject {books,11111876755} [#<Riak::RContent [application/json]:{\"isbn\"=>\"11111876755\", \"title\"=>\"Get Rick Quick\", \"author\"=>\"Scam Artist\", \"body\"=>\"Sell something to people that they do not need\", \"copies_owned\"=>4}>]> \r\n48 > p fetched_book.raw_data\r\n\"{\\\"isbn\\\":\\\"11111876755\\\",\\\"title\\\":\\\"Get Rick Quick\\\",\\\"author\\\":\\\"Scam Artist\\\",\\\"body\\\":\\\"Sell something to people that they do not need\\\",\\\"copies_owned\\\":4}\"\r\n => \"{\\\"isbn\\\":\\\"11111876755\\\",\\\"title\\\":\\\"Get Rick Quick\\\",\\\"author\\\":\\\"Scam Artist\\\",\\\"body\\\":\\\"Sell something to people that they do not need\\\",\\\"copies_owned\\\":4}\" \r\n49 > new_book.delete\r\n => #<Riak::RObject {books,11111876755} [#<Riak::RContent [application/json]:{\"isbn\"=>\"11111876755\", \"title\"=>\"Get Rick Quick\", \"author\"=>\"Scam Artist\", \"body\"=>\"Sell something to people that they do not need\", \"copies_owned\"=>4}>]> \r\n```\r\n\r\nSummary\r\n==========\r\n----------\r\n\r\nIn this article, we installed riak database and played with it to learn how to store, retrieve and delete objects in Riak using the riak-client gem. You also learned how to check if the installation was successful.\r\n\r\nReferences\r\n==========\r\n----------\r\n\r\n1. [Installing on Mac OS X] (http://docs.basho.com/riak/latest/ops/building/installing/mac-osx/ \'Installing on Mac OS X\')\r\n2. [Starting with Riak – Part I] (http://fundatascience.wordpress.com/2014/02/15/starting-with-riak-part-i/ \'Starting with Riak – Part I\')\r\n3. [Taste of Riak](http://docs.basho.com/riak/latest/dev/taste-of-riak/ruby/ \'Taste of Riak\')\r\n4. [Centralized Decentralized and Distributed Systems] (http://www2.cffn.ca/usha/part-iii-article-by-pramod-dhakal/129-the-law-of-rule-centralized-decentralized-and-distributed-systems \'Centralized Decentralized and Distributed Systems\')\r\n','2014-11-12 01:03:32','2016-12-22 19:51:47'),(1231,'Stripe Recurring Billing Part 8: Using Devise for User Account Management','Objective\r\n==========\r\n----------\r\n\r\nIn this article, you will learn how to integrate the devise gem with our recurring billing application.\r\n\r\nSteps\r\n=======\r\n-------\r\n\r\nStep 1\r\n-------\r\n\r\nAdd the devise gem to Gemfile.\r\n\r\n```sh\r\ngem \'devise\'\r\n```\r\n\r\nRun \r\n\r\n```sh\r\nbundle install\r\n```\r\n\r\nStep 2\r\n-------\r\n\r\nCreate the user model.\r\n\r\n```sh\r\nrails generate devise user\r\n```\r\n\r\nStep 3\r\n-------\r\n\r\nGenerate devise configuration files.\r\n\r\n```sh\r\nrails generate devise:install\r\n```\r\n\r\nYou will get : NoMethodError: undefined method `devise\' for User (call \'User.connection\' to establish a connection):Class error if you skip this step. This will create  config/initializers/devise.rb and config/locales/devise.en.yml files.\r\n\r\nStep 4 \r\n-------\r\n\r\nCreate the user table. \r\n\r\n```sh\r\nrake db:migrate\r\n```\r\n\r\nStep 5\r\n-------\r\n\r\nFollow the instructions that is displayed by devise. In config/environments/development.rb:\r\n\r\n```ruby\r\nconfig.action_mailer.default_url_options = { host: \'localhost\', port: 3000 }\r\n```\r\n\r\nIn production, :host should be set to the actual host of your application.\r\n\r\nStep 6\r\n-------\r\n\r\nIn your config/routes.rb, define the root path.\r\n\r\n```ruby\r\nroot \'subscriptions#pricing\'\r\n```\r\n\r\nStep 7\r\n-------\r\n\r\nAdd flash messages in app/views/layouts/application.html.erb.\r\n\r\n```ruby\r\n<p class=\"notice\"><%= notice %></p>\r\n<p class=\"alert\"><%= alert %></p>\r\n```\r\n\r\nStep 8\r\n-------\r\n\r\nYou can copy Devise views (for customization) to your app by running:\r\n\r\n```sh\r\nrails g devise:views\r\n```\r\n\r\nStep 9.\r\n-------\r\n\r\nCheck the routes to see what URL to use for signup.\r\n\r\n```sh\r\n rake routes\r\n```\r\n\r\nStep 10\r\n-------\r\n\r\nReplace the hard-coded email with the current user email in the subscriptions controller create action.\r\n\r\n```ruby\r\ndef create\r\n  begin\r\n    @subscription = Actors::Customer::UseCases.subscribe_to_a_plan(current_user.email, \r\n                                                                   params[:stripeToken], \r\n                                                                   params[:plan_name], \r\n                                                                   logger)    \r\n  rescue Striped::CreditCardDeclined => e\r\n    redisplay_form(e.message)\r\n  rescue Striped::CreditCardException, Exception => e\r\n    redisplay_form(\"Subscription failed. We have been notified about this problem.\")\r\n  end\r\nend\r\n```\r\n\r\nStep 11\r\n-------\r\n\r\nLet\'s signup. Go to `http://localhost:3000/users/sign_up`.\r\n\r\nOnce you signup, you will go to the pricing page, subscribe to a plan. Check the new customer created in Stripe dashboard, you will see the email of the new user in the Customers tab. You can download the entire source code by checking out the commit hash 929c464 from `git@bitbucket.org:bparanj/striped.git`.\r\n\r\nSummary\r\n=======\r\n-------\r\n\r\nIn this article you learned how to integrate devise gem with our existing project. So that we can replace the hard-coded email with the current logged in user email. ','2014-11-12 22:57:52','2016-12-22 19:52:53'),(1241,'Stripe Recurring Billing Part 9 : Reusing Integration Tests','Objective\r\n=====\r\n-----\r\n\r\nTo learn how to cleanup database after running every integration tests and reuse integration tests.\r\n\r\nDiscussion\r\n=====\r\n-----\r\n\r\nAfter integrating Devise for user account management, the subscription features are broken. I was getting the error: SQLite3::BusyException: database is locked while running feature specs. Let\'s use MySQL server to solve this problem. After resolving that problem we will use database_cleaner gem to cleanup data between tests.\r\n\r\nSteps\r\n=====\r\n-----\r\n\r\nStep 1\r\n--------\r\n\r\nReplace the existing database.yml with the following:\r\n\r\n```ruby\r\n# MySQL.  Versions 4.1 and 5.0 are recommended.\r\n# \r\n# Install the MYSQL driver\r\n#   gem install mysql2\r\n#\r\n# Ensure the MySQL gem is defined in your Gemfile\r\n#   gem \'mysql2\'\r\n#\r\n# And be sure to use new-style password hashing:\r\n#   http://dev.mysql.com/doc/refman/5.0/en/old-client.html\r\ndevelopment:\r\n  adapter: mysql2\r\n  encoding: utf8\r\n  reconnect: false\r\n  database: striped_development\r\n  pool: 5\r\n  username: jack\r\n  password: jill\r\n  host: localhost\r\n  port: 3306\r\n\r\n# Warning: The database defined as \"test\" will be erased and\r\n# re-generated from your development database when you run \"rake\".\r\n# Do not set this db to the same as development or production.\r\ntest:\r\n  adapter: mysql2\r\n  encoding: utf8\r\n  reconnect: false\r\n  database: striped_test\r\n  pool: 5\r\n  username: jack\r\n  password: jill\r\n  host: localhost\r\n  port: 3306\r\n\r\nproduction:\r\n  adapter: mysql2\r\n  encoding: utf8\r\n  reconnect: false\r\n  database: striped_production\r\n  pool: 5\r\n  host: localhost\r\n  port: 3306\r\n```\r\n\r\nChange the username and password to your database specific values.\r\n\r\nStep 2\r\n-------\r\n\r\nReplace sqlite3 gem with mysql2 in the Gemfile. Run bundle install. Run rake db:create && rake db:migrate. Run the migration in test environment.\r\n\r\n```sh\r\nRAILS_ENV=test rake db:migrate\r\n```\r\n\r\nStep 3\r\n-------\r\n\r\nJust delete the password confirmation field from app/views/registrations/new.html.erb file. It\'s less work for the users.\r\n\r\n```ruby\r\n<h2>Sign up</h2>\r\n\r\n<%= form_for(resource, as: resource_name, url: registration_path(resource_name)) do |f| %>\r\n  <%= devise_error_messages! %>\r\n\r\n  <div class=\"field\">\r\n    <%= f.label :email %><br />\r\n    <%= f.email_field :email, autofocus: true %>\r\n  </div>\r\n\r\n  <div class=\"field\">\r\n    <%= f.label :password %>\r\n    <% if @validatable %>\r\n    <em>(<%= @minimum_password_length %> characters minimum)</em>\r\n    <% end %><br />\r\n    <%= f.password_field :password, autocomplete: \"off\" %>\r\n  </div>\r\n\r\n  <div class=\"actions\">\r\n    <%= f.submit \"Sign up\" %>\r\n  </div>\r\n<% end %>\r\n\r\n<%= render \"devise/shared/links\" %>\r\n```\r\n\r\nStep 4\r\n-------\r\n\r\nCreate spec/support/features folder. Create `session_helpers.rb` in this folder.\r\n\r\n```ruby\r\nmodule Features\r\n  module SessionHelpers\r\n    def sign_up(email, password)\r\n      User.destroy_all\r\n      visit new_user_registration_path\r\n      fill_in \'Email\', with: email\r\n      fill_in \'Password\', with: password\r\n      \r\n      click_button \'Sign up\'\r\n    end\r\n  end\r\nend\r\n```\r\n\r\nI had to call `User.destroy_all` to get rid of the nasty error message, user is already taken.\r\n\r\nStep 5\r\n-------\r\n\r\nCreate spec/support/features.rb file.\r\n\r\n```ruby\r\nRSpec.configure do |config|\r\n  config.include Features::SessionHelpers, type: :feature\r\nend\r\n```\r\n\r\nStep 6\r\n-------\r\n\r\nCreate `spec/features/sign_up_spec.rb`.\r\n\r\n```ruby\r\nrequire \'rails_helper\'\r\nrequire \'spec_helper\'\r\n\r\nfeature \'Signup\' do\r\n  \r\n  scenario \'User with email and password\' do    \r\n    sign_up(\'test@example.com\', \'12345678\')\r\n    \r\n    expect(page).to have_content(\'Gold\')\r\n  end\r\nend\r\n````\r\n\r\nStep 7\r\n-------\r\n\r\nI have added all tests recommended by [Stripe Testing](https://stripe.com/docs/testing \'Stripe Testing\') to the `subscribe_spec.rb`.\r\n\r\n```ruby\r\nrequire \'rails_helper\'\r\nrequire \'spec_helper\'\r\n\r\nfeature \'Subscription\' do\r\n    \r\n  scenario \'Customer subscribes to Gold plan\', js: true do\r\n    sign_up(\'test@example.com\', \'12345678\') \r\n\r\n    click_link \'Gold\'\r\n    fill_in \"Card Number\", with: \'4242424242424242\'\r\n    page.select \'10\', from: \"card_month\"\r\n    page.select \'2029\', from: \'card_year\'\r\n     \r\n    click_button \'Subscribe Me\'\r\n    expect(page).to have_content(\'You have been subscribed to Gold.\')\r\n  end\r\n  \r\n  scenario \'Customer credit card expired\', js: true do\r\n    sign_up(\'test@example.com\', \'12345678\') \r\n        \r\n    click_link \'Gold\'\r\n    fill_in \"Card Number\", with: \'4000000000000069\'\r\n    page.select \'10\', from: \"card_month\"\r\n    page.select \'2029\', from: \'card_year\'\r\n    \r\n    click_button \'Subscribe Me\'\r\n    expect(page).to have_content(\'Your card has expired.\')\r\n  end\r\n  \r\n  scenario \'Customer credit card number incorrect\', js: true do\r\n    sign_up(\'test@example.com\', \'12345678\') \r\n    \r\n    click_link \'Gold\'\r\n    fill_in \"Card Number\", with: \'4242424242424241\'\r\n    page.select \'10\', from: \"card_month\"\r\n    page.select \'2029\', from: \'card_year\'\r\n    \r\n    click_button \'Subscribe Me\'\r\n    expect(page).to have_content(\'Your card number is incorrect.\')    \r\n  end\r\n\r\n  scenario \'Customer credit card declined\', js: true do\r\n    sign_up(\'test@example.com\', \'12345678\') \r\n    \r\n    click_link \'Gold\'\r\n    fill_in \"Card Number\", with: \'4000000000000002\'\r\n    page.select \'10\', from: \"card_month\"\r\n    page.select \'2029\', from: \'card_year\'\r\n    \r\n    click_button \'Subscribe Me\'\r\n    expect(page).to have_content(\'Your card was declined.\')\r\n  end\r\n\r\n  scenario \'Customer credit card processing error\', js: true do\r\n    sign_up(\'test@example.com\', \'12345678\') \r\n    \r\n    click_link \'Gold\'\r\n    fill_in \"Card Number\", with: \'4000000000000119\'\r\n    page.select \'10\', from: \"card_month\"\r\n    page.select \'2029\', from: \'card_year\'\r\n    \r\n    click_button \'Subscribe Me\'\r\n    expect(page).to have_content(\'An error occurred while processing your card. Try again in a little bit.\')\r\n  end\r\n  \r\nend\r\n```\r\n\r\nStep 8\r\n-------\r\n\r\nChange the `use_transactional_fixtures` configuration flag in `spec/rails_helper.rb`. This setting will cleanup the database between each tests.\r\n\r\n```ruby\r\nconfig.use_transactional_fixtures = false\r\n```\r\n\r\nStep 9\r\n--------\r\n\r\nYou can run the integration tests.\r\n\r\n```sh\r\nrspec spec/features/subscribe_spec.rb\r\n```\r\n\r\n```sh\r\nrspec spec/features/signup_spec.rb \r\n```\r\n\r\nYou can download the source code for this article using the commit hash c27b618 from `git@bitbucket.org:bparanj/striped.git`.\r\n\r\nStep 10\r\n--------\r\n\r\nLet\'s eliminate the duplication in our integration tests. Create `subscribe_to_a_plan` method in `session_helpers.rb`.\r\n\r\n```ruby\r\ndef subscribe_to_a_plan(plan, credit_card)\r\n  click_link plan\r\n  fill_in \"Card Number\", with: credit_card\r\n  page.select \'10\', from: \"card_month\"\r\n  page.select \'2029\', from: \'card_year\'\r\n\r\n  click_button \'Subscribe Me\'\r\nend\r\n```\r\n\r\nReplace the duplicate code with this new method in `subscribe_spec.rb`.\r\n\r\n```ruby\r\nrequire \'rails_helper\'\r\nrequire \'spec_helper\'\r\n\r\nfeature \'Subscription\' do\r\n    \r\n  scenario \'Customer subscribes to Gold plan\', js: true do\r\n    sign_up(\'test@example.com\', \'12345678\') \r\n\r\n    subscribe_to_a_plan(\'Gold\', \'4242424242424242\')\r\n    \r\n    expect(page).to have_content(\'You have been subscribed to Gold.\')\r\n  end\r\n  \r\n  scenario \'Customer credit card expired\', js: true do\r\n    sign_up(\'test@example.com\', \'12345678\') \r\n    \r\n    subscribe_to_a_plan(\'Gold\', \'4000000000000069\')\r\n        \r\n    expect(page).to have_content(\'Your card has expired.\')\r\n  end\r\n  \r\n  scenario \'Customer credit card number incorrect\', js: true do\r\n    sign_up(\'test@example.com\', \'12345678\') \r\n    \r\n    subscribe_to_a_plan(\'Gold\', \'4242424242424241\')\r\n    \r\n    expect(page).to have_content(\'Your card number is incorrect.\')    \r\n  end\r\n\r\n  scenario \'Customer credit card declined\', js: true do\r\n    sign_up(\'test@example.com\', \'12345678\') \r\n    \r\n    subscribe_to_a_plan(\'Gold\', \'4000000000000002\')\r\n    \r\n    expect(page).to have_content(\'Your card was declined.\')\r\n  end\r\n\r\n  scenario \'Customer credit card processing error\', js: true do\r\n    sign_up(\'test@example.com\', \'12345678\') \r\n    \r\n    subscribe_to_a_plan(\'Gold\', \'4000000000000119\')\r\n    \r\n    expect(page).to have_content(\'An error occurred while processing your card. Try again in a little bit.\')\r\n  end\r\n  \r\nend\r\n```\r\n\r\nYou can download the source code for this article using the commit hash 5d965d2 from `git@bitbucket.org:bparanj/striped.git`.\r\n\r\nSummary\r\n==========\r\n----------\r\n\r\nIn this article we resolved the SQLite3 problem, fixed the broken integration tests and added more integration tests to test the subscription and user signup features. We also refactored to eliminate duplication in integration tests.\r\n\r\nReferences\r\n==========\r\n----------\r\n\r\n1. [End-to-End Testing with RSpec Integration Tests and Capybara] (http://robots.thoughtbot.com/rspec-integration-tests-with-capybara \'End-to-End Testing with RSpec Integration Tests and Capybara\')\r\n2. [Database Cleaner](https://github.com/DatabaseCleaner/database_cleaner \'Database Cleaner\')\r\n3. [RSpec, Capybara, Devise Login Tests](http://www.simple10.com/rspec-capybara-devise-login-tests/ \'RSpec, Capybara, Devise Login Tests\')\r\n4. [How to Test with Capybara] (https://github.com/plataformatec/devise/wiki/How-To:-Test-with-Capybara \'How to Test with Capybara\')','2014-11-14 01:05:58','2016-12-22 19:55:35'),(1251,'Stripe Guest Checkout','Objective\r\n=========\r\n---------\r\n\r\n- To allow anyone to buy a product\r\n\r\nSteps\r\n=====\r\n-----\r\n\r\nWe will continue developing from where we left at part 9 of the Stripe Recurring Billing series of articles.\r\n\r\nStep 1\r\n-----\r\n\r\nLet\'s display the product details with price in the products show page. Create products controller:\r\n\r\n```ruby\r\nrails g controller products show\r\n```\r\n\r\nStep 2\r\n-----\r\n\r\nThe product show page will have the link to \'Buy Now\'. Create app/views/products/show.html.erb\r\n\r\n```ruby\r\n<h1>Rails 4 Quickly</h1>\r\n\r\nPrice : $27\r\n\r\n<%= link_to \'Buy Now\', buy_path %>\r\n```\r\n\r\nStep 3\r\n-----\r\n\r\nTo load the product show page, let\'s define the route in config/routes.rb.\r\n\r\n```ruby\r\nget \'products/show\'\r\n```\r\n\r\nStep 4\r\n-----\r\n\r\nGo to http://localhost:3000/products/show to view the product show page. When we click on the \'Buy Now\' link it should load the payment form. Create app/views/sales/new.html.erb.\r\n\r\n```ruby\r\n<form action=\"create\" method=\"POST\" id=\"payment-form\">\r\n  <span class=\"payment-errors\"></span>\r\n  <%= hidden_field_tag :authenticity_token, form_authenticity_token -%>\r\n\r\n  <div class=\"form-row\">\r\n    <label>\r\n      <span>Card Number</span>\r\n      <input type=\"text\" size=\"20\" data-stripe=\"number\"/>\r\n    </label>\r\n  </div>\r\n\r\n  <div class=\"form-row\">\r\n    <label>\r\n      <span>Expiration (MM/YYYY)</span>\r\n      <input type=\"text\" size=\"2\" data-stripe=\"exp-month\"/>\r\n    </label>\r\n    <span> / </span>\r\n    <input type=\"text\" size=\"4\" data-stripe=\"exp-year\"/>\r\n  </div>\r\n\r\n  <button type=\"submit\">Submit Payment</button>\r\n</form>\r\n```\r\n\r\nStep 5\r\n-----\r\n\r\nLet\'s use a separate layout for checkout. The reason is that during checkout we will hide navigation links and any other distractions. It will also have the javascript related to checkout. Create app/views/layouts/sales.html.erb.\r\n\r\n```ruby\r\n<!DOCTYPE html>\r\n<html>\r\n<head>\r\n  <title>Buy Now</title>\r\n\r\n  <%= stylesheet_link_tag    \'application\', media: \'all\', \'data-turbolinks-track\' => true %>\r\n  <%= javascript_include_tag \'application\' %>\r\n  \r\n  <%= javascript_include_tag \'https://js.stripe.com/v2/\' %>\r\n  <%= tag :meta, :name => \"stripe-key\", :content => STRIPE_PUBLIC_KEY %>\r\n\r\n  <script type=\"text/javascript\">\r\n    // This identifies your website in the createToken call below\r\n	Stripe.setPublishableKey($(\'meta[name=\"stripe-key\"]\').attr(\'content\'));\r\n\r\n	var stripeResponseHandler = function(status, response) {\r\n      var $form = $(\'#payment-form\');\r\n\r\n      if (response.error) {\r\n        // Show the errors on the form\r\n        $form.find(\'.payment-errors\').text(response.error.message);\r\n        $form.find(\'button\').prop(\'disabled\', false);\r\n      } else {\r\n        // token contains id, last4, and card type\r\n        var token = response.id;\r\n        // Insert the token into the form so it gets submitted to the server\r\n        $form.append($(\'<input type=\"hidden\" name=\"stripeToken\" />\').val(token));\r\n        // and re-submit\r\n        $form.get(0).submit();\r\n      }\r\n    };\r\n	\r\n	jQuery(function($) {\r\n	  $(\'#payment-form\').submit(function(event) {\r\n	    var $form = $(this);\r\n\r\n	    // Disable the submit button to prevent repeated clicks\r\n	    $form.find(\'button\').prop(\'disabled\', true);\r\n\r\n	    Stripe.card.createToken($form, stripeResponseHandler);\r\n\r\n	    // Prevent the form from submitting with the default action\r\n	    return false;\r\n	  });\r\n	});\r\n    \r\n  </script>  \r\n\r\n  <%= csrf_meta_tags %>\r\n</head>\r\n<body data-no-turbolink>\r\n\r\n<%= yield %>\r\n\r\n</body>\r\n</html>\r\n```\r\n\r\nStep 6\r\n-----\r\n\r\nWhen this payment form is submitted to our server, it will go to sales controller, create action. Let\'s create the sales controller.\r\n\r\n```ruby\r\nrails g controller sales new create\r\n```\r\n\r\nStep 7\r\n-----\r\n\r\nThe sales controller will load the payment form for new action and charge the customer when the payment form is posted to create action.\r\n\r\n```ruby\r\nclass SalesController < ApplicationController\r\n  layout \'sales\'\r\n  \r\n  def new\r\n  end\r\n\r\n  def create\r\n    begin\r\n      stripe_gateway = StripeGateway.new(logger)\r\n      stripe_gateway.charge(2700, params[:stripeToken])\r\n    rescue Striped::CreditCardDeclined => e\r\n      redisplay_form(e.message)\r\n    rescue Exception => e\r\n      redisplay_form(\"Subscription failed. We have been notified about this problem.\")\r\n    end\r\n  end\r\nend\r\n```\r\n\r\nStep 8\r\n-----\r\n\r\nAdd a charge method to stripe_gateway.rb.\r\n\r\n```ruby\r\ndef charge(amount, stripe_token)\r\n  # amount in cents\r\n  begin\r\n    charge = Stripe::Charge.create(amount:      amount, \r\n                                   currency:    \"usd\",\r\n                                   card:        stripe_token,\r\n                                   description: \"guest-checkout@example.com\")\r\n  rescue Stripe::CardError => e\r\n    # Since it\'s a decline, Stripe::CardError will be caught\r\n    body = e.json_body\r\n    err  = body[:error]\r\n\r\n    @logger.error \"Status is: #{e.http_status}\"\r\n    @logger.error \"Type is: #{err[:type]}\"\r\n    @logger.error \"Code is: #{err[:code]}\"\r\n    # param is \'\' in this case\r\n    @logger.error \"Param is: #{err[:param]}\"\r\n    @logger.error \"Message is: #{err[:message]}\" \r\n\r\n    raise Striped::CreditCardDeclined.new(err[:message])     \r\n  rescue Exception => ex\r\n    @logger.error \"Purchase failed due to : #{ex.message}\"  \r\n    \r\n    raise\r\n  end\r\n```\r\n\r\nStep 9\r\n-----\r\n\r\nAdd new routes for guest checkout in config/routes.rb.\r\n\r\n```ruby\r\nget \'sales/new\' => \'sales#new\', as: :buy\r\npost \'sales/create\' \r\n```\r\n\r\nStep 10\r\n-----\r\n\r\nCreate the integration test in `spec/features/guest_checkout_spec.rb`.\r\n\r\n```ruby\r\nrequire \'rails_helper\'\r\nrequire \'spec_helper\'\r\n\r\nfeature \'Guest Checkout\' do\r\n  scenario \'Complete purchase of one product\', js: true do\r\n    visit products_show_path\r\n    click_link \'Buy Now\'\r\n    \r\n    fill_in \"Card Number\", with: \'4242424242424242\'    \r\n    page.select \'10\', from: \"card_month\"\r\n    page.select \'2029\', from: \'card_year\'\r\n    click_button \'Submit Payment\'\r\n    \r\n    expect(page).to have_content(\'Receipt\')\r\n  end\r\n  \r\n  scenario \'Fails due to credit card declined\', js: true do\r\n    visit products_show_path\r\n    click_link \'Buy Now\'\r\n    \r\n    fill_in \"Card Number\", with: \'4000000000000002\'    \r\n    page.select \'10\', from: \"card_month\"\r\n    page.select \'2029\', from: \'card_year\'\r\n    click_button \'Submit Payment\'\r\n    \r\n    expect(page).to have_content(\'Your card was declined.\')\r\n  end\r\nend\r\n```\r\n\r\nYou can check the payments has been made successful by looking at the Payments tab in your Stripe dashboard. The complete source code that handles failure cases and has been refactored can be downloaded from `git@bitbucket.org:bparanj/striped.git` using the commit hash 1c04385.\r\n\r\nSummary\r\n=======\r\n-------\r\n\r\nIn this article, we implemented guest checkout feature. In the next article we will prompt the user to provide us an email and password at the end of the purchase so that they can view their purchases and use one-click checkout in subsequent purchases.','2014-11-14 23:59:40','2016-12-22 19:56:37'),(1261,'Stripe Guest Checkout Part 2 : Optional Account Registration','Discussion\r\n=====\r\n-----\r\n\r\nWe want anyone to buy our products without logging in or registering up front. At the end of the purchase, we will prompt the guest user to signup. This makes skippers skip the signup process but still allow them to buy products.\r\n\r\nSteps\r\n=====\r\n-----\r\n\r\nStep 1\r\n-----\r\n\r\nAdd devise customization code to `app/controllers/application_controller.rb`.\r\n\r\n```ruby\r\n# if user is logged in, return current_user, else return guest_user\r\ndef current_or_guest_user\r\n  \r\n  if current_user\r\n    if session[:guest_user_id] && session[:guest_user_id] != current_user.id        \r\n      guest_user(with_retry = false).try(:destroy)\r\n      session[:guest_user_id] = nil\r\n    end\r\n    current_user\r\n  else      \r\n    guest_user\r\n  end\r\nend\r\n\r\n# find guest_user object associated with the current session,\r\n# creating one as needed\r\ndef guest_user(with_retry = true)\r\n  # Cache the value the first time it\'s gotten.\r\n  @cached_guest_user ||= User.find(session[:guest_user_id] ||= create_guest_user.id)\r\n\r\nrescue ActiveRecord::RecordNotFound # if session[:guest_user_id] invalid\r\n  session[:guest_user_id] = nil\r\n  guest_user if with_retry\r\nend\r\n\r\nprivate\r\n\r\ndef create_guest_user\r\n  u = User.create(:email => \"guest_#{Time.now.to_i}#{rand(100)}@example.com\")\r\n  u.save!(:validate => false)\r\n  session[:guest_user_id] = u.id\r\n  u\r\nend\r\n```\r\n\r\nThis helps us to implement the guest checkout feature. Read the devise wiki for more details. The link is in the references section of this article.\r\n\r\n\r\nStep 2\r\n-----\r\n\r\nCreate the app/views/products/show.html.erb.\r\n\r\n```ruby\r\n<h1>Rails 4 Quickly</h1>\r\n\r\nPrice : $27\r\n\r\n<%= link_to \'Buy Now\', buy_path %>\r\n```\r\n\r\nStep 3\r\n-----\r\n\r\nAdd download action to `app/controllers/products_controller.rb`. This action will initialize the download link for a given product in a later version. For now the view just renders static text.\r\n\r\n```ruby\r\ndef download \r\nend\r\n```\r\n\r\nHere is app/views/download.html.erb.\r\n\r\n```ruby\r\nDownload details about the book goes here\r\n```\r\n\r\nStep 4\r\n-----\r\n\r\nAdd the products download page route to config/routes.rb. This is the last page of the purchase flow.\r\n\r\n```ruby\r\nget \'products/download\' => \'products#download\', as: :download\r\n```\r\n\r\nStep 5\r\n-----\r\n\r\nLet\'s customize the Devise registrations controller to transfer the `stripe_customer_id` from `guest_user` to the user created at the end of checkout process.\r\n\r\n```ruby\r\nclass RegistrationsController < Devise::RegistrationsController\r\n  \r\n  def create    \r\n    super    \r\n    current_user.save_stripe_customer_id(guest_user.stripe_customer_id)\r\n  end  \r\n  \r\n  def after_sign_up_path_for(resource)\r\n    if session[:guest_user_id].blank?\r\n      after_sign_in_path_for(resource)\r\n    else\r\n      download_path\r\n    end\r\n  end\r\n  \r\nend\r\n```\r\n\r\nStep 6\r\n-----\r\n\r\nAdd the custom registrations controller to config/routes.rb.\r\n\r\n```ruby\r\ndevise_for :users, :controllers => {:registrations => \"registrations\"}\r\n```\r\n\r\nStep 7\r\n-----\r\n\r\nThe controller `app/controllers/sales_controller.rb` will now use a use case handler to manage the guest checkout use case.\r\n\r\n```ruby\r\nclass SalesController < ApplicationController\r\n  layout \'sales\'\r\n  \r\n  def new\r\n  end\r\n\r\n  def create\r\n    begin\r\n      user = current_or_guest_user\r\n      # TODO : The price must come from product model.\r\n      amount = 2700\r\n      Actors::Customer::UseCases.guest_checkout(amount, params[:stripeToken], user, logger)\r\n    rescue Striped::CreditCardDeclined => e\r\n      redisplay_form(e.message)\r\n    rescue Exception => e\r\n      logger.error \"Guest checkout failed due to #{e.message}\"\r\n      redisplay_form(\"Checkout failed. We have been notified about this problem.\")\r\n    end\r\n  end\r\nend\r\n```\r\n\r\nStep 8\r\n-----\r\n\r\nLet\'s add the guest_checkout use case handler to the `app/actors/customer/use_cases/guest_checkout.rb`.\r\n\r\n```ruby\r\nmodule Actors\r\n  module Customer\r\n    module UseCases\r\n      \r\n      def self.guest_checkout(amount, stripe_token, user, logger)\r\n        stripe_gateway = StripeGateway.new(logger)\r\n        customer_id = stripe_gateway.charge(amount, stripe_token)\r\n\r\n        user.save_stripe_customer_id(customer_id)      \r\n      end      \r\n      \r\n    end\r\n  end\r\nend\r\n```\r\n\r\nStep 9\r\n-----\r\n\r\nAdd the new use case controller in app/actors/customer/customer.rb.\r\n\r\n```ruby\r\nrequire_relative \"#{Rails.root}/app/actors/customer/use_cases/guest_checkout\"\r\n```\r\n\r\nStep 10\r\n-----\r\n\r\nThe new implementation for the charge method in `app/gateways/stripe_gateway.rb` allows one-click checkout feature that we will be implementing in an upcoming article. It currently allows guest checkout, the guest user might register for an account at the end of the purchase flow.\r\n\r\n```ruby\r\ndef charge(amount, stripe_token)\r\n  # amount in cents, again\r\n  begin\r\n    # Create a Customer\r\n    customer = Stripe::Customer.create(card: stripe_token, description: \"guest-user@example.com\")\r\n    # Charge the Customer instead of the card\r\n    Stripe::Charge.create(amount:   amount, \r\n                          currency: \"usd\",\r\n                          customer: customer.id)\r\n    customer.id\r\n  rescue Stripe::CardError => e\r\n    # Since it\'s a decline, Stripe::CardError will be caught\r\n    body = e.json_body\r\n    err  = body[:error]\r\n  \r\n    @logger.error \"Status is: #{e.http_status}\"\r\n    @logger.error \"Type is: #{err[:type]}\"\r\n    @logger.error \"Code is: #{err[:code]}\"\r\n    # param is \'\' in this case\r\n    @logger.error \"Param is: #{err[:param]}\"\r\n    @logger.error \"Message is: #{err[:message]}\" \r\n  \r\n    raise Striped::CreditCardDeclined.new(err[:message])     \r\n  rescue Exception => ex\r\n    @logger.error \"Purchase failed due to : #{ex.message}\"  \r\n    \r\n    raise\r\n  end\r\nend\r\n```\r\n\r\nStep 11\r\n-----\r\n\r\nAdd `stripe_customer_id` field to users so that we can save it in our database for one click checkout feature.\r\n\r\n```sh\r\n$ rails g migration add_stripe_customer_id_to_users\r\n```\r\n\r\nStep 12\r\n-----\r\n\r\nLet\'s save the `stripe_customer_id` in app/models/user.rb. This allows us to charge the customer without asking them for a credit card again. We use `stripe_customer_id` to charge the customer for the purchase amount using Stripe::Charge.create method of Stripe API.\r\n\r\n```ruby\r\ndef save_stripe_customer_id(sci)\r\n  self.stripe_customer_id = sci\r\n  save!                \r\nend\r\n```\r\n\r\nStep 13\r\n-----\r\n\r\nHere is app/views/sales/create.html.erb.\r\n\r\n```ruby\r\n<p>You just bought \'Rails 4 Quickly book\' for $27. If you signup for an account, you can :\r\n\r\n<ol>\r\n	<li>View all your purchases.</li>\r\n	<li>Download your books anytime.</li>\r\n	<li>Checkout faster without entering your credit card details by using our one-click checkout.</li>	\r\n</ol>\r\n\r\n<p><%= link_to \'Create your free account now\', new_user_registration_path %>. </p> <%= link_to \'No thanks, take me to my download\', download_path %>.\r\n```\r\n\r\nStep 14\r\n-------\r\n\r\nThe guest_checkout_spec.rb integration tests.\r\n\r\n```ruby\r\nrequire \'rails_helper\'\r\nrequire \'spec_helper\'\r\n\r\nfeature \'Guest Checkout\' do\r\n  scenario \'Complete purchase of one product and register for an account\', js: true do\r\n    visit products_show_path\r\n    click_link \'Buy Now\'\r\n    \r\n    fill_in \"Card Number\", with: \'4242424242424242\'    \r\n    page.select \'10\', from: \"card_month\"\r\n    page.select \'2029\', from: \'card_year\'\r\n    click_button \'Submit Payment\'\r\n    \r\n    click_link \'Create your free account now\'\r\n    fill_in \'Email\', with: test_email\r\n    fill_in \'Password\', with: \'12345678\'\r\n\r\n    click_button \'Sign up\'\r\n        \r\n    expect(page).to have_content(\'Welcome! You have signed up successfully\')\r\n    expect(page).to have_content(\'Download details about the book goes here\')\r\n  end\r\n\r\n  scenario \'Complete purchase of one product and do not register for an account\', js: true do\r\n    visit products_show_path\r\n    click_link \'Buy Now\'\r\n    \r\n    fill_in \"Card Number\", with: \'4242424242424242\'    \r\n    page.select \'10\', from: \"card_month\"\r\n    page.select \'2029\', from: \'card_year\'\r\n    click_button \'Submit Payment\'\r\n    \r\n    click_link \'No thanks, take me to my download\'\r\n        \r\n    expect(page).to have_content(\'Download details about the book goes here\')\r\n  end\r\n  \r\n  scenario \'Fails due to credit card declined\', js: true do\r\n    visit products_show_path\r\n    click_link \'Buy Now\'\r\n    \r\n    fill_in \"Card Number\", with: \'4000000000000002\'    \r\n    page.select \'10\', from: \"card_month\"\r\n    page.select \'2029\', from: \'card_year\'\r\n    click_button \'Submit Payment\'\r\n    \r\n    expect(page).to have_content(\'Your card was declined.\')\r\n  end\r\n\r\n  scenario \'Fails due to credit card expired\', js: true do\r\n    visit products_show_path\r\n    click_link \'Buy Now\'\r\n    \r\n    fill_in \"Card Number\", with: \'4000000000000069\'    \r\n    page.select \'10\', from: \"card_month\"\r\n    page.select \'2029\', from: \'card_year\'\r\n    click_button \'Submit Payment\'\r\n    \r\n    expect(page).to have_content(\'Your card has expired.\')\r\n  end\r\n\r\n  scenario \'Fails due to incorrect credit card number\', js: true do\r\n    visit products_show_path\r\n    click_link \'Buy Now\'\r\n    \r\n    fill_in \"Card Number\", with: \'4242424242424241\'    \r\n    page.select \'10\', from: \"card_month\"\r\n    page.select \'2029\', from: \'card_year\'\r\n    click_button \'Submit Payment\'\r\n      \r\n    expect(page).to have_content(\'Your card number is incorrect.\')    \r\n  end\r\n\r\n  scenario \'Fails due to credit card processing error\', js: true do\r\n    visit products_show_path\r\n    click_link \'Buy Now\'\r\n    \r\n    fill_in \"Card Number\", with: \'4000000000000119\'    \r\n    page.select \'10\', from: \"card_month\"\r\n    page.select \'2029\', from: \'card_year\'\r\n    click_button \'Submit Payment\'\r\n    \r\n    expect(page).to have_content(\'An error occurred while processing your card. Try again in a little bit.\')\r\n  end\r\n  \r\nend\r\n```\r\n\r\nStep 15\r\n-------\r\n\r\nHere is the `spec/features/signup_spec.rb`.\r\n\r\n```ruby\r\nrequire \'rails_helper\'\r\nrequire \'spec_helper\'\r\n\r\nfeature \'Signup\' do\r\n  after do\r\n    User.destroy_all\r\n  end\r\n  \r\n  scenario \'User with email and password\' do    \r\n    sign_up(test_email, \'12345678\')\r\n    \r\n    expect(page).to have_content(\'Gold\')\r\n  end\r\nend\r\n```\r\n\r\nFor some reason the user records are not getting cleaned. The after method cleans up any user records in the test database. The `spec/features/subscribe_spec.rb` integration test remains the same. The `test_email` is a helper method defined in `spec/support/features/session_helpers.rb`.\r\n\r\n```ruby\r\ndef test_email\r\n  \"guest_#{Time.now.to_i}#{rand(100)}@example.com\"\r\nend\r\n```\r\n\r\nCleanup and Minor Bug Fixes\r\n=====\r\n-----\r\n\r\nCleanup\r\n-----\r\n\r\nDelete the following line in app/actors/customer/customer.rb. We don\'t need it.\r\n\r\n```ruby\r\nrequire_relative \'./use_cases/subscribe\'\r\n```\r\n\r\nHowever, this empty file is still required to get the use case handlers to work. This is a hack for now.\r\n\r\nBug Fix\r\n-----\r\n\r\nWe forgot to link the user and subscription models. Create the migration.\r\n\r\n```sh\r\n$ rails g migration add_user_id_to_subscriptions user_id:integer\r\n```\r\n\r\nRun the migration.\r\n\r\n```sh\r\n$ rake db:migrate\r\n$ RAILS_ENV=test rake db:migrate\r\n```\r\n\r\nSetup the associations for subscription and the user models.\r\n\r\n```ruby\r\nclass Subscription < ActiveRecord::Base\r\n  belongs_to :user\r\nend\r\n```\r\n\r\n```ruby\r\nclass User < ActiveRecord::Base  \r\n  has_one :subscription\r\nend\r\n```\r\n\r\nChange the create action in `app/controllers/subscriptions_controller.rb`.\r\n\r\n```ruby\r\ndef create\r\n  begin\r\n    @subscription = Actors::Customer::UseCases.subscribe_to_a_plan(current_user, \r\n                                                                   params[:stripeToken], \r\n                                                                   params[:plan_name], \r\n                                                                   logger)    \r\n  rescue Striped::CreditCardDeclined => e\r\n    redisplay_form(e.message)\r\n  rescue Striped::CreditCardException, Exception => e\r\n    redisplay_form(\"Subscription failed. We have been notified about this problem.\")\r\n  end\r\nend\r\n```\r\n\r\nChange the `app/actors/customer/use_cases/subscribe_to_a_plan.rb` as follows.\r\n\r\n```ruby\r\nmodule Actors\r\n  module Customer\r\n    module UseCases\r\n      \r\n      def self.subscribe_to_a_plan(user, stripe_token, plan_name, logger)\r\n        stripe = StripeGateway.new(logger)\r\n        customer = stripe.create_subscription(user.email, stripe_token, plan_name)    \r\n                \r\n        subscription = Subscription.new(user_id: user.id)\r\n        subscription.save_details(customer.id, plan_name)\r\n      end      \r\n      \r\n    end\r\n  end\r\nend\r\n```\r\n\r\nWe are now passing the user object, since we need the email as well as the `user_id` when creating the subscription. The `user_id` will associate a subscription to a particular user. You can download the source code for this article from `git@bitbucket.org:bparanj/striped.git`.\r\nusing the commit hash 935113f.\r\n\r\nSummary\r\n========\r\n--------\r\n\r\nIn this article we implemented the guest checkout feature with an option to register at the end of the purchase flow. We also cleaned up and fixed a bug related to user and subscription model association. We also added new integration tests for failure cases in `guest_checkout_spec.rb`.\r\n\r\nReferences\r\n==========\r\n----------\r\n\r\n[How to create a guest user](https://github.com/plataformatec/devise/wiki/How-To:-Create-a-guest-user \'Devise Gem\')\r\n[How to redirect to a specific page after successful signup](https://github.com/plataformatec/devise/wiki/How-To:-Redirect-to-a-specific-page-on-successful-sign-up-(registration) \'Devise Gem\')\r\n[Making Your First Charge](https://stripe.com/docs/tutorials/charges \'Making Your First Charge\')','2014-11-16 02:09:45','2016-12-22 20:00:28'),(1271,'RSpec 3.1 Basics : Stubs, Mocks and Verifying Double','Objective\r\n=========\r\n---------\r\n\r\nTo learn the new syntax for using stubs, mocks and verifying doubles in RSpec 3.1\r\n\r\nStubs\r\n=====\r\n-----\r\n\r\n```ruby\r\nclass Book\r\nend\r\n\r\ndescribe Book do\r\n  it \'rspec 3 stub syntax example\' do\r\n    book = double(\'book\')  \r\n    allow(book).to receive(:name) { \'Get Rich Quick\'}\r\n    \r\n    expect(book.name).to eq(\"Get Rich Quick\")\r\n  end  \r\n  \r\nend\r\n```\r\n\r\n```sh\r\n$ rspec stub_spec.rb --color --format doc\r\n```\r\n\r\n```ruby\r\nBook\r\n  rspec 3 stub syntax example\r\n\r\nFinished in 0.00896 seconds (files took 0.11378 seconds to load)\r\n1 example, 0 failures\r\n```\r\n\r\nVerifying Double\r\n================\r\n----------------\r\n\r\nCreate `verifying_double_spec.rb` with the following code.\r\n\r\n```ruby\r\nclass Book\r\nend\r\n\r\ndescribe Book do\r\n  it \'rspec 3 stub syntax example\' do\r\n    book = instance_double(\'book\')  \r\n    allow(book).to receive(:name) { \'Get Rich Quick\'}\r\n    \r\n    expect(book.name).to eq(\"Get Rich Quick\")\r\n  end    \r\nend\r\n```\r\n\r\nRun it.\r\n\r\n```ruby\r\n$rspec verifying_double_spec.rb --color --format doc\r\n```\r\n\r\nYou will get the following error:\r\n\r\n```sh\r\nBook\r\n  rspec 3 stub syntax example (FAILED - 1)\r\n\r\nFailures:\r\n\r\n  1) Book rspec 3 stub syntax example\r\n     Failure/Error: allow(book).to receive(:name) { \'Get Rich Quick\'}\r\n       Book does not implement: name\r\n     # ./verifying_double_spec.rb:10:in `block (2 levels) in <top (required)>\'\r\n\r\nFinished in 0.0083 seconds (files took 0.11439 seconds to load)\r\n1 example, 1 failure\r\n\r\nFailed examples:\r\n\r\nrspec ./verifying_double_spec.rb:8 # Book rspec 3 stub syntax example\r\n```\r\n\r\nLet\'s define the name method.\r\n\r\n```ruby\r\nclass Book\r\n  def name\r\n    \r\n  end\r\nend\r\n```\r\n\r\nRun the test again.\r\n\r\n```ruby\r\nrspec verifying_double_spec.rb --color --format doc\r\n\r\nBook\r\n  rspec 3 stub syntax example\r\n\r\nFinished in 0.00908 seconds (files took 0.11459 seconds to load)\r\n1 example, 0 failures\r\n```\r\n\r\nMocks\r\n=======\r\n-------\r\n\r\nCreate `message_expectations_spec.rb`:\r\n\r\n```ruby\r\nclass Account\r\n  def close\r\n    @logger.account_closed(self)\r\n  end\r\n  \r\n  def logger=(l)\r\n    @logger = l\r\n  end\r\nend\r\n\r\ndescribe Account do\r\n  context \"when closed\" do\r\n    it \"logs an \'account closed\' message\" do\r\n      logger = double()\r\n      account = Account.new\r\n      account.logger = logger\r\n\r\n      expect(logger).to receive(:account_closed).with(account)\r\n\r\n      account.close\r\n    end\r\n  end\r\nend\r\n```\r\n\r\nRun the test.\r\n\r\n```sh\r\n$ rspec message_expectations_spec.rb --color --format doc\r\n```\r\n\r\nThis test passes.\r\n\r\n```sh\r\nAccount\r\n  when closed\r\n    logs an \'account closed\' message\r\n\r\nFinished in 0.00846 seconds (files took 0.11452 seconds to load)\r\n1 example, 0 failures\r\n```\r\n\r\nSummary\r\n=======\r\n-------\r\n\r\nIn this article you learned the new syntax for using Mocks, Stubs and Verifying doubles in RSpec 3.1.\r\n\r\nReference\r\n=========\r\n---------\r\n\r\n[RSpec Mocks](http://relishapp.com/rspec/rspec-mocks/docs \'RSpec Mocks\')','2014-11-16 12:37:46','2016-12-22 20:01:27'),(1281,'Stripe Guest Checkout and Subscriptions : Cleanup','Steps\r\n=====\r\n-----\r\n\r\nStep 1\r\n------\r\n\r\nLet\'s fix controller specs. In `spec/support/controller_helpers.rb`, define `sign_in` method.\r\n\r\n```ruby\r\nmodule ControllerHelpers\r\n  def sign_in(user = double(\'user\'))\r\n    if user.nil?\r\n      allow(request.env[\'warden\']).to receive(:authenticate!).and_throw(:warden, {:scope => :user})\r\n      allow(controller).to receive(:current_user).and_return(nil)\r\n    else\r\n      allow(request.env[\'warden\']).to receive(:authenticate!).and_return(user)\r\n      allow(controller).to receive(:current_user).and_return(user)\r\n    end\r\n  end\r\nend\r\n```\r\n\r\nStep 2\r\n------\r\n\r\nIn `rails_helper.rb`, include the `sign_in` controller helper.\r\n\r\n```ruby\r\nRSpec.configure do |config|\r\n  config.include Devise::TestHelpers, :type => :controller\r\n  config.include ControllerHelpers, :type => :controller\r\nend\r\n```\r\n\r\nStep 3\r\n------\r\n\r\nHere is the subscriptions controller specs that has fixes for the tests.\r\n\r\n```ruby\r\nrequire \'rails_helper\'\r\n\r\ndescribe SubscriptionsController do\r\n  \r\n  it \'should delegate creating stripe customer to stripe gateway\' do \r\n    sign_in   \r\n    expect(Actors::Customer::UseCases).to receive(:subscribe_to_a_plan) { true }\r\n\r\n    post :create, { stripeToken: \'1\', plan_name: \'gold\'}\r\n  end\r\n  \r\n  it \'should initialize plan name\' do\r\n    get :new, {plan_name: \'gold\'}\r\n    \r\n    expect(assigns(:plan_name)).to eq(\'gold\')\r\n  end\r\n  \r\n  it \'should handle credit card exception\' do\r\n    post :create, {stripeToken: \'bogus\', plan_name: \'junk\' }\r\n    \r\n    expect(assigns(:error_message)).to eq(\'Subscription failed. We have been notified about this problem.\')\r\n  end\r\n  \r\n  it \'should render the form when credit card exception occurs\' do\r\n    post :create, {stripeToken: \'bogus\', plan_name: \'junk\' }\r\n    \r\n    expect(response).to render_template(:new)\r\n  end\r\n  \r\n  it \'should raise credit card exception when authentication error occurs\' do\r\n    sign_in(User.new(email: \'junk\'))   \r\n    Stripe.api_key = \'junk\'\r\n  \r\n    post :create, {stripeToken: \'bogus\', plan_name: \'junk\' }\r\n    \r\n    expect(assigns(:error_message)).to eq(\'Subscription failed. We have been notified about this problem.\')\r\n  end\r\nend\r\n```\r\n\r\nRemoving Hard-Coded Amount\r\n=========\r\n---------\r\n\r\nStep 1\r\n------\r\n\r\nLet\'s create the product model that has name and price.\r\n\r\n```sh\r\n$rails g model product name:string price:decimal\r\n```\r\n\r\nStep 2\r\n------\r\n\r\nLet\'s change the generated migration file to define the precision and scale for the price field. \r\n\r\n```ruby\r\nt.decimal :price, precision: 5, scale: 2\r\n```\r\n\r\nThis means the decimal number can be 5 digits maximum and can have 2 digits after the decimal point. \r\n\r\nStep 3\r\n------\r\n\r\nCreate the products table.\r\n\r\n```sh\r\n$rake db:migrate\r\n```\r\n\r\nStep 4\r\n------\r\n\r\nCreate one product in the rails console.\r\n\r\n```sh\r\n$rails c\r\nProduct.create(name: \'Rails 4 Quickly\', price: 27.00)\r\n```\r\n\r\nStep 5\r\n------\r\n\r\nAdd the price in cents method to the product model. Stripe requires the amount to be in cents and it must be an integer.\r\n\r\n```ruby\r\nclass Product < ActiveRecord::Base\r\n  def price_in_cents\r\n    (price * 100).to_i\r\n  end\r\n  \r\n  def self.price_in_cents_for(product_id)\r\n    product = Product.find(product_id)\r\n    product.price_in_cents\r\n  end\r\nend\r\n```\r\n\r\nStep 6\r\n------\r\n\r\nHere is the `product_spec.rb`.\r\n\r\n```ruby\r\nrequire \'rails_helper\'\r\n\r\nRSpec.describe Product, :type => :model do\r\n  \r\n  before do\r\n    Product.destroy_all\r\n    Product.create(name: \"Get Rich Quick\", price: 10)\r\n  end\r\n  \r\n  it \'should return price in cents for a given product\' do  \r\n    product_id = Product.first\r\n    \r\n    price_in_cents = Product.price_in_cents_for(product_id)\r\n    \r\n    expect(price_in_cents).to eq(1000)\r\n  end\r\nend\r\n```\r\n\r\nStep 7\r\n------\r\n\r\nChange the `sales_controller` to use `product_id` instead of amount for the first parameter.\r\n\r\n```ruby\r\nclass SalesController < ApplicationController\r\n  layout \'sales\'\r\n  \r\n  def new\r\n    session[:product_id] = params[:id]\r\n  end\r\n\r\n  def create\r\n    begin\r\n      user = current_or_guest_user\r\n      Actors::Customer::UseCases.guest_checkout(session[:product_id], params[:stripeToken], user)\r\n    rescue Striped::CreditCardDeclined => e\r\n      redisplay_form(e.message)\r\n    rescue Exception => e\r\n      logger.error \"Guest checkout failed due to #{e.message}\"\r\n      redisplay_form(\"Checkout failed. We have been notified about this problem.\")\r\n    ensure\r\n      session[:product_id] = nil\r\n    end\r\n  end\r\nend\r\n```\r\n\r\nHere we save the `product_id` in the session and as soon as the purchase is complete we delete it from the session. This happens in the ensure clause. Thus regardless of success or failure, we cleanup our session.\r\n\r\nStep 8\r\n------\r\n\r\nChange the guest_checkout use case handler.\r\n\r\n```ruby\r\nmodule Actors\r\n  module Customer\r\n    module UseCases\r\n      \r\n      def self.guest_checkout(product_id, stripe_token, user)\r\n        amount = Product.price_in_cents_for(product_id)\r\n\r\n        stripe_gateway = StripeGateway.new(Rails.logger)\r\n        customer_id = stripe_gateway.save_credit_card_and_charge(amount, stripe_token)\r\n\r\n        user.save_stripe_customer_id(customer_id)      \r\n      end      \r\n      \r\n    end\r\n  end\r\nend\r\n```\r\n\r\nWe got rid of the logger parameter, since the use case handler can access Rails.logger. Eventually we will use a separate log file for Stripe called as stripe.log to make it easy to troubleshoot problems.\r\n\r\nStep 9\r\n------\r\n\r\nFor now, the products controller show action will load the first product in the database.\r\n\r\n```ruby\r\nclass ProductsController < ApplicationController\r\n  def show\r\n    @product = Product.first\r\n  end\r\n  \r\n  def download\r\n    \r\n  end\r\nend\r\n```\r\n\r\nStep 10\r\n------\r\n\r\nChange the app/views/products/show.html.erb:\r\n\r\n```ruby\r\n<h1><%= @product.name %></h1>\r\n\r\nPrice : <%= number_to_currency(@product.price) %>\r\n\r\n<%= link_to \'Buy Now\', buy_path(id: @product) %>\r\n```\r\n\r\nStep 11\r\n------\r\n\r\nWe need to load a product from the database before we can run integration spec. In `spec/features/guest_checkout_spec.rb`, define before method.\r\n\r\n```ruby\r\nbefore(:all) do\r\n  Product.create(name: \'Rails 4 Quickly\', price: 47)  \r\nend\r\n```\r\n\r\nStep 12\r\n------\r\n\r\nAdd a new logger for stripe log messages in config/initializers/stripe.rb.\r\n\r\n```ruby\r\n# Create a logger which ages the log file once it reaches a certain size. \r\n# Leave 10 old log files where each file is about 1,024,000 bytes.\r\nStripeLogger = Logger.new(\"#{Rails.root}/log/stripe.log\", 10, 1024000)\r\n```\r\n\r\nAll controllers and the stripe_gateway class now uses StripeLogger to log messages related to Stripe. The entire source code for this article can be downloaded from `git@bitbucket.org:bparanj/striped.git` using the commit hash 510ca86.\r\n\r\nReferences\r\n=========\r\n---------\r\n\r\n[Devise Gem Wiki](https://github.com/plataformatec/devise/wiki/How-To:-Stub-authentication-in-controller-specs \'Devise Gem Wiki\')\r\n[Rails Tip: Precision and scale for decimals](http://millarian.com/programming/ruby-on-rails/precision-and-scale-for-ruby-on-rails-migrations/ \'Rails Tip: Precision and scale for decimals\')\r\n[Ruby Logger](http://www.ruby-doc.org/stdlib-2.1.0/libdoc/logger/rdoc/Logger.html \'Ruby Logger\')\r\n[Custom log files for your ruby on rails applications](http://robaldred.co.uk/2009/01/custom-log-files-for-your-ruby-on-rails-applications/ \'Custom Rails Logs\')','2014-11-17 08:30:19','2016-12-22 20:03:27'),(1291,'One Click Checkout using Stripe ','Objective \r\n==========\r\n----------\r\n\r\nOur objective is to implement One-Click checkout using Stripe. \r\n\r\nDiscussion\r\n==========\r\n----------\r\n\r\nThe sequence of steps for this feature is as follows:\r\n\r\n1. A customer makes a purchase.\r\n2. Registers for an account.\r\n3. Logs out.\r\n4. Logs in.\r\n5. Makes a purchase without providing any credit card details.\r\n\r\nWe already have integration tests for step 1 and 2. Let\'s now tackle the other steps.\r\n\r\nSteps\r\n======\r\n------\r\n\r\nStep 1\r\n-----\r\n\r\nLet\'s create a home page. Change the config/routes.rb root method.\r\n\r\n```ruby\r\nroot \'welcome#index\'\r\n```\r\n\r\nStep 2\r\n-----\r\n\r\nCreate the welcome controller with an index action.\r\n\r\n```ruby\r\nrails g controller welcome index\r\n```\r\n\r\nStep 3\r\n-----\r\n\r\nAfter sign_up, we must now \r\n\r\n```ruby\r\nvisit pricing_path\r\n```\r\n\r\nin our scenarios in `spec/features/subscribe_spec.rb`.\r\n\r\nStep 4\r\n-----\r\n\r\nThe `spec/features/signup_spec.rb` should now check for successful signup message.\r\n\r\n```ruby\r\nexpect(page).to have_content(\'Welcome! You have signed up successfully.\')\r\n```\r\n\r\nStep 5\r\n-----\r\n\r\nHere is the unit test for user model.\r\n\r\n```ruby\r\nrequire \'rails_helper\'\r\n\r\ndescribe User, :type => :model do\r\n  \r\n  it \'should save stripe customer id\' do\r\n    u = User.new(email: \'bogus@exmaple.com\', password: \'12345678\')\r\n    \r\n    u.save_stripe_customer_id(\'sk12\')\r\n    # can also do : u.reload.stripe_customer_id, but it\'s hackish.\r\n    expect(User.last.stripe_customer_id).to eq(\'sk12\')\r\n  end\r\nend\r\n```\r\n\r\nStep 6\r\n-----\r\n\r\nAdd the `database_cleaner` gem to Gemfile.\r\n\r\n```ruby\r\ngroup :test do\r\n  gem \'capybara\'\r\n  gem \'selenium-webdriver\'\r\n  gem \'stripe-ruby-mock\'\r\n  gem \'database_cleaner\'\r\nend\r\n```\r\n\r\nStep 7\r\n-----\r\n\r\nIn `spec/rails_helper.rb`, add:\r\n\r\n```ruby\r\nrequire \'database_cleaner\'\r\n```\r\n\r\nat the top.\r\n\r\nAlso add the following code within the Rspec.configure block:\r\n\r\n```ruby\r\nconfig.before(:suite) do\r\n  DatabaseCleaner.clean_with(:truncation)\r\nend\r\n\r\nconfig.before(:each) do\r\n  DatabaseCleaner.strategy = :transaction\r\nend\r\n\r\nconfig.before(:each, js: true) do\r\n  DatabaseCleaner.strategy = :truncation\r\nend\r\n\r\nconfig.before(:each) do\r\n  DatabaseCleaner.start\r\nend\r\n\r\nconfig.after(:each) do\r\n  DatabaseCleaner.clean\r\nend\r\n```\r\n\r\nStep 8\r\n-----\r\n\r\nComment out the line:\r\n\r\n```ruby\r\nconfig.use_transactional_fixtures = false\r\n```\r\n\r\nin `rails_helper.rb`.\r\n\r\nStep 9\r\n-----\r\n\r\nWe can now delete the `User.destroy_all` in `spec/features/signup_spec.rb`.\r\n\r\n```ruby\r\nrequire \'rails_helper\'\r\nrequire \'spec_helper\'\r\n\r\nfeature \'Signup\' do  \r\n  scenario \'User with email and password\' do    \r\n    sign_up(test_email, \'12345678\')\r\n    \r\n    expect(page).to have_content(\'Welcome! You have signed up successfully.\')\r\n  end\r\nend\r\n```\r\n\r\nStep 10\r\n-----\r\n\r\nRun all controller specs.\r\n\r\n```sh\r\nrake spec:controllers\r\n```\r\n\r\nRun all model specs.\r\n\r\n```sh\r\nrake spec:models\r\n```\r\n\r\nWe are now using database cleaner to cleanup database. Let\'s change the before(:all) to before(:each). This will make sure we have a product to buy. \r\n\r\n```ruby\r\nfeature \'Guest Checkout\' do\r\n  before(:each) do\r\n    Product.create(name: \'Rails 4 Quickly\', price: 47)  \r\n  end\r\n\r\nend\r\n```\r\n\r\nRun all feature specs.\r\nrake spec:features\r\n\r\nStep 11\r\n-----\r\n\r\nCreate `app/views/devise/menu/_login_items.html.erb`.\r\n\r\n```ruby\r\n<% if user_signed_in? %>\r\n  <li>\r\n  <%= link_to(\'Logout\', destroy_user_session_path, :method => :delete) %>        \r\n  </li>\r\n<% else %>\r\n  <li>\r\n  <%= link_to(\'Login\', new_user_session_path)  %>  \r\n  </li>\r\n<% end %>\r\n```\r\n\r\nStep 12\r\n-----\r\n\r\nCreate `app/views/devise/menu/_registration_items.html.erb`.\r\n\r\n```ruby\r\n<% if user_signed_in? %>\r\n  <li>\r\n  <%= link_to(\'Edit registration\', edit_user_registration_path) %>\r\n  </li>\r\n<% else %>\r\n  <li>\r\n  <%= link_to(\'Register\', new_user_registration_path)  %>\r\n  </li>\r\n<% end %>\r\n```\r\n\r\nStep 13\r\n-----\r\n\r\nAdd login, logout and registration links to `app/views/layouts/application.html.erb`.\r\n\r\n```ruby\r\n<!DOCTYPE html>\r\n<html>\r\n<head>\r\n  <title>Striped</title>\r\n  <%= stylesheet_link_tag    \'application\', media: \'all\', \'data-turbolinks-track\' => true %>\r\n  <%= javascript_include_tag \'application\', \'data-turbolinks-track\' => true %>\r\n  \r\n  <%= javascript_include_tag \'https://js.stripe.com/v2/\' %>\r\n  \r\n  <%= csrf_meta_tags %>\r\n</head>\r\n<body>\r\n    <p class=\"notice\"><%= notice %></p>\r\n    <p class=\"alert\"><%= alert %></p>\r\n\r\n	<ul class=\"hmenu\">\r\n	  <%= render \'devise/menu/registration_items\' %>\r\n	  <%= render \'devise/menu/login_items\' %>\r\n	</ul>\r\n	\r\n<%= yield %>\r\n\r\n</body>\r\n</html>\r\n```\r\n\r\nStep 14\r\n-----\r\n\r\nTo help troubleshoot problems, let\'s dump the exception stack trace to the log file. In `sales_controller.rb`:\r\n\r\n```ruby\r\nStripeLogger.error \"Guest checkout failed due to #{e.message}. #{e.backtrace.join(\"\\n\")}\"\r\n```\r\n\r\nSince I am running Rails 4.2 beta version. There seems to be a problem with reloading classes. Sometimes, I have to restart the server to test code with changes. \r\n\r\nStep 15\r\n-----\r\n\r\nChange the new action to handle the one-click checkout if the customer has already purchased a product on our site.\r\n\r\n```ruby\r\nclass SalesController < ApplicationController\r\n  layout \'sales\'\r\n  \r\n  def new\r\n    begin\r\n      user = current_or_guest_user\r\n      if user.has_saved_credit_card?\r\n        Actors::Customer::UseCases.one_click_checkout(user, params[:id])\r\n\r\n        redirect_to download_path\r\n      else\r\n        session[:product_id] = params[:id]\r\n      end\r\n    rescue Striped::CreditCardDeclined => e\r\n      redisplay_form(e.message)\r\n    rescue Exception => e\r\n      StripeLogger.error \"One Click Checkout failed due to #{e.message}. #{e.backtrace.join(\"\\n\")}\"\r\n      redisplay_form(\"Checkout failed. We have been notified about this problem.\")\r\n    end\r\n  end\r\nend\r\n```\r\n\r\nStep 16\r\n-----\r\n\r\nIn app/models/user.rb, define `has_saved_credit_card?` method.\r\n\r\n```ruby\r\ndef has_saved_credit_card?\r\n  !stripe_customer_id.nil?\r\nend\r\n```\r\n\r\nStep 17\r\n-----\r\n\r\nIn app/actors/customer/customer.rb, add:\r\n\r\n```ruby\r\nrequire_relative \"#{Rails.root}/app/actors/customer/use_cases/one_click_checkout\"\r\n```\r\n\r\nStep 18\r\n-----\r\n\r\nCreate `app/actors/customer/one_click_checkout.rb`.\r\n\r\n```ruby\r\nmodule Actors\r\n  module Customer\r\n    module UseCases\r\n      \r\n      def self.one_click_checkout(user, product_id)\r\n        customer_id = user.stripe_customer_id\r\n        amount = Product.price_in_cents_for(product_id)\r\n        \r\n        StripeGateway.charge(amount: amount, customer: customer_id)\r\n      end      \r\n      \r\n    end\r\n  end\r\nend\r\n```\r\n\r\nStep 19\r\n-----\r\n\r\nAdd test for the user model.\r\n\r\n```ruby\r\nit \'should return true if credit card token is present\' do\r\n  u = User.new(email: \'bogus@exmaple.com\', password: \'12345678\', stripe_customer_id: \'sk10\')\r\n\r\n  expect(u.has_saved_credit_card?).to be(true)\r\nend\r\n\r\nit \'should return false if credit card token is present\' do\r\n  u = User.new(email: \'bogus@exmaple.com\', password: \'12345678\')\r\n\r\n  expect(u.has_saved_credit_card?).to be(false)\r\nend\r\n```\r\n\r\nStep 20\r\n-----\r\n\r\nAdd the charge method to the `stripe_gateway.rb`.\r\n\r\n```ruby\r\ndef self.charge(amount, customer_id)\r\n  begin\r\n    Stripe::Charge.create(amount: amount, currency: \"usd\", customer: customer_id)\r\n  rescue Exception => e\r\n    StripeLogger.error \"Could not charge customer due to : #{e.message},  #{e.backtrace.join(\"\\n\")}\"\r\n    \r\n    raise      \r\n  end\r\nend\r\n```\r\n\r\nAll the methods in the stripe_gateway is now a class method. This avoid unnecessary object creation. The latest specs can be found from the git repo : `git@bitbucket.org:bparanj/striped.git`. Use the commit hash 35f4210 to get the code for this article.\r\n\r\nReferences\r\n==========\r\n----------\r\n\r\n[How We Test Rails Applications](http://robots.thoughtbot.com/how-we-test-rails-applications \'How We Test Rails Applications\')\r\n[ActiveRecord and In-Memory Object State](http://railsadventures.wordpress.com/2012/11/24/activerecord-and-in-memory-object-state/ \'ActiveRecord and In-Memory Object State\')\r\n[How To: Add sign_in, sign_out, and sign_up links](https://github.com/plataformatec/devise/wiki/How-To:-Add-sign_in,-sign_out,-and-sign_up-links-to-your-layout-template \'How To: Add sign_in, sign_out, and sign_up links\')\r\n[Ruby 2.1 Exception](http://ruby-doc.org/core-2.1.1/Exception.html \'Ruby 2.1 Exception\')','2014-11-18 01:23:59','2016-12-22 20:06:43'),(1301,'Using Stripe Webhook to Handle Subscription Payment Failures','Objective\r\n==========\r\n----------\r\n\r\nSend email to subscribed users when the subscription payment fails and prompt them to update their credit card expiration date on our site.\r\n\r\nDiscussion\r\n===========\r\n-----------\r\n\r\nWe need to store the `expiration_month` and `expiration_year` in our database so that we can retrieve the list of customers whose credit cards are about to expire and send them email to update their credit card expiration date.\r\n\r\nSteps\r\n=====\r\n-----\r\n\r\nStep 1\r\n------\r\n\r\nLet\'s create a credit card model.\r\n\r\n```ruby\r\nrails g model credit_card last4digits:string expiration_month:integer expiration_year:integer\r\n```\r\n\r\nWe store the last 4 digits of the credit card, so that we can display the expiration date to the user to update the expiration date on our site.\r\n\r\nStep 2\r\n------\r\n\r\nAdd the `user_id` foreign key to the credit cards table.\r\n\r\n```ruby\r\nclass CreateCreditCards < ActiveRecord::Migration\r\n  def change\r\n    create_table :credit_cards do |t|\r\n      t.integer :user_id\r\n      t.string :last4digits\r\n      t.integer :expiration_month\r\n      t.integer :expiration_year\r\n\r\n      t.timestamps null: false\r\n    end\r\n  end\r\nend\r\n```\r\n\r\nStep 3\r\n------\r\n\r\nLet\'s define the user has one credit card associations.\r\n\r\n```ruby\r\nclass User\r\n  has_one :credit_card\r\nend\r\n```\r\n\r\n```ruby\r\nclass CreditCard < ActiveRecord::Base\r\n  belongs_to :user\r\nend\r\n```\r\n\r\nStep 4\r\n------\r\n\r\nWe are going to store the last 4 digits, expiration month and expiration year after we store the credit card details on Stripe servers. Create a StripeCustomer class.\r\n\r\n```ruby\r\nclass StripeCustomer\r\n  \r\n  def self.save(customer, user)\r\n    last4digits = customer.cards.data[0].last4\r\n    expiration_month = customer.cards.data[0].exp_month\r\n    expiration_year = customer.cards.data[0].exp_year\r\n    \r\n    user.save_stripe_customer_id(customer.id)\r\n    user.create_credit_card(last4digits: last4digits, \r\n                            expiration_month: expiration_month, \r\n                            expiration_year: expiration_year)\r\n  end\r\n  \r\n  def self.transfer_guest_user_values_to_registered_user(guest_user, current_user)\r\n    current_user.save_stripe_customer_id(guest_user.stripe_customer_id)\r\n    credit_card = guest_user.credit_card\r\n    credit_card.user_id = current_user.id\r\n    credit_card.save!\r\n  end\r\nend\r\n```\r\n\r\nThe save method will save the credit card details and `stripe_customer_id` in our database.\r\n\r\nStep 5\r\n------\r\n\r\nLet\'s change the registrations controller.\r\n\r\n```ruby\r\ndef create    \r\n  super    \r\n  StripeCustomer.transfer_guest_user_values_to_registered_user(guest_user, current_user)\r\nend  \r\n```\r\n\r\nWe associate the credit card details to the registered user by transferring the guest user `stripe_customer_id` and the credit card details. This happens when the optional registration is completed during the guest checkout process. \r\n\r\nStep 6\r\n------\r\n\r\nThe StripeCustomer save method will be used by `guest_checkout` use case handler.\r\n\r\n```ruby\r\nmodule Actors\r\n  module Customer\r\n    module UseCases\r\n      \r\n      def self.guest_checkout(product_id, stripe_token, user)\r\n        amount = Product.price_in_cents_for(product_id)\r\n        customer = StripeGateway.save_credit_card_and_charge(amount, stripe_token)\r\n\r\n        StripeCustomer.save(customer, user)      \r\n      end      \r\n      \r\n    end\r\n  end\r\nend\r\n```\r\n\r\nStep 7\r\n------\r\n\r\nWe can now write a rake task to retrieve all credit cards that will expire next month of the current year and email them. \r\n\r\n```ruby\r\nexpiring_cards = c = CreditCard.where(expiration_year: Date.today.year, expiration_month: Date.today.month)\r\n```\r\n\r\nThe email will be something along the lines of:\r\n\r\nSubject of Email: Subscription to [YOUR BUSINESS NAME] Update Your Credit Card\r\nBody of Email:\r\n\r\nYour credit card is about to expire. Please log on to [CREDIT_CARD UPDATE URL] and update your credit card info to keep your subscription active. \r\n\r\nIf you have any questions, please reply to [CUSTOMER SERVICE EMAIL]\r\n\r\n– YOUR COMPANY NAME\r\n\r\nWebhooks\r\n========\r\n--------\r\n\r\nThe rake task does not handle all the edge cases. We want to handle the payment failure for a subscription using Stripe Webhook. The invoice.payment_failed event is sent by Stripe when recurring payment fails for our subscribed customer. Create a controller for handling this Webhook.\r\n\r\nStep 1\r\n------\r\n\r\n```sh\r\nrails g controller stripe webhook\r\n```\r\n\r\nStep 2\r\n------\r\n\r\nChange the config/routes.rb.\r\n\r\n```ruby\r\npost \'stripe/webhook\'\r\n```\r\n\r\nStep 3\r\n------\r\n\r\nTurn off CSRF protection in the Stripe controller.\r\n\r\n```ruby\r\nclass StripeController < ApplicationController\r\n  protect_from_forgery except: :webhook\r\n  \r\n  def webhook\r\n  end\r\nend\r\n```\r\n\r\nStep 4\r\n------\r\n\r\nLet\'s handle the call back for subscription payment failure.\r\n\r\n```ruby\r\nclass StripeController < ApplicationController\r\n  protect_from_forgery except: :webhook\r\n  \r\n  SUBSCRIPTION_PAYMENT_FAILED = \"invoice.payment_failed\"\r\n  \r\n  def webhook    \r\n    StripeLogger.info \"Received event with ID: #{params[:id]} Type: #{params[:type]}\"\r\n\r\n    # Retrieving the event from the Stripe API guarantees its authenticity  \r\n    event = Stripe::Event.retrieve(params[:id])\r\n\r\n    if event.type == SUBSCRIPTION_PAYMENT_FAILED\r\n      stripe_customer_token = event.data.object.customer\r\n      user = User.where(stripe_customer_id: stripe_customer_token).first\r\n      \r\n      UserMailer.suscription_payment_failed(user).deliver\r\n    else\r\n      StripeLogger.info \"Webhook received params.inspect. Did not handle this event.\"  \r\n    end  \r\n    \r\n    render text: \"success\"\r\n  end  \r\n  \r\nend\r\n```\r\n\r\nYou can use the following email and customize it.\r\n\r\nEmail:\r\n\r\nSubject Of Email: Payment to [YOUR BUSINESS NAME] Failed\r\nBody Of Email:\r\n\r\nYour latest payment failed to go through. Please log on to [YOUR WEBSITE URL] and update your credit card info to keep your subscription active. \r\n\r\nIf you have any questions, please reply to [CUSTOMER SERVICE EMAIL]\r\n\r\n– YOUR COMPANY NAME\r\n\r\nStep 5\r\n------\r\n\r\n```sh\r\nrails g mailer user_mailer\r\n```\r\n\r\nStep 6\r\n------\r\n\r\nUpdate the `app/mailers/user_mailer.rb`.\r\n\r\n```ruby\r\nclass UserMailer < ActionMailer::Base\r\n  default from: \"from@your-domain.com\"\r\n  \r\n  def suscription_payment_failed(user)\r\n    @user = user\r\n    @url = \'http://yoursite.com/update/credit_card\'\r\n    \r\n    mail(to: @user.email, subject: \'Payment to RubyPlus Failed\')\r\n  end\r\nend\r\n```\r\n\r\nStep 7\r\n------\r\n\r\nCreate the `app/views/user_mailer/suscription_payment_failed.text.erb`.\r\n\r\n```ruby\r\nYour latest payment failed to go through. Please log on to <%= @url %>  and update your credit card info to keep your subscription active. \r\n\r\nIf you have any questions, please reply to [CUSTOMER SERVICE EMAIL]\r\n\r\n– YOUR COMPANY NAME\r\n```\r\n\r\nStep 8\r\n-------\r\n\r\nYou can copy the sample response for a Stripe API call from its documentation to `spec/fixtures/subscription_charge_failed.json`. I have customized the data that is valid for a failed subscription. Refer the Stripe documentation for more details.\r\n\r\n```json\r\n{\r\n  \"id\": \"evt_150MhXKmUHg13gkF5GmUVsEz\",\r\n  \"created\": 1416358327,\r\n  \"livemode\": false,\r\n  \"type\": \"invoice.payment_failed\",\r\n  \"data\": {\r\n    \"object\": {\r\n      \"id\": \"ch_150MhXKmUHg13gkFrIAL0SYi\",\r\n      \"object\": \"charge\",\r\n      \"created\": 1416358327,\r\n      \"livemode\": false,\r\n      \"paid\": true,\r\n      \"amount\": 4700,\r\n      \"currency\": \"usd\",\r\n      \"refunded\": false,\r\n      \"card\": {\r\n        \"id\": \"card_150MhWKmUHg13gkFLNAGoMfA\",\r\n        \"object\": \"card\",\r\n        \"last4\": \"4242\",\r\n        \"brand\": \"Visa\",\r\n        \"funding\": \"credit\",\r\n        \"exp_month\": 1,\r\n        \"exp_year\": 2015,\r\n        \"fingerprint\": \"JbFvkc6RO9g2yFua\",\r\n        \"country\": \"US\",\r\n        \"name\": null,\r\n        \"address_line1\": null,\r\n        \"address_line2\": null,\r\n        \"address_city\": null,\r\n        \"address_state\": null,\r\n        \"address_zip\": null,\r\n        \"address_country\": null,\r\n        \"cvc_check\": null,\r\n        \"address_line1_check\": null,\r\n        \"address_zip_check\": null,\r\n        \"dynamic_last4\": null,\r\n        \"customer\": \"cus_5Ai7NfoTq4ECl8\"\r\n      },\r\n      \"captured\": true,\r\n      \"refunds\": {\r\n        \"object\": \"list\",\r\n        \"total_count\": 0,\r\n        \"has_more\": false,\r\n        \"url\": \"/v1/charges/ch_150MhXKmUHg13gkFrIAL0SYi/refunds\",\r\n        \"data\": [\r\n\r\n        ]\r\n      },\r\n      \"balance_transaction\": \"txn_150MhXKmUHg13gkFlEfxFP5T\",\r\n      \"failure_message\": null,\r\n      \"failure_code\": null,\r\n      \"amount_refunded\": 0,\r\n      \"customer\": \"cus_5Ai7NfoTq4ECl8\",\r\n      \"invoice\": null,\r\n      \"description\": null,\r\n      \"dispute\": null,\r\n      \"metadata\": {\r\n      },\r\n      \"statement_description\": null,\r\n      \"fraud_details\": {\r\n        \"stripe_report\": \"unavailable\",\r\n        \"user_report\": null\r\n      },\r\n      \"receipt_email\": null,\r\n      \"receipt_number\": null,\r\n      \"shipping\": null\r\n    }\r\n  },\r\n  \"object\": \"event\",\r\n  \"pending_webhooks\": 1,\r\n  \"request\": \"iar_5Ai76TaDoUlhI2\",\r\n  \"api_version\": \"2014-10-07\"\r\n}\r\n```\r\n\r\nStep 9\r\n-------\r\n\r\nCreate `spec/controllers/stripe_controller_spec.rb`.\r\n\r\n```ruby\r\nrequire \'rails_helper\'\r\nrequire \'stripe_mock\'\r\n\r\ndescribe StripeController, :type => :controller do\r\n\r\n  before do\r\n    user = User.new(email: \'dummy@email.com\', stripe_customer_id: \'cus_5Ai7NfoTq4ECl8\')\r\n    user.save(validate: false)\r\n  end\r\n\r\n  it \"returns http success\" do\r\n    h = JSON.parse(File.read(\"spec/support/fixtures/subscription_charge_failed.json\"))\r\n    event = Stripe::Event.construct_from(h)    \r\n    allow(Stripe::Event).to receive(:retrieve) { event }\r\n        \r\n    post :webhook, h\r\n    \r\n    expect(response).to be_success\r\n  end\r\n\r\n  it \"sends email when subscription charge fails\" do\r\n    h = JSON.parse(File.read(\"spec/support/fixtures/subscription_charge_failed.json\"))\r\n    event = Stripe::Event.construct_from(h)    \r\n    allow(Stripe::Event).to receive(:retrieve) { event }\r\n            \r\n    expect { post :webhook, h }.to change { ActionMailer::Base.deliveries.count }.by(1)\r\n  end\r\n\r\nend\r\n```\r\n\r\nWe read the json data from our fixture file and stub the call to Stripe server. We test to make sure that we send out the customized email to the user. You can customize the email content and the url for your webapp.\r\n\r\nStep 10\r\n==========\r\n----------\r\n\r\nRegister your Webhook endpoint with Stripe. Go to your Stripe account, Account Settings -> Webhooks. Enter:\r\n\r\n```sh\r\nhttps://your-domain.com/stripe/webhook\r\n```\r\n\r\nin the URL field. Remember to replace the your-domain.com with your domain name. Click \'Create Webhook URL\'. You can download the source code for this article from `git@bitbucket.org:bparanj/striped.git` using the commit hash 8c55af1.\r\n\r\nSummary\r\n==========\r\n----------\r\n\r\nIn this article, we setup Stripe Webhook handler to handle payment failures for subscribed users. The email has the link to the URL where our customers can update their credit card. In the next article, we will implement the credit card update feature.\r\n\r\nReferences\r\n==========\r\n----------\r\n[What are Webhooks?](http://webhooks.us/ \'What are Webhooks?\')\r\n[Stripe Subscriptions guide](https://stripe.com/docs/guides/subscriptions#payment-failures \'Stripe Subscriptions guide\')\r\n[Webhook-Mailer: A simple example of using Stripe webhooks](https://github.com/boucher/stripe-webhook-mailer/blob/master/mailer.rb \'Webhook-Mailer: A simple example of using Stripe webhooks\')\r\n[Be lazy when testing Stripe webhooks](https://coderwall.com/p/yqp1wa/be-lazy-when-testing-stripe-webhooks \'Be lazy when testing Stripe webhooks\')','2014-11-19 04:55:23','2016-12-22 20:10:04'),(1311,'Stripe Subscription and Charge Customer Test Improvements','Objective\r\n==========\r\n----------\r\n\r\nTo eliminate the dependency on stripe-ruby-mock gem and simplify our tests.\r\n\r\nSteps\r\n=====\r\n-----\r\n\r\nStep 1\r\n-----\r\n\r\nIn the rails console, you can play with Stripe API and copy the response JSON to create the fixtures.\r\n\r\n```ruby\r\nStripe::Plan.all\r\n```\r\n\r\n```\r\nStripe::Token.create(\r\n  :card => {\r\n    :number => \"4242424242424242\",\r\n    :exp_month => 11,\r\n    :exp_year => 2015,\r\n    :cvc => \"314\"\r\n  },\r\n)\r\n```\r\n\r\nTo create a Stripe customer. We use the token we created in the Stripe::Token.create call.\r\n\r\n```ruby\r\nc = Stripe::Customer.create(:description => \"Customer for railsc@example.com\", :card => \"tok_150UYNKmUHg13gkFv1pyZGZu\")\r\n```\r\n\r\nTo create a Stripe subscription. We use the plan id we see from Stripe::Plan.all call.\r\n\r\n```ruby\r\ns = Stripe::Customer.create(description: \'test subscription\', card: \'tok_150UekKmUHg13gkFTRbLaBPs\', plan: \'gold\')\r\n```\r\n\r\n```ruby\r\n c = Stripe::Customer.retrieve(\"cus_5Ai7NfoTq4ECl8\")\r\n => #<Stripe::Customer:0x3ff55e8af834 id=cus_5Ai7NfoTq4ECl8> JSON: {\r\n  \"id\": \"cus_5Ai7NfoTq4ECl8\",\r\n  \"object\": \"customer\",\r\n  \"created\": 1416358326,\r\n  \"livemode\": false,\r\n  \"description\": \"guest-user@example.com\",\r\n  \"email\": null,\r\n  \"delinquent\": false,\r\n  \"metadata\": {},\r\n  \"subscriptions\": {\"object\":\"list\",\"total_count\":0,\"has_more\":false,\"url\":\"/v1/customers/cus_5Ai7NfoTq4ECl8/subscriptions\",\"data\":[]},\r\n  \"discount\": null,\r\n  \"account_balance\": 0,\r\n  \"currency\": null,\r\n  \"cards\": {\"object\":\"list\",\"total_count\":1,\"has_more\":false,\"url\":\"/v1/customers/cus_5Ai7NfoTq4ECl8/cards\",\"data\":[{\"id\":\"card_150MhWKmUHg13gkFLNAGoMfA\",\"object\":\"card\",\"last4\":\"4242\",\"brand\":\"Visa\",\"funding\":\"credit\",\"exp_month\":1,\"exp_year\":2015,\"fingerprint\":\"JbFvkc6RO9g2yFua\",\"country\":\"US\",\"name\":null,\"address_line1\":null,\"address_line2\":null,\"address_city\":null,\"address_state\":null,\"address_zip\":null,\"address_country\":null,\"cvc_check\":null,\"address_line1_check\":null,\"address_zip_check\":null,\"dynamic_last4\":null,\"customer\":\"cus_5Ai7NfoTq4ECl8\"}]},\r\n  \"default_card\": \"card_150MhWKmUHg13gkFLNAGoMfA\"\r\n} \r\n> c.class\r\n => Stripe::Customer \r\n> c.id\r\n => \"cus_5Ai7NfoTq4ECl8\" \r\n> c.email\r\n => nil \r\n> c.description\r\n => \"guest-user@example.com\"\r\n```\r\n\r\nStep 2\r\n-----\r\n\r\nCopy the JSON from the rails console and paste it on the [JSON Validator](http://jsonlint.com/ \'JSON Validator\') to make sure it is valid. JSON validator also indents the JSON document nicely. This formatted JSON can now be copied to spec/support/fixtures directory. I have created `create_subscription_success.json` and `create_customer_success.json` files.\r\n\r\nStep 3\r\n-----\r\n\r\nCreate the fixture file in `spec/support/fixtures/create_subscription_success.json`.\r\n\r\n```json\r\n{\r\n    \"id\": \"cus_5AqM5SPXDkx4Tl\",\r\n    \"object\": \"customer\",\r\n    \"created\": 1416388954,\r\n    \"livemode\": false,\r\n    \"description\": \"test subscription\",\r\n    \"email\": null,\r\n    \"delinquent\": false,\r\n    \"metadata\": {},\r\n    \"subscriptions\": {\r\n        \"object\": \"list\",\r\n        \"total_count\": 1,\r\n        \"has_more\": false,\r\n        \"url\": \"/v1/customers/cus_5AqM5SPXDkx4Tl/subscriptions\",\r\n        \"data\": [\r\n            {\r\n                \"id\": \"sub_5AqM073tSdkMgv\",\r\n                \"plan\": {\r\n                    \"id\": \"gold\",\r\n                    \"interval\": \"month\",\r\n                    \"name\": \"Amazing Gold Plan\",\r\n                    \"created\": 1415160352,\r\n                    \"amount\": 2000,\r\n                    \"currency\": \"usd\",\r\n                    \"object\": \"plan\",\r\n                    \"livemode\": false,\r\n                    \"interval_count\": 1,\r\n                    \"trial_period_days\": null,\r\n                    \"metadata\": {},\r\n                    \"statement_description\": null\r\n                },\r\n                \"object\": \"subscription\",\r\n                \"start\": 1416388954,\r\n                \"status\": \"active\",\r\n                \"customer\": \"cus_5AqM5SPXDkx4Tl\",\r\n                \"cancel_at_period_end\": false,\r\n                \"current_period_start\": 1416388954,\r\n                \"current_period_end\": 1418980954,\r\n                \"ended_at\": null,\r\n                \"trial_start\": null,\r\n                \"trial_end\": null,\r\n                \"canceled_at\": null,\r\n                \"quantity\": 1,\r\n                \"application_fee_percent\": null,\r\n                \"discount\": null,\r\n                \"metadata\": {}\r\n            }\r\n        ]\r\n    },\r\n    \"discount\": null,\r\n    \"account_balance\": 0,\r\n    \"currency\": \"usd\",\r\n    \"cards\": {\r\n        \"object\": \"list\",\r\n        \"total_count\": 1,\r\n        \"has_more\": false,\r\n        \"url\": \"/v1/customers/cus_5AqM5SPXDkx4Tl/cards\",\r\n        \"data\": [\r\n            {\r\n                \"id\": \"card_150UekKmUHg13gkFdTz9kRjI\",\r\n                \"object\": \"card\",\r\n                \"last4\": \"4242\",\r\n                \"brand\": \"Visa\",\r\n                \"funding\": \"credit\",\r\n                \"exp_month\": 11,\r\n                \"exp_year\": 2015,\r\n                \"fingerprint\": \"JbFvkc6RO9g2yFua\",\r\n                \"country\": \"US\",\r\n                \"name\": null,\r\n                \"address_line1\": null,\r\n                \"address_line2\": null,\r\n                \"address_city\": null,\r\n                \"address_state\": null,\r\n                \"address_zip\": null,\r\n                \"address_country\": null,\r\n                \"cvc_check\": \"pass\",\r\n                \"address_line1_check\": null,\r\n                \"address_zip_check\": null,\r\n                \"dynamic_last4\": null,\r\n                \"customer\": \"cus_5AqM5SPXDkx4Tl\"\r\n            }\r\n        ]\r\n    },\r\n    \"default_card\": \"card_150UekKmUHg13gkFdTz9kRjI\"\r\n}\r\n```\r\n\r\nStep 4\r\n-----\r\n\r\nCreate the fixture file in `spec/support/fixtures/create_customer_success.json`.\r\n\r\n```json\r\n{\r\n    \"id\": \"cus_5AqFj04bLNXGYL\",\r\n    \"object\": \"customer\",\r\n    \"created\": 1416388537,\r\n    \"livemode\": false,\r\n    \"description\": \"Customer for railsc@example.com\",\r\n    \"email\": null,\r\n    \"delinquent\": false,\r\n    \"metadata\": {},\r\n    \"subscriptions\": {\r\n        \"object\": \"list\",\r\n        \"total_count\": 0,\r\n        \"has_more\": false,\r\n        \"url\": \"/v1/customers/cus_5AqFj04bLNXGYL/subscriptions\",\r\n        \"data\": []\r\n    },\r\n    \"discount\": null,\r\n    \"account_balance\": 0,\r\n    \"currency\": null,\r\n    \"cards\": {\r\n        \"object\": \"list\",\r\n        \"total_count\": 1,\r\n        \"has_more\": false,\r\n        \"url\": \"/v1/customers/cus_5AqFj04bLNXGYL/cards\",\r\n        \"data\": [\r\n            {\r\n                \"id\": \"card_150UYNKmUHg13gkF9kj0jWeE\",\r\n                \"object\": \"card\",\r\n                \"last4\": \"4242\",\r\n                \"brand\": \"Visa\",\r\n                \"funding\": \"credit\",\r\n                \"exp_month\": 11,\r\n                \"exp_year\": 2015,\r\n                \"fingerprint\": \"JbFvkc6RO9g2yFua\",\r\n                \"country\": \"US\",\r\n                \"name\": null,\r\n                \"address_line1\": null,\r\n                \"address_line2\": null,\r\n                \"address_city\": null,\r\n                \"address_state\": null,\r\n                \"address_zip\": null,\r\n                \"address_country\": null,\r\n                \"cvc_check\": \"pass\",\r\n                \"address_line1_check\": null,\r\n                \"address_zip_check\": null,\r\n                \"dynamic_last4\": null,\r\n                \"customer\": \"cus_5AqFj04bLNXGYL\"\r\n            }\r\n        ]\r\n    },\r\n    \"default_card\": \"card_150UYNKmUHg13gkF9kj0jWeE\"\r\n}\r\n```\r\n\r\nYou can play in the rails console and interact with the Stripe API, use JSON Lint to format the response from Stripe and copy it to your fixtures folder.\r\n\r\nStep 5\r\n-----\r\n\r\nRemove:\r\n\r\n```ruby\r\ngem \'stripe-ruby-mock\'\r\n```\r\n\r\nin Gemfile. So the test group in Gemfile now looks like this:\r\n\r\n```ruby\r\ngroup :test do\r\n  gem \'capybara\'\r\n  gem \'selenium-webdriver\'\r\n  gem \'database_cleaner\'\r\nend\r\n```\r\n\r\nRun bundle install.\r\n\r\nStep 6\r\n-----\r\n\r\nLet\'s now get rid of the require statement:\r\n\r\n```ruby\r\nrequire \'strip-mock\' \r\n```\r\n\r\nin `spec/gateways/stripe_gateway_spec.rb`. Your will only have two require statements as follows:\r\n\r\n```ruby\r\nrequire \'rails_helper\'\r\nrequire \'stripe\'\r\n```\r\n\r\nStep 7\r\n-----\r\n\r\nHere is the `stripe_gateway_spec` that uses our fixtures to test instead of using stripe-ruby-mock gem.\r\n\r\n```ruby\r\nrequire \'rails_helper\'\r\nrequire \'stripe\'\r\n\r\ndescribe StripeGateway do\r\n  it \'subscribe customer to gold plan\' do\r\n    # The fixture file is the Stripe response to a successful subscription to a gold plan\r\n    h = JSON.parse(File.read(\"spec/support/fixtures/create_subscription_success.json\"))\r\n    customer = Stripe::Customer.construct_from(h)        \r\n    allow(Stripe::Customer).to receive(:create) { customer }\r\n    \r\n    customer = StripeGateway.create_subscription(\'test-email\', \'test-token\', \'doesnot-matter\')\r\n\r\n    expect(customer.id).to eq(\'cus_5AqM5SPXDkx4Tl\')\r\n    expect(customer.subscriptions.data[0].plan.id).to eq(\'gold\')\r\n  end\r\n\r\n  it \'should raise credit card exception when Stripe::InvalidRequestError occurs\' do\r\n    expect do\r\n      customer = StripeGateway.create_subscription(\'fake\', \'bogus\', \'junk\')\r\n    end.to raise_error Striped::CreditCardException\r\n\r\n  end\r\n\r\n  it \'save customer credit card and charge\' do\r\n    h = JSON.parse(File.read(\"spec/support/fixtures/create_customer_success.json\"))\r\n    customer = Stripe::Customer.construct_from(h)        \r\n    allow(Stripe::Customer).to receive(:create) { customer }\r\n    allow(Stripe::Charge).to receive(:create) { true }\r\n    \r\n    customer = StripeGateway.save_credit_card_and_charge(2000, 1)\r\n  \r\n    expect(customer.id).to eq(\'cus_5AqFj04bLNXGYL\')\r\n  end\r\n  \r\nend\r\n```\r\n\r\nRun the `stripe_gateway_spec.rb`.\r\n\r\n```sh\r\nrspec spec/gateways/stripe_gateway_spec.rb \r\n```\r\n\r\nBug Fixes and Enhancements\r\n==============\r\n--------------\r\n\r\nSteps\r\n======\r\n------\r\n\r\nStep 1\r\n-----\r\n\r\nLet\'s make the StripeCustomer.save(customer, user) method in `app/actors/customer/use_cases/guest_checkout.rb` intention revealing by renaming it to:\r\n\r\n```ruby\r\nStripeCustomer.save_credit_card_and_stripe_customer_id(customer, user)\r\n```\r\n\r\nRename the method in `app/models/stripe_customer.rb` :\r\n\r\n```ruby\r\ndef self.save_credit_card_and_stripe_customer_id(customer, user)\r\n```\r\n\r\nNow we don\'t have a vague and generic name called save.\r\n\r\nStep 2\r\n-----\r\n\r\nLet\'s cleanup `stripe_gateway.rb`.\r\n\r\n```ruby\r\nclass StripeGateway\r\n  \r\n  def self.create_subscription(email, stripe_token, plan_id)\r\n    run_with_stripe_exception_handler(\'Create subscription failed due to\') do\r\n      Stripe::Customer.create(description: email, card: stripe_token, plan: plan_id)\r\n    end    \r\n  end\r\n  # amount in cents\r\n  def self.save_credit_card_and_charge(amount, stripe_token)\r\n    run_with_stripe_exception_handler(\'StripeGateway.save_credit_card_and_charge failed due to\') do\r\n      # Create a Customer (save credit card)\r\n      customer = Stripe::Customer.create(card: stripe_token, description: \"guest-user@example.com\")\r\n      # Charge the Customer instead of the card\r\n      Stripe::Charge.create(amount:   amount, \r\n                            currency: \"usd\",\r\n                            customer: customer.id)\r\n      customer\r\n    end    \r\n  end\r\n  \r\n  def self.charge(amount, customer_id)\r\n    run_with_stripe_exception_handler(\'Could not charge customer due to\') do\r\n      Stripe::Charge.create(amount: amount, currency: \"usd\", customer: customer_id)\r\n    end\r\n  end\r\n  \r\n  private\r\n  \r\n  def self.run_with_stripe_exception_handler(message)\r\n    begin\r\n      yield\r\n    rescue Stripe::CardError => e\r\n      # Since it\'s a decline, Stripe::CardError will be caught\r\n      body = e.json_body\r\n      err  = body[:error]\r\n\r\n      StripeLogger.error \"Status is: #{e.http_status}\"\r\n      StripeLogger.error \"Type is: #{err[:type]}\"\r\n      StripeLogger.error \"Code is: #{err[:code]}\"\r\n      # param is \'\' in this case\r\n      StripeLogger.error \"Param is: #{err[:param]}\"\r\n      StripeLogger.error \"Message is: #{err[:message]} :  #{e.backtrace.join(\"\\n\")}\" \r\n\r\n      raise Striped::CreditCardDeclined.new(err[:message])     \r\n    rescue Stripe::InvalidRequestError => e\r\n      StripeLogger.error \"#{message} Stripe::InvalidRequestError : #{e.message} :  #{e.backtrace.join(\"\\n\")}\"\r\n      \r\n      raise Striped::CreditCardException.new(e.message)\r\n    rescue Stripe::AuthenticationError => e\r\n      StripeLogger.error \"Authentication with Stripe\'s API failed :  #{e.backtrace.join(\"\\n\")}\"\r\n      StripeLogger.error \"(maybe you changed API keys recently)\"\r\n      \r\n      raise Striped::CreditCardException.new(e.message)\r\n    rescue Stripe::APIConnectionError => e\r\n      StripeLogger.error \"Network communication with Stripe failed :  #{e.backtrace.join(\"\\n\")}\"\r\n    \r\n      raise Striped::CreditCardException.new(e.message)\r\n    rescue Stripe::StripeError => e\r\n      StripeLogger.error \"Display a very generic error to the user, and maybe send yourself an email :  #{e.backtrace.join(\"\\n\")}\"\r\n      \r\n      raise Striped::CreditCardException.new(e.message)\r\n    rescue Exception => e\r\n      StripeLogger.error \"#{message} : #{e.message} :  #{e.backtrace.join(\"\\n\")}\"  \r\n      \r\n      raise\r\n    end\r\n  end\r\nend\r\n```\r\n\r\nHere we have extracted a private method that is focused only on dealing with Stripe exceptions.\r\n\r\nStep 3\r\n-----\r\n\r\nLet\'s fix a bug that broke normal user registration. We need to transfer values from guest user only for a user who registers after a guest checkout.\r\n\r\n```ruby\r\nclass StripeCustomer\r\n  \r\n  def self.save(customer, user)\r\n    last4digits = customer.cards.data[0].last4\r\n    expiration_month = customer.cards.data[0].exp_month\r\n    expiration_year = customer.cards.data[0].exp_year\r\n    \r\n    user.save_stripe_customer_id(customer.id)\r\n    user.create_credit_card(last4digits: last4digits, \r\n                            expiration_month: expiration_month, \r\n                            expiration_year: expiration_year)\r\n  end\r\n  \r\n  def self.transfer_guest_user_values_to_registered_user(guest_user, current_user)\r\n    # Bypass transfer for normal user registration. \r\n    if user_registration_after_guest_checkout?(guest_user)\r\n      current_user.save_stripe_customer_id(guest_user.stripe_customer_id)\r\n      current_user.create_credit_card(last4digits: guest_user.credit_card.last4digits, \r\n                                      expiration_month: guest_user.credit_card.expiration_month,  \r\n                                      expiration_year: guest_user.credit_card.expiration_year)\r\n    end\r\n  end\r\n  \r\n  private\r\n  # This is true only if someone registers after guest checkout is complete.\r\n  def self.user_registration_after_guest_checkout?(user)\r\n    user && user.credit_card\r\n  end\r\nend\r\n```\r\n\r\nStep 4\r\n-----\r\n\r\nWe also need to rename the route used in products show page to avoid confusion later. We will use a different controller to handle the case where a logged in user makes a purchase.\r\n\r\n```ruby\r\n<%= link_to \'Buy Now\', guest_checkout_path(id: @product) %>\r\n```\r\n\r\nStep 5\r\n-----\r\n\r\nChange the config/routes.rb.\r\n\r\n```ruby\r\nget \'sales/new\' => \'sales#new\', as: :guest_checkout\r\n```\r\n\r\nStep 6\r\n-----\r\n\r\nFix one-click checkout bug.\r\n\r\n```ruby\r\nStripeGateway.charge(amount, customer_id)\r\n```\r\n\r\nStep 7\r\n-----\r\n\r\nRename the save method in `stripe_customer.rb` to intention revealing method name. In `app/models/stripe_customer.rb`:\r\n\r\n```ruby\r\nclass StripeCustomer   \r\n  def self.save_credit_card_and_stripe_customer_id(customer, user)\r\n\r\n  end\r\nend\r\n```\r\n\r\nThe complete source code for this article can be downloaded from `git@bitbucket.org:bparanj/striped.git` using the commit hash 42da805. \r\n\r\nSummary\r\n=======\r\n-------\r\n\r\nIn this article we increase the test coverage for our `stripe_gateway` class. We eliminated the dependency on stripe-ruby-mock gem in our tests. This simplifies our test code.','2014-11-20 00:03:32','2016-12-22 20:13:34'),(1321,'Stripe Recurring Billing : Update Credit Card Expiration ','Objective\r\n=========\r\n\r\nWhen the customer clicks the link in the email that reminds subscriber\'s credit card that is about to expire, display a page with the last 4 digits of the credit card and current expiration month and year for the subscriber to update the expiration month and year on Stripe server and store expiration month and year in our database.\r\n\r\nSteps\r\n=====\r\n-----\r\n\r\nStep 1\r\n------\r\n\r\nCreate the controller to update credit card expiration date.\r\n\r\n```ruby\r\nrails g controller credit_cards edit update\r\n```\r\n\r\nStep 2\r\n-----\r\n\r\nChange the route for credit cards edit page.\r\n\r\n```ruby\r\nget \'credit_cards/edit\'\r\n```\r\n\r\nStep 3\r\n-----\r\n\r\nDefine the edit and update actions for `credit_cards_controller`.\r\n\r\n```ruby\r\nclass CreditCardsController < ApplicationController\r\n  before_action :authenticate_user!\r\n  \r\n  def edit\r\n    @credit_card = CreditCard.where(user_id: current_user.id).first\r\n  end\r\n\r\n  def update\r\n    Actors::Customer::UseCases.update_credit_card_expiration_date(current_user, \r\n                                                                  params[:card_month], \r\n                                                                  params[:card_year])\r\n    flash.notice = \'Credit card update successful\'    \r\n  end\r\nend\r\n```\r\n\r\nStep 4\r\n-----\r\n\r\nCreate the `app/views/credit_cards/edit.html.erb`.\r\n\r\n```ruby\r\n<%= form_for(@credit_card, :url => credit_cards_update_url, :html => {:method => :post}) do |f| %>\r\n\r\n      <h3>Change Expiration Date for Credit Card</h3>\r\n\r\n	  <div class=\"form-row\">\r\n	    <label>\r\n	      <span>Your Credit Card Last 4 Digits : <%= @credit_card.last4digits %></span>\r\n	    </label>\r\n	  </div>\r\n\r\n	  <div class=\"form-row\">\r\n	    <label>\r\n	      <span>Expiration</span>\r\n	<%= select_month @credit_card.expiration_month, {add_month_numbers: true}, {name: \'card_month\', id: \"card_month\"} %>\r\n\r\n	    </label>\r\n	    <span>/</span>\r\n		<%= select_year @credit_card.expiration_year, {start_year: Date.today.year, end_year: Date.today.year+15}, {name: \"card_year\", id: \"card_year\"} %>\r\n\r\n	  </div>\r\n\r\n	  <button type=\"submit\">Change Expiration Date</button>\r\n\r\n<% end %>\r\n```\r\n\r\nWe display the edit credit card form with last 4 digits of the credit card with the current `expiration_month` and `expiration_year` of the credit card.\r\n\r\nStep 5\r\n-----\r\n\r\nCreate the `app/views/credit_cards/update.html.erb`.\r\n\r\n```ruby\r\nExpiration date for your credit card ending in last 4 digits : <%= @user.credit_card.last4digits %>\r\nhas been updated to : <%= @user.credit_card.expiration_month %> / <%= @user.credit_card.expiration_year %>\r\n```\r\n\r\nStep 6\r\n-----\r\n\r\nCreate `app/actors/customer/user_cases/update_credit_card_expiration_date.rb`:\r\n\r\n```ruby\r\nmodule Actors\r\n  module Customer\r\n    module UseCases\r\n      \r\n      def self.update_credit_card_expiration_date(user, card_month, card_year)\r\n        cc = StripeGateway.update_credit_card_expiration_date(user.stripe_customer_id, card_month, card_year)\r\n        \r\n        user.update_credit_card_expiration_date(cc.last4, cc.exp_month, cc.exp_year)\r\n      end      \r\n      \r\n    end\r\n  end\r\nend\r\n```\r\n\r\nStep 7\r\n-----\r\n\r\nHookup the use case handler in `app/actors/customer/customer.rb`.\r\n\r\n```ruby\r\nrequire_relative \"#{Rails.root}/app/actors/customer/use_cases/update_credit_card_expiration_date\"\r\n```\r\n\r\nStep 8\r\n-----\r\n\r\nDefine the `update_credit_card_expiration_date` method in app/models/user.rb.\r\n\r\n```ruby\r\nclass User < ActiveRecord::Base  \r\n  def update_credit_card_expiration_date(last4digits, expiration_month, expiration_year)\r\n    self.credit_card.update_credit_card_expiration_date(last4digits, expiration_month, expiration_year)\r\n  end\r\nend\r\n```\r\n\r\nStep 9\r\n-----\r\n\r\nCreate `update_credit_card_expiration_date` method in `app/models/credit_card.rb`:\r\n\r\n```ruby\r\nclass CreditCard < ActiveRecord::Base\r\n  belongs_to :user\r\n  \r\n  def update_credit_card_expiration_date(last4digits, expiration_month, expiration_year)\r\n    self.last4digits = last4digits\r\n    self.expiration_month = expiration_month\r\n    self.expiration_year = expiration_year\r\n    self.save!\r\n  end\r\nend\r\n```\r\n\r\nStep 10\r\n-----\r\n\r\nDefine the `update_credit_card_expiration_date` in `app/gateways/stripe_gateway.rb`. This updates the credit card expiration date on Stripe servers.\r\n\r\n```ruby\r\ndef self.update_credit_card_expiration_date(stripe_customer_id, card_month, card_year)\r\n  run_with_stripe_exception_handler(\"Failed to update credit card expiration date\") do\r\n    customer = Stripe::Customer.retrieve(stripe_customer_id)\r\n    card = customer.cards.first\r\n    card.exp_month = card_month\r\n    card.exp_year = card_year\r\n    card.save      \r\n  end\r\nend\r\n```\r\n\r\nStep 11\r\n-------\r\n\r\nLet\'s cleanup the app/views/subscriptions/create.html.erb.\r\n\r\n```ruby \r\n<% if @success %>\r\n	You have been subscribed to <%= @plan_name.humanize %>.\r\n<% else %>\r\n  Subscription failed.\r\n<% end %>\r\n```\r\n\r\nStep 12\r\n-----\r\n\r\nDefine the routes for credit cards update action in config/routes.rb\r\n\r\n```ruby\r\nRails.application.routes.draw do\r\n  get \'credit_cards/edit\'\r\n  post \'credit_cards/update\'\r\nend\r\n```\r\n\r\nStep 13\r\n-----\r\n\r\nCreate `spec/support/fixtures/credit_card.json`:\r\n\r\n```json\r\n{\r\n    \"id\": \"card_150UekKmUHg13gkFdTz9kRjI\",\r\n    \"object\": \"card\",\r\n    \"last4\": \"4242\",\r\n    \"brand\": \"Visa\",\r\n    \"funding\": \"credit\",\r\n    \"exp_month\": 11,\r\n    \"exp_year\": 2015,\r\n    \"fingerprint\": \"JbFvkc6RO9g2yFua\",\r\n    \"country\": \"US\",\r\n    \"name\": \"Jane Austen\",\r\n    \"address_line1\": null,\r\n    \"address_line2\": null,\r\n    \"address_city\": null,\r\n    \"address_state\": null,\r\n    \"address_zip\": null,\r\n    \"address_country\": null,\r\n    \"cvc_check\": \"pass\",\r\n    \"address_line1_check\": null,\r\n    \"address_zip_check\": null,\r\n    \"dynamic_last4\": null,\r\n    \"customer\": \"cus_5AqM5SPXDkx4Tl\"\r\n}\r\n```\r\n\r\nStep 14\r\n-----\r\n\r\nspec/support/fixtures/customer.json\r\n\r\n```json\r\n{\r\n    \"id\": \"cus_5AqFj04bLNXGYL\",\r\n    \"object\": \"customer\",\r\n    \"created\": 1416388537,\r\n    \"livemode\": false,\r\n    \"description\": \"Customer for railsc@example.com\",\r\n    \"email\": null,\r\n    \"delinquent\": false,\r\n    \"metadata\": {},\r\n    \"subscriptions\": {\r\n        \"object\": \"list\",\r\n        \"total_count\": 0,\r\n        \"has_more\": false,\r\n        \"url\": \"/v1/customers/cus_5AqFj04bLNXGYL/subscriptions\",\r\n        \"data\": []\r\n    },\r\n    \"discount\": null,\r\n    \"account_balance\": 0,\r\n    \"currency\": null,\r\n    \"cards\": {\r\n        \"object\": \"list\",\r\n        \"total_count\": 1,\r\n        \"has_more\": false,\r\n        \"url\": \"/v1/customers/cus_5AqFj04bLNXGYL/cards\",\r\n        \"data\": [\r\n            {\r\n                \"id\": \"card_150UYNKmUHg13gkF9kj0jWeE\",\r\n                \"object\": \"card\",\r\n                \"last4\": \"4242\",\r\n                \"brand\": \"Visa\",\r\n                \"funding\": \"credit\",\r\n                \"exp_month\": 11,\r\n                \"exp_year\": 2015,\r\n                \"fingerprint\": \"JbFvkc6RO9g2yFua\",\r\n                \"country\": \"US\",\r\n                \"name\": null,\r\n                \"address_line1\": null,\r\n                \"address_line2\": null,\r\n                \"address_city\": null,\r\n                \"address_state\": null,\r\n                \"address_zip\": null,\r\n                \"address_country\": null,\r\n                \"cvc_check\": \"pass\",\r\n                \"address_line1_check\": null,\r\n                \"address_zip_check\": null,\r\n                \"dynamic_last4\": null,\r\n                \"customer\": \"cus_5AqFj04bLNXGYL\"\r\n            }\r\n        ]\r\n    },\r\n    \"default_card\": \"card_150UYNKmUHg13gkF9kj0jWeE\"\r\n}\r\n```\r\n\r\nStep 15\r\n-----\r\n\r\nCreate test for updating credit card expiration date in `spec/gateways/stripe_gateway_spec.rb`.\r\n\r\n```ruby\r\nrequire \'rails_helper\'\r\nrequire \'stripe\'\r\n\r\ndescribe StripeGateway do  \r\n  it \'update credit card expiration date\' do\r\n    h = JSON.parse(File.read(\"spec/support/fixtures/customer.json\"))\r\n    customer = Stripe::Customer.construct_from(h)        \r\n    allow(Stripe::Customer).to receive(:retrieve) { customer }\r\n    \r\n    h2 = JSON.parse(File.read(\"spec/support/fixtures/credit_card.json\"))\r\n    cc = Stripe::Card.construct_from(h2)\r\n    allow(customer).to receive_message_chain(:cards, :first) { cc }\r\n    \r\n    credit_card = StripeGateway.update_credit_card_expiration_date(1, 1, 2050)\r\n    \r\n    expect(credit_card.id).to eq(\'card_150UekKmUHg13gkFdTz9kRjI\')\r\n  end\r\nend\r\n```\r\n\r\nStep 16\r\n-----\r\n\r\nCreate integration test for updating credit card expiration in `spec/features/update_credit_card_expiration_date_spec.rb`.\r\n\r\n```ruby\r\nrequire \'rails_helper\'\r\nrequire \'spec_helper\'\r\n\r\nfeature \'Credit Card Update\' do\r\n\r\n  scenario \'signup, subscribe, edit credit card expiration date\', js: true do\r\n    # signup\r\n    visit new_user_registration_path\r\n    fill_in \'Email\', with: test_email\r\n    fill_in \'Password\', with: \'12345678\'\r\n    click_button \'Sign up\'\r\n    \r\n    # subscribe\r\n    visit pricing_path    \r\n    click_link \'Gold\'\r\n    fill_in \"Card Number\", with: \'4242424242424242\'\r\n    page.select \'10\', from: \"card_month\"\r\n    page.select \'2029\', from: \'card_year\'\r\n    click_button \'Subscribe Me\'\r\n    \r\n    # Need to wait for response from Stripe servers before we can continue.\r\n    sleep 5\r\n    \r\n    # edit cc expiration date\r\n    visit credit_cards_edit_path    \r\n    page.select \'10\', from: \"card_month\"\r\n    page.select \'2028\', from: \'card_year\'\r\n    click_button \'Change Expiration Date\'\r\n    \r\n   expect(page).to have_content(\'Credit card update successful\')  \r\n  end\r\n\r\nend\r\n```\r\n\r\nStep 17\r\n-----\r\n\r\nCreate `spec/controllers/credit_cards_controller_spec.rb`.\r\n\r\n```ruby\r\nrequire \'rails_helper\'\r\n\r\ndescribe CreditCardsController, :type => :controller do\r\n  it \"initializes credit card variable\" do\r\n    User.create(email: \'bugs@disney.com\', password: \'12345678\')\r\n    user = User.last\r\n    user.create_credit_card\r\n    sign_in(user)   \r\n\r\n    get :edit\r\n    expect(assigns[:credit_card]).not_to be_nil\r\n  end\r\n\r\n  it \"edit page returns http success if user is logged in\" do\r\n    User.create(email: \'bugs@disney.com\', password: \'12345678\')\r\n    user = User.last\r\n    sign_in(user)   \r\n\r\n    get :edit\r\n    expect(response).to be_success\r\n  end\r\n\r\n  it \"edit page returns http failure if user is not logged in\" do      \r\n    get :edit\r\n\r\n    expect(response).not_to be_success\r\n  end\r\n\r\n  it \"update returns http failure if user is not logged in\" do\r\n    get :update\r\n\r\n    expect(response).not_to be_success\r\n  end\r\n\r\n  it \'delegates the update of credit card expiration to use case handler\' do\r\n    User.create(email: \'bugs@disney.com\', password: \'12345678\')\r\n    user = User.last\r\n    user.create_credit_card\r\n    sign_in(user)   \r\n\r\n    expect(Actors::Customer::UseCases).to receive(:update_credit_card_expiration_date)\r\n\r\n    get :update\r\n  end\r\n  \r\n  it \'should initialize the user variable\' do\r\n    User.create(email: \'bugs@disney.com\', password: \'12345678\')\r\n    user = User.last\r\n    user.create_credit_card\r\n    sign_in(user)   \r\n\r\n    allow(Actors::Customer::UseCases).to receive(:update_credit_card_expiration_date) { true }\r\n\r\n    get :update\r\n    \r\n    expect(assigns[:user]).not_to be_nil\r\n  end\r\n  \r\nend\r\n```\r\n\r\nSummary\r\n=========\r\n----------\r\n\r\nIn this article, we implemented updating the credit card expiration month and year on Stripe servers. We also saved them in our database for sending reminder emails for our customers to update the credit card.\r\n\r\nReferences\r\n==========\r\n----------\r\n\r\n[Action Mailer Basics](http://guides.rubyonrails.org/action_mailer_basics.html \'Action Mailer Basics\')\r\n[Message Chains](https://relishapp.com/rspec/rspec-mocks/docs/working-with-legacy-code/message-chains \'Message Chains\')','2014-11-21 01:11:46','2016-12-22 20:18:17'),(1331,'Stripe Recurring Billing and Update Credit Card Expiration Cleanup','Objective\r\n=========\r\n\r\nTo cleanup subscription related code.\r\n\r\nSteps\r\n=====\r\n-----\r\n\r\nStep 1\r\n-----\r\n\r\nIn config/application.rb:\r\n\r\n```ruby\r\nconfig.action_mailer.default_url_options = { host: \'rubyplus.com\' }\r\n```\r\n\r\nThis will generate the url in the user mailer with the host rubyplus.com.\r\n\r\nStep 2\r\n------\r\n\r\nInitialize the url for use in the mailer view.\r\n\r\n```ruby\r\nclass UserMailer < ActionMailer::Base\r\n  default from: \"from@your-domain.com\"\r\n  \r\n  def suscription_payment_failed(user)\r\n    @user = user\r\n    @url = credit_cards_edit_url\r\n    \r\n    mail(to: @user.email, subject: \'Payment to RubyPlus Failed\')\r\n  end\r\nend\r\n```\r\n\r\nStep 3\r\n-----\r\n\r\nPlugin the url variable in app/views/user\\_mailer:\r\n\r\n```sh\r\nYour latest payment failed to go through. Please log on to  <%= @url %> and update your credit card info to keep your subscription active. \r\n\r\nIf you have any questions, please reply to [CUSTOMER SERVICE EMAIL]\r\n\r\n– YOUR COMPANY NAME\r\n```\r\n\r\nStep 4\r\n-----\r\n\r\nLet\'s cleanup app/models/stripe\\_customer.rb.\r\n\r\n```ruby\r\nclass StripeCustomer\r\n  \r\n  # Use Case : Subscribe to a plan\r\n  def self.save_subscription_details(user, customer, plan_name)\r\n    user.create_subscription(stripe_customer_token: customer.id, plan_name: plan_name)    \r\n    save_credit_card_and_stripe_customer_id(customer, user)    \r\n  end\r\n  \r\n  # Use Case : Guest Checkout\r\n  # Save the stripe response values in our database\r\n  def self.save_credit_card_and_stripe_customer_id(customer, user)\r\n    last4digits = customer.cards.data[0].last4\r\n    expiration_month = customer.cards.data[0].exp_month\r\n    expiration_year = customer.cards.data[0].exp_year\r\n    \r\n    user.save_stripe_customer_id(customer.id)\r\n    user.create_credit_card(last4digits: last4digits, \r\n                            expiration_month: expiration_month, \r\n                            expiration_year: expiration_year)\r\n  end\r\n  \r\n  # Transfer guest user to current user. Happens when guest user registers for an account at the end of guest checkout.\r\n  def self.transfer_guest_user_values_to_registered_user(guest_user, current_user)\r\n    # Bypass transfer for normal user registration. \r\n    if user_registration_after_guest_checkout?(guest_user)\r\n      current_user.save_stripe_customer_id(guest_user.stripe_customer_id)\r\n      current_user.create_credit_card(last4digits: guest_user.credit_card.last4digits, \r\n                                      expiration_month: guest_user.credit_card.expiration_month,  \r\n                                      expiration_year: guest_user.credit_card.expiration_year)\r\n    end\r\n  end\r\n  \r\n  private\r\n  \r\n  # This is true only if someone registers after guest checkout is complete.\r\n  def self.user_registration_after_guest_checkout?(user)\r\n    user && user.credit_card\r\n  end\r\n  \r\nend\r\n```\r\n\r\nComments above the methods make the traceability clear. Some of the methods are used by classes other than use case handler.\r\n\r\nStep 5\r\n-----\r\n\r\nLet\'s cleanup app/actors/customer/subscribe\\_to\\_a\\_plan.rb.\r\n\r\n```ruby\r\nmodule Actors\r\n  module Customer\r\n    module UseCases\r\n      \r\n      def self.subscribe_to_a_plan(user, stripe_token, plan_name)\r\n        customer = StripeGateway.create_subscription(user.email, stripe_token, plan_name)    \r\n        \r\n        StripeCustomer.save_subscription_details(user, customer, plan_name)\r\n      end      \r\n      \r\n    end\r\n  end\r\nend\r\n```\r\n\r\nStep 6\r\n-----\r\n\r\nLet\'s cleanup the app/controller/subscriptions\\_controller.rb.\r\n\r\n```ruby\r\nclass SubscriptionsController < ApplicationController\r\n  def create    \r\n    begin      \r\n      @success = Actors::Customer::UseCases.subscribe_to_a_plan(current_user, \r\n                                                                params[:stripeToken], \r\n                                                                params[:plan_name])    \r\n      @plan_name = params[:plan_name]\r\n    rescue Striped::CreditCardDeclined => e\r\n      redisplay_form(e.message)\r\n    rescue Striped::CreditCardException, Exception => e\r\n      StripeLogger.error e.message\r\n      redisplay_form(\"Subscription failed. We have been notified about this problem.\")\r\n    end\r\n  end\r\nend\r\n```\r\n\r\nStep 7\r\n-----\r\n\r\nAdd a new test for checking the plan name is initialized for display in app/views/subscriptions/create.html.erb page.\r\n\r\n```ruby\r\nrequire \'rails_helper\'\r\n\r\ndescribe SubscriptionsController do\r\n  \r\n  it \'should initialize the plan name to be displayed in create page\' do \r\n    sign_in   \r\n    allow(Actors::Customer::UseCases).to receive(:subscribe_to_a_plan) { true }\r\n\r\n    post :create, { stripeToken: \'1\', plan_name: \'gold\'}\r\n    \r\n    expect(assigns(:plan_name)).to eq(\'gold\')\r\n  end\r\n  \r\nend\r\n```\r\n\r\nYou can download the entire source code for this article using the commit hash 4fce70f from `git@bitbucket.org:bparanj/striped.git`.\r\n\r\nSummary\r\n========\r\n--------\r\n\r\nIn this article we cleaned up the code to make it easier to maintain subscription and update credit card expiration features.','2014-11-21 01:59:26','2016-12-22 20:23:55'),(1341,'Stripe Subscription and Checkout : Test Coverage using SimpleCov','Objective\r\n=========\r\n---------\r\n\r\nTo using SimpleCov to generate test coverage report for Stripe Subscription and Checkout codebase.\r\n\r\nSteps\r\n=====\r\n-----\r\n\r\nStep 1\r\n----\r\n\r\nAdd the simplecov gem to Gemfile.\r\n\r\n```ruby\r\ngroup :test do\r\n  gem \'capybara\'\r\n  gem \'selenium-webdriver\'\r\n  gem \'database_cleaner\'\r\n  gem \'simplecov\', :require => false\r\nend\r\n```\r\n\r\nRun bundle install.\r\n\r\nStep 2\r\n----\r\n\r\nAt the top of spec/spec_helper.rb, add the lines:\r\n\r\n```ruby\r\nrequire \'simplecov\'\r\nSimpleCov.start\r\n```\r\n\r\nStep 3\r\n----\r\n\r\nAdd\r\n\r\n```sh\r\n# :nocov: \r\n```\r\n\r\nto private methods to be excluded from test coverage report.\r\n\r\nStep 4\r\n----\r\n\r\nRun tests with\r\n\r\n```sh\r\n$rake spec:models spec:controllers spec:gateways spec:features\r\n```\r\n\r\nStep 5\r\n----\r\n\r\nView the test coverage report on the browser.\r\n\r\n```sh\r\n$open coverage/index.html\r\n```\r\n\r\nBy reviewing the coverage report, you can see some of the code is not being used anywhere. This dead code can be deleted with confidence. This confidence comes from our integration and unit tests.\r\n\r\nStep 6\r\n----\r\n\r\nMark the private method in app/gateways/stripe_gateway.rb as \r\n\r\n```sh\r\n:nocov: \r\n```\r\n\r\nto exclude from coverage report.\r\n\r\nStep 7\r\n----\r\n\r\nWhy is @error_message variable used in app/views/sales/new.html.erb and app/views/subscriptions/new.html.erb instead of flash error? Because there is a problem with testing flash with RSpec. The error is undefined method `error\' for #<ActionDispatch::Flash::FlashHash.\r\n\r\nStep 8\r\n----\r\n\r\nHow do you test helpers in the app/controllers/application\\_controller.rb that only sub-classes use? Create spec/controllers/application\\_controller\\_spec.rb.\r\n\r\n```ruby\r\nrequire \'rails_helper\'\r\n\r\ndescribe ApplicationController, :type => :controller do\r\n\r\n  it \"GET index returns http success\" do\r\n    user = User.new\r\n    user.save(validate: false)\r\n    sign_in(user)\r\n    \r\n    expect(subject.current_or_guest_user.id).to eq(user.id)\r\n  end\r\nend\r\n```\r\n\r\nThis test is for current\\_or\\_guest\\_user method in application\\_controller.rb.\r\n\r\nStep 9\r\n----\r\n\r\nImprovements and more tests for spec/controllers/subscriptions\\_controller\\_spec.rb.\r\n\r\n```ruby\r\nrequire \'rails_helper\'\r\n\r\ndescribe SubscriptionsController do\r\n  \r\n  it \'should initialize plan name\' do\r\n    get :new, {plan_name: \'gold\'}\r\n    \r\n    expect(assigns(:plan_name)).to eq(\'gold\')\r\n  end\r\n  \r\n  it \'should delegate creating stripe customer to stripe gateway\' do \r\n    sign_in   \r\n    expect(Actors::Customer::UseCases).to receive(:subscribe_to_a_plan) { true }\r\n  \r\n    post :create, { stripeToken: \'1\', plan_name: \'gold\'}\r\n  end\r\n  \r\n  it \'should initialize the plan name to be displayed in create page\' do \r\n    sign_in   \r\n    allow(Actors::Customer::UseCases).to receive(:subscribe_to_a_plan) { true }\r\n  \r\n    post :create, { stripeToken: \'1\', plan_name: \'gold\'}\r\n    \r\n    expect(assigns(:plan_name)).to eq(\'gold\')\r\n  end\r\n  \r\n  it \'should display new page when exception occurs in create action due to credit card decline\' do\r\n    allow(Actors::Customer::UseCases).to receive(:subscribe_to_a_plan) { raise Striped::CreditCardDeclined.new }\r\n    \r\n    post :create\r\n    \r\n    expect(response).to render_template(:new)  \r\n  end\r\n  \r\n  it \'should render the new page when exception occurs\' do\r\n    allow(Actors::Customer::UseCases).to receive(:subscribe_to_a_plan) { raise Exception.new }\r\n    \r\n    post :create\r\n    \r\n    expect(response).to render_template(:new)  \r\n  end\r\n  \r\n  it \'should render the new page when credit card exception occurs\' do\r\n    allow(Actors::Customer::UseCases).to receive(:subscribe_to_a_plan) { raise Striped::CreditCardException.new }\r\n    \r\n    post :create\r\n    \r\n    expect(response).to render_template(:new)  \r\n  end\r\n\r\n  it \'should initialize the error message when credit card exception occurs\' do\r\n    allow(Actors::Customer::UseCases).to receive(:subscribe_to_a_plan) { raise Striped::CreditCardException.new }\r\n    \r\n    post :create\r\n    \r\n    expect(assigns(:error_message)).to eq(\'Subscription failed. We have been notified about this problem.\')\r\n  end\r\n  \r\nend\r\n```\r\n\r\nStep 10\r\n----\r\n\r\nImprovements and more tests for spec/controllers/sales\\_controller\\_spec.rb\r\n\r\n```ruby\r\nrequire \'rails_helper\'\r\n\r\ndescribe SalesController, :type => :controller do\r\n\r\n  it \"returns http success\" do\r\n    get :new\r\n    \r\n    expect(response).to be_success\r\n  end\r\n\r\n  it \'should display download page after one-click checkout\' do \r\n    user = User.new\r\n    user.save(validate: false)\r\n    sign_in(user)\r\n    allow(user).to receive(:has_saved_credit_card?) { true }   \r\n    allow(Actors::Customer::UseCases).to receive(:one_click_checkout) { true }\r\n\r\n    get :new\r\n    \r\n    expect(subject).to redirect_to(download_path)\r\n  end\r\n  \r\n  it \'should render the new page when exception occurs in new action\' do    \r\n    user = User.new\r\n    user.save(validate: false)\r\n    sign_in(user)\r\n    allow(user).to receive(:has_saved_credit_card?) { true }\r\n    allow(Actors::Customer::UseCases).to receive(:one_click_checkout) { raise Striped::CreditCardDeclined.new }\r\n    \r\n    get :new\r\n    \r\n    expect(response).to render_template(:new)  \r\n  end\r\n\r\n  it \'should display new page when exception occurs\' do\r\n    user = User.new\r\n    user.save(validate: false)\r\n    sign_in(user)\r\n    allow(user).to receive(:has_saved_credit_card?) { raise Exception.new }    \r\n    \r\n    get :new\r\n    \r\n    expect(response).to render_template(:new)  \r\n  end\r\n  \r\n  it \'should delegate guest checkout to use case handler\' do \r\n    sign_in   \r\n    expect(Actors::Customer::UseCases).to receive(:guest_checkout) { true }\r\n\r\n    post :create, { stripeToken: \'1\', plan_name: \'gold\'}\r\n  end\r\n\r\n  it \'should render the new page when exception occurs in create action\' do\r\n    allow(Actors::Customer::UseCases).to receive(:guest_checkout) { raise Striped::CreditCardDeclined.new }\r\n    \r\n    post :create\r\n    \r\n    expect(response).to render_template(:new)  \r\n  end\r\n\r\n  it \'should render the new page when exception occurs in create action\' do\r\n    allow(Actors::Customer::UseCases).to receive(:guest_checkout) { raise Exception.new }\r\n    \r\n    post :create\r\n    \r\n    expect(response).to render_template(:new)  \r\n  end\r\n\r\nend\r\n```\r\n\r\nStep 11\r\n----\r\n\r\nCreate app/controllers/stripe\\_controller.rb \r\n\r\n```ruby\r\nclass StripeController < ApplicationController\r\n  protect_from_forgery except: :webhook\r\n  \r\n  SUBSCRIPTION_PAYMENT_FAILED = \"invoice.payment_failed\"\r\n  \r\n  def webhook    \r\n    StripeLogger.info \"Received event with ID: #{params[:id]} Type: #{params[:type]}\"\r\n\r\n    # Retrieving the event from the Stripe API guarantees its authenticity  \r\n    event = Stripe::Event.retrieve(params[:id])\r\n\r\n    if event.type == SUBSCRIPTION_PAYMENT_FAILED\r\n      stripe_customer_token = event.data.object.customer\r\n      Actors::Stripe::UseCases.process_subscription_payment_failure(stripe_customer_token)\r\n    else\r\n      StripeLogger.info \"Webhook received params.inspect. Did not handle this event.\"  \r\n    end  \r\n    \r\n    render text: \"success\"\r\n  end  \r\n  \r\nend\r\n```\r\n\r\nStep 12\r\n----\r\n\r\nCreate an empty stripe.rb in app/actors/stripe folder.\r\n\r\nStep 13\r\n----\r\n\r\nIn app/actors/stripe/stripe.rb\r\n\r\n```ruby \r\n# Stripe System actor\r\nrequire_relative \"#{Rails.root}/app/actors/stripe/use_cases/process_subscription_payment_failure\"\r\n```\r\n\r\nStep 14\r\n----\r\n\r\nLet\'s fix the deprecated warning in app/actors/stripe/use_cases/process\\_subscription\\_payment\\_failure.rb\r\n\r\n```ruby\r\nmodule Actors\r\n  module Stripe\r\n    module UseCases\r\n      \r\n      def self.process_subscription_payment_failure(stripe_customer_token)\r\n        user = User.where(stripe_customer_id: stripe_customer_token).first\r\n\r\n        UserMailer.subscription_payment_failed(user).deliver_now\r\n      end      \r\n      \r\n    end\r\n  end\r\nend\r\n```\r\n\r\nWe are now using deliver_now to deliver the mail. I have also deleted the unused code in this project. You can download the entire source code for this article using the commit hash fa046a3 from `git@bitbucket.org:bparanj/striped.git`.\r\n\r\nIf you get the error \'An SMTP To address is required to send a message. Set the message smtp\\_envelope\\_to, to, cc, or bcc address.\' Add email so that \'to\' address gets set.\r\n\r\nSummary\r\n=======\r\n-------\r\n\r\nIn this article you learned how to use SimpleCov to generate test coverage reports. You also learned some testing tips such as how to test helpers defined in the application controller.','2014-11-21 23:42:55','2016-12-22 20:26:22'),(1351,'Add New Credit Card using Stripe API','Objective\r\n=====\r\n-----\r\n\r\nTo add a new credit card to an existing customer. \r\n\r\nDiscussion\r\n=====\r\n-----\r\n\r\nIn this article we will add a new credit card to an existing customer account. This new credit card will become the default card for one-click checkout and subscription charges.\r\n\r\nSteps\r\n=====\r\n-----\r\n\r\nStep 1\r\n-----\r\n\r\nCreate credit\\_cards/new.html.erb\r\n\r\n```ruby\r\n<form action=\"create\" method=\"POST\" id=\"payment-form\">\r\n  <span class=\"payment-errors\">\r\n  	<noscript>JavaScript is not enabled and is required for this form. First enable it in your web browser settings.</noscript>\r\n	</div>\r\n  </span>\r\n  <% if @error_message %>\r\n	<%= @error_message %>\r\n  <% end %>\r\n\r\n  <%= hidden_field_tag :authenticity_token, form_authenticity_token -%>\r\n\r\n  <div class=\"form-row\">\r\n    <label>\r\n      <span>Card Number</span>\r\n      <input type=\"text\" size=\"20\" data-stripe=\"number\"/>\r\n    </label>\r\n  </div>\r\n\r\n  <div class=\"form-row\">\r\n    <label>\r\n      <span>Expiration</span>\r\n<%= select_month nil, {add_month_numbers: true}, {name: nil, id: \"card_month\", data: {stripe: \"exp-month\"}} %>\r\n\r\n    </label>\r\n    <span>/</span>\r\n	<%= select_year nil, {start_year: Date.today.year, end_year: Date.today.year+15}, {name: nil, id: \"card_year\", data: {stripe: \"exp-year\"}} %>\r\n\r\n  </div>\r\n\r\n  <button type=\"submit\">Add Credit Card</button>\r\n</form>\r\n```\r\n\r\nWe are using the same form we have used before to capture credit card details.\r\n\r\nStep 2\r\n-----\r\n\r\nCreate app/views/credit\\_cards/create.html.erb\r\n\r\n```ruby\r\nYour credit card ending in last 4 digits <%= @card.last4digits %> has been added.\r\n```\r\n\r\nStep 3\r\n-----\r\n\r\nCreate app/controllers/credit\\_cards\\_controller.rb.\r\n\r\n```ruby\r\nclass CreditCardsController < ApplicationController\r\n  layout \'stripe\'\r\n  before_action :authenticate_user!\r\n  \r\n  def new\r\n  end\r\n  \r\n  def create\r\n    begin\r\n      @card = Actors::Customer::UseCases.add_new_credit_card(current_user, params[:stripeToken])\r\n    rescue Exception => e\r\n      StripeLogger.error \"Add new credit card failed due to #{e.message}. #{e.backtrace.join(\"\\n\")}\"\r\n      redisplay_form(\"Add new credit card failed. We have been notified about this problem.\")\r\n    end\r\n  end\r\n  \r\nend\r\n```\r\n\r\nThe create action delegates adding a new credit card to use case handler. \r\n\r\nStep 4\r\n-----\r\n\r\nCreate app/actors/customer/use\\_cases/add\\_new\\_credit\\_card.rb\r\n\r\n```ruby\r\nmodule Actors\r\n  module Customer\r\n    module UseCases\r\n      \r\n      def self.add_new_credit_card(user, stripe_token)\r\n        card = StripeGateway.add_new_credit_card(user.stripe_customer_id, stripe_token)\r\n              \r\n        # Update our database with last 4 digits, expiration date and month.          \r\n        StripeCustomer.save_credit_card_details(card, user)\r\n		card\r\n      end      \r\n      \r\n    end\r\n  end\r\nend\r\n```\r\n\r\nStep 5\r\n-----\r\n\r\nAdd the add\\_new\\_credit\\_card use case handler in app/actors/customer/customer.rb.\r\n\r\n```ruby\r\nrequire_relative \"#{Rails.root}/app/actors/customer/use_cases/add_new_credit_card\"\r\n```\r\n\r\nStep 6\r\n-----\r\n\r\nAdd a new method to app/gateways/stripe\\_gateway.rb\r\n\r\n```ruby\r\ndef self.add_new_credit_card(stripe_customer_id, stripe_token)\r\n  run_with_stripe_exception_handler(\'Add a new credit card failed due to\') do\r\n    customer = Stripe::Customer.retrieve(stripe_customer_id)\r\n    card = customer.cards.create(card: stripe_token)\r\n    card.save\r\n    customer.default_card = card.id\r\n    customer.save\r\n    card\r\n  end\r\nend\r\n```\r\n\r\nThe Stripe API is complicated for adding a new credit card to an existing customer. I decided to let the test hit the real Stripe servers for testing to avoid stubbing mess. This is shown in step 14.\r\n\r\nStep 7\r\n-----\r\n\r\nAdd a new method to app/models/stripe\\_customer.rb\r\n\r\n```ruby\r\n# Use Case : Add New Credit Card\r\ndef self.save_credit_card_details(card, user)\r\n  user.save_credit_card_details(card.last4, card.exp_month, card.exp_year)\r\nend\r\n```\r\n\r\nThe mapping of external Stripe fields related to credit card to credit card fields in our database is done by stripe\\_customer.rb.\r\n\r\nStep 8\r\n-----\r\n\r\nAdd a new method to user.rb.\r\n\r\n```ruby\r\ndef save_credit_card_details(last4digits, expiration_month, expiration_year)\r\n  self.credit_card.save_credit_card_details(last4digits, expiration_month, expiration_year)\r\nend\r\n```\r\n\r\nStep 9\r\n-----\r\n\r\nAdd the new method to credit\\_card.rb.\r\n\r\n```ruby\r\ndef save_credit_card_details(last4digits, expiration_month, expiration_year)\r\n  self.last4digits = last4digits\r\n  self.expiration_month = expiration_month\r\n  self.expiration_year = expiration_year\r\n  self.save!\r\nend\r\n```\r\n\r\nStep 10\r\n-----\r\n\r\nChange config/routes.rb.\r\n\r\n```ruby\r\nget \'credit_cards/new\'\r\npost \'credit_cards/create\'\r\n```\r\n\r\nStep 11\r\n--------\r\n\r\nCreate app/actors/customer/use_cases/add\\_new\\_credit\\_card.rb\r\n\r\n```ruby\r\nmodule Actors\r\n  module Customer\r\n    module UseCases\r\n      \r\n      def self.add_new_credit_card(user, stripe_token)\r\n        card = StripeGateway.add_new_credit_card(user.stripe_customer_id, stripe_token)\r\n              \r\n        # Update our database with last 4 digits, expiration date and month.          \r\n        StripeCustomer.save_credit_card_details(card, user)\r\n        card\r\n      end      \r\n      \r\n    end\r\n  end\r\nend\r\n```\r\n\r\nThe use case handler delegates adding new credit card on Stripe server to StripeGateway class. It also delegates saving the credit card details in our database to StripeCustomer class. \r\n\r\nStep 12\r\n--------\r\n\r\nCreate spec/actors/customer/use_cases/add\\_new\\_credit\\_card\\_spec.rb.\r\n\r\n```ruby\r\nrequire \'rails_helper\'\r\n\r\ndescribe \'Add new credit card\' do\r\n  \r\n  it \'should delegate add a new card to stripe gateway class\' do\r\n    user = double(\'User\')\r\n    allow(user).to receive(:stripe_customer_id) { 1 }\r\n    allow(StripeCustomer).to receive(:save_credit_card_details)\r\n\r\n    expect(StripeGateway).to receive(:add_new_credit_card)\r\n\r\n    Actors::Customer::UseCases.add_new_credit_card(user, \'stripe-token\')\r\n  end\r\n\r\n  it \'should delegate saving credit card details to stripe customer class\' do\r\n    user = double(\'User\')\r\n    allow(user).to receive(:stripe_customer_id) { 1 }\r\n    allow(StripeGateway).to receive(:add_new_credit_card)\r\n\r\n    expect(StripeCustomer).to receive(:save_credit_card_details)\r\n    \r\n    Actors::Customer::UseCases.add_new_credit_card(user, \'stripe-token\')\r\n  end\r\n  \r\nend\r\n```\r\n\r\nStep 13\r\n--------\r\n\r\nCreate spec/gateways/stripe\\_gateway\\_spec.rb.\r\n\r\n```ruby\r\nit \'adds a new credit card as the active default card on Stripe server\' do\r\n  token = Stripe::Token.create(:card => {\r\n                                 :number    => \"4242424242424242\",\r\n                                 :exp_month => 11,\r\n                                 :exp_year  => 2025,\r\n                                 :cvc       => \"314\"})\r\n      \r\n  customer = Stripe::Customer.create(:card => token.id, :description => \"stripe-gateway-test@example.com\")\r\n\r\n  new_token = Stripe::Token.create(:card => {\r\n                                     :number => \"4012888888881881\",\r\n                                     :exp_month => 10,\r\n                                     :exp_year => 2035,\r\n                                     :cvc => \"123\"})\r\n  \r\n  card = StripeGateway.add_new_credit_card(customer.id, new_token.id)\r\n  expect(card).to be_instance_of(Stripe::Card)\r\nend\r\n```\r\n\r\nStep 14\r\n--------\r\n\r\nCreate spec/models/credit\\_card\\_spec.rb\r\n\r\n```ruby\r\nrequire \'rails_helper\'\r\n\r\ndescribe CreditCard, :type => :model do\r\n  it \'saves credit card details\' do\r\n    cc = CreditCard.new\r\n    cc.save_credit_card_details(\'1234\', 2, 2020)\r\n    \r\n    expect(cc.last4digits).to eq(\'1234\')\r\n    expect(cc.expiration_month).to eq(2)\r\n    expect(cc.expiration_year).to eq(2020)\r\n  end\r\nend\r\n```\r\n\r\nStep 15\r\n----\r\n\r\nAdd the controller test for adding a new credit card to spec/controllers/credit\\_cards\\_controller\\_spec.rb.\r\n\r\n```ruby\r\nit \'should delegate adding a new credit card to use case handler\' do\r\n  User.create(email: \'bugs@disney.com\', password: \'12345678\')\r\n  user = User.last\r\n  sign_in(user)   \r\n  \r\n  expect(Actors::Customer::UseCases).to receive(:add_new_credit_card)    \r\n  \r\n  post :create, {stripeToken: 1}\r\nend\r\n```\r\n\r\nStep 16\r\n-----\r\n\r\nLet\'s fix the deprecated warning: \r\n\r\n```sh\r\n`named_routes.helpers` is deprecated, please use `route_defined?(route_name)` to see if a named route was defined.\r\n```\r\n\r\nUpdate the rspec-rails to 3.1. Change the version in Gemfile.\r\n\r\n```ruby\r\ngroup :development, :test do\r\n  gem \'rspec-rails\', \'~> 3.1\'\r\nend\r\n```\r\n\r\nRun bundle install.\r\n\r\nStep 17\r\n-----\r\n\r\nYou can use the following test credit cards for testing.\r\n\r\n4242424242424242    Visa\r\n4012888888881881    Visa\r\n5555555555554444	MasterCard\r\n378282246310005		American Express\r\n371449635398431		American Express\r\n6011111111111117	Discover\r\n6011000990139424	Discover\r\n30569309025904		Diners Club\r\n38520000023237		Diners Club\r\n3530111333300000	JCB\r\n3566002020360505	JCB\r\n\r\nYou can download the entire source code for this article using the commit hash a3e98ce from `git@bitbucket.org:bparanj/striped.git`.\r\n \r\nSummary\r\n=======\r\n-------\r\n\r\nIn this article, we developed a new feature to allow users to add a new credit to be used for all purchases and subscription charges.','2014-11-23 22:56:58','2016-12-22 20:29:35'),(1361,'Stripe Webhook Testing in Development','Objective\r\n==========\r\n----------\r\n\r\nLearn how to test Stripe webhook in development.\r\n\r\nSteps\r\n======\r\n------\r\n\r\nStep 1\r\n-----\r\n\r\nSignup for [UltraHook](http://www.ultrahook.com/register \'UltraHook\')\r\n\r\nRemember the Webhook Namespace field that you use when you signup. You need to plugin that value to the following endpoints:\r\n\r\n```sh\r\nhttp://github.namespace.ultrahook.com\r\nhttp://stripe.namespace.ultrahook.com\r\n```\r\n\r\nStep 2\r\n-----\r\n\r\nSave the API Key:\r\n\r\n```sh\r\necho \'api_key: kwqoZcQ29d1N7wqIfyYepxIbT5ovtjWs\' > ~/.ultrahook \r\n```\r\n\r\nStep 3\r\n-----\r\n\r\nInstall ultrahook. Add ultrahook to development group in Gemfile.\r\n\r\n```sh\r\ngem install ultrahook\r\n```\r\n\r\nStep 4\r\n----\r\n\r\nRegister your Webhook endpoint with Stripe. Go to your Stripe account, Account Settings -> Webhooks. Enter:\r\n\r\n```sh\r\nhttp://stripe.namespace.ultrahook.com\r\n```\r\n\r\nin the URL field. Remember to replace the namespace with your namespace that you used when you signed up for ultrahook. Leave the drop-down box with \'Test\' as it is and click \'Create Webhook URL\'.\r\n\r\nStep 5\r\n----\r\n\r\nTo forward requests from:\r\n\r\nhttp://stripe.YOUR-NAMESPACE.ultrahook.com --> http://localhost:3000/stripe-webhooks \r\n\r\nIn a terminal, run:\r\n\r\n```ruby\r\nultrahook stripe http://localhost:3000/stripe-webhooks\r\n``` \r\n\r\nSending Email Reminders to Customers\r\n==============\r\n--------------\r\n\r\nLet\'s jot down the sequence of steps required to send email reminder to customers if their credit card is about to expire.\r\n\r\n```ruby\r\ndesc \'Send email reminder to customers if credit card is about to expire\'\r\nnamespace :stripe do\r\n\r\n  task :cc_expiration_reminder => :environment do\r\n    1. Get all credit cards for this year\r\n    2. Create expiration date from credit_cards table for each credit card\r\n      > expiration_date = DateTime.new(2014, 12,1)\r\n        => Mon, 01 Dec 2014 00:00:00 +0000 \r\n    3. today = DateTime.now\r\n    	 => Sun, 23 Nov 2014 23:42:40 -0800 \r\n    4. checker = today + 30.days\r\n    	 => Tue, 23 Dec 2014 23:42:40 -0800 \r\n    5. Check if the credit card is about to expire\r\n       if checker > expiration_date\r\n         user = User.where(user_id: credit_card.user_id).first\r\n         # Send an email reminder to update credit card expiration date.\r\n         UserMailer.subscription_payment_failed(user).deliver_now\r\n         # TODO : Mark reminder email sent to avoid sending emails everyday.\r\n       end\r\n  end\r\n\r\nend\r\n```\r\n\r\nAfter some rearranging of the steps, here is the rake task.\r\n\r\n```ruby\r\ndesc \'Send email reminder to customers if credit card is about to expire\'\r\nnamespace :stripe do\r\n\r\n  task :cc_expiration_reminder => :environment do\r\n    today = DateTime.now\r\n    checker = today + 30.days\r\n    \r\n    cards = CreditCard.where(expiration_year: Date.today.year)\r\n    cards.each do |card|\r\n      # Assume 1, since we don\'t capture the day.\r\n      expiration_date = DateTime.new(card.expiration_year, card.expiration_month, 1)  \r\n      if checker > expiration_date\r\n        user = User.where(user_id: card.user_id).first\r\n        # Send an email reminder to update credit card expiration date. The message is same as subscription payment failed.\r\n        UserMailer.subscription_payment_failed(user).deliver_now\r\n        # TODO : Mark reminder email has been sent to avoid sending emails everyday to the same user.\r\n      else\r\n        puts \"Card : #{card.inspect} is not about to expire\"\r\n        puts \"Expiration date is : #{expiration_date}\"\r\n        puts \"Checker is : #{checker}\"\r\n      end\r\n    end\r\n  end\r\n\r\nend\r\n```\r\n\r\nYou can add reminder\\_email\\_sent and reminder\\_email\\_sent\\_date to credit\\_cards table to avoid sending emails every time the rake task is run. Thanks to the author of Ultrahook, Vinay Sahni for his feedback.\r\n\r\nReferences\r\n===========\r\n-----------\r\n\r\n[How to listen to Stripe webhooks and use them in your dev environment](http://blog.crowdint.com/2014/04/11/how-to-listen-to-stripe-webhooks-and-use-them-in-your-dev-environment.html \'How to listen to Stripe webhooks and use them in your dev environment\')\r\n[Stripe Webhooks](https://stripe.com/docs/webhooks \'Webhooks\')\r\n[How to Respond to Appropriate Stripe.com ‘events’](http://imzank.com/2012/11/how-to-use-stripe-com-to-email-your-customers/ \'How to Respond to Appropriate Stripe.com ‘events’\')\r\n[Email Receipts](https://stripe.com/blog/email-receipts \'Email Receipts\')\r\n[The Stripe Webhook Event Cheatsheet](https://www.petekeen.net/stripe-webhook-event-cheatsheet \'The Stripe Webhook Event Cheatsheet\')','2014-11-23 23:47:00','2016-12-22 20:31:14'),(1371,'Integrating Twitter Bootstrap 3.3 with Rails 4.2 ','If you want to learn how to integrate Twitter Bootstrap 4 with Rails 5, check out the [Integrating Twitter Bootstrap 4 with Rails 5](https://rubyplus.com/articles/3981-Integrating-Twitter-Bootstrap-4-with-Rails-5 \'Integrating Twitter Bootstrap 4 with Rails 5\').\r\n\r\nObjective\r\n=========\r\n---------\r\n\r\nTo learn how to integrate Twitter Bootstrap 3.3 with Rails 4.2. \r\n\r\nSteps\r\n=====\r\n-----\r\n\r\nStep 1\r\n------\r\n\r\n```ruby\r\ngem \'bootstrap-sass\', \'~> 3.3.1\'\r\n```\r\n\r\nIf you skip this step, you will get the error: File to import not found or unreadable: bootstrap-sprockets. Rails 4.2 automatically adds the sass-rails gem to the Gemfile.\r\n\r\n```ruby\r\ngem \'sass-rails\', github: \'rails/sass-rails\'\r\n```\r\n\r\nStep 2\r\n------\r\n\r\nIt is also recommended to use [Autoprefixer](https://github.com/ai/autoprefixer-rails) with Bootstrap to add browser vendor prefixes automatically. Simply add the gem:\r\n\r\n```ruby\r\ngem \'autoprefixer-rails\'\r\n```\r\n\r\nto Gemfile.\r\n\r\nStep 3\r\n------\r\n\r\nRun `bundle install` and restart your server to make the files available through the asset pipeline.\r\n\r\nStep 4\r\n-------\r\n\r\nImport Bootstrap styles in `app/assets/stylesheets/application.css.scss`:\r\n\r\n```scss\r\n// \"bootstrap-sprockets\" must be imported before \"bootstrap\" and \"bootstrap/variables\"\r\n@import \"bootstrap-sprockets\";\r\n@import \"bootstrap\";\r\n```\r\n\r\n`bootstrap-sprockets` must be imported before `bootstrap` for the icon fonts to work.\r\n\r\nStep 5\r\n------\r\n\r\nMake sure the file has `.css.scss` extension for Sass syntax. If you have just generated a new Rails app, it may come with a `.css` file instead. If this file exists, it will be served instead of Sass, so rename the `app/assets/stylesheets/application.css` to `app/assets/stylesheets/application.css.scss`.\r\n\r\nStep 6\r\n------\r\n\r\nRequire Bootstrap Javascripts in `app/assets/javascripts/application.js`:\r\n\r\n```js\r\n//= require jquery\r\n//= require bootstrap-sprockets\r\n//= require jquery_ujs\r\n//= require turbolinks\r\n//= require_tree .\r\n```\r\n\r\nStep 7\r\n--------\r\n\r\nBootstrap makes use of certain HTML elements and CSS properties that require the use of the HTML5 doctype. Include it at the beginning of all the layout files and any views that has html tag.\r\n\r\n```html\r\n<!DOCTYPE html>\r\n<html lang=\'en\'>\r\n\r\n</html>\r\n```\r\n\r\nUpdate the application.html.erb with the minimal Bootstrap document.\r\n\r\n```ruby\r\n<!DOCTYPE html>\r\n<html lang=\"en\">\r\n  <head>\r\n	<meta charset=\"utf-8\">\r\n    <meta http-equiv=\"X-UA-Compatible\" content=\"IE=edge\">\r\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1\">\r\n	<title>Striped</title>\r\n	<%= stylesheet_link_tag    \'application\', media: \'all\', \'data-turbolinks-track\' => true %>\r\n	<%= javascript_include_tag \'application\', \'data-turbolinks-track\' => true %>\r\n  \r\n	<%= javascript_include_tag \'https://js.stripe.com/v2/\' %>\r\n  \r\n	<%= csrf_meta_tags %>\r\n	<!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->\r\n    <!-- WARNING: Respond.js doesn\'t work if you view the page via file:// -->\r\n    <!--[if lt IE 9]>\r\n      <script src=\"https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js\"></script>\r\n      <script src=\"https://oss.maxcdn.com/respond/1.4.2/respond.min.js\"></script>\r\n    <![endif]-->\r\n  </head>\r\n  <body>\r\n	<p class=\"notice\"><%= notice %></p>\r\n    <p class=\"alert\"><%= alert %></p>\r\n    \r\n    <h1>Hello, Twitter Bootstrap</h1>\r\n	<ul class=\"hmenu\">\r\n	  <%= render \'devise/menu/registration_items\' %>\r\n	  <%= render \'devise/menu/login_items\' %>\r\n	</ul>\r\n\r\n	<%= yield %>\r\n	\r\n  </body>\r\n</html>\r\n```\r\n\r\nStep 8\r\n------\r\n\r\nStart the rails server and go to the welcome page. You should see \'Hello, Twitter Bootstrap\'.\r\n\r\nStep 9\r\n-------\r\n\r\nCreate `app/views/shared/_navigation_bar.html.erb`.\r\n\r\n```html\r\n<nav class=\"navbar navbar-default\" role=\"navigation\">\r\n  <div class=\"container-fluid\">\r\n    <!-- Brand and toggle get grouped for better mobile display -->\r\n    <div class=\"navbar-header\">\r\n      <button type=\"button\" class=\"navbar-toggle collapsed\" data-toggle=\"collapse\" data-target=\"#bs-example-navbar-collapse-1\">\r\n        <span class=\"sr-only\">Toggle navigation</span>\r\n        <span class=\"icon-bar\"></span>\r\n        <span class=\"icon-bar\"></span>\r\n        <span class=\"icon-bar\"></span>\r\n      </button>\r\n      <a class=\"navbar-brand\" href=\"#\">Brand</a>\r\n    </div>\r\n\r\n    <!-- Collect the nav links, forms, and other content for toggling -->\r\n    <div class=\"collapse navbar-collapse\" id=\"bs-example-navbar-collapse-1\">\r\n      <ul class=\"nav navbar-nav\">\r\n        <li class=\"active\"><a href=\"#\">Link <span class=\"sr-only\">(current)</span></a></li>\r\n        <li><a href=\"#\">Link</a></li>\r\n        <li class=\"dropdown\">\r\n          <a href=\"#\" class=\"dropdown-toggle\" data-toggle=\"dropdown\" role=\"button\" aria-expanded=\"false\">Dropdown <span class=\"caret\"></span></a>\r\n          <ul class=\"dropdown-menu\" role=\"menu\">\r\n            <li><a href=\"#\">Action</a></li>\r\n            <li><a href=\"#\">Another action</a></li>\r\n            <li><a href=\"#\">Something else here</a></li>\r\n            <li class=\"divider\"></li>\r\n            <li><a href=\"#\">Separated link</a></li>\r\n            <li class=\"divider\"></li>\r\n            <li><a href=\"#\">One more separated link</a></li>\r\n          </ul>\r\n        </li>\r\n      </ul>\r\n      <form class=\"navbar-form navbar-left\" role=\"search\">\r\n        <div class=\"form-group\">\r\n          <input type=\"text\" class=\"form-control\" placeholder=\"Search\">\r\n        </div>\r\n        <button type=\"submit\" class=\"btn btn-default\">Submit</button>\r\n      </form>\r\n      <ul class=\"nav navbar-nav navbar-right\">\r\n        <li><a href=\"#\">Link</a></li>\r\n        <li class=\"dropdown\">\r\n          <a href=\"#\" class=\"dropdown-toggle\" data-toggle=\"dropdown\" role=\"button\" aria-expanded=\"false\">Dropdown <span class=\"caret\"></span></a>\r\n          <ul class=\"dropdown-menu\" role=\"menu\">\r\n            <li><a href=\"#\">Action</a></li>\r\n            <li><a href=\"#\">Another action</a></li>\r\n            <li><a href=\"#\">Something else here</a></li>\r\n            <li class=\"divider\"></li>\r\n            <li><a href=\"#\">Separated link</a></li>\r\n          </ul>\r\n        </li>\r\n      </ul>\r\n    </div><!-- /.navbar-collapse -->\r\n  </div><!-- /.container-fluid -->\r\n</nav>\r\n```\r\n\r\nThis is copied from Twitter Bootstrap 3.3 Documentation.\r\n\r\nStep 10\r\n-------\r\n\r\nAdd `<%= render \'shared/navigation_bar\' %>` to the app/views/application.html.erb. The navigation bar has a gap at the top. Let\'s fix it now. Add `navbar-fixed-top` to the nav class.\r\n\r\n```html\r\n<nav class=\"navbar navbar-default navbar-fixed-top\" role=\"navigation\">\r\n```\r\n\r\nReload the page and the navigation bar will now stay at the top.\r\n\r\nStep 11\r\n-------\r\n\r\nLet\'s add the Login and Logout links to the navigation.\r\n\r\n```ruby\r\n<div class=\"collapse navbar-collapse\" id=\"bs-example-navbar-collapse-1\">\r\n  <ul class=\"nav navbar-nav\">\r\n	<% if user_signed_in? %>\r\n	  <li class=\'active\'>\r\n	  	<%= link_to(\'Logout\', destroy_user_session_path, :method => :delete) %>        \r\n	  </li>\r\n	<% else %>\r\n	  <li class=\'active\'>\r\n	  <%= link_to(\'Login\', new_user_session_path)  %>  \r\n	  </li>\r\n	<% end %>\r\n\r\n</div>\r\n```\r\n\r\nDelete the `app/views/devise/menu/_login_items.html.erb` file. Reload the browser, the first link after the brand will be Logout if you are already logged in otherwise it will be Login.\r\n\r\nStep 12\r\n-------\r\n\r\nThe main content for the page has no gap to the left. Let\'s fix it now. Edit the application.html.erb file to wrap the `yield` with `div` tag with class container. This class is provided by the Twitter Bootstrap 3.3.\r\n\r\n```ruby\r\n<div class=\'container\'>\r\n	<%= yield %>\r\n</div>\r\n```\r\n\r\nReload the page, now the main content will be displayed with a gap at the left of the browser.\r\n\r\nStep 13\r\n-------\r\n\r\nLet\'s add the Register and Edit Registration link to the navigation bar. Change the application.html.erb.\r\n\r\n```ruby\r\n<div class=\"collapse navbar-collapse\" id=\"bs-example-navbar-collapse-1\">\r\n  <ul class=\"nav navbar-nav\">\r\n	<% if user_signed_in? %>\r\n	  <li class=\'active\'>\r\n	  	<%= link_to(\'Logout\', destroy_user_session_path, :method => :delete) %>        \r\n	  </li>\r\n	  <li>\r\n	  	<%= link_to(\'Edit Registration\', edit_user_registration_path) %>\r\n	  </li>\r\n	<% else %>\r\n	  <li class=\'active\'>\r\n	  <%= link_to(\'Login\', new_user_session_path)  %>  \r\n	  </li>\r\n	  <li>\r\n	  <%= link_to(\'Register\', new_user_registration_path)  %>\r\n	  </li>\r\n	<% end %>\r\n```\r\n\r\nReload the page on the browser, you will now see the link Register next to Login if you are not logged in otherwise Edit Registration after Logout. You can delete the `app/views/devise/_registration_items.html.erb` file.\r\n\r\nStep 14\r\n--------\r\n\r\nLet\'s change the button to use Twitter Bootstrap button for login page. Edit the app/views/devise/sessions/new.html.erb.\r\n\r\n```ruby\r\n<div class=\"actions\">\r\n  <%= f.submit \"Log in\", class: \'btn btn-primary\' %>\r\n</div>\r\n```\r\n\r\nClick on the Login in the navigation. You will now see a blue button for login.\r\n\r\nStep 15\r\n--------\r\n\r\nLet\'s highlight the tab that is selected in the navigation bar. Create a `nav_link` helper in `application_helper.rb`.\r\n\r\n```ruby\r\nmodule ApplicationHelper\r\n  def nav_link(link_text, link_path, http_method=nil)\r\n    class_name = current_page?(link_path) ? \'active\' : \'\'\r\n\r\n    content_tag(:li, class: class_name) do\r\n      if http_method\r\n        link_to(link_text, link_path, method: http_method)\r\n      else\r\n        link_to(link_text, link_path)\r\n      end\r\n    end\r\n  end\r\nend\r\n```\r\n\r\nStep 16\r\n--------\r\n\r\nChange the navigation bar in `app/views/shared/_navigation_bar.html.erb`.\r\n\r\n```ruby\r\n<div class=\"collapse navbar-collapse\" id=\"bs-example-navbar-collapse-1\">\r\n  <ul class=\"nav navbar-nav\">\r\n	<%= nav_link \'Home\', root_path %>		  \r\n	\r\n	<% if user_signed_in? %>\r\n	  <%= nav_link \'Logout\', destroy_user_session_path, :delete %>\r\n	  <%= nav_link \'Edit Registration\', edit_user_registration_path %>		  \r\n	<% else %>\r\n	  <%= nav_link \'Login\', new_user_session_path %>\r\n	  <%= nav_link \'Register\', new_user_registration_path %>\r\n	<% end %>\r\n```\r\n\r\n\r\nAll the views are now styled to use Twitter Bootstrap 3 button. You can download the entire source code for this article using the commit hash 422aa79 from `git@bitbucket.org:bparanj/striped.git`. You can refer the Rails Guides on [Layouts and Rendering in Rails](http://guides.rubyonrails.org/layouts_and_rendering.html \'Layouts and Rendering in Rails\') to learn more.\r\n\r\nSummary\r\n=======\r\n-------\r\n\r\nIn this article, we styled our Rails 4.2 Striped project using Twitter Bootstrap 3.3. We centered the main content for the site and customized the navigation bar.\r\n\r\nReferences\r\n===========\r\n-----------\r\n\r\n[Best way to add current class to nav in Rails 3](http://stackoverflow.com/questions/3705898/best-way-to-add-current-class-to-nav-in-rails-3 \'Best way to add current class to nav in Rails\')\r\n[Official Sass port of Twitter Bootstrap](https://github.com/twbs/bootstrap-sass \'Official Sass port of Twitter Bootstrap\')\r\n[Twitter Bootstrap 3.3 Documentation](http://getbootstrap.com/css/#buttons \'Twitter Bootstrap 3.3 Documentation\')\r\n[Using Bootstrap with Rails 3](http://rvg.me/2013/11/using-bootstrap-3-with-rails-4/ \'Using Bootstrap with Rails 3\')\r\n[Integrating Rails and Bootstrap Part 1](http://www.gotealeaf.com/blog/integrating-rails-and-bootstrap-part-1 \'\' )\r\n[Using Twitter Bootstrap 3 with Rails](https://www.youtube.com/watch?v=oq-HNuxFPdE \'Using Twitter Bootstrap 3 with Rails\')\r\n[Twitter Bootstrap 3 in a Rails 4 application](http://www.erikminkel.com/2013/09/01/twitter-bootstrap-3-in-a-rails-4-application/ \'Twitter Bootstrap 3 in a Rails 4 application\')','2014-11-26 01:58:50','2016-12-22 20:32:15'),(1381,'Free Themes for Twitter Bootstrap using Bootswatch','Objective\r\n==========\r\n----------\r\n\r\nTo learn how to change the theme using Bootswatch\r\n\r\nDiscussion\r\n=========\r\n----------------\r\n\r\nWe will continue working on the Striped project to learn how to use Bootswatch.\r\n\r\nSteps\r\n=====\r\n-----\r\n\r\nStep 1\r\n-----\r\n\r\nAdd this line to your application\'s Gemfile:\r\n\r\n```ruby\r\ngem \'bootswatch-rails\'\r\n```\r\n\r\nStep 2\r\n-----\r\n\r\nExecute:\r\n\r\n```sh\r\n$bundle\r\n```\r\n\r\nStep 3\r\n-----\r\n\r\nChange application.css.scss:\r\n\r\n```ruby\r\n// First import cerulean variables\r\n@import \"bootswatch/cerulean/variables\";\r\n// \"bootstrap-sprockets\" must be imported before \"bootstrap\" and \"bootstrap/variables\"\r\n@import \"bootstrap-sprockets\";\r\n@import \"bootstrap\";\r\n// Bootstrap body padding for fixed navbar\r\nbody { padding-top: 60px; }\r\n\r\n// And finally bootswatch style itself\r\n@import \"bootswatch/cerulean/bootswatch\";\r\n```\r\n\r\nProblem: If you get the error `Sass::SyntaxError: File to import not found or unreadable: bootswatch/cerulean/variables.` The fix : Do not add the bootswatch-rails to assets group. It is not part of any group. If you still have the same problem, restart the server.\r\n\r\nStep 4\r\n-----\r\n\r\nLet\'s make the form pretty. Let\'s copy the html for [cerulean theme](http://bootswatch.com/cerulean/ \'cerulean\') and change our registration form in app/views/devise/registrations/new.html.erb as follows:\r\n\r\n```ruby\r\n<%= devise_error_messages! %>\r\n\r\n<%= form_for(resource, as: resource_name, url: registration_path(resource_name), html: { class: \'form-horizontal\' }) do |f| %>\r\n  <fieldset>\r\n	<legend>Signup</legend>\r\n        \r\n  <div class=\"form-group\">\r\n    <%= f.label :email, class: \'col-lg-2 control-label\' %>\r\n    <div class=\"col-lg-4\">\r\n      <%= f.email_field :email, autofocus: true, size: 10, class: \"form-control\" %>\r\n    </div>\r\n  </div>\r\n\r\n  <div class=\"form-group\">\r\n    <%= f.label :password, class: \'col-lg-2 control-label\' %>\r\n    <div class=\"col-lg-4\">\r\n      <%= f.password_field :password, autocomplete: \"off\", size: 25, class: \"form-control\" %> <em>(8 characters minimum)</em>\r\n	</div>\r\n  </div>\r\n\r\n  <div class=\"form-group\">\r\n    <div class=\"col-lg-10 col-lg-offset-2\">\r\n	  <%= f.submit \"Sign Up\", class: \'btn btn-primary\' %>	\r\n    </div>\r\n  </div>\r\n\r\n  </fieldset>\r\n<% end %>\r\n```\r\n\r\nYou can read the [Bootstrap CSS docs](http://getbootstrap.com/css/ \'\') for more details on the classes I have customized from the cerulean theme.\r\n\r\nStep 5\r\n-----\r\n\r\nTo change the theme replace the \'cerulean\' with the new theme name in application.css.scss file. For example, to use spacelab theme:\r\n\r\n```ruby\r\n// First import spacelab variables\r\n@import \"bootswatch/spacelab/variables\";\r\n// \"bootstrap-sprockets\" must be imported before \"bootstrap\" and \"bootstrap/variables\"\r\n@import \"bootstrap-sprockets\";\r\n@import \"bootstrap\";\r\n// And finally bootswatch style itself\r\n@import \"bootswatch/spacelab/bootswatch\";\r\n```\r\n\r\nReload the browser to see the new theme. You can download the entire source code for this article using the commit hash 5a874cf from `git@bitbucket.org:bparanj/striped.git`.\r\n\r\n\r\nSummary\r\n==========\r\n----------\r\n\r\nIn this article, we customized the theme of our site using Bootswatch themes. It is easy to switch to a new theme by importing the desired theme in application stylesheet file.\r\n\r\nReferences\r\n==========\r\n----------\r\n\r\n[Bootswatches converted to SCSS ready to use in Rails asset pipeline.](https://github.com/maxim/bootswatch-rails \'Bootswatches converted to SCSS ready to use in Rails asset pipeline.\')\r\n[Bootswatche Spacelab Theme](http://bootswatch.com/spacelab/ \'Bootswatche Spacelab Theme\')','2014-11-27 00:57:03','2016-12-22 20:32:49'),(1391,'Stripe API : Tracking Payments','Objectives\r\n=========\r\n---------\r\n\r\n- To track payments for a given customer. \r\n- To refactor and cleanup the code and tests.\r\n\r\nSteps\r\n=====\r\n-----\r\n\r\nStep 1\r\n-----\r\n\r\nThe libv8 and therubyracer gems installation is a hassle on Mac. Install Nodejs instead. Remove the following gems from the Gemfile.\r\n\r\n```ruby\r\ngem \'libv8\', \'3.16.14.7\'\r\ngem \'therubyracer\', \'~> 0.12.0\'\r\n```\r\n\r\nStep 2\r\n-----\r\n\r\nLet\'s create a payment model to keep track of purchases for a customer.\r\n\r\n```sh\r\nrails g migration payment user_id:integer product_id:integer receipt_number:string\r\n```\r\n\r\nChange the migration file.\r\n\r\n```ruby\r\nclass CreatePayments < ActiveRecord::Migration\r\n  def change\r\n    create_table :payments do |t|\r\n      t.integer :user_id\r\n      t.integer :product_id\r\n      t.string :receipt_number\r\n      t.decimal  :amount, precision: 5, scale: 2\r\n\r\n      t.timestamps null: false\r\n    end\r\n  end\r\nend\r\n```\r\n\r\nThe receipt\\_number will allow processing refunds later.\r\n\r\nStep 3\r\n-----\r\n\r\nDeclare the relationship in app/models/user.rb.\r\n\r\n```ruby\r\nhas_many :payments\r\n```\r\n\r\nDeclare the relationship in app/models/payment.rb.\r\n\r\n```ruby\r\nclass Payment < ActiveRecord::Base\r\n  belongs_to :user\r\nend\r\n```\r\n\r\nStep 4\r\n-----\r\n\r\nLet\'s give a better name for the method which updates the credit card expiration date in app/models/user.rb.\r\n\r\n```ruby\r\ndef update_credit_card_expiration_date(expiration_month, expiration_year)\r\n  self.credit_card.update_credit_card_expiration_date(expiration_month, expiration_year)\r\nend\r\n```\r\n\r\nLet\'s move the guest email generation to the user class.\r\n\r\n```ruby\r\ndef self.generate_random_guest_email\r\n  \"guest_#{Time.now.to_i}#{rand(100)}@example.com\"\r\nend\r\n```\r\n\r\nStep 5\r\n-----\r\n\r\nIn app/actors/customer/use_cases/guest\\_checkout.rb, let\'s make the StripeGateway methods more cohesive by having them have one purpose.\r\n\r\n```ruby\r\nmodule Actors\r\n  module Customer\r\n    module UseCases\r\n      \r\n      def self.guest_checkout(product_id, stripe_token, user)\r\n        amount = Product.price_in_cents_for(product_id)\r\n        customer = StripeGateway.save_credit_card(stripe_token)\r\n        charge = StripeGateway.charge(amount, customer.id)\r\n        \r\n        StripeCustomer.save_credit_card_and_stripe_customer_id(customer, user)      \r\n        StripeCustomer.create_payment(product_id, user.id, charge.id)\r\n      end      \r\n      \r\n    end\r\n  end\r\nend\r\n```\r\nThe saving credit card is separated from charging a customer. We also record the payment so that we can display list of all purchases for a customer.\r\n\r\nStep 6\r\n-----\r\n\r\nIn app/actors/customer/use_cases/one\\_click\\_checkout.rb.\r\n\r\n```ruby\r\nmodule Actors\r\n  module Customer\r\n    module UseCases\r\n      \r\n      def self.one_click_checkout(user, product_id)\r\n        customer_id = user.stripe_customer_id\r\n        amount = Product.price_in_cents_for(product_id)\r\n        \r\n        charge = StripeGateway.charge(amount, customer_id)\r\n        StripeCustomer.create_payment(product_id, user.id, charge.id)\r\n      end      \r\n      \r\n    end\r\n  end\r\nend\r\n```\r\n\r\nWe create payment after successful one-click checkout. Now we can display the receipt after purchase.\r\n\r\nStep 7\r\n-----\r\n\r\nLet\'s define the create_payment method in app/models/stripe\\_customer.rb.\r\n\r\n```ruby\r\ndef self.create_payment(product_id, user_id, charge_id)\r\n  product = Product.find(product_id)\r\n  Payment.create(product_id: product_id, user_id: user_id, amount: product.price, receipt_number: charge_id)\r\nend\r\n```\r\n\r\nStep 8\r\n-----\r\n\r\nIn app/actors/customer/use_cases/update\\_credit\\_card\\_expiration\\_date.rb\r\n\r\n```ruby\r\nmodule Actors\r\n  module Customer\r\n    module UseCases\r\n      \r\n      def self.update_credit_card_expiration_date(user, card_month, card_year)\r\n        cc = StripeGateway.update_credit_card_expiration_date(user.stripe_customer_id, card_month, card_year)\r\n        user.update_credit_card_expiration_date(cc.exp_month, cc.exp_year)\r\n      end      \r\n      \r\n    end\r\n  end\r\nend\r\n```\r\n\r\nOnly expiration needs to be updated. There is no need to change the last 4 digits. So we remove that from the method signature to simplify the methods.\r\n\r\nStep 9\r\n-----\r\n\r\nIn app/controllers/application\\_controller.rb\r\n\r\n```ruby\r\nu = User.create(:email => User.generate_random_guest_email)\r\n```\r\n\r\nWe have moved the guest email generation to the User class. This is used in two different places in the code. So it makes sense to define it in one place.\r\n\r\nStep 10\r\n-----\r\n\r\nIn app/controllers/credit\\_cards\\_controller.rb\r\n\r\n```ruby\r\ndef edit\r\n  @credit_card = current_user.credit_card\r\nend\r\n```\r\n\r\nThis is used only for changing the expiration date when a customer clicks the link in the email. There is no try when calling the credit\\_card method on current\\_user.\r\n\r\nStep 11\r\n-----\r\n\r\nIn app/controllers/registrations\\_controller.rb\r\n\r\n```ruby\r\ndef create\r\n  user = current_or_guest_user\r\n  Actors::Customer::UseCases.register_for_an_account(user, params[:user][:email], params[:user][:password])\r\n  sign_in(user)\r\n  \r\n  flash.notice = \'You have signed up\'\r\n    \r\n  if new_registration_without_purchase?\r\n    redirect_to root_path\r\n  else\r\n    redirect_to download_path\r\n  end\r\nend  \r\n```\r\n\r\nWe now make the register use case explicit in the registrations controller. The create action redirects to the appropriate page based on whether it is a new registrations without making a purchase or not. The private method is extracted from the create action.\r\n\r\n```ruby\r\nprivate\r\n\r\ndef new_registration_without_purchase?\r\n  session[:guest_checkout].blank?\r\nend\r\n```\r\n\r\nThis makes the intention of the guest_checkout session variable explicit.\r\n\r\nStep 12\r\n-----\r\n\r\nLet\'s register the register\\_for\\_an\\_account use case handler in app/actors/customer/customer.rb.\r\n\r\n```ruby\r\nrequire_relative \"#{Rails.root}/app/actors/customer/use_cases/register_for_an_account\"\r\n```\r\n\r\nStep 13\r\n-----\r\n\r\nIn app/gateways/stripe\\_gateway.rb\r\n\r\n```ruby\r\ndef self.save_credit_card(stripe_token)\r\n  run_with_stripe_exception_handler(\'StripeGateway.save_credit_card failed due to\') do\r\n    customer = Stripe::Customer.create(card: stripe_token, description: \"guest-user@example.com\")\r\n  end    \r\nend\r\n```\r\n\r\nThe save\\_credit\\_card method now has only one purpose. This makes it concise. I have also renamed another method in this class.\r\n\r\n```ruby\r\nself.update_credit_card_expiration_date(stripe_customer_id, card_month, card_year)\r\n```\r\n\r\nStep 14\r\n-----\r\n\r\nI have changed the name and deleted last4digits parameter in the method (not required) in app/models/credit\\_card.rb.\r\n\r\n```ruby\r\nupdate_credit_card_expiration_date(expiration_month, expiration_year)\r\n```\r\n\r\nStep 15\r\n-----\r\n\r\nChange the app/models/stripe\\_customer.rb.\r\n\r\n```ruby\r\n# Use Case : Add New Credit Card\r\ndef self.save_credit_card_details(card, user)\r\n  user.create_credit_card(last4digits: card.last4, expiration_month: card.exp_month, expiration_year: card.exp_year)\r\nend\r\n```\r\n\r\nThere is no delegation. This uses ActiveRecord create_association method.\r\n\r\nStep 16\r\n-----\r\n\r\nLet\'s cleanup the app/models/stripe\\_customer.rb.\r\n\r\n```ruby\r\n# Use Case : Guest Checkout\r\n# Saves the stripe response values in our database\r\ndef self.save_credit_card_and_stripe_customer_id(customer, user)\r\n  mapper = StripeCustomerMapper.new(customer)\r\n  user.email = User.generate_random_guest_email\r\n      \r\n  user.save_stripe_customer_id(customer.id)\r\n  user.create_credit_card(last4digits:      mapper.credit_card_last4digits, \r\n                          expiration_month: mapper.credit_card_expiration_month, \r\n                          expiration_year:  mapper.credit_card_expiration_year)\r\nend\r\n```\r\n\r\nSince we are creating a guest user in our database even before a customer provides us an email during the guest checkout process, the guest user record will fail to save in the database due to NOT NULL constraint in MySQL database for email. So we generate a random email. This email will be updated if the guest user signs up for an account at the end of guest checkout. \r\n\r\nStep 17\r\n-----\r\n\r\nThe mapper class is now encapsulating the knowledge about traversing the object graph.\r\n\r\n```ruby\r\nclass StripeCustomerMapper\r\n  def initialize(customer)\r\n    @customer = customer\r\n  end\r\n  \r\n  def credit_card_expiration_month\r\n    @customer.cards.data[0].exp_month\r\n  end\r\n  \r\n  def credit_card_expiration_year\r\n    @customer.cards.data[0].exp_year\r\n  end\r\n  \r\n  def credit_card_last4digits\r\n    @customer.cards.data[0].last4\r\n  end\r\nend\r\n```\r\n\r\nStep 18\r\n-----\r\n\r\nHere is the test for mapper.\r\n\r\n```ruby\r\nrequire \'rails_helper\'\r\n\r\ndescribe StripeCustomerMapper do\r\n  \r\n  it \'should map credit card expiration month\' do\r\n    h = JSON.parse(File.read(\"spec/support/fixtures/create_customer_success.json\"))\r\n    customer = Stripe::Customer.construct_from(h)    \r\n    \r\n    mapper = StripeCustomerMapper.new(customer)\r\n    \r\n    expect(mapper.credit_card_expiration_month).to eq(11)\r\n  end\r\n  \r\n  it \'should map credit card expiration year\' do\r\n    h = JSON.parse(File.read(\"spec/support/fixtures/create_customer_success.json\"))\r\n    customer = Stripe::Customer.construct_from(h)    \r\n    \r\n    mapper = StripeCustomerMapper.new(customer)\r\n    \r\n    expect(mapper.credit_card_expiration_year).to eq(2015)\r\n  end\r\n\r\n  it \'should map credit card last 4 digits\' do\r\n    h = JSON.parse(File.read(\"spec/support/fixtures/create_customer_success.json\"))\r\n    customer = Stripe::Customer.construct_from(h)    \r\n    \r\n    mapper = StripeCustomerMapper.new(customer)\r\n    \r\n    expect(mapper.credit_card_last4digits).to eq(\'4242\')\r\n  end\r\n\r\nend\r\n```\r\n\r\nStep 19\r\n-----\r\n\r\nDelete app/views/devise/registrations/create.html.erb. We don\'t need it since we forgot to redirect in the registrations controller create action.\r\n\r\nStep 20\r\n-----\r\n\r\nLet\'s write integration tests in the use case handler specs. Change the tests in  spec/actors/customer/use_cases/add\\_new\\_credit\\_card\\_spec.rb.\r\n\r\n```ruby\r\nrequire \'rails_helper\'\r\n\r\ndescribe \'Add new credit card\' do\r\n  \r\n  it \'should delegate add a new card to stripe gateway class\' do\r\n    token = Stripe::Token.create(:card => {\r\n                                    :number => \"4242424242424242\",\r\n                                    :exp_month => 11,\r\n                                    :exp_year => 2025,\r\n                                    :cvc => \"314\"})\r\n    customer = Stripe::Customer.create(card: token.id, description: \"rspec-user@example.com\")\r\n    user = User.new(email: \'bogus@exmaple.com\', password: \'12345678\', stripe_customer_id: customer.id)\r\n    user.save!\r\n    user.create_credit_card(last4digits: 1234)\r\n\r\n    new_token = Stripe::Token.create(:card => {\r\n                                       :number => \"4012888888881881\",\r\n                                       :exp_month => 10,\r\n                                       :exp_year => 2035,\r\n                                       :cvc => \"123\"})\r\n\r\n    card = Actors::Customer::UseCases.add_new_credit_card(user, new_token.id)\r\n    \r\n    expect(card.id).not_to be_nil\r\n  end\r\n\r\n  it \'should save credit card last4digits, expiration month and year in our database\' do\r\n    token = Stripe::Token.create(:card => {\r\n                                    :number => \"4242424242424242\",\r\n                                    :exp_month => 11,\r\n                                    :exp_year => 2025,\r\n                                    :cvc => \"314\"})\r\n    customer = Stripe::Customer.create(card: token.id, description: \"rspec-user@example.com\")\r\n    user = User.new(email: \'bogus@exmaple.com\', password: \'12345678\', stripe_customer_id: customer.id)\r\n    user.save!\r\n    user.create_credit_card(last4digits: 1234)\r\n\r\n    new_token = Stripe::Token.create(:card => {\r\n                                       :number => \"4012888888881881\",\r\n                                       :exp_month => 10,\r\n                                       :exp_year => 2035,\r\n                                       :cvc => \"123\"})\r\n\r\n    card = Actors::Customer::UseCases.add_new_credit_card(user, new_token.id)\r\n    \r\n    expect(user.credit_card.last4digits).to eq(\'1881\')\r\n    expect(user.credit_card.expiration_month).to eq(10)\r\n    expect(user.credit_card.expiration_year).to eq(2035)\r\n  end\r\n  \r\nend\r\n```\r\n\r\nI decided to hit the real servers instead of stubbing. The reason is that the tests become messy because of too much stubbing. We can use VCR gem to record the network interactions and speed up the tests later.\r\n\r\nStep 21\r\n-----\r\n\r\nThe latest tests for spec/actors/customer/use_cases/guest\\_checkout\\_spec.rb.\r\n\r\n```ruby\r\nrequire \'rails_helper\'\r\nrequire \'spec_helper\'\r\n\r\nfeature \'Guest Checkout\' do\r\n  before(:each) do\r\n    Product.create(name: \'Rails 4 Quickly\', price: 47)  \r\n  end\r\n  \r\n  scenario \'Complete purchase of one product and register for an account\', js: true do\r\n    checkout_product\r\n    make_payment(\'4242424242424242\')\r\n    register_after_guest_checkout(test_email, \'12345678\')\r\n        \r\n    expect(page).to have_content(\'You have signed up\')\r\n  end\r\n\r\n  scenario \'Complete purchase of one product and do not register for an account\', js: true do\r\n    checkout_product\r\n    \r\n    make_payment(\'4242424242424242\')\r\n    \r\n    click_link \'No thanks, take me to my download\'\r\n        \r\n    expect(page).to have_content(\'Download details about the book goes here\')\r\n  end\r\n  \r\n  scenario \'Fails due to credit card declined\', js: true do\r\n    checkout_product\r\n    \r\n    make_payment(\'4000000000000002\')\r\n    \r\n    expect(page).to have_content(\'Your card was declined.\')\r\n  end\r\n\r\n  scenario \'Fails due to credit card expired\', js: true do\r\n    checkout_product\r\n    \r\n    make_payment(\'4000000000000069\')\r\n        \r\n    expect(page).to have_content(\'Your card has expired.\')\r\n  end\r\n\r\n  scenario \'Fails due to incorrect credit card number\', js: true do\r\n    checkout_product\r\n        \r\n    make_payment(\'4242424242424241\')\r\n      \r\n    expect(page).to have_content(\'Your card number is incorrect.\')    \r\n  end\r\n\r\n  scenario \'Fails due to credit card processing error\', js: true do\r\n    checkout_product\r\n        \r\n    make_payment(\'4000000000000119\')\r\n    \r\n    expect(page).to have_content(\'An error occurred while processing your card. Try again in a little bit.\')\r\n  end\r\n  \r\nend\r\n```\r\n\r\nStep 22\r\n-----\r\n\r\nThe tests for spec/actors/customer/use_cases/one\\_click\\_checkout\\_spec.rb.\r\n\r\n```ruby\r\nrequire \'rails_helper\'\r\nrequire \'spec_helper\'\r\n\r\nfeature \'One click checkout\' do\r\n  before(:each) do\r\n    Product.create(name: \'Rails 4 Quickly\', price: 47)  \r\n  end\r\n  \r\n  scenario \'guest checkout, register and one-click checkout in subsequent visit\', js: true do\r\n    # 1. A customer makes a purchase as a guest. \r\n    checkout_product\r\n    make_payment(\'4242424242424242\')\r\n    \r\n    # 2. Registers for an account.  \r\n    register_after_guest_checkout(\'test@example.com\', \'12345678\')\r\n    \r\n    # 3. Logs out.\r\n    logout\r\n    \r\n    # 4. Logs in.\r\n    login(\'test@example.com\', \'12345678\')\r\n    \r\n    # 5. Makes a purchase without providing any credit card details using one-click checkout.\r\n    checkout_product\r\n    \r\n    expect(page).to have_content(\'Your credit card ending in 4242 has been charged for this purchase\')\r\n    expect(page).to have_content(\'Download details about the book goes here\')\r\n  end\r\n    \r\nend\r\n```\r\n\r\nStep 23\r\n-----\r\n\r\nThe tests for spec/actors/customer/use_cases/update\\_credit\\_card\\_expiration\\_date\\_spec.rb.\r\n\r\n```ruby\r\nrequire \'rails_helper\'\r\n\r\ndescribe \'Update credit card expiration date\' do\r\n  it \'it delegates update of credit card expiration to stripe gateway\' do\r\n    cc = double(\'Stripe Credit Card Response\')\r\n    allow(cc).to receive(:last4) { 1234 }\r\n    allow(cc).to receive(:exp_month) { 10 }\r\n    allow(cc).to receive(:exp_year) { 2050 }\r\n    \r\n    user = User.new(stripe_customer_id: 1)\r\n    user.save(validate: false)\r\n\r\n    allow(user).to receive(:update_credit_card_expiration_date) { true }\r\n    expect(StripeGateway).to receive(:update_credit_card_expiration_date) { cc }\r\n    \r\n    Actors::Customer::UseCases.update_credit_card_expiration_date(user, 12, 2020)\r\n  end\r\n  \r\n  it \'it saves credit card expiration date in our database\' do\r\n    cc = double(\'Stripe Credit Card Response\')\r\n    allow(cc).to receive(:last4) { 1234 }\r\n    allow(cc).to receive(:exp_month) { 10 }\r\n    allow(cc).to receive(:exp_year) { 2050 }\r\n    \r\n    user = User.new(stripe_customer_id: 1)\r\n    user.save(validate: false)\r\n\r\n    expect(user).to receive(:update_credit_card_expiration_date)\r\n    allow(StripeGateway).to receive(:update_credit_card_expiration_date) { cc }\r\n    \r\n    Actors::Customer::UseCases.update_credit_card_expiration_date(user, 12, 2020)\r\n  end\r\n  \r\nend\r\n```\r\n\r\nI changed the method name, so tests has to use the new method names when stubbing. \r\n\r\nStep 24\r\n-----\r\n\r\nThe tests for spec/controllers/products\\_controller\\_spec.rb.\r\n\r\n```ruby\r\nrequire \'rails_helper\'\r\n\r\ndescribe ProductsController, :type => :controller do\r\n\r\n  it \"returns http success for show action\" do\r\n    get :show\r\n  \r\n    expect(response).to be_success\r\n  end\r\n\r\n  it \"returns http success for download action\" do\r\n    User.create(email: \'bugs@disney.com\', password: \'12345678\')\r\n    user = User.last\r\n    user.create_credit_card(last4digits: 1234)\r\n    sign_in(user)   \r\n    \r\n    get :download\r\n  \r\n    expect(response).to be_success\r\n  end\r\n\r\n  it \"returns http success for download action for guest user\" do\r\n    User.create(email: \'bugs@disney.com\', password: \'12345678\')\r\n    user = User.last\r\n    user.create_credit_card(last4digits: 1234)\r\n    \r\n    get :download\r\n  \r\n    expect(response).to be_success\r\n  end\r\n\r\n  it \"initializes credit card for download action\" do\r\n    User.create(email: \'bugs@disney.com\', password: \'12345678\')\r\n    user = User.last\r\n    user.create_credit_card(last4digits: 1234)\r\n    sign_in(user)   \r\n    \r\n    get :download\r\n  \r\n    expect(assigns[:credit_card].last4digits).to eq(\'1234\')\r\n  end\r\n    \r\nend\r\n```\r\n\r\nStep 25\r\n-----\r\n\r\nThe tests for spec/gateways/stripe\\_gateway\\_spec.rb\r\n\r\n```ruby\r\nrequire \'rails_helper\'\r\nrequire \'stripe\'\r\n\r\ndescribe StripeGateway do\r\n  it \'subscribe customer to gold plan\' do                              \r\n    token = Stripe::Token.create(:card => {\r\n                                    :number => \"4242424242424242\",\r\n                                    :exp_month => 11,\r\n                                    :exp_year => 2025,\r\n                                    :cvc => \"314\"})\r\n    \r\n    customer = StripeGateway.create_subscription(\'bogus-email\', token.id, \'gold\')\r\n  \r\n    expect(customer.id).not_to be_nil\r\n  end\r\n  \r\n  it \'should raise credit card exception when Stripe::InvalidRequestError occurs\' do\r\n    expect do\r\n      customer = StripeGateway.create_subscription(\'fake\', \'bogus\', \'junk\')\r\n    end.to raise_error Striped::CreditCardException\r\n  end\r\n  \r\n  it \'saves customer credit card on Stripe servers\' do\r\n    token = Stripe::Token.create(:card => {\r\n                                    :number => \"4242424242424242\",\r\n                                    :exp_month => 11,\r\n                                    :exp_year => 2025,\r\n                                    :cvc => \"314\"})  \r\n\r\n    customer = StripeGateway.save_credit_card(token.id)\r\n  \r\n    expect(customer.id).not_to be_nil\r\n  end\r\n\r\n  it \'update credit card expiration date\' do\r\n    token = Stripe::Token.create(:card => {\r\n                                    :number => \"4242424242424242\",\r\n                                    :exp_month => 11,\r\n                                    :exp_year => 2025,\r\n                                    :cvc => \"314\"})  \r\n    customer = Stripe::Customer.create(card: token.id, description: \"rspec-user@example.com\")\r\n    \r\n    card = StripeGateway.update_credit_card_expiration_date(customer.id, 10, 2024)\r\n    \r\n    expect(card.exp_month).to eq(10)\r\n    expect(card.exp_year).to eq(2024)\r\n  end\r\n  \r\n  it \'adds a new credit card as the active default card on Stripe server\' do\r\n    token = Stripe::Token.create(:card => {\r\n                                   :number    => \"4242424242424242\",\r\n                                   :exp_month => 11,\r\n                                   :exp_year  => 2025,\r\n                                   :cvc       => \"314\"})\r\n        \r\n    customer = Stripe::Customer.create(:card => token.id, :description => \"stripe-gateway-test@example.com\")\r\n\r\n    new_token = Stripe::Token.create(:card => {\r\n                                       :number => \"4012888888881881\",\r\n                                       :exp_month => 10,\r\n                                       :exp_year => 2035,\r\n                                       :cvc => \"123\"})\r\n    \r\n    card = StripeGateway.add_new_credit_card(customer.id, new_token.id)\r\n    expect(card).to be_instance_of(Stripe::Card)\r\n  end\r\nend\r\n```\r\n\r\nWe hit the real servers. The gateway class interacts with the external API so we let the tests hit the external servers. We can use VCR gem to record the network interactions and speed up the tests later.\r\n \r\nStep 26\r\n-----\r\n\r\nThe tests for spec/models/credit\\_card\\_spec.rb.\r\n\r\n```ruby\r\nrequire \'rails_helper\'\r\n\r\ndescribe CreditCard, :type => :model do\r\n  it \'saves credit card expiration month and year\' do\r\n    cc = CreditCard.new\r\n    cc.update_credit_card_expiration_date(2, 2020)\r\n    \r\n    expect(cc.expiration_month).to eq(2)\r\n    expect(cc.expiration_year).to eq(2020)\r\n  end\r\nend\r\n```\r\n\r\nI have changed the method name.\r\n\r\nStep 27\r\n-----\r\n\r\nHere is the tests for testing the application helper.\r\n\r\n```ruby\r\nrequire \'spec_helper\'\r\nrequire \'rails_helper\'\r\n\r\ndescribe ApplicationHelper do\r\n  it \'nav_link returns empty class for non-selected tab\' do\r\n    link = helper.nav_link(\'Logout\', destroy_user_session_path, :delete)\r\n    \r\n    expect(link).to eq(\"<li class=\\\"\\\"><a rel=\\\"nofollow\\\" data-method=\\\"delete\\\" href=\\\"/users/sign_out\\\">Logout</a></li>\")\r\n  end\r\n\r\n  it \'nav_link returns empty class for non-selected tab\' do\r\n    link = helper.nav_link \'Login\', new_user_session_path  \r\n    \r\n    expect(link).to eq(\"<li class=\\\"\\\"><a href=\\\"/users/sign_in\\\">Login</a></li>\")\r\n  end\r\n  \r\nend\r\n```\r\n\r\nStep 28\r\n-----\r\n\r\nThe tests for the super model in app/models/stripe\\_customer.rb. It\'s a super model because it interacts with more than one ActiveRecord objects to accomplish a task.\r\n\r\n```ruby\r\nrequire \'rails_helper\'\r\n\r\ndescribe StripeCustomer do\r\n  \r\n  context \'save_subscription_details\' do\r\n    it \'should save stripe_customer_id\' do  \r\n      token = Stripe::Token.create(\r\n                :card => {\r\n                  :number => \"4242424242424242\",\r\n                  :exp_month => 11,\r\n                  :exp_year => 2025,\r\n                  :cvc => \"314\"})\r\n      customer = Stripe::Customer.create(card: token.id, description: \"rspec-user@example.com\")\r\n      user = User.new(email: \'bogus@exmaple.com\', password: \'12345678\')\r\n      user.save\r\n\r\n      StripeCustomer.save_subscription_details(user, customer, \'Gold\')\r\n\r\n      expect(user.stripe_customer_id).to eq(customer.id)\r\n    end\r\n    \r\n    it \'should save credit card details\' do  \r\n      token = Stripe::Token.create(\r\n                :card => {\r\n                  :number => \"4242424242424242\",\r\n                  :exp_month => 11,\r\n                  :exp_year => 2025,\r\n                  :cvc => \"314\"})\r\n      customer = Stripe::Customer.create(card: token.id, description: \"rspec-user@example.com\")\r\n      user = User.new(email: \'bogus@exmaple.com\', password: \'12345678\')\r\n      user.save\r\n\r\n      StripeCustomer.save_subscription_details(user, customer, \'Gold\')\r\n\r\n      expect(user.credit_card.last4digits).to eq(\'4242\')\r\n      expect(user.credit_card.expiration_month).to eq(11)\r\n      expect(user.credit_card.expiration_year).to eq(2025)\r\n    end\r\n\r\n    it \'should create subscription record\' do  \r\n      token = Stripe::Token.create(\r\n                :card => {\r\n                  :number => \"4242424242424242\",\r\n                  :exp_month => 11,\r\n                  :exp_year => 2025,\r\n                  :cvc => \"314\"})\r\n      customer = Stripe::Customer.create(card: token.id, description: \"rspec-user@example.com\")\r\n      user = User.new(email: \'bogus@exmaple.com\', password: \'12345678\')\r\n      user.save\r\n\r\n      StripeCustomer.save_subscription_details(user, customer, \'Gold\')\r\n\r\n      expect(user.subscription.plan_name).to eq(\'Gold\')\r\n      expect(user.subscription.stripe_customer_token).to eq(customer.id)\r\n    end\r\n  end    \r\n    \r\nend\r\n```\r\n\r\nStep 29\r\n-----\r\n\r\nThe complete source code for app/controllers/registrations\\_controller.rb.\r\n\r\n```ruby\r\nclass RegistrationsController < Devise::RegistrationsController\r\n  \r\n  def new\r\n    super\r\n  end\r\n  \r\n  def create\r\n    user = current_or_guest_user\r\n    Actors::Customer::UseCases.register_for_an_account(user, params[:user][:email], params[:user][:password])\r\n    sign_in(user)\r\n    \r\n    flash.notice = \'You have signed up\'\r\n      \r\n    root_path\r\n  end  \r\n    \r\nend\r\n```\r\n\r\nThe new user registration can happen when someone register after guest checkout or they can register without buying anything. We can modify the home page so that it lists all the purchases for the logged in user.\r\n\r\nStep 30\r\n-----\r\n\r\nWe can get all the orders for a user in the index action.\r\n\r\n```ruby\r\nclass WelcomeController < ApplicationController\r\n  def index\r\n    if user_signed_in?\r\n      @orders = current_user.orders if current_user.has_orders? \r\n    end\r\n  end\r\n  \r\n  def pricing\r\n  end\r\nend\r\n```\r\n\r\nLet\'s add the has_orders? method to app/models/user.rb.\r\n\r\n```ruby\r\ndef has_orders?\r\n  payments.size > 1\r\nend\r\n```\r\n  \r\nStep 31\r\n-----\r\n\r\nIn app/models/user.rb, define the orders method.\r\n\r\n```ruby\r\nclass User < ActiveRecord::Base\r\n  def orders\r\n    Order.all(payments)\r\n  end\r\nend\r\n```\r\n\r\nStep 32\r\n-----\r\n\r\nLet\'s create a Order class with a class method `all`.\r\n\r\n```ruby\r\nclass Order\r\n  def self.all(payments)\r\n    orders = []\r\n    payments.each do |payment|\r\n      order = {}\r\n      product = Product.find(payment.product_id)\r\n      order[:product_name] = product.name\r\n      order[:amount] = payment.amount\r\n      orders << order\r\n    end\r\n    orders\r\n  end\r\nend\r\n```\r\n\r\nStep 33    \r\n-----\r\n\r\nWe can now list all the purchases for a user in the home page. In app/views/welcome/index.html.erb.\r\n\r\n```ruby\r\n<% if @orders %>\r\n	Your Purchases <br/>\r\n	<% @orders.each do |order|  %>\r\n		<%= order[:product_name] %> : <%= order[:amount] %>\r\n	<% end %>\r\n	\r\n<% else  %>\r\n	This is the home page.\r\n<% end  %>\r\n```\r\n\r\nStep 34\r\n-----\r\n\r\nThere is no change to the new action in app/controllers/sales\\_controller.rb.\r\n\r\n```ruby\r\ndef new\r\n  begin\r\n    user = current_or_guest_user\r\n    if user.has_saved_credit_card?\r\n      Actors::Customer::UseCases.one_click_checkout(user, params[:id])\r\n              \r\n      redirect_to download_path\r\n    else\r\n      session[:product_id] = params[:id]\r\n    end\r\n  rescue Striped::CreditCardDeclined => e\r\n    redisplay_form(e.message)\r\n  rescue Exception => e\r\n    StripeLogger.error \"One Click Checkout failed due to #{e.message}. #{e.backtrace.join(\"\\n\")}\"\r\n    redisplay_form(\"Checkout failed. We have been notified about this problem.\")\r\n  end\r\nend\r\n```\r\n\r\nStep 35\r\n-----\r\n\r\nThe code for app/views/registrations/new.html.erb.\r\n\r\n```ruby\r\n<%= form_for(resource, as: resource_name, url: registration_path(resource_name), html: { class: \'form-horizontal\' }) do |f| %>\r\n  <fieldset>\r\n	<legend>Register</legend>\r\n        \r\n  <div class=\"form-group\">\r\n    <%= f.label :email, class: \'col-lg-1 control-label\' %>\r\n    <div class=\"col-lg-2\">\r\n      <%= f.email_field :email, value: @email, autofocus: true, size: 10, class: \"form-control\" %>\r\n    </div>\r\n  </div>\r\n\r\n  <div class=\"form-group\">\r\n    <%= f.label :password, class: \'col-lg-1 control-label\' %>\r\n    <div class=\"col-lg-2\">\r\n      <%= f.password_field :password, autocomplete: \"off\", size: 25, class: \"form-control\" %> <em>(8 characters minimum)</em>\r\n	</div>\r\n  </div>\r\n\r\n  <div class=\"form-group\">\r\n    <div class=\"col-lg-10 col-lg-offset-1\">\r\n	  <%= f.submit \"Sign Up\", class: \'btn btn-primary\' %>	\r\n    </div>\r\n  </div>\r\n\r\n  </fieldset>\r\n<% end %>\r\n```\r\n\r\nThis is styled using Twitter Bootstrap 3.3.\r\n\r\nStep 36\r\n-----\r\n\r\nThe view for credit cards form is app/views/credit\\_cards/new.html.erb.\r\n\r\n```ruby\r\n<form action=\"create\" method=\"POST\" id=\"payment-form\">\r\n  <span class=\"payment-errors\">\r\n  	<noscript>JavaScript is not enabled and is required for this form. First enable it in your web browser settings.</noscript>\r\n  </span>\r\n  <% if @error_message %>\r\n	<%= @error_message %>\r\n  <% end %>\r\n\r\n  <%= hidden_field_tag :authenticity_token, form_authenticity_token -%>\r\n\r\n  <div class=\"form-row\">\r\n    <label>\r\n      <span>Card Number</span>\r\n      <input type=\"text\" size=\"20\" data-stripe=\"number\"/>\r\n    </label>\r\n  </div>\r\n\r\n  <div class=\"form-row\">\r\n    <label>\r\n      <span>Expiration</span>\r\n<%= select_month nil, {add_month_numbers: true}, {name: nil, id: \"card_month\", data: {stripe: \"exp-month\"}} %>\r\n\r\n    </label>\r\n    <span>/</span>\r\n	<%= select_year nil, {start_year: Date.today.year, end_year: Date.today.year+15}, {name: nil, id: \"card_year\", data: {stripe: \"exp-year\"}} %>\r\n\r\n  </div>\r\n\r\n  <button type=\"submit\" class=\'btn btn-primary\'>Add Credit Card</button>\r\n</form>	\r\n```\r\n\r\nThis needs CSS magic to align the fields properly without breaking the tests.\r\n\r\nStep 37\r\n-----\r\n\r\nThe layout for payments is app/views/layouts/stripe.html.erb.\r\n\r\n```ruby\r\n<body data-no-turbolink>\r\n	\r\n	<p class=\"notice\"><%= notice %></p>\r\n    <p class=\"alert\"><%= alert %></p>\r\n\r\n    <%= render \'shared/navigation_bar\' %>\r\n  \r\n	<div class=\'container\'>\r\n		<%= yield %>\r\n	</div>	    \r\n</body>\r\n</html>\r\n```\r\n\r\nStep 38\r\n-----\r\n\r\nThe form for new sales app/views/sales/new.html.erb needs CSS magic. \r\n\r\n```ruby\r\n<fieldset>\r\n	<legend>Checkout</legend>\r\n\r\n<form action=\"create\" method=\"POST\" id=\"payment-form\", class=\'form-horizontal\'>\r\n  <span class=\"payment-errors\">\r\n  	<noscript>JavaScript is not enabled and is required for this form. First enable it in your web browser settings.</noscript>\r\n  </span>\r\n  <% if @error_message %>\r\n	<%= @error_message %>\r\n  <% end %>\r\n\r\n  <%= hidden_field_tag :authenticity_token, form_authenticity_token -%>\r\n\r\n  <div class=\"form-row\">\r\n    <label>\r\n      <span>Card Number</span>\r\n      <input type=\"text\" size=\"20\" data-stripe=\"number\"/>\r\n    </label>\r\n  </div>\r\n\r\n  <div class=\"form-row\">\r\n    <label>\r\n      <span>Expiration</span>\r\n		<%= select_month nil, {add_month_numbers: true}, {name: nil, id: \"card_month\", data: {stripe: \"exp-month\"}} %>\r\n    </label>\r\n    <span>/</span>\r\n	<%= select_year nil, {start_year: Date.today.year, end_year: Date.today.year+15}, {name: nil, id: \"card_year\", data: {stripe: \"exp-year\"}} %>\r\n	\r\n	<button type=\"submit\" class=\'btn btn-primary\'>Submit Payment</button>\r\n\r\n</form>\r\n\r\n</fieldset>\r\n```\r\n\r\nStep 39\r\n-----\r\n\r\nThe guest\\_checkout\\_spec.rb and signup\\_spec.rb has the \'You have signed up\' as the text to check in the assertion.\r\n\r\nYou can download the entire source code for this article using the commit hash ecb47db from `git@bitbucket.org:bparanj/striped.git`.\r\n\r\nSummary\r\n=======\r\n-------\r\n\r\nIn this article, we now track purchases so that we can list all purchases made by a customer. We also refactored the code base and tests.','2014-11-30 23:26:52','2016-12-22 20:40:30'),(1401,'Displaying Flash Messages in Rails 4.2 using Twitter Bootstrap 3.2','Objective\r\n=====\r\n-----\r\n\r\nTo fix the layout issue and style flash messages.\r\n\r\nDiscussion\r\n=====\r\n-----\r\n\r\nWe will work on the striped project to illustrate styling flash messages.\r\n\r\nSteps\r\n=====\r\n-----\r\n\r\nStep 1\r\n-----\r\n\r\nIn app/views/shared/\\_flash\\_messages.html.erb.\r\n\r\n```ruby\r\n<% flash.each do |type, message| %>\r\n  <div class=\"alert <%= bootstrap_class_for(type) %> fade in\">\r\n    <%= message %>\r\n  </div>\r\n<% end %>\r\n```\r\n\r\nStep 2\r\n------\r\n\r\nAdd the flash_messages partial to the app/views/layouts/application.html.erb file.\r\n\r\n```ruby\r\n<%= render partial: \"shared/flash_messages\", flash: flash %> \r\n```\r\n\r\nDelete the existing html that styles the flash messages in the layout file: \r\n\r\n```ruby\r\n<p class=\"notice\"><%= notice %></p>\r\n<p class=\"alert\"><%= alert %></p>\r\n```\r\n\r\nStep 3\r\n-------\r\n\r\nIn app/views/helpers/application\\_helper.rb.\r\n\r\n```ruby\r\ndef bootstrap_class_for(flash_type)\r\n  case flash_type\r\n  when \"success\"\r\n    \"alert-success\"   # Green\r\n  when \"error\"\r\n    \"alert-danger\"    # Red\r\n  when \"alert\"\r\n    \"alert-warning\"   # Yellow\r\n  when \"notice\"\r\n    \"alert-info\"      # Blue\r\n  else\r\n    flash_type.to_s\r\n  end\r\nend\r\n```\r\n\r\nLet\'s fix the navigation bar hiding the forms in the page. Add:\r\n\r\n```css\r\nbody {\r\n    padding-top: 90px;\r\n  }\r\n```\r\n\r\nto app/assets/stylesheets/application.css.scss. You can download the entire source code for this article using the commit hash 30c3afc from `git@bitbucket.org:bparanj/striped.git`. \r\n\r\nSummary\r\n=========\r\n---------\r\n\r\nIn this article you learned how to style flash messages using Twitter Bootstrap 3.3 in a Rails 4.2 project. We also fixed the layout issue where the navigation bar was hiding part of the form.\r\n','2014-12-02 01:06:46','2016-12-22 20:41:24'),(1411,'Using Fabrication Gem with Rails 4.1','Discussion\r\n======\r\n------\r\n\r\nTo learn how to use Fabrication gem to simplify creating objects in your tests.\r\n\r\nSteps\r\n======\r\n------\r\n\r\nStep 1\r\n------\r\n\r\nAdd fabricate gem to your Gemfile.\r\n\r\n```ruby\r\ngroup :development, :test do\r\n  gem \'rspec-rails\', \'~> 3.1\'\r\n  gem \'fabrication\'\r\nend\r\n```\r\n\r\nStep 2\r\n-------\r\n\r\nIn spec/fabricators/customer_fabricator.rb\r\n\r\n```ruby\r\nFabricator(:customer) do\r\n  email \'bugs@disney.com\'\r\n  password \'12345678\'\r\nend\r\n```\r\n\r\nBy default the symbol is the class name. You can use it in your test like this:\r\n\r\n```ruby\r\ndescribe CreditCardsController, :type => :controller do\r\n  it \"edit page returns http success if customer is logged in\" do\r\n    customer = Fabricate(:customer)\r\n    sign_in(customer)   \r\n  \r\n    get :edit\r\n    expect(response).to be_success\r\n  end\r\nend\r\n```\r\n\r\nIf you want to create an instance with different name, see the step 3.\r\n\r\nStep 3\r\n-------\r\n\r\nTo define an instance of customer with a meaningful customer\\_with\\_credit\\_card in your tests:\r\n\r\n```ruby\r\nFabricator(:customer_with_credit_card, from: :customer) do\r\n  email \'bugs@disney.com\'\r\n  password \'12345678\'\r\n  credit_card  { Fabricate.build(:credit_card) }\r\nend \r\n```\r\n\r\nThe first parameter is the name you want to use for an instance of the customer and the second parameter is the class name. You can use this in your test as shown below:\r\n\r\n```ruby\r\ndescribe CreditCardsController, :type => :controller do\r\n  it \"initializes credit card variable\" do\r\n    customer = Fabricate(:customer_with_credit_card)\r\n    sign_in(customer)   \r\n  \r\n    get :edit\r\n    expect(assigns[:credit_card]).not_to be_nil\r\n  end\r\nend\r\n```\r\n\r\nThe code above handles the customer has one credit\\_card relationship.\r\n\r\n```ruby\r\nclass Customer < ActiveRecord::Base  \r\n  has_one :credit_card\r\nend\r\n```\r\n\r\n```ruby\r\nclass CreditCard < ActiveRecord::Base\r\n  belongs_to :customer\r\nend\r\n```\r\n\r\nStep 4\r\n-------\r\n\r\nNow we need to define the credit\\_card before we can use. So, we have:\r\n\r\n```ruby\r\nFabricator(:credit_card) do\r\n  last4digits  \'1234\'\r\n  expiration_month 10\r\n  expiration_year 2030\r\nend\r\n\r\nFabricator(:customer_with_credit_card, from: :customer) do\r\n  email \'bugs@disney.com\'\r\n  password \'12345678\'\r\n  credit_card  { Fabricate.build(:credit_card) }\r\nend\r\n```\r\n\r\nStep 5\r\n-------\r\n\r\nThe has_many relationship between customer and payment can be used to create customer objects with payments.\r\n\r\n```ruby\r\nFabricator(:payment) do\r\n  product_id 1\r\n  receipt_number \'x\'\r\n  amount 47.0\r\nend\r\n\r\nFabricator(:customer_with_orders, from: :customer) do\r\n  email \'bugs@disney.com\'\r\n  password \'12345678\'\r\n  payments(count: 1)\r\nend\r\n```\r\n\r\nWe specify that we want one payment object associated with the customer. This can be used in tests like this:\r\n\r\n```ruby\r\n  it \'returns true if user has orders\' do\r\n    u = Fabricate(:customer_with_orders)\r\n    result = u.has_orders?\r\n    \r\n    expect(result).to eq(true)\r\n  end\r\n```\r\n\r\nSummary\r\n========\r\n--------\r\n\r\nIn this article you learned how to use Fabricate gem to simplify creating objects in tests.','2014-12-06 08:12:22','2016-12-22 20:42:24'),(1421,'Applying the Post Redirect Get Pattern to Striped Application','Discussion\r\n==========\r\n----------\r\n\r\nWe will use the Striped project as an example to illustrate the Post-Redirect-Get pattern. Purchase a product as a guest. When the checkout form does a post to the sales controller create action, the app/views/sales/create.html.erb is displayed. If you refresh the browser when the sales/create page is displayed you will get a \'Confirm Form Resubmission\' popup window. The customer payment should happen only once for a product, since the POST is not idempotent, we should redirect the user after the purchase is complete. This page will use a GET request to display the purchase confirmation page. Since GET is a safe operation, it will charge the customer more than once, the user can refresh the browser without affecting the state on the server.\r\n\r\nSteps\r\n=====\r\n\r\nStep 1\r\n-----\r\n\r\nDefine the route for the purchase confirmation path. \r\n\r\n```ruby\r\n  get \'sales/show\', as: :purchase_confirmation\r\n```\r\n\r\nStep 2\r\n-----\r\n\r\nChange the sales controller create action to redirect the user to the purchase confirmation page.\r\n\r\n```ruby\r\n  def create    \r\n    log_message = \'Guest checkout failed due to\'\r\n    user_message = \'Checkout failed. We have been notified about this problem\'\r\n    \r\n    cleanup = -> { session[:product_id] = nil }\r\n    main = -> do\r\n      user = current_or_guest_user\r\n      @payment = Actors::Customer::UseCases.guest_checkout(session[:product_id], params[:stripeToken], user)\r\n      @product = Product.find(session[:product_id])      \r\n    end\r\n    \r\n    run_with_stripe_exception_handler(log_message, user_message, main, cleanup)\r\n    \r\n    redirect_to purchase_confirmation_path(product_id: @product, payment_id: @payment)\r\n  end\r\n```\r\n\r\nThe last line of the create action now has the redirect.\r\n\r\nStep 3\r\n---- \r\n\r\nRename the app/views/create.html.erb to app/views/show.html.erb. \r\n\r\n\r\nStep 4\r\n----\r\n\r\nDefine the show page that loads the product and payment models so that the details of purchase can be displayed.\r\n\r\n```ruby\r\n  def show\r\n    @product = Product.find(params[:product_id])\r\n    @payment = Payment.find(params[:payment_id])\r\n  end\r\n```\r\n\r\nNow if you purchase a product, the redirect will make the purchase confirmation page safe to refresh. You can download the entire source code for this article using the commit hash 02a7246 from `git@bitbucket.org:bparanj/striped.git`.\r\n\r\nReferences\r\n==========\r\n----------\r\n\r\n[Redirect After Post](http://www.theserverside.com/news/1365146/Redirect-After-Post \'Redirect After Post\')','2014-12-10 08:47:58','2016-12-22 20:43:23'),(1431,'How to use VCR to speed up unit tests','Discussion\r\n==========\r\n----------\r\n\r\nIn this article, we will use the Striped project that uses the Stripe API for payment to illustrate how to use VCR gem to speed up unit tests. The feature tests will hit the real servers, since it\'s acceptable for the integration tests to run slow. It\'a tradeoff that we make to gain confidence in integrating our code with external service like Stripe API.\r\n\r\nSteps\r\n=====\r\n\r\nStep 1\r\n------\r\n\r\nAdd the vcr and webmock gems to the test group in Gemfile:\r\n\r\n```ruby\r\ngroup :test do\r\n  gem \'capybara\'\r\n  gem \'selenium-webdriver\'\r\n  gem \'database_cleaner\'\r\n  gem \'simplecov\', :require => false\r\n  gem \'vcr\'\r\n  gem \'webmock\'\r\nend\r\n```\r\n\r\nRun `bundle`\r\n\r\nStep 2\r\n--------\r\n\r\nAdd `config.extend VCR::RSpec::Macros` to your RSpec configuration block in rails_helper.rb\r\n\r\nStep 3\r\n------\r\n\r\nSpecify the directory to store the cassettes in the rails_helper.rb:\r\n\r\n```ruby\r\nVCR.configure do |c|\r\n  c.cassette_library_dir = \'spec/fixtures/vcr_cassettes\'\r\n  c.hook_into :webmock # or :fakeweb\r\nend\r\n```\r\n\r\nHere is my entire configuration file:\r\n\r\n```ruby\r\n# This file is copied to spec/ when you run \'rails generate rspec:install\'\r\nENV[\"RAILS_ENV\"] ||= \'test\'\r\nrequire \'spec_helper\'\r\nrequire File.expand_path(\"../../config/environment\", __FILE__)\r\nrequire \'rspec/rails\'\r\nrequire \'database_cleaner\'\r\n\r\n# :nocov:\r\n# Requires supporting ruby files with custom matchers and macros, etc, in\r\n# spec/support/ and its subdirectories. Files matching `spec/**/*_spec.rb` are\r\n# run as spec files by default. This means that files in spec/support that end\r\n# in _spec.rb will both be required and run as specs, causing the specs to be\r\n# run twice. It is recommended that you do not name files matching this glob to\r\n# end with _spec.rb. You can configure this pattern with the --pattern\r\n# option on the command line or in ~/.rspec, .rspec or `.rspec-local`.\r\nDir[Rails.root.join(\"spec/support/**/*.rb\")].each { |f| require f }\r\n\r\n# Checks for pending migrations before tests are run.\r\n# If you are not using ActiveRecord, you can remove this line.\r\nActiveRecord::Migration.maintain_test_schema!\r\n\r\nRSpec.configure do |config|\r\n  config.include Devise::TestHelpers, :type => :controller\r\n  config.include ControllerHelpers, :type => :controller\r\n  \r\n  config.before(:suite) do\r\n    DatabaseCleaner.clean_with(:truncation)\r\n  end\r\n\r\n  config.before(:each) do\r\n    DatabaseCleaner.strategy = :transaction\r\n  end\r\n\r\n  config.before(:each, js: true) do\r\n    DatabaseCleaner.strategy = :truncation\r\n  end\r\n\r\n  config.before(:each) do\r\n    DatabaseCleaner.start\r\n  end\r\n\r\n  config.after(:each) do\r\n    DatabaseCleaner.clean\r\n  end\r\n  \r\n  # Remove this line if you\'re not using ActiveRecord or ActiveRecord fixtures\r\n  config.fixture_path = \"#{::Rails.root}/spec/fixtures\"\r\n\r\n  # If you\'re not using ActiveRecord, or you\'d prefer not to run each of your\r\n  # examples within a transaction, remove the following line or assign false\r\n  # instead of true.\r\n  # config.use_transactional_fixtures = false\r\n\r\n  # RSpec Rails can automatically mix in different behaviours to your tests\r\n  # based on their file location, for example enabling you to call `get` and\r\n  # `post` in specs under `spec/controllers`.\r\n  #\r\n  # You can disable this behaviour by removing the line below, and instead\r\n  # explicitly tag your specs with their type, e.g.:\r\n  #\r\n  #     RSpec.describe UsersController, :type => :controller do\r\n  #       # ...\r\n  #     end\r\n  #\r\n  # The different available types are documented in the features, such as in\r\n  # https://relishapp.com/rspec/rspec-rails/docs\r\n  config.infer_spec_type_from_file_location!\r\n  \r\n  config.extend VCR::RSpec::Macros\r\nend\r\n\r\nVCR.configure do |c|\r\n  c.cassette_library_dir = \'spec/fixtures/vcr_cassettes\'\r\n  c.hook_into :webmock # or :fakeweb\r\n  c.allow_http_connections_when_no_cassette = true\r\nend\r\n```\r\n\r\nStep 4\r\n-------\r\n\r\nUse the cassette to record the network interaction in your tests, here is an example `spec/actors/customer/use_cases/guest_checkout_spec.rb`:\r\n\r\n```ruby\r\nrequire \'rails_helper\'\r\n\r\ndescribe \'Guest Checkout\' do\r\n  before(:each) do\r\n    @product = Product.create(name: \'Rails 4 Quickly\', price: 47)  \r\n  end\r\n  \r\n  it \'should save credit card at Stripe servers and save credit_card details in our database\' do\r\n    VCR.use_cassette \"guest checkout\" do\r\n      token = Stripe::Token.create(:card => {\r\n                                      :number => \"4242424242424242\",\r\n                                      :exp_month => 11,\r\n                                      :exp_year => 2025,\r\n                                      :cvc => \"314\"})\r\n      user = User.new(email: \'bogus@exmaple.com\', password: \'12345678\')\r\n      user.save\r\n    \r\n      Actors::Customer::UseCases.guest_checkout(@product.id, token.id, user)\r\n    \r\n      expect(User.last.credit_card.last4digits).to eq(\'4242\')\r\n      expect(User.last.credit_card.expiration_month).to eq(11)\r\n      expect(User.last.credit_card.expiration_year).to eq(2025)\r\n    end\r\n  end\r\n\r\n  it \'should create payment record in our database\' do\r\n    VCR.use_cassette \"guest checkout\" do\r\n      token = Stripe::Token.create(:card => {\r\n                                      :number => \"4242424242424242\",\r\n                                      :exp_month => 11,\r\n                                      :exp_year => 2025,\r\n                                      :cvc => \"314\"})\r\n      user = User.new(email: \'bogus@exmaple.com\', password: \'12345678\')\r\n      user.save\r\n    \r\n      Actors::Customer::UseCases.guest_checkout(@product.id, token.id, user)\r\n\r\n      payment = Payment.last\r\n      expect(payment.product_id).to eq(@product.id)\r\n      expect(payment.amount).to eq(@product.price)\r\n      expect(payment.user_id).to eq(user.id)\r\n    end\r\n  end\r\n\r\n  it \'should save stripe_customer_id in our database\' do\r\n    VCR.use_cassette \"guest checkout\" do\r\n      token = Stripe::Token.create(:card => {\r\n                                      :number => \"4242424242424242\",\r\n                                      :exp_month => 11,\r\n                                      :exp_year => 2025,\r\n                                      :cvc => \"314\"})\r\n      guest = User.create(email: \'bogus@exmaple.com\')\r\n      guest.save!(:validate => false)\r\n        \r\n      Actors::Customer::UseCases.guest_checkout(@product.id, token.id, guest)\r\n\r\n      user = User.last\r\n      expect(user.stripe_customer_id).not_to be_nil\r\n    end\r\n  end\r\nend\r\n```\r\n\r\nThis will create `spec/fixtures/guest_checkout.yml` file that has the serialized response object from Stripe servers.\r\n\r\nStep 5\r\n-------\r\n\r\nYou can see the improvement in performance when you run the specs after the first interaction with the server is recorded.\r\n\r\n```sh\r\n$ rake spec:actors\r\n\r\nFinished in 6.02 seconds (files took 3.42 seconds to load)\r\n6 examples, 0 failures\r\n\r\n$ rake spec:actors\r\n\r\nFinished in 2.78 seconds (files took 3.44 seconds to load)\r\n6 examples, 0 failures\r\n```\r\n\r\nStep 6\r\n-------\r\n\r\nYou will get VCR::Errors::UnhandledHTTPRequestError: error if you don\'t tell VCR to record new request. To record new episodes you can use `:record => :new_episodes` as shown in `spec/gateways/stripe_gateway_spec.rb`:\r\n\r\n```ruby\r\nrequire \'rails_helper\'\r\nrequire \'stripe\'\r\n\r\ndescribe StripeGateway do\r\n  \r\n  it \'saves customer credit card on Stripe servers\' do\r\n    VCR.use_cassette(\"stripe gateway\", :record => :new_episodes) do\r\n      token = Stripe::Token.create(:card => {\r\n                                      :number => \"4242424242424242\",\r\n                                      :exp_month => 11,\r\n                                      :exp_year => 2025,\r\n                                      :cvc => \"314\"})  \r\n\r\n      customer = StripeGateway.save_credit_card(token.id)\r\n  \r\n      expect(customer.id).not_to be_nil      \r\n    end\r\n  end\r\n  \r\n  it \'can charge a customer for a given amount\' do\r\n    VCR.use_cassette(\"stripe gateway\", :record => :new_episodes) do\r\n      token = Stripe::Token.create(:card => {\r\n                                      :number => \"4242424242424242\",\r\n                                      :exp_month => 11,\r\n                                      :exp_year => 2025,\r\n                                      :cvc => \"314\"})  \r\n      customer = StripeGateway.save_credit_card(token.id)\r\n      charge = StripeGateway.charge(1500, customer.id)\r\n  \r\n      expect(charge.id).not_to be_nil      \r\n    end\r\n  end\r\n  \r\nend\r\n```\r\n\r\nStep 7\r\n-------\r\n\r\nIn `rails_helper.rb`, turn off VCR for feature specs:\r\n\r\n```ruby\r\nVCR.configure do |c|\r\n  c.cassette_library_dir = \'spec/fixtures/vcr_cassettes\'\r\n  c.hook_into :webmock # or :fakeweb\r\n  c.allow_http_connections_when_no_cassette = true\r\nend\r\n```\r\n\r\nWe are not using any cassettes for the integration tests, so this configuration will work. You can download the entire source code for this article using the commit hash e22c2a0 from `git@bitbucket.org:bparanj/striped.git`.\r\n\r\nReferences\r\n===========\r\n-----------\r\n\r\n[VCR Usage with RSpec](https://relishapp.com/vcr/vcr/v/2-9-3/docs/test-frameworks/usage-with-rspec-macro \'VCR Usage with RSpec\')\r\n[Speeding up Rspec integration testing with the VCR gem](http://tech.xogroupinc.com/post/88009141839/speeding-up-rspec-integration-testing-with-the-vcr \'Speeding up Rspec integration testing with the VCR gem\')\r\n[How to configure VCR to work with Rails + RSpec](http://www.chrisjeon.me/blog/2013/12/15/how-to-configure-vcr-to-work-with-rails-rspec \'How to configure VCR to work with Rails + RSpec\')\r\n[Application Testing with Capybara](https://www.packtpub.com/application-development/application-testing-capybara \'Application Testing with Capybara\')\r\n[Is it possible to disable VCR based on type of spec?](https://github.com/vcr/vcr/issues/427 \'Is it possible to disable VCR based on type of spec?\')','2014-12-13 00:23:25','2016-12-22 20:44:18'),(1441,'Basic TDD in Rails : Setup','Objective\r\n=========\r\n----------\r\n\r\n- To setup the environment\r\n\r\nEnvironment\r\n=========\r\n----------\r\n\r\nRuby Version : 2.2.1\r\nRails Version : 4.2.\r\nRspec Rails Version 3.2\r\n\r\nSteps\r\n=========\r\n---------\r\n\r\nStep 1\r\n-------\r\n\r\nInstall Rails\r\n\r\n```sh\r\ngem install rails\r\n```\r\n\r\nStep 2\r\n-------\r\n\r\nCreate a Rails project\r\n\r\n```sh\r\nrails new --skip-spring blog\r\n```\r\n\r\nStep 3\r\n-------\r\n\r\nAdd project to bitbcket git repository\r\n\r\n```sh\r\ngit remote add origin git@bitbucket.org:bparanj/tdd-rails-basics.git\r\ngit push -u origin --all # pushes up the repo and its refs for the first time\r\n```\r\n\r\nStep 4\r\n-------\r\n\r\nInstall Rspec Rails\r\n\r\n```ruby\r\ngroup :development, :test do\r\n  gem \'rspec-rails\', \'~> 3.2\'\r\nend\r\n```\r\n\r\nbundle\r\n\r\nStep 5\r\n-------\r\n\r\n```sh\r\nrails generate rspec:install\r\n```\r\n\r\nOutput\r\n\r\n```sh\r\ncreate  .rspec\r\ncreate  spec\r\ncreate  spec/spec_helper.rb\r\ncreate  spec/rails_helper.rb\r\n```\r\n\r\nDelete the test folder\r\n\r\nSummary\r\n=========\r\n---------\r\n\r\nIn this lesson we installed rspec-rails for our new blog project so that we can start writing tests.\r\n','2015-03-19 02:54:40','2015-03-19 02:54:40'),(1451,'Basic TDD in Rails : Installation and Configuration to Run Feature Specs','Objective\r\n=========\r\n----------\r\n\r\nTo install and configure our project so that we can write a simple feature spec for the home page.\r\n\r\nDiscussion\r\n==========\r\n----------\r\n\r\nWe will use Capybara gem to write feature specs. \r\n\r\nSteps\r\n=========\r\n---------\r\n\r\nStep 1\r\n-------\r\n\r\nAdd\r\n\r\n```ruby\r\ngem \'capybara\' \r\n```\r\n\r\nto development, test group in Gemfile. Run bundle:\r\n\r\n```sh\r\nbundle \r\n```\r\n\r\nStep 2\r\n-------\r\n\r\nCreate a features folder under spec.\r\n\r\nStep 3\r\n-------\r\n\r\nCreate a new file call `home_page_spec.rb in the spec/features folder\r\n\r\nStep 4\r\n-------\r\n\r\nAdd the following code to `home_page_spec.rb`\r\n\r\n```ruby\r\nrequire \"rails_helper\"\r\n\r\nfeature \"Home Page\", :type => :feature do\r\n  scenario \"Home Page must load\" do\r\n    visit \"/\"\r\n\r\n    expect(page).to have_text(\"My Blog\")\r\n  end\r\nend\r\n```\r\n\r\nStep 5\r\n-------\r\n\r\nRun the feature spec.\r\n\r\n```sh\r\n$ rspec spec/features/home_page_spec.rb \r\n```\r\n\r\nYou will get ActionController::RoutingError: No route matches GET \"/\"\r\n\r\nStep 6\r\n-------\r\n\r\nUncomment the line:\r\n\r\n```ruby\r\n  root \'welcome#index\'\r\n```\r\n\r\nin routes.rb\r\n\r\nStep 7\r\n-------\r\n\r\nRun the feature spec again. You will get:\r\n\r\n```sh\r\n  Failure/Error: visit \"/\"\r\n     ActionController::RoutingError:\r\n       uninitialized constant WelcomeController\r\n```\r\n\r\nStep 8\r\n-------\r\n\r\nCreate the welcome controller with index action.\r\n\r\nStep 9\r\n-------\r\n\r\nRun the feature spec again.\r\n\r\n```sh\r\nFailure/Error: expect(page).to have_text(\"My Blog\")\r\n       expected to find text \"My Blog\" in \"Welcome#index Find me in app/views/welcome/index.html.erb\"\r\n```\r\n\r\nStep 10\r\n-------\r\n	   \r\nEdit the welcome/index.html.erb and add the \'My Blog\' text.\r\n\r\n```html\r\n<h1>My Blog</h1>\r\n```\r\n\r\nStep 11\r\n-------\r\n\r\nRun the feature spec again.\r\n\r\n```sh\r\n1 example, 0 failures\r\n```\r\n\r\nIt passes. Let\'s cleanup.\r\n\r\nStep 12\r\n-------\r\n\r\nOpen the routes.rb and delete the line:\r\n\r\n```ruby\r\nget \'welcome/index\'\r\n```\r\n\r\nStep 13\r\n-------\r\n  \r\nRun the spec again.\r\n\r\nStep 14\r\n-------\r\n\r\nLet\'s fix the warning:\r\n\r\n```sh\r\n/Users/zepho/projects/tdd/basics/blog/db/schema.rb doesn\'t exist yet. Run `rake db:migrate` to create it, then try again. If you do not intend to use a database, you should instead alter /Users/zepho/projects/tdd/basics/blog/config/application.rb to limit the frameworks that will be loaded.\r\n```\r\n\r\nby running the rake db:migrate\r\n\r\nStep 15\r\n-------\r\n\r\nRun the feature spec. It will pass.\r\n\r\nStep 16\r\n-------\r\n\r\nIn rails_helper.rb, add:\r\n\r\n```ruby\r\nCapybara.default_driver = :selenium\r\n```\r\n\r\nto the end of the file.\r\n\r\nStep 17\r\n-------\r\n\r\nRun the feature spec.\r\n\r\n```sh\r\n       Capybara\'s selenium driver is unable to load `selenium-webdriver`, please install the gem and add `gem \'selenium-webdriver\'` to your Gemfile if you are using bundler.\r\n```\r\n\r\nStep 18\r\n-------\r\n\r\nAdd the selenium-webdriver gem to Gemfile and run bundle.\r\n\r\nStep 19\r\n-------\r\n\r\nRun the feature spec. The test will run the feature spec in the Firefox browser. By default, Capybara uses the :rack_test driver, we switched to :selenium driver to run our feature specs in the firefox browser.\r\n\r\nStep 20\r\n-------\r\n\r\nChange the visit \'/\' to visit root\\_path and run the test.\r\n\r\nSummary\r\n=========\r\n-----------\r\n\r\nIn this lesson, we installed and configured our project to run feature specs. We wrote a simple feature spec and made it pass.  ','2015-03-19 03:07:26','2016-12-22 20:45:45'),(1461,'Basic TDD in Rails :  Writing a Feature Test','Objective\r\n=========\r\n----------\r\n\r\n- To write a feature test for the article index page.\r\n\r\nSteps\r\n=========\r\n---------\r\n\r\nStep 1\r\n--------\r\n\r\nAdd the second test:\r\n\r\n```ruby\r\n  scenario \'has link to my blog\' do\r\n    visit root_path\r\n    \r\n    click_link \'My Blog\'\r\n    \r\n    expect(page).to have_text(\'Listing Articles\')  \r\n  end\r\n```\r\n\r\nStep 2\r\n--------\r\n\r\nRun the test.\r\n\r\n```sh\r\n$ rspec spec/features/home_page_spec.rb \r\n```\r\n\r\nStep 3\r\n--------\r\n\r\nThe error is :\r\n\r\n```sh\r\n 1) Home Page has link to my blog\r\n     Failure/Error: click_link \'My Blog\'\r\n     Capybara::ElementNotFound:\r\n       Unable to find link \"My Blog\"\r\n```\r\n\r\nStep 4\r\n--------\r\n	  \r\nAdd the hyper link to app/views/welcome/index.html.erb\r\n\r\n```ruby\r\n<%= link_to \'My Blog\', articles_path %>\r\n```\r\n\r\nStep 5\r\n--------\r\n\r\nRun the test\r\n\r\n```sh\r\n$ rspec spec/features/home_page_spec.rb \r\n```\r\n\r\nStep 6\r\n--------\r\n\r\nThe error is :\r\n\r\n```sh\r\nundefined local variable or method `articles_path\' for class\r\n```\r\n\r\nStep 7\r\n--------\r\n\r\nAdd \r\n\r\n```ruby\r\nresources :articles \r\n```\r\n\r\nto the routes.rb\r\n\r\nStep 8\r\n--------\r\n\r\nRun the test.\r\n\r\n```sh\r\n$ rspec spec/features/home_page_spec.rb \r\n```\r\n\r\nStep 9\r\n--------\r\n\r\nThe error is:\r\n\r\n```sh\r\n1) Home Page has link to my blog\r\n     Failure/Error: Unable to find matching line from backtrace\r\n     ActionController::RoutingError:\r\n       uninitialized constant ArticlesController\r\n```\r\n\r\nStep 10\r\n--------\r\n	   \r\nCreate the articles controller. \r\n\r\n```sh\r\n$ rails g controller articles index\r\n```\r\n\r\nStep 11\r\n--------\r\n\r\nRun the test.\r\n\r\n```sh\r\n$ rspec spec/features/home_page_spec.rb \r\n```\r\n\r\nStep 12\r\n--------\r\n\r\nThe error is:\r\n\r\n```sh\r\n1) Home Page has link to my blog\r\n     Failure/Error: expect(page).to have_text(\'Listing Articles\')\r\n       expected to find text \"Listing Articles\" in \"Articles#index Find me in app/views/articles/index.html.erb\"\r\n     # ./spec/features/home_page_spec.rb:16:in `block (2 levels) in <top (required)>\'\r\n```\r\n\r\nStep 13\r\n--------\r\n\r\nAdd \r\n\r\n```html\r\n<h1>Listing Articles</h1> \r\n```\r\n\r\nto the articles/index.html.erb\r\n\r\nStep 14\r\n--------\r\n\r\nRun the test. It will pass.\r\n\r\nSummary\r\n=========\r\n-----------\r\n\r\nIn this lesson, you learned how to write a feature test using Capybara. We made changes to the view layer, the routes, the controller and finally the view. They were all driven by the test.','2015-03-19 08:12:04','2015-03-19 08:16:34'),(1471,'Basic TDD in Rails : Writing a Controller Test','Objective\r\n=========\r\n----------\r\n\r\n- Learn how to write controller tests.\r\n\r\nSteps\r\n=========\r\n---------\r\n\r\nStep 1\r\n--------\r\n\r\nRun the articles controller test.\r\n\r\n```sh\r\n$ rspec spec/controllers/articles_controller_spec.rb \r\n```\r\n\r\nStep 2\r\n--------\r\n\r\nLet\'s write a test to list articles in the articles page. \r\n\r\n```ruby\r\n  it \'should get all the articles\' do\r\n    get :index\r\n    \r\n    expect(assigns[:articles]).not_to be_nil\r\n  end\r\n```\r\n\r\nStep 3\r\n--------\r\n\r\nYou get the error:\r\n\r\n```sh\r\n 1) ArticlesController should get all the articles\r\n     Failure/Error: expect(assigns[:articles]).not_to be_nil\r\n       expected: not nil\r\n            got: nil\r\n```\r\n\r\nStep 4\r\n--------\r\n\r\nImplement the index action in articles_controller:\r\n\r\n```ruby\r\nclass ArticlesController < ApplicationController\r\n  def index\r\n    @articles = []\r\n  end\r\nend\r\n```\r\n\r\nStep 5\r\n--------\r\n\r\nRun the test.\r\n\r\n```sh\r\n$ rspec spec/controllers/articles_controller_spec.rb \r\n..\r\n\r\nFinished in 0.02335 seconds (files took 4.54 seconds to load)\r\n2 examples, 0 failures\r\n```\r\n\r\nStep 6\r\n--------\r\n\r\nChange the test so that it is more specific.\r\n\r\n```ruby\r\n  it \'should get all the articles\' do\r\n    get :index\r\n    \r\n    expect(assigns[:articles]).not_to be_empty \r\n  end\r\n```\r\n\r\nInstead of checking for nil, we now check it is not empty.\r\n\r\nStep 7\r\n--------\r\n\r\n```sh\r\n 1) ArticlesController should get all the articles\r\n     Failure/Error: expect(assigns[:articles]).not_to be_empty\r\n       expected `[].empty?` to return false, got true\r\n```\r\n\r\nStep 8\r\n--------\r\n\r\nCreate the article model\r\n\r\n```sh\r\n$ rails g model article title:string description:text\r\n```\r\n\r\nStep 9\r\n--------\r\n\r\nCreate the articles table.\r\n\r\n```sh\r\n$ rake db:migrate\r\n```\r\n\r\nStep 10\r\n--------\r\n\r\nRun the test. It fails. So we need to create an article in the database before we can call the index action. Change the test like this:\r\n\r\n```ruby\r\n  it \'should get all the articles\' do\r\n    Article.create(title: \'test\')\r\n    \r\n    get :index\r\n    \r\n    expect(assigns[:articles]).not_to be_empty \r\n  end\r\n```\r\n\r\nStep 11\r\n--------\r\n\r\nRun the test it fails.\r\n\r\nStep 12\r\n--------\r\n\r\nChange the index action so that it retrieves all the articles in the database.\r\n\r\n```ruby\r\nclass ArticlesController < ApplicationController\r\n  def index\r\n    @articles = Article.all\r\n  end\r\nend\r\n```\r\n\r\nStep 13\r\n--------\r\n\r\nRun the test. It passes.\r\n\r\nStep 14\r\n--------\r\n\r\nMake the test precise.\r\n\r\n```ruby\r\n  it \'should get all the articles\' do\r\n    Article.create(title: \'test\')\r\n    \r\n    get :index\r\n    \r\n    expect(assigns[:articles].size).to eq(1)\r\n  end\r\n```\r\n\r\nIt should pass.\r\n\r\nStep 15\r\n--------\r\n\r\nRun all the controller tests. It will pass.\r\n\r\nSummary\r\n=========\r\n---------\r\n\r\nIn this lesson, you learned how to write a controller test. We started with a trivial controller test that checked for not nil, then not empty and finally check for the size. We gradually refined the test to become more specific, forcing the implementation to become generic.','2015-03-19 08:43:43','2015-03-19 08:43:43'),(1481,'Basic TDD in Rails : Create a New Article Feature','Objective\r\n=========\r\n----------\r\n\r\n- To create a new article by filling out a form.\r\n\r\nDiscussion\r\n==========\r\n----------\r\n\r\nAt a high-level, we want to do the following:\r\n\r\n1. Go to the articles index page\r\n2. Click on the \'New Article\' link\r\n3. Fill out the article title and description\r\n4. Click \'Submit\' button\r\n5. The new article must be listed in the articles index page.\r\n\r\nSteps\r\n==========\r\n----------\r\n\r\nStep 1\r\n-------\r\n\r\nCreate a new file called `manage_articles_spec.rb` in spec/features folder. Add the following contents:\r\n\r\n```ruby\r\nrequire \'rails_helper\'\r\nrequire \'spec_helper\'\r\n\r\nfeature \"Manage Articles\", :type => :feature do\r\n  it \'should be able to create a new article\' do\r\n    visit articles_path\r\n    \r\n    click_link \'New Article\'\r\n    fill_in \"Title\", with: \'Test Article\'\r\n    fill_in \"Description\", with: \'Body of the article\'\r\n    click_button \'Submit\'\r\n    \r\n    expect(page).to have_text(\'Test Article\')  \r\n  end\r\n\r\nend\r\n```\r\n\r\nStep 2\r\n-------\r\n\r\nRun the `manage_articles_spec.rb`.\r\n\r\n```sh\r\n$ rspec spec/features/manage_articles_spec.rb \r\n\r\n 1) Manage Articles should be able to create a new article\r\n     Failure/Error: click_link \'New Article\'\r\n     Capybara::ElementNotFound:\r\n       Unable to find link \"New Article\"\r\n```\r\n\r\nStep 3\r\n-------\r\n\r\nAdd the link to the articles/index.html.erb file:\r\n\r\n```ruby\r\n<%= link_to \'New Article\', new_article_path %>\r\n```\r\n\r\nStep 4\r\n-------\r\n\r\nRun the test. It fails.\r\n\r\n```sh\r\n1) Manage Articles should be able to create a new article\r\n     Failure/Error: Unable to find matching line from backtrace\r\n     AbstractController::ActionNotFound:\r\n       The action \'new\' could not be found for ArticlesController\r\n```\r\n\r\nStep 5\r\n-------\r\n	   \r\nAdd an empty new action to the articles controller:\r\n\r\n```ruby\r\ndef new\r\nend\r\n```\r\n\r\nStep 6\r\n-------\r\n\r\nRun the test. It fails.\r\n\r\n```sh\r\n1) Manage Articles should be able to create a new article\r\n     Failure/Error: Unable to find matching line from backtrace\r\n     ActionView::MissingTemplate:\r\n       Missing template articles/new, application/new with {:locale=>[:en], :formats=>[:html, :xml], :variants=>[], :handlers=>[:erb, :builder, :raw, :ruby, :coffee, :jbuilder]}. Searched in:\r\n         * \"/Users/zepho/projects/tdd/basics/blog/app/views\"\r\n```\r\n\r\nStep 7\r\n-------\r\n\r\nAdd the articles/new.html.erb\r\n\r\n```ruby\r\n<%= form_for @article do |f| %>\r\n  <p>\r\n    <%= f.label :title %><br>\r\n    <%= f.text_field :title %>\r\n  </p>\r\n \r\n  <p>\r\n    <%= f.label :description %><br>\r\n    <%= f.text_area :description %>\r\n  </p>\r\n \r\n  <p>\r\n    <%= f.submit \'Submit\' %>\r\n  </p>\r\n<% end %>\r\n```\r\n\r\nStep 8\r\n-------\r\n\r\nRun the test. It fails.\r\n\r\n```sh\r\n 1) Manage Articles should be able to create a new article\r\n     Failure/Error: Unable to find matching line from backtrace\r\n     ActionView::Template::Error:\r\n       First argument in form cannot contain nil or be empty\r\n```\r\n\r\nStep 9\r\n-------\r\n\r\nChange the new action as follows:\r\n\r\n```ruby\r\n  def new\r\n    @article = Article.new\r\n  end\r\n```\r\n\r\nStep 10\r\n-------\r\n\r\nRun the test\r\n\r\n```sh\r\n 1) Manage Articles should be able to create a new article\r\n     Failure/Error: Unable to find matching line from backtrace\r\n     AbstractController::ActionNotFound:\r\n       The action \'create\' could not be found for ArticlesController\r\n```\r\n\r\nStep 11\r\n-------\r\n	   		 \r\nAdd the create method in articles controller:\r\n\r\n```ruby\r\n  def create\r\n    \r\n  end\r\n```\r\n\r\nStep 12\r\n-------\r\n\r\nRun the test. It fails.\r\n\r\n```sh\r\n    Failure/Error: Unable to find matching line from backtrace\r\n     ActionView::MissingTemplate:\r\n       Missing template articles/create, application/create with {:locale=>[:en], :formats=>[:html], :variants=>[], :handlers=>[:erb, :builder, :raw, :ruby, :coffee, :jbuilder]}. Searched in:\r\n         * \"/Users/zepho/projects/tdd/basics/blog/app/views\"\r\n```\r\n\r\nStep 13\r\n-------\r\n		 \r\nWe want the user to be redirected to the index page. So, change the create action:\r\n\r\n```ruby\r\n  def create\r\n    \r\n    redirect_to articles_path\r\n  end\r\n```\r\n\r\nStep 14\r\n-------\r\n\r\nRun the test. It fails.\r\n\r\n```sh\r\n 1) Manage Articles should be able to create a new article\r\n     Failure/Error: expect(page).to have_text(\'Test Article\')\r\n       expected to find text \"Test Article\" in \"Listing Articles New Article\"\r\n     # ./spec/features/manage_articles_spec.rb:13:in `block (2 levels) in <top (required)>\'\r\n```\r\n\r\nStep 15\r\n-------\r\n\r\nChange the create action :\r\n\r\n```ruby\r\n  def create\r\n    allowed_params = params.require(:article).permit(:title, :description)\r\n    Article.create(allowed_params)\r\n    \r\n    redirect_to articles_path\r\n  end\r\n```\r\n\r\nStep 16\r\n-------\r\n\r\nRun the test. It fails.\r\n\r\n```sh\r\n  1) Manage Articles should be able to create a new article\r\n     Failure/Error: expect(page).to have_text(\'Test Article\')\r\n       expected to find text \"Test Article\" in \"Listing Articles New Article\"\r\n     # ./spec/features/manage_articles_spec.rb:13:in `block (2 levels) in <top (required)>\'\r\n```\r\n\r\nStep 17\r\n-------\r\n	 \r\nChange the articles/index.html.erb as follows:\r\n\r\n```ruby\r\n<h1>Listing Articles</h1>\r\n\r\n<table >\r\n  <thead>\r\n    <tr>\r\n      <th>Title</th>\r\n      <th>Description</th>\r\n    </tr>\r\n  </thead>\r\n  <tbody>\r\n    <% @articles.each do |article| %>\r\n      <tr>\r\n        <td><%= article.title %></td>\r\n        <td><%= article.description %></td>\r\n      </tr>\r\n    <% end %>\r\n  </tbody>\r\n</table>\r\n\r\n<%= link_to \'New Article\', new_article_path %>\r\n```\r\n\r\nStep 18\r\n-------\r\n\r\nRun the test. The test now passes.\r\n\r\nSummary\r\n=========\r\n-----------\r\n\r\nIn this lesson, we started with a high level view of the steps needed to create a new article by filling out a form. We wrote a feature test that drove us to make to make the necessary changes to implement creating a new article feature. The following steps were all driven by the test.\r\n\r\n1. We wrote a feature test to create a new article\r\n2. Changed view to add a link\r\n3. Changed controller to implement the functionality\r\n4. Added form for the user to fill out the article title and description\r\n5. Displayed an empty article form\r\n6. Allowed the user to fill out the article form and submit it to create an article.\r\n7. Displayed the article in the article index page.\r\n','2015-03-19 09:04:35','2016-12-22 20:47:48'),(1491,'Basic TDD in Rails : Writing Validation Tests for the Model','Objective\r\n==========\r\n----------\r\n\r\nHandle the negative case in the model unit tests.\r\n\r\nDiscussion\r\n==========\r\n----------\r\n\r\nWhy are we using unit tests for negative cases? In other words, why not write feature specs for all the negative cases?\r\n\r\n![alt text](http://blog.viseo-bt.com/wp-content/uploads/2014/04/TestingPyramid.png \"Testing Pyramid\")\r\n\r\nAs you can see, in the Testing Pyramid, the bottom has more tests and as we go up the pyramid, we have less tests of those type. We write unit tests to cover all cases while the integration tests are written to cover the happy path. Unit tests run fast so we can write many tests. The integration tests cuts through different layers and is slower. So we minimize the integration tests by focusing only on the happy path.\r\n\r\nRequirements\r\n==========\r\n----------\r\n\r\n1. To create a valid article, it must have both title and description. \r\n\r\n2. If the validation fails we must display the new form with error message and allow user to correct the mistake and resubmit the form.\r\n\r\nIn this lesson we will handle the requirement #1. The next lesson will handle the requirement #2.\r\n\r\nSteps\r\n=========\r\n---------\r\n\r\nStep 1\r\n---------\r\n\r\nRun article_spec.rb.\r\n\r\n```sh\r\n$ rspec spec/models/article_spec.rb \r\n```\r\n\r\nYou get \'pending\' message.\r\n\r\nStep 2\r\n---------\r\n\r\nWrite a test for positive case where title and description are provided.\r\n\r\n```ruby\r\nrequire \'rails_helper\'\r\n\r\ndescribe Article, type: :model do\r\n  it \'is valid if title and description fields have value\' do\r\n    article = Article.new(title: \'test\', description: \'test\')\r\n    \r\n    expect(article.save).to eq(true)\r\n  end\r\nend\r\n```\r\n\r\nStep 3\r\n---------\r\n\r\nRun the test:\r\n\r\n```sh\r\n$ rspec spec/models/article_spec.rb \r\n```\r\n\r\nThe test passes without failing. This is fine. Checking the return value is one way to check we saved the article. Another way is to check the article count went up by one, like this:\r\n\r\n```ruby\r\nrequire \'rails_helper\'\r\n\r\ndescribe Article, type: :model do\r\n  it \'is valid if title and description fields have value\' do\r\n    expect do\r\n      article = Article.new(title: \'test\', description: \'test\')\r\n      article.save\r\n    end.to change{Article.count}.by(1)\r\n  end\r\nend\r\n```\r\n\r\nStep 4\r\n---------\r\n\r\nAdd the second test for missing title as follows:\r\n\r\n```ruby\r\nrequire \'rails_helper\'\r\n\r\ndescribe Article, type: :model do\r\n  \r\n  it \'is not valid if it has no title\' do\r\n    article = Article.new(description: \'test\')\r\n    \r\n    expect(article.save).to be(false)\r\n  end\r\nend\r\n```\r\n\r\nStep 5\r\n---------\r\n\r\nRun the test.\r\n\r\n```sh\r\n$ rspec spec/models/article_spec.rb \r\n```\r\n\r\nIt fails.\r\n\r\n```sh\r\n 1) Article is not valid if it has no title\r\n     Failure/Error: expect(article.save).to be(false)\r\n       \r\n       expected false\r\n            got true\r\n```\r\n\r\nStep 6\r\n---------\r\n\r\nAdd the validation for title to the article.rb as follows:\r\n\r\n```ruby\r\nclass Article < ActiveRecord::Base\r\n  validates :title, presence: true\r\nend\r\n```\r\n\r\nStep 7\r\n---------\r\n\r\nRun the test.\r\n\r\n```sh\r\n$ rspec spec/models/article_spec.rb \r\n..\r\n\r\nFinished in 0.05543 seconds (files took 2.1 seconds to load)\r\n2 examples, 0 failures\r\n```\r\n\r\nIt passes.\r\n\r\nStep 8\r\n---------\r\n\r\nYou can also make your test precise by changing it like this:\r\n\r\n```ruby\r\n  it \'is not valid if it has no title\' do\r\n    article = Article.new(description: \'test\')\r\n    article.save\r\n    \r\n    expect(article.errors[:title]).to eq([\"can\'t be blank\"])\r\n  end\r\n```\r\n  \r\nThis check the error is due to the missing title.\r\n\r\nExercise\r\n=========\r\n---------\r\n\r\nWrite a failing test for missing decription field and make it pass.\r\n\r\nSummary\r\n=========\r\n---------\r\n\r\nIn this lesson you learned about the Testing Pyramid. We ran a pending spec, we wrote a tests for positive case and negative cases using unit tests. We saw two ways of asserting: checking return value vs counting the records. We also saw how to make test precise for validation checks. In the next lesson we will go up a layer and write tests for handling validation failure cases at the controller layer.\r\n','2015-03-19 19:53:42','2015-03-19 19:54:31'),(1511,'Basic TDD in Rails : Configuring Database Cleaner Gem','Objective\r\n=========\r\n----------\r\n\r\nLet\'s handle the requirement #2 we saw in the previous lesson:\r\n\r\nIf the validation fails we must display the new form with error message and allow user to correct the mistake and resubmit the form.\r\n\r\nSteps\r\n=========\r\n---------\r\n\r\nStep 1\r\n---------\r\n\r\nBefore we write a controller spec for the validation failure case, let\'s run our existing articles controller spec.\r\n\r\n```sh\r\n$ rspec spec/controllers/articles_controller_spec.rb \r\n```\r\n\r\nThe test that was passing before now failis consistently with the error message:\r\n\r\n```sh\r\n1) ArticlesController should get all the articles\r\n     Failure/Error: expect(assigns[:articles].size).to eq(1)\r\n       \r\n       expected: 1\r\n            got: 2\r\n```\r\n\r\nStep 2\r\n---------\r\n\r\nTo fix this issue, add\r\n\r\n```ruby\r\n  gem \'database_cleaner\'\r\n```\r\n\r\nto Gemfile. Run bundle install.\r\n\r\nStep 3\r\n---------\r\n\r\nEdit the spec/rails_helper.rb as follows:\r\n\r\nAdd : \r\n\r\n```ruby\r\nrequire \'database_cleaner\' \r\n```\r\n\r\nto the top of the file and configure database cleaner gem like this:\r\n\r\n```ruby\r\nRSpec.configure do |config|\r\n  config.before(:suite) do\r\n    DatabaseCleaner.clean_with(:truncation)\r\n  end\r\n\r\n  config.before(:each) do\r\n    DatabaseCleaner.strategy = :transaction\r\n  end\r\n\r\n  config.before(:each, js: true) do\r\n    DatabaseCleaner.strategy = :truncation\r\n  end\r\n\r\n  config.before(:each) do\r\n    DatabaseCleaner.start\r\n  end\r\n\r\n  config.after(:each) do\r\n    DatabaseCleaner.clean\r\n  end\r\n\r\n  # Other code here should be left as it is\r\nend\r\n```\r\n\r\nStep 4\r\n---------\r\n\r\nRun the test. The test will now fail because the second spec does not provide value for description. Change the test:\r\n\r\n```ruby\r\n  it \'should get all the articles\' do\r\n    Article.create(title: \'test\', description: \'test\')\r\n    \r\n    get :index\r\n    \r\n    expect(assigns[:articles].size).to eq(1)\r\n  end\r\n```\r\n\r\nRun the contoller spec now. It will pass. \r\n\r\nIf the validation fails we must display the new form with error message and allow user to correct the mistake and resubmit the form.\r\n\r\nStep 5\r\n-------\r\n\r\nWe wrote a feature spec that tested the articles controller create action indirectly. We need to add a controller tests for create and new before we can handle the validation failures.\r\n\r\n```ruby\r\n  it \'should create a new article\' do\r\n    expect do\r\n      post :create, { article: { title: \'test\', description: \'test\' }}\r\n    end.to change{Article.count}.by(1)\r\n  end\r\n```\r\n\r\nThis test passes.\r\n\r\nStep 6\r\n-------\r\n\r\nLet\'s add the next test to check that it redirects to article index page after creating the article.\r\n\r\n```ruby\r\n  it \'should redirect to articles index page after creating the article\' do\r\n    post :create, { article: { title: \'test\', description: \'test\' }}\r\n    \r\n    expect(response).to redirect_to articles_path\r\n  end\r\n```\r\n\r\nRun the test. It also passes. Now we can handle the validation failure case :\r\n\r\n```ruby\r\n  it \'should redirect to articles index page after creating the article\' do\r\n    post :create, { article: { title: \'test\' }}\r\n    \r\n    expect(response).to render_template(:new)\r\n  end\r\n```\r\n  \r\nThis test fails.\r\n\r\nStep 7\r\n-------\r\n\r\nChange the create action:\r\n\r\n```ruby\r\n  def create\r\n    allowed_params = params.require(:article).permit(:title, :description)\r\n    article = Article.new(allowed_params)\r\n    \r\n    if article.save\r\n      redirect_to articles_path\r\n    else\r\n      render :new\r\n    end\r\n  end\r\n```\r\n\r\nRun the test. It now passes.\r\n\r\nSummary\r\n=========\r\n---------\r\n\r\nIn this lesson we configured database_cleaner gem and implemented the feature where if the validation fails we allow the user to correct the mistake.','2015-03-19 21:32:49','2015-03-19 21:36:10'),(1521,'Basic TDD in Rails : Configuring SimpleCov Test Coverage Gem','Objective\r\n=========\r\n----------\r\n\r\nLearn how to use SimpleCov gem to generate test coverage report.\r\n\r\nDiscussion\r\n==========\r\n----------\r\n\r\nWhy do we need a coverage report tool when we know that our test coverage will be 100% when we write test first? In a real-world Rails app, you will have gems, Rails engines and other third-party libraries that you need to customize. This can lead to gaps in your test coverage. By running the test coverage reports before you checkin the code, you can write tests for the code with no coverage.\r\n\r\nSteps\r\n=========\r\n---------\r\n\r\nStep 1\r\n-------\r\n\r\nAdd simplecov gem to the test group.\r\n\r\n```ruby\r\n  gem \'simplecov\', :require => false\r\n```\r\n  \r\nI have also cleaned up the other gems like this:\r\n\r\n```ruby\r\ngroup :development, :test do\r\n  # Call \'byebug\' anywhere in the code to stop execution and get a debugger console\r\n  gem \'byebug\'\r\n\r\n  # Access an IRB console on exception pages or by using <%= console %> in views\r\n  gem \'web-console\', \'~> 2.0\'\r\n  gem \'rspec-rails\', \'~> 3.2\'\r\nend\r\n\r\ngroup :test do\r\n  gem \'capybara\' \r\n  gem \'selenium-webdriver\'\r\n  gem \'database_cleaner\'\r\n  gem \'simplecov\', :require => false\r\nend\r\n```\r\n\r\nThis now separates all the test related gem from the development and test group. I have also changed the rspec-rails version to 3.2.\r\n\r\nStep 2\r\n-------\r\n\r\nRun \r\n\r\n```sh\r\n$ bundle\r\n```\r\n\r\nStep 3\r\n-------\r\n\r\nAdd the lines:\r\n\r\n```ruby\r\nrequire \'simplecov\'\r\nSimpleCov.start\r\n```\r\n\r\nto the top of the spec_helper.rb file.\r\n\r\nStep 4\r\n-------\r\n\r\nRun :\r\n\r\n```sh\r\n$ rake spec\r\n```\r\n\r\nThis will run all your tests.\r\n\r\nStep 5\r\n-------\r\n\r\nOpen the coverage/index.html in a browser. You can see we have 99.32 % test coverage. For some reason it thinks `rails_helper.rb` configuration for `database_cleaner` is not covered. To fix this change the top two lines in the `spec_helper.rb` to :\r\n\r\n```ruby\r\nrequire \'simplecov\'\r\nSimpleCov.start \'rails\'\r\n```\r\n\r\nNow the test coverage will be 100%.\r\n\r\nSummary\r\n=========\r\n-----------\r\n\r\nIn this lesson we installed and configured simple_cov gem to generate test coverage reports. You also learned why we need to use a test coverage tool in our projects.','2015-03-19 21:50:27','2016-12-22 20:49:24'),(1531,'Basic TDD in Rails : Display Validation Error Messages','Objective\r\n=========\r\n----------\r\n\r\nTo display error message to the user when the validation fails.\r\n\r\nSteps\r\n=========\r\n---------\r\n\r\nStep 1\r\n-------\r\n\r\nAdd a new feature test in `features/manage_articles_spec.rb`:\r\n\r\n```ruby\r\n  it \'should display error message to the user\' do\r\n    visit articles_path\r\n    \r\n    click_link \'New Article\'\r\n    fill_in \"Title\", with: \'Test Article\'\r\n    click_button \'Submit\'\r\n    \r\n    expect(page).to have_text(\"Description can\'t be blank\")      \r\n  end\r\n```\r\n\r\nStep 2\r\n-------\r\n\r\nRun the test : `rspec spec/features/manage_articles_spec.rb`. \r\n\r\nThe error is:\r\n\r\n```sh\r\n   Failure/Error: Unable to find matching line from backtrace\r\n     ActionView::Template::Error:\r\n       undefined method `errors\' for nil:NilClass\r\n```\r\n\r\nStep 3\r\n-------\r\n	   \r\nChange the article to instance variable in the create action as follows:\r\n\r\n```ruby\r\n  def create\r\n    allowed_params = params.require(:article).permit(:title, :description)\r\n    @article = Article.new(allowed_params)\r\n    \r\n    if @article.save\r\n      redirect_to articles_path\r\n    else\r\n      render :new\r\n    end\r\n  end\r\n```\r\n\r\nRun the test. It will fail.\r\n\r\nStep 4\r\n-------\r\n\r\nAdd the code to display validation error message to the top of the new.html.erb:\r\n\r\n```ruby\r\n<% if @article.errors.any? %>\r\n  <h2><%= pluralize(@article.errors.count, \"error\") %> prohibited\r\n    this article from being saved:</h2>\r\n\r\n  <ul>\r\n  <% @article.errors.full_messages.each do |m| %>\r\n    <li><%= m %></li>\r\n  <% end %>\r\n  </ul>\r\n<% end %>\r\n```\r\n\r\nRun the test. It will pass.\r\n\r\nExercise\r\n=========\r\n----------\r\n\r\nWrite a feature spec to test for validation failure due to missing title.\r\n\r\nSummary\r\n=========\r\n-----------\r\n\r\nIn this lesson you learned how to write a test for validation failures.','2015-03-19 22:04:44','2016-12-22 20:50:01'),(1541,'Basic TDD in Rails : Update an Article Feature','Objective\r\n=========\r\n----------\r\n\r\nI want to edit an existing article and update the title and description.\r\n\r\nSteps\r\n=========\r\n---------\r\n\r\nStep 1\r\n-------\r\n\r\nAdd the second feature spec:\r\n\r\n```ruby\r\n  it \'can edit an existing article\' do\r\n    Article.create(title: \'test\', description: \'test\')\r\n    visit articles_path\r\n    \r\n    click_link \'Edit\'\r\n    fill_in \"Title\", with: \'Test Article\'\r\n    fill_in \"Description\", with: \'Body of the article\'\r\n    click_button \'Submit\'\r\n    \r\n    expect(page).to have_text(\'Test Article\')      \r\n    expect(page).to have_text(\'Body of the article\')      \r\n  end\r\n```\r\n  \r\nStep 2\r\n-------\r\n\r\nRun the test.\r\n\r\n```sh\r\n  1) Manage Articles can edit an existing article\r\n     Failure/Error: click_link \'Edit\'\r\n     Capybara::ElementNotFound:\r\n       Unable to find link \"Edit\"\r\n```\r\n\r\nStep 3\r\n-------\r\n\r\nAdd the edit link to the articles index page.\r\n\r\n```ruby\r\n<%= link_to \'Edit\', edit_article_path(article) %>\r\n```\r\n\r\nStep 4\r\n-------\r\n\r\nRun the test: \r\n\r\n```sh\r\n$ spec spec/features/manage_articles_spec.rb \r\n```\r\n\r\nYou get the error:\r\n\r\n```sh\r\n 1) Manage Articles can edit an existing article\r\n     Failure/Error: Unable to find matching line from backtrace\r\n     AbstractController::ActionNotFound:\r\n       The action \'edit\' could not be found for ArticlesController\r\n```\r\n	   \r\nStep 5\r\n-------\r\n\r\nAdd the edit action to articles controller:\r\n\r\n```ruby\r\n  def edit\r\n    \r\n  end\r\n```\r\n\r\nStep 6\r\n-------\r\n\r\nRun the test.  \r\n\r\n```sh\r\n1) Manage Articles can edit an existing article\r\n     Failure/Error: Unable to find matching line from backtrace\r\n     ActionView::MissingTemplate:\r\n       Missing template articles/edit, application/edit with {:locale=>[:en], :formats=>[:html, :xml], :variants=>[], :handlers=>[:erb, :builder, :raw, :ruby, :coffee, :jbuilder]}. Searched in:\r\n         * \"/Users/zepho/projects/tdd/basics/blog/app/views\"\r\n```\r\n		 \r\nStep 7\r\n-------\r\n		 \r\nCreate views/articles/edit.html.erb and add the view for edit.html.erb:\r\n\r\n```sh\r\n<%= form_for @article do |f| %>\r\n  <p>\r\n    <%= f.label :title %><br>\r\n    <%= f.text_field :title %>\r\n  </p>\r\n \r\n  <p>\r\n    <%= f.label :description %><br>\r\n    <%= f.text_area :description %>\r\n  </p>\r\n \r\n  <p>\r\n    <%= f.submit \'Submit\' %>\r\n  </p>\r\n<% end %>\r\n```\r\n\r\nStep 8\r\n-------\r\n\r\nRun the test.\r\n\r\n```sh\r\n 1) Manage Articles can edit an existing article\r\n     Failure/Error: Unable to find matching line from backtrace\r\n     ActionView::Template::Error:\r\n       First argument in form cannot contain nil or be empty\r\n```\r\n\r\nStep 9\r\n-------\r\n	   \r\nChange the edit action as follows:\r\n\r\n```ruby\r\n  def edit\r\n    @article = Article.find(params[:id])\r\n  end\r\n```\r\n\r\nStep 10\r\n-------\r\n\r\nRun the test.\r\n\r\n```sh\r\n  1) Manage Articles can edit an existing article\r\n     Failure/Error: Unable to find matching line from backtrace\r\n     AbstractController::ActionNotFound:\r\n       The action \'update\' could not be found for ArticlesController\r\n```\r\n\r\nStep 11\r\n-------\r\n	   \r\nAdd the update action to the articles controller:\r\n\r\n```ruby\r\n  def update\r\n    allowed_params = params.require(:article).permit(:title, :description)\r\n    article = Article.find(params[:id])\r\n    article.update_attributes(allowed_params)\r\n    \r\n    redirect_to articles_path\r\n  end\r\n```\r\n\r\nStep 12\r\n-------\r\n\r\nRun the tests. All the tests pass.\r\n\r\nStep 13\r\n-------\r\n\r\nLet\'s use partials, change the articles/edit.html.erb:\r\n\r\n```ruby\r\n<h1>Edit Article</h1>\r\n\r\n<%= render \'form\' %>\r\n```\r\n\r\nChange the articles/new.html.erb:\r\n\r\n```ruby\r\n<h1>New Article</h1>\r\n\r\n<%= render \'form\' %>\r\n```\r\n\r\nStep 14\r\n-------\r\n\r\nCreate a form partial app/views/articles/_form.html.erb:\r\n\r\n```ruby\r\n<% if @article.errors.any? %>\r\n  <h2><%= pluralize(@article.errors.count, \"error\") %> prohibited\r\n    this article from being saved:</h2>\r\n\r\n  <ul>\r\n  <% @article.errors.full_messages.each do |m| %>\r\n    <li><%= m %></li>\r\n  <% end %>\r\n  </ul>\r\n<% end %>\r\n\r\n\r\n<%= form_for @article do |f| %>\r\n  <p>\r\n    <%= f.label :title %><br>\r\n    <%= f.text_field :title %>\r\n  </p>\r\n \r\n  <p>\r\n    <%= f.label :description %><br>\r\n    <%= f.text_area :description %>\r\n  </p>\r\n \r\n  <p>\r\n    <%= f.submit \'Submit\' %>\r\n  </p>\r\n<% end %>\r\n```\r\n\r\nStep 15\r\n-------\r\n\r\nRun : \r\n\r\n```sh\r\nrake spec\r\n```\r\n\r\nAll tests should pass.\r\n\r\nSummary\r\n=========\r\n-----------\r\n\r\nIn this lesson we wrote feature spec for updating an article feature. We also used partials to remove view duplication.\r\n','2015-03-19 22:16:19','2015-03-19 22:16:19'),(1551,'Basic TDD in Rails : View Article Feature','Objective\r\n=========\r\n----------\r\n\r\n- Learn how to use `save_and_open_page` method to debug issues in feature tests.\r\n\r\nRequirement\r\n=========\r\n----------\r\n\r\nWhen I click on the hyperlink of the article title in the index page, I should view the article title and description.\r\n\r\nSteps\r\n=========\r\n---------\r\n\r\nStep 1\r\n--------\r\n\r\nAdd the new feature test:\r\n\r\n```ruby\r\n  it \'can view the article title and description\' do\r\n    Article.create(title: \'test\', description: \'Body of the article\')\r\n    visit articles_path\r\n    \r\n    click_link \'test\'\r\n    \r\n    expect(page).to have_text(\'test\')      \r\n    expect(page).to have_text(\'Body of the article\')              \r\n  end\r\n```\r\n\r\nStep 2\r\n--------\r\n\r\nRun the test: `rspec spec/features/manage_articles_spec.rb`. \r\n\r\nError is :\r\n\r\n```sh\r\n 1) Manage Articles can view the article title and description\r\n     Failure/Error: click_link \'test\'\r\n     Capybara::ElementNotFound:\r\n       Unable to find link \"test\"\r\n```\r\n\r\nStep 3\r\n--------\r\n\r\nChange the articles/index.html.erb to make the title into a link like this:\r\n\r\n```ruby\r\n<td><%= link_to article.title, article %></td>\r\n```\r\n\r\nStep 4\r\n--------\r\n		\r\nThe test fails with the same error.\r\n\r\nStep 5\r\n--------\r\n\r\nAdd `save_and_open_page` to see what\'s going on like this:\r\n\r\n```ruby\r\n  it \'can view the article title and description\' do\r\n    Article.create(title: \'test\', description: \'Body of the article\')\r\n    visit articles_path\r\n    \r\n    save_and_open_page\r\n    \r\n    click_link \'test\'\r\n    \r\n    expect(page).to have_text(\'test\')      \r\n    expect(page).to have_text(\'Body of the article\')              \r\n  end\r\n```\r\n\r\nStep 6\r\n--------\r\n  \r\nRun the test. We get the message: \r\n\r\n```sh\r\nPlease install the launchy gem to open the file automatically.\r\n```\r\n\r\nwhen the test fails.\r\n\r\nStep 7\r\n--------\r\n\r\nAdd launchy gem to Gemfile in the test group. Run bundle. Run the test. \r\n\r\nStep 8\r\n--------\r\n\r\nWe see that the link is \'Test Article\' instead of \'test\'. The record which was created in a previous test does not get deleted before we run a new test. Change the `transactional_fixtures` flag to false in `rails_helper.rb`:\r\n\r\n```ruby\r\nconfig.use_transactional_fixtures = false\r\n```\r\n\r\nStep 9\r\n--------\r\n\r\nCreate the spec/support directory and move these lines code :\r\n\r\n```ruby\r\nRSpec.configure do |config|\r\n  \r\n  config.before(:suite) do\r\n    DatabaseCleaner.clean_with(:truncation)\r\n  end\r\n\r\n  config.before(:each) do\r\n    DatabaseCleaner.strategy = :transaction\r\n  end\r\n\r\n  config.before(:each, js: true) do\r\n    DatabaseCleaner.strategy = :truncation\r\n  end\r\n\r\n  config.before(:each) do\r\n    DatabaseCleaner.start\r\n  end\r\n\r\n  config.after(:each) do\r\n    DatabaseCleaner.clean\r\n  end\r\nend\r\n```\r\n\r\nto `spec/support/database_cleaner.rb` file.\r\n\r\nStep 10\r\n--------\r\nBefore trying this suggestion. Check the configuration in `rails_helper.rb` to make sure, this line:\r\n\r\n```ruby\r\nDir[Rails.root.join(\'spec/support/**/*.rb\')].each { |f| require f }\r\n```\r\n\r\nis uncommented. If so and the problem still persists, proceed with following:\r\n \r\nThe database still is not cleaned up after a test runs. Add after method to the `manage_articles_spec.rb`:\r\n\r\n```ruby\r\n  after(:each) do\r\n    Article.destroy_all  \r\n  end\r\n```\r\n\r\nStep 11\r\n--------\r\n  \r\nRun the test. The test now fails with :\r\n\r\n```sh\r\n  1) Manage Articles can view the article title and description\r\n     Failure/Error: Unable to find matching line from backtrace\r\n     AbstractController::ActionNotFound:\r\n       The action \'show\' could not be found for ArticlesController\r\n```\r\n\r\nStep 12\r\n--------\r\n	   \r\nAdd the show action to `articles_controller.rb`:\r\n\r\n```ruby\r\ndef	show\r\nend\r\n```\r\n\r\nStep 13\r\n--------\r\n\r\nRemove the `save_and_open_page` in the test and run the test.\r\n\r\nWe get :\r\n\r\n```ruby\r\n1) Manage Articles can view the article title and description\r\n     Failure/Error: Unable to find matching line from backtrace\r\n     ActionView::MissingTemplate:\r\n       Missing template articles/show, application/show with {:locale=>[:en], :formats=>[:html, :xml], :variants=>[], :handlers=>[:erb, :builder, :raw, :ruby, :coffee, :jbuilder]}. Searched in:\r\n         * \"/Users/zepho/projects/tdd/basics/blog/app/views\"\r\n```\r\n\r\nStep 14\r\n--------\r\n\r\nChange the show action as follows:\r\n\r\n```ruby\r\n  def show\r\n    @article = Article.find(params[:id])\r\n  end\r\n```\r\n\r\nStep 15\r\n--------\r\n\r\nAdd the articles/show.html.erb:\r\n\r\n```ruby\r\n<p>\r\n  <%= @article.title %><br>\r\n</p>\r\n\r\n<p>\r\n  <%= @article.description %><br>\r\n</p>\r\n```\r\n\r\nRun the test. All tests now pass.\r\n\r\nSummary\r\n=========\r\n-----------\r\n\r\nIn this lesson you learned how to use save_and_open_page method to troubleshoot problems when feature test fails for unknown reason. We implemented the view an article feature.\r\n	   ','2015-03-20 06:39:17','2016-12-22 20:51:51'),(1561,'Basic TDD in Rails : Delete an Article Feature','Objective\r\n=========\r\n----------\r\n\r\nTo implement delete an article feature.\r\n\r\nSteps\r\n=========\r\n---------\r\n\r\nStep 1\r\n-------\r\n\r\nWe are going to write a feature spec, to check for the \'delete\' link in the view.\r\n\r\n```ruby\r\n  it \'has delete link\' do\r\n    Article.create(title: \'test\', description: \'Body of the article\')\r\n    visit articles_path\r\n      \r\n    expect(page).to have_text(\'Delete\')\r\n  end\r\n```\r\n\r\nStep 2\r\n-------\r\n\r\nRun the test.\r\n\r\n```sh\r\n  1) Manage Articles has delete link\r\n     Failure/Error: expect(page).to have_text(\'Delete\')\r\n       expected to find text \"Delete\" in \"Listing Articles Title Description test Body of the article Edit New Article\"\r\n```\r\n\r\nStep 3\r\n-------\r\n\r\nAdd the delete link as follows:\r\n\r\n```ruby\r\n<%= link_to \'Delete\', \r\n			 article_path(article), \r\n			 :method => :delete, \r\n			 :confirm => \'Are you sure?\' %>\r\n```\r\n\r\nSo the articles/index.html.erb file now looks like this:\r\n\r\n```ruby\r\n<h1>Listing Articles</h1>\r\n\r\n<table >\r\n  <thead>\r\n    <tr>\r\n      <th>Title</th>\r\n      <th>Description</th>\r\n    </tr>\r\n  </thead>\r\n  <tbody>\r\n    <% @articles.each do |article| %>\r\n      <tr>\r\n        <td><%= link_to article.title, article %></td>\r\n        <td><%= article.description %></td>\r\n        <td>\r\n          <%= link_to \'Edit\', edit_article_path(article) %>\r\n          <%= link_to \'Delete\', \r\n											 article_path(article), \r\n											 :method => :delete, \r\n											 :confirm => \'Are you sure?\' %>\r\n		</td>\r\n      </tr>\r\n    <% end %>\r\n  </tbody>\r\n</table>\r\n\r\n<%= link_to \'New Article\', new_article_path %>\r\n```\r\n\r\nStep 4\r\n-------\r\n\r\nThe test passes.\r\n\r\nStep 5\r\n-------\r\n\r\nNow replace the it \'has delete link\' test to:\r\n\r\n```ruby\r\n  it \'can delete an article\' do\r\n    Article.create(title: \'test\', description: \'Body of the article\')\r\n    visit articles_path\r\n    \r\n    click_link \'Delete\'\r\n      \r\n    expect(page).to have_text(\'Delete success\')\r\n  end\r\n```\r\n\r\nStep 6\r\n-------\r\n\r\nRun the test. It fails with:\r\n\r\n```sh\r\nAn error occurred in an after hook\r\n    AbstractController::ActionNotFound: The action \'destroy\' could not be found for ArticlesController\r\n```\r\n\r\nStep 7\r\n-------\r\n\r\nAdd the destroy action:\r\n\r\n```ruby\r\n  def destroy\r\n    @article = Article.find(params[:id])\r\n    @article.destroy\r\n  end\r\n```\r\n\r\nStep 8\r\n-------\r\n\r\nRun the test again. It fails with:\r\n\r\n```sh\r\nAn error occurred in an after hook\r\n    ActionView::MissingTemplate: Missing template articles/destroy, application/destroy with {:locale=>[:en], :formats=>[:html], :variants=>[], :handlers=>[:erb, :builder, :raw, :ruby, :coffee, :jbuilder]}. Searched in:\r\n  * \"/Users/zepho/projects/tdd/basics/blog/app/views\"\r\n```\r\n  \r\nStep 9\r\n-------\r\n\r\nLet\'s redirect the user to the articles index page.\r\n\r\n```ruby\r\n  def destroy\r\n    @article = Article.find(params[:id])\r\n    @article.destroy\r\n    \r\n    redirect_to articles_path, notice: \'Delete success\'\r\n  end\r\n```\r\n\r\nStep 10\r\n-------\r\n\r\nRun the test again. All tests pass now.\r\n\r\nExercise\r\n=========\r\n-----------\r\n\r\nWrite a test for destroy action in articles controller to check that the destroy action redirects the user to articles index page.\r\n\r\nSummary\r\n=========\r\n-----------\r\n\r\nIn this lesson, we started with a simpler test to implement deleting an article feature, we revised the same test for deleting an article.','2015-03-20 06:52:48','2015-03-20 06:55:57'),(1571,'Basic TDD in Rails : Testing HTTP Basic Authentication','Objective\r\n===========\r\n-----------\r\n\r\nTo add HTTP Basic Authentication for Create, Edit and Delete actions.\r\n\r\nSteps\r\n=========\r\n---------\r\n\r\nStep 1\r\n-------\r\n\r\nChange the spec for \'creating a new article\' in `articles_controller_spec.rb`:\r\n\r\n```ruby\r\n  it \'should not create a new article when admin is not logged in\', :focus => true do\r\n    expect do\r\n      post :create, { article: { title: \'test\', description: \'test\' }}\r\n    end.to_not change(Article, :count)\r\n  end\r\n```\r\n\r\nStep 2\r\n-------\r\n\r\nRun the test.\r\n\r\n```sh\r\n$rspec spec/controllers/articles_controller_spec.rb --tag focus\r\n```\r\n\r\nThe test fails.\r\n\r\n```sh\r\n 1) ArticlesController should create a new article\r\n     Failure/Error: expect do\r\n       expected #count not to have changed, but did change from 0 to 1\r\n```\r\n\r\nStep 3\r\n-------\r\n\r\nAdd the `http_basic authentication` in articles controller:\r\n\r\n```ruby\r\nhttp_basic_authenticate_with name: \'user\', password: \'secret\', only: [:create]\r\n```\r\n\r\nStep 4\r\n-------\r\n\r\nRun the test.\r\n\r\n```sh\r\n$rspec spec/controllers/articles_controller_spec.rb --tag focus\r\n```\r\n\r\nIt passes. \r\n\r\nStep 5\r\n-------\r\n\r\nRun all the tests:\r\n\r\n```sh\r\n$rspec spec/controllers/articles_controller_spec.rb\r\n```\r\n\r\nAll the tests related to create fails. Using focus tag helps us to resolve one test at a time. Now we have the tests running for the create. Let\'s mark the failing tests as pending.\r\n\r\n```ruby\r\n  xit \'should redirect to articles index page after creating the article\' do\r\n  xit \'should redirect to articles index page after creating the article\' do\r\n```\r\n\r\nStep 6\r\n-------\r\n	\r\nRun all the tests.\r\n\r\nStep 7\r\n-------\r\n\r\nAdd a new test:\r\n\r\n```ruby\r\n  it \'should create a new article when admin is logged in\', :focus => true do\r\n    expect do\r\n      post :create, { article: { title: \'test\', description: \'test\' }}\r\n    end.to change(Article, :count)\r\n  end\r\n```\r\n\r\nIt fails.\r\n\r\nStep 8\r\n-------\r\n\r\nCreate `spec/support/controller_helpers.rb`:\r\n\r\n```ruby\r\nmodule ControllerHelpers\r\n  def http_basic_auth\r\n    request.env[\'HTTP_AUTHORIZATION\'] = ActionController::HttpAuthentication::Basic.encode_credentials(\'user\',\'secret\')\r\n  end  \r\nend\r\n```\r\n\r\nStep 9\r\n-------\r\n\r\nUncomment:\r\n\r\n```sh\r\nDir[Rails.root.join(\'spec/support/**/*.rb\')].each { |f| require f }\r\n```\r\n\r\nline in `rails_helper.rb`.\r\n\r\nStep 10\r\n-------\r\n\r\nAdd configuration for our `controller_helpers.rb` in `rails_helper.rb`.\r\n\r\n```sh\r\nRSpec.configure do |config|  \r\n  config.include ControllerHelpers, :type => :controller\r\n  \r\nend\r\n```\r\n\r\nStep 11\r\n-------\r\n\r\nRun the test. The new test passes.\r\n\r\nStep 12\r\n-------\r\n\r\nLet\'s create a context block for the case when the admin is logged in and include all the relevant tests inside that block as follows:\r\n\r\n```ruby\r\n  context \'Admin Logged In\' do\r\n    before(:each) do\r\n      http_basic_auth  \r\n    end\r\n  \r\n    it \'should create a new article when admin is logged in\' do\r\n      expect do\r\n        post :create, { article: { title: \'test\', description: \'test\' }}\r\n      end.to change(Article, :count)\r\n    end\r\n    \r\n    it \'should redirect to articles index page after creating the article\' do\r\n      post :create, { article: { title: \'test\', description: \'test\' }}\r\n    \r\n      expect(response).to redirect_to articles_path\r\n    end\r\n      \r\n    it \'should render the new article page if the validation fails\' do\r\n      post :create, { article: { title: \'test\' }}\r\n    \r\n      expect(response).to render_template(:new)\r\n    end\r\n  end\r\n```\r\n\r\nI have included the commented out tests inside the new context block. All tests pass now.\r\n\r\nStep 13\r\n-------\r\n\r\nWe can create another context block for the case when admin is not logged in:\r\n\r\n```ruby\r\ncontext \'Admin not logged in\' do\r\n  it \'should not create a new article when admin is not logged in\' do\r\n    expect do\r\n      post :create, { article: { title: \'test\', description: \'test\' }}\r\n    end.to_not change(Article, :count)\r\n  end\r\n\r\nend\r\n```\r\n\r\nStep 14\r\n-------\r\n\r\nAll tests pass. \r\n\r\nStep 15\r\n-------\r\n\r\nWrite the next test:\r\n\r\n```ruby\r\ncontext \'Admin not logged in\' do\r\n  it \'should not display the edit article page\' do\r\n    article = Article.create(title: \'test\', description: \'test\')\r\n    get :edit, { id: article.id }\r\n  \r\n    expect(response.code).to eq(\'401\')\r\n  end\r\n\r\nend\r\n```\r\n\r\nStep 16\r\n-------\r\n\r\nRun the test. It fails with:\r\n\r\n```ruby\r\n 1) ArticlesController Admin not logged in should not display the edit article page\r\n     Failure/Error: expect(response.code).to eq(401)\r\n       \r\n       expected: \"401\"\r\n            got: \"200\"\r\n```\r\n\r\nStep 17\r\n-------\r\n\r\n```ruby\r\nhttp_basic_authenticate_with name: \'user\', password: \'secret\', only: [:create, :edit]\r\n```\r\n\r\nStep 18\r\n-------\r\n  \r\nRun the test.\r\n\r\n```ruby\r\n$rspec spec/controllers/articles_controller_spec.rb\r\n```\r\n\r\nIt passes.\r\n\r\nStep 19\r\n-------\r\n\r\nFor admin logged in, add the test:\r\n\r\n```ruby\r\nit \'should render edit page\' do\r\n  article = Article.create(title: \'test\', description: \'test\')\r\n  get :edit, { id: article.id }\r\n  \r\n  expect(response.code).to eq(\'200\')\r\nend\r\n```\r\n\r\nIt passes.\r\n\r\nStep 20\r\n-------\r\n  \r\nProtect the update action. Look at the output of rake routes. We will use the http verb for update action in our test. \r\n\r\n```ruby\r\nit \'should return unauthorized status code for update article\' do\r\n  article = Article.create(title: \'test\', description: \'test\')\r\n  put :update, { id: article.id, article: { title: \'updated test\' }}\r\n        \r\n  expect(response.code).to eq(\'401\')\r\nend\r\n```\r\n\r\nStep 21\r\n-------\r\n\r\nRun the test. It fails.\r\n\r\n```sh\r\n1) ArticlesController Admin not logged in should return unauthorized status code for update article\r\n     Failure/Error: expect(response.code).to eq(\'401\')\r\n       \r\n       expected: \"401\"\r\n            got: \"302\"\r\n```       \r\n\r\nStep 22\r\n-------\r\n\r\n```ruby\r\nhttp_basic_authenticate_with name: \'user\', password: \'secret\', only: [:create, :edit, :update]\r\n```\r\n  \r\nStep 23\r\n-------\r\n\r\nRun the test. \r\n\r\n```sh\r\n$rspec spec/controllers/articles_controller_spec.rb\r\n```\r\n\r\nIt passes.\r\n\r\nStep 24\r\n-------\r\n\r\nFor admin logged in:\r\n\r\n```ruby\r\nit \'should update the article\' do\r\n  article = Article.create(title: \'test\', description: \'test\')\r\n  put :update, { id: article.id, article: { title: \'updated test\' }}\r\n      \r\n  article = Article.last\r\n      \r\n  expect(article.title).to eq(\'updated test\')\r\nend\r\n```\r\n\r\nThe test passes without failing. That\'s fine.\r\n\r\nExercise\r\n==========\r\n----------\r\n\r\nWrite a test for deleting an article when the admin is logged in. Write the test for both when the admin is logged in and when admin is not logged in.\r\n\r\nAnswer\r\n==========\r\n----------\r\n\r\nAdmin logged in:\r\n\r\n```ruby\r\nit \'should delete the article\' do\r\n  article = Article.create(title: \'test\', description: \'test\')\r\n  delete :destroy, { id: article.id }\r\n  \r\n  expect(Article.count).to eq(0)  \r\nend\r\n```\r\n\r\nAdmin not logged in:\r\n\r\n```ruby\r\nit \'should not delete the article\' do\r\n  article = Article.create(title: \'test\', description: \'test\')\r\n  delete :destroy, { id: article.id }\r\n  \r\n  expect(Article.count).to eq(1)  \r\nend\r\n```\r\n\r\nYou get the error:\r\n\r\n```sh\r\n 1) ArticlesController Admin not logged in should not delete the article\r\n     Failure/Error: expect(Article.count).to eq(1)\r\n       \r\n       expected: 1\r\n            got: 0\r\n```\r\n \r\nChange the controller:     \r\n\r\n```ruby \r\nhttp_basic_authenticate_with name: \'user\', password: \'secret\', only: [:create, :edit, :update, :destroy]\r\n```\r\n\r\nRun the test. All the tests will now pass.\r\n\r\nSummary\r\n=========\r\n-----------\r\n\r\nIn this lesson you learned how to write controller tests for HTTP Basic authentication. You also learned how to create reusable helpers that can be used in your controller tests.','2015-03-20 08:10:11','2016-12-22 20:54:13'),(1581,'Basic TDD in Rails : Writing View Tests','Objective\r\n=========\r\n---------\r\n\r\nTo learn how to write a view test.\r\n\r\nSteps\r\n=========\r\n---------\r\n\r\nStep 1\r\n-------\r\n\r\n```sh\r\n$rake spec\r\n```\r\n\r\nThe feature tests fail. The feature tests in `manage_articles_spec.rb`  does not seem to work with existing configuration in `database_cleaner.rb`.\r\n\r\nStep 2\r\n----------\r\n\r\nWe no longer it, since we test those in the controller tests. Delete the feature spec and run rake spec again.\r\n\r\nStep 3\r\n----------\r\n\r\nAdd a view test in `app/views/articles/index.html.erb_spec.rb`.\r\n\r\n```ruby\r\nrequire \'rails_helper\'\r\n\r\ndescribe \"articles/index.html.erb\", type: :view do\r\n  it \'displays all the articles\' do\r\n    assign(:articles, [\r\n      Article.create!(title: \'test\', description: \'description\'),\r\n      Article.create!(title: \'test2\', description: \'description2\')\r\n    ])\r\n    \r\n    render\r\n    \r\n    expect(rendered).to match /test/\r\n    expect(rendered).to match /test2/\r\n  end\r\nend\r\n```\r\n\r\nStep 4\r\n----------\r\n\r\nRun : \r\n\r\n```sh\r\n$rake spec.\r\n```\r\n\r\nNow the coverage has dropped to 93.94 %. Look at the report by doing : \r\n\r\n```sh\r\n$open coverage/index.html\r\n```\r\n\r\nWe see that the new and show action is not tested. Let\'s add controller specs to bring up our coverage back to 100%.\r\n\r\nStep 5\r\n----------\r\n\r\nAdd this :\r\n\r\n```ruby\r\n    it \'should not load new article page\' do\r\n      get :new\r\n      \r\n      expect(response.code).to eq(\'401\')\r\n    end\r\n```\r\n\r\nto the context for admin not logged in. Run the controller test.\r\n\r\nStep 6\r\n----------\r\n\r\n```sh\r\nrspec spec/controllers/articles_controller_spec.rb \r\n```\r\n\r\n```ruby\r\n1) ArticlesController Admin not logged in should not load new article page\r\n     Failure/Error: expect(response.code).to eq(\'401\')\r\n       \r\n       expected: \"401\"\r\n            got: \"200\"\r\n```\r\n\r\nStep 7\r\n----------\r\n\r\nChange articles controller :\r\n\r\n```ruby\r\nhttp_basic_authenticate_with name: \'user\', password: \'secret\', only: [:create, :edit, :update, :destroy, :new]\r\n```\r\n  \r\nStep 8\r\n----------\r\n\r\nRun all the tests. They pass.\r\n\r\nStep 9\r\n----------\r\n\r\nAdd the test under admin logged in context:\r\n\r\n```ruby\r\n    it \'should load new article page\' do\r\n      get :new\r\n      \r\n      expect(response.code).to eq(\'200\')\r\n    end\r\n```\r\n\r\nStep 10\r\n----------\r\n\r\nRun the test. It passes without failing. It\'s ok, because of the change we made earlier.\r\n\r\nStep 11\r\n----------\r\n\r\n```ruby\r\n  it \'should not load show article page\' do\r\n    article = Article.create(title: \'test\', description: \'test\')\r\n    \r\n    get :show, { id: article.id }\r\n    \r\n    expect(assigns[:article]).to_not be_nil \r\n  end\r\n```\r\n\r\nThe test passes. \r\n\r\nStep 12\r\n----------\r\n\r\nComment out the \r\n\r\n```ruby\r\n@article = Article.find(params[:id]) \r\n```\r\n\r\nline in the show action. Run the test. It fails\r\n\r\n```sh\r\n1) ArticlesController should not load show article page\r\n     Failure/Error: expect(assigns[:article]).to_not be_nil\r\n       expected: not nil\r\n            got: nil\r\n```\r\n\r\n\r\nSo we make sure that it is failing for the right reason. Let\'s uncomment that line and run rake spec. Now we are back at 100% test coverage.\r\n\r\nI spent about an hour trying to resolve the problems in the feature spec that was failing due to http basic authentication issues. Eventually I deleted the failing tests. This created gaps in our test coverage that we were able to see using the simplecov test coverage tool. We then wrote tests for the gaps to bring our test coverage back to 100%. Remember the Testing Pyramid we discussed in an earlier lesson, so we aim to follow the Testing Pyramid as much as possible while being practical during coding.\r\n\r\nSummary\r\n=========\r\n---------\r\n\r\nIn this lesson you learned how to write a view test and how to use simplecov to keep test coverage at 100%.\r\n','2015-03-20 20:06:28','2016-12-22 20:55:41'),(1591,'Basic TDD in Rails : Cleanup','Objective\r\n=========\r\n---------\r\n\r\nTo delete unnecessary files in our codebase.\r\n\r\nSteps\r\n=========\r\n---------\r\n\r\nStep 1\r\n-------\r\n\r\nRun : \r\n\r\n```sh\r\n$rake spec.\r\n```\r\n\r\nStep 2\r\n-------\r\n\r\nOpen coverage/index.html. We have 100% coverage.\r\n\r\nStep 3\r\n-------\r\n\r\nAs you look at the reports, you can see we don\'t need some of the files like `welcome_helper.rb` and `article_helper.rb`. We can delete them if we don\'t need them.\r\n\r\nYou may be thinking, \'Why did we not write any tests for the show and delete articles?\'. I wrote only feature specs. The feature specs is mostly used to cover the happy path. We also don\'t want overlapping tests. We want to test a particular thing only once. We want minimal number of tests that can give us confidence about our code.\r\n\r\nStep 4\r\n----------\r\n\r\nDelete `articles_helper` and `welcome_helper.rb` and the corresponding specs. Delete `welcome/index.html.erb_spec.rb`.\r\n\r\nSummary\r\n=========\r\n---------\r\n\r\nWe cleaned up our codebase by deleting rails generated unnecessary files.','2015-03-20 20:37:12','2016-12-22 20:56:45'),(1601,'Intermediate TDD in Rails : Subscription using Stripe API','Objective\r\n=========\r\n---------\r\n\r\nTo to get familiar with the Stripe API by reading the docs and experimenting.\r\n\r\nSteps\r\n=========\r\n---------\r\n\r\nStep 1\r\n-------\r\n\r\nAdd \r\n\r\n```ruby\r\ngem \'stripe\'\r\n```\r\n\r\nto Gemfile. \r\n\r\nStep 2\r\n-------\r\n\r\nRun bundle.\r\n\r\nStep 3\r\n-------\r\n\r\nGo to [Stripe Ruby API](https://stripe.com/docs/api?lang=ruby#intro \"Stripe Ruby API\") docs. Search for Customer.\r\n\r\nStep 4\r\n-------\r\n\r\nLet\'s play in the Rails console. Since I already have customers in my test account, I can retrieve them:\r\n\r\n```ruby\r\nrequire \"stripe\"\r\nStripe.api_key = \"sk_test_BQokikJOvBiI2HlWgH4olfQ2\"\r\n\r\ncustomers = Stripe::Customer.all\r\n```\r\n\r\nreturns a Stripe::ListObject\r\n\r\nStep 5\r\n-------\r\n\r\nCopy the output after JSON: in the terminal and paste it on [Online JSON Editor](https://www.jsoneditoronline.org/ \"Online JSON Editor\")\r\n\r\nYou can see the JSON data for each customer object. There are 10 customers. You can navigate through the data structure to view attributes and nested attributes such as subscriptions. Click on the Subscriptions in the left navigation of the API.\r\n\r\nSubscriptions allow you to charge a customer\'s card on a recurring basis. A subscription ties a customer to a particular plan you\'ve created.\r\n\r\nWe need to create plans before we can subscribe a customer. Click on the Plans, Create a Plan. Since we will only create a plan once, we can do it on the stripe dashboard. I have manually created two plans from the Stripe Dashboard called Silver and Amazing Gold Plan. \r\n\r\nStep 6\r\n-------\r\n\r\nCopy the \'Test Secret Key\' and \'Test Publishable Key\' from \'Your Account\', \'API Keys\' tab.\r\n\r\n```sh\r\nTest Secret Key : sk_test_watHqWl2XD88WHqhknk7sqXN\r\nTest Publishable Key: pk_test_GxDbP7Q6f4GkaUe0I0LrbQSz\r\n```\r\n\r\nClick on Subscriptions -> Create a Subscription. We can create a subscription for an existing customer. There does not seem to be a way to create a subscription and a customer at the same time. So, let\'s create a customer first. \r\n\r\nStep 7\r\n-------\r\n\r\nClick on Customers, Create a customer.\r\n\r\n```ruby\r\nrequire \"stripe\"\r\nStripe.api_key = \"sk_test_BQokikJOvBiI2HlWgH4olfQ2\"\r\n\r\nStripe::Customer.create(\r\n  :description => \"Customer for test@example.com\",\r\n  :source => \"tok_15hByA2eZvKYlo2CILNOo2SS\" # obtained with Stripe.js\r\n)\r\n```\r\n\r\nThe source is a token that is obtained when the credit card details is submitted by the form on our website to Stripe servers. The Stripe.js javascript will be used in the view that takes care of submitting the credit card details to Stripe servers. For now, we can use the Stripe::Token.create method to create a valid token like this:\r\n\r\n```ruby\r\ntoken = Stripe::Token.create(\r\n  card: {\r\n    number: \"4242424242424242\",\r\n    exp_month: 3,\r\n    exp_year: 2016,\r\n    cvc: \"314\"\r\n  }\r\n)\r\n```\r\n\r\nStep 8\r\n-------\r\n\r\nWe can now use the token.id as the source to create the customer:\r\n\r\n```ruby\r\ncustomer = Stripe::Customer.create(\r\n  description: \"Customer for tutorial@example.com\",\r\n  source: token.id)\r\n```\r\n\r\nWe can store the customer details in our database. If the id is not nil and there was no exceptions, it means the call succeeded. We now know:\r\n\r\n1. How to create a token\r\n2. How to create a customer using a valid token\r\n\r\nStep 9\r\n-------\r\n\r\nSo, we can create a subscription for this customer as follows:\r\n\r\n```ruby\r\ncustomer = Stripe::Customer.retrieve({CUSTOMER_ID})\r\ncustomer.subscriptions.create({:plan => PLAN_ID})\r\n```\r\n\r\nStep 10\r\n-------\r\n\r\nTo retrieve our plans we can make a call:\r\n\r\n```ruby\r\nplans = Stripe::Plan.all\r\n => #<Stripe::ListObject:0x3fc9c17aeca0> JSON: {\r\n  \"object\": \"list\",\r\n  \"has_more\": false,\r\n  \"url\": \"/v1/plans\",\r\n  \"data\": [\r\n    {\"id\":\"silver\",\"interval\":\"month\",\"name\":\"Silver\",\"created\":1415672471,\"amount\":1500,\"currency\":\"usd\",\"object\":\"plan\",\"livemode\":false,\"interval_count\":1,\"trial_period_days\":null,\"metadata\":{},\"statement_descriptor\":null},\r\n    {\"id\":\"gold\",\"interval\":\"month\",\"name\":\"Amazing Gold Plan\",\"created\":1415160352,\"amount\":2000,\"currency\":\"usd\",\"object\":\"plan\",\"livemode\":false,\"interval_count\":1,\"trial_period_days\":null,\"metadata\":{},\"statement_descriptor\":null}\r\n  ]\r\n```\r\n\r\nWe have plan with id silver and gold. We already have a customer object, let\'s create the subscription:\r\n\r\n```ruby\r\nsubscription = customer.subscriptions.create(plan: \'gold\')\r\n\r\n => #<Stripe::Subscription:0x3fc9bc510c64 id=sub_5tEIxKfqb9fjyq> JSON: {\r\n  \"id\": \"sub_5tEIxKfqb9fjyq\",\r\n  \"plan\": {\"id\":\"gold\",\"interval\":\"month\",\"name\":\"Amazing Gold Plan\",\"created\":1415160352,\"amount\":2000,\"currency\":\"usd\",\"object\":\"plan\",\"livemode\":false,\"interval_count\":1,\"trial_period_days\":null,\"metadata\":{},\"statement_descriptor\":null},\r\n  \"object\": \"subscription\",\r\n  \"start\": 1426626141,\r\n  \"status\": \"active\",\r\n  \"customer\": \"cus_5tEGApxI5MNWqN\",\r\n  \"cancel_at_period_end\": false,\r\n  \"current_period_start\": 1426626141,\r\n  \"current_period_end\": 1429304541,\r\n  \"ended_at\": null,\r\n  \"trial_start\": null,\r\n  \"trial_end\": null,\r\n  \"canceled_at\": null,\r\n  \"quantity\": 1,\r\n  \"application_fee_percent\": null,\r\n  \"discount\": null,\r\n  \"tax_percent\": null,\r\n  \"metadata\": {}\r\n} \r\n```\r\n\r\nIf the subscription id is not nil and there are no exceptions, the subscription was successful and we can save the subscription details in our database.\r\n\r\nSummary\r\n=========\r\n---------\r\n\r\nIn this lesson, we experimented with the Stripe API using stripe gem and we have learned:\r\n\r\n1. How to create a token.\r\n2. How to create a customer.\r\n3. How to subscribe a customer to one of our existing plans.\r\n\r\nIn the next lesson, we will drive the development of a library to subscribe a customer to a plan using tests.','2015-03-21 01:40:25','2015-03-21 01:44:51');
INSERT INTO `articles` VALUES (1611,'Intermediate TDD in Rails : Create a Stripe Customer','Objective\r\n=========\r\n---------\r\n\r\nTo create a Stripe customer in our Stripe account.\r\n\r\nDiscussion\r\n===========\r\n-----------\r\n\r\nBefore we interact with our external API. We need to make sure that our Stripe API library version is set properly. All the features we will develop is based on Stripe API Version = \"2015-02-18\". So the initialization code config/initializers/stripe.rb must provide the api_key and the api\\_version like this:\r\n\r\n```ruby\r\nStripe.api_key = \'sk_test_watHqWl2XD88WHqhknk7sqXN\'\r\nStripe.api_version = \"2015-02-18\"\r\n```\r\n\r\nThis is important because sometimes the newer versions will have incompatible changes and we may need to revert back to older version of the library.\r\n\r\nSteps\r\n=========\r\n---------\r\n\r\nStep 1\r\n-------\r\n\r\nCreate a spec/gateway and app/gateway folders. All the code that deals with external services will be in this directory. Gateway is an object that encapsulates access to an external system. You can read more about the [Gateway Pattern](http://martinfowler.com/eaaCatalog/gateway.html \"Gateway Pattern\") on Martin Fowler\'s site.\r\n\r\nStep 2\r\n-------\r\n\r\nThe `spec/gateway/stripe_gateway_spec.rb` looks like this:\r\n\r\n```ruby\r\nrequire \'rails_helper\'\r\nrequire \'spec_helper\'\r\n\r\ndescribe StripeGateway do\r\n  \r\n  it \'should create a customer\'\r\n  it \'should subscribe a customer to a given plan\'\r\nend\r\n```\r\n\r\nStep 3\r\n-------\r\n\r\nRun the test. We get the error:\r\n\r\n```sh\r\nuninitialized constant StripeGateway (NameError)\r\n```\r\n\r\nStep 4\r\n-------\r\n\r\nCreate an empty class:\r\n\r\n```ruby\r\nclass StripeGateway\r\nend\r\n```\r\n\r\nRun the test.\r\n\r\nStep 5\r\n-------\r\n\r\nChange the test:\r\n\r\n```ruby\r\n  before do\r\n    Stripe.api_key = \'sk_test_watHqWl2XD88WHqhknk7sqXN\'\r\n    Stripe.api_version = \"2015-02-18\"\r\n  end\r\n  \r\n  it \'should create a customer\' do\r\n    token = Stripe::Token.create(\r\n      card: {\r\n        number: \"4242424242424242\",\r\n        exp_month: 3,\r\n        exp_year: 2016,\r\n        cvc: \"314\"\r\n      }\r\n    )\r\n    \r\n    customer = StripeGateway.create_customer(token.id, \'description\')\r\n    \r\n    expect(customer.id.size).to be > 2 \r\n  end\r\n```\r\n\r\nStep 6\r\n-------\r\n\r\nRun the test. We get the error:\r\n\r\n```sh\r\nundefined method `create_customer\' for StripeGateway:Class\r\n```\r\n\r\nStep 7\r\n-------\r\n\r\nImplement the method as follows:\r\n\r\n```ruby\r\nclass StripeGateway\r\n\r\n  def self.create_customer(token, description)\r\n    Stripe::Customer.create(description: description,  source: token)\r\n  end\r\n  \r\nend\r\n```\r\n\r\nRun the test. The test passes.\r\n\r\nSummary\r\n=========\r\n-----------\r\n\r\nIn this lesson, we implemented a method that creates a Stripe customer object in our Stripe account.','2015-03-21 02:13:09','2016-12-22 20:58:35'),(1621,'Intermediate TDD in Rails : Speed Up Tests using VCR','Objective\r\n=========\r\n---------\r\n\r\nLearn how to use VCR to speed up tests.\r\n\r\nDiscussion\r\n===========\r\n-----------\r\n\r\nThe gateway test hits the real servers, the test suite will become slow as it grows. So, let\'s use VCR gem to speed up the tests. \r\n\r\nSteps\r\n=========\r\n---------\r\n\r\nStep 1\r\n-------\r\n\r\nAdd the following gems to Gemfile.\r\n\r\n```ruby\r\ngem \'vcr\'\r\ngem \'webmock\'\r\n```\r\n\r\nRun bundle.\r\n\r\nStep 2\r\n-------\r\n\r\nThe gem automatically creates the `spec/fixtures/vcr_cassettes/create_customer.yml` file when it hits the Stripe servers the first time.\r\n\r\n```sh\r\n$rspec spec/gateway/stripe_gateway_spec.rb \r\n.*\r\n\r\nPending: (Failures listed here are expected and do not affect your suite\'s status)\r\n\r\n  1) StripeGateway should subscribe a customer to a given plan\r\n     # Not yet implemented\r\n     # ./spec/gateway/stripe_gateway_spec.rb:27\r\n\r\n\r\nFinished in 0.90104 seconds (files took 3.11 seconds to load)\r\n2 examples, 0 failures, 1 pending\r\n```\r\n\r\nIt took 0.9 seconds to run one test.\r\n\r\nStep 3\r\n-------\r\n\r\nRun the same test again. It takes much less time, since it does not hit the network anymore. It loads the data from the fixture file. On my system the time it took to run it the second time was 0.32598 seconds.\r\n\r\nSummary\r\n=========\r\n---------\r\n\r\nIn this lesson we used VCR gem to record the network interactions so that tests do not go over the network, thereby speeding up our test suite.','2015-03-21 02:25:42','2016-12-22 20:59:10'),(1631,'Intermediate TDD in Rails : Subscription using Stripe API','Objective\r\n=========\r\n---------\r\n\r\nTo implement subscription feature.\r\n\r\nSteps\r\n=========\r\n---------\r\n\r\nStep 1\r\n-------\r\n\r\nWe need to create a plan once for testing purposes. Create a rake task, `stripe_plan.rake` in `lib/tasks/stripe_plan.rake`:\r\n\r\n```ruby\r\ndesc \'Create Plans for testing\'\r\nnamespace :stripe do\r\n  task :create_plan => :environment do\r\n    Stripe.api_key = \'sk_test_watHqWl2XD88WHqhknk7sqXN\'\r\n    Stripe.api_version = \"2015-02-18\"\r\n    \r\n    plan = Stripe::Plan.create(\r\n      amount: 2000,\r\n      interval: \'month\',\r\n      name: \'Test Plan\',\r\n      currency: \'usd\',\r\n      id: \'test\')\r\n\r\n    puts plan.inspect\r\n  end\r\nend\r\n```\r\n\r\nStep 2\r\n-------\r\n\r\nRun the rake task: \r\n\r\n```sh\r\n$rake stripe:create_plan. \r\n```\r\n\r\nThe output shows the attributes of the new test plan.\r\n\r\n```ruby\r\n<Stripe::Plan:0x3ffd2588d990 id=test> JSON: {\r\n  \"id\": \"test\",\r\n  \"interval\": \"month\",\r\n  \"name\": \"Test Plan\",\r\n  \"created\": 1426635709,\r\n  \"amount\": 2000,\r\n  \"currency\": \"usd\",\r\n  \"object\": \"plan\",\r\n  \"livemode\": false,\r\n  \"interval_count\": 1,\r\n  \"trial_period_days\": null,\r\n  \"metadata\": {},\r\n  \"statement_descriptor\": null\r\n}\r\n```\r\n\r\nStep 3\r\n-------\r\n\r\nWrite a test to subscribe a customer to a given plan.\r\n\r\n```ruby\r\n  it \'should subscribe a customer to a given plan\' do\r\n    VCR.use_cassette \"create subscription\" do\r\n      stripe_plan_id = \'test\'\r\n      token = Stripe::Token.create(\r\n        card: {\r\n          number: \"4242424242424242\",\r\n          exp_month: 3,\r\n          exp_year: 2016,\r\n          cvc: \"314\"\r\n        }\r\n      )\r\n      customer = StripeGateway.create_customer(token.id, \'description\')\r\n      stripe_customer_id = customer.id\r\n    \r\n      subscription = StripeGateway.create_subscription(stripe_customer_id, stripe_plan_id)\r\n    \r\n      expect(subscription.id.size).to be > 2\r\n    end\r\n  end\r\n```\r\n\r\nRun the test. \r\n\r\n```sh\r\n$rspec spec/gateway/stripe_gateway_spec.rb \r\n```\r\n\r\nStep 4\r\n-------\r\n\r\nImplement the subscription feature in `app/gateway/stripe_gateway.rb`.\r\n\r\n```ruby\r\n  def self.create_subscription(stripe_customer_id, stripe_plan_id)\r\n    customer = Stripe::Customer.retrieve(stripe_customer_id)\r\n    customer.subscriptions.create(plan: stripe_plan_id)\r\n  end\r\n```\r\n\r\nRun the test.\r\n\r\nStep 5\r\n-------\r\n\r\nIt fails.\r\n\r\n```sh\r\n  1) StripeGateway should subscribe a customer to a given plan\r\n     Failure/Error: subscription = StripeGateway.create_subscription(stripe_customer_id, stripe_plan_id)\r\n     VCR::Errors::UnhandledHTTPRequestError:\r\n       \r\n       \r\n       ================================================================================\r\n       An HTTP request has been made that VCR does not know how to handle:\r\n         GET https://api.stripe.com/v1/customers/cus_5tHIlHbNEjqssk\r\n       \r\n       VCR is currently using the following cassette:\r\n         - /Users/zepho/projects/tdd/basics/blog/spec/fixtures/vcr_cassettes/create_subscription.yml\r\n         - :record => :once\r\n         - :match_requests_on => [:method, :uri]\r\n       \r\n       Under the current configuration VCR can not find a suitable HTTP interaction\r\n       to replay and is prevented from recording new requests. There are a few ways\r\n       you can deal with this:\r\n       \r\n         * If you\'re surprised VCR is raising this error\r\n           and want insight about how VCR attempted to handle the request,\r\n           you can use the debug_logger configuration option to log more details [1].\r\n         * You can use the :new_episodes record mode to allow VCR to\r\n           record this new request to the existing cassette [2].\r\n         * If you want VCR to ignore this request (and others like it), you can\r\n           set an `ignore_request` callback [3].\r\n         * The current record mode (:once) does not allow new requests to be recorded\r\n           to a previously recorded cassette. You can delete the cassette file and re-run\r\n           your tests to allow the cassette to be recorded with this request [4].\r\n       \r\n       [1] https://www.relishapp.com/vcr/vcr/v/2-9-3/docs/configuration/debug-logging\r\n       [2] https://www.relishapp.com/vcr/vcr/v/2-9-3/docs/record-modes/new-episodes\r\n       [3] https://www.relishapp.com/vcr/vcr/v/2-9-3/docs/configuration/ignore-request\r\n       [4] https://www.relishapp.com/vcr/vcr/v/2-9-3/docs/record-modes/once\r\n```\r\n\r\nSince I changed the tests a few times and ran the changed test many time. It results in the above error.\r\n\r\nStep 6\r\n-------\r\n\r\nLet\'s delete `create_subscriptions.yml` and run the test again. All the tests will pass. You can login to the Stripe account and see the calls made to the Stripe server by looking at the Logs under the Requests. If you go to the Customers and click on the customer link you can see the details of the subscription.\r\n\r\nStep 7\r\n-------\r\n\r\nWhen the tests are run, you can see significant improvement in the test run time.\r\n\r\n```sh\r\n$rspec spec/gateway/stripe_gateway_spec.rb \r\n..\r\n\r\nFinished in 1.75 seconds (files took 2.63 seconds to load)\r\n2 examples, 0 failures\r\n\r\nCoverage report generated for RSpec to /Users/zepho/projects/tdd/basics/blog/coverage. 7 / 7 LOC (100.0%) covered.\r\n$rspec spec/gateway/stripe_gateway_spec.rb \r\n..\r\n\r\nFinished in 0.32936 seconds (files took 2.59 seconds to load)\r\n2 examples, 0 failures\r\n\r\nCoverage report generated for RSpec to /Users/zepho/projects/tdd/basics/blog/coverage. 7 / 7 LOC (100.0%) covered.\r\n```\r\n\r\nStep 8\r\n-------\r\n\r\nI want to bundle all the methods related to subscription into it\'s own class. This will make it easy during maintenance to see which methods belong to which use case. So the code now looks like this:\r\n\r\n```ruby\r\nmodule StripeGateway\r\n\r\n  class Subscription\r\n    def self.create_customer(token, description)\r\n      Stripe::Customer.create(description: description,  source: token)\r\n    end\r\n  \r\n    def self.create(stripe_customer_id, stripe_plan_id)\r\n      customer = Stripe::Customer.retrieve(stripe_customer_id)\r\n      customer.subscriptions.create(plan: stripe_plan_id)\r\n    end    \r\n  end\r\n  \r\nend\r\n```\r\n\r\nThe corresponding tests are:\r\n\r\n```ruby\r\nrequire \'rails_helper\'\r\nrequire \'spec_helper\'\r\n\r\ndescribe StripeGateway::Subscription do\r\n  before do\r\n    Stripe.api_key = \'sk_test_watHqWl2XD88WHqhknk7sqXN\'\r\n    Stripe.api_version = \"2015-02-18\"\r\n  end\r\n  \r\n  it \'should create a customer\' do\r\n    VCR.use_cassette \"create customer\" do\r\n      token = Stripe::Token.create(\r\n        card: {\r\n          number: \"4242424242424242\",\r\n          exp_month: 3,\r\n          exp_year: 2016,\r\n          cvc: \"314\"\r\n        }\r\n      )\r\n    \r\n      customer = StripeGateway::Subscription.create_customer(token.id, \'description\')\r\n    \r\n      expect(customer.id.size).to be > 2 \r\n    end\r\n  end\r\n  \r\n  it \'should subscribe a customer to a given plan\' do\r\n    VCR.use_cassette \"create subscription\" do\r\n      stripe_plan_id = \'test\'\r\n      token = Stripe::Token.create(\r\n        card: {\r\n          number: \"4242424242424242\",\r\n          exp_month: 3,\r\n          exp_year: 2016,\r\n          cvc: \"314\"\r\n        }\r\n      )\r\n      customer = StripeGateway::Subscription.create_customer(token.id, \'description\')\r\n      stripe_customer_id = customer.id\r\n    \r\n      subscription = StripeGateway::Subscription.create(stripe_customer_id, stripe_plan_id)\r\n    \r\n      expect(subscription.id.size).to be > 2\r\n    end\r\n  end\r\nend\r\n```\r\n\r\nStep 9\r\n-------\r\n\r\nRun \r\n\r\n```sh\r\n$rake spec\r\n```\r\n\r\nThere are two failures due to VCR :\r\n\r\n```sh\r\nrspec ./spec/features/home_page_spec.rb:5 # Home Page must load\r\nrspec ./spec/features/home_page_spec.rb:11 # Home Page has link to my blog\r\n```\r\n\r\nStep 10\r\n-------\r\n\r\nAdd :\r\n\r\n```ruby\r\nc.allow_http_connections_when_no_cassette = true\r\n```\r\n\r\nto the VCR.config block in rails_helper.rb:\r\n\r\n```ruby\r\nVCR.configure do |c|\r\n  c.cassette_library_dir = \'spec/fixtures/vcr_cassettes\'\r\n  c.hook_into :webmock # or :fakeweb\r\n  c.allow_http_connections_when_no_cassette = true\r\nend\r\n```\r\n\r\nRunning rake spec will now run all tests successfully. You can open coverage/index.html to view the coverage report.\r\n\r\nSummary\r\n=========\r\n-----------\r\n\r\nIn this lesson we did the following:\r\n\r\n1. Created a plan using rake task.\r\n2. Wrote a test to subscribe a customer to a plan.\r\n3. Implemented the subscription feature.\r\n4. Learned how to record network interactions when a test using VCR fails.\r\n5. Configured VCR to turn off VCR for local network calls for feature tests.','2015-03-21 21:29:21','2016-12-22 21:00:40'),(1641,'Intermediate TDD in Rails : Install and Configure Devise','Objective\r\n=========\r\n---------\r\n\r\nInstall and configure devise.\r\n\r\nRequirement\r\n=========\r\n---------\r\n\r\nWhen a user registers and logs in to our site, we will present the different subscription plans they can choose from. This lesson will focus on devise installation and configuration. We will write tests and drive the implementation in the next lesson.\r\n\r\nSteps\r\n=========\r\n---------\r\n\r\nStep 1\r\n-------\r\n\r\nAdd\r\n\r\n```ruby\r\ngem \'devise\' \r\n```\r\n\r\nto Gemfile. Run bundle.\r\n\r\nStep 2\r\n-------\r\n\r\nRun:\r\n\r\n```ruby\r\n$rails g devise:install\r\n```\r\n\r\nStep 3\r\n-------\r\n\r\nAdd: \r\n\r\n```ruby\r\nconfig.action_mailer.default_url_options = { host: \'localhost\', port: 3000 }\r\n```\r\n\r\nto config/environments/development.rb\r\n\r\nStep 4\r\n-------\r\n\r\nAdd : \r\n\r\n```ruby\r\n  <p class=\"notice\"><%= notice %></p>\r\n  <p class=\"alert\"><%= alert %></p>\r\n```\r\n\r\nto app/views/layouts/application.html.erb file. The layout file now looks like this:\r\n\r\n```ruby\r\n<!DOCTYPE html>\r\n<html>\r\n<head>\r\n  <title>Blog</title>\r\n  <%= stylesheet_link_tag    \'application\', media: \'all\', \'data-turbolinks-track\' => true %>\r\n  <%= javascript_include_tag \'application\', \'data-turbolinks-track\' => true %>\r\n  <%= csrf_meta_tags %>\r\n</head>\r\n<body>\r\n\r\n   <p class=\"notice\"><%= notice %></p>\r\n   <p class=\"alert\"><%= alert %></p>\r\n\r\n<%= yield %>\r\n\r\n</body>\r\n</html>\r\n```\r\n\r\nStep 5\r\n-------\r\n\r\nCopy devise views for customization.\r\n\r\n```ruby\r\n$rails g devise:views\r\n```\r\n\r\nStep 6\r\n-------\r\n\r\nCreate the user model.\r\n\r\n```ruby\r\n$rails g devise user\r\n```\r\n\r\nStep 7\r\n-------\r\n\r\nCreate the table.\r\n\r\n```ruby\r\n$rake db:migrate\r\n```\r\n\r\nSummary\r\n=========\r\n-----------\r\n\r\nIn this lesson we installed and configured devise to manage user accounts.','2015-03-21 21:51:06','2015-03-21 21:52:22'),(1651,'Intermediate TDD in Rails : Register for an Account','Objective\r\n=========\r\n---------\r\n\r\nTo implement signup for an account feature.\r\n\r\nWe now have devise gem installed and configured. When a user registers and logs in to our site, we will present the different subscription plans they can choose from. We can now write tests and drive the implementation in this lesson.\r\n\r\nHigh Level View\r\n=========\r\n---------\r\n\r\nHere are the steps for signup feature:\r\n\r\n1. A user clicks on Register link on the home page\r\n2. Fill out email and password\r\n3. The user record must be created in our database\r\n4. The user must be automatically signed in after successful registration\r\n\r\nWe will not send any confirmation emails because we want the user to experience our great SaaS app immediately.\r\n\r\nSteps\r\n=========\r\n---------\r\n\r\nStep 1\r\n-------\r\n\r\nLet\'s translate the steps we have in the high level view to a feature test. Create a `spec/features/user_registration_spec.rb`.\r\n\r\n```ruby\r\nrequire \'rails_helper\'\r\nrequire \'spec_helper\'\r\n\r\nfeature \"User Registration\", :type => :feature do\r\n  scenario \"success\" do\r\n    visit root_path\r\n    click_link \'Register\'\r\n    fill_in \'Email\', with: \'bugs@rubyplus.com\'\r\n    fill_in \'Password\', with: \'secret\'\r\n    \r\n	\r\n    expect(page).to have_text(\"You are logged in\")\r\n  end\r\n  \r\nend\r\n```\r\n\r\nStep 2\r\n-------\r\n\r\nRun the test. `rspec spec/features/user_registration_spec.rb`.\r\n\r\n```sh\r\nUnable to find link \"Register\"\r\n```\r\n\r\nStep 3\r\n-------\r\n\r\nAdd:\r\n\r\n```ruby\r\n   <%= link_to \'Register\', new_user_registration_path %>\r\n```\r\n      \r\nto the app/views/layouts/application.html.erb\r\n\r\nStep 4 \r\n-------\r\n   \r\nRun the test.\r\n\r\nStep 5\r\n-------\r\n\r\nThe test fails.\r\n\r\nWe want a simple registration page with minimal work for the user to register. Let\'s get rid of the password confirmation field in the login page. Delete :\r\n\r\n```ruby\r\n  <div class=\"field\">\r\n    <%= f.label :password_confirmation %><br />\r\n    <%= f.password_field :password_confirmation, autocomplete: \"off\" %>\r\n  </div>\r\n```\r\n\r\nin app/views/devise/registrations/new.html.erb\r\n\r\nStep 6\r\n-------\r\n\r\nRun the test again.\r\n\r\nStep 7\r\n-------\r\n\r\nWe forgot to click the Signup button. Let\'s revise our test:\r\n\r\n```ruby\r\n  scenario \"success\" do\r\n    visit root_path\r\n    click_link \'Register\'\r\n    fill_in \'Email\', with: \'bugs@rubyplus.com\'\r\n    fill_in \'Password\', with: \'secret\'\r\n    \r\n    click_button \'Sign up\'\r\n\r\n    expect(page).to have_text(\"You are logged in\")\r\n  end\r\n```\r\n  \r\nRun the test.\r\n \r\nStep 8\r\n-------\r\n \r\nWe get the error:\r\n\r\n```sh \r\n  expected to find text \"You are logged in\" in \"Register Sign up 1 error prohibited this user from being saved: Password is too short (minimum is 8 characters) Email Password (8 characters minimum) Log in\"\r\n```\r\n \r\nChange the password value:\r\n\r\n```ruby \r\n fill_in \'Password\', with: \'12345678\'\r\n```\r\n \r\nRun the test.\r\n \r\nStep 9\r\n-------\r\n \r\nIt fails: \r\n\r\n```sh\r\n1) User Registration success\r\n   Failure/Error: expect(page).to have_text(\"You are logged in\")\r\nexpected to find text \"You are logged in\" in \"Register Welcome! You have signed up successfully. My Blog My Blog\"\r\n```\r\n		\r\nFor now, the default message by devise is good enough. Let\'s change the expectation as follows:\r\n\r\n```ruby		\r\n  expect(page).to have_text(\"You have signed up successfully.\")\r\n```\r\n\r\nStep 10\r\n-------\r\n		\r\nRun the test. The test passes.\r\n		\r\nSummary\r\n=========\r\n---------\r\n		\r\nIn this lesson we implemented the user registration feature driving by test.		','2015-03-21 22:01:46','2016-12-22 21:02:27'),(1661,'Intermediate TDD in Rails : Choose a Subscription Plan','Objective\r\n=========\r\n---------\r\n\r\nDisplay the plans in the welcome page to allow the user to choose a subscription plan.\r\n\r\nHigh Level View\r\n=========\r\n---------\r\n\r\n1. When a user is logged in, display the list of all plans\r\n2. Click on the gold plan\r\n3. Subscribe the user to the gold plan\r\n\r\nSteps\r\n=========\r\n---------\r\n\r\nStep 1\r\n-------\r\n\r\nCreate a file called spec/features/subscription_spec.rb\r\n\r\n```ruby\r\nrequire \'rails_helper\'\r\nrequire \'spec_helper\'\r\n\r\nfeature \"Subscribe\", :type => :feature do\r\n  scenario \"to gold plan\" do\r\n    visit root_path\r\n    click_link \'Register\'\r\n    fill_in \'Email\', with: \'bugs@rubyplus.com\'\r\n    fill_in \'Password\', with: \'12345678\'\r\n    \r\n    click_button \'Sign up\'\r\n    click_link \'Gold\'\r\n\r\n    expect(page).to have_text(\"You are now on gold plan.\")\r\n  end\r\n  \r\nend\r\n```\r\n\r\nStep 2\r\n-------\r\n\r\nRun the test. It fails with error:  Unable to find link \"Gold\"\r\n\r\nStep 3\r\n-------\r\n\r\nWe need to add the links to welcome page:\r\n\r\n```ruby\r\n<ul>\r\n	<li><%= link_to \'Gold\',  %></li>\r\n	<li><%= link_to \'Silver\',  %></li>\r\n</ul>\r\n```\r\n\r\nWhat should be the url_helper we can use?\r\n\r\nStep 4\r\n-------\r\n\r\nDefine the routes in routes.rb:\r\n\r\n```ruby\r\nget \'subscriptions/new\' => \'subscriptions#new\', as: :new_subscription\r\npost \'subscriptions/create\' => \'subscriptions#create\'\r\n```\r\n\r\nStep 5\r\n-------\r\n\r\nLet\'s revise view in step 3. When a user clicks on a plan, we will send that as the query parameter so that we know which plan they selected:\r\n\r\n```ruby\r\n<ul>\r\n	<%= link_to \'Gold\', new_subscription_path(:plan_name => \'gold\') %> <br/>\r\n	<%= link_to \'Silver\', new_subscription_path(:plan_name => \'silver\') %> <br/>\r\n</ul>\r\n```\r\n\r\nNote that the value for plan_name we have here in the link must match the plan id for the plans you have created in the Stripe dashboard.\r\n\r\nStep 6\r\n-------\r\n\r\nWe need a subscriptions controller.\r\n\r\n```ruby\r\n$rails g controller subscriptions new create\r\n```\r\n\r\nDelete the following Rails generated routes:\r\n\r\n```ruby\r\n  get \'subscriptions/new\'\r\n\r\n  get \'subscriptions/create\'\r\n```\r\n\r\nStep 7\r\n-------\r\n\r\nIf you run the existing tests generated by rspec. It will pass.\r\n\r\n```ruby\r\n$rspec spec/controllers/subscriptions_controller_spec.rb \r\n```\r\n\r\nStep 8\r\n-------\r\n\r\nAdd the new test:\r\n\r\n```ruby\r\nit \'should initialize the plan name\' do\r\n  get :new, { plan_name: \'gold\' }\r\n  \r\n  expect(assigns[:plan_name]).to eq(\'gold\')\r\nend\r\n```\r\n\r\nRun the test. It fails.\r\n\r\nStep 9\r\n-------\r\n\r\nChange the new action in subscriptions_controller.rb:\r\n\r\n```ruby\r\n  def new\r\n    @plan_name = params[:plan_name]      \r\n  end\r\n```\r\n\r\nRun the test. It passes.\r\n\r\nStep 10\r\n-------\r\n\r\nThe subscriptions controller should use stripe layout.\r\n\r\n```ruby\r\nit \'should use stripe layout\' do\r\n  get :new, { plan_name: \'gold\' }\r\n  \r\n  expect(response).to render_template(layout: \'stripe\')\r\nend\r\n```\r\n\r\nRun the test.\r\n\r\n```sh\r\n 1) SubscriptionsController GET #new should use stripe layout\r\n     Failure/Error: expect(response).to render_template(layout: \'stripe\')\r\n       expecting layout <stripe> but action rendered <[\"layouts/application\", \"application\"]>.\r\n       Expected [\"layouts/application\", \"application\"] to include \"stripe\".\r\n```\r\n\r\nStep 11\r\n-------\r\n	 \r\nCreate an empty file in app/views/layouts/stripe.html.erb\r\n\r\nStep 12\r\n-------\r\n	 \r\nAdd the layout \'stripe\' in subscriptions controller.\r\n\r\n```ruby\r\nclass SubscriptionsController < ApplicationController\r\n  layout \'stripe\'  \r\n  \r\n  def new\r\n    @plan_name = params[:plan_name]      \r\n  end\r\n\r\n  def create\r\n  end\r\nend\r\n```\r\n\r\nThe test now passes.\r\n\r\nStep 13\r\n-------\r\n\r\nrun the feature spec : \r\n\r\n```sh\r\n$rspec spec/features/subscription_spec.rb \r\n```\r\nIt fails with error: Unable to find link \"Gold\"\r\n\r\nStep 14\r\n-------\r\n\r\nAdd the links to the plans in the welcome/index.html.erb\r\n\r\n```ruby\r\n<h1>My Blog</h1>\r\n\r\n<%= link_to \'Gold\', new_subscription_path(:plan_name => \'gold\') %> <br/>\r\n<%= link_to \'Silver\', new_subscription_path(:plan_name => \'silver\') %> <br/>\r\n\r\n<%= link_to \'My Blog\', articles_path %>\r\n```\r\n\r\nStep 15\r\n-------\r\n\r\nRun the test. It fails. Copy the same content in application.html.erb to stripe.html for now. Eventually the strip.html.erb will turn off the turbo links when our test calls for it. \r\n\r\nAdd the text \'You are now on gold plan.\' to app/views/subsciptions/new.html.erb. The test passes. \r\n\r\nSummary\r\n=========\r\n---------\r\n\r\nIn this lesson we displayed the plans available for subscription to the user. The feature is not complete, before we can subscribe a user, we need to get their credit card details. We will be discussing it in the upcoming lessons.','2015-03-21 22:19:55','2015-03-21 22:22:44'),(1671,'Intermediate TDD in Rails : Payment Form','Objective\r\n=========\r\n---------\r\n\r\nIn order to subscribe a registered user, they must fill out credit card details form. \r\n\r\nScope\r\n=========\r\n---------\r\n\r\nThe html and javascript files needed to get the payment form working will not be explained in detail. They are explained in detail with examples on stripe.com. You need to play with the example code to become familiar with how the payment flow works with Stripe servers.\r\n\r\nSteps\r\n=========\r\n---------\r\n\r\nStep 1\r\n-------\r\n\r\nChange the subscription_spec.rb as follows:\r\n\r\n```ruby\r\nrequire \'rails_helper\'\r\nrequire \'spec_helper\'\r\n\r\nfeature \"Subscribe\", :type => :feature do\r\n  scenario \"to gold plan\" do\r\n    visit root_path\r\n\r\n    click_link \'Register\'\r\n    fill_in \'Email\', with: \'bugs@rubyplus.com\'\r\n    fill_in \'Password\', with: \'12345678\'    \r\n    click_button \'Sign up\'\r\n    \r\n    click_link \'Gold\'\r\n    fill_in \"Card Number\", with: \'4242424242424242\'\r\n    page.select \'10\', from: \"card_month\"\r\n    page.select \'2029\', from: \'card_year\'\r\n    click_button \'Subscribe Me\'\r\n\r\n    expect(page).to have_text(\"You are now on gold plan.\")\r\n  end\r\n  \r\nend\r\n```\r\n\r\nRun the test. It fails with the error: Unable to find field \"Card Number\"\r\n\r\nStep 2\r\n-------\r\n\r\nLet\'s add the payment form in the subscriptions/new.html.erb:\r\n\r\n```ruby\r\n<form action=\"create\" method=\"POST\" id=\"payment-form\">\r\n  <span class=\"payment-errors\">\r\n  	<noscript>JavaScript is not enabled and is required for this form. First enable it in your web browser settings.</noscript>\r\n  </span>\r\n  <%= hidden_field_tag :authenticity_token, form_authenticity_token -%>\r\n  <%= hidden_field_tag :plan_name, @plan_name %>\r\n\r\n  <% if @error_message %>\r\n	<%= @error_message %>\r\n  <% end %>\r\n\r\n  <div class=\"form-row\">\r\n    <label>\r\n      <span>Card Number</span>\r\n      <input type=\"text\" size=\"20\" data-stripe=\"number\"/>\r\n    </label>\r\n  </div>\r\n\r\n  <div class=\"form-row\">\r\n    <label>\r\n      <span>Expiration</span>\r\n<%= select_month nil, {add_month_numbers: true}, {name: nil, id: \"card_month\", data: {stripe: \"exp-month\"}} %>\r\n      \r\n    </label>\r\n    <span>/</span>\r\n	<%= select_year nil, {start_year: Date.today.year, end_year: Date.today.year+15}, {name: nil, id: \"card_year\", data: {stripe: \"exp-year\"}} %>\r\n	\r\n  </div>\r\n\r\n  <button type=\"submit\" class=\'btn btn-primary\'>Subscribe Me</button>\r\n\r\n</form>\r\n```\r\n\r\nThe credit card related form values will not be submitted to our servers.\r\n\r\nStep 3\r\n-------\r\n\r\nWe also need to change the stripe.html.erb as follows:\r\n\r\n```ruby\r\n<!DOCTYPE html>\r\n<html lang=\"en\">\r\n  <head>\r\n	<meta charset=\"utf-8\">\r\n    <meta http-equiv=\"X-UA-Compatible\" content=\"IE=edge\">\r\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1\">\r\n	<title>Striped</title>\r\n  <%= stylesheet_link_tag    \'application\', media: \'all\', \'data-turbolinks-track\' => true %>\r\n  <%= javascript_include_tag \'application\' %>\r\n  \r\n  <%= javascript_include_tag \'https://js.stripe.com/v2/\' %>\r\n  <%= tag :meta, :name => \"stripe-key\", :content => \'pk_test_GxDbP7Q6f4GkaUe0I0LrbQSz\' %>\r\n\r\n  <script type=\"text/javascript\">\r\n    // This identifies your website in the createToken call below\r\n    Stripe.setPublishableKey($(\'meta[name=\"stripe-key\"]\').attr(\'content\'));\r\n  \r\n    var stripeResponseHandler = function(status, response) {\r\n      var $form = $(\'#payment-form\');\r\n\r\n      if (response.error) {\r\n        // Show the errors on the form\r\n        $form.find(\'.payment-errors\').text(response.error.message);\r\n        $form.find(\'button\').prop(\'disabled\', false);\r\n      } else {\r\n        // token contains id, last4, and card type\r\n        var token = response.id;\r\n\r\n        // Insert the token into the form so it gets submitted to the server\r\n        $form.append($(\'<input type=\"hidden\" name=\"stripeToken\" />\').val(token));\r\n\r\n        // and re-submit\r\n        $form.get(0).submit();\r\n      }\r\n    };\r\n    \r\n    jQuery(function($) {\r\n      $(\'#payment-form\').submit(function(event) {\r\n\r\n        var $form = $(this);\r\n\r\n        // Disable the submit button to prevent repeated clicks\r\n        $form.find(\'submit\').prop(\'disabled\', true);\r\n\r\n        Stripe.card.createToken($form, stripeResponseHandler);\r\n\r\n        // Prevent the form from submitting with the default action\r\n        return false;\r\n      });\r\n    });\r\n      \r\n  </script>  \r\n   \r\n	<%= csrf_meta_tags %>\r\n	<!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->\r\n    <!-- WARNING: Respond.js doesn\'t work if you view the page via file:// -->\r\n    <!--[if lt IE 9]>\r\n      <script src=\"https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js\"></script>\r\n      <script src=\"https://oss.maxcdn.com/respond/1.4.2/respond.min.js\"></script>\r\n    <![endif]-->\r\n  </head>\r\n\r\n  <body data-no-turbolink>\r\n\r\n	<div class=\'container\'>\r\n		<%= yield %>\r\n	</div>\r\n	\r\n  </body>\r\n</html>\r\n```\r\n\r\nYou can see that the turbo-links has been turned off. You also need to change the stripe-key, content value to your website Stripe Publishable Key value. Run the test. It fails with:\r\n\r\n```sh\r\nFailure/Error: expect(page).to have_text(\"You are now on gold plan.\")\r\n       expected to find text \"You are now on gold plan.\" in \"Subscriptions#create Find me in app/views/subscriptions/create.html.erb\"\r\n```\r\n\r\nStep 4\r\n-------\r\n	   \r\nYou can tail the test.log file. \r\n\r\n```sh\r\ntail -f log/test.log\r\n```\r\n\r\nYou can see that it went to subsriptions controller create action. We need to implement it now.\r\n\r\nStep 5\r\n-------\r\n\r\nWe already have create subscription implemented in the stripe gateway class. It requires two remote calls, after some digging into the Stripe API docs, I found a way to create and subscribe a user to a plan with just one remote call:\r\n\r\n```ruby\r\nmodule StripeGateway\r\n\r\n  class Subscription\r\n    \r\n    def self.create(email, stripe_token, stripe_plan_id)\r\n      Stripe::Customer.create(description: email, card: stripe_token, plan: stripe_plan_id)      \r\n    end\r\n  end\r\nend  \r\n```\r\n\r\nWe can delete the old methods in the stripe gateway class. The subscriptions_controller can use this method:\r\n\r\n```ruby\r\nclass SubscriptionsController < ApplicationController\r\n  layout \'stripe\'  \r\n  \r\n  def new\r\n    @plan_name = params[:plan_name]      \r\n  end\r\n\r\n  def create\r\n    StripeGateway::Subscription.create(current_user.email, params[:stripeToken], params[:plan_name])    \r\n  end\r\nend\r\n```\r\n\r\nChange the subscriptions/create.html.erb to : You are now on gold plan.\r\n\r\nStep 6\r\n-------\r\n\r\nRun the test. It fails with:\r\n\r\n```sh\r\nStripe::AuthenticationError:\r\n       No API key provided. Set your API key using \"Stripe.api_key = <API-KEY>\". You can generate API keys from the Stripe web interface. See https://stripe.com/api for details, or email support@stripe.com if you have any questions.\r\n```\r\n\r\nAdd the before block to configure the api\\_key as follows in the subscription\\_spec.rb:\r\n\r\n```ruby\r\n  before do\r\n    Stripe.api_key = \'sk_test_watHqWl2XD88WHqhknk7sqXN\'\r\n    Stripe.api_version = \"2015-02-18\"\r\n  end\r\n```\r\n\r\nRun the test again. The test passes. You can now login to the Stripe dash board and check if the customer is created or not. \r\n\r\nSummary\r\n=========\r\n---------\r\n\r\nIn this lesson we implemented a payment form where the user can enter credit card details to subscribe to a plan.','2015-03-21 22:30:31','2016-12-22 21:04:17'),(1681,'Intermediate TDD in Rails : Subscription Model','Objective\r\n=========\r\n---------\r\n\r\nTo create a subscription model.\r\n\r\nDiscussion\r\n==========\r\n-----------\r\n\r\nWe need to save the subscriptions detail in our database.  Why do we need to save it in our database? Because we can send credit card expiration emails for credit cards that are about to expire so that our subscribers can update their credit card on our site.\r\n\r\nWe will store the subscription related information in subscription model. It will contain plan\\_name (plan id of the stripe plan), stripe\\_customer\\_token, expiration month, year and last 4 digits of the credit card.\r\n\r\nSteps\r\n=========\r\n---------\r\n\r\nStep 1\r\n-------\r\n\r\nCreate the subscription model.\r\n\r\n```ruby\r\n$rails g model subscription\r\n```\r\n\r\nStep 2\r\n-------\r\n\r\nChange the create\\_subscriptions.rb file:\r\n\r\n```ruby\r\nclass CreateSubscriptions < ActiveRecord::Migration\r\n  def change\r\n    create_table :subscriptions do |t|\r\n      t.string   :plan_name\r\n      t.string   :stripe_customer_token\r\n      t.string   :last4digits, limit: 4\r\n      t.integer  :expiration_month, limit: 4\r\n      t.integer  :expiration_year,  limit: 4\r\n\r\n      t.integer  :user_id\r\n      \r\n      t.timestamps null: false\r\n    end\r\n  end\r\nend\r\n```\r\n\r\nStep 3\r\n-------\r\n\r\nCreate the app/models/subscription\\_spec.rb\r\n\r\n```ruby\r\nrequire \'rails_helper\'\r\n\r\ndescribe Subscription do\r\n  it \'belongs to user\' do\r\n    subscription = Subscription.new\r\n    \r\n    expect(subscription.respond_to?(:user)).to be true\r\n  end\r\nend\r\n```\r\n\r\nStep 4\r\n-------\r\n\r\nRun the test: \r\n\r\n```sh\r\n$rspec spec/models/subscription_spec.rb\r\n```\r\n\r\nIt fails.\r\n\r\nStep 5\r\n-------\r\n\r\nAdd \r\n\r\n```ruby\r\nbelongs_to :user  \r\n```\r\n\r\ndeclaration to subscription.rb. Run the test. It passes.\r\n \r\nSummary\r\n=========\r\n-----------\r\n\r\nIn this lesson we created the subscription model to save the subscription details in the database.','2015-03-21 22:45:20','2016-12-22 21:05:27'),(1691,'Intermediate TDD in Rails : Encapsulating the Stripe Response','Objective\r\n=========\r\n---------\r\n\r\nTo encapsulate the parsing of the Stripe response in it\'s own class.\r\n\r\nSteps\r\n=========\r\n---------\r\n\r\nStep 1\r\n-------\r\n\r\nI would like to make a call in the subscriptions_controller.rb create action like this:\r\n\r\n```ruby\r\nSubscription.save_details(stripe_customer, current_user, plan_name) \r\n```\r\n\r\nThis should save the `stripe_customer_token`, `plan_name`, last 4 digits, `expiration_month` and `expiration_month` of credit card.\r\n\r\nStep 2\r\n-------\r\n\r\nIn order to accomplish that, we need to navigate the stripe customer JSON response from the Stripe servers and retrieve the customer id and the credit card details. The Stripe API docs shows the structure of the customer object:\r\n\r\n```json \r\n  {\r\n   \"object\": \"customer\",\r\n   \"created\": 1426623031,\r\n   \"id\": \"cus_5tDSlyr30eqCTa\",\r\n   \"livemode\": false,\r\n   \"description\": null,\r\n   \"email\": null,\r\n   \"delinquent\": false,\r\n   \"metadata\": {\r\n   },\r\n   \"subscriptions\": {\r\n     \"object\": \"list\",\r\n     \"total_count\": 0,\r\n     \"has_more\": false,\r\n     \"url\": \"/v1/customers/cus_5tDSlyr30eqCTa/subscriptions\",\r\n     \"data\": [\r\n\r\n     ]\r\n   },\r\n   \"discount\": null,\r\n   \"account_balance\": 0,\r\n   \"currency\": \"usd\",\r\n   \"sources\": {\r\n     \"object\": \"list\",\r\n     \"total_count\": 1,\r\n     \"has_more\": false,\r\n     \"url\": \"/v1/customers/cus_5tDSlyr30eqCTa/sources\",\r\n     \"data\": [\r\n       {\r\n         \"id\": \"card_15hR1H2eZvKYlo2CpmgFpXLh\",\r\n         \"object\": \"card\",\r\n         \"last4\": \"4242\",\r\n         \"brand\": \"Visa\",\r\n         \"funding\": \"credit\",\r\n         \"exp_month\": 3,\r\n         \"exp_year\": 2017,\r\n         \"fingerprint\": \"Xt5EWLLDS7FJjR1c\",\r\n         \"country\": \"US\",\r\n         \"name\": null,\r\n         \"address_line1\": null,\r\n         \"address_line2\": null,\r\n         \"address_city\": null,\r\n         \"address_state\": null,\r\n         \"address_zip\": null,\r\n         \"address_country\": null,\r\n         \"cvc_check\": null,\r\n         \"address_line1_check\": null,\r\n         \"address_zip_check\": null,\r\n         \"dynamic_last4\": null,\r\n         \"metadata\": {\r\n         },\r\n         \"customer\": \"cus_5tDSlyr30eqCTa\"\r\n       }\r\n     ]\r\n   },\r\n   \"default_source\": \"card_15hR1H2eZvKYlo2CpmgFpXLh\"\r\n }\r\n```\r\n\r\nStep 3\r\n-------\r\n \r\nCopy the above JSON to spec/fixtures/customer.json\r\n\r\nStep 4\r\n-------\r\n \r\nLet\'s write a `stripe_customer_mapper_spec.rb` that will encapsulate the navigation of the JSON document.\r\n\r\n```ruby  \r\nrequire \'rails_helper\'\r\n\r\ndescribe StripeCustomerMapper do\r\n  \r\n  it \'should map credit card expiration month\' do\r\n    h = JSON.parse(File.read(\"spec/fixtures/customer.json\"))\r\n    customer = Stripe::Customer.construct_from(h)    \r\n    \r\n    mapper = StripeCustomerMapper.new(customer)\r\n    \r\n    expect(mapper.credit_card_expiration_month).to eq(3)\r\n  end\r\n\r\nend\r\n```\r\n\r\nLook at the fixture file, customer.json to find the credit card expiration date. It is 3, so we have 3 in the expect method. Run the test. It fails.\r\n\r\nStep 5\r\n-------\r\n\r\nPlaying in the irb:\r\n\r\n```ruby\r\nh = JSON.parse(File.read(\"spec/fixtures/customer.json\"))\r\ncustomer = Stripe::Customer.construct_from(h)   \r\n```\r\n\r\nWe find that :\r\n\r\n```ruby\r\ncustomer.sources.data[0].exp_month\r\n```\r\n\r\nwill retrieve the expiration date of the credit card.\r\n\r\nStep 6\r\n-------\r\n\r\nCreate the `app/models/stripe_customer_mapper.rb` and implement the method as follows:\r\n\r\n```ruby\r\nclass StripeCustomerMapper\r\n  def initialize(customer)\r\n    @customer = customer\r\n  end\r\n  \r\n  def credit_card_expiration_month\r\n    @customer.sources.data[0].exp_month\r\n  end\r\n\r\nend\r\n```\r\n\r\nStep 7\r\n-------\r\n\r\nHere is the tests for expiration year and last 4 digits:\r\n\r\n```ruby\r\n  it \'should map credit card expiration year\' do\r\n    h = JSON.parse(File.read(\"spec/fixtures/customer.json\"))\r\n    customer = Stripe::Customer.construct_from(h)    \r\n    \r\n    mapper = StripeCustomerMapper.new(customer)\r\n    \r\n    expect(mapper.credit_card_expiration_year).to eq(2017)\r\n  end\r\n\r\n  it \'should map credit card last 4 digits\' do\r\n    h = JSON.parse(File.read(\"spec/fixtures/customer.json\"))\r\n    customer = Stripe::Customer.construct_from(h)    \r\n    \r\n    mapper = StripeCustomerMapper.new(customer)\r\n    \r\n    expect(mapper.credit_card_last4digits).to eq(\'4242\')\r\n  end\r\n``` \r\n\r\nStep 8\r\n-------\r\n\r\nHere is the implementation that passes it. It is similar to our first test.\r\n\r\n```ruby\r\n  def credit_card_expiration_year\r\n    @customer.sources.data[0].exp_year\r\n  end\r\n\r\n  def credit_card_last4digits\r\n    @customer.sources.data[0].last4\r\n  end\r\n```\r\n\r\nSummary\r\n=========\r\n-----------\r\n\r\nIn this lesson we encapsulated the logic to navigate the Stripe JSON response in StripeCustomerMaper class. This localizes the changes that may be needed in the future due to Stripe API changes to the mapper class.','2015-03-21 22:55:23','2016-12-22 21:06:39'),(1701,'Intermediate TDD in Rails : Save Subscription Details','Objective\r\n=========\r\n---------\r\n\r\nTo save subscription details in the database.\r\n\r\nSteps\r\n=========\r\n---------\r\n\r\nStep 1\r\n-------\r\n\r\nWe can now write a test for `save_details` method in subscription in `specs/models/subscription_spec.rb`.\r\n\r\n```ruby\r\n  it \'should save the stripe subscription details\' do\r\n    h = JSON.parse(File.read(\"spec/fixtures/customer.json\"))\r\n    stripe_customer = Stripe::Customer.construct_from(h)    \r\n    user = User.create(email: \'bugs@rubyplus.com\', password: \'12345678\', password_confirmation: \'12345678\')\r\n    plan_name = \'gold\'\r\n    \r\n    expect do\r\n      Subscription.save_details(stripe_customer, user, plan_name)\r\n    end.to change(Subscription, :count).by (1)\r\n    \r\n  end\r\n```\r\n \r\nStep 2\r\n-------\r\n  \r\nRun the test. \r\n\r\n```sh\r\n$rspec spec/models/subscription_spec.rb \r\n```\r\n\r\nIt fails. \r\n\r\nStep 3\r\n-------\r\n\r\nLet\'s implement the method:\r\n\r\n```ruby\r\n  def self.save_details(stripe_customer, user, plan_name)\r\n    mapper = StripeCustomerMapper.new(stripe_customer)\r\n    user.create_subscription(stripe_customer_token: stripe_customer.id,\r\n                             plan_name:             plan_name,\r\n                             last4digits:      mapper.credit_card_last4digits,\r\n                             expiration_month: mapper.credit_card_expiration_month,\r\n                             expiration_year:  mapper.credit_card_expiration_year)\r\n  end\r\n```\r\n\r\nStep 4\r\n-------\r\n\r\nIt fails with:\r\n\r\n```sh\r\nundefined method `create_subscription\' for #<User:0x007ffb8110a958>\r\n```\r\n\r\nWe forgot to declare:\r\n\r\n```ruby\r\nhas_one :subscription \r\n```\r\n\r\nin the user.rb. Add it now and run the test again. It passes.\r\n\r\nStep 5\r\n-------\r\n\r\nWe need to make our subscription model immune to any changes due to Stripe API. Let\'s move the knowledge of extracting the `stripe_customer_token` to the mapper class. Add the following test to `stripe_customer_mapper_spec.rb`:\r\n\r\n```ruby\r\n  it \'should map the stripe customer token\' do\r\n    h = JSON.parse(File.read(\"spec/fixtures/customer.json\"))\r\n    customer = Stripe::Customer.construct_from(h)    \r\n    \r\n    mapper = StripeCustomerMapper.new(customer)\r\n    \r\n    expect(mapper.customer_token).to eq(\'cus_5tDSlyr30eqCTa\')    \r\n  end\r\n```\r\n\r\n```sh\r\n$rspec spec/models/stripe_customer_mapper_spec.rb\r\n```\r\n\r\nIt fails. Let\'s implement the method.\r\n\r\nStep 6\r\n-------\r\n\r\n```ruby\r\n  def customer_token\r\n    @customer.id\r\n  end\r\n```\r\n\r\nThe test now passes.\r\n\r\nStep 7\r\n-------\r\n\r\nLet\'s now cleanup the subscription model as follows:\r\n\r\n```ruby\r\nclass Subscription < ActiveRecord::Base\r\n  belongs_to :user  \r\n  \r\n  def self.save_details(stripe_customer, user, plan_name)\r\n    mapper = StripeCustomerMapper.new(stripe_customer)\r\n    user.create_subscription(stripe_customer_token: mapper.customer_token,\r\n                             plan_name:             plan_name,\r\n                             last4digits:      mapper.credit_card_last4digits,\r\n                             expiration_month: mapper.credit_card_expiration_month,\r\n                             expiration_year:  mapper.credit_card_expiration_year)\r\n  end\r\nend\r\n```\r\n\r\nRun the test. \r\n\r\n```sh\r\n$rspec spec/models/subscription_spec.rb \r\n```\r\n\r\nIt passes.\r\n\r\nSummary\r\n=========\r\n-----------\r\n\r\nIn this lesson, we saved the subscription details in our database.\r\n','2015-03-21 23:10:56','2016-12-22 21:07:41'),(1711,'Intermediate TDD in Rails : Controller Test for Subscription','Objective\r\n=========\r\n---------\r\n\r\nTo implement the controller for subscription feature.\r\n\r\nSteps\r\n=========\r\n---------\r\n\r\nStep 1\r\n-------\r\n\r\nLet\'s now go up the layer and deal with the controller now. We need a user to be logged in. Add:\r\n\r\n```ruby\r\nRSpec.configure do |config|  \r\n  config.include Devise::TestHelpers, :type => :controller\r\n  \r\nend\r\n``` \r\n\r\nto the rails_helper.rb. \r\n\r\nStep 2\r\n-------\r\n  \r\nNow we can use sign_in devise test helper in our test.\r\n\r\n```ruby  \r\n    it \'should save the subscription details\', focus: true do\r\n      Stripe.api_key = \'sk_test_watHqWl2XD88WHqhknk7sqXN\'\r\n      Stripe.api_version = \"2015-02-18\"  \r\n      \r\n      user = User.create(email: \'bugs@disney.com\', password: \'12345678\')\r\n      sign_in(User.last)   \r\n      \r\n      expect(Subscription).to receive(:save_details)\r\n      \r\n      post :create, params: { stripeToken: 1, plan_name: \'gold\' }      \r\n    end\r\n```\r\n \r\nWe are using mock here because the save\\_details is our custom method. It is not a third-party library method. The save\\_details has already been tested in the model test.\r\n  \r\nStep 3\r\n-------\r\n  \r\nRun the test. The error is:\r\n\r\n```sh\r\n expected: 1 time with any arguments\r\n   received: 0 times with any arguments  \r\n```\r\n\r\nStep 4\r\n-------\r\n  \r\nChange the subscriptions\\_controller create method:\r\n\r\n```ruby  \r\n  def create\r\n    stripe_customer = StripeGateway::Subscription.create(current_user.email, params[:stripeToken], params[:plan_name])\r\n    Subscription.save_details(stripe_customer, current_user, params[:plan_name])\r\n  end\r\n```\r\n  \r\nThe test passes.\r\n  \r\nSummary\r\n=========\r\n---------\r\n\r\nIn this lesson we implemented the controller to handle the subscription feature by using a mock.','2015-03-21 23:18:08','2016-12-22 21:08:25'),(1721,'Intermediate TDD in Rails : Subscribe to a Plan Feature Test','Objective\r\n=========\r\n---------\r\n\r\nTo implement subscribe to a plan feature.\r\n\r\nSteps\r\n=========\r\n---------\r\n\r\nStep 1\r\n-------\r\n  \r\nAdd a feature spec:\r\n  \r\n```ruby\r\n  scenario \"to a plan saves the subscription details\" do\r\n    expect do\r\n      visit root_path\r\n\r\n      click_link \'Register\'\r\n      fill_in \'Email\', with: \'bugs2@rubyplus.com\'\r\n      fill_in \'Password\', with: \'12345678\'    \r\n      click_button \'Sign up\'\r\n    \r\n      click_link \'Gold\'\r\n      fill_in \"Card Number\", with: \'4242424242424242\'\r\n      page.select \'10\', from: \"card_month\"\r\n      page.select \'2029\', from: \'card_year\'\r\n      click_button \'Subscribe Me\'\r\n\r\n    end.to change(Subscription, :count).by(1)\r\n  end\r\n```\r\n\r\nStep 2\r\n-------\r\n   \r\nRun the test. The test fails with:\r\n\r\n```sh\r\n  SQLite3::BusyException: database is locked: commit transaction\r\n```\r\n  \r\nSQLite does not allow concurrent access. \r\n\r\nStep 3\r\n-------\r\n\r\nLet\'s use MySQL database. Change the database.yml to:\r\n\r\n```ruby  \r\n  development:\r\n    adapter: mysql2\r\n    encoding: utf8\r\n    reconnect: false\r\n    database: blogger_development\r\n    pool: 5\r\n    username: root\r\n    password: \r\n    host: localhost\r\n    port: 3306\r\n\r\n  # Warning: The database defined as \"test\" will be erased and\r\n  # re-generated from your development database when you run \"rake\".\r\n  # Do not set this db to the same as development or production.\r\n  test:\r\n    adapter: mysql2\r\n    encoding: utf8\r\n    reconnect: false\r\n    database: blogger_test\r\n    pool: 5\r\n    username: root\r\n    password: \r\n    host: localhost\r\n    port: 3306\r\n```\r\n\r\nStep 4\r\n-------\r\n\r\nRun rake db:migrate. It fails with : \r\n\r\n```sh	\r\n	Gem::LoadError: Specified \'mysql2\' for database adapter, but the gem is not loaded. Add `gem \'mysql2\'` to your Gemfile (and ensure its version is at the minimum required by ActiveRecord).\r\n```\r\n\r\nStep 5\r\n------\r\n	\r\nAdd : \r\n\r\n```ruby\r\ngem \'mysql2\' \r\n```\r\n\r\nto Gemfile and run bundle.\r\n\r\nStep 6\r\n-------\r\n	\r\nRun \r\n\r\n```ruby\r\n$rake db:migrate \r\n```\r\n\r\nand \r\n\r\n```ruby\r\n$rake db:create.\r\n```\r\n\r\nStep 7\r\n-------\r\n\r\nRun the test again. \r\n\r\n```sh\r\n$rspec spec/features/subscription_spec.rb \r\n```\r\n\r\nStep 8\r\n-------\r\n\r\nIt fails. Tailing the test log file did not give any clue. Ran the application locally and found out the issue was:\r\n\r\n```sh\r\nNo API key provided. Set your API key using \"Stripe.api_key = <API-KEY>\". You can generate API keys from the Stripe web interface. See https://stripe.com/api for details, or email support@stripe.com if you have any questions.\r\n```\r\n\r\nCreate a new file stripe.rb	in config/initializers directory with the following contents:\r\n\r\n```ruby  \r\n  Rails.configuration.stripe = {\r\n    publishable_key: ENV[\'STRIPE_PUBLISHABLE_KEY\'],\r\n    secret_key:      ENV[\'STRIPE_SECRET_KEY\']\r\n  }\r\n\r\n  Stripe.api_key = Rails.configuration.stripe[:secret_key]\r\n  Stripe.api_version = \"2015-02-18\"\r\n```\r\n  \r\nStep 9\r\n-------\r\n  \r\nIn the terminal, set the values for the `STRIPE_PUBLIC_KEY` and `STRIPE_SECRET_KEY` environment variables as follows:\r\n\r\n```sh\r\n  export STRIPE_PUBLISHABLE_KEY=\'pk_test_GxDbP7Q6f4GkaUe0I0LrbQSz\'\r\n  export STRIPE_SECRET_KEY=\'sk_test_watHqWl2XD88WHqhknk7sqXN\'\r\n```\r\n\r\nYou can get these values for your account from your Stripe dashboard, API keys tab. You can verify it is set properly by running:\r\n\r\n```sh\r\n  $ echo $STRIPE_PUBLISHABLE_KEY\r\n  $ echo $STRIPE_SECRET_KEY \r\n```\r\n\r\nStep 10\r\n-------\r\n  \r\nRun the test again. It fails:\r\n  \r\n```sh  \r\n  expected #count to have changed by 1, but was changed by 0. \r\n```\r\n  \r\nI tried to reproduce the problem in development. I was not able to reproduce it. The reason for the failure is that after you click \'Subscribe Me\', you need to give some time for the network call to complete. So adding a sleep after clicking the \'Subscribe Me\' button makes the test pass. \r\n  \r\nSo our test now looks like this:\r\n\r\n```ruby  \r\n  scenario \"to a plan saves the subscription details\", js: true do\r\n    expect do\r\n      visit root_path\r\n\r\n      click_link \'Register\'\r\n      fill_in \'Email\', with: \'bugs2@rubyplus.com\'\r\n      fill_in \'Password\', with: \'12345678\'    \r\n      click_button \'Sign up\'\r\n    \r\n      click_link \'Gold\'\r\n      fill_in \"Card Number\", with: \'4242424242424242\'\r\n      page.select \'10\', from: \"card_month\"\r\n      page.select \'2029\', from: \'card_year\'\r\n      click_button \'Subscribe Me\'\r\n      sleep 4\r\n    end.to change(Subscription, :count).by(1)\r\n  end\r\n```\r\n  \r\nI have also turned on the javascript to true, since we are using javascript in the stripe.html.erb layout file. The test will fail because after the credit card form gets submitted to the Stripe servers, we get a stripe token, this is submitted to our server via javascript, since this call will fail, our test will also fail.\r\n  \r\nSummary\r\n=========\r\n---------\r\n\r\nIn this lesson we implemented the feature test for subscribing a user to a plan.','2015-03-21 23:29:56','2016-12-22 21:09:33'),(1731,'Intermediate TDD in Rails : Eliminating Duplication in Feature Tests','Objective\r\n=========\r\n---------\r\n\r\nLearn how to reuse methods for feature tests.\r\n\r\nSteps\r\n=========\r\n---------\r\n\r\nStep 1\r\n-------\r\n\r\nCreate spec/support/features folder. Create session_helpers.rb in this folder.\r\n\r\n```ruby\r\nmodule Features\r\n  module SessionHelpers\r\n    def sign_up(email, password)\r\n      click_link \'Register\'\r\n      fill_in \'Email\', with: email\r\n      fill_in \'Password\', with: password\r\n      click_button \'Sign up\'\r\n    end\r\n  end\r\nend\r\n```\r\n\r\nStep 2\r\n-------\r\n\r\nCreate spec/support/features.rb file.\r\n\r\n```ruby\r\nRSpec.configure do |config|\r\n  config.include Features::SessionHelpers, type: :feature\r\nend\r\n```\r\n\r\nStep 3\r\n-------\r\n\r\nReplace the following lines:\r\n\r\n```ruby\r\n  click_link \'Register\'\r\n  fill_in \'Email\', with: \'bugs2@rubyplus.com\'\r\n  fill_in \'Password\', with: \'12345678\'    \r\n  click_button \'Sign up\'\r\n```\r\n\r\nwith \r\n\r\n```ruby\r\n sign_up(\'bugs@rubyplus.com\', \'12345678\')\r\n```\r\n\r\nin spec/features/subscription_spec.rb.\r\n\r\nStep 4\r\n-------\r\n\r\nRun the test:\r\n\r\n```sh\r\n$rspec spec/features/subscription_spec.rb \r\n```\r\n\r\nIt passes.\r\n\r\nExercise\r\n=========\r\n---------\r\n\r\nCreate a subscribe helper in subscription\\_spec.rb that can subscribe a user to a given plan. Change the subscription\\_spec.rb to use the helper.\r\n\r\nSummary\r\n=========\r\n---------\r\n\r\nIn this lesson you learned how to create, configure and use helpers for feature tests.','2015-03-21 23:45:47','2016-12-22 21:10:19'),(1741,'How to Position Logo using Twitter Boostrap 3.3.1 in Rails 4.2 Project','How to Position Logo using Twitter Boostrap 3.3.1 in Rails 4.2 Project\r\n\r\nSteps\r\n=====\r\n\r\nStep 1\r\n------\r\n\r\nThere are two resized images logo\\_300w.png and logo\\_500w.png that needs to be copied to app/assets/images/ folder.\r\n\r\nThe images have dimensions of 300x53 500x88 with 72 pixels/inch resolution. Both images have transparent background so that it blends with the current background color of the navigation bar.\r\n\r\nStep 2\r\n------\r\n\r\nCustomize the navbar-brand in the navigation as follows\r\n\r\n```ruby\r\n<nav class=\"navbar navbar-default\" role=\"navigation\">\r\n  \r\n  <div class=\"navbar-header\">\r\n      <button type=\"button\" class=\"navbar-toggle\" data-toggle=\"collapse\"\r\n  data-target=\"#bs-example-navbar-collapse-1\">\r\n        <span class=\"sr-only\">Toggle navigation</span>\r\n        <span class=\"icon-bar\"></span>\r\n        <span class=\"icon-bar\"></span>\r\n        <span class=\"icon-bar\"></span>\r\n      </button>\r\n\r\n      <a class=\"navbar-brand pull-left\" href=\"/\">\r\n        <%= image_tag \'logo_300w.png\', border: \"2\", class: \"img\", style: \"margin-top: -14px;\" %>\r\n      </a>\r\n    </div>\r\n    \r\n  HTML code for links omitted.\r\n</nav>\r\n```\r\n\r\nStep 3\r\n------\r\n\r\nThat\'s it. Thanks to Paul Gemignani of [4waytours](https://www.4waytours.com \'4waytours\') for this CSS hack.','2015-04-02 00:42:55','2016-12-22 21:10:51'),(1751,'How to Add Favicon to Rails 4.2 App in 5 minutes','Steps\r\n=====\r\n\r\nStep 1\r\n------\r\n\r\nUpload favicon image for your site to [Favicon Generator](http://realfavicongenerator.net \"Favicon Generator\")\r\n\r\nThis will generate images in different sizes that can be used in different devices and browsers.\r\n\r\nStep 2\r\n------ \r\n\r\nDownload the zip file from the above site, extract the zip file and copy all the files to the public folder.\r\n\r\nStep 3\r\n------\r\n\r\nCopy the following code within the head tag of the layout.\r\n\r\n```html\r\n  <link rel=\"apple-touch-icon\" sizes=\"57x57\" href=\"/apple-touch-icon-57x57.png\">\r\n  <link rel=\"apple-touch-icon\" sizes=\"60x60\" href=\"/apple-touch-icon-60x60.png\">\r\n  <link rel=\"apple-touch-icon\" sizes=\"72x72\" href=\"/apple-touch-icon-72x72.png\">\r\n  <link rel=\"apple-touch-icon\" sizes=\"76x76\" href=\"/apple-touch-icon-76x76.png\">\r\n  <link rel=\"apple-touch-icon\" sizes=\"114x114\" href=\"/apple-touch-icon-114x114.png\">\r\n  <link rel=\"apple-touch-icon\" sizes=\"120x120\" href=\"/apple-touch-icon-120x120.png\">\r\n  <link rel=\"apple-touch-icon\" sizes=\"144x144\" href=\"/apple-touch-icon-144x144.png\">\r\n  <link rel=\"apple-touch-icon\" sizes=\"152x152\" href=\"/apple-touch-icon-152x152.png\">\r\n  <link rel=\"apple-touch-icon\" sizes=\"180x180\" href=\"/apple-touch-icon-180x180.png\">\r\n  <link rel=\"icon\" type=\"image/png\" href=\"/favicon-32x32.png\" sizes=\"32x32\">\r\n  <link rel=\"icon\" type=\"image/png\" href=\"/android-chrome-192x192.png\" sizes=\"192x192\">\r\n  <link rel=\"icon\" type=\"image/png\" href=\"/favicon-96x96.png\" sizes=\"96x96\">\r\n  <link rel=\"icon\" type=\"image/png\" href=\"/favicon-16x16.png\" sizes=\"16x16\">\r\n  <link rel=\"manifest\" href=\"/manifest.json\">\r\n  <meta name=\"msapplication-TileColor\" content=\"#da532c\">\r\n  <meta name=\"msapplication-TileImage\" content=\"/mstile-144x144.png\">\r\n  <meta name=\"theme-color\" content=\"#ffffff\">\r\n```\r\n\r\nNow you can see the favicon in all browsers and devices. Here is the screenshot on iPhone when I added rubyplus.com to the Home Screen.\r\n\r\n![Ruby Plus iPhone Home Screen](https://images.rubyplus.com/rubyplus-home.png \"Ruby Plus iPhone Home Screen\")\r\n\r\nEventhough I found a [Favicon Maker gem](https://github.com/follmann/favicon_maker \"Favicon Maker gem\") that integrates with asset pipeline, I decided not to use it, because this is a simple task. \r\n\r\nUsing asset pipeline with Amazon CDN will improve the performance of your Rails app. Read [Using Asset Pipeline for Favicons](http://www.rubyplus.net/2016/03/using-asset-pipeline-for-favicons-in.html \'Using Asset Pipeline for Favicons\') to learn how.\r\n\r\n## Feedback from Philippe Bernard\r\n\r\n I\'m the author of RealFaviconGenerator. I noticed your article about RoR and favicon. Thank you for picking RFG as the reference tool for this task! I also noticed that you didn\'t use a gem because the task was too simple to use one. Maybe you wanted to know that RFG now comes with its own gem, so you can get all the advantages without the drawbacks: - You basically use RFG as usual: a simple UI with smart options to design your icon platform-per-platform. - Once your favicon is ready, you get step-by-step, copy/paste, no-brainer instructions to install the favicon you\'ve just created right in your RoR project. - When it\'s done, your favicon files are managed through the pipeline as expected. And this is still a 5-minutes process :) It\'s all here: [Favicon Generator for Ruby on Rails](https://realfavicongenerator.net/favicon/ruby_on_rails \'Favicon Generator for Ruby on Rails\'). I would be glad to have your feedback about this! \r\n\r\n## Reference\r\n\r\n[Favicons for All Devices and Sizes](https://scotch.io/tutorials/all-favicons-for-all-devices-and-sizes \'Favicons for All Devices and Sizes\')','2015-04-02 03:33:32','2016-12-22 21:12:07'),(1761,'Sinatra Basics : Hello World','Objective\r\n=========\r\n---------\r\n\r\nTo write a hello world Sinatra application and experiment to learn about HTTP Get verb. \r\n\r\nVersions\r\n=========\r\n----------\r\n\r\nRuby version 2.2.2. Sinatra version 1.4.6.\r\n\r\nSteps\r\n=========\r\n---------\r\n\r\nStep 1\r\n---------\r\n\r\nRun\r\n\r\n```sh\r\n$gem install sinatra\r\n```\r\n\r\nStep 2\r\n---------\r\n\r\nCreate hi.rb file with:\r\n\r\n```ruby\r\nrequire \'sinatra\'\r\n\r\nget \'/\' do\r\n  \'hi\'\r\nend\r\n```\r\n\r\nStep 3\r\n---------\r\n\r\nRun the Sinatra application:\r\n\r\n```sh\r\n$ ruby hi.rb\r\n```\r\n\r\nStep 4\r\n---------\r\n\r\nBrowse to http://localhost:4567\r\nYou see the output \'hi\'.\r\n\r\nDiscussion\r\n========\r\n---------\r\n\r\nYou can see the port number where the server is running.\r\n\r\n```sh\r\n[2014-12-09 21:29:16] INFO  WEBrick 1.3.1\r\n[2014-12-09 21:29:16] INFO  ruby 2.1.2 (2014-05-08) [x86_64-darwin11.0]\r\n== Sinatra/1.4.5 has taken the stage on 4567 for development with backup from WEBrick\r\n[2014-12-09 21:29:16] INFO  WEBrick::HTTPServer#start: pid=4860 port=4567\r\n::1 - - [09/Dec/2014:21:29:36 -0800] \"GET / HTTP/1.1\" 200 2 0.0080\r\nlocalhost - - [09/Dec/2014:21:29:35 PST] \"GET / HTTP/1.1\" 200 2\r\n```\r\n\r\nThe browser made a GET request to the resource / using HTTP protocal version 1.1. It got a response with status code 200 and content-length 2.\r\n\r\nStep 5\r\n----\r\n\r\nHere I copied the output from the terminal where I interact with the webrick server using telnet. Here I connect to webrick and make a HTTP GET request.\r\n\r\n```sh\r\n$ telnet localhost 4567\r\nTrying ::1...\r\nConnected to localhost.\r\nEscape character is \'^]\'.\r\nGET / HTTP/1.1\r\n```\r\n\r\nHttp Response:\r\n\r\n```sh\r\nHTTP/1.1 200 OK \r\nContent-Type: text/html;charset=utf-8\r\nContent-Length: 2\r\nX-Xss-Protection: 1; mode=block\r\nX-Content-Type-Options: nosniff\r\nX-Frame-Options: SAMEORIGIN\r\nServer: WEBrick/1.3.1 (Ruby/2.1.2/2014-05-08)\r\nDate: Wed, 10 Dec 2014 05:32:56 GMT\r\nConnection: Keep-Alive\r\n\r\nHi\r\n```\r\n\r\nHttp Request + Http Response seen in the above example. The response shows the version of http, with the status code 200, content-length is 2 since we send just \'hi\' back to the client. Let\'s ignore the other headers in the response for now.\r\n\r\nStep 6\r\n---------\r\n\r\nLet\'s experiment with Rack in the irb.\r\n\r\n```sh\r\n$ irb\r\n> require \'rack\'\r\n => true \r\n> rack_app = lambda{|env| [200, {}, [\'Hi Rack\']]}\r\n => #<Proc:0x007fa27d0acec8@(irb):3 (lambda)> \r\n> Rack::Handler::WEBrick.run rack_app, :Port => 3004\r\n[2014-12-09 22:23:10] INFO  WEBrick 1.3.1\r\n[2014-12-09 22:23:10] INFO  ruby 2.1.2 (2014-05-08) [x86_64-darwin11.0]\r\n[2014-12-09 22:23:10] INFO  WEBrick::HTTPServer#start: pid=5269 port=3004\r\n```\r\n\r\nBrowse to http://localhost:3004/\r\n\r\nYou will see \'Hi Rack\'.\r\n\r\nThe output in the log:\r\n\r\n```sh\r\nlocalhost - - [09/Dec/2014:22:24:14 PST] \"GET / HTTP/1.1\" 200 7\r\n```\r\n\r\nshows the GET request made by the browser for the resource / with HTTP version 1.1. The response shows the status code 200 with the length of the string \'Hi Rack\' 7. In this example we did not set any headers in the response (the hash {} is empty in the second parameter.)\r\n\r\nStep 7\r\n---------\r\n\r\nCTRL+c to stop the server.\r\n\r\nSummary\r\n========\r\n---------\r\n\r\nIn this article, we wrote a simple hello world program in Sinatra. We played with telnet and rack to learn about GET http verb and request/response.','2015-04-25 21:03:04','2015-04-25 22:57:07'),(1771,'Sinatra Basics : Reload Changes Without Restarting the Server','Objective\r\n=========\r\n---------\r\n\r\nLearn to use shotgun gem to reload changes without restarting the server.\r\n\r\nSteps\r\n=========\r\n---------\r\n\r\nStep 1\r\n---------\r\n\r\nCreate Gemfile:\r\n\r\n```sh\r\nsource \'https://rubygems.org\'\r\n\r\ngem \'shotgun\'\r\ngem \'sinatra\'\r\n```\r\n\r\nIf you don\'t specify the sinatra gem in the Gemfile you will get an error.\r\n\r\nStep 2\r\n---------\r\n\r\nInstall the gem: \r\n\r\n```ruby\r\nbundle\r\n```\r\n\r\nStep 3\r\n---------\r\n\r\nRun the Sinatra application using shotgun gem:\r\n\r\n```sh\r\nbundle exec shotgun hi.rb\r\n```\r\n\r\nStep 4\r\n---------\r\n\r\nBrowse to http://127.0.0.1:9393/\r\n\r\nStep 5\r\n---------\r\n\r\nYou will the text \'hi\' in the browser.\r\n\r\nStep 6\r\n---------\r\n\r\nChange the static text to:\r\n\r\nRUBY_VERSION\r\n\r\nlike this:\r\n\r\n```ruby\r\nrequire \'sinatra\'\r\n\r\nget \'/\' do\r\n  RUBY_VERSION\r\nend\r\n```\r\n\r\nStep 6\r\n---------\r\n\r\nReload the browser. Now you don\'t have to restart the server everytime you make changes to the code.\r\n\r\nSummary\r\n========\r\n--------\r\n\r\nIn this article, you learned how to use shotgun to reload changes without restarting the server.\r\n','2015-04-25 21:12:50','2015-04-25 23:49:06'),(1781,'Sinatra Basics : HTTP verbs','Objective\r\n=========\r\n---------\r\n\r\nTo learn about the HTTP verbs GET, POST, PATCH, PUT, DELETE that is used in a RESTful webservice.\r\n\r\nSteps\r\n=========\r\n---------\r\n\r\nStep 1\r\n---------\r\n\r\nCreate rest.rb:\r\n\r\n```ruby\r\nrequire \'sinatra\'\r\n\r\nget \'/articles\' do\r\n  \'listing of all the articles\'  \r\nend\r\n\r\nget \'/article/:id\' do\r\n  \'get the article with the given id\'\r\nend\r\n\r\npost \'/article\' do\r\n  \'create a new article\'\r\nend\r\n\r\nput \'/article/:id\' do\r\n  \'update an existing article\'\r\nend\r\n\r\npatch \'/article/:id\' do\r\n  \'update part of the existing article\'\r\nend\r\n\r\ndelete \'/article/:id\' do\r\n  \'delete the article\'\r\nend\r\n```\r\n\r\nStep 2\r\n---------\r\n\r\nInstall [Advanced REST client](https://chrome.google.com/webstore/detail/advanced-rest-client/hgmloofddffdnphfgcellkdfbfbjeloo \'Advanced REST client\') chrome extension.\r\n\r\nStep 3\r\n---------\r\n\r\nRun the application:\r\n\r\n```sh\r\nbundle exec shotgun rest.rb\r\n```\r\n\r\nStep 4\r\n---------\r\n\r\nPlay with REST client using the following URLs in REST client Chrome extension.\r\n\r\nGET http://localhost:9393/articles\r\nGET http://localhost:9393/article/1\r\nPOST http://localhost:9393/article\r\nPUT http://localhost:9393/article/1\r\nPATCH http://localhost:9393/article/1\r\nDELETE http://localhost:9393/article/1\r\n\r\nSummary\r\n========\r\n--------\r\n\r\nIn this article, you learned about the HTTP verbs and saw the request and response using Advanced REST client Chrome extension.','2015-04-25 21:22:24','2015-04-25 21:22:24'),(1791,'Sinatra Basics : Sinatra Filters','Objective\r\n=========\r\n---------\r\n\r\nTo learn how to use before and after filters in Sinatra.\r\n\r\nSteps\r\n=========\r\n---------\r\n\r\nStep 1\r\n---------\r\n\r\nCreate filter.rb\r\n\r\n```ruby\r\nrequire \'sinatra\'\r\n\r\nbefore do\r\n  puts \"Before called\"\r\nend\r\n\r\nget \'/\' do\r\n  \'hello\'\r\nend\r\n```\r\n\r\nStep 2\r\n---------\r\n\r\n```sh\r\nbundle exec shotgun filter.rb\r\n```\r\n\r\nStep 3\r\n---------\r\n\r\nBrowse to http://localhost:9393/\r\n\r\nBrowser output: hi\r\nServer log output : Before called\r\n\r\nStep 4\r\n---------\r\n\r\nAdd after filter:\r\n\r\n```ruby\r\nafter do\r\n  puts \'after called\'\r\nend\r\n```\r\n\r\nso the file now looks like this:\r\n\r\n```ruby\r\nrequire \'sinatra\'\r\n\r\nbefore do\r\n  puts \"Before called\"\r\nend\r\n\r\nafter do\r\n  puts \'after called\'\r\nend\r\n\r\nget \'/\' do\r\n  \'hello\'\r\nend\r\n```\r\n\r\nStep 5\r\n---------\r\n\r\nReload the browser.\r\n\r\nBefore called\r\nafter called\r\n\r\nis seen in the server log.\r\n\r\n\r\nSummary\r\n========\r\n---------\r\n\r\nIn this article, you learned how to use before and after filter in a Sinatra application.','2015-04-25 21:30:32','2015-04-25 21:30:32'),(1801,'Sinatra Basics : Writing a Test using Unit Test framework','Objective\r\n=========\r\n---------\r\n\r\nLearn how to write a test using test unit framework for a Sinatra application.\r\n\r\nSteps\r\n=========\r\n---------\r\n\r\nStep 1\r\n---------\r\n\r\nCreate a new project folder to keep all the files. \r\n\r\nStep 2\r\n---------\r\n\r\nAdd rack-test gem to Gemfile\r\n\r\n```ruby\r\ngem \"rack-test\", require: \"rack/test\"\r\n```\r\n\r\nthe entire Gemfile looks like this:\r\n\r\n```ruby\r\nsource \'https://rubygems.org\'\r\n\r\ngem \'shotgun\'\r\ngem \'sinatra\'\r\ngem \"rack-test\", require: \"rack/test\"\r\ngem \'test-unit\'\r\n```\r\n\r\nStep 3\r\n---------\r\n\r\nInstall the gems.\r\n\r\n```sh\r\n$bundle\r\n```\r\n\r\nThis installed test-unit gem version 3.2 and rack-test gem version 0.6.3 on my system.\r\n\r\nStep 4\r\n---------\r\n\r\nCreate a test folder inside the project folder and create sample_test.rb in it.\r\n\r\n```ruby\r\nENV[\'RACK_ENV\'] = \'test\'\r\n\r\nrequire \'test/unit\'\r\nrequire \'rack/test\'\r\n\r\nrequire File.expand_path \'../sample.rb\'\r\n\r\nclass SampleTest < Test::Unit::TestCase\r\n  include Rack::Test::Methods\r\n  \r\n  def app\r\n    Sinatra::Application\r\n  end\r\n  \r\n  def test_sample\r\n    get \'/\'\r\n\r\n    assert last_response.ok?\r\n    assert_equal \'hi\', last_response.body\r\n  end\r\n\r\nend\r\n```\r\n\r\nStep 5\r\n---------\r\n\r\nRun the test:\r\n\r\n```sh\r\nbundle exec ruby sample_test.rb\r\n```\r\n\r\nStep 6\r\n---------\r\n\r\nIn the project folder, create sample.rb:\r\n\r\n```ruby\r\nrequire \'sinatra\'\r\n\r\nget \'/\' do\r\n  \'hi\'\r\nend\r\n```\r\n\r\nSummary\r\n========\r\n---------\r\n\r\nIn this article, you learned how to write a test using TestUnit testing framework to test Sinatra application.','2015-04-25 21:39:20','2015-04-25 21:40:56'),(1811,'Sinatra Basics : Using RSpec as the Test Framework','Objective\r\n=========\r\n---------\r\n\r\nTo learn how to use RSpec testing framework to test the Sinatra application.\r\n\r\nSteps\r\n=========\r\n---------\r\n\r\nStep 1\r\n---------\r\n\r\nCreate Gemfile in the root of the project:\r\n\r\n```ruby\r\nsource \'https://rubygems.org\'\r\n\r\ngem \'shotgun\'\r\ngem \'sinatra\'\r\ngem \"rack-test\", require: \"rack/test\"\r\ngem \"rspec\"\r\n```\r\n\r\nStep 2\r\n---------\r\n\r\nInstall the gems:\r\n\r\n```sh\r\nbundle install\r\n```\r\n\r\nThis installed RSpec version 3.2 on my system.\r\n\r\nStep 3\r\n---------\r\n\r\nCreate spec/spec_helper.rb with the following code:\r\n\r\n```ruby\r\nrequire \'rack/test\'\r\nrequire \'rspec\'\r\n\r\nENV[\'RACK_ENV\'] = \'test\'\r\n\r\nmodule RSpecMixin\r\n  include Rack::Test::Methods\r\n  \r\n  def app\r\n    Sinatra::Application \r\n  end\r\nend\r\n\r\nRSpec.configure do |c| \r\n  c.include RSpecMixin \r\nend\r\n```\r\n\r\nStep 4\r\n---------\r\n\r\nIn spec/sample_spec.rb add the test:\r\n\r\n```ruby\r\nrequire_relative \'../spec_helper.rb\'\r\n\r\nRSpec.describe \'Specing a Sinatra Application\' do\r\n  \r\n  it \'should greet\' do\r\n    get \'/\' \r\n    \r\n    expect(last_response).to be_ok\r\n    expect(last_response.body).to eq(\'hi\')\r\n  end\r\nend\r\n```\r\n\r\nStep 5\r\n---------\r\n\r\nCreate sample.rb in the project folder:\r\n\r\n```ruby\r\nrequire \'sinatra\'\r\n\r\nget \'/\' do\r\n  \'hi\'\r\nend\r\n```\r\n\r\nStep 6\r\n---------\r\n\r\nRun the test:\r\n\r\n```sh\r\n$bundle exec rspec spec/sample_spec.rb --color\r\n```\r\n\r\nSummary\r\n========\r\n---------\r\n\r\nIn this article, you learned how to use RSpec to test the Sinatra application.','2015-04-25 21:49:41','2015-04-25 21:51:12'),(1821,'Sinatra Basics : Modular Sinatra Application','Objective\r\n=========\r\n---------\r\n\r\nTo learn how to create a modular Sinatra application.\r\n\r\nSteps\r\n=========\r\n---------\r\n\r\nStep 1\r\n---------\r\n\r\nCreate hi.rb in your project folder.\r\n\r\n```ruby\r\nrequire \'sinatra\'\r\n\r\nclass HelloWorld < Sinatra::Base\r\n  get \'/\' do\r\n    \'Hello, world!\'\r\n  end\r\nend\r\n```\r\n\r\nStep 2\r\n---------\r\n\r\nCreate config.ru in your project folder.\r\n\r\n```ruby\r\nrequire \'./hi\'\r\n\r\nrun HelloWorld\r\n```\r\n\r\nStep 3\r\n---------\r\n\r\nRun the application.\r\n\r\n```sh\r\nrackup\r\n```\r\n\r\nStep 4\r\n---------\r\n\r\nBrowse to http://localhost:9292\r\n\r\n\r\nSummary\r\n========\r\n---------\r\n\r\nIn this article, you learned how to create a modular Sinatra application.\r\n\r\n\r\nReference\r\n========\r\n---------\r\n\r\n[Digital Ocean Sinatra Basics](https://www.digitalocean.com/community/tutorials/how-to-install-and-get-started-with-sinatra-on-your-system-or-vps \"Digital Ocean Sinatra Basics\") ','2015-04-25 21:56:49','2015-04-25 21:57:19'),(1831,'Sinatra Basics : Testing using RSpec for Modular Sinatra Application','Objective\r\n=========\r\n---------\r\n\r\nTo learn how to write tests using RSpec for modular Sinatra application.\r\n\r\nSteps\r\n=========\r\n---------\r\n\r\nStep 1\r\n---------\r\n\r\nCreate a Gemfile:\r\n\r\n```ruby\r\nsource \'https://rubygems.org\'\r\n\r\ngem \'sinatra\'\r\n\r\ngroup :test, :development do\r\n  gem \"rack-test\", require: \"rack/test\"\r\n  gem \"rspec\"\r\nend\r\n```\r\n\r\nWe group the gems that is not required for production in :test and :development in the Gemfile.\r\n\r\n\r\nStep 2\r\n---------\r\n\r\nInstall the gems.\r\n\r\n```sh\r\n$bundle install\r\n```\r\n\r\nStep 3\r\n---------\r\n\r\nCreate config.ru in the project folder.\r\n\r\n```ruby\r\nconfig.ru\r\n\r\nrequire \'./hello_world\'\r\n\r\nrun HelloWorld\r\n```\r\n\r\nStep 4\r\n---------\r\n\r\nCreate spec/spec_helper.rb\r\n\r\n```ruby\r\nrequire \'rack/test\'\r\nrequire \'rspec\'\r\n\r\nENV[\'RACK_ENV\'] = \'test\'\r\n\r\nmodule RSpecMixin\r\n  include Rack::Test::Methods\r\n  \r\n  def app\r\n    described_class \r\n  end\r\nend\r\n\r\nRSpec.configure do |c| \r\n  c.include RSpecMixin \r\nend\r\n```\r\n\r\nThe app method uses described_class because we are using a modular Sinatra application.\r\n\r\nStep 5\r\n---------\r\n\r\nCreate spec/hello\\_world\\_spec.rb with:\r\n\r\n```ruby\r\nrequire_relative \'../spec_helper.rb\'\r\nrequire_relative \'../../hello_world.rb\'\r\n\r\nRSpec.describe HelloWorld  do\r\n  \r\n  it \'should greet\' do\r\n    get \'/\'\r\n    \r\n    expect(last_response).to be_ok\r\n    expect(last_response.body).to eq(\'Hello, world!\')\r\n  end\r\nend\r\n```\r\n\r\nStep 6\r\n---------\r\n\r\nCreate hello_world.rb with:\r\n\r\n```ruby\r\nrequire \'sinatra\'\r\n\r\nclass HelloWorld < Sinatra::Base\r\n  get \'/\' do\r\n    \'Hello, world!\'\r\n  end\r\nend\r\n```\r\n\r\nStep 7\r\n---------\r\n\r\nRun the test.\r\n\r\n```sh\r\n$rspec spec/hello_world_spec.rb\r\n```\r\n\r\nSummary\r\n========\r\n---------\r\n\r\nIn this article, you learned how to test a modular Sinatra application using RSpec.','2015-04-25 22:04:40','2016-12-22 21:14:21'),(1841,'Sinatra Basics : Cleanup','Objective\r\n=========\r\n---------\r\n\r\nTo clean up the code from previous article.\r\n\r\nSteps\r\n=========\r\n---------\r\n\r\nStep 1\r\n---------\r\n\r\nIn the Gemfile, we only add gems to the required environment.\r\n\r\n```ruby\r\nsource \'https://rubygems.org\'\r\n\r\ngem \'sinatra\'\r\n\r\ngroup :test, :development do\r\n  gem \"rspec\"\r\nend\r\n\r\ngroup :test do\r\n  gem \"rack-test\", require: \"rack/test\"\r\nend\r\n```\r\n\r\nStep 2\r\n---------\r\n\r\n```ruby\r\nrequire_relative \'hello_world\'\r\n\r\nrun HelloWorld\r\n```\r\n\r\nInstead of hard coding \'.\', we now use require_relative.\r\n\r\nStep 3\r\n---------\r\n\r\nIn spec/hello\\_world\\_spec.rb:\r\n\r\n```ruby\r\nrequire_relative \'spec_helper.rb\'\r\nrequire_relative \'../hello_world.rb\'\r\n\r\nRSpec.describe HelloWorld  do\r\n  \r\n  it \'should greet\' do\r\n    get \'/\'\r\n    \r\n    expect(last_response).to be_ok\r\n    expect(last_response.body).to eq(\'Hello, world!\')\r\n  end\r\nend\r\n```\r\n\r\nStep 4\r\n---------\r\n\r\nIn hello_world.rb\r\n \r\n```ruby\r\nENV[\'RACK_ENV\'] ||= \'development\'\r\n\r\nrequire \'bundler\'\r\nBundler.require :default, ENV[\'RACK_ENV\'].to_sym\r\n\r\nclass HelloWorld < Sinatra::Base\r\n  get \'/\' do\r\n    \'Hello, world!\'\r\n  end\r\nend\r\n```\r\n\r\nIntead of require \'sinatra\', we are using bundler to require the gems that is necessary for the given environment.\r\n\r\nStep 5\r\n---------\r\n\r\nAdd .rspec file with:\r\n\r\n```sh\r\n--color\r\n--format documentation\r\n```\r\n\r\nStep 6\r\n---------\r\n\r\nRun the tests.\r\n\r\n```sh\r\n$bundle exec rspec\r\n```\r\n\r\nStep 7\r\n---------\r\n\r\nRun the application.\r\n\r\n```sh\r\n$rackup\r\n```\r\n\r\nStep 8\r\n---------\r\n\r\nBrowse to `localhost:9292`.\r\n\r\nSummary\r\n========\r\n---------\r\n\r\nIn this article, we cleaned up the code by grouping gems in the appropriate environment and using Bundler to require the gems needed in a given environment. We also used default values to make the output show in color with formatted documentation when we run rspec.\r\n\r\nReferences\r\n========\r\n---------\r\n\r\n[Sinatra Best Practices](http://blog.carbonfive.com/2013/06/24/sinatra-best-practices-part-one/ \"Sinatra Best Practices\")\r\n[Sinatra Best Practices](https://github.com/laser/sinatra-best-practices \"Sinatra Best Practices\")\r\n[Sinatra Explained](https://github.com/zhengjia/sinatra-explained \"Sinatra Best Practices\")','2015-04-25 22:14:35','2016-12-22 21:15:13'),(1851,'Sinatra Basics : Customizing Status Code and Error Message','Objective\r\n=========\r\n---------\r\n\r\nTo learn how to use halt method.\r\n\r\nSteps\r\n=========\r\n---------\r\n\r\nStep 1\r\n---------\r\n\r\n```ruby\r\nrequire \'sinatra\'\r\n\r\nget \'/\' do\r\n  halt 400, \'Validation failed\'\r\nend\r\n```\r\n\r\nYou can use the status method, but it does not allow providing a custom error message.\r\n\r\nStep 2\r\n---------\r\n\r\nRun the application.\r\n\r\n```sh\r\n$shotgun status.rb\r\n```\r\n\r\nStep 3\r\n---------\r\n\r\nBrowse to http://localhost:9393\r\n\r\nStep 4\r\n---------\r\n\r\nYou see status code 400 in the server log and \'Validation failed\' in the browser.\r\n\r\nStep 5\r\n---------\r\n\r\nChange the status code to 500 and refresh the browser. You will now see the status code is 500.\r\n\r\nSummary\r\n========\r\n---------\r\n\r\nIn this article, you learned how to use halt method to customize status code and error message in a Sinatra application.','2015-04-25 22:21:09','2015-04-25 22:21:09'),(1861,'Sinatra Basics : Running Rspec Tests and Sinatra Console','Objective\r\n=========\r\n---------\r\n\r\nTo learn how to use rake to run all rspec tests in a Sinatra application and to create your own Sinatra console.\r\n\r\nSteps\r\n=========\r\n---------\r\n\r\nStep 1\r\n---------\r\n\r\nCreate Rakefile:\r\n\r\n```ruby\r\nbegin\r\n  require \'rspec/core/rake_task\'\r\n\r\n  RSpec::Core::RakeTask.new(:spec)\r\n\r\n  task :default => :spec\r\nrescue LoadError\r\n  # no rspec available\r\nend\r\n```\r\n\r\nStep 2\r\n---------\r\n\r\nNow you can run all the tests by running the rake command.\r\n\r\n```sh\r\n$rake\r\n```\r\n\r\nStep 3\r\n---------\r\n\r\nConsole for Sinatra application:\r\n\r\n```ruby\r\ndesc \"Open an irb session preloaded with your model\"\r\ntask :console do\r\n  require \'active_record\'\r\n  require \'./app/models/article.rb\'\r\n  require \'irb\'\r\n  ARGV.clear\r\n  IRB.start\r\nend\r\n```\r\n\r\nStep 4\r\n---------\r\n\r\nTo experiment in a Sinatra console:\r\n\r\n```sh\r\n$rake console\r\n```\r\n\r\nSummary\r\n========\r\n---------\r\n\r\nIn this article, you learned how to run all tests using a rake task and how to create your own Sinatra console similar to rails console.\r\n\r\n\r\nReference\r\n========\r\n---------\r\n[Rake Task Command Line](https://www.relishapp.com/rspec/rspec-core/docs/command-line/rake-task \'Rake Task Command Line\')','2015-04-25 22:31:37','2015-04-25 22:31:37'),(1871,'Sinatra Basics : Test Coverage for Sinatra Applications','Objective\r\n=========\r\n---------\r\n\r\nTo learn how to setup simplecov to generate test coverage report.\r\n\r\nSteps\r\n=========\r\n---------\r\n\r\nStep 1\r\n---------\r\n\r\nIn your Gemfilefile, add the following to the test group:\r\n\r\n```ruby\r\ngem \'simplecov\'\r\n```\r\n\r\nStep 2\r\n---------\r\n\r\n```sh\r\n$bundle install\r\n```\r\n\r\nStep 3\r\n---------\r\n\r\nIn spec/spec_helper.rb (before anything else)\r\n\r\n```ruby\r\nrequire \'simplecov\'\r\nSimpleCov.start\r\n```\r\n\r\nStep 4\r\n---------\r\n\r\n```sh\r\n$rspec spec\r\n```\r\n\r\nStep 5\r\n---------\r\n\r\nTo view the test coverage report.\r\n\r\n```sh\r\n$open coverage/index.html\r\n```\r\n\r\nSummary\r\n========\r\n---------\r\n\r\nIn this article, you learned how to use simplecov gem to generate test coverage reports for a Sinatra application.','2015-04-25 22:40:04','2015-04-25 22:40:04'),(1881,'Sinatra Beyond Basics : TDD using Sinatra','Sinatra Basics : \r\n\r\nObjective\r\n=========\r\n---------\r\n\r\nTo write a simple hello world Sinatra program driven by tests.\r\n\r\nSteps\r\n=========\r\n---------\r\n\r\nStep 1\r\n---------\r\n\r\n```sh\r\n$gem install sinatra\r\n```\r\n\r\nStep 2\r\n---------\r\n\r\nCreate Gemfile in the project folder.\r\n\r\n```ruby\r\nsource \'https://rubygems.org\'\r\n\r\ngroup :test, :development do\r\n  gem \"rspec\"\r\nend\r\n```\r\n\r\nStep 3\r\n---------\r\n\r\n```sh\r\n$rspec --init\r\n```\r\n\r\nStep 4\r\n---------\r\n\r\n```sh\r\n$bundle\r\n```\r\n\r\nStep 5\r\n---------\r\n\r\nEdit .rspec\r\n\r\n```sh\r\n--format documentation\r\n--color\r\n--require spec_helper\r\n```\r\n\r\nStep 6\r\n---------\r\n\r\nCreate spec/hello_spec.rb\r\n\r\n```ruby\r\nrequire \'spec_helper\'\r\n\r\nRSpec.describe \'hello app\' do\r\n  it \'says hi\' do\r\n    get \'/\'\r\n    \r\n    expect(last_response).to be_ok\r\n  end\r\n  \r\nend\r\n```\r\n\r\nStep 7\r\n---------\r\n\r\nRun the test.\r\n\r\n```sh\r\n$rspec spec/hello_spec.rb \r\n\r\nhello app\r\n  says hi (FAILED - 1)\r\n\r\nFailures:\r\n\r\n  1) hello app says hi\r\n     Failure/Error: get \'/\'\r\n     NoMethodError:\r\n       undefined method `get\' for #<RSpec::ExampleGroups::HelloApp:0x007f9fdcb75588>\r\n     # ./spec/hello_spec.rb:5:in `block (2 levels) in <top (required)>\'\r\n\r\nFinished in 0.0005 seconds (files took 0.12564 seconds to load)\r\n1 example, 1 failure\r\n\r\nFailed examples:\r\n\r\nrspec ./spec/hello_spec.rb:4 # hello app says hi\r\n```\r\n\r\nStep 8\r\n---------\r\n\r\nAdd gem \'rack-test\' to Gemfile \r\n\r\n```ruby\r\ngroup :test, :development do\r\n  gem \"rspec\"\r\n  gem \'rack-test\'\r\nend\r\n```\r\n\r\nand run bundle.\r\n\r\nStep 9\r\n---------\r\n\r\nAdd require \'rack/test\' to the hello_spec.rb\r\n\r\n```ruby\r\nrequire \'spec_helper\'\r\nrequire \'rack/test\'\r\n\r\nRSpec.describe \'hello app\' do\r\n  it \'says hi\' do\r\n    get \'/\'\r\n    \r\n    expect(last_response).to be_ok\r\n  end\r\n  \r\nend\r\n```\r\n\r\nStep 10\r\n---------\r\n\r\nRun the test.\r\n\r\n```sh\r\n$rspec spec/hello_spec.rb \r\n\r\nhello app\r\n  says hi (FAILED - 1)\r\n\r\nFailures:\r\n\r\n  1) hello app says hi\r\n     Failure/Error: get \'/\'\r\n     NoMethodError:\r\n       undefined method `get\' for #<RSpec::ExampleGroups::HelloApp:0x007fae59c51958>\r\n     # ./spec/hello_spec.rb:6:in `block (2 levels) in <top (required)>\'\r\n\r\nFinished in 0.00055 seconds (files took 0.1249 seconds to load)\r\n1 example, 1 failure\r\n\r\nFailed examples:\r\n\r\nrspec ./spec/hello_spec.rb:5 # hello app says hi\r\n```\r\n\r\nStep 11\r\n---------\r\n\r\nAdd include Rack::Test::Methods to the test.\r\n\r\n```ruby\r\nrequire \'spec_helper\'\r\nrequire \'rack/test\'\r\n\r\nRSpec.describe \'hello app\' do\r\n  include Rack::Test::Methods\r\n    \r\n  it \'says hi\' do\r\n    get \'/\'\r\n    \r\n    expect(last_response).to be_ok\r\n  end\r\n  \r\nend\r\n```\r\n\r\nStep 12\r\n---------\r\n\r\nRun the test.\r\n\r\n```sh\r\n$rspec spec/hello_spec.rb \r\n\r\nhello app\r\n  says hi (FAILED - 1)\r\n\r\nFailures:\r\n\r\n  1) hello app says hi\r\n     Failure/Error: get \'/\'\r\n     NameError:\r\n       undefined local variable or method `app\' for #<RSpec::ExampleGroups::HelloApp:0x007fec329df5f0>\r\n     # ./spec/hello_spec.rb:8:in `block (2 levels) in <top (required)>\'\r\n\r\nFinished in 0.00067 seconds (files took 0.1241 seconds to load)\r\n1 example, 1 failure\r\n\r\nFailed examples:\r\n\r\nrspec ./spec/hello_spec.rb:7 # hello app says hi\r\n```\r\n\r\n\r\nStep 13\r\n---------\r\n\r\nAdd app method:\r\n\r\n```ruby\r\nrequire \'spec_helper\'\r\nrequire \'rack/test\'\r\n\r\nRSpec.describe \'hello app\' do\r\n  include Rack::Test::Methods\r\n  \r\n  def app\r\n    Sinatra::Application\r\n  end\r\n  \r\n  it \'says hi\' do\r\n    get \'/\'\r\n    \r\n    expect(last_response).to be_ok\r\n  end\r\n  \r\nend\r\n```\r\n\r\n\r\nStep 14\r\n---------\r\n\r\nRun the test.\r\n\r\n```ruby\r\nrspec spec/hello_spec.rb \r\n\r\nhello app\r\n  says hi (FAILED - 1)\r\n\r\nFailures:\r\n\r\n  1) hello app says hi\r\n     Failure/Error: Sinatra::Application\r\n     NameError:\r\n       uninitialized constant Sinatra\r\n     # ./spec/hello_spec.rb:8:in `app\'\r\n\r\nFinished in 0.00064 seconds (files took 0.12533 seconds to load)\r\n1 example, 1 failure\r\n\r\nFailed examples:\r\n\r\nrspec ./spec/hello_spec.rb:11 # hello app says hi\r\n```\r\n\r\nStep 15\r\n---------\r\n\r\nCreate hello.rb in the project folder.\r\n\r\n```ruby\r\nrequire \'sinatra\'\r\n\r\nget \'/\' do\r\n  \"Hello\"\r\nend\r\n```\r\n\r\nStep 16\r\n---------\r\n\r\nAdd require_relative \'../hello\' to the test.\r\n\r\n```ruby\r\nrequire \'spec_helper\'\r\nrequire \'rack/test\'\r\nrequire_relative \'../hello\'\r\n\r\nRSpec.describe \'hello app\' do\r\n  include Rack::Test::Methods\r\n  \r\n  def app\r\n    Sinatra::Application\r\n  end\r\n  \r\n  it \'says hi\' do\r\n    get \'/\'\r\n    \r\n    expect(last_response).to be_ok\r\n  end\r\n  \r\nend\r\n```\r\n\r\nStep 17\r\n---------\r\n\r\nAdd gem \'sinatra\' to Gemfile.\r\n\r\n```ruby\r\nsource \'https://rubygems.org\'\r\n\r\ngem \'sinatra\'\r\n\r\ngroup :test, :development do\r\n  gem \"rspec\"\r\n  gem \'rack-test\'\r\nend\r\n```\r\n\r\nStep 18 \r\n---------\r\n\r\nRun the test.\r\n\r\n```sh\r\n$rspec spec/hello_spec.rb \r\n\r\nhello app\r\n  says hi\r\n\r\nFinished in 0.02757 seconds (files took 0.15931 seconds to load)\r\n1 example, 0 failures\r\n```\r\n\r\nSummary\r\n========\r\n---------\r\n\r\nIn this article, we wrote a simple hello world program in Sinatra driven by tests.\r\n\r\n\r\nReferences\r\n========\r\n---------\r\n\r\n[Zero to Smoke Test with Sinatra](http://devblog.avdi.org/2014/07/08/zero-to-smoke-test-with-sinatra/ \'Zero to Smoke Test with Sinatra\')\r\n[Testing Sinatra](http://www.sinatrarb.com/testing.html \'Testing Sinatra\')','2015-04-25 23:17:50','2015-04-25 23:17:50'),(1891,'Sinatra Beyond Basics : Implement Post Driven by Tests','Objective\r\n=========\r\n---------\r\n\r\nTo implement posting to a URL driven by tests.\r\n\r\nSteps\r\n=========\r\n---------\r\n\r\nStep 1\r\n---------\r\n\r\nAdd the next test:\r\n\r\n```ruby\r\n  it \'greets by name\' do\r\n    post \'/\', { \'name\' => \'Bugs Bunny\' }\r\n    \r\n    expect(last_response.body).to eq(\"Hello Bugs Bunny\")  \r\n  end\r\n```\r\n\r\nso that your hello_spec.rb now looks like this:\r\n\r\n```ruby\r\nrequire \'spec_helper\'\r\nrequire \'rack/test\'\r\nrequire_relative \'../hello\'\r\n\r\nRSpec.describe \'hello app\' do\r\n  include Rack::Test::Methods\r\n  \r\n  def app\r\n    Sinatra::Application\r\n  end\r\n  \r\n  it \'says hi\' do\r\n    get \'/\'\r\n    \r\n    expect(last_response).to be_ok\r\n  end\r\n  \r\n  it \'greets by name\' do\r\n    post \'/\', { \'name\' => \'Bugs Bunny\' }\r\n    \r\n    expect(last_response.body).to eq(\"Hello Bugs Bunny\")  \r\n  end\r\nend\r\n```\r\n\r\nThe app method defines the active application for this test.\r\n\r\n\r\nStep 2\r\n---------\r\n\r\nRun the test.\r\n\r\n```sh\r\n$rspec spec/hello_spec.rb \r\n```\r\n\r\n```sh\r\nhello app\r\n  says hi\r\n  greets by name (FAILED - 1)\r\n\r\nFailures:\r\n\r\n  1) hello app greets by name\r\n     Failure/Error: expect(last_response.body).to eq(\"Hello Bugs Bunny\")\r\n       \r\n       expected: \"Hello Bugs Bunny\"\r\n            got: \"<!DOCTYPE html>\\n<html>\\n<head>\\n  <style type=\\\"text/css\\\">\\n  body { text-align:center;font-family:helvetica,arial;font-size:22px;\\n    color:#888;margin:20px}\\n  #c {margin:0 auto;width:500px;text-align:left}\\n  </style>\\n</head>\\n<body>\\n  <h2>Sinatra doesn&rsquo;t know this ditty.</h2>\\n  <img src=\'http://example.org/__sinatra__/404.png\'>\\n  <div id=\\\"c\\\">\\n    Try this:\\n    <pre>post &#x27;&#x2F;&#x27; do\\n  &quot;Hello World&quot;\\nend\\n</pre>\\n  </div>\\n</body>\\n</html>\\n\"\r\n       \r\n       (compared using ==)\r\n       \r\n       Diff:\r\n       @@ -1,2 +1,22 @@\r\n       -Hello Bugs Bunny\r\n       +<!DOCTYPE html>\r\n       +<html>\r\n       +<head>\r\n       +  <style type=\"text/css\">\r\n       +  body { text-align:center;font-family:helvetica,arial;font-size:22px;\r\n       +    color:#888;margin:20px}\r\n       +  #c {margin:0 auto;width:500px;text-align:left}\r\n       +  </style>\r\n       +</head>\r\n       +<body>\r\n       +  <h2>Sinatra doesn&rsquo;t know this ditty.</h2>\r\n       +  <img src=\'http://example.org/__sinatra__/404.png\'>\r\n       +  <div id=\"c\">\r\n       +    Try this:\r\n       +    <pre>post &#x27;&#x2F;&#x27; do\r\n       +  &quot;Hello World&quot;\r\n       +end\r\n       +</pre>\r\n       +  </div>\r\n       +</body>\r\n       +</html>\r\n       \r\n     # ./spec/hello_spec.rb:21:in `block (2 levels) in <top (required)>\'\r\n\r\nFinished in 0.03022 seconds (files took 0.15834 seconds to load)\r\n2 examples, 1 failure\r\n\r\nFailed examples:\r\n\r\nrspec ./spec/hello_spec.rb:18 # hello app greets by name\r\n```\r\n\r\nStep 3\r\n---------\r\n\r\nImplement the post method :\r\n\r\n```ruby\r\nrequire \'sinatra\'\r\n\r\nget \'/\' do\r\n  \'hello\'\r\nend\r\n\r\npost \'/\' do\r\n  \"Hello #{params[:name]}\"\r\nend\r\n```\r\n\r\nStep 4\r\n---------\r\n\r\nRun the test.\r\n\r\n```sh\r\n$rspec spec/hello_spec.rb \r\n```\r\n\r\n```\r\nhello app\r\n  says hi\r\n  greets by name\r\n\r\nFinished in 0.02899 seconds (files took 0.15828 seconds to load)\r\n2 examples, 0 failures\r\n```\r\n\r\nStep 5\r\n---------\r\n\r\nRun the application.\r\n\r\n```sh\r\n$ruby hello.rb\r\n[2015-04-15 16:59:47] INFO  WEBrick 1.3.1\r\n[2015-04-15 16:59:47] INFO  ruby 2.2.1 (2015-02-26) [x86_64-darwin11.0]\r\n== Sinatra (v1.4.6) has taken the stage on 4567 for development with backup from WEBrick\r\n[2015-04-15 16:59:47] INFO  WEBrick::HTTPServer#start: pid=86461 port=4567\r\n```\r\n\r\nStep 6\r\n---------\r\n\r\nBrowse to `http://localhost:4567`. You will see hello.\r\n\r\nStep 7\r\n---------\r\n\r\nSince we don\'t have a view to submit the form values, we can use curl command to simulate a form post:\r\n\r\n```sh\r\n$curl --data \"name=Bugs\" http://localhost:4567\r\n```\r\n\r\nYou can see the output: Hello Bugs in the terminal.\r\n\r\nStep 8\r\n---------\r\n\r\nLet\'s cleanup. Move the require \'rack/test\' from the test file to the top of the spec_helper.rb file.\r\n\r\nDelete the line : include Rack::Test::Methods from the test file and change the spec_helper.rb to include it as follows:\r\n\r\n```ruby\r\nRSpec.configure do |config|\r\n  config.include Rack::Test::Methods\r\n  \r\n  \r\nend\r\n```\r\n\r\nRun the tests. \r\n\r\n```sh\r\n$rspec spec/hello_spec.rb  \r\n```\r\n\r\nIt will pass.\r\n\r\nStep 9\r\n---------\r\n\r\nAutomatically reload changes without server restart.\r\n\r\n```sh\r\ngem install shotgun\r\n```\r\n\r\nStep 10\r\n---------\r\n\r\n```sh\r\nshotgun hello.rb\r\n```\r\n\r\nInstall Rest Client Chrome plugin to use various verbs to play with the server code.\r\n\r\n\r\nSummary\r\n========\r\n---------\r\n\r\nIn this article, we implemented the posting to an url driven by tests.','2015-04-25 23:28:27','2016-12-22 21:16:46'),(1901,'Sinatra Beyond Basics : Post a JSON Payload','Objective\r\n=========\r\n---------\r\n\r\nTo learn how to post a JSON payload in a Sinatra application.\r\n\r\nSteps\r\n=========\r\n---------\r\n\r\nStep 1\r\n---------\r\n\r\nCreate the test file, `spec/todo_controller_spec.rb`.\r\n\r\n```ruby\r\nrequire \'spec_helper\'\r\n\r\nRSpec.describe TodoController do\r\n  \r\n  def app\r\n    TodoController\r\n  end\r\n  \r\n  it \'should take a json payload\' do\r\n    post \"/\", todo: { priority: 1, task: \'Get rich quick\' }\r\n    \r\n    expect(last_response).to be_ok\r\n  end\r\nend\r\n```\r\n\r\nStep 2\r\n---------\r\n\r\nRun the test.\r\n\r\n```sh\r\n$rspec spec/todo_spec.rb \r\n```\r\n\r\nWe get:\r\n\r\n```sh\r\n/spec/todo_spec.rb:4:in `<top (required)>\': uninitialized constant TodoController (NameError)\r\n```\r\n\r\nStep 3\r\n---------\r\n\r\nAdd:\r\n\r\n```ruby\r\nrequire_relative \'../controller/todo_controller\'\r\n```\r\n\r\nto the test. The file now looks like this:\r\n\r\n```ruby\r\nrequire \'spec_helper\'\r\nrequire_relative \'../controllers/todo_controller\'\r\n\r\nRSpec.describe TodoController do\r\n  \r\n  def app\r\n    TodoController\r\n  end\r\n  \r\n  it \'should take a json payload\' do\r\n    post \"/\", todo: { priority: 1, task: \'Get rich quick\' }\r\n    \r\n    expect(last_response).to be_ok\r\n  end\r\nend\r\n```\r\n\r\nStep 4\r\n---------\r\n\r\nCreate a controller folder in the project root folder. Create a file : todo\\_controller.rb in this folder.\r\n\r\n```ruby\r\nclass TodoController < Sinatra::Base\r\n  \r\nend\r\n```\r\n\r\nStep 5\r\n---------\r\n\r\nRun the test.\r\n\r\n```sh\r\n$rspec spec/todo_spec.rb \r\nsin/controller/todo_controller.rb:3:in `<top (required)>\': uninitialized constant Sinatra (NameError)\r\n```\r\n\r\nStep 6\r\n---------\r\n\r\nAdd require \'sinatra\' to the controller.\r\n\r\n```ruby\r\nrequire \'sinatra\'\r\n\r\nclass TodoController < Sinatra::Base\r\n  \r\nend\r\n```\r\n\r\nStep 7\r\n---------\r\n\r\nRun the test.\r\n\r\n```sh\r\n$rspec spec/todo_spec.rb \r\n```\r\n\r\nWe get:\r\n\r\n```sh\r\nTodoController\r\n  should take a json payload (FAILED - 1)\r\n\r\nFailures:\r\n\r\n  1) TodoController should take a json payload\r\n     Failure/Error: expect(last_response).to be_ok\r\n       expected `#<Rack::MockResponse:0x007fd8258306f8 </div>\\n</body>\\n</html>\\n\"]>.ok?` to return true, got false\r\n     # ./spec/todo_spec.rb:13:in `block (2 levels) in <top (required)>\'\r\n\r\nFinished in 0.02847 seconds (files took 0.16717 seconds to load)\r\n1 example, 1 failure\r\n\r\nFailed examples:\r\n\r\nrspec ./spec/todo_spec.rb:10 # TodoController should take a json payload\r\n```\r\n\r\nStep 8\r\n---------\r\n\r\nDefine the post method.\r\n\r\n```ruby\r\nrequire \'sinatra\'\r\n\r\nclass TodoController < Sinatra::Base\r\n  post \'/\' do\r\n    \r\n  end\r\nend\r\n```\r\n\r\nStep 9\r\n---------\r\n\r\nRun the test.\r\n\r\n```sh\r\n$rspec spec/todo_spec.rb \r\n```\r\n\r\nWe get:\r\n\r\n```ruby\r\nTodoController\r\n  should take a json payload\r\n\r\nFinished in 0.02671 seconds (files took 0.15869 seconds to load)\r\n1 example, 0 failures\r\n```\r\n\r\nStep 10\r\n---------\r\n\r\nPrint the params to the console\r\n\r\n```ruby\r\nrequire \'sinatra\'\r\n\r\nclass TodoController < Sinatra::Base\r\n  post \'/\' do\r\n    puts params\r\n  end\r\nend\r\n```\r\n\r\nStep 11\r\n---------\r\n\r\nRun the test.\r\n\r\n```sh\r\n$rspec spec/todo_spec.rb \r\n```\r\n\r\nWe get:\r\n\r\n```sh\r\nTodoController\r\n{\"todo\"=>{\"priority\"=>\"1\", \"task\"=>\"Get rich quick\"}}\r\n  should take a json payload\r\n\r\nFinished in 0.02707 seconds (files took 0.16052 seconds to load)\r\n1 example, 0 failures\r\n```\r\n\r\nStep 12\r\n---------\r\n\r\nLet\'s organize. Create an app folder in the root of the project and move the controller directory into it. Rename the todo\\_spec.rb to todo\\_controller\\_spec.rb and move it to spec/controller folder.\r\n\r\nSummary\r\n========\r\n---------\r\n\r\nIn this article, you learned how to post a JSON payload to a Sinatra application. The next article in this series will post a JSON payload instead of a hash.\r\n\r\nReferences\r\n========\r\n---------\r\n\r\n[Sinatra App with RSpec](http://shiroyasha.github.io/sinatra-app-with-rspec.html \'Sinatra App with RSpec\')','2015-04-25 23:42:24','2016-12-22 21:18:04'),(1911,'Ruby Object Model : The Current Object, \'self\' in Ruby','Objective\r\n=========\r\n---------\r\n\r\nTo learn about the current object \'self\' and the top level context in Ruby.\r\n\r\nSteps\r\n=========\r\n---------\r\n\r\nStep 1\r\n---------\r\n\r\nIn Ruby, there is always one object that plays the role of current object which is the default receiver. It is called the \'self\'. Let\'s see the value of self.\r\n\r\n```ruby\r\nputs self\r\n```\r\n\r\nThis prints: main. This tells us that Ruby has created an object called main for us at the top level and all the code we write at the top level will use main as the receiver in method calls. What is top level? You are in top level when you have not entered into a class or module definition or exited from all class or module definitions.\r\n\r\nStep 2\r\n---------\r\n\r\nIf main is an object, it must be instance of some class. We can ask Ruby to tell us which class main is an instance of:\r\n\r\n```ruby\r\nputs self.class\r\n```\r\n\r\nThis prints Object. So we now know, Ruby did something like this:\r\n\r\n```ruby\r\nmain = Object.new\r\n```\r\n\r\nto provide us the default receiver \'main\'.\r\n\r\nStep 3\r\n---------\r\n\r\n```ruby\r\nputs \'hello\'\r\n```\r\n\r\nThis prints hello.\r\n\r\nStep 4\r\n---------\r\n\r\nIf you use an explicit receiver, the \'self\' to call the puts:\r\n\r\n```ruby\r\nself.puts \'hi\'\r\n```\r\n\r\nWe get:\r\n\r\n```sh\r\nNoMethodError: private method ‘puts’ called for main:Object\r\n```\r\n\r\nThis is due to the fact that puts is a private method in Object. In Ruby you cannot have an explicit receiver to call a private method.\r\n\r\nStep 5\r\n---------\r\n\r\nCan we use main Object to call puts?\r\n\r\n```ruby\r\nmain.puts \'hi\'\r\n```\r\n\r\nWe get:\r\n\r\n```sh\r\nNameError: undefined local variable or method ‘main’ for main:Object\r\n```\r\n\r\nEventhough Ruby prints \'main\' as the current object at the top level. There is no such variable called main. The \'main\' is the human visible representation of the current object.\r\n\r\nStep 6\r\n---------\r\n\r\nSo the question is : How to grab the top level default object (main)? Let\'s grab the value of the current object from the \'self\' and assign it to our own variable m.\r\n\r\n```ruby\r\nm = self\r\n\r\nm.puts \'hi\'\r\n```\r\n\r\nWe get the same error message as we did in step 4.\r\n\r\n```sh\r\nNoMethodError: private method ‘puts’ called for main:Object\r\n```\r\n\r\nSo we cannot call the puts private method with an explicit receiver. This is similar to doing something like this:\r\n\r\n```ruby\r\nclass Car\r\n  \r\n  private\r\n  \r\n  def change_gear\r\n    \'changing gear\'\r\n  end\r\nend\r\n\r\nc = Car.new\r\nc.change_gear\r\n```\r\n\r\nThis will also give you: \r\n\r\n```sh\r\nNoMethodError: private method ‘change_gear’ called for #<Car:0x007>\r\n```\r\n\r\nStep 7\r\n---------\r\n\r\nWe can use send to send the puts message to the main object:\r\n\r\n```ruby\r\nm = self\r\n\r\nm.send(:puts,\'hi\')\r\n```\r\n\r\nwill work and is the same as:\r\n\r\n```ruby\r\nself.send(:puts,\'hi\')\r\n```\r\n\r\nThis breaks encapsulation and is generally not a good idea unless you have a good reason to do so.\r\n\r\nLesson Learned\r\n-------\r\n\r\nThe self takes the value of an instance of Object, this is \'main\'. The value of self is implicit, you cannot explicitly provide a receiver to call private methods. You must call the puts without a receiver at the top level.\r\n\r\nStep 8\r\n---------\r\n\r\nIn the Ruby documentation, puts is an instance method in IO class.\r\n\r\n```ruby\r\nio = IO.new(1)\r\nio.puts \'hello\'\r\n```\r\n\r\n1 here indicates standard output. This prints \'hello\' to standard output. \r\n\r\nStep 9\r\n---------\r\n\r\nIt\'s the same as doing: \r\n\r\n```ruby\r\n$stdout.puts \'hello\'\r\n```\r\n\r\nHere the $stdout is the global variable for standard output. How come we were able to provide an explicit receiver in this case?\r\n\r\nStep 10\r\n---------\r\n\r\nLet\'s ask Ruby for the public instance methods of IO class.\r\n\r\n```ruby\r\nputs IO.public_instance_methods(false).grep(/put/)\r\n```\r\n\r\nThe result shows that the puts is a public method:\r\n\r\n```sh\r\nputc\r\nputs\r\n```\r\n\r\nSo, in this case we are not calling a private method in Object class but we are calling the public method puts in IO class. By the way, the false argument to the method filters out the methods from it\'s superclass.\r\n\r\nSummary\r\n========\r\n---------\r\n\r\nIn this lesson we briefly saw how everything is an object in Ruby and the role of self in a Ruby program. If you can answer the following questions either by creating an experiment or from the top of your head, you are on your way to mastering the Ruby Object Model.\r\n\r\n1. What is self?\r\n2. Why an explicit receiver cannot be used to call puts at the top level?\r\n3. Where is puts defined if you are calling from top level?\r\n4. How is puts available at the top level without a receiver?\r\n5. How to grab the top level default object?','2015-05-09 17:02:35','2015-05-16 19:28:25'),(1921,'Ruby Object Model : Class and Object','Objective\r\n=========\r\n---------\r\n\r\nTo learn about the Ruby\'s built-in Class and Object.\r\n\r\nSteps\r\n=========\r\n---------\r\n\r\nStep 1\r\n---------\r\n\r\nLet\'s take a look at user defined classes.\r\n\r\n```ruby\r\nclass Car \r\n  def drive\r\n    puts \'driving...\'\r\n  end\r\nend\r\n\r\nc = Car.new\r\nc.drive\r\n```\r\n\r\nThis prints \'driving...\'.\r\n\r\nWe created an instance of our car class and called the drive method.\r\n\r\nStep 2\r\n---------\r\n\r\nEverything in Ruby is an object. Even the class Car we defined is an object. So if that is the case then the Car class must be an instance of some class. What is that class? \r\n\r\n```ruby\r\nclass Car\r\n  \r\nend\r\n\r\np Car.class\r\n```\r\n\r\nThis prints \'Class\'. So the Car class is an instance of a class called Class. \r\n\r\nStep 3\r\n---------\r\n\r\n\r\nThe Class is Ruby\'s builtin class that provides the new method that we can use to instantiate the car object.\r\n\r\n```ruby\r\np Class.public_instance_methods(false).sort\r\n```\r\n\r\nThis prints [:allocate, :new, :superclass]. As a developer you will not call allocate method. You will use the new and superclass methods.\r\n\r\nStep 4\r\n---------\r\n\r\nWhen you use the language keyword \'class\', Ruby does something like this:\r\n\r\n```ruby\r\nCar = Class.new \r\n```\r\n\r\nLet\'s print the class of Car.\r\n\r\n```\r\np Car.class\r\n```\r\n\r\nThis prints Class. Since Car is an object you can call the instance method \'new\' like this:\r\n\r\n```ruby\r\ncar = Car.new\r\n```\r\n\r\nas in step 1. Because new is an instance method provided by Ruby\'s built-in class called Class.\r\n\r\nStep 5\r\n---------\r\n\r\nLet\'s create a subclass:\r\n\r\n```ruby\r\nclass Beetle < Car\r\n\r\nend\r\n\r\np Beetle.class\r\n```\r\n\r\nThis prints \'Class\'. Our new Beetle class also has class \'Class\' from which it gets the methods such as new, superclass and allocate.\r\n\r\nStep 6\r\n---------\r\n\r\nSo what is the superclass of Beetle?\r\n\r\n```ruby\r\np Beetle.superclass\r\n```\r\n\r\nThis prints Car. This is obvious since we defined Beetle to be subclass of Car. How about the Car class?\r\n\r\nStep 7\r\n---------\r\n\r\n```ruby\r\np Car.superclass\r\n```\r\n\r\nThis prints : Object. The class Object is Ruby\'s built-in class. It comes into picture when you consider the inheritance hierarchy.\r\n\r\nStep 8\r\n---------\r\n\r\nThis is implicit. So, no need to say:\r\n\r\n```ruby\r\nclass Car < Object\r\n\r\nend\r\n\r\np Car.class\r\n```\r\n\r\nStep 9\r\n---------\r\n\r\nIn the previous article, we saw the value of self.class is Object. So we can also do this:\r\n\r\n```ruby\r\nclass Car < self.class\r\n\r\nend\r\n\r\np Car.superclass\r\n```\r\n\r\nThis prints \'Object\'.\r\n\r\nStep 10\r\n---------\r\n\r\nThis makes the following code run just fine.\r\n\r\n```ruby\r\nclass Car < self.class\r\n  def drive\r\n    puts \'driving...\'\r\n  end\r\nend\r\n\r\nc = Car.new\r\nc.drive\r\n```\r\n\r\nThere is no need to explicitly specify the superclass in this case. But, that\'s what is going on behind the scenes.\r\n\r\nSummary\r\n========\r\n---------\r\n\r\nIn this article, we explored how everything is an object in Ruby. All objects are instances of the Ruby\'s built-in class called Class. The Ruby built-in Object comes into play in the inheritance hierarchy.','2015-05-09 18:42:16','2015-05-09 18:53:01'),(1931,'Ruby Object Model : Hierarchy of Class, Object and Module','Objective\r\n=========\r\n---------\r\n\r\nTo learn the hierarchy of Ruby built-in classes, Class, Object and Module.\r\n\r\nSteps\r\n=========\r\n---------\r\n\r\nStep 1\r\n---------\r\n\r\nIn the previous article we experimented with user defined classes and learned that it implicitly extends from Object. What is the Ruby\'s built-in Object\'s class? In other words, Object is an object, so it must be an instance of some class, what is that class? We can ask Ruby:\r\n\r\n```ruby\r\np Object.class\r\n```\r\n\r\nThis prints : Class\r\n\r\nStep 2\r\n---------\r\n\r\nThe Ruby\'s built-in Class itself is an object. So we can find out the class that is used to make instances of Class.\r\n\r\n```ruby\r\np Class.class\r\n```\r\n\r\nThis prints: Class. This seems to be similar to chicken and egg problem. How can Class be created from Class? But Ruby is very consistent. Whenever you use the language construct class to create a Class, either user defined or the existing Ruby\'s built-in classes, the Class will be used to create instances.\r\n\r\nStep 3\r\n---------\r\n\r\nIn the previous article, we saw that Object was the superclass of any user defined class. What is the superclass of Object?\r\n\r\n```ruby\r\np Object.superclass\r\n```\r\n\r\nThis prints : BasicObject\r\n\r\nStep 4\r\n---------\r\n\r\n```ruby\r\np BasicObject.superclass\r\n```\r\n\r\nprints nil. This means BasicObject is the root of the hierarchy. The BasicObject is an instance of Class. You can verify it like this:\r\n\r\n```ruby\r\np BasicObject.class\r\n```\r\n\r\nStep 5\r\n---------\r\n\r\nWhat is the superclass of Class?\r\n\r\n```ruby\r\np Class.superclass\r\n```\r\n\r\nThis prints : Module.\r\n\r\nStep 6\r\n---------\r\n\r\nThe class Module is an object. What class is it an instance of?\r\n\r\n```ruby\r\np Module.class\r\n```\r\n\r\nThis prints : Class\r\n\r\nStep 7\r\n---------\r\n\r\nHow can module be a class? Let\'s say we have a Vehicle module:\r\n\r\n```ruby\r\nmodule Vehicle\r\n  def wheels\r\n    1000\r\n  end\r\nend\r\n\r\np Vehicle.class\r\n```\r\n\r\nThis prints : Module. The Module is a class because Ruby defines Module like this:\r\n\r\n```ruby\r\nclass Module\r\n\r\nend	\r\n```\r\n\r\nStep 8\r\n---------\r\n\r\nSo instead of doing this:\r\n\r\n```ruby\r\nmodule Vehicle\r\n  def wheels\r\n    100\r\n  end\r\nend\r\n\r\nclass Car\r\n  include Vehicle\r\nend\r\n\r\nc = Car.new\r\np c.wheels\r\n```\r\n\r\nWe can do the same thing we did above like this:\r\n\r\n```ruby\r\nVehicle = Module.new do\r\n  def wheels\r\n    100\r\n  end\r\nend\r\n\r\nclass Car\r\n  include Vehicle\r\nend\r\n\r\nc = Car.new\r\np c.wheels\r\n```\r\n\r\nWhy would you want to do it the second way? The answer to this question will be discussed in an upcoming article.\r\n\r\nStep 9\r\n---------\r\n\r\nLet\'s now compare the methods in Module, Class and Object. Here are the methods in Module.\r\n\r\n```ruby\r\np Module.public_methods(false).sort\r\n```\r\n\r\nThis prints:\r\n\r\n```sh\r\n[:allocate, :constants, :nesting, :new, :superclass]\r\n```\r\n\r\nHere is the methods in Class.\r\n\r\n```ruby\r\np Class.public_methods(false).sort\r\n```\r\n\r\n```sh\r\n[:allocate, :constants, :nesting, :new, :superclass]\r\n```\r\n\r\nHere is the methods in Object.\r\n\r\n```ruby\r\np Object.public_methods(false).sort\r\n```\r\n	   \r\n```sh	    \r\n[:allocate, :new, :superclass]\r\n```\r\n\r\nSo you can see we can create instances of Module, Class and Object. Because they have the method new().\r\n\r\nStep 10\r\n---------\r\n\r\nWe already know that user defined classes are instances of Class. So instead of doing this:\r\n\r\n```ruby\r\nclass Car\r\n  def drive\r\n    p \'driving...\'\r\n  end\r\nend\r\n\r\nc = Car.new\r\nc.drive\r\n```\r\n\r\nWe can do this:\r\n\r\n```ruby\r\nCar = Class.new do\r\n  def drive\r\n    p \'driving...\'\r\n  end\r\n  \r\nend\r\n\r\nc = Car.new\r\nc.drive\r\n```\r\n\r\nBoth versions of the Car examples print \'driving...\'. Why would you want to do it the second way? The answer to this question will be discussed in an upcoming article.\r\n\r\nSummary\r\n========\r\n---------\r\n\r\nIn this article you learned the Ruby\'s built-in class hierarchy consisting of Class, Object, Module and BasicObject. You also saw how we can create modules and classes by creating them on the fly and adding methods to it.','2015-05-09 21:27:10','2015-05-27 20:35:27'),(1941,'Ruby Object Model : The Method Lookup in Ruby','Objective\r\n=========\r\n---------\r\n\r\nTo learn about the introspection abilities of Ruby and method lookup.\r\n\r\nSteps\r\n=========\r\n---------\r\n\r\nStep 1\r\n---------\r\n\r\nWe already know that class Object is the super class of any user defined class. Let\'s define a greet method by opening the Ruby\'s built-in Object class.\r\n\r\n```ruby\r\nclass Object\r\n  def greet\r\n    puts \'hi\'\r\n  end  \r\nend\r\n```\r\n\r\nStep 2\r\n---------\r\n\r\nLet\'s create a class and call the method greet on it.\r\n\r\n```ruby\r\nclass Greeter\r\n  \r\nend\r\n\r\ng = Greeter.new\r\ng.greet\r\n```\r\n\r\nThis prints : \'hi\'. The method looks for the method greet in the Greeter class, it does not find it there. So it goes to the superclass of Greeter which is the Object, since it is defined there, it calls the method.\r\n\r\nStep 3\r\n---------\r\n\r\nWe can ask ruby for its method look up path like this:\r\n\r\n```ruby\r\nclass Object\r\n  def greet\r\n    p \'hi\'\r\n  end\r\nend\r\n\r\nclass Greeter\r\n  \r\nend\r\n\r\np Greeter.ancestors\r\n```\r\n\r\nThis prints : [Greeter, Object, Kernel, BasicObject]. This shows that Ruby looks for the method in the Greeter class, then Object, then Kernel module and finally the BasicObject.\r\n\r\n\r\nStep 4\r\n---------\r\n\r\nLet\'s look at a simple example that we can use to experiment and learn.\r\n\r\n```ruby\r\nclass Greeting\r\n  def initialize(text)\r\n    @text = text\r\n  end\r\n  \r\n  def welcome\r\n    @text\r\n  end\r\nend\r\n\r\no = Greeting.new(\'Hi\')\r\np o.class\r\n```\r\n\r\nThis prints : \'Greeting\'. We know the instance of Greeting, the object o is created using the Greeting class. We can also get the instance methods, instance variables as follows: \r\n\r\n```ruby\r\np o.class.instance_methods(false)\r\n```\r\n\r\nThis prints : [:welcome]\r\n\r\n```ruby\r\np o.instance_variables\r\n```\r\n\r\nThis prints : [:@text]\r\n\r\nSummary\r\n========\r\n---------\r\n\r\nIn this article, we saw the introspection abilities of Ruby by asking for its instance variables, instance methods, ancestors. Why do we need to worry about class hierarchy in Ruby? Because it determines the method lookup in Ruby.','2015-05-10 00:31:21','2015-05-10 00:42:44'),(1951,'Authentication from Scratch :  Register Feature','Objective\r\n=========\r\n---------\r\n\r\nTo implement register feature using ActiveModel in Rails 4.2.1 using Ruby 2.2.2.\r\n\r\nDiscussion\r\n=========\r\n---------\r\n\r\nDeveloping user management from scratch gives us the most flexibility in our projects. We stop wasting time on gems like devise to customize the library and focus more on keeping our code base lightweight and easy to change. This gives us the freedom from third party software release schedule. We get to choose when we can upgrade to what version of Ruby and Rails without worrying about whether a third party library has any unresolved bugs or not. Your code is also compact without any bloated unnecessary features for your projects. You get to pick what features you need for your user management system and use only what you need for your current project.\r\n\r\nSteps\r\n=========\r\n---------\r\n\r\nStep 1\r\n---------\r\n\r\n```ruby\r\nrails new ascrat --skip-test-unit --skip-bundle --skip-spring\r\n```\r\n\r\nWe do not want to use test unit framework. We also skip bundle install when the rails project is created. We do not want spring due to headaches it can create in development.\r\n\r\nStep 2\r\n---------\r\n\r\nWe don\'t need the useless Coffeescript. So delete coffee-script gem in Gemfile. Uncomment bcrypt gem. The bcrypt gem is an easy way to users\' passwords secure. ActiveModel::SecurePassword uses bcrypt gem. Run bundle install.\r\n\r\nStep 3\r\n---------\r\n\r\nLet\'s turn off the generation of javascripts. In development.rb, add:\r\n\r\n```ruby\r\nconfig.generators.javascripts = false\r\n```\r\n\r\nStep 4\r\n---------\r\n\r\nCreate a user model with email and password_digest fields.\r\n\r\n```ruby\r\nrails g model user email password_digest\r\n```\r\n\r\nStep 5\r\n---------\r\n\r\nAdd the not null constraints to email and `password_digest` fields in `db/migrate/*_create_users.rb`.\r\n\r\n```ruby\r\nclass CreateUsers < ActiveRecord::Migration\r\n  def change\r\n    create_table :users do |t|\r\n      t.string :email, null: false\r\n      t.string :password_digest, null: false\r\n\r\n      t.timestamps null: false\r\n    end\r\n  end\r\nend\r\n```\r\n\r\nStep 6\r\n---------\r\n\r\nRun:\r\n\r\n```ruby\r\nrake db:migrate\r\n```\r\n\r\nStep 7\r\n---------\r\n\r\nAdd `has_secure_password` to User model.\r\n\r\n```ruby\r\nclass User < ActiveRecord::Base\r\n  has_secure_password\r\n  \r\n  validates :email, uniqueness: true\r\nend\r\n```\r\n\r\nUser has email and `password_digest` fields. The password is stored as `password_digest` by `has_secure_password` provided by ActiveModel.\r\n\r\nStep 8\r\n---------\r\n\r\nCreate the users controller. \r\n\r\n```ruby\r\nrails g controller users\r\n```\r\n\r\nStep 9\r\n---------\r\n\r\nChange the users controller to:\r\n\r\n```ruby\r\nclass UsersController < ApplicationController\r\n  def new\r\n    @user = User.new\r\n  end\r\n  \r\n  def create\r\n    @user = User.new(permitted_params)\r\n    if @user.save\r\n      redirect_to root_url, notice: \"Thank you for signing up!\"\r\n    else\r\n      render \"new\"\r\n    end\r\n  end\r\n  \r\n  private\r\n  \r\n  def permitted_params\r\n    params.require(:user).permit(:email, :password)\r\n  end\r\nend\r\n```\r\n\r\nStep 10\r\n---------\r\n\r\nAdd the signup form in app/views/users/new.html.erb.\r\n\r\n```ruby\r\n<h1>Sign Up</h1>\r\n\r\n<%= form_for @user do |f| %>\r\n  <% if @user.errors.any? %>\r\n    <div class=\"error_messages\">\r\n      <h2>Form is invalid</h2>\r\n      <ul>\r\n        <% @user.errors.full_messages.each do |message| %>\r\n          <li><%= message %></li>\r\n        <% end %>\r\n      </ul>\r\n    </div>\r\n  <% end %>\r\n\r\n  <div class=\"field\">\r\n    <%= f.label :email %><br />\r\n    <%= f.text_field :email %>\r\n  </div>\r\n  <div class=\"field\">\r\n    <%= f.label :password %><br />\r\n    <%= f.password_field :password %>\r\n  </div>\r\n  <div class=\"actions\"><%= f.submit \"Sign Up\" %></div>\r\n<% end %>\r\n```\r\n\r\nStep 11\r\n---------\r\n\r\nAdd: \r\n\r\n```ruby\r\n  resources :users\r\n  root \'welcome#index\'\r\n```\r\n\r\nto routes.rb.\r\n\r\nStep 12\r\n---------\r\n\r\nGenerate the controller for the home page.\r\n\r\n```ruby\r\nrails g controller welcome index\r\n```\r\n\r\nDelete get \'welcome/index\' in routes.rb.\r\n\r\nStep 13\r\n---------\r\n\r\nAdd:\r\n\r\n```ruby\r\n<%= link_to \"Sign Up\", new_user_path %>\r\n```\r\n\r\nto application.html.erb\r\n\r\nStep 14\r\n---------\r\n\r\nBrowse to `http://localhost:3000/` Click Sign Up. Fill out the form to signup. You can verify the user record was created by looking at the last user record created in the rails console.\r\n\r\nSummary\r\n========\r\n---------\r\n\r\nIn this article, we implemented register for an account using `has_secure_password` of ActiveModel in Rails 4.2.1. In the next article, we will continue to build upon this base by implementing login and logout features.','2015-05-10 22:21:44','2016-05-04 15:54:21'),(1961,'Authentication from Scratch :  Login and Logout','Objective\r\n=========\r\n---------\r\n\r\nTo implement Login and Logout features.\r\n\r\nSteps\r\n=========\r\n---------\r\n\r\nStep 1\r\n---------\r\n\r\nCreate a sessions controller.\r\n\r\n```ruby\r\nrails g controller sessions new\r\n```\r\n\r\nStep 2\r\n---------\r\n\r\nAdd:\r\n\r\n```ruby\r\nresources :sessions\r\n```\r\n\r\nin routes.rb and delete : \r\n\r\n```ruby\r\nget \'sessions/new\'\r\n```\r\n\r\nStep 3\r\n---------\r\n\r\nCreate app/views/sessions/new.html.erb:\r\n\r\n```ruby\r\n<h1>Log In</h1>\r\n\r\n<%= form_tag sessions_path do %>\r\n  <div class=\"field\">\r\n          <%= label_tag :email %><br />\r\n          <%= text_field_tag :email, params[:email] %>\r\n  </div>\r\n  <div class=\"field\">\r\n          <%= label_tag :password %><br />\r\n          <%= password_field_tag :password %>\r\n  </div>\r\n  <div class=\"actions\"><%= submit_tag \"Log In\" %>\r\n<% end %>\r\n```\r\n\r\nStep 4\r\n---------\r\n\r\nIn sessions_controller.rb, implement the create action:\r\n\r\n```ruby\r\n  def create\r\n    user = User.find_by_email(params[:email])\r\n    if user && user.authenticate(params[:password])\r\n      session[:user_id] = user.id\r\n      redirect_to root_url, notice: \"Logged in!\"\r\n    else\r\n      flash.now.alert = \"Email or password is invalid.\"\r\n    end\r\n  end\r\n```\r\n\r\nThis authenticates the user and if the user enters the right credentials, it will login the user.\r\n\r\nStep 5\r\n---------\r\n\r\nAdd the login link to the application layout, application.html.erb:\r\n\r\n```ruby\r\n  <%= link_to \"Log In\", new_session_path %>\r\n```\r\n \r\nAdd the code to display the flash messages in the layout file:\r\n\r\n```ruby  \r\n  <% flash.each do |name, msg| %>\r\n      <%= content_tag :div, msg, class: \"alert alert-info\" %>\r\n  <% end %>\r\n```\r\n\r\nThe application.html.erb file now looks like this:\r\n\r\n```ruby\r\n<body>\r\n\r\n<%= link_to \"Sign Up\", new_user_path %>\r\n<%= link_to \"Log In\", new_session_path %>\r\n\r\n  <% flash.each do |name, msg| %>\r\n     <%= content_tag :div, msg, class: \"alert alert-info\" %>\r\n  <% end %>\r\n\r\n<%= yield %>\r\n\r\n</body>\r\n```\r\n\r\nStep 6\r\n---------\r\n\r\nReload the home page. Click \'Log In\' and use the new user credentials to login.\r\n\r\nStep 7\r\n---------\r\n\r\nChange the application controller as follows:\r\n\r\n```ruby\r\nclass ApplicationController < ActionController::Base\r\n  # Prevent CSRF attacks by raising an exception.\r\n  # For APIs, you may want to use :null_session instead.\r\n  protect_from_forgery with: :exception\r\n  \r\n  private\r\n  \r\n  def current_user\r\n    @current_user ||= User.find(session[:user_id]) if session[:user_id]\r\n  end\r\n  \r\n  helper_method :current_user\r\nend\r\n```\r\n\r\nNow we can use the current_user helper in the view.\r\n\r\nStep 8\r\n---------\r\n\r\nIn application.html.erb, use the helper defined to display the links:\r\n\r\n```ruby\r\n  <% if current_user %>\r\n    Logged in as <%= current_user.email %>.\r\n  <% else %>\r\n    <%= link_to \"Sign Up\", new_user_path %> or\r\n    <%= link_to \"Log In\", new_session_path %>\r\n   <% end %>\r\n```\r\n\r\nReload the home page to see the email of the logged in user.\r\n\r\nStep 9\r\n---------\r\n\r\nIn sessions_controller, add destroy action: \r\n\r\n```ruby\r\n  def destroy\r\n    session[:user_id] = nil\r\n    redirect_to root_url, notice: \'Logged out!\'\r\n  end\r\n```\r\n\r\nStep 10\r\n---------\r\n\r\nAdd: \r\n\r\n```ruby\r\n<%= link_to \"Log Out\", session_path(\"current\"), method: \"delete\" %> \r\n```\r\n\r\nto application.html.erb. Reload page. Click logout to logout.\r\n\r\nStep 11\r\n---------\r\n\r\nTo implement automatic login on registration, add:       \r\n\r\n```ruby\r\nsession[:user_id] = @user.id\r\n```\r\n\r\nto users_controller.rb like this:\r\n\r\n```ruby\r\n  def create\r\n    @user = User.new(permitted_params)\r\n    if @user.save\r\n      session[:user_id] = @user.id\r\n      redirect_to root_url, notice: \"Thank you for signing up!\"\r\n    else\r\n      render \"new\"\r\n    end\r\n  end\r\n```\r\n\r\nNow the user will be automatically logged in when they register for an account.\r\n\r\nSummary\r\n========\r\n---------\r\n\r\nIn this article, we implemented login, logout and automatic login on registration features. In the next article we will continue to develop more features related to user management.','2015-05-10 23:04:55','2015-05-10 23:07:29'),(1971,'Developer Notes : Service Oriented Architecture and Rails','Basic Concepts\r\n=========\r\n---------\r\n\r\nWhy do we need to do up-front design of services?\r\n---------\r\n\r\nService oriented systems sacrifice iteration speed for stability, reuse and robustness.\r\n\r\nWhat is robustness?\r\n---------\r\n\r\nAbility to withstand changes in the operating environment without loss of functionality. Example: code changes, moving to another database etc.\r\n\r\nWhen is services a good choice?\r\n---------\r\n\r\nWhen an application has a stable, well-defined, and well-understood requirements.\r\n\r\nWhat are the advantages of using services rather than a monolithic application?\r\n---------\r\n\r\nIsolation\r\n\r\nWhat are the benefits of isolation?\r\n---------\r\n\r\n1. Easier to manage and optimize.\r\n2. Can be tested separately from other parts of an application.\r\n3. Easy way of organizing larger teams.\r\n\r\nWhat are the different levels of isolation?\r\n---------\r\n\r\nBusiness logic, shared system and full isolation.\r\n\r\nWhat is business logic isolation?\r\n---------\r\n\r\nServices that isolate based on business logic generally have their own application code, with a shared data store and shared systems.\r\n\r\nWhat is shared system isolation?\r\n---------\r\n\r\nServices running inside their own application instances. Each has its own databases but they could be running on the same hardware. \r\n\r\nWhat is full isolation?\r\n---------\r\n\r\nServices have their own server instances, separate code bases and their own data stores.\r\n\r\nHow does services approach help with scalability?\r\n---------\r\n\r\nUsing services makes it easy to scale portions of an application individually. Data can be split across services, and the performance under load can be optimized for each service. Once service can optimize for data writes, another for reads.\r\n\r\nHow does services approach provide agility?\r\n---------\r\n\r\nSwitching infrastructure choices and upgrading libraries is easier.\r\n\r\nHow do you deal with versioning?\r\n---------\r\n\r\nEach service interface should be versioned when an update includes a breaking change. We must be able to run multiple versions of a service simultaneously. If an update is additive, the service can remain at the same version.\r\n\r\nConverting to Services\r\n=========\r\n---------\r\n\r\nSegmenting into Services\r\n---------\r\n\r\nQuestions to determine how to redesign for services:\r\n\r\n1. Which data has high read and low write frequency?\r\n2. Which data has high write or update frequency?\r\n3. Which joins occur more frequently?\r\n4. Which parts of the application have clearly defined requirements and design?\r\n\r\nThe first three questions help us to determine where models might belong in different services. The last question helps to decide whether they remain in the Rails app.\r\n\r\nService and API Design\r\n=========\r\n---------\r\n\r\nPartitioning Functionality into Separate Services\r\n---------\r\n\r\nStrategies for splitting up the functionality of the model layer into services:\r\n\r\n1. Iteration Speed\r\n2. Logical Function\r\n3. Read / Write Frequency\r\n4. Join Frequency\r\n\r\nIteration Speed\r\n---------\r\n\r\nIdentify the parts of the application that are core and unlikely to change.\r\n\r\nLogical Function\r\n---------\r\n\r\nIs there a process that runs outside the request/response life cycle?\r\nViews and Controllers can also be partitioned based on logical function. \r\n\r\nRead / Write Frequency\r\n---------\r\n\r\nDifferent data stores are optimized for different behavior. You can optimize for either read or write.\r\n\r\nJoin Frequency\r\n---------\r\n\r\n1. Replicate data across services using messaging system to de-normalize data.\r\n2. Put in a single place where it is needed most frequently to minimize joins.\r\n\r\nVersioning Services\r\n=========\r\n---------\r\n\r\n1. Version number can be part of the path of a URI or one of the arguments in a query string.\r\n2. Use the Accept headers in a request to specify the version of an API. Caching is a problem in this case.','2015-05-11 02:33:36','2015-05-11 02:35:56'),(1981,'Ruby Object Model : Class Methods Demystified','Objective\r\n=========\r\n---------\r\n\r\nTo answer the burning question : Where does the class methods live?\r\n\r\nSteps\r\n=========\r\n---------\r\n\r\nStep 1\r\n---------\r\n\r\nLet\'s define a method drive in Car class.\r\n\r\n```ruby\r\nclass Car\r\n  def drive\r\n    p \'driving\'\r\n  end\r\nend\r\n\r\np Car.instance_methods(false).sort\r\n```\r\n\r\nThis prints : [:drive]\r\n\r\nStep 2\r\n---------\r\n\r\n```ruby\r\nclass Car\r\n  def self.drive\r\n    p \'driving\'\r\n  end\r\nend\r\n\r\np Car.instance_methods(false).sort\r\n```\r\n\r\nThis prints [] because there is no instance methods in Car. So the question is where does the class methods live?\r\n\r\nStep 3\r\n---------\r\n\r\nThe class methods live in a ghostclass, eigenclass or metaclass. We can use a special syntax that gives us a reference to the ghost class as follows:\r\n\r\n```ruby\r\nclass Car\r\n  def self.drive\r\n    p \'driving\'\r\n  end\r\nend\r\n\r\neigenclass = class << Car\r\n  self\r\nend\r\n\r\np eigenclass.instance_methods(false).sort\r\n```\r\n\r\nThis prints : [:drive]\r\n\r\nSo, we can see that the ghost class holds the class method we have defined in the Car class. Ruby 1.9 introduced singleton_methods that can be used like this:\r\n\r\n```ruby\r\np Car.singleton_methods\r\n```\r\n\r\nThis prints [:drive]. Thanks to Stefan Rusterholz feedback on rubyflow.com.\r\n\r\nStep 4\r\n---------\r\n\r\nTo illustrate the point made in the previous step, we can define the class method for Car in it\'s singleton like this:\r\n\r\n```ruby\r\nclass Car\r\nend\r\n\r\nclass << Car\r\n  def drive\r\n    \'driving\'\r\n  end\r\nend\r\n\r\np Car.drive\r\n```\r\n\r\nThis is same as this:\r\n\r\n```ruby\r\nclass Car\r\n  def self.drive\r\n    \'driving\'\r\n  end\r\nend\r\n\r\np Car.drive\r\n```\r\n\r\nand this:\r\n\r\n```ruby\r\nclass Car\r\n  class << self\r\n    def drive\r\n      \'driving\'\r\n    end\r\n  end\r\nend\r\n\r\np Car.drive\r\n```\r\n\r\nThe last form of defining a class methods will lead to difficulty in maintenance because when the class methods are way below its class << self, you cannot quickly determine whether it is a instance method or a class method. \r\n\r\nStep 5\r\n---------\r\n\r\nWhat class is this ghost class an instance of? Let\'s ask Ruby:\r\n\r\n```ruby\r\np eigenclass.class\r\n```\r\n\r\nThis prints : Class\r\n\r\nStep 6\r\n---------\r\n\r\nWhat is object hierarchy of the ghost class? Let\'s ask Ruby:\r\n\r\n```ruby\r\np eigenclass.ancestors\r\n```\r\n\r\nThis prints : \r\n\r\n```sh\r\n[#<Class:Car>, #<Class:Object>, #<Class:BasicObject>, Class, Module, Object, Kernel, BasicObject]\r\n```\r\nIn Ruby 1.9 and later, we can also do:\r\n\r\n```ruby\r\np Car.singleton_class.ancestors\r\n```\r\n\r\nThis shows there is a whole new hierarchy consisting of ghost classes for Car, Object and BasicObject. Compare this to the ancestors of a normal class:\r\n\r\n```ruby\r\np Car.ancestors\r\n```\r\n\r\nThis prints : \r\n\r\n```sh\r\n[Car, Object, Kernel, BasicObject]\r\n```\r\n\r\nNow we don\'t see any ghosts in this case.\r\n\r\nStep 7\r\n---------\r\n\r\nWe can go one level up and do a similar experiment.\r\n\r\n```ruby\r\nclass Object\r\n  def self.drive\r\n    p \'driving\'\r\n  end\r\nend\r\n\r\ng = class << Object\r\nself\r\nend\r\n\r\np g.ancestors\r\n```\r\n\r\nThis prints:\r\n\r\n```sh\r\n[#<Class:Object>, #<Class:BasicObject>, Class, Module, Object, Kernel, BasicObject]\r\n```\r\n\r\nStep 8\r\n---------\r\n\r\nLet\'s go one more level up and repeat a similar experiment.\r\n\r\n```ruby\r\ng = class << BasicObject\r\nself\r\nend\r\n\r\np g.ancestors\r\n```\r\n\r\nThis prints:\r\n\r\n```sh\r\n[#<Class:BasicObject>, Class, Module, Object, Kernel, BasicObject]\r\n```\r\n\r\nStep 9\r\n---------\r\n\r\n```ruby\r\nclass BasicObject\r\n  def self.drive\r\n    p \'driving...\'\r\n  end\r\nend\r\n\r\nclass Car\r\nend\r\n\r\nCar.drive\r\n```\r\n\r\nThis prints: driving\r\n\r\nSubclasses can call it\'s parent\'s class methods. If you are familiar with ActiveRecord library of Rails, we can do something like this:\r\n\r\n```ruby\r\nmodule ActiveRecord\r\n  class Base\r\n    def	self.find\r\n	  \'finding...\'\r\n	end\r\n  end\r\nend\r\n\r\nclass Car < ActiveRecord::Base\r\nend\r\n\r\nCar.find\r\n```\r\n\r\nSummary\r\n========\r\n---------\r\n\r\nIn this article, we designed experiments to answer the question : \'Where does the class method live?\'. We found that they live in singleton class and they have their own hierarchy. We also saw that class methods are inherited by the subclasses.','2015-05-16 20:07:04','2015-05-17 08:19:30'),(1991,'Web Development in Ruby : Write a Hello World Web App','Objective\r\n=========\r\n---------\r\n\r\nTo write a hello world web app that displays a static web page to a user.\r\n\r\nSteps\r\n=========\r\n---------\r\n\r\nStep 1\r\n---------\r\n\r\nCreate webrick.rb with the following code:\r\n\r\n```ruby\r\n#!/usr/bin/env ruby\r\nrequire \'webrick\'\r\ninclude WEBrick\r\ns = HTTPServer.new(\r\n    :Port => 3000,\r\n    :DocumentRoot => File.join(Dir.pwd, \"/html\")\r\n)\r\ntrap(\"INT\") { s.shutdown }\r\ns.start\r\n```\r\n\r\nStep 2\r\n---------\r\n\r\nCheck the permissions on webrick.rb.\r\n\r\n```sh\r\n$ls -l webrick.rb \r\n-rw-r--r--  1 zepho  staff  179 May 16 13:32 webrick.rb\r\n```\r\n\r\nGive execute permissions to the script by running:\r\n\r\n```sh\r\n$chmod a+x webrick.rb\r\n```\r\n\r\nCheck the permissions:\r\n\r\n```sh\r\n-rwxr-xr-x  1 zepho  staff  179 May 16 13:32 webrick.rb\r\n```\r\n\r\nStep 3\r\n---------\r\n\r\nCreate html directory with index.html:\r\n\r\n```sh\r\nHello Static Page\r\n```\r\n\r\nStep 4\r\n---------\r\n\r\nRun the script:\r\n\r\n```sh\r\n$ruby webrick.rb\r\n```\r\n\r\nStep 5\r\n---------\r\n\r\nBrowse to http://localhost:3000. You will see the contents of index.html file: Hello Static Page in the browser.\r\n\r\nStep 6\r\n---------\r\n\r\nCopy the script to local cgi-bin folder on the server.\r\n\r\nStep 7\r\n---------\r\n\r\nExecute it from a browser by going to your domain www.example.com.\r\n\r\nStep 8\r\n---------\r\n\r\nUse Ctrl+C to stop the server.\r\n\r\nSummary\r\n========\r\n---------\r\n\r\nIn this article, we wrote a simple hello world program that displays a static page. In subsequent articles of this series, we will create dynamic pages that will be executed on the server and display on the browser as a webpage.\r\n\r\nReference\r\n========\r\n---------\r\n\r\n[Ruby Webrick CGI Scripts](http://craiccomputing.blogspot.com/2008/03/ruby-webrick-and-cgi-scripts.html \'Ruby Webrick CGI Scripts\')','2015-05-16 20:48:04','2015-05-16 20:52:35'),(2001,'Web Development in Ruby : Static Website using Rack','Objective\r\n=========\r\n---------\r\n\r\nTo create a Rack compatible static website.\r\n\r\nSteps\r\n=========\r\n---------\r\n\r\nStep 1\r\n---------\r\n\r\nCreate the following directory structure.\r\n\r\n```html\r\n- site\r\n  |- config.ru\r\n  |- Gemfile\r\n  |- public\r\n    |- index.html\r\n    |- images\r\n    |- js\r\n    |- css\r\n```\r\n\r\nStep 2\r\n---------\r\n\r\nEdit Gemfile to :\r\n\r\n```ruby\r\nsource \"https://rubygems.org\"\r\n\r\ngem \"rack\"\r\n```\r\n\r\nStep 3\r\n---------\r\n\r\nInstall the rack gem.\r\n\r\n```sh\r\n$ bundle install\r\n```\r\n\r\nStep 4\r\n---------\r\n\r\nAdd the following to index.html:\r\n\r\nHello world\r\n\r\nStep 5\r\n---------\r\n\r\nEdit config.ru:\r\n\r\n```sh\r\nuse Rack::Static,\r\n  :urls => [\"/images\", \"/js\", \"/css\"],\r\n  :root => \"public\"\r\n\r\nrun lambda { |env|\r\n  [\r\n    200,\r\n    {\r\n      \'Content-Type\'  => \'text/html\',\r\n      \'Cache-Control\' => \'public, max-age=86400\'\r\n    },\r\n    File.open(\'public/index.html\', File::RDONLY)\r\n  ]\r\n}\r\n```\r\n\r\nStep 6\r\n---------\r\n\r\nRun the application from the root directory of the project.\r\n\r\n```sh\r\n$rackup\r\n```\r\n\r\nStep 7\r\n---------\r\n\r\nBrowse to http://localhost:9292.\r\n\r\nStep 8\r\n---------\r\n\r\nChange index.html to :\r\n\r\nHello Static App\r\n\r\nStep 9\r\n---------\r\n\r\nReload the browser to see the changes. Download the code from https://bitbucket.org/bparanj/static-rack.\r\n\r\nSummary\r\n========\r\n---------\r\n\r\nIn this article, we created a simple web app that can display a static page. In the next article, we will see how to use javascript, images and css to create a web app that separates the front-end technologies from the backend technologies. This is very useful when we want to allocate work according to the strengths of the developers.','2015-05-16 22:26:06','2015-05-29 19:36:03'),(2011,'Web Development in Ruby : Using Javascript in a Static Website Rack App','Objective\r\n=========\r\n---------\r\n\r\nTo use javascript from a separate file and call it in static html page.\r\n\r\nSteps\r\n=========\r\n---------\r\n\r\nStep 1\r\n---------\r\n\r\nHtml files must use relative references to images, css and js. You can can copy the penguin.jpg image to images directory of the project. \r\n\r\nStep 2\r\n---------\r\n\r\nChange index.html to display the image:\r\n\r\n```html\r\n<img src=\"images/penguin.jpg\" alt=\"Penguin\" >\r\n```\r\n\r\nStep 3\r\n---------\r\n\r\nReload the browser.\r\n\r\nStep 4\r\n---------\r\n\r\nChange the index.html:\r\n\r\n```html\r\n<!DOCTYPE HTML>\r\n<html>\r\n<head>\r\n	<script>\r\n	function myFunction()\r\n	{\r\n	alert(\'Cute penguin!\')\r\n	}\r\n	</script>\r\n<title>JavaScript</title>\r\n</head>\r\n<body>\r\n<h1>JavaScript Cute Penguin Example</h1>\r\n<p><button onclick=\"myFunction()\">Click Me!</button></p>\r\n\r\n<img id=\'penguin\' src=\"images/penguin.jpg\" alt=\"Penguin\" >\r\n\r\n</body>\r\n</html>\r\n```\r\n\r\nStep 5\r\n---------\r\n\r\nReload the page and click on the button.\r\n\r\nStep 6\r\n---------\r\n\r\nCreate pen.js in js directory:\r\n\r\n```sh\r\nfunction myFunction()\r\n{\r\n  alert(\'Very cute penguin!\')\r\n}\r\n```\r\n\r\nStep 7\r\n---------\r\n\r\nChange index.html:\r\n\r\n```html\r\n<!DOCTYPE HTML>\r\n<html>\r\n<head>\r\n\r\n<title>JavaScript</title>\r\n</head>\r\n    <script type=\"text/javascript\" src=\"js/pen.js\"></script>\r\n\r\n<body>\r\n<h1>JavaScript Cute Penguin Example</h1>\r\n<p><button onclick=\"myFunction()\">Click Me!</button></p>\r\n\r\n<img id=\'penguin\' src=\"images/penguin.jpg\" alt=\"Penguin\" >\r\n\r\n</body>\r\n</html>\r\n```\r\n\r\nStep 8\r\n---------\r\n\r\nReload the page and click on the button.\r\n\r\nSummary\r\n========\r\n---------\r\n\r\nIn this article, we created a javascript file and invoked it from a static html page. In the next article we will use a css file and use it in our static html file.','2015-05-17 01:48:42','2015-05-17 01:51:15'),(2021,'Web Development in Ruby : Using CSS in a Static Rack WebApp','Objective\r\n=========\r\n---------\r\n\r\nTo learn how to use CSS file in html file and how to navigate between pages in a static web app.\r\n\r\nStep 1\r\n---------\r\n\r\nCreate main.css in CSS folder with:\r\n\r\n```sh\r\nbody {\r\n    background-color: green;\r\n}\r\n```\r\n\r\nStep 2\r\n---------\r\n\r\nAdd the link to css file in index.html:\r\n\r\n```html\r\n<link href=\"./css/main.css\" rel=\"stylesheet\"/>\r\n```\r\n	\r\nwithin head tag.	\r\n\r\nStep 3\r\n---------\r\n\r\nReload the page. The background will now be green.\r\n\r\nStep 4\r\n---------\r\n\r\nAdd contact.html with:\r\n\r\nThis is the contact page.\r\n\r\nStep 5\r\n---------\r\n\r\nEdit index.html\r\n\r\n```html\r\n<a href=\"./contact.html#\"> Contact Me </a>\r\n```\r\n\r\nStep 6\r\n---------\r\n\r\nClick on Contact Me link, it does not work. Edit the config.ru:\r\n\r\n```ruby\r\nuse Rack::Static,\r\n  :urls => Dir.glob(\"public/*\").map { |fn| fn.gsub(/public/, \'\')},\r\n  :root => \'public\',\r\n  :index => \'index.html\',\r\n  :header_rules => [[:all, {\'Cache-Control\' => \'public, max-age=3600\'}]]\r\n  \r\n  headers = {\'Content-Type\' => \'text/html\', \'Content-Length\' => \'9\'}\r\n  run lambda { |env| [404, headers, [\'Not Found\']] }\r\n```\r\n\r\nStep 7\r\n---------\r\n\r\nLet\'s see what the code does by experimenting in the irb:\r\n\r\n```ruby\r\nsite$ irb\r\n> Dir.glob(\"public/*\")\r\n=> [\"public/contact.html\", \"public/css\", \"public/images\", \"public/index.html\", \"public/js\"]\r\n> Dir.glob(\"public/*\").map { |fn| fn.gsub(/public/, \'\')}\r\n=> [\"/contact.html\", \"/css\", \"/images\", \"/index.html\", \"/js\"]\r\nirb(main):003:0> \r\n```\r\n\r\nStep 8\r\n---------\r\n\r\nCreate contact.html:\r\n\r\n```html\r\n<!DOCTYPE HTML>\r\n<html>\r\n<head>\r\n\r\n<title>JavaScript</title>\r\n</head>\r\n    <script type=\"text/javascript\" src=\"js/pen.js\"></script>\r\n    <link href=\"./css/main.css\" rel=\"stylesheet\"/>\r\n\r\n<body>\r\n<h1>Home Page</h1>\r\n<p><button onclick=\"myFunction()\">Click Me!</button></p>\r\n\r\n<a href=\"./contact.html\"> Contact Me </a>\r\n\r\n<!-- <img id=\'penguin\' src=\"images/penguin.jpg\" alt=\"Penguin\" > -->\r\n\r\n</body>\r\n</html>\r\n```\r\n\r\nYou can now navigate between index.html and contact.html\r\n\r\nSummary\r\n========\r\n---------\r\n\r\nIn this article, we used a separate css file and referred it in our static html page. We also fixed the problem where we could not navigate from the home page to other pages by clicking on the links.\r\n \r\nReferences\r\n========\r\n---------\r\n\r\n1. [Static Sites in Ruby](https://devcenter.heroku.com/articles/static-sites-ruby \'Static Sites in Ruby\')\r\n2. [Creating Static Sites in Ruby with Rack](http://kmikael.com/2013/05/28/creating-static-sites-in-ruby-with-rack/ \'Creating Static Sites in Ruby with Rack\')','2015-05-17 02:05:23','2015-05-17 02:05:23'),(2031,'Ruby Object Model : Singleton Methods Demystified','Objective\r\n=========\r\n---------\r\n\r\nTo learn about singleton methods and class methods and how they relate to each other.\r\n\r\nSteps\r\n=========\r\n---------\r\n\r\nStep 1\r\n---------\r\n\r\nLet\'s define a class method drive in Car class. How can we ask Ruby for the class methods defined in Car class. We cannot do Car.class_methods, we will get NoMethodError.\r\n\r\n```ruby\r\nclass Car\r\n  def self.drive\r\n    p \'driving\'\r\n  end\r\nend\r\n\r\np Car.singleton_methods\r\n```\r\n\r\nThis prints : [:drive]. We can call the class method like this:\r\n\r\n```ruby\r\nCar.drive\r\n```\r\n\r\nIn order to view the Class method drive as a singleton method, you have to shift the perspective from from Car class to Car as an instance of Class. We can define the drive class method like this:\r\n\r\n```ruby\r\nCar = Class.new\r\n\r\nclass << Car\r\n  def drive\r\n    p \'driving\'  \r\n  end\r\nend\r\n\r\nCar.drive\r\n```\r\n\r\nWe now see that Car is a instance of class Class so it is a singleton method from that perspective. This accomplishes the same thing as this example:\r\n\r\n```ruby\r\nCar = Class.new\r\n\r\ndef Car.drive\r\n  p \'driving\'  \r\nend\r\n\r\nCar.drive\r\n```\r\n\r\nStep 2\r\n---------\r\n\r\nWe can also define a class method by defining a method inside the singleton class like this:\r\n\r\n```ruby\r\nclass Car\r\n  class << self\r\n    def drive\r\n      p \'driving\'\r\n    end\r\n  end\r\nend\r\n\r\np Car.singleton_methods\r\n```\r\n\r\nThis prints : [:drive]. The effect is the same as step 1, we can still call the drive method like this:\r\n\r\n```ruby\r\nCar.drive\r\n```\r\n\r\nStep 3\r\n---------\r\n\r\nLet\'s define a singleton method called drive for an instance of Car class like this:\r\n\r\n```ruby\r\nclass Car\r\n  \r\nend\r\n\r\nc = Car.new\r\n\r\ndef c.drive\r\n  \'driving\'\r\nend\r\n\r\np c.singleton_methods\r\n```\r\n\r\nThis prints : [:drive]. We can call the singleton method drive like this:\r\n\r\n```ruby\r\np c.drive \r\n```\r\n\r\nThis prints \'driving\'. Since this is a singleton method, the drive method is not available for other instances of Car. So, we cannot do this:\r\n\r\n```ruby\r\nb = Car.new\r\nb.drive\r\n```\r\n\r\nWe get the error : NoMethodError: undefined method ‘drive’ for Car.\r\n\r\nStep 4\r\n---------\r\n\r\nWe can do what we did in previous step like this:\r\n\r\n```ruby\r\nclass Car\r\n  \r\nend\r\n\r\nc = Car.new\r\n\r\nclass << c\r\n  def drive\r\n    \'driving\'\r\n  end\r\nend\r\n\r\np c.drive\r\n```\r\n\r\nThis prints driving. Let\'s look at the singleton methods for Car class.\r\n\r\n```ruby\r\np c.singleton_methods\r\n```\r\n\r\nThis prints [:drive]. So, when we define a singleton method like we did in previous step, we are essentially defining a method in the singleton class as illustrated in this step.\r\n\r\nStep 5\r\n---------\r\n\r\nInstead of defining the singleton method directly inside the class << obj construct, we can also mixin the method from a module like this:\r\n\r\n```ruby\r\nmodule Driveable\r\n  def drive\r\n    \'driving\'\r\n  end\r\nend\r\n\r\nclass Car\r\nend\r\n\r\nc = Car.new\r\n\r\nclass << c\r\n  include Driveable\r\nend\r\n\r\np c.drive\r\n```\r\n\r\nThis prints driving.\r\n\r\n```ruby\r\np c.singleton_methods\r\n```\r\n\r\nThis prints [:drive]. This does the same thing we did in previous step.\r\n\r\nStep 6\r\n---------\r\n\r\nLet\'s now combine all the different ways we have seen so far:\r\n\r\n1. Defining a class method in a Class.\r\n2. Defining a singleton method for a specific car object.\r\n3. Using mixin to define a singleton method.\r\n\r\ninto one grand example:\r\n\r\n```ruby\r\nmodule Stoppable\r\n  def stop\r\n    \'stopping\'    \r\n  end\r\nend\r\n\r\nclass Car\r\n  def self.start\r\n    \'starting\'\r\n  end\r\nend\r\n\r\nc = Car.new\r\n\r\ndef c.fly\r\n  \'flying\'\r\nend\r\n\r\nclass << c\r\n  include Stoppable\r\n\r\n  def drive\r\n    \'driving\'\r\n  end\r\nend\r\n\r\np Car.singleton_methods\r\n```\r\n\r\nThis prints [:start]\r\n\r\n```ruby\r\np c.singleton_methods\r\n```\r\n\r\nThis prints [:fly, :drive, :stop]. We can exclude methods that is included in module by passing false flag to the singleton_methods like this:\r\n\r\n```ruby\r\np c.singleton_methods(false)\r\n```\r\n\r\nThis prints [:fly, :drive]\r\n\r\n```ruby\r\np Car.start\r\np c.drive\r\np c.stop\r\np c.fly\r\n```\r\n\r\nprints:\r\n\r\n\"starting\"\r\n\"driving\"\r\n\"stopping\"\r\n\"flying\"\r\n\r\nThe first call is a class method call and the other three are singleton method calls.\r\n\r\nStep 7\r\n---------\r\n\r\nWe can also ask Ruby for the singleton_class of a Class like this:\r\n\r\n```ruby\r\nclass Car\r\nend\r\n\r\np Car.singleton_class\r\n```\r\n\r\nThis prints : #<Class:Car>\r\n\r\nStep 8\r\n---------\r\n\r\nLet\'s look at a simple example for displaying the name of the singleton\\_class:\r\n\r\n```ruby\r\nclass Car\r\n  class << self\r\n    def class_name\r\n      to_s\r\n    end\r\n  end\r\nend\r\n\r\np Car.class_name\r\n```\r\n\r\nThis prints : \'Car\'. We also use define\\_method to dynamically define the class\\_name like this:\r\n\r\n```ruby\r\nclass Car\r\n \r\nend\r\n\r\nCar.define_singleton_method(:class_name) do\r\n  to_s\r\nend\r\n\r\np Car.class_name\r\n```\r\n\r\nThis still prints : \'Car\'. Let\'s combine these two above into one example:\r\n\r\n```ruby\r\nclass Car\r\n  class << self\r\n    def class_name\r\n      to_s\r\n    end\r\n  end\r\nend\r\n\r\nCar.define_singleton_method(:whoami) do\r\n  \"I am : #{class_name}\"\r\nend\r\n\r\np Car.whoami\r\n```\r\n\r\nThis prints : \"I am : Car\"\r\n\r\nStep 9\r\n---------\r\n\r\nAs a last example, let\'s define a singleton\\_method on a string class.\r\n\r\n```ruby\r\ncar = \'Beetle\'\r\ncar.define_singleton_method(:drive) { \"You are driving : #{self}\"}\r\np car.drive\r\n```\r\n\r\nThis prints : \"You are driving : Beetle\". Let\'s check the singleton methods for this specific string object.\r\n\r\n```ruby\r\np car.singleton_methods\r\n```\r\n\r\nThis prints [:drive].\r\n\r\nSummary\r\n========\r\n---------\r\n\r\nIn this article, we saw different ways to define class methods and singleton methods and where they live. ','2015-05-18 03:55:13','2016-12-22 21:23:19'),(2041,'Web Development in Ruby : Using WEBrick Servlet to Generate Dynamic HTML Pages','Objective\r\n=========\r\n---------\r\n\r\nSimple server side dynamic html generation using WEBrick.\r\n\r\nSteps\r\n=========\r\n---------\r\n\r\nStep 1\r\n---------\r\n\r\nCreate webrick.rb with:\r\n\r\n```ruby\r\n#!/usr/bin/env ruby\r\n\r\nrequire \'webrick\'\r\ninclude WEBrick\r\n\r\ns = HTTPServer.new(\r\n    :Port => 3000,\r\n    :DocumentRoot => File.join(Dir.pwd, \"/html\")\r\n)\r\ntrap(\"INT\") { s.shutdown }\r\n\r\ns.mount_proc \'/today\' do |req, res|\r\n  res.body = \"Today is : #{Time.now}\"\r\nend\r\n\r\ns.start\r\n```\r\n\r\nStep 2\r\n---------\r\n\r\nMake webrick.rb executable:\r\n\r\n```ruby\r\nchmod a+x webrick.rb\r\n```\r\n\r\nStep 3\r\n---------\r\n\r\nBrowse to : http://localhost:3000/today You will see:\r\n\r\nToday is : 2015-05-17 22:50:46 -0700\r\n\r\nStep 4\r\n---------\r\n\r\nCreate today_servlet.rb with:\r\n\r\n```ruby\r\nclass TodayServlet < WEBrick::HTTPServlet::AbstractServlet\r\n  def do_GET(request, response)\r\n    response.status = 200\r\n    response[\'Content-Type\'] = \'text/plain\'\r\n    response.body = \"Today is #{Time.now}\"\r\n  end\r\nend\r\n```\r\n\r\nStep 5\r\n---------\r\n\r\nChange the webrick.rb to add:\r\n\r\n```ruby\r\nserver.mount \'/today\', TodayServlet\r\n```\r\n\r\n```ruby\r\n#!/usr/bin/env ruby\r\n\r\nrequire \'webrick\'\r\nrequire_relative \'today_servlet\'\r\n\r\ninclude WEBrick\r\n\r\ns = HTTPServer.new(\r\n    :Port => 3000,\r\n    :DocumentRoot => File.join(Dir.pwd, \"/html\")\r\n)\r\ntrap(\"INT\") { s.shutdown }\r\n\r\ns.mount \'/today\', TodayServlet\r\ns.start\r\n```\r\n\r\nStep 6\r\n---------\r\n\r\nBrowse to http://localhost:3000/today to see today\'s date in the browser.\r\n\r\nStep 7\r\n---------\r\n\r\nLet\'s use html header to generate the output, change the following lines in today_servlet.rb:\r\n\r\n```ruby\r\nresponse[\'Content-Type\'] = \'text/html\'\r\nresponse.body = \"<h1>Today is #{Time.now}<h1>\"\r\n```\r\n\r\nRestart the server and reload the browser. Now the page will have html header that displays the date.\r\n\r\nSummary\r\n========\r\n---------\r\n\r\nIn this article, we developed a simple date display program by using WEBrick and dynamic html generation that combines ruby and html.','2015-05-23 05:12:45','2015-05-23 05:16:07'),(2051,'Sinatra Beyond Basics : Processing a JSON Payload','Objective\r\n=========\r\n---------\r\n\r\nTo learn how to post a JSON payload and process it in the backend.\r\n\r\nSteps\r\n=========\r\n---------\r\n\r\nStep 1\r\n---------\r\n\r\nThis article will continue from where we left in the previous article [Sinatra Beyond Basics : Post a JSON Payload](https://rubyplus.com/articles/1901-Sinatra-Beyond-Basics-Post-a-JSON-Payload \'Sinatra Beyond Basics : Post a JSON Payload\'). Let\'s organize. Create an app folder in the root of the project and move the controller directory into it. Rename the todo\\_spec.rb to `todo_controller_spec.rb` and move it to spec/app/controller folder.\r\n\r\nStep 2\r\n---------\r\n\r\nChange the test to post a JSON payload like this:\r\n\r\n```ruby\r\nrequire \'spec_helper\'\r\nrequire_relative \'../../../app/controller/todo_controller\'\r\nrequire \'json\'\r\n\r\nRSpec.describe TodoController do\r\n  \r\n  def app\r\n    TodoController\r\n  end\r\n  \r\n  it \'should take a json payload\' do\r\n    body = { priority: 1, task: \'Get rich quick\' }.to_json\r\n    post \"/\", body, {\'Content-Type\' => \'application/json\'}\r\n    \r\n    expect(last_response).to be_ok\r\n  end\r\nend\r\n```\r\n\r\nRun the test:\r\n\r\n```sh\r\n$rspec spec/app/controller/todo_controller_spec.rb \r\n```\r\n\r\nStep 3\r\n---------\r\n\r\nThe test does not force the code to do much. Let\'s change the test to add another expectation:\r\n\r\n```ruby\r\nexpect(last_response.body).to eq(\'{\"success\":\"true\"}\')\r\n```\r\n\r\nNow the test fails.\r\n\r\nStep 4\r\n---------\r\n\r\nChange the todo\\_controller.rb:\r\n\r\n```ruby\r\nrequire \'sinatra\'\r\nrequire \'json\'\r\n\r\nclass TodoController < Sinatra::Base\r\n  post \'/\' do   \r\n  \r\n    {success: \'true\'}.to_json\r\n  end\r\nend\r\n```\r\n\r\nTip : You can use http://jsonlint.com to check if the JSON syntax is valid.\r\n\r\nStep 5\r\n---------\r\n\r\nTo read the posted JSON, you can do:\r\n\r\n```ruby\r\nrequire \'sinatra\'\r\nrequire \'json\'\r\n\r\nclass TodoController < Sinatra::Base\r\n  post \'/\' do   \r\n    input = request.body.read\r\n    puts input\r\n    {success: \'true\'}.to_json\r\n  end\r\nend\r\n```\r\n\r\nIf you copy the string printed as the value for input and use JSONLint, you will that it is a valid JSON.\r\n\r\n```json\r\n{\r\n    \"priority\": 1,\r\n    \"task\": \"Get rich quick\"\r\n}\r\n```\r\n\r\nStep 6\r\n---------\r\n\r\nYou can parse the posted JSON and convert it to a hash like this:\r\n\r\n```ruby\r\n payload = JSON.parse(body, :symbolize_names => true)\r\n```\r\n\r\nYou can then process the data and persist it any type of data store in the backend.\r\n\r\nSummary\r\n========\r\n---------\r\n\r\nIn this article, we saw how to read the posted JSON from the client and convert it into a convenient hash for processing in the backend.','2015-05-23 06:00:11','2016-12-22 21:25:37'),(2061,'Web Development in Ruby : Hello World Rack App','Objective\r\n=========\r\n---------\r\n\r\nTo learn the basic Rack concepts.\r\n\r\nWhat is Rack?\r\n=========\r\n---------\r\n\r\nRack is a specification (and implementation) of a minimal abstract Ruby API that models HTTP. Rack provides a minimal, modular and adaptable interface for developing web applications in Ruby. By wrapping HTTP requests and response in the simplest way possible, it unifies and distills the API for Web servers, Web frameworks, and software in between (the so-called middle- ware) into a single method call.\r\n\r\nIt provides the simplest possible API that represents a generic web application. Rack consists of interface, implementations and utilities. Rack distributions has the following 6 components:\r\n\r\n> 1) Specification \r\n2) Handlers\r\n3) Adapters\r\n4) Middlewares \r\n5) Utilities\r\n\r\nWe will discuss them in detail in upcoming articles.\r\n\r\nWhy Rack?\r\n=========\r\n---------\r\n\r\nThere is a proliferation of different web application servers and web frameworks. There is a lot of code duplication among frameworks since they essentially all do the same things. And still, every Ruby web framework developer is writing his own handlers for every Web application server to be supported. Developing a Ruby web framework is not hard but it\'s lots of repetitive boring work. That means writing interfaces to all servers and writing decoding code or copying cgi.rb. So let\'s write the HTTP interfacing code once and only once.\r\n\r\nHowever dealing with HTTP is easy. You get a request and return a response. The canonical format of a HTTP request is represented by a hash of CGI-like environment and a response consists of three parts: a status, a set of headers, and a body.\r\n\r\nThis can be easily mapped onto a method call in Ruby like this:\r\n\r\n```ruby\r\nclass HelloWorld \r\n  def call(env)\r\n    [200, {\"Content-Type\" => \"text/plain\"}, [\"Hello world!\"]] \r\n  end\r\nend\r\n```\r\n\r\nThis is the most simple Rack application. The Rack app gets call\'ed with the CGI environment and retuns and Array of status, headers and body. Rack aims to provide a minimal API for connecting web servers and web frameworks. Now the developers can stop writing handlers for every webserver. Keep the request and response simple. Rack standard is very simple, the specification is only about two pages. If you want to implement a Rack compliant web server or a web framework, just meet this simple standard.1 You can build small, simple tools that does one thing really well (like Unix).\r\n\r\nSuper simple API for writing web apps. Single API to connect to all web application servers .Based on Python\'s WSGI. Write once and serve it on any Rack compliant web app server. Convenient way to write micro apps.\r\n\r\nGood like Camping - very minimal, single file applications. But better because Camping isn’t multi-threaded, requests are wrapped in a mutex. Rack is small, lightweight and super easy to write and deploy. It is good for multi-threaded, non-blocking requests, so you can use Rack to write non-blocking file uploader applications to compliment Rails applications.\r\n\r\nInstant Gratification \r\n=========\r\n---------\r\n\r\nInstalling Rack\r\n---------\r\n\r\nFirst install the Rack gem: \r\n\r\n```sh\r\ngem install rack\r\n```\r\n\r\nRack Handler\r\n---------\r\n\r\nYou will now see how to use rack package, start irb: \r\n\r\n```sh\r\n$ irb\r\n```\r\n\r\n```sh\r\nirb> require \'rack\'\r\n=> true\r\n```\r\n\r\nWe can now check all the embedded Rack Handlers in Rack gem.\r\n\r\n```sh\r\nirb> Rack::Handler.constants\r\n=> [:CGI, :FastCGI, :Mongrel, :EventedMongrel, :SwiftipliedMongrel, :WEBrick, :LSWS, :SCGI, :Thin] \r\n```\r\n\r\nAll Rack Handlers have a run method, so you can call run on any of these built-in handlers:\r\n\r\n```sh\r\nRack::Handler::Mongrel.run app, :Port => 80\r\nRack::Handler::WEBrick.run ...\r\nRack::Handler::Thin.run ...\r\n```\r\n\r\nand so on. The first argument to the run method is Rack app and the second argument is options to run your program.\r\n\r\nHello Rack\r\n---------\r\n\r\nRack specification defines a Rack application as: **\"A Rack application is a Ruby object (not a class) that responds to call method. It takes exactly one argument, the environment and returns an Array of exactly three values: the status, the headers, and the body.\"**\r\n\r\nLet\'s consider the first sentence: **A Rack application is a Ruby object (not a class) that responds to call method.** This implies that the object can be any of the following:\r\n\r\n> • A lambda or Proc object\r\n• A method object\r\n• Any object that has a call method\r\n\r\nLets do the bare minimum to meet this requirement: use an empty lambda. Because it can accept call.\r\n\r\n```ruby\r\n > Rack::Handler::WEBrick.run lambda{}, :Port => 3222\r\n[2015-05-23 01:16:51] INFO  WEBrick 1.3.1\r\n[2015-05-23 01:16:51] INFO  ruby 2.2.2 (2015-04-13) [x86_64-darwin11.0]\r\n[2015-05-23 01:16:51] INFO  WEBrick::HTTPServer#start: pid=22266 port=3222\r\n```\r\n\r\nThe second parameter is the options in this case we are specifying the port number. The log shows that the server has started and is listening on port 3222. Browse to http://localhost:3222\r\n\r\nWe get the error : wrong number of arguments (1 for 0). Let\'s consider the second sentence of the Rack application definition: **It takes exactly one argument, the environment and returns an Array of exactly three values: the status, the headers, and the body.**\r\n\r\nSo our lambda needs to accept one parameter, namely the environment and it needs to return an Array that contains the following:\r\n\r\n> • Status - HTTP protocol defines the status code\r\n• Headers - Hash that contains the HTTP headers\r\n• Body - An array that returns string for every call of each method\r\n\r\nTo satisfy this requirements in the spec, let\'s rewrite the Rack app as follows:\r\n\r\n```ruby\r\n rack_app = lambda {|env| [200, {}, [\"My Rack App\"]] }\r\n => #<Proc:0x007fc281823908@(irb):5 (lambda)> \r\n2.2.2 :006 > Rack::Handler::WEBrick.run rack_app, :Port => 3222\r\n[2015-05-23 01:19:59] INFO  WEBrick 1.3.1\r\n[2015-05-23 01:19:59] INFO  ruby 2.2.2 (2015-04-13) [x86_64-darwin11.0]\r\n[2015-05-23 01:19:59] INFO  WEBrick::HTTPServer#start: pid=22266 port=3222\r\nlocalhost - - [23/May/2015:01:20:06 PDT] \"GET / HTTP/1.1\" 200 11\r\n```\r\n\r\nBrowse to http://localhost:3222, you will now see the text: \'My Rack App\' in the browser. Note that we passed empty hash for the headers parameter.\r\n\r\nIf you have Thin server installed you can run it on Thin.\r\n\r\n```ruby\r\n> require \'thin\'\r\n => true \r\n> require \'rack\'\r\n => false \r\n> Rack::Handler::Thin.run lambda{|env| [200, {}, [\'Hi from Thin\']]}, Port: 3222\r\nThin web server (v1.6.3 codename Protein Powder)\r\nMaximum connections set to 1024\r\nListening on localhost:3222, CTRL+C to stop\r\n```\r\n\r\nBrowse to http://localhost:3222. You will the text: \'Hi from Thin\'. In this demo we wrote our first Rack app to meet the requirements specified in the Rack application definition.\r\n\r\nCreate rack_meth.rb:\r\n\r\n```ruby\r\ndef my_method(env)\r\n  [200, {}, [\'Hi from my method\']]\r\nend\r\n\r\nmy_meth = method(:my_method)\r\n\r\np my_meth.call({})\r\n```\r\n\r\n```ruby\r\n$ruby rack_meth.rb\r\n```\r\n\r\nThis prints : [200, {}, [\"Hi from my method\"]]. Let\'s run this method using thin server. Change the rack_meth.rb as follows:\r\n\r\n```ruby\r\nrequire \'rack\'\r\nrequire \'thin\'\r\n\r\ndef my_method(env)\r\n  [200, {}, [\'Hi from my method\']]\r\nend\r\n\r\nmy_method = method(:my_method)\r\nRack::Handler::Thin.run my_method, Port: 3222\r\n```\r\n\r\n```sh\r\n$ruby rack_meth.rb \r\nThin web server (v1.6.3 codename Protein Powder)\r\nMaximum connections set to 1024\r\nListening on localhost:3222, CTRL+C to stop\r\n```\r\n\r\nThis prints the text: \'Hi from my method\' in the browser. The third case that we saw earlier was that any object that can respond to call can be used as a valid Rack app.\r\n\r\nCreate any_class.rb:\r\n\r\n```ruby\r\nrequire \'rack\'\r\nrequire \'thin\'\r\n\r\nclass AnyClass\r\n  def call(env)\r\n    [200, {}, [\"Hi from instance of AnyClass with call defined\"]]\r\n  end\r\nend\r\n\r\nrack_app = AnyClass.new\r\n\r\nRack::Handler::Thin.run rack_app, Port: 3222\r\n```\r\n\r\nRun this program:\r\n\r\n```sh\r\n$ruby any_class.rb\r\nThin web server (v1.6.3 codename Protein Powder)\r\nMaximum connections set to 1024\r\nListening on localhost:3222, CTRL+C to stop\r\n```\r\n\r\nThis prints: \'Hi from instance of AnyClass with call defined\' in the browser.\r\n\r\nSummary\r\n========\r\n---------\r\n\r\nIn this article, you learned the basic Rack concepts and saw how to write a simple Hello World Rack application.','2015-05-23 14:28:25','2015-05-23 14:42:41'),(2071,'Web Development in Ruby : HTTP Basic Authentication in Rack App','Objective\r\n=========\r\n---------\r\n\r\nTo learn how to use http basic authentication in your Rack app.\r\n\r\nSteps\r\n=========\r\n---------\r\n\r\nStep 1\r\n---------\r\n\r\nLet\'s now run the example that comes with Rack distribution. Create lobster.rb:\r\n\r\n```ruby\r\nrequire \'rack\'\r\nrequire \'thin\'\r\nrequire \'rack/lobster\'\r\n\r\nRack::Handler::Thin.run Rack::Lobster.new, Port: 3222\r\n```\r\n\r\nStep 2\r\n---------\r\n\r\n```sh\r\n$ruby lobster.rb\r\n```\r\n\r\nStep 3\r\n---------\r\n\r\nBrowse to http://localhost:3222 to view the lobster.\r\n\r\nStep 4\r\n---------\r\n\r\nChange the lobster.rb as follows:\r\n\r\n```ruby\r\nrequire \'rack\'\r\nrequire \'thin\'\r\nrequire \'rack/lobster\'\r\n\r\nlobster = Rack::Lobster.new\r\n\r\nprotected_lobster = Rack::Auth::Basic.new(lobster) do |username, password|\r\n  \'secret\' == password\r\nend\r\n\r\nprotected_lobster.realm = \'Lobster 2.0\'\r\n\r\npretty_protected_lobster = Rack::ShowStatus.new(Rack::ShowExceptions.new(protected_lobster))\r\n\r\nRack::Handler::Thin.run pretty_protected_lobster, Port: 3222\r\n```\r\n\r\nStep 5\r\n---------\r\n\r\nRun it:\r\n\r\n```sh\r\nruby lobster.rb\r\n```\r\n\r\nStep 6\r\n---------\r\n\r\nBrowse to http://localhost:3222. You are now prompted with http basic authentication popup.  \r\n\r\nStep 7\r\n---------\r\n\r\nEnter anything for the username, secret for the password. You can now see the protected lobster.\r\n\r\nSummary\r\n========\r\n---------\r\n\r\nIn this article, you learned how to use basic authentication in a Rack app.','2015-05-23 14:49:35','2015-05-23 14:49:35'),(2081,'Web Development in Ruby : Using a Rackup File to Run Rack App','Objective\r\n=========\r\n---------\r\n\r\nTo learn how to use rackup command to run Rack app.\r\n\r\nDiscussion\r\n=========\r\n---------\r\n\r\nRack is also an implementation. The Rack gem provides helper classes for : Request / Response wrappers, logging, authentication (basic and digest), cookies, sessions, mock requests and responses.\r\n\r\nRack gem gives you rackup command which lets you start your app on any supported application server. The rackup command is a useful tool for running Rack applications, which uses the Rack::Builder DSL to configure middleware and build up applications easily. It automatically figures out the environment it is running in, and runs your application as FastCGI, CGI, or standalone with Mongrel or WEBrick--all from the same configuration.\r\n\r\nSteps\r\n=========\r\n---------\r\n\r\nStep 1\r\n---------\r\n\r\nCreate a basic_rack.ru file with:\r\n\r\n```ruby\r\napp = lambda {|env| [200, {\'Content-Type\': \'text/html\'}, \'Hello World\']}\r\nrun app\r\n```\r\n\r\nThe .ru extension stands for Rack\'s rackup executable. These files are regular Ruby files.\r\n\r\nStep 2\r\n---------\r\n\r\nStart the app using:\r\n\r\n```sh\r\n$rackup basic_rack.ru\r\n```\r\n\r\nBrowse to http://localhost:9292\r\n\r\nStep 3\r\n---------\r\n\r\nYou now see the text : \'Hello World\' in the browser.\r\n\r\nStep 4\r\n---------\r\n\r\nNow let\'s look at an example where we can use variables.\r\n\r\n```ruby\r\nclass HelloWorld\r\n  def initialize(name)\r\n    @name = name\r\n  end\r\n  \r\n  def call(env)\r\n    [200, {\'Content-Type\' => \'text/plain\'}, [\"Hello #{@name}\"]]\r\n  end\r\nend\r\n\r\napp = HelloWorld.new(\"Bugs Bunny\")\r\nrun app\r\n```\r\n\r\nStep 5\r\n---------\r\n\r\nThis will print \'Hello Bugs Bunny\' in the browser.\r\n\r\nDiscussion\r\n=========\r\n---------\r\n\r\nThe method **call** takes an environment Hash representing a request. It returns a three part array with each of the parts of a HTTP response. Here is the code for Rack Handler for Thin Server.\r\n\r\n```ruby\r\nrequire \"thin\"\r\nrequire \"rack/content_length\"\r\nrequire \"rack/chunked\"\r\n\r\nmodule Rack\r\n  module Handler\r\n    class Thin\r\n      def self.run(app, options={})\r\n        environment  = ENV[\'RACK_ENV\'] || \'development\'\r\n        default_host = environment == \'development\' ? \'localhost\' : \'0.0.0.0\'\r\n\r\n        host = options.delete(:Host) || default_host\r\n        port = options.delete(:Port) || 8080\r\n        args = [host, port, app, options]\r\n        # Thin versions below 0.8.0 do not support additional options\r\n        args.pop if ::Thin::VERSION::MAJOR < 1 && ::Thin::VERSION::MINOR < 8\r\n        server = ::Thin::Server.new(*args)\r\n        yield server if block_given?\r\n        server.start\r\n      end\r\n\r\n      def self.valid_options\r\n        environment  = ENV[\'RACK_ENV\'] || \'development\'\r\n        default_host = environment == \'development\' ? \'localhost\' : \'0.0.0.0\'\r\n\r\n        {\r\n          \"Host=HOST\" => \"Hostname to listen on (default: #{default_host})\",\r\n          \"Port=PORT\" => \"Port to listen on (default: 8080)\",\r\n        }\r\n      end\r\n    end\r\n  end\r\nend\r\n```\r\n\r\nYou can see how it abstracts running a specific server behind a well defined interface.\r\nExercises\r\n=========\r\n---------\r\n\r\n1. Use rackup file to run the lobster example.\r\n2. Use rackup file to run the protected lobster example that uses HTTP Basic authentication.\r\n\r\nSummary\r\n========\r\n---------\r\n\r\nIn this article, you learned how to use rackup file to run Rack apps.','2015-05-23 15:12:32','2015-05-23 15:26:46'),(2091,'Web Development in Ruby : Environment Variables in Rack App','Objective\r\n=========\r\n---------\r\n\r\nTo learn about environment variables.\r\n\r\nSteps\r\n=========\r\n---------\r\n\r\nStep 1\r\n---------\r\n\r\nLet\'s write a simple program to inspect the environment variables that is passed to the call method. Create a file env.rb with:\r\n\r\n```ruby\r\nrequire \'rack\'\r\nrequire \'thin\'\r\n\r\nRack::Handler::Thin.run lambda {|env| [200, {}, [env.inspect]]}, Port: 3222\r\n```\r\n\r\nStep 2\r\n---------\r\n\r\nRun it:\r\n\r\n```ruby\r\n$ruby env.rb\r\n```\r\n\r\nStep 3\r\n---------\r\n\r\n```sh\r\n$curl http://localhost:3222\r\n```\r\n\r\n```ruby\r\n{\r\n\"SERVER_SOFTWARE\"=>\"thin 1.6.3 codename Protein Powder\", \r\n\"SERVER_NAME\"=>\"localhost\", \r\n\"rack.input\"=>#<StringIO:0x007fcbd3110020>, \r\n\"rack.version\"=>[1, 0], \r\n\"rack.errors\"=>#<IO:<STDERR>>, \r\n\"rack.multithread\"=>false, \r\n\"rack.multiprocess\"=>false, \r\n\"rack.run_once\"=>false, \r\n\"REQUEST_METHOD\"=>\"GET\", \r\n\"REQUEST_PATH\"=>\"/\", \r\n\"PATH_INFO\"=>\"/\", \r\n\"REQUEST_URI\"=>\"/\", \r\n\"HTTP_VERSION\"=>\"HTTP/1.1\", \r\n\"HTTP_USER_AGENT\"=>\"curl/7.21.4 (universal-apple-darwin11.0) libcurl/7.21.4 OpenSSL/0.9.8x zlib/1.2.5\", \"HTTP_HOST\"=>\"localhost:3050\", \"HTTP_ACCEPT\"=>\"*/*\", \"GATEWAY_INTERFACE\"=>\"CGI/1.2\", \"SERVER_PORT\"=>\"3050\", \r\n\"QUERY_STRING\"=>\"\", \r\n\"SERVER_PROTOCOL\"=>\"HTTP/1.1\", \"rack.url_scheme\"=>\"http\", \r\n\"SCRIPT_NAME\"=>\"\", \r\n\"REMOTE_ADDR\"=>\"127.0.0.1\", \r\n\"async.callback\"=>#<Method: Thin::Connection#post_process>, \"async.close\"=>#<EventMachine::DefaultDeferrable:0x007fcbd310bae8>}\r\n```\r\n\r\nYou can see the the key value pairs in the environment hash. There are three categories, CGI-ish type variables, Rack specific variables (rack.xxx) and application specific variables (in this case Thin server related async.callback and async.close). The first two categories are specified in the Rack spec, whereas the application specific variables are used by the developers. For instance so you can add your own variables to the environment hash that is applicable to only your Rack application.\r\n\r\nCGI-like Headers\r\n---------\r\n\r\nThe environment is required to include the following variables. From the Rack spec: \r\n\r\nREQUEST_METHOD:\r\n\r\nThe HTTP request method, such as \"GET\" or \"POST\". This cannot ever be an empty string, and so is always required.\r\n\r\nSCRIPT_NAME:\r\n\r\nThe initial portion of the request URL‘s \"path\" that corresponds to the application object, so that the application knows its virtual \"location\". This may be an empty string, if the application corresponds to the \"root\" of the server.\r\n\r\nPATH_INFO:\r\n\r\nThe remainder of the request URL‘s \"path\", designating the virtual \"location\" of the request‘s target within the application. This may be an empty string, if the request URL targets the application root and does not have a trailing slash. This value may be percent-encoded when I originating from a URL.\r\n\r\nQUERY_STRING:\r\n\r\nThe portion of the request URL that follows the ?, if any. May be empty, but is always required! \r\n\r\nSERVER\\_NAME, SERVER\\_PORT:\r\n\r\nWhen combined with SCRIPT\\_NAME and PATH\\_INFO, these variables can be used to complete the URL. Note, however, that HTTP\\_HOST, if present, should be used in preference to SERVER\\_NAME for reconstructing the request URL. SERVER\\_NAME and SERVER\\_PORT can never be empty strings, and so are always required.\r\n\r\nHTTP_ Variables:\r\n\r\nVariables corresponding to the client-supplied HTTP request headers (i.e., variables whose names begin with HTTP\\_). The presence or absence of these variables should correspond with the presence or absence of the appropriate HTTP header in the request.\r\n\r\nWe can write a program to demonstrate these variables.\r\n\r\nStep 4\r\n---------\r\n\r\n```ruby\r\nrequire \'rack\'\r\nrequire \'thin\'\r\n\r\ncgi_inspector = lambda do |env|\r\n  [200, {}, [\"Your request: http method is #{env[\'REQUEST_METHOD\']} \\n path is #{env[\'PATH_INFO\']} \\nparams is #{env[\'QUERY_STRING\']}\"]]\r\nend\r\n\r\nRack::Handler::Thin.run cgi_inspector, Port: 3050\r\n```\r\n\r\nRun this app. You will see:\r\n\r\nYour request: \r\nhttp method is GET \r\n path is / \r\nparams is \r\n\r\nin the browser. The default request shows that the browser made the get request to the server. \r\n\r\nStep 5\r\n---------\r\n\r\nNext let\'s add on the path to the default request like this: \r\n\r\nhttp://localhost:3050/rock \r\n\r\nNow the path info has the value of rock. \r\n\r\nStep 6\r\n---------\r\n\r\nLet\'s add parameters to the request:\r\n\r\nhttp://localhost:3050/rock?lucky=true\r\n\r\nThis displays the parameter that we passed in on the URL. The environment variables gives you access to user requests, path names, query parameters etc. You can use them to write programs, however this low-level access makes the programming tedious even for common tasks such as parsing the query parameters, maintaining user session information, filling the appropriate HTTP response headers and so on. Rack provides a higher level convenience API to help you quickly and easily deal with application logic, in upcoming articles we will look at two important classes, Request and Response.\r\n\r\nSummary\r\n========\r\n---------\r\n\r\nIn this article, you learned that the environment variables contain CGI-like variables, Rack specific variables and application specific variables. You also saw how to access the values of some of those variables.','2015-05-27 01:41:10','2016-12-22 21:29:13'),(2101,'Web Development in Ruby : Request Object in Rack App','Objective\r\n=========\r\n---------\r\n\r\nTo learn about the Request object.\r\n\r\nDiscussion\r\n=========\r\n---------\r\n\r\nThe request object encapsulates all information from the client request. In the HTTP protocol, this information is transmitted from the client to the server in the HTTP headers and the message body of the request.\r\n\r\nRack::Request provides a convenient interface to a Rack environment. It is stateless, the environment env passed to the constructor will be directly modified. It is your friend if you want to write Rack applications directly.\r\n\r\n```ruby\r\nrequest = Rack::Request.new(env)\r\nrequest.post?\r\nrequest.params[\'data\']\r\n```\r\nThe environment hash passed will store a reference to the Request object instantiated so that it will only instantiate if an instance of the Request object doesn\'t already exist.\r\n\r\nIn this example you can see how you can easily access the value of request parameter data and also check if the request is a post. Instead of accessing the env variable you use API provided by the request object. Request parameters are strings sent by the client to the server as part of its re- quest. The parameters are stored as a set of name-value pairs.\r\n\r\nSteps\r\n=========\r\n---------\r\n\r\nStep 1\r\n---------\r\n\r\nLet us write a simple program to guess our favorite browser by using the Request object. Create guess.rb:\r\n\r\n```ruby\r\nrequire \'rack\'\r\nrequire \'thin\'\r\n\r\nrack_app = lambda do |env|\r\n  request = Rack::Request.new(env)\r\n  if request.path_info == \'/guess\'\r\n    client = request[\'client\']\r\n    if client && client.downcase == \'safari\'\r\n      [200, {}, [\'Good Browser\']]\r\n    else\r\n      [200, {}, [\'Choose Another Browser\']]\r\n    end\r\n  else\r\n    [200, {}, [\'You have to guess something\']]\r\n  end\r\nend\r\n\r\nRack::Handler::Thin.run rack_app, Port: 3222\r\n```\r\n\r\nStep 2\r\n---------\r\n\r\nRun it. If you browse to `http://localhost:3222`. You will see : \'You have to guess something\'. If you go to `http://localhost:3222/guess`. You will see \'Choose Another Browser\'. If you hit : `http://localhost:3222/guess?client=safari`, you will see \'Good Browser\'.\r\n\r\nStep 3\r\n---------\r\n\r\nWe can query the current request object to find out the request type. The request could be GET, POST, PUT, DELETE, HEAD, OPTIONS, TRACE. You can use get?, post?, put?, delete?, head?, options?, trace?, xhr?\r\n\r\n```ruby\r\nrequire \'rack\'\r\nrequire \'thin\'\r\n\r\nrack_app = lambda do |env|\r\n  request = Rack::Request.new(env)\r\n\r\n  if request.get?\r\n    [200, {}, [\'You did a GET\']]\r\n  else\r\n    [200, {}, [\'You did not GET\']]\r\n  end  \r\nend\r\n\r\nRack::Handler::Thin.run rack_app, Port: 3222\r\n```\r\n\r\nSummary\r\n========\r\n---------\r\n\r\nIn this article, you learned how to work with the incoming request from a HTTP client by using the Request object. ','2015-05-27 01:42:48','2016-12-22 21:30:55'),(2111,'Web Development in Ruby : Rack App HTTP Response','Objective\r\n=========\r\n---------\r\n\r\nTo learn about the Response object in a Rack app.\r\n\r\nDiscussion\r\n=========\r\n---------\r\n\r\nIn the previous example we returned a hard-coded strings as the response. But in a complex Rack application, we may need to do more to control the response. For example, the need to set various HTTP response headers, handling cookies and so on. Response is your friend if you want to write Rack applications directly.\r\n\r\nThe response object encapsulates all information to be returned from the server to the client. In the HTTP protocol, this information is transmitted from the server to the client either by HTTP headers or the message body of the request.\r\n\r\nRack::Response provides a convenient interface to create a Rack response. It allows setting of headers and cookies, and provides useful defaults (a OK response containing HTML).\r\n\r\nResponse provides two methods to generate the response body:\r\n\r\n• Directly set by calling response.body - In this case you have to set the response header content length\r\n• Use response.write to write the contents of an incremental, automatic filling Content_Length header value.\r\n\r\nYou can use Response#write to iteratively generate your response, but note that this is buffered by Rack::Response until you call finish. The finish() however can take a block inside with calls to write that are synchronous with the Rack response.\r\n\r\nRegardless of the method, your application\'s call should end returning Response#finish. Note that you should not mix these two methods. Browser needs Content-Length header to decide how much data to read from the server and this is a must.\r\n\r\nSteps\r\n=========\r\n---------\r\n\r\nStep 1\r\n---------\r\n\r\nLet\'s first look at how to directly set response.body:\r\n\r\n```ruby\r\nrequire \'rack\'\r\nrequire \'thin\'\r\n\r\nrack_app = lambda do |env|\r\n  request = Rack::Request.new(env)\r\n  response = Rack::Response.new\r\n\r\n  body = \'--------------Header-------------<br/>\'\r\n  \r\n  if request.path_info == \'/hello\'\r\n    body << \'Saying hi\'\r\n    client = request[\'client\']\r\n    body << \"from #{client}\" if client\r\n  else\r\n    body << \"You need to provide the client information\"\r\n  end\r\n  body << \"<br/>--------Footer-----------------\"\r\n\r\n  response.body = [body]\r\n  response.headers[\'Content-Length\'] = body.bytesize.to_s\r\n  response.to_a\r\nend\r\n\r\nRack::Handler::Thin.run rack_app, Port: 3025\r\n```\r\n\r\nStep 2\r\n---------\r\n\r\nNow, when we run the program and make a request without /hello in the URL, we get:\r\n\r\nYou need to provide the client information\r\n\r\nStep 3\r\n---------\r\n\r\nBrowse to http://localhost:3025/hello\r\n\r\nYou can see:\r\n\r\n--------------Header-------------<br/>Saying hi<br/>--------Footer-----------------\r\n\r\nStep 4\r\n---------\r\n\r\nAdd :\r\n\r\n```ruby\r\nresponse.headers[\'Content-Type\'] = \'text/html\'\r\n```\r\n\r\nBrowse to http://localhost:3025/hello?client=high Here is output when we provide the value for client parameter:\r\n\r\n--------------Header-------------\r\nSaying hifrom high\r\n--------Footer-----------------\r\n\r\nStep 5\r\n---------\r\n\r\nLet\'s now write the same program using response.write. Here is the code:\r\n\r\nStep 6\r\n---------\r\n\r\n```ruby\r\nrequire \'rack\'\r\nrequire \'thin\'\r\n\r\nrack_app = lambda do |env|\r\n  request = Rack::Request.new(env)\r\n  response = Rack::Response.new\r\n\r\n  response.write \'--------------Header-------------<br/>\'\r\n  \r\n  if request.path_info == \'/hello\'\r\n    response.write \'Saying hiy \'\r\n    client = request[\'client\']\r\n    response.write \"from #{client}\" if client\r\n  else\r\n    response.write \"You need to provide the client information\"\r\n  end\r\n  response.write \"<br/>--------Footer-----------------\"\r\n\r\n  response.headers[\'Content-Type\'] = \'text/html\'\r\n  response.finish\r\nend\r\n\r\nRack::Handler::Thin.run rack_app, Port: 3025\r\n```\r\n\r\nThe behavior is still the same. Notice that in the previous example we generated the body string and we set it as the response body. We also had to set the content-length header value. In this example we directly write the body by using the response.write method. We also used finish instead of to\\_a method, to_a is an alias for finish method. Rack::Request & Rack::Response is used to write Rack apps directly.\r\n\r\nStep 7\r\n---------\r\n\r\nStatus Code\r\n---------\r\n\r\nWe can directly access the Response object to change the status code like this: \r\n\r\n```ruby\r\nresponse.status = 200\r\n```\r\n\r\nIf it is not set, then the status code defaults to 200. Response provides a redirect method to redirect directly:\r\n\r\n```ruby\r\nredirect(target, status=302)\r\n```\r\n\r\nLet us now run a program to illustrate the redirect method. This program will redirect your browser to Google.\r\n\r\n```ruby\r\nrequire \'rack\'\r\nrequire \'thin\'\r\n\r\nrack_app = lambda do |env|\r\n  request = Rack::Request.new(env)\r\n  response = Rack::Response.new\r\n  \r\n  if request.path_info == \'/redirect\'\r\n    response.redirect(\'http://google.com\')\r\n  else\r\n    response.write \'You did not get redirected\'\r\n  end\r\n  response.finish\r\nend\r\n\r\nRack::Handler::Thin.run rack_app, Port: 3025\r\n```\r\n\r\nStep 8\r\n---------\r\n\r\nResponse Header\r\n---------\r\n\r\nYou can also set the response header directly on the response object. It is a hash, so you can set it like this:\r\n\r\n```ruby\r\nresponse.headers[\'Content-Type\'] = \'text/plain\'\r\n```\r\n\r\nLet\'s modify the previous example to return plain text instead of html to the browser.\r\n\r\n```ruby\r\nresponse.headers[\'Content-Type\'] = \'text/plain\'\r\nresponse.write \'<h1>You did not get redirected</h1>\'\r\n```\r\n\r\nThis will display the output as plain text on the browser. \r\n\r\nStep 9\r\n---------\r\n\r\nNow we are ready to see the basic structure of a Rack application. \r\n\r\n```ruby\r\nclass BasicRack\r\n  def initialize(app) \r\n    @app = app\r\n  end\r\n\r\n  def call(env)\r\n  # Can modify request here (env)\r\n  # Can call layer below like this:\r\n  status, headers, response = @app.call(env)\r\n  # Can modify response here\r\n  [status, headers, response] \r\n  end\r\nend\r\n```\r\n\r\nHere is an example that modifies the response:\r\n\r\n```ruby\r\nclass Downcase\r\n  \r\n  def initialize(app)\r\n    @app = app \r\n  end\r\n\r\n  def call(env)\r\n    status, headers, response = @app.call(env) \r\n    [status, headers, response.body.downcase]\r\n  end \r\n\r\nend\r\n```\r\n\r\nYou see all the different content types you set here: [Content Types](http://www.w3.org/TR/html4/types.html#h-6.7 \'Content Types\').\r\n\r\nSummary\r\n========\r\n---------\r\n\r\nIn this article, you learned about http response, status code, response header and how to generate response body.','2015-05-27 01:53:40','2016-12-22 21:32:08'),(2121,'Web Development in Ruby : Middleware in Rack Apps','Objective\r\n=========\r\n---------\r\n\r\nTo learn about Middleware.\r\n\r\nDiscussion\r\n=========\r\n---------\r\n\r\nMiddleware is a general term for any program that serves to \"glue together\" two separate programs. It is the software that connects two separate applications and passes data between them. Alternatively, software that allows more than one application to share information seamlessly.\r\n\r\nRack filters allow on the fly transformations of payload and header information in both the request into a resource and the response from a resource.\r\n\r\nA Rack application can transform the content of HTTP requests, responses and header information. They can modify or adapt the requests for a resource and modify and adapt responses from a resource.\r\nRack filters can intercept :\r\n\r\n• The accessing of a resource before a request to it is invoked.\r\n• The processing of the request for a resource before it is invoked.\r\n• The modification of request headers and data by wrapping the request in customized versions of the request object.\r\n• The modification of response headers and response data by providing customized versions of the response object.\r\n• The interception of an invocation of a resource after its call. Here is some examples on how Rack filters could be used:\r\n• Authentication\r\n• Logging and auditing\r\n• Image conversion\r\n• Data compression\r\n• Encryption\r\n• Tokenizing\r\n• Filters that trigger resource access events \r\n• XSL/T filters that transform XML content \r\n• MIME-type chain filters\r\n• Caching\r\n• Exception Handling\r\n\r\nExamples of Rack Middleware that comes with Rack distribution:\r\n\r\nRack::Static - Handles fetching and returning static assets or caches\r\nRack::Session::Cookie - Handles your sessions via cookies\r\nRack::ShowExceptions - Catches any exceptions thrown in your app and returns a useful back-trace on the exception and many more.\r\n\r\nSteps\r\n=========\r\n---------\r\n\r\nStep 1\r\n---------\r\n\r\nIn a previous article we wrote the code that outputs header and footer for the content generated by the Rack app. Here it is reproduced again for your convenience:\r\n\r\n```ruby\r\nrequire \'rack\'\r\nrequire \'thin\'\r\n\r\nrack_app = lambda do |env|\r\n  request = Rack::Request.new(env)\r\n  response = Rack::Response.new\r\n\r\n  response.write \'--------------Header-------------<br/>\'\r\n  \r\n  if request.path_info == \'/hello\'\r\n    response.write \'Saying hi \'\r\n    client = request[\'client\']\r\n    response.write \"from #{client}\" if client\r\n  else\r\n    response.write \"You need to provide the client information\"\r\n  end\r\n  response.write \"<br/>--------Footer-----------------\"\r\n  response.finish\r\nend\r\n\r\nRack::Handler::Thin.run rack_app, Port: 3025\r\n```\r\n\r\nStep 2\r\n---------\r\n\r\nWe are going to split this into two Rack apps that will co-operate to produce the same output as the above program. First step is to remove the footer and header generation out of the above program so that it now becomes:\r\n\r\n```ruby\r\nrequire \'rack\'\r\nrequire \'thin\'\r\n\r\nrack_app = lambda do |env|\r\n  request = Rack::Request.new(env)\r\n  response = Rack::Response.new\r\n  \r\n  if request.path_info == \'/hello\'\r\n    response.write(\'You said hello\')\r\n    client = request[\'client\']\r\n    response.write(\"from #{client}\") if client\r\n  else\r\n    response.write \'You need to provide some client information\'\r\n  end\r\n  response.finish\r\nend\r\n\r\nRack::Handler::Thin.run Decorator.new(rack_app), Port: 3025\r\n```\r\n\r\nStep 3\r\n---------\r\n\r\nCompare this code to the program in the previous step, you see that the last line that invokes the run is now using Decorator class. This class will generate the header and footer. Let\'s define the Decorator class which will take the original Rack app as an argument to its constructor. The class will look something like:\r\n\r\n```ruby\r\nclass Decorator\r\n  def initialize(app)\r\n    ...\r\n  end\r\n  def call(env)\r\n    ...\r\n  end\r\nend\r\n```\r\n\r\nStep 4\r\n---------\r\n\r\nNow look at the implementation of Decorator below. Notice how it wraps the response body from the original response body from the Rack app that was passed into its constructor.\r\n\r\n```ruby\r\nclass Decorator\r\n  def initialize(app)\r\n    @next_in_chain = app\r\n  end\r\n  def call(env)\r\n    status, headers, body = @next_in_chain.call(env)\r\n    new_body = \"---------------Header--------------<br/>\"\r\n    body.each{|s| new_body << s}\r\n    new_body << \"<br/>---------Footer-------------------\"\r\n    headers[\'Content-Length\'] = new_body.bytesize.to_s\r\n    [status, headers, [new_body]]\r\n  end\r\nend\r\n```\r\n\r\nDiscussion\r\n=========\r\n---------\r\n\r\nThe line number 34 now passes an instance of Decorator, another Rack app as the first argument. The constructor of Decorator takes a Rack app and it modifies the body of the response to print the header and the footer thereby wrapping the output of the Rack app that was passed to it in the constructor. This produces the same output as the example in previous article which prints \"You said hello\" enclosed by the header and footer.\r\n\r\nDecorator is a valid Rack application since it meets the Rack spec. As a general rule, any middle-ware must be a valid Rack application.\r\n\r\nWhen the Thin server is run it calls the call method of the Decorator. In line 6 you see that our original Rack app gets called by the Decorator. This call to original Rack app returns the status, headers and body which gets initialized in the local variables.\r\n\r\nThe status is an HTTP status. When parsed as integer (to_id), it must be greater than or equal to 100.\r\nThe header must respond to each and yield values of key and value. The header keys must be Strings. The header must not contain a Status key, contain keys with : or newlines in their name, contain key names that end in hyphen or underscore, but only contain keys that consist of letters, digits, underscore or hyphen and start with a letter. The values of the header must be Strings, consisting of lines (for multiple header values, e.g. multiple Set-Cookie values) separated by \"\\n\". The lines must not contain characters below 037.\r\n\r\nThere must be a Content-Type, except when the Status is 1xx, 204 or 304, in which case there must be none given. There must not be a Content-Length header when the Status is 1xx, 204 or 304.\r\n\r\nThe Body must respond to each and must only yield String values. The Body itself should not be an instance of String, as this will break in Ruby 1.9. If the Body responds to close, it will be called after iteration. If the Body responds to to_path, it must return a String identifying the location of a file whose contents are identical to that produced by calling each; this may be used by the server as an alternative, possibly more efficient way to transport the response. The Body commonly is an Array of Strings, teh application instance itself, or File-like object.\r\n\r\nComing back to our example, we only know that the original body can respond to each, which returns a String. Therefore we call each on the body and append the old string values from the original Rack app body to the header and append the footer to the end to create a new_body. This happens in 7, 8 and 9 in the code shown above.\r\n\r\nLet\'s insert puts body.inspect before the line 8 and run the app. In the console we get the output of inspecting body:\r\n\r\n```ruby\r\n#<Rack::Response:0x00000100bae1d0 @status=200, @header={\"Content-Type\"=>\"text/html\", \"Content-Length\"=>\"38\"}, @writer=#<Proc:0x00000100badf00@/usr/local/lib/ruby/gems/1.9.1/ gems/rack-1.2.1/lib/rack/response.rb:27 (lambda)>, @block=nil, @length=38, @body=[\"You did not provide client information\"]>\r\n```\r\n\r\nWell, this is a surprise. You might have expected the type to be String but it is an instance of Rack::Request. If you refer the documentation for Rack::Response you will see that it responds to each method and returns String thereby satisfying the Rack specification that the Body must respond to each and only yield String values. It also says that the Body commonly is an Array of String, the application instance itself or a File-like object.\r\n\r\nStep 5\r\n---------\r\n\r\nLet\'s take a closer look at line number 30:\r\n\r\nresponse.finish is implemented in lib/rack/response.rb as shown below:\r\n\r\n```ruby\r\ndef finish(&block)\r\n  @block = block\r\n\r\n  if [204, 205, 304].include?(status.to_i)\r\n    header.delete CONTENT_TYPE\r\n    header.delete CONTENT_LENGTH\r\n    close\r\n    [status.to_i, header, []]\r\n  else\r\n    [status.to_i, header, BodyProxy.new(self){}]\r\n  end\r\nend\r\n```\r\n\r\nStep 6\r\n---------\r\n\r\nAs you can see the body value is an instance of Response object itself. Let\'s look at the implementation of each for Response (in lib/rack/response.rb):\r\n\r\n```ruby\r\ndef each(&callback)\r\n  @body.each(&callback)\r\n  @writer = callback\r\n  @block.call(self)  if @block\r\nend\r\n```\r\n\r\nThe each method delegates the work to the body variable of the Request object. In line number 10 we make sure that we set the value for Content-Length.\r\n\r\nMiddleware is framework-independent components that process requests independently or in concert with other middleware.\r\n\r\nBetween the server and the framework, Rack can be customized to your applications needs using middleware, for example:\r\n\r\nRack::URLMap to route to multiple applications inside the same process. Rack::CommonLogger for creating Apache-style log files.\r\nRack::ShowException, for catching unhandled exceptions and presenting them in a nice and helpful way with clickable backtrace.\r\nRack::File, for serving static files.\r\nRack::Cascade - Try a request with several apps, and return the first non-404 result ...many others!\r\n\r\nAll these components use the same interface, which is described in detail in the Rack specification. These optional components can be used in any way you wish. You can find the list of Rack built-in middleware on it\'s home page.\r\n\r\nWhy Middleware\r\n---------\r\n\r\nSeparation of Concerns is the process of separating a program into distinct features that overlap in functionality as little as possible. A concern is any piece of interest or focus in a program. It is achieved through modularity of programming and encapsulation with the help of information hiding. Layered designs in information systems are also based on separation of concerns (presentation, business logic, data access, database etc).\r\n\r\nIf we are attempting to separate concern A from concern B, then we are seeking a design that provides that variations in A do not induce or require a corresponding change in B (and the converse). If we manage to successfully separate those concerns then we say that they are decoupled.\r\n\r\nMost programs require some form of security and logging. Security and logging are often secondary concerns, whereas the primary concern is often on accomplishing business goals. The core concern is the business logic. Security and logging are cross-cutting concerns.\r\n\r\nThe middleware can achieve separation of business logic from other comon logic. These common logic can be used in a different business context. For instance the same security and logging functionality can be applied to a financial domain as well as medical domain. This enables the core domain model to evolve independent of other models such as security and logging resulting in reuse and ease of maintenance.\r\n\r\nStep 7\r\n---------\r\n\r\nDecorator we wrote earlier can be used with any Rack application.\r\n\r\n```ruby\r\nclass Decorator\r\n  def initialize(app)\r\n    @next_in_chain = app\r\n  end\r\n  def call(env)\r\n    status, headers, body = @next_in_chain.call(env)\r\n    new_body = \"---------------Header--------------<br/>\"\r\n    body.each{|s| new_body << s}\r\n    new_body << \"<br/>---------Footer-------------------\"\r\n    headers[\'Content-Length\'] = new_body.bytesize.to_s\r\n    [status, headers, [new_body]]\r\n  end\r\nend\r\n\r\nrack_app = lambda do |env|\r\n  [200, {\'Content-Type\' => \'text/html\'}, [\'whatever rack app\']]\r\nend\r\n\r\nRack::Handler::Thin.run Decorator.new(rack_app), Port: 3025\r\n```\r\n\r\nThis is a simple example. Suppose we had implemented a middleware for user authentication, then the middleware can be used with any Rack application without any modification. Develop middleware that is focused on doing one thing really well. The advantages are :\r\n\r\na) Each middleware can be developed independently and used in a plug-n-play manner.\r\nb) We can mix and match middleware to combine them in several ways to meet the needs of different applications and can be dynamically configured based on application needs.\r\n\r\nSummary\r\n========\r\n---------\r\n\r\nIn this article, you learned the what, why and how to use Middleware in a Rack app.','2015-05-27 02:15:49','2015-05-27 02:21:38'),(2131,'Web Development in Ruby : Middleware Assembly in Rack App','Objective\r\n=========\r\n---------\r\n\r\nTo learn about Middleware Assembly.\r\n\r\nDiscussion\r\n=========\r\n---------\r\n\r\nHow to Assemble\r\n---------\r\n\r\nWe often need to stack multiple Rack applications to meet the application requirements. If we have a Rack app and two middlewares called Middleware1 and Middleware2 then we can use the two middlewares like this:\r\n\r\nRack::Handler::Thin.run Middleware1.new(Middleware2.new(rack_app))\r\n\r\nWhen we need to pass options in the second argument the syntax would be as follows:\r\n\r\nRack::Handler::Thin.run(Middleware1.new(Middleware2.new(rack_app, options2), options1))\r\n\r\nIf we need to use more than two middleware this code will become even more verbose. If you want to modify the order of the middleware, it becomes complex and error-prone.\r\n\r\nSteps\r\n=========\r\n---------\r\n\r\nStep 1\r\n---------\r\n\r\nWe can define a class that has methods to use and run a given middleware.\r\n\r\n```ruby\r\nclass Builder\r\n  def use\r\n    ...\r\n  end\r\n  def run\r\n    ...\r\n  end  \r\nend\r\n```\r\n\r\nStep 2\r\n---------\r\n\r\nNow we need to be able to specify the order of the middleware that we would like to chain and run a given Rack app in the end. We want to specify this in code, with something like this:\r\n\r\n```ruby\r\nBuilder.new do\r\n  use Middleware1\r\n  use Middleware2\r\n  run MyRackApp\r\nend\r\n```\r\n\r\nRack::Builder implements a small DSL to iteratively construct Rack applications. Rack implementation comes with lot of middleware. One of the middleware, Rack::ContentLength can automatically set the response header \"Content-Length\". \r\n\r\nStep 3\r\n---------\r\n\r\nSo let\'s delete the line 11 which sets the Content-Length : \r\n\r\n```ruby\r\nheaders[\'Content-Length\'] = new_body.bytesize.to_s \r\n```\r\n\r\nfrom Decorator class.\r\n\r\n```ruby\r\nclass Decorator\r\n  def initialize(app)\r\n    @next_in_chain = app\r\n  end\r\n  def call(env)\r\n    status, headers, body = @next_in_chain.call(env)\r\n    new_body = \"---------------Header--------------<br/>\"\r\n    body.each{|s| new_body << s}\r\n    new_body << \"<br/>---------Footer-------------------\"\r\n    [status, headers, [new_body]]\r\n  end\r\nend\r\n\r\nrack_app = lambda do |env|\r\n  [200, {\'Content-Type\' => \'text/html\'}, [\'Hello from Builder\']]\r\nend\r\n\r\nrequire \'rack\'\r\nrequire \'thin\'\r\n\r\nbuilder = Rack::Builder.new do\r\n  use Rack::ContentLength\r\n  use Decorator\r\n  run rack_app\r\nend\r\n\r\nRack::Handler::Thin.run Decorator.new(builder), Port: 3025\r\n```\r\n\r\nThe output is:\r\n\r\n---------------Header--------------\r\n---------------Header--------------\r\nHello from Builde\r\n\r\nThis cuts-off the body. If you add text to the response body without updating the Content-Length, the HTML may get truncated (because the browser is only displaying the original number of characters, before you added more text to the response body). Rack::ContentLength only works under certain conditions. \r\n\r\nStep 4\r\n---------\r\n\r\nSo we need to include the line on setting the content-length before the \r\n\r\n```ruby\r\nheaders[\'Content-Length\'] = new_body.bytesize.to_s \r\n```\r\n\r\nas shown below to fix this problem.\r\n\r\n```ruby\r\nclass Decorator\r\n  def initialize(app)\r\n    @next_in_chain = app\r\n  end\r\n  def call(env)\r\n    status, headers, body = @next_in_chain.call(env)\r\n    new_body = \"---------------Header--------------<br/>\"\r\n    body.each{|s| new_body << s}\r\n    new_body << \"<br/>---------Footer-------------------\"\r\n    headers[\'Content-Length\'] = new_body.bytesize.to_s\r\n    [status, headers, [new_body]]\r\n  end\r\nend\r\n```\r\n\r\nStep 5\r\n---------\r\n\r\nLet\'s write a simple example that works properly to illustrate the use of Builder.\r\n\r\n```ruby\r\nrequire \'rack\'\r\nrequire \'thin\'\r\n\r\ninspector = lambda do |env|\r\n  [200, {\'Content-Type\' => \'text/html\'}, env.inspect]\r\nend\r\n\r\nbuilder = Rack::Builder.new\r\nbuilder.run inspector\r\n\r\nRack::Handler::Thin.run builder, :Port => 3025\r\n```\r\n\r\nSummary\r\n========\r\n---------\r\n\r\nIn this article, how to chain middleware together to accomplish a bigger task in a Rack app.','2015-05-27 02:27:51','2015-05-27 02:27:51'),(2141,'JSON Schema Basics','Objective\r\n=========\r\n---------\r\n\r\nTo learn about JSON schema.\r\n\r\nDiscussion\r\n=========\r\n---------\r\n\r\nWhat is JSON?\r\n---------\r\n\r\nJSON stands for \'JavaScript Object Notation\', a simple data interchange format. JSON is built on the following data structures:\r\n\r\nObject\r\n---------\r\n\r\n```json\r\n{\"key1\": \"value1\", \"key2\": \"value2\" }\r\n```\r\n\r\nArray\r\n---------\r\n\r\n```sh\r\n[\'first\', \'second\', \'third\']\r\n```\r\n\r\nNumber\r\n---------\r\n\r\n42\r\n3.12159\r\n\r\nString\r\n---------\r\n\r\n\'This is a string\'\r\n\r\nboolean\r\n---------\r\n\r\ntrue\r\nfalse\r\n\r\nnull\r\n---------\r\n\r\nnull\r\n\r\nIn Ruby they map to Hash, Array, Integer/Float, String, TrueClass/FalseClass and NilClass.\r\n\r\nStructured data is represented using these simple data types. Here is two different ways to represent a person in JSON :\r\n\r\n```json\r\n{\r\n  \"name\": \"George Washington\",\r\n  \"birthday\": \"February 22, 1732\",\r\n  \"address\": \"Mount Vernon, Virginia, United States\"\r\n} \r\n\r\n{\r\n\"first_name\": \"George\",\r\n\"last_name\": \"Washington\",\r\n\"birthday\": \"1732-02-22\",\r\n\"address\": {\r\n  \"street_address\": \"3200 Mount Vernon Memorial Highway\",\r\n  \"city\": \"Mount Vernon\",\r\n  \"state\": \"Virginia\",\r\n  \"country\": \"United States\"\r\n }\r\n} \r\n```\r\n\r\nBoth are valid. When an application needs to consume a JSON document for a person, we need to know how the record is organized. This means we need to know what fields are expected and how the values are represented. That\'s where JSON Schema comes in.   \r\n\r\nThe following JSON Schema describes how the second example above is structured:\r\n\r\n```json\r\n{\r\n  \"type\": \"object\",\r\n  \"properties\": {\r\n    \"first_name\": { \"type\": \"string\" },\r\n    \"last_name\": { \"type\": \"string\" },\r\n    \"birthday\": { \"type\": \"string\", \"format\": \"date-time\" },\r\n    \"address\": {\r\n      \"type\": \"object\",\r\n      \"properties\": {\r\n        \"street_address\": { \"type\": \"string\" },\r\n        \"city\": { \"type\": \"string\" },\r\n        \"state\": { \"type\": \"string\" },\r\n        \"country\": { \"type\" : \"string\" }\r\n		} \r\n	}\r\n  } \r\n}\r\n```\r\n\r\nThe JSON Schema is written in JSON. It\'s a declarative format for \'describing the structure of other data\'. \r\n\r\nJSON Schema\r\n---------\r\n\r\nWhat does it do? JSON Schema describes your JSON data format.\r\n\r\nJSON Schema Advantages\r\n---------\r\n\r\n1. Clear, human and machine-readable documentation\r\n2. Complete structural validation, useful for:\r\n      -  automated testing\r\n      -  validating client-submitted data\r\n	  \r\nReading JSON\r\n---------\r\n\r\nJSON can be read using the JSON gem. If you use RVM. The default gem contains json gem version 1.8.1.\r\n\r\n```ruby\r\nrequire \'json\'\r\n => true \r\n\r\njson_schema = \"{ \'type\': \'number\' }\"\r\n```\r\n\r\nParsing the first document:\r\n\r\n```ruby\r\n => \"{\\\"type\\\":\\\"number\\\"}\" \r\n \r\n > parsed = JSON.parse(json_schema)\r\n  => {\"type\"=>\"number\"} \r\n > parsed.class\r\n  => Hash \r\n > parsed[\'type\']\r\n  => \"number\" \r\n```\r\n\r\nValidating JSON Data\r\n---------\r\n\r\nYou can use json-schema gem to validate data against a JSON schema like this:\r\n\r\n```ruby\r\nrequire \'json-schema\'\r\n\r\nJSON::Validator.validate(schema, data)\r\n```\r\n\r\nLearning Specs\r\n=========\r\n---------\r\n\r\nHere is `json_schema_spec.rb`:\r\n\r\n```ruby\r\nrequire \'json-schema\'\r\n\r\ndescribe \'JSON Schema\' do\r\n  context \'illustrate how to use the string type for schema type string\' do\r\n    let(:schema) { {\'type\' => \'string\'} }\r\n    \r\n    it \'string is valid\' do\r\n      data = \'hi\'  \r\n      \r\n      result = JSON::Validator.validate(schema, data)\r\n      \r\n      expect(result).to be true      \r\n    end\r\n    \r\n    it \'integer is not valid\' do\r\n      data = 1  \r\n      \r\n      result = JSON::Validator.validate(schema, data)\r\n      \r\n      expect(result).to be false      \r\n    end\r\n        \r\n  end\r\n  \r\n  context \'illustrate how to use the number type for schema type number\' do\r\n    let(:schema) { {\'type\' => \'number\'} }\r\n    \r\n    it \'Positive integers are valid\'  do\r\n      data = 42\r\n      \r\n      result = JSON::Validator.validate(schema, data)\r\n      \r\n      expect(result).to be true      \r\n    end\r\n    \r\n    it \'Negative integers are valid\' do\r\n      data = -1\r\n      \r\n      result = JSON::Validator.validate(schema, data)\r\n      \r\n      expect(result).to be true\r\n    end\r\n    \r\n    it \'simple floating point number is valid\' do\r\n      data = 5.0\r\n      \r\n      result = JSON::Validator.validate(schema, data)\r\n      \r\n      expect(result).to be true\r\n    end\r\n    \r\n    it \'Exponential notation is allowed\' do\r\n      data = 2.9979e8\r\n      \r\n      result = JSON::Validator.validate(schema, data)\r\n      \r\n      expect(result).to be true\r\n    end\r\n    \r\n    it \'Strings are not valid\' do\r\n      data = \'junk\'\r\n      \r\n      result = JSON::Validator.validate(schema, data)\r\n      \r\n      expect(result).to be false      \r\n    end\r\n    \r\n    # https://github.com/ruby-json-schema/json-schema/issues/251\r\n    it \'Bug in json-schema gem. Numbers which are string should fail.\' do\r\n     data = \'42\'\r\n      \r\n      result = JSON::Validator.validate(schema, data, json: true)\r\n      \r\n      expect(result).to be true      \r\n    end\r\n  end\r\n  \r\n  context \'illustrate how to accept strings and numbers but not structured data types\' do\r\n    let(:schema) { {\'type\' => [\'number\', \'string\'] } }\r\n    \r\n    it \'integer is valid\' do\r\n      data = 1\r\n      \r\n      result = JSON::Validator.validate(schema, data)\r\n      \r\n      expect(result).to be true           \r\n    end\r\n    \r\n    it \'string is valid\' do\r\n      data = \'hi\'\r\n      \r\n      result = JSON::Validator.validate(schema, data)\r\n      \r\n      expect(result).to be true      \r\n    end\r\n    \r\n    it \'structured data type is not valid\' do\r\n      data = [\'The meaning\', \'of\', \'and everything\']\r\n      \r\n      result = JSON::Validator.validate(schema, data)\r\n      \r\n      expect(result).to be false      \r\n    end\r\n  end\r\n  \r\nend\r\n```\r\n\r\nHere is `json_schema_object_spec.rb`:\r\n\r\n```ruby\r\nrequire \'json-schema\'\r\n\r\ndescribe \'Person representation in JSON\' do\r\n  \r\n  let(:schema) {\r\n     {\r\n      \"type\" => \"object\",\r\n      \"properties\" => {\r\n        \"first_name\" => { \"type\" => \"string\" },\r\n        \"last_name\" => { \"type\" => \"string\" },\r\n        \"birthday\" => { \"type\" => \"string\", \"format\" => \"date-time\" },\r\n        \"address\" => {\r\n          \"type\" => \"object\",\r\n          \"properties\" => {\r\n            \"street_address\" => { \"type\" => \"string\" },\r\n            \"city\" => { \"type\" => \"string\" },\r\n            \"state\" => { \"type\" => \"string\" },\r\n            \"country\" => { \"type\" => \"string\" }\r\n           } \r\n         }\r\n       }\r\n     }\r\n  }\r\n  \r\n  it \'name birthday address fails\' do\r\n    data = {\r\n              \"name\" => \"George Washington\",\r\n              \"birthday\" => \"February 22, 1732\",\r\n              \"address\" => \"Mount Vernon, Virginia, United States\"\r\n            }\r\n            \r\n     result = JSON::Validator.validate(schema, data)\r\n     \r\n     expect(result).to be false\r\n  end\r\n\r\n  # This test will fail if you add the birtday with \'22-10-1937\r\n  it \'first_name, last_name, birthday with address succeeds\' do\r\n    data = \r\n      {\r\n        \"first_name\" => \"George\",\r\n        \"last_name\" => \"Washington\",\r\n        \"address\" => {\r\n          \"street_address\" => \"3200 Mount Vernon Memorial Highway\",\r\n          \"city\" => \"Mount Vernon\",\r\n          \"state\" => \"Virginia\",\r\n          \"country\" => \"United States\"\r\n        } \r\n      }\r\n    \r\n    result = JSON::Validator.validate(schema, data)\r\n    \r\n    expect(result).to be true\r\n  end\r\nend\r\n```\r\n\r\nHere is `json_schema_basics_spec.rb`:\r\n\r\n```ruby\r\nrequire \'json-schema\'\r\n\r\ndescribe \'JSON Schema Basics\' do\r\n  context \'An empty object will accept any valid JSON\' do\r\n    it \'integer is valid\' do\r\n      schema = {}\r\n      data = 1\r\n      \r\n      result = JSON::Validator.validate(schema, data)\r\n    \r\n      expect(result).to be true\r\n    end\r\n\r\n    it \'string is valid\' do\r\n      schema = {}\r\n      data = \'hi\'\r\n      \r\n      result = JSON::Validator.validate(schema, data)\r\n    \r\n      expect(result).to be true\r\n    end\r\n    \r\n    it \'arbitrary nested data structure is valid\' do\r\n      schema = {}\r\n      data = { \'an\' => [ \'arbitrarily\', \'nested\'], \'data\' => \'structure\' }\r\n      \r\n      result = JSON::Validator.validate(schema, data)\r\n    \r\n      expect(result).to be true      \r\n    end\r\n  end\r\n\r\nend\r\n```\r\n\r\nResources\r\n=========\r\n---------\r\n\r\n1. JSON Schema Home page http://json-schema.org/\r\n2. [Understanding JSON Schema] (http://spacetelescope.github.io/understanding-json-schema/UnderstandingJSONSchema.pdf \'Understanding JSON Schema\')','2015-05-27 21:01:03','2016-12-22 21:35:30'),(2151,'Sinatra Beyond Basics : Send a Zip File','Objective\r\n=========\r\n---------\r\n\r\nTo zip files and send the zipped file to the client.\r\n\r\nSteps\r\n=========\r\n---------\r\n\r\nStep 1\r\n---------\r\n\r\nCreate a bogus.txt file with:\r\n\r\n```sh\r\nThis is a test file.\r\n```\r\n\r\nStep 2\r\n---------\r\n\r\nCrete a readme.txt file with:\r\n\r\n```sh\r\nThis is a readme.\r\n```\r\n\r\nStep 3\r\n---------\r\n\r\nCreate a tester.zip in the current directory that includes bogus.txt and readme.txt.\r\n\r\nStep 4\r\n---------\r\n\r\nCreate zipper.rb with:\r\n\r\n```ruby\r\nrequire \'sinatra\'\r\n\r\nget \'/\' do\r\n  filename =\"./tester.zip\"\r\n  \r\n  send_file(filename, :filename => \"test.zip\", :type => \"application/zip\")\r\nend\r\n```\r\n\r\nStep 5\r\n---------\r\n\r\nRun the Sinatra app, it will send the zip file when you do a GET.\r\n\r\nSummary\r\n========\r\n---------\r\n\r\nIn this article you learned how to send a zip file in a Sinatra app.','2015-05-29 03:12:59','2015-05-29 03:13:57'),(2161,'Web Development in Ruby : Generate Documents using Templates','Objective\r\n=========\r\n---------\r\n\r\nTo learn how to use embedded ruby to merge data with a template.\r\n\r\nSteps\r\n=========\r\n---------\r\n\r\nStep 1\r\n---------\r\n\r\nCreate a name.rb class:\r\n\r\n```ruby\r\nclass Name\r\n  def initialize\r\n    @name = \'Bugs Bunny\'\r\n  end\r\n  \r\n  # This is only a helper method to access\r\n  # the object\'s (private) binding method\r\n  def get_binding\r\n    binding\r\n  end\r\nend\r\n```\r\n\r\nStep 2\r\n---------\r\n\r\nCreate a welcome.html.erb file:\r\n\r\n```ruby\r\nWelcome <%= @name %>\r\n```\r\n\r\nStep 3\r\n---------\r\n\r\nCreate a play.rb class:\r\n\r\n```ruby\r\nrequire \'erb\'\r\nrequire_relative \'name\'\r\n\r\nname = Name.new\r\n\r\nerb_file = File.read(File.join(__dir__, \'welcome.html.erb\'))\r\n\r\ntemplate = ERB.new(erb_file)\r\noutput = template.result(name.get_binding)\r\n\r\nputs output\r\n```\r\n\r\nRead the [Ruby documentation](http://ruby-doc.org/stdlib-2.2.2/libdoc/erb/rdoc/ERB.html#method-i-result \'Ruby documentation\') to learn about what the above code does. Start experimenting with other methods in the ERB class.\r\n\r\nSummary\r\n========\r\n---------\r\n\r\nIn this article you learned how to use ERB to generate dynamic documents by merging a given template with values from an object.','2015-05-29 03:25:43','2015-05-29 03:25:43'),(2171,'MongoDB Basics : Delete a Database in MongoDB','Objective\r\n=========\r\n---------\r\n\r\nTo learn how to drop database in MongoDB programmatically.\r\n\r\nSteps\r\n=========\r\n---------\r\n\r\nStep 1\r\n---------\r\n\r\nCreate a databases.txt file that contains a list of databases to delete.\r\n\r\nStep 2\r\n---------\r\n\r\nCreate a clean.rb:\r\n\r\n```ruby\r\nrequire \'mongo\'\r\n\r\ninclude Mongo\r\n\r\n# Read the database name in the junk.txt\r\nfile = File.readlines(\'/path/to/the/list/of/file/to/delete/databases.txt\')\r\n\r\n# Drop the database\r\nfile.each do |line|\r\n  client = Client.new([ \'127.0.0.1:27017\' ], :database => \"#{line.chomp.strip}\")\r\n  client.database.drop\r\nend\r\n```\r\n\r\nThis will save you lot of time when you have to delete many databases in MongoDB.\r\n\r\nSummary\r\n========\r\n---------\r\n\r\nIn this article you learned how to delete database in MongoDB and avoid wasting time in MongoDB console to delete databases by running use database and drop database commands.','2015-05-29 03:35:11','2015-05-29 03:36:15'),(2181,'MongoDB Basics : List Collections and Documents','Objective\r\n=========\r\n---------\r\n\r\nTo learn how to list all collections and documents in a collection programmatically using Ruby.\r\n\r\nSteps\r\n=========\r\n---------\r\n\r\nStep 1\r\n---------\r\n\r\nCreate document.rb:\r\n\r\n```ruby\r\nrequire \'mongo\'\r\n\r\ninclude Mongo\r\n\r\nclient = Mongo::Client.new([ \'127.0.0.1:27017\' ], :database => \'blog_development\')\r\n\r\ncollection = :articles\r\np client[collection].find.count\r\n\r\ndn = client[collection].find\r\n\r\ndn.each do |doc|\r\n  puts doc\r\nend\r\n```\r\n\r\nStep 2\r\n---------\r\n\r\n```ruby\r\nrequire \'mongo\'\r\n\r\ninclude Mongo\r\n\r\nclient = Mongo::Client.new([ \'127.0.0.1:27017\' ], :database => \'blog_development\')\r\ndatabase = client.database\r\n\r\np database.collections #=> Returns an array of Collection objects.\r\np database.collection_names #=> Returns an array of collection names as strings.\r\n```\r\n\r\nStep 3\r\n---------\r\n\r\nIf you are using Mongoid gem, you can check the currently connected database: \r\n\r\n```ruby\r\nputs \"Connected to : #{Mongoid.default_session.options[:database]}\"\r\n```\r\n\r\nSummary\r\n========\r\n---------\r\n\r\nIn this article you learned how to list all collections in a given database and how to list all documents in a collection programmatically using mongo db  Ruby driver.','2015-05-29 03:46:08','2015-05-29 08:29:23'),(2191,'Authentication from Scratch :  Email Validation and User Signup','Objective\r\n=========\r\n---------\r\n\r\nTo validate email address and implement signup feature.\r\n\r\nSteps\r\n=========\r\n---------\r\n\r\nStep 1\r\n---------\r\n\r\nAdd:\r\n\r\n```ruby \r\ngroup :development, :test do\r\n  gem \'rspec-rails\'\r\nend\r\n```\r\n\r\nto Gemfile and run bundle.\r\n\r\nStep 2\r\n---------\r\n\r\nRun:\r\n\r\n```ruby \r\n$rails g rspec:install\r\n```\r\n\r\nStep 3\r\n---------\r\n\r\nMigrate the test database:\r\n\r\n```ruby\r\n$rake db:migrate RAILS_ENV=test\r\n```\r\n\r\nStep 4\r\n---------\r\n\r\nWrite a test for password length validation:\r\n\r\n```ruby\r\nrequire \'rails_helper\'\r\n\r\nRSpec.describe User, type: :model do\r\n  it \'password length less than 5 characters is invalid\' do\r\n    user = User.new(email: \'bugs\', password: \'1234\')\r\n\r\n    result = user.save\r\n\r\n    expect(result).to be(false)\r\n  end\r\nend\r\n```\r\n\r\nIn spec/models/user_spec.rb. Run the test \r\n\r\n```ruby\r\n$rspec spec/models/user_spec.rb \r\n```\r\n\r\nIt fails.\r\n\r\nStep 5\r\n---------\r\n\r\nImplement password validation:\r\n\r\n```ruby\r\nvalidates :password, length: { minimum: 5}\r\n```\r\n\r\nThe test passes.\r\n\r\nStep 6\r\n---------\r\n\r\nWrite the test for positive case:\r\n\r\n```ruby\r\nit \'password length must be at-least 5 characters\' do\r\n  user = User.new(email: \'bugs\', password: \'12345\')\r\n\r\n  result = user.save\r\n\r\n  expect(result).to be(true)\r\nend\r\n```\r\n\r\nStep 7\r\n---------\r\n\r\nWrite the test for unique email:\r\n\r\n```ruby\r\nit \'email must be unique\' do\r\n  user = User.new(email: \'bugs\', password: \'12345\')\r\n  user.save\r\n\r\n  u = User.new(email: \'bugs\', password: \'12345\')\r\n  u.save\r\n\r\n  expect(u.errors.get(:email)).to eq(\'must be unique\')\r\nend\r\n```\r\n\r\nRun the test.\r\n\r\nStep 8\r\n---------\r\n\r\nImplement email unique feature:\r\n\r\n```ruby\r\nvalidates :email, uniqueness: true\r\n```\r\n\r\nStep 9\r\n---------\r\n\r\nChange the error message in the test to:\r\n\r\n```sh\r\n[\"has already been taken\"]\r\n```\r\n\r\nSo the test now looks like this:\r\n\r\n```ruby\r\nit \'email must be unique\' do\r\n  user = User.new(email: \'bugs\', password: \'12345\')\r\n  user.save\r\n\r\n  u = User.new(email: \'bugs\', password: \'12345\')\r\n  u.save\r\n\r\n  expect(u.errors.get(:email)).to eq([\"has already been taken\"])\r\nend\r\n```\r\n\r\nStep 10\r\n---------\r\n\r\nWrite a test for email format validation:\r\n\r\n```ruby\r\nit \'email with invalid format is invalid\' do\r\n  user = User.new(email: \'bugs\', password: \'12345\')\r\n  user.save\r\n\r\n  expect(user.errors.get(:email)).to eq([\'email is not valid\'])\r\nend\r\n```\r\n\r\nRun the test. It fails.\r\n\r\nStep 11\r\n---------\r\n\r\nImplement the email format validation. This is stolen from Rails docs:\r\n\r\n```ruby\r\nvalidates :email, format: { with: /\\A([^@\\s]+)@((?:[-a-z0-9]+\\.)+[a-z]{2,})\\z/i, on: :create }\r\n```\r\n\r\nStep 12\r\n---------\r\n\r\nChange the error message in the test as follows:\r\n\r\n```ruby\r\nexpect(user.errors.get(:email)).to eq([\'is invalid\'])\r\n```\r\n\r\nStep 13\r\n---------\r\n\r\nChange the email value for all the old tests to `bugs@disney.com`. So the tests looks like this:\r\n\r\n```ruby\r\nrequire \'rails_helper\'\r\n\r\nRSpec.describe User, type: :model do\r\n  it \'password length less than 5 characters is invalid\' do\r\n    user = User.new(email: \'bugs@disney.com\', password: \'1234\')\r\n\r\n    result = user.save\r\n\r\n    expect(result).to be(false)\r\n  end\r\n  \r\n  it \'password length must be atleast 5 characters\' do\r\n    user = User.new(email: \'bugs@disney.com\', password: \'12345\')\r\n\r\n    result = user.save\r\n\r\n    expect(result).to be(true)\r\n  end\r\n  \r\n  it \'email must be unique\' do\r\n    user = User.new(email: \'bugs@disney.com\', password: \'12345\')\r\n    user.save\r\n\r\n    u = User.new(email: \'bugs@disney.com\', password: \'12345\')\r\n    u.save\r\n\r\n    expect(u.errors.get(:email)).to eq([\"has already been taken\"])\r\n  end\r\n  \r\n  it \'email with invalid format is invalid\' do\r\n    user = User.new(email: \'bugs\', password: \'12345\')\r\n    user.save\r\n\r\n    expect(user.errors.get(:email)).to eq([\'is invalid\'])\r\n  end\r\nend\r\n```\r\n\r\nAll the tests pass.\r\n\r\nStep 14\r\n---------\r\n\r\nWrite a test for success case:\r\n\r\n```ruby\r\nit \'has no errors for valid email format\' do\r\n  user = User.new(email: \'bugs@disney.com\', password: \'12345\')\r\n  user.save\r\n\r\n  expect(user.errors.get(:email)).to be_nil\r\nend\r\n```\r\n\r\nOnly email and password fields are allowed in the user model. The controller will restrict the user from providing values for any other fields in the user model.\r\n\r\nStep 15\r\n---------\r\n\r\nAdd the following gems and run bundle.\r\n\r\n```ruby\r\ngroup :test do\r\n  gem \'capybara\'\r\n  gem \'selenium-webdriver\'\r\nend\r\n```\r\n\r\n```sh\r\nbundle install\r\n```\r\n\r\nStep 16\r\n---------\r\n\r\nHere is the high level view of what the feature spec should look like:\r\n\r\n1. visit \'users/new\'\r\n2. fill out `bugs@disney.com` for user \r\n3. fill out 12345 for password\r\n4. Click sign up\r\n5. I should see \'Logged in as `bugs@rubyplus.com`.\' message.\r\n\r\nStep 17\r\n---------\r\n\r\nCreate `spec/features/create_an_account_spec.rb`.\r\n\r\n```ruby\r\nrequire \'rails_helper\'\r\nrequire \'spec_helper\'\r\n\r\nfeature \'Account Management\' do  \r\n  scenario \'A user creates an account\' do\r\n    visit new_user_path\r\n    \r\n    fill_in \"Email\", with: \'bugs@rubyplus.com\'\r\n    fill_in \"Password\", with: \'12345\'\r\n    \r\n    click_button \'Signup\'\r\n    \r\n    expect(page).to have_content(\'Logged in as bugs@rubyplus.com.\')\r\n  end\r\n\r\nend\r\n```\r\n\r\nStep 18\r\n---------\r\n\r\nCreate the users controller:\r\n\r\n```ruby\r\nrails g controller users new \r\n```\r\n\r\nStep 19\r\n---------\r\n\r\nCreate users/new.html.erb:\r\n\r\n```ruby\r\n<h1>Sign Up</h1>\r\n\r\n<%= form_for @user do |f| %>\r\n  <% if @user.errors.any? %>\r\n    <div class=\"error_messages\">\r\n      <h2>Form is invalid</h2>\r\n      <ul>\r\n        <% @user.errors.full_messages.each do |message| %>\r\n          <li><%= message %></li>\r\n        <% end %>\r\n      </ul>\r\n    </div>\r\n  <% end %>\r\n\r\n  <div class=\"field\">\r\n    <%= f.label :email %><br />\r\n    <%= f.text_field :email %>\r\n  </div>\r\n  <div class=\"field\">\r\n    <%= f.label :password %><br />\r\n    <%= f.password_field :password %>\r\n  </div>\r\n  <div class=\"actions\"><%= f.submit \"Signup\" %></div>\r\n<% end %>\r\n```\r\n\r\nStep 20\r\n---------\r\n\r\nRun:\r\n\r\n```ruby\r\nrake db:create\r\nrake db:migrate\r\nrails s\r\n```\r\n\r\nBrowse to localhost:3000/users/new. Add the empty user object in new action of users controller:\r\n\r\n```ruby \r\n@user = User.new\r\n```\r\n\r\nAdd the user resource in routes.rb to:\r\n\r\n```ruby \r\nresources :users\r\n```\r\n\r\nStep 21\r\n---------\r\n\r\nIf you don\'t have a javascript runtime installed, install it. On Ubuntu:\r\n\r\n```sh\r\n$curl -sL https://deb.nodesource.com/setup | sudo bash -\r\n$install nodejs\r\n```\r\n\r\nStep 22\r\n---------\r\n\r\nImplement the user signup by defining the create action in users controller:\r\n\r\n```ruby\r\ndef create\r\n  permitted = params[:user].permit(:email, :password)\r\n  @user = User.new(permitted)\r\n  \r\n  if @user.save\r\n  	redirect_to root_path\r\n  else\r\n  	render :new\r\n  end\r\nend\r\n```\r\n  \r\nStep 23\r\n---------\r\n\r\nFillout the signup form in localhost:3000/users/new\r\n \r\nStep 24\r\n---------\r\n\r\nUncomment root line in routes.rb\r\n \r\nStep 25\r\n---------\r\n\r\n```ruby\r\nrails g controller welcome index\r\n```\r\n\r\nSignup as a user will now work.\r\n\r\nStep 26\r\n---------\r\n\r\nThe feature spec will now pass.\r\n\r\n```sh\r\n$rspec spec/features/create_an_account.rb \r\n```\r\n\r\nStep 27\r\n---------\r\n\r\nAdd the link to application.html.erb:\r\n\r\n```ruby\r\n<%= link_to \'Signup\', new_user_path %>\r\n```\r\n\r\nand flash message:\r\n\r\n```ruby\r\n<% flash.each do |name, msg| %>\r\n    <%= content_tag :div, msg, class: \"alert alert-info\" %>\r\n<% end %>\r\n```\r\n\r\nStep 28\r\n---------\r\n\r\nChange controller:\r\n\r\n```ruby\r\nredirect_to root_path, notice: \'Thanks for signing up\'\r\n```\r\n\r\nStep 29\r\n---------\r\n\r\n```ruby \r\nrails g controller sessions new\r\n```\r\n\r\n```ruby \r\nresources :sessions\r\n```\r\n\r\nSummary\r\n========\r\n---------\r\n\r\nIn this article, we implemented email validation and user signup driven by tests.\r\n\r\nReference\r\n========\r\n---------\r\n\r\n[has secure password Rails docs](http://api.rubyonrails.org/classes/ActiveModel/SecurePassword/ClassMethods.html \'has_secure_password Rails docs\')','2015-05-30 20:33:12','2016-12-22 21:37:17'),(2201,'Coupling Basics : Concrete Class vs Abstract Messages','Objective\r\n=========\r\n---------\r\n\r\nTo learn about depending on abstract messages instead of concrete classes to create re-usable code.\r\n\r\nSteps\r\n=========\r\n---------\r\n\r\nStep 1\r\n---------\r\n\r\nCreate copy.rb:\r\n\r\n```ruby\r\nwhile line = gets\r\n  puts line\r\nend\r\n```\r\n\r\nStep 2\r\n---------\r\n\r\nRun it.\r\n\r\n```sh\r\n$ruby copy.rb\r\n```\r\n\r\nHere is a sample run:\r\n\r\n```sh\r\nHi\r\nHi\r\nHello\r\nHello\r\n```\r\n\r\nCtrl+D to quit the program. This reads from keyboard and writes to the console.\r\n\r\nStep 3\r\n---------\r\n\r\nCreate a readme.txt file:\r\n\r\n```sh\r\nThis is the first line\r\nThis is the second line\r\n```\r\n\r\nNow run the program as follows:\r\n\r\n```sh\r\n$ruby copy.rb readme.txt\r\n```\r\n\r\nThis reads the readme.txt from the file and writes it to the console.\r\n\r\nStep 4\r\n---------\r\n\r\nCreate file_copy.rb:\r\n\r\n```ruby\r\nFile.open(\'./readme.txt\', \'r\') do |file|\r\n  while line = file.gets\r\n    puts line\r\n  end\r\nend\r\n```\r\n\r\n```\r\n$ruby file_copy.rb\r\n```\r\n\r\nThis reads the readme.txt and writes it to the console.\r\n\r\nStep 5\r\n---------\r\n\r\nCreate abstract.rb with:\r\n\r\n```ruby\r\nrequire \'stringio\'\r\n\r\nip = StringIO.new(\'This is a test\')\r\nop = StringIO.new(\'\', \'w\')\r\n\r\nip.each_line do |line|\r\n  op.puts line\r\nend\r\n\r\nprint op.string\r\n```\r\n\r\nStep 6\r\n---------\r\n\r\nThis uses StringIO a fake file system to read and write. This is good for testing. The dependency is on the message: `each_line` and puts and not on any concrete class. If there is a name of the class in the code, it creates tight coupling in the code and makes it difficult to reuse. As long as the ip and op variables can respond to the each_line and puts messages. This program will work.\r\n\r\n> Depend on messages that capture abstractions which can be varied by having different implementations.\r\n\r\nSummary\r\n========\r\n---------\r\n\r\nIn this article, we saw examples for:\r\n\r\n```sh\r\nStandard In --> Standard Out\r\nKeyboard  --> Console\r\nFile      --> Console\r\nFake File --> Fake Console\r\n```\r\n\r\nYou learned that depending on a concrete class creates tight coupling and depending on messages that can be implemented by different implementations in different class can lead to re-usable code.','2015-05-30 20:53:46','2016-04-25 03:10:55'),(2211,'Coupling Basics : Dependency Direction','Inversion of Control Principle\r\n=========\r\n---------\r\n\r\nThe Hollywood Principle is another name for Inversion of Control Principle. Hollywood Principle:\r\n\r\n> Don\'t call us, we\'ll call you.\r\n\r\nMartin Fowler says:\r\n\r\n> IoC is about who initiates the call. If your code initiates a call, it is not IoC, if the container/system/library calls back into code that you provided it, it is IoC.  \r\n\r\nExample #1 for Hollywood Principle:\r\n---------\r\n\r\n```ruby\r\nclass Car\r\n  def initialize(name)\r\n    @name = name\r\n  end\r\n  \r\n  def to_s\r\n    \"My name is #{@name}\"\r\n  end\r\nend\r\n\r\nc = Car.new(\'Tesla\')\r\n\r\nprint c\r\n```\r\n\r\nThis prints: My name is Tesla\r\n\r\nWe did not explicitly call to_s in our code. The to_s method is called by print. \r\n\r\nExample #2 for Hollywood Principle:\r\n---------\r\n\r\nIn a Rails app:\r\n\r\n```ruby\r\ndef	new\r\n  @user = User.new\r\nend\r\n```\r\n\r\nYou implement the action in the controller, the framework calls this method. You as a programmer never call the new action in your code.\r\n\r\nWhy Apply Inversion of Control?\r\n---------\r\n\r\nInversion of Control principle helps us to achieve loose coupling thereby allowing us to achieve re-use in our projects. It is one of the ways to achieve **Context Independence**.\r\n\r\nSummary\r\n=========\r\n---------\r\n\r\nIn this article you learned about the Inversion of Control Principle and examples illustrating their use. The most important take away is that Inversion of Control is about **DIRECTION** of messages and it can be used to achieve **Context Independence**.','2015-05-30 21:28:51','2015-05-30 21:36:46'),(2221,'Object Oriented Design Basics: Localized Change vs Additive Change','Objective\r\n=========\r\n---------\r\n\r\nTo learn how to eliminate conditionals and come up with a good object oriented design.\r\n\r\nSteps\r\n=========\r\n---------\r\n\r\nStep 1\r\n---------\r\n\r\nThe transformer that uses conditional:\r\n\r\n```ruby\r\nrequire \'json\'\r\n\r\nclass Transformer\r\n  def initialize(string)\r\n    @string = string\r\n  end\r\n\r\n  def transformed_string(type)\r\n    if type == :json\r\n      JSON.parse(@string)\r\n    elsif type == :binary\r\n      @string.unpack(\'B*\').first\r\n    end\r\n  end\r\nend\r\n\r\nt = Transformer.new(\'Hello\')\r\nx = t.transformed_string(:binary)\r\n\r\np x\r\n```\r\n\r\nThis prints : \"0100100001100101011011000110110001101111\"\r\n\r\nStep 2\r\n---------\r\n\r\nLet\'s eliminate the conditional in transformed_string method:\r\n\r\n```ruby\r\nrequire \'json\'\r\n\r\nclass Transformer\r\n  def initialize(string)\r\n    @string = string\r\n  end\r\n\r\n  def transformed_string(transformation)\r\n    transformation.transform(@string)\r\n  end\r\nend\r\n\r\nclass JSONTransformation\r\n  def self.transform(string)\r\n    JSON.parse(string)\r\n  end\r\nend\r\n\r\ny = Transformer.new(\'{\"foo\": \"bar\"}\').transformed_string(JSONTransformation)\r\n\r\np x\r\n```\r\n\r\nThis prints : { \"foo\" => \"bar\" }\r\n\r\nStep 3\r\n---------\r\n\r\nLet\'s now implement the binary transformation:\r\n\r\n```ruby\r\nrequire \'json\'\r\n \r\nclass Transformer\r\n  same as before\r\nend\r\n\r\nclass BinaryTransformation\r\n  def self.transform(string)\r\n    string.unpack(\'B*\').first\r\n  end\r\nend\r\n\r\nx = Transformer.new(\'Hello\').transformed_string(BinaryTransformation)\r\n\r\np x\r\n```\r\n\r\nThis prints : \"0100100001100101011011000110110001101111\"\r\n\r\nStep 4\r\n---------\r\n\r\nLet\'s change the setter dependency injection to constructor dependency injection and cleanup the code a bit:\r\n\r\n```ruby\r\nrequire \'json\'\r\n \r\nclass Transformer\r\n  def initialize(type)\r\n    @type = type\r\n  end\r\n \r\n  def transform(string)\r\n    @type.transform(string)\r\n  end\r\nend\r\n \r\nclass BinaryTransformation\r\n  def transform(string)\r\n    string.unpack(\'B*\').first\r\n  end\r\nend\r\n \r\ntransformer = Transformer.new(BinaryTransformation.new)\r\nx = transformer.transform(\'Hello\')\r\n\r\np x\r\n```\r\n\r\nThis prints : \"0100100001100101011011000110110001101111\"\r\n\r\nStep 5\r\n---------\r\n\r\nWe can implement the JSON tranformation:\r\n\r\n```ruby\r\nclass JSONTransformation\r\n def transform(string)\r\n   JSON.parse(string)\r\n end\r\nend\r\n\r\nt = Transformer.new(JSONTransformation.new)\r\ny = t.transform(\'{\"foo\": \"bar\"}\')\r\n\r\np y\r\n```\r\n\r\nStep 6\r\n---------\r\n\r\nLet\'s implement MD5 for fun:\r\n\r\n```ruby\r\nrequire \'digest\'\r\n \r\nclass MD5Transformation\r\n  def transform(string)\r\n    Digest::MD5.hexdigest string\r\n  end\r\nend\r\n \r\ns = Transformer.new(MD5Transformation.new)\r\nz = s.transform(\'Hello\')\r\n\r\np z\r\n```\r\n\r\nwe eliminated conditionals and replaced it with well-defined abstraction. We went from isolated changes to additive changes to implement new functionality. In this case trasform method.  This is the main theme of Design Patterns: Elements of Reusable Object-Oriented Software book.\r\n\r\nStep 7\r\n---------\r\n\r\nWe can do even better by replacing these anemic classes with blocks.\r\n\r\n```ruby\r\nrequire \'json\'\r\n \r\nclass Transformer\r\n \r\n  def transform(string)\r\n    yield(string)\r\n  end\r\nend\r\n \r\nbinary_transformer = ->(x) { x.unpack(\'B*\').first } \r\n \r\ntransformer = Transformer.new\r\na = transformer.transform(\'Hello\', &binary_transformer)\r\n\r\np a\r\n\r\njson_transformer = ->(y) { JSON.parse(y) }\r\n\r\nb = transformer.transform(\'{\"foo\": \"bar\"}\', &json_transformer)\r\np b\r\n\r\nrequire \'digest\'\r\n\r\nmd5transformer = ->(z) { Digest::MD5.hexdigest(z) }\r\n\r\nc = transformer.transform(\'Hello\', &md5transformer)\r\np c\r\n```\r\n\r\nSummary\r\n========\r\n---------\r\n\r\nIn this article, we used dependency injection to vary the implementation for transforming a given string. We improved the design by going from Localized Change to Additive Change. The examples used in this article is stolen from [SOLID Review: Dependency Inversion Principle](http://www.runtime-era.com/2015/04/solid-review-dependency-inversion.html \'SOLID Review: Dependency Inversion Principle\').','2015-05-31 06:36:24','2015-05-31 06:36:24'),(2231,'Availability Rake Tasks','Objective\r\n=========\r\n---------\r\n\r\nTo write useful rake tasks to manage MongoDB and Redis connectivity.\r\n\r\nSteps\r\n=========\r\n---------\r\n\r\nStep 1\r\n---------\r\n\r\nCreate mongoid.yml:\r\n\r\n```sh\r\ndevelopment:\r\n  sessions:\r\n    default:\r\n      database: blog_development\r\n      hosts:\r\n        - localhost:27017\r\n```\r\n\r\nStep 2\r\n---------\r\n\r\nHere is a rake task to create mongo development database:\r\n\r\n```ruby\r\ndesc \'Create mongo development database\'\r\nnamespace :db do\r\n  require \'mongoid\'\r\n\r\n  task :create do\r\n    Mongoid.load!(\'mongoid.yml\', :development)\r\n  end\r\n  \r\nend\r\n```\r\n\r\nStep 3\r\n---------\r\n\r\n```ruby\r\ndesc \'Check mongo development database connectivity\'\r\nnamespace :db do\r\n  require \'mongoid\'\r\n  \r\n  task :test do\r\n    session = Moped::Session.new([ \"127.0.0.1:27017\"])\r\n    session.use :blog_development\r\n    puts session.command(ping: 1)\r\n  end\r\nend\r\n```\r\n\r\nStep 4\r\n---------\r\n\r\nHere is a rake task to check redis connection:\r\n\r\n```ruby\r\ndesc \'Redis connection tester\'\r\ntask :redis do\r\n  require \"redis\"\r\n\r\n  redis = Redis.new\r\n  begin\r\n    redis.ping\r\n    puts \"Redis connection established\"\r\n  rescue Exception => e\r\n    puts e.message\r\n    puts \"Failed to establish connection to redis server\"\r\n  end\r\n  \r\nend\r\n```\r\n\r\nDiscussion\r\n=========\r\n---------\r\n\r\nIn MongoDB the database is created when you start using it. Sometimes, you need to create a database, in order to make sure that everything is setup properly. You can use the following script to force the creation of a database.\r\n\r\n```ruby\r\n  require \'date\'\r\n  require \'moped\'\r\n  \r\n  hosts = [ \"127.0.0.1:27017\" ]\r\n  database = \'bugs_bunny\'\r\n  \r\n  session = Moped::Session.new(hosts)\r\n  database = Moped::Database.new(session, database)\r\n  session.use(database)\r\n\r\n  session.with(safe: true) do |safe|\r\n    safe[:artists].insert(name: \"Bugs Bunny Calling Earth\")\r\n  end\r\n```\r\n  \r\nTo list databases:\r\n\r\n```ruby\r\nsession.databases\r\n```\r\n  or \r\n\r\n```ruby\r\nsession.databases[\'databases\']\r\n```\r\n\r\nTo list all the collections:\r\n\r\n```ruby  \r\ndatabase.collections\r\n```\r\n\r\nSummary\r\n========\r\n---------\r\n\r\nIn this article, we wrote useful rake tasks to create MongoDB database and check connectivity to MongoDB and Redis.\r\n\r\nReferences\r\n=========\r\n---------\r\n\r\n[Mongoid Getting Started](\'http://mongoid.org/en/mongoid/docs/installation.html\' \'Mongoid Getting Started\') ','2015-06-01 19:50:11','2015-06-08 20:09:41'),(2241,'Authentication from Scratch :  Password Reset Feature','Objective\r\n=========\r\n---------\r\n\r\nTo allow users to reset their password when they forget their password\r\n\r\nDiscussion\r\n=========\r\n---------\r\n\r\nTo reset a password, the user goes through these steps:\r\n\r\n1. The user requests a password reset\r\n2. An email is sent to the user with instructions\r\n3. The user verifies their identity by using the link in the email\r\n4. The user is presented with a simple form for updating the password\r\n\r\nSteps\r\n=========\r\n---------\r\n\r\nStep 1\r\n---------\r\n\r\nAdd a column called perishable_token to your table. It is a temporary string. It is used for simple identification. Generate the migration:\r\n\r\n```ruby\r\n$rails g migration add_perishable_token_to_users\r\n```\r\n\r\nStep 2\r\n---------\r\n\r\nThe migration contents:\r\n\r\n```ruby\r\nclass AddPerishableTokenToUsers < ActiveRecord::Migration\r\n  def change\r\n    add_column :users, :perishable_token, :string, :default => \"\", :null => false\r\n    add_index :users, :perishable_token\r\n  end\r\nend\r\n```\r\n\r\nStep 3\r\n---------\r\n\r\nMigrate the database:\r\n\r\n```ruby\r\n$ rake db:migrate\r\n```\r\n\r\nStep 4\r\n---------\r\n\r\n```ruby\r\n$ rails generate controller password_resets\r\n```\r\n\r\nStep 5\r\n---------\r\n\r\n```ruby\r\nclass PasswordResetsController < ApplicationController\r\n  def new\r\n    \r\n  end\r\nend\r\n```\r\n\r\nStep 6\r\n---------\r\n\r\nCreate app/views/password_resets/new.html.erb:\r\n\r\n```ruby\r\n<h1>Reset Password</h1>\r\n\r\n<p>Please enter your email address below and then click \"Reset Password\".</p>\r\n\r\n<%= form_tag password_resets_path do %>\r\n  <%= text_field_tag :email %>\r\n  <%= submit_tag \"Reset Password\" %>\r\n<% end %>\r\n```\r\n\r\nStep 7\r\n---------\r\n\r\nAdd the routes:\r\n\r\n```ruby\r\n  resources :password_resets, only: [ :new, :create]\r\n  \r\n  get \'/password_resets/edit\' => \'password_resets#edit\', as: :edit_password_reset\r\n  put \'/password_resets/\' => \'password_resets#update\', as: :password_reset\r\n```\r\n\r\nStep 8\r\n---------\r\n\r\n```sh\r\nrails s\r\n```\r\n\r\nGo to localhost:3000/password_resets/new\r\n\r\nFill out the email address and click the \'Reset Password\' button.\r\n\r\nStep 9\r\n---------\r\n\r\nAdd the create action to password_resets controller.\r\n\r\n```ruby\r\n  def create\r\n    user = User.where(email: params[:email]).first\r\n    \r\n    if user\r\n      user.deliver_password_reset_instructions\r\n      flash[:notice] = \"Instructions to reset your password have been emailed to you\"\r\n      \r\n      redirect_to root_path\r\n    else\r\n      flash.now[:error] = \"No user was found with email address #{params[:email]}\"\r\n      render :new\r\n    end\r\n  end\r\n```\r\n\r\nStep 10\r\n---------\r\n\r\nIn user.rb:\r\n\r\n```ruby\r\n  def deliver_password_reset_instructions\r\n    self.perishable_token = SecureRandom.hex(4)\r\n    save(validate: false)\r\n    \r\n    PasswordResetNotifier.password_reset_instructions(self).deliver_now\r\n  end\r\n```\r\n\r\nStep 11\r\n---------\r\n\r\nIn `app/mailers/password_reset_notifier.rb`:\r\n\r\n```ruby\r\nclass PasswordResetNotifier < ActionMailer::Base\r\n  def password_reset_instructions(user)\r\n    @url  = edit_password_reset_url(token: user.perishable_token)\r\n\r\n    mail(to: user.email, subject: \"Password Reset Instructions\")\r\n  end\r\nend\r\n```\r\n\r\nStep 12\r\n---------\r\n\r\nIn config/environments/development.rb:\r\n\r\n```ruby\r\nconfig.action_mailer.default_url_options = { :host => \'localhost:3000\' }\r\n```\r\n\r\nStep 13\r\n---------\r\n\r\nIn `app/views/password_reset_notifier/password_reset_instructions.html.erb`:\r\n\r\n```ruby\r\n<h1>Password Reset Instructions</h1>\r\n\r\n<p>\r\n  A request to reset your password has been made. If you did not make\r\n  this request, simply ignore this email. If you did make this\r\n  request, please click the link below.\r\n</p>\r\n\r\n<%= link_to \"Reset Password!\", @url %>\r\n```\r\n\r\nStep 14\r\n---------\r\n\r\nIn the terminal you see the link in the sent email. Click on that link: `http://localhost:3000/password_resets/new` \r\n\r\nStep 15\r\n---------\r\n\r\nAdd edit action to `password_resets_controller.rb`:\r\n\r\n```ruby\r\n  def edit\r\n    load_user_using_perishable_token\r\n    @token = @user.perishable_token\r\n  end\r\n  \r\n  private\r\n  \r\n  def load_user_using_perishable_token\r\n    @user = User.where(perishable_token: params[:token]).first\r\n    unless @user\r\n      flash[:error] = \"We\'re sorry, but we could not locate your account\"\r\n      redirect_to root_url\r\n    end\r\n  end\r\n```\r\n\r\nStep 16\r\n---------\r\n\r\nIn app/views/password_resets/edit.html.erb:\r\n\r\n```ruby\r\n<h1>Update your password</h1>\r\n\r\n<p>Please enter the new password below and then press \"Update Password\".</p>\r\n\r\n<%= form_tag password_reset_path, :method => :put do %>\r\n  <%= password_field_tag :password %>\r\n  <%= hidden_field_tag :token, @token %>\r\n  \r\n  <%= submit_tag \"Update Password\" %>\r\n<% end %>\r\n```\r\n\r\nStep 17\r\n---------\r\n\r\nImplement the update action in password_resets controller:\r\n\r\n```ruby\r\n  def update\r\n    load_user_using_perishable_token\r\n    @user.password = params[:password]\r\n\r\n    if @user.save\r\n      flash[:success] = \"Your password was successfully updated\"\r\n      redirect_to @user\r\n    else\r\n      render :edit\r\n    end\r\n  end\r\n```\r\n\r\nSummary\r\n========\r\n---------\r\n\r\nIn this article, we developed the password reset feature. Things that can be improved are:\r\n\r\n1. Move email delivery to a background job.\r\n2. As soon as password is reset, change the perishable_token value for that user. So that the token is one time use only.\r\n\r\nYou can download the source code for this article from : https://bitbucket.org/bparanj/ascratch.\r\n\r\nReferences\r\n=========\r\n---------\r\n\r\n[Authlogic Password Reset Tutorial](https://github.com/rejeep/authlogic-password-reset-tutorial \'Authlogic Password Reset Tutorial\')','2015-06-02 04:06:24','2016-05-04 15:57:52'),(2251,'Ruby Object Model : Develop Sinatra Clone','Objective\r\n=========\r\n---------\r\n\r\nTo apply the basics we learned in the Ruby Object Model article series to develop a Sinatra clone called Chico.\r\n\r\nSteps\r\n=========\r\n---------\r\n\r\nStep 1\r\n---------\r\n\r\n```ruby\r\nget \'/\' do\r\n  \'hi\'\r\nend\r\n```\r\n\r\nIf you run this program, you get:\r\n\r\n```sh\r\nNoMethodError: undefined method ‘get’ for main:Object\r\n```\r\n\r\nStep 2\r\n---------\r\n\r\nWe can open the Object class and define the get method:\r\n\r\n```ruby\r\nclass Object\r\n  def get(path)\r\n    yield\r\n  end\r\nend\r\n\r\nget \'/\' do\r\n  p \'hi\'\r\nend\r\n```\r\n\r\nThis prints \'hi\'.\r\n\r\nProblems\r\n=========\r\n---------\r\n\r\n1. This method is invoked immediately.\r\n2. Opening the Object class to add the get method makes it available everywhere.\r\n\r\nStep 3\r\n---------\r\n\r\nHow to mixin a method to top level?\r\n\r\n```ruby\r\nmodule Kernel\r\n    \r\n  def get(path)\r\n    yield\r\n  end\r\nend\r\n\r\nget(\'/\') do\r\n  p \'hi\'\r\nend\r\n```\r\n\r\nThis prints \'hi\'. Mixing it to the Kernel also makes the get() method available at the top level and the method gets invoked immediately. We can make the get() method private, similar to puts method we encountered in the previous articles. \r\n\r\n```ruby\r\nmodule Kernel\r\n\r\n  private\r\n      \r\n  def get(path)\r\n    yield\r\n  end\r\nend\r\n\r\nget(\'/\') do\r\n  p \'hi\'\r\nend\r\n```\r\n\r\nBut, it will not solve any of our problems.\r\n\r\nStep 4\r\n---------\r\n\r\nLet\'s write the minimal Sinatra application. Create mine.rb:\r\n\r\n```ruby\r\nrequire \'sinatra\'\r\n```\r\n\r\nYou can run it like this:\r\n\r\n```sh\r\n$ruby mine.rb\r\n```\r\n\r\nYou can see that the server runs on port 4567. You can stop the server by doing Ctrl+C.\r\n\r\nStep 5\r\n---------\r\n\r\nHow can we accomplish the same? If you read the source code for Sinatra, you will see that it uses `at_exit` hook. Let\'s use the `at_exit` hook:\r\n\r\n```ruby\r\nat_exit do \r\n  p \'Chico has taken the stage\' \r\n  begin\r\n    puts \"Press Ctrl-C to quit the server\"\r\n    loop {}\r\n  rescue Interrupt => e\r\n    puts \"Yay! The crowd applauds.\"\r\n  end\r\nend\r\n```\r\n\r\nAnother way to interrupt the Ctrl-C:\r\n\r\n```ruby\r\nSignal.trap(\'SIGNINT\') do\r\n\r\nend \r\n```\r\n\r\nThe current implementation for loop method does not do anything. We need to listen for incoming requests and call the corresponding methods defined by the developer. We will discuss it in upcoming articles.\r\n\r\nSummary\r\n========\r\n---------\r\n\r\nIn this article, we applied the Ruby Object Model basics to develop a Sinatra Clone.\r\n\r\nReference\r\n=========\r\n---------\r\n\r\n[What is the Ruby Top Level](https://banisterfiend.wordpress.com/2010/11/23/what-is-the-ruby-top-level/ \'What is the Ruby Top Level\')','2015-06-02 21:05:18','2016-02-16 06:56:26'),(2261,'Ruby Basics : Setting Environment variables','Objective\r\n=========\r\n---------\r\n\r\nTo learn about setting environment variables in your projects.\r\n\r\nSteps\r\n=========\r\n---------\r\n\r\nStep 1\r\n---------\r\n\r\nYou can set the environment variable in a terminal like this:\r\n\r\n```sh\r\n$export JUNK=\'test\'\r\n```\r\n\r\nStep 2\r\n---------\r\n\r\n In irb, you can read the value like this:\r\n\r\n```ruby\r\nENV[\'JUNK\']\r\n```\r\n\r\nStep 3\r\n---------\r\n\r\nDon\'t check for nil for the existence of environment variables.\r\n\r\n```sh\r\nENV[\'JUNK\'].nil?\r\n```\r\n\r\nStep 4\r\n---------\r\n\r\nCheck for the existence of the key in ENV hash like this:\r\n\r\n```sh\r\nENV.has_key?(\'JUNK\')\r\n```\r\n\r\nStep 5\r\n---------\r\n\r\nThis makes your conditionals in yml files easier to read. So instead of doing this:\r\n\r\n```sh\r\nENV[\'JUNK\'].nil?? ENV[\'JUNK\'] : \'dev\'\r\n```\r\n\r\nYou can do:\r\n\r\n```sh\r\nENV.has_key?(\'JUNK\')? ENV[\'JUNK\'] : \'dev\'\r\n```\r\n\r\nThis also prevents nil exceptions in your code.\r\n\r\nStep 6\r\n---------\r\n\r\nSetting environment variable values in a terminal will only last for that session. If you want to set it permanently for your production VPS, you need to add :\r\n\r\n```sh\r\nexport SECRET_API_KEY=\'very secret\'\r\n```\r\n\r\nto the `~/.profile` file.\r\n\r\nSummary\r\n========\r\n---------\r\n\r\nIn this article you learned how to set environment variables properly in your projects.','2015-06-04 02:59:45','2015-12-19 05:01:44'),(2271,'Sinatra Basics : The Current Environment','Objective\r\n=========\r\n---------\r\n\r\nTo learn about the current environment in a Sinatra app.\r\n\r\nSteps\r\n=========\r\n---------\r\n\r\nStep 1\r\n---------\r\n\r\nHere is a rake task to display the current environment in a Sinatra app.\r\n\r\n```ruby\r\ndesc \'Show the current environment\'\r\ntask :env do\r\n  require \'sinatra\'\r\n  puts Sinatra::Application.environment\r\nend\r\n```\r\n\r\nStep 2\r\n---------\r\n\r\n```sh\r\n$rake env\r\n```\r\n\r\nwill display \'development\' in development.\r\n\r\nStep 3\r\n---------\r\n\r\n```sh\r\n$export RACK_ENV=\'test\'\r\n```\r\n\r\n```sh\r\n$rake env\r\n```\r\n\r\nwill display \'test\'.\r\n\r\nStep 4\r\n---------\r\n\r\n```ruby\r\n$unset RACK_ENV\r\n```\r\n\r\nto revert back to \'development\'.\r\n\r\nStep 5\r\n---------\r\n\r\nThe quirky thing about Sinatra is if you have a file with:\r\n\r\n```ruby\r\nrequire \'sinatra\'\r\n```\r\n\r\nIt will start running a server on the terminal.\r\n\r\nStep 6\r\n---------\r\n\r\nHow to make Sinatra library programmable? Here is the trick to not let Sinatra run.\r\n\r\n```ruby\r\nrequire \'sinatra\'\r\nputs Sinatra::Application.environment\r\n\r\nat_exit do\r\n  exit\r\nend\r\n```\r\n\r\nSince Sinatra uses at_exit hook to start a server, we can over-ride it so that we exit the program once we are done with our task.\r\n\r\nExercise\r\n========\r\n---------\r\n\r\nWe were able to print the current Sinatra environment in a rake task without running a server.  How does the rake task prevent Sinatra from running the server?\r\n\r\nSummary\r\n========\r\n---------\r\n\r\nIn this article you learned about Sinatra environment and how to write a script that does not run a server when it is not required.','2015-06-05 19:10:19','2015-06-05 19:12:51'),(2281,'Object Oriented Design Basics : Open Closed Principle','Objective\r\n=========\r\n---------\r\n\r\nTo learn about Open Closed Principle\r\n\r\nDiscussion\r\n=========\r\n---------\r\n\r\nLet\'s consider the FizzBuzz problem to learn how to apply the Open Closed Principle. FizzBuzz requirements:\r\n\r\n- For multiples of 3, print Fizz\r\n- For multiples of 5, print Buzz\r\n- For multiples of 3 and 5, print FizzBuzz\r\n\r\nSteps\r\n=========\r\n---------\r\n\r\nStep 1\r\n---------\r\n\r\nDefine classes to implement the above requirements:\r\n\r\n```ruby\r\nclass Fizz \r\n  def value(n)\r\n    if n % 3 == 0\r\n      \'Fizz\'\r\n    end\r\n  end\r\nend\r\n\r\nclass Buzz\r\n  def value(n)\r\n    if n % 5 == 0\r\n      \'Buzz\'\r\n    end\r\n  end  \r\nend\r\n\r\nclass FizzBuzz\r\n  def value(n)  \r\n    if n % 15 == 0\r\n      \'FizzBuzz\'\r\n    end\r\n  end\r\nend\r\n```\r\n\r\nStep 2\r\n---------\r\n\r\nOne of the requirement is implicit, because numbers that is not multiple of 3, 5 or 15 should not be transformed. So we need a NoOp class:\r\n\r\n```ruby\r\nclass NoFizzBuzz\r\n  def value(n)\r\n    n\r\n  end\r\nend\r\n```\r\n\r\nSo far, we have the concrete classes that implement the FizzBuzz logic. Notice that we have a uniform interface value(n) that allows clients to program to an interface and not to an implementation. You will see this in action in upcoming steps.\r\n\r\nStep 3\r\n---------\r\n\r\nDefine FizzBuzzGenerator class that will delegate the FizzBuzz generation to the concrete classes.\r\n\r\n```ruby\r\nclass FizzBuzzGenerator\r\n  def initialize(objects, list)\r\n    @list = list\r\n    @objects = objects\r\n  end\r\n    \r\n  def generate\r\n    result = []\r\n    \r\n    @list.each do |num|  \r\n      @objects.each do |l|\r\n        v = l.value(num) \r\n        unless v.nil?\r\n          result << v\r\n          break\r\n        end\r\n      end\r\n    end\r\n    \r\n    result\r\n  end\r\nend\r\n```\r\n\r\nNotice that the dependency is on the message value(num). There is no dependency on the name of a class. So we don\'t have any references to Fizz, Buzz, FizzBuzz or NoFizzBuzz classes. This class is open for extension and closed for modification. This means we can add more concrete classes such as Fazz that returns multiples of 7 as Fazz, if such a new requirement arises without modifying this class and extend the functionality.\r\n\r\nStep 4\r\n---------\r\n\r\nFinally, here is the test run:\r\n\r\n```ruby\r\nobjects = [FizzBuzz.new, Fizz.new, Buzz.new, NoFizzBuzz.new]\r\n\r\ng = FizzBuzzGenerator.new(objects, (1..20).to_a)\r\nr = g.generate\r\nputs r\r\n```\r\n\r\nDiscussion\r\n=========\r\n---------\r\n\r\nThe list of concrete classes (objects), needs to change only when new concrete classes are added. Deploying new feature requires additive changes. This means we add new concrete classes and an instance of that object to the objects array. The generator class does not require any modification to the existing code. This results in a flexible and easy to maintain code base. In our solution, notice that we don\'t have any if-else-elsif statements. If your solution used if-else-elsif then it would require Localized Changes and it would not be Additive Change.\r\n\r\nThere is a subtle dependency between the FizzBuzzGenerator class and the order of the objects in the test run code. The correct generation of the FizzBuzz sequence depends on the order of objects. This is a quick-and-dirty implementation of Chain of Responsibility pattern. However this example was chosen to illustrate the Open Closed Principle. If the concrete classes have business logic that can be implemented by passing through a chain of handlers independent of the order in which they are executed, this solution would shine. Because, in that case, there would be no dependency on the order of the handlers in the objects array.\r\n\r\nExercise\r\n========\r\n--------\r\n\r\nIn order to understand the concepts explained in this article, implement the feature where you must print Fuzz for multiples of 7. What are the changes required to satisfy the requirement?\r\n\r\nSummary\r\n========\r\n---------\r\n\r\nIn this article, you learned about the Open Closed Principle and how to apply it by working through a FizzBuzz example. ','2015-06-08 19:10:47','2015-06-08 19:41:22'),(2291,'Chef Solo Basics : Hello World','Objective\r\n=========\r\n---------\r\n\r\nTo write a simple hello world program using Chef Solo.\r\n\r\nDiscussion\r\n=========\r\n---------\r\n\r\nI was looking for an infrastructure automation tools for provisioning Rails stack on Linode. I considered Moonshine, Ansible and Chef. Even though it is a nightmare to learn about Chef Solo, I have decided to learn it so that I have more control over the upgrade of the software on the servers.\r\n\r\nSteps\r\n=========\r\n---------\r\n\r\nStep 1\r\n---------\r\n\r\nInstall chef. \r\n\r\n```sh\r\n$curl -s -L https://www.getchef.com/chef/install.sh | sudo bash\r\n```\r\n\r\nStep 2\r\n---------\r\n\r\nVerify installation. \r\n\r\n```sh\r\n$chef-apply -v\r\n```\r\n\r\nStep 3\r\n---------\r\n\r\n```sh\r\n$mkdir first\r\n```\r\n\r\nCreate a file first/hello_world.rb:\r\n\r\n```ruby\r\nfile \'/tmp/helloworld.txt\' do\r\n  content \'hello world\'\r\nend\r\n```\r\n\r\nStep 4\r\n---------\r\n\r\n```sh\r\n$chef-apply hello_world.rb\r\n/Users/bparanj/.rvm/gems/ruby-2.2.2@chef/gems/chef-11.16.0/lib/chef/data_bag_item.rb:161: warning: circular argument reference - data_bag\r\nRecipe: (chef-apply cookbook)::(chef-apply recipe)\r\n  * file[/tmp/helloworld.txt] action create\r\n    - create new file /tmp/helloworld.txt[2015-06-11T14:49:29-07:00] WARN: Could not set gid = 0 on /var/folders/vd/462f2l5s6jg5_zp2hs7vtmj40000gn/T/.helloworld.txt20150611-59562-ua2vqn, file modes not preserved\r\n\r\n    - update content in file /tmp/helloworld.txt from none to b94d27\r\n    --- /tmp/helloworld.txt	2015-06-11 14:49:29.000000000 -0700\r\n    +++ /var/folders/vd/462f2l5s6jg5_zp2hs7vtmj40000gn/T/.helloworld.txt20150611-59562-ua2vqn	2015-06-11 14:49:29.000000000 -0700\r\n    @@ -1 +1,2 @@\r\n    +hello world\r\n```\r\n\r\nStep 5\r\n---------\r\n\r\n```sh\r\n$cat /tmp/helloworld.txt \r\nhello world\r\n```\r\n\r\nStep 6\r\n---------\r\n\r\n```sh\r\n$chef-apply hello_world.rb\r\n/Users/bparanj/.rvm/gems/ruby-2.2.2@chef/gems/chef-11.16.0/lib/chef/data_bag_item.rb:161: warning: circular argument reference - data_bag\r\n\r\nRecipe: (chef-apply cookbook)::(chef-apply recipe)\r\n  * file[/tmp/helloworld.txt] action create (up to date)\r\n```\r\n\r\nStep 7\r\n---------\r\n\r\n```sh\r\n$~/projects/mys3/first $rm /tmp/helloworld.txt \r\n```\r\n\r\nStep 8\r\n---------\r\n\r\n```sh\r\n$chef-apply hello_world.rb\r\n/Users/bparanj/.rvm/gems/ruby-2.2.2@chef/gems/chef-11.16.0/lib/chef/data_bag_item.rb:161: warning: circular argument reference - data_bag\r\nRecipe: (chef-apply cookbook)::(chef-apply recipe)\r\n  * file[/tmp/helloworld.txt] action create\r\n    - create new file /tmp/helloworld.txt[2015-06-11T14:52:16-07:00] WARN: Could not set gid = 0 on /var/folders/vd/462f2l5s6jg5_zp2hs7vtmj40000gn/T/.helloworld.txt20150611-59805-53vak7, file modes not preserved\r\n\r\n    - update content in file /tmp/helloworld.txt from none to b94d27\r\n    --- /tmp/helloworld.txt	2015-06-11 14:52:16.000000000 -0700\r\n    +++ /var/folders/vd/462f2l5s6jg5_zp2hs7vtmj40000gn/T/.helloworld.txt20150611-59805-53vak7	2015-06-11 14:52:16.000000000 -0700\r\n    @@ -1 +1,2 @@\r\n    +hello world\r\n```\r\n\r\nStep 9\r\n---------\r\n\r\n```sh\r\n$echo \'wrong contents in the file\' >> /tmp/helloworld.txt \r\n~/projects/mys3/first $cat /tmp/helloworld.txt \r\nhello worldwrong contents in the file\r\n```\r\n\r\nStep 10\r\n---------\r\n\r\n```sh\r\n$chef-apply hello_world.rb\r\n/Users/bparanj/.rvm/gems/ruby-2.2.2@chef/gems/chef-11.16.0/lib/chef/data_bag_item.rb:161: warning: circular argument reference - data_bag\r\n\r\nRecipe: (chef-apply cookbook)::(chef-apply recipe)\r\n  * file[/tmp/helloworld.txt] action create\r\n    - update content in file /tmp/helloworld.txt from 59b2ba to b94d27\r\n    --- /tmp/helloworld.txt	2015-06-11 14:56:00.000000000 -0700\r\n    +++ /var/folders/vd/462f2l5s6jg5_zp2hs7vtmj40000gn/T/.helloworld.txt20150611-59932-1j2pg4y	2015-06-11 14:56:32.000000000 -0700\r\n    @@ -1,2 +1,2 @@\r\n    -hello worldwrong contents in the file\r\n    +hello world\r\n```\r\n\r\nStep 11\r\n---------\r\n\r\n```sh\r\n$cat /tmp/helloworld.txt \r\nhello world\r\n```\r\n\r\nSummary\r\n========\r\n---------\r\n\r\nIn this article, we wrote a simple hello world program in Chef Solo and learned how Chef Solo works by creating a simple script to create a file with given contents.\r\n\r\nReference:\r\n========\r\n---------\r\n\r\n[Chef Chapter 1](http://chefiseasy.com/2014/02/24/chapter-01/ \'Chef Chapter 1\')','2015-06-12 00:10:10','2015-06-12 00:10:10'),(2301,'Chef Solo Basics : Simple Recipe using Chef Solo and Vagrant','Objective\r\n=========\r\n---------\r\n\r\nTo learn how to use a simple recipe that is run in a VM using Vagrant and Chef Solo.\r\n\r\nDiscussion\r\n=========\r\n---------\r\n\r\nIn the previous article, we wrote a simple hello world program that created a file with the contents \'hello world\' on the local machine. We are now going to use the same recipe but it will be executed in a VM.\r\n\r\nSteps\r\n=========\r\n---------\r\n\r\nStep 1\r\n---------\r\n\r\nCreate a new project folder. My folder is named third.\r\n\r\nStep 2\r\n---------\r\n\r\nCreate a Vagrantfile:\r\n\r\n```sh\r\nVAGRANTFILE_API_VERSION = \"2\"\r\n\r\nVagrant.configure(VAGRANTFILE_API_VERSION) do |config|\r\n  config.vm.box = \"ubuntu/trusty64\"\r\nend\r\n```\r\n\r\nStep 3\r\n---------\r\n\r\n```sh\r\n$vagrant up\r\n$vagrant ssh\r\n```\r\n\r\nTo stop: vagrant halt. To destroy: vagrant destroy\r\n\r\nStep 4\r\n---------\r\n\r\nCreate cookbooks directory in your project folder.\r\n\r\nStep 5\r\n---------\r\n\r\nChange Vagrantfile:\r\n\r\n```ruby\r\nVAGRANTFILE_API_VERSION = \"2\"\r\n\r\nVagrant.configure(VAGRANTFILE_API_VERSION) do |config|\r\n  config.vm.box = \"ubuntu/trusty64\"\r\n\r\n  config.vm.provision :chef_solo do |chef|\r\n    chef.add_recipe \"mfweb\"\r\n  end\r\nend\r\n```\r\n\r\nStep 6\r\n---------\r\n\r\nCreate the folder structure:\r\n\r\n```sh\r\ncookbooks\r\n└── mfweb\r\n    └── recipes\r\n        └── default.rb\r\n```\r\n\r\nStep 7\r\n---------\r\n\r\nIf we want the file \"hello.txt\" to appear in /home/vagrant. We need the following fragment in the recipe file (cookbooks/recipes/default.rb):\r\n\r\n```ruby\r\nfile \"/home/vagrant/hello.txt\" do\r\n  content \"hello world\"\r\nend\r\n```\r\n\r\nStep 8\r\n---------\r\n\r\nRun \r\n\r\n```sh\r\n$vagrant halt\r\n```\r\nif your VM is still running. Then:\r\n\r\n```sh\r\n$vagrant up\r\n```\r\n\r\nStep 9\r\n---------\r\n\r\n```sh\r\n$vagrant ssh\r\n```\r\n\r\nCheck the contents of the file.\r\n\r\n```sh\r\nvagrant@vagrant-ubuntu-trusty-64:~$ cat hello.txt\r\nhello world\r\n```\r\n\r\nSummary\r\n========\r\n---------\r\n\r\nIn this article, we wrote a simple recipe to create a file in the VM using Chef Solo and Vagrant.\r\n\r\nReference\r\n========\r\n---------\r\n\r\n[Vagrant Chef Rbenv](http://martinfowler.com/articles/vagrant-chef-rbenv.html \'Vagrant Chef Rbenv\')','2015-06-12 00:29:35','2015-06-17 07:40:01'),(2311,'Chef Solo Basics : Installing a Package','Objective\r\n=========\r\n---------\r\n\r\nTo install Nodejs in a VM using Chef Solo and Vagrant.\r\n\r\nSteps\r\n=========\r\n---------\r\n\r\nStep 1\r\n---------\r\n\r\nCreate the following directory structure:\r\n\r\n```sh\r\ncookbooks\r\n└── nodejs\r\n    └── recipes\r\n        └── default.rb\r\n```\r\n\r\n\r\nStep 2\r\n---------\r\n\r\nEdit the default.rb:\r\n\r\n```ruby\r\npackage \"nodejs\"\r\n```\r\n\r\nStep 3\r\n---------\r\n\r\nCreate Vagrantfile in the project root. \r\n\r\n```ruby\r\nVAGRANTFILE_API_VERSION = \"2\"\r\n\r\nVagrant.configure(VAGRANTFILE_API_VERSION) do |config|\r\n  config.vm.box = \"ubuntu/trusty64\"\r\n\r\n  config.vm.provision :chef_solo do |chef|\r\n    chef.add_recipe \"nodejs\"\r\n  end\r\nend\r\n```\r\n\r\nStep 4\r\n---------\r\n\r\n```sh\r\n$ vagrant up\r\n```\r\nThe output shows that nodejs gets installed.\r\n\r\n```\r\n==> default: [2015-06-12T01:12:02+00:00] INFO: Forking chef instance to converge...\r\n==> default: [2015-06-12T01:12:02+00:00] INFO: *** Chef 12.3.0 ***\r\n==> default: [2015-06-12T01:12:02+00:00] INFO: Chef-client pid: 2435\r\n==> default: [2015-06-12T01:12:09+00:00] INFO: Setting the run_list to [\"recipe[nodejs]\"] from CLI options\r\n==> default: [2015-06-12T01:12:09+00:00] INFO: Run List is [recipe[nodejs]]\r\n==> default: [2015-06-12T01:12:09+00:00] INFO: Run List expands to [nodejs]\r\n==> default: [2015-06-12T01:12:09+00:00] INFO: Starting Chef Run for vagrant-ubuntu-trusty-64\r\n==> default: [2015-06-12T01:12:09+00:00] INFO: Running start handlers\r\n==> default: [2015-06-12T01:12:09+00:00] INFO: Start handlers complete.\r\n==> default: [2015-06-12T01:12:26+00:00] INFO: apt_package[nodejs] installed nodejs at 0.10.25~dfsg2-2ubuntu1\r\n==> default: [2015-06-12T01:12:26+00:00] INFO: Chef Run complete in 17.11639021 seconds\r\n==> default: [2015-06-12T01:12:26+00:00] INFO: Skipping removal of unused files from the cache\r\n==> default: [2015-06-12T01:12:26+00:00] INFO: Running report handlers\r\n==> default: [2015-06-12T01:12:26+00:00] INFO: Report handlers complete\r\n```\r\n\r\nStep 5\r\n---------\r\n\r\nCheck the installed nodejs in the VM.\r\n\r\n```sh\r\n$ vagrant ssh\r\n$ nodejs --version\r\n\r\nv0.10.25\r\n```\r\n\r\nSummary\r\n========\r\n---------\r\n\r\nIn this article, we created a simple reciple that install nodejs on the VM using Chef Solo and Vagrant.','2015-06-12 01:19:36','2015-06-12 01:21:37'),(2321,'Chef Solo Basics : Developer Notes','Objective\r\n=========\r\n---------\r\n\r\nTo learn the basic Chef concepts using Chef Solo in Ubuntu 12.04.5 LTS.\r\n\r\nSteps\r\n=========\r\n---------\r\n\r\nStep 1\r\n---------\r\n\r\n```sh\r\ncat /etc/lsb-release\r\n```\r\n\r\nStep 2\r\n---------\r\n\r\n```sh\r\nchef-solo -v\r\n```\r\n\r\nStep 3\r\n---------\r\n\r\n```sh\r\nsudo su\r\n```\r\n\r\nStep 4\r\n---------\r\n\r\n```sh\r\ncurl -L https://www.opscode.com/chef/install.sh | bash\r\n```\r\n\r\nStep 5\r\n---------\r\n\r\n```sh\r\nchef-solo -v\r\n```\r\n\r\nThe Chef version installed on my Ubuntu VM is 12.3.\r\n\r\nStep 6\r\n---------\r\n\r\n```sh\r\n$mkdir /etc/chef\r\n$cd /etc/chef\r\n$vi solo.rb\r\n```\r\n\r\nAdd:\r\n\r\n```ruby\r\nrepo = \'/etc/chef/src\'\r\n\r\ncookbook_path repo + \'/cookbooks\'\r\ndata_bag_path repo + \'/data_bags\'\r\nrole_path     repo + \'/roles\'\r\n\r\nlog_level :info\r\nlog_location STDOUT\r\n```\r\n\r\nRun:\r\n\r\n```sh\r\ncat solo.rb\r\n```\r\n\r\nStep 7\r\n---------\r\n\r\n```sh\r\nmkdir src\r\ncd src/\r\nmkdir cookbooks data_bags roles\r\ncd cookbooks\r\nmkdir common\r\ncd common\r\nmkdir recipes\r\n```\r\n\r\nStep 8\r\n---------\r\n\r\n```sh\r\ncd recipes\r\nvi default.rb\r\n```\r\n\r\nAdd:\r\n\r\n```ruby\r\ndirectory \'/root\' do\r\n  mode \'0700\'\r\n  user \'root\'\r\n  group \'root\'\r\nend\r\n```\r\n\r\nStep 9\r\n---------\r\n\r\n```sh\r\nchef-solo -o \'recipe[common]\'\r\nchmod 760 /root\r\nchef-solo -o \'recipe[common]\'\r\n```\r\n\r\nStep 10\r\n---------\r\n\r\n```sh\r\ncat /etc/motd\r\n```\r\n\r\nGo to chef/src/cookbooks/common directory\r\n\r\n```sh\r\n$mkdir -p files/default\r\n$vi files/default/motd\r\n```\r\n\r\nAdd :\r\n\r\nThis is a test.\r\n\r\nStep 11\r\n---------\r\n\r\n```sh\r\nvi recipes/default.rb \r\n```\r\n\r\nAdd the following to the bottom of the file.\r\n\r\n```ruby\r\ncookbook_file \'/etc/motd\' do\r\n  mode \'0644\'\r\n  user \'root\'\r\n  group \'root\'\r\nend\r\n```\r\n\r\nRun:\r\n\r\n```sh\r\ncat recipes/default.rb\r\n```\r\n\r\nStep 12\r\n---------\r\n\r\n```sh\r\n$chef-solo -o \'recipe[common]\'\r\n$cat /etc/motd\r\n```\r\n\r\nStep 13\r\n---------\r\n\r\n```sh\r\nvi recipes/packages.rb\r\n```\r\n\r\nAdd:\r\n\r\n```ruby\r\npackage \'whoopsie\' do\r\n  action :remove\r\nend\r\n```\r\n\r\nRun:\r\n\r\n```sh\r\n$chef-solo -o \'recipe[common::packages]\'\r\n```\r\n\r\nStep 14\r\n---------\r\n\r\n```sh\r\nvi recipes/default.rb\r\n```\r\n\r\nAdd:\r\n\r\n```ruby\r\ninclude_recipe \'common::packages\'\r\n```\r\n\r\nat the top\r\n\r\n```sh\r\nchef-solo -o \'recipe[common]\'\r\n```\r\n\r\nStep 15\r\n---------\r\n\r\n```sh\r\nrm /etc/motd\r\nchef-solo -o \'recipe[common]\'\r\n```\r\n\r\nStep 16\r\n---------\r\n\r\n```sh\r\ndpkg -l | grep landsca\r\nvi recipes/packages.rb\r\n```\r\n\r\nAdd:\r\n\r\n```ruby\r\npackage \'landscape-client-ui-install\' do\r\n  action :remove\r\nend\r\n```\r\n\r\nRun:\r\n\r\n```sh\r\nchef-solo -o \'recipe[common]\'\r\n```\r\n\r\nStep 17\r\n---------\r\n\r\n```sh\r\nruby -v\r\nvi recipes/packages.rb\r\n```\r\n\r\nAdd:\r\n\r\n```ruby\r\npackage \'ruby1.9.1\'\r\n```\r\n\r\nRun:\r\n\r\n```sh\r\nchef-solo -o \'recipe[common]\'\r\nruby -v\r\napt-get install whoopsie\r\nchef-solo -o \'recipe[common]\'\r\ndpkg -l | grep ruby\r\n```\r\n\r\nStep 18\r\n---------\r\n\r\n```sh\r\ncd ..\r\nmkdir apache\r\ncd apache\r\nmkdir attributes\r\nmkdir templates\r\nmkdir recipes\r\nmkdir templates/default\r\nvi attributes/default.rb\r\n```\r\n\r\nAdd:\r\n\r\n```ruby\r\nnode.default[\'apache\'][\'srvlimit\'] = 128\r\n```\r\n\r\nEdit:\r\n\r\n```sh\r\nvi recipes/default.rb\r\n```\r\n\r\nAdd:\r\n\r\n```ruby\r\nlog node[\'apache\'][\'srvlimit\']\r\n\r\ncat attributes/default.rb\r\ncat recipes/default.rb\r\n```\r\n\r\nStep 19\r\n---------\r\n\r\n```sh\r\nchef-solo -o \'recipe[apache]\'\r\n\r\nvi recipes/default.rb\r\n```\r\n\r\nAdd:\r\n\r\n```ruby\r\npackage \'apache2\'\r\n\r\nservice \'apache2\' do\r\n  action :start\r\nend\r\n```\r\n\r\nRun:\r\n\r\n```sh\r\nchef-solo -o \'recipe[apache]\'\r\n```\r\n\r\n```sh\r\nservice apache2 stop\r\n```\r\n\r\n```sh\r\nchef-solo -o \'recipe[apache]\'\r\n```\r\n\r\nStep 20\r\n---------\r\n\r\n```sh\r\nvi templates/default/serverlimit.conf.erb\r\n```\r\n\r\nAdd:\r\n\r\n```ruby\r\nServerLimit <%= node[\'apache\'][\'srvlimit\'] %>\r\nMaxClients <%= node[\'apache\'][\'srvlimit\'] %>\r\n```\r\n\r\nEdit:\r\n\r\n```sh\r\nvi recipes/default.rb\r\n```\r\n\r\nAdd:\r\n\r\n```ruby\r\ntemplate \'/etc/apache2/conf.d/serverlimit.conf\' do\r\n  mode \'0644\'\r\n  user \'root\'\r\n  group \'root\'\r\n  notifies :restart, \'service[apache2]\'\r\nend\r\n```\r\n\r\nStep 21\r\n---------\r\n\r\n```sh\r\nchef-solo -o \'recipe[apache]\'\r\n\r\ncat /etc/apache2/conf.d/serverlimit.conf\r\n\r\necho bidon > /etc/apache2/conf.d/serverlimit.conf\r\n\r\ncat /etc/apache2/conf.d/serverlimit.conf\r\n\r\nchef-solo -o \'recipe[apache]\'\r\n\r\ncat /etc/apache2/conf.d/serverlimit.conf\r\n```\r\n\r\nStep 22\r\n---------\r\n\r\nGo to src directory.\r\n\r\n```sh\r\ncd roles\r\nvi webpetit.rb\r\n```\r\n\r\nAdd:\r\n\r\n```ruby\r\ndefault_attributes(\r\n \'apache\' => {\r\n   \'srvlimit\' => 64\r\n }\r\n )\r\n\r\nrun_list(\r\n  \'recipe[common]\',\r\n  \'recipe[apache]\'\r\n)\r\n```\r\n\r\nRun:\r\n\r\n```sh\r\nchef-solo -o \'role[webpetit]\'\r\n```\r\n\r\nStep 23\r\n---------\r\n\r\n```sh\r\ncp webpetit.rb webgros.rb\r\nvi webgros.rb\r\n```\r\n\r\nAdd:\r\n\r\n```ruby\r\ndefault_attributes(\r\n  \'apache\' => {\r\n    \'srvlimit\' => 1024\r\n  }\r\n)\r\n\r\nrun_list(\r\n \'recipe[common]\',\r\n \'recipe[apache]\'\r\n)\r\n```\r\n\r\nRun:\r\n\r\n```sh\r\n$chef-solo -o \'role[webgros]\'\r\n```\r\n\r\nSummary\r\n========\r\n---------\r\n\r\nIn this article, you learned some of the basic concepts about Chef Solo.\r\n\r\nReference\r\n========\r\n---------\r\n\r\n[Chef Tutorial on Ubuntu Linux](https://www.youtube.com/watch?v=13CqboU0ijI \'Chef Tutorial on Ubuntu Linux\')','2015-06-13 01:46:58','2015-06-13 01:54:53'),(2331,'Ruby Gem Basics : Pimp My Anagram','Objective\r\n=========\r\n---------\r\n\r\nTo build a ruby gem from scratch.\r\n\r\nDiscussion\r\n=========\r\n---------\r\n\r\nI had problems getting the anagram example explained in the Programming Ruby book by Pragmatic Programmers to work. I had to download the gem file and make some modifications to get the code working. This article summarizes the steps required to get this program working. It also resolved my WTF moment on how the runner was getting loaded when you run the command line interface program. Read the book for explanation about each step. I will only explain things that are not clear in the book. I am using Ruby 2.2.2.\r\n\r\nSteps\r\n=========\r\n---------\r\n\r\nStep 1\r\n---------\r\n\r\n```sh\r\nanagram      <-- Top Level\r\n  |___ bin   <-- Command Line Interface\r\n  |___ lib   <-- Library files\r\n  |___ test  <-- Test files\r\n```\r\n  \r\nStep 2\r\n---------\r\n\r\n```sh\r\nanagram       \r\n  |___ bin/anagram\r\n  			\r\n  |___ lib/anagram\r\n  	   	     finder.rb\r\n			 options.rb\r\n			 runner.rb\r\n  |___ test  \r\n		test files\r\n```\r\n\r\nStep 3\r\n---------\r\n\r\nCreate lib/anagram/options.rb:\r\n\r\n```ruby\r\nrequire \'optparse\'\r\n\r\nmodule Anagram\r\n  class Options\r\n     \r\n    DEFAULT_DICTIONARY = \"/usr/share/dict/words\"\r\n    \r\n    attr_reader :dictionary\r\n    attr_reader :words_to_find\r\n    \r\n    def initialize(argv)\r\n      @dictionary = DEFAULT_DICTIONARY\r\n      parse(argv) \r\n      @words_to_find = argv\r\n    end\r\n                 \r\n  private\r\n    \r\n    def parse(argv)\r\n      OptionParser.new do |opts|  \r\n        opts.banner = \"Usage:  anagram [ options ]  word...\"\r\n\r\n        opts.on(\"-d\", \"--dict path\", String, \"Path to dictionary\") do |dict|\r\n          @dictionary = dict\r\n        end \r\n\r\n        opts.on(\"-h\", \"--help\", \"Show this message\") do\r\n          puts opts\r\n          exit\r\n        end\r\n\r\n        begin\r\n          argv = [\"-h\"] if argv.empty?\r\n          opts.parse!(argv)\r\n        rescue OptionParser::ParseError => e\r\n          STDERR.puts e.message, \"\\n\", opts\r\n          exit(-1)\r\n        end\r\n      end    \r\n    end\r\n  end\r\nend\r\n```\r\n\r\nStep 4\r\n---------\r\n\r\nCreate test/test_options.rb:\r\n\r\n```ruby\r\nrequire \'test/unit\'\r\nrequire \'shoulda\'\r\nrequire_relative \'../lib/anagram/options\'\r\n\r\nclass TestOptions < Test::Unit::TestCase\r\n\r\n  context \"specifying no dictionary\" do\r\n    should \"return default\" do\r\n      opts = Anagram::Options.new([\"someword\"])\r\n      assert_equal Anagram::Options::DEFAULT_DICTIONARY, opts.dictionary\r\n    end\r\n  end\r\n\r\n  context \"specifying a dictionary\" do\r\n    should \"return it\" do\r\n      opts = Anagram::Options.new([\"-d\", \"mydict\", \"someword\"])\r\n      assert_equal \"mydict\", opts.dictionary\r\n    end\r\n  end\r\n\r\n  context \"specifying words and no dictionary\" do\r\n    should \"return the words\" do\r\n      opts = Anagram::Options.new([\"word1\", \"word2\"])\r\n\r\n      assert_equal [\"word1\", \"word2\"], opts.words_to_find\r\n    end\r\n  end\r\n\r\n  context \"specifying words and a dictionary\" do\r\n    should \"return the words\" do\r\n      opts = Anagram::Options.new([\"-d\", \"mydict\", \"word1\", \"word2\"])\r\n\r\n      assert_equal [\"word1\", \"word2\"], opts.words_to_find\r\n    end\r\n  end\r\n\r\nend\r\n```\r\n\r\nStep 5\r\n---------\r\n\r\n```sh\r\n$ ruby test/test_options.rb\r\n```\r\n\r\nStep 6\r\n---------\r\n\r\nCreate anagram/lib/anagram/finder.rb:\r\n\r\n```ruby\r\nmodule Anagram\r\n  class Finder\r\n\r\n    def self.from_file(file_name)\r\n      new(File.readlines(file_name))\r\n    end\r\n\r\n    def initialize(dictionary_words)\r\n      @signatures = Hash.new\r\n\r\n      dictionary_words.each do |line|\r\n        word = line.chomp\r\n        signature = Finder.signature_of(word)\r\n        (@signatures[signature] ||= []) << word\r\n      end\r\n    end\r\n\r\n    def lookup(word)\r\n      signature = Finder.signature_of(word)\r\n      @signatures[signature]\r\n    end\r\n\r\n    def self.signature_of(word)\r\n      word.unpack(\"c*\").sort.pack(\"c*\")\r\n    end\r\n  end\r\n  \r\nend\r\n```\r\n\r\nStep 7\r\n---------\r\n\r\nCreate anagram/test/test_finder.rb\r\n\r\n```ruby\r\nrequire \'test/unit\'\r\nrequire \'shoulda\'\r\nrequire_relative \'../lib/anagram/finder\'\r\n\r\nclass TestFinder < Test::Unit::TestCase\r\n\r\n  context \"signature\" do\r\n    { \"cat\" => \"act\", \"act\" => \"act\", \"wombat\" => \"abmotw\" }.each do |word, signature|\r\n      should \"be #{signature} for #{word}\" do\r\n        assert_equal signature, Anagram::Finder.signature_of(word)\r\n      end\r\n    end\r\n  end\r\n\r\n  context \"lookup\" do\r\n    setup do\r\n      @finder = Anagram::Finder.new([\"cat\", \"wombat\"])\r\n    end\r\n\r\n    should \"return word if word given\" do\r\n      assert_equal [\"cat\"], @finder.lookup(\"cat\")\r\n    end\r\n\r\n    should \"return word if anagram given\" do\r\n      assert_equal [\"cat\"], @finder.lookup(\"act\")\r\n      assert_equal [\"cat\"], @finder.lookup(\"tca\")\r\n    end\r\n\r\n    should \"return nil if no word matches anagram\" do\r\n      assert_nil @finder.lookup(\"wibble\")\r\n    end\r\n  end\r\n  \r\nend\r\n```\r\n\r\nStep 8\r\n---------\r\n\r\n```sh\r\n$ ruby test/test_options.rb\r\n```\r\n\r\nStep 9\r\n---------\r\n\r\n```sh\r\n$ which ruby \r\n```\r\n\r\nCreate a file anagram/bin/anagram. Copy the output from the above command to the top of this file like this:\r\n\r\n```sh\r\n#! /Users/zepho/.rvm/rubies/ruby-2.2.2/bin/ruby\r\nrequire \'anagram/runner\'\r\n\r\nrunner = Anagram::Runner.new(ARGV)\r\nrunner.run\r\n```\r\n\r\nI am using RVM. It automatically sets the proper ruby version for ruby in `/usr/bin/env` depending on your gemset. \r\n\r\n```sh\r\n$ /usr/bin/env ruby -v\r\nruby 2.2.4p230 (2015-12-16 revision 53155) [x86_64-darwin11.0]\r\n```\r\n\r\nIn that case, you can add this:\r\n\r\n```sh\r\n#!/usr/bin/env ruby\r\n```\r\nStep 10\r\n---------\r\n\r\n```ruby\r\nrequire_relative \'finder\'\r\nrequire_relative \'options\'\r\n\r\nmodule Anagram\r\n  class Runner\r\n\r\n    def initialize(argv)\r\n      @options = Options.new(argv)\r\n    end\r\n    \r\n    def run\r\n      finder = Finder.from_file(@options.dictionary)\r\n\r\n      @options.words_to_find.each do |word|\r\n        anagrams = finder.lookup(word)\r\n\r\n        if anagrams\r\n          puts \"Anagrams of #{word}: #{anagrams.join(\', \')}\"\r\n        else\r\n          puts \"No anagrams of #{word} in #{@options.dictionary}\"\r\n        end\r\n      end\r\n    end\r\n    \r\n  end\r\nend\r\n```\r\n\r\nStep 11\r\n---------\r\n\r\n```sh\r\nruby test/test_finder.rb\r\n```\r\n\r\nStep 12\r\n---------\r\n\r\n```sh\r\nruby -I lib bin/anagram teaching code\r\n\r\nAnagrams of teaching: cheating, teaching\r\nAnagrams of code: code, coed\r\n```\r\n\r\nDiscussion\r\n========\r\n---------\r\n\r\nUsing the switch, -I directory loads the lib directory to the `$LOAD_PATH`, this is the reason that anagram in the bin directory is able to find the Anagram::Runner class. Let\'s look at the `$LOAD_PATH` for the gem.\r\n\r\n```sh\r\n$ bundle console\r\nResolving dependencies...\r\n2.2.4 :001 > $LOAD_PATH\r\n => [\"/Users/zepho/.rvm/gems/ruby-2.2.4@racks/gems/rspec-3.4.0/lib\", \"/Users/zepho/.rvm/gems/ruby-2.2.4@racks/gems/rspec-mocks-3.4.0/lib\", \"/Users/zepho/.rvm/gems/ruby-2.2.4@racks/gems/rspec-expectations-3.4.0/lib\", \"/Users/zepho/.rvm/gems/ruby-2.2.4@racks/gems/rspec-core-3.4.1/lib\", \"/Users/zepho/.rvm/gems/ruby-2.2.4@racks/gems/rspec-support-3.4.1/lib\", \"/Users/zepho/.rvm/gems/ruby-2.2.4@racks/gems/diff-lcs-1.2.5/lib\", \"/Users/zepho/.rvm/gems/ruby-2.2.4@racks/gems/lyon-0.1.0/lib\", \"/Users/zepho/.rvm/rubies/ruby-2.2.4/lib/ruby/gems/2.2.0/gems/rake-10.4.2/lib\", \"/Users/zepho/temp/racks/bird/lib\", \"/Users/zepho/.rvm/gems/ruby-2.2.4@racks/gems/bundler-1.11.2/lib\", \"/Users/zepho/.rvm/rubies/ruby-2.2.4/lib/ruby/site_ruby/2.2.0\", \"/Users/zepho/.rvm/rubies/ruby-2.2.4/lib/ruby/site_ruby/2.2.0/x86_64-darwin11.0\", \"/Users/zepho/.rvm/rubies/ruby-2.2.4/lib/ruby/site_ruby\", \"/Users/zepho/.rvm/rubies/ruby-2.2.4/lib/ruby/vendor_ruby/2.2.0\", \"/Users/zepho/.rvm/rubies/ruby-2.2.4/lib/ruby/vendor_ruby/2.2.0/x86_64-darwin11.0\", \"/Users/zepho/.rvm/rubies/ruby-2.2.4/lib/ruby/vendor_ruby\", \"/Users/zepho/.rvm/rubies/ruby-2.2.4/lib/ruby/2.2.0\", \"/Users/zepho/.rvm/rubies/ruby-2.2.4/lib/ruby/2.2.0/x86_64-darwin11.0\"] \r\n```\r\n\r\nLet\'s look at the `$LOAD_PATH` from the irb terminal:\r\n\r\n```sh\r\n$ irb\r\n2.2.4 :001 > $LOAD_PATH\r\n => [\"/Users/zepho/.rvm/rubies/ruby-2.2.4/lib/ruby/site_ruby/2.2.0\", \"/Users/zepho/.rvm/rubies/ruby-2.2.4/lib/ruby/site_ruby/2.2.0/x86_64-darwin11.0\", \"/Users/zepho/.rvm/rubies/ruby-2.2.4/lib/ruby/site_ruby\", \"/Users/zepho/.rvm/rubies/ruby-2.2.4/lib/ruby/vendor_ruby/2.2.0\", \"/Users/zepho/.rvm/rubies/ruby-2.2.4/lib/ruby/vendor_ruby/2.2.0/x86_64-darwin11.0\", \"/Users/zepho/.rvm/rubies/ruby-2.2.4/lib/ruby/vendor_ruby\", \"/Users/zepho/.rvm/rubies/ruby-2.2.4/lib/ruby/2.2.0\", \"/Users/zepho/.rvm/rubies/ruby-2.2.4/lib/ruby/2.2.0/x86_64-darwin11.0\"] \r\n```\r\n\r\nYou can inspect the `$LOAD_PATH` for a Rails app from the rails console.\r\n\r\nSummary\r\n========\r\n---------\r\n\r\nIn this article, you learned how to create your own gem. In the next article we will see how to distribute your gem.\r\n\r\nReference\r\n========\r\n---------\r\n\r\nProgramming Ruby by Pragmatic Programmers.','2015-06-13 07:45:29','2015-12-20 17:05:02'),(2341,'Docker Basics : Install Docker','Objective\r\n=========\r\n---------\r\n\r\nTo install Docker v1.6.2 on Mac OS 10.7.5 and play with start, stop and restart commands.\r\n\r\nSteps\r\n=========\r\n---------\r\n\r\nStep 1\r\n---------\r\n\r\nGo to https://github.com/boot2docker/osx-installer/releases/tag/v1.6.2\r\n\r\nStep 2\r\n---------\r\n\r\nDownload Boot2Docker-1.6.2.pkg file. Install it.\r\n\r\nStep 3\r\n---------\r\n\r\nClick on the boot2docker in the Applications folder. You will get the error:\r\n\r\nFATA[0000] Error response from daemon: client and server don\'t have same version (client : 1.18, server: 1.12) \r\n\r\nStep 4\r\n---------\r\n\r\nRun :\r\n\r\n```sh\r\nboot2docker stop\r\nboot2docker download\r\nboot2docker up\r\n```\r\n\r\nStep 5\r\n---------\r\n\r\n```sh\r\nexport DOCKER_CERT_PATH=/Users/zepho/.boot2docker/certs/boot2docker-vm\r\nexport DOCKER_TLS_VERIFY=1\r\nexport DOCKER_HOST=tcp://192.168.59.103:2376\r\n```\r\n\r\nStep 6\r\n---------\r\n\r\nStart the Docker daemon:\r\n\r\n```sh\r\nboot2docker start\r\n```\r\n\r\nStep 7\r\n---------\r\n\r\nStop the Docker daemon:\r\n\r\n```sh\r\nboot2docker stop\r\n```\r\n\r\nStep 8\r\n---------\r\n\r\nRestart the Docker daemon:\r\n\r\n```sh\r\nboot2docker restart\r\n```\r\n\r\nSummary\r\n========\r\n---------\r\n\r\nIn this article, you installed the Docker and learned how to start, stop and restart the Docker daemon.','2015-06-13 08:31:26','2015-06-13 08:31:26'),(2351,'Docker Basics : Check Docker Installation','Objective\r\n=========\r\n---------\r\n\r\nTo check the Docker installation.\r\n\r\nTest the Docker Client\r\n---------\r\n\r\nUse the docker client to confirm the Docker daemon is running:\r\n\r\n```sh\r\n$ docker version\r\n```\r\n\r\n```sh\r\nClient version: 1.6.2\r\nClient API version: 1.18\r\nGo version (client): go1.4.2\r\nGit commit (client): 7c8fca2\r\nOS/Arch (client): darwin/amd64\r\nServer version: 1.6.2\r\nServer API version: 1.18\r\nGo version (server): go1.4.2\r\nGit commit (server): 7c8fca2\r\nOS/Arch (server): linux/amd64\r\n```\r\n\r\nTest Docker Works\r\n---------\r\n\r\n```sh\r\n$ docker run ubuntu echo hello world\r\n```\r\n\r\n```sh\r\nhello world\r\n```\r\n\r\nDocker Client Help\r\n---------\r\n\r\nUse the docker ehlp command to see what the Docker client can do.\r\n\r\n```sh\r\n$docker help\r\n```\r\n\r\n```sh\r\nUsage: docker [OPTIONS] COMMAND [arg...]\r\n\r\nA self-sufficient runtime for linux containers.\r\n\r\nOptions:\r\n  -D, --debug=false                                         Enable debug mode\r\n  -d, --daemon=false                                        Enable daemon mode\r\n  -H, --host=[]                                             Daemon socket(s) to connect to\r\n  -h, --help=false                                          Print usage\r\n  -l, --log-level=info                                      Set the logging level\r\n  --tls=false                                               Use TLS; implied by --tlsverify\r\n  --tlscacert=~/.boot2docker/certs/boot2docker-vm/ca.pem    Trust certs signed only by this CA\r\n  --tlscert=~/.boot2docker/certs/boot2docker-vm/cert.pem    Path to TLS certificate file\r\n  --tlskey=~/.boot2docker/certs/boot2docker-vm/key.pem      Path to TLS key file\r\n  --tlsverify=true                                          Use TLS and verify the remote\r\n  -v, --version=false                                       Print version information and quit\r\n\r\nCommands:\r\n    attach    Attach to a running container\r\n    build     Build an image from a Dockerfile\r\n    commit    Create a new image from a container\'s changes\r\n    cp        Copy files/folders from a container\'s filesystem to the host path\r\n    create    Create a new container\r\n    diff      Inspect changes on a container\'s filesystem\r\n    events    Get real time events from the server\r\n    exec      Run a command in a running container\r\n    export    Stream the contents of a container as a tar archive\r\n    history   Show the history of an image\r\n    images    List images\r\n    import    Create a new filesystem image from the contents of a tarball\r\n    info      Display system-wide information\r\n    inspect   Return low-level information on a container or image\r\n    kill      Kill a running container\r\n    load      Load an image from a tar archive\r\n    login     Register or log in to a Docker registry server\r\n    logout    Log out from a Docker registry server\r\n    logs      Fetch the logs of a container\r\n    port      Lookup the public-facing port that is NAT-ed to PRIVATE_PORT\r\n    pause     Pause all processes within a container\r\n    ps        List containers\r\n    pull      Pull an image or a repository from a Docker registry server\r\n    push      Push an image or a repository to a Docker registry server\r\n    rename    Rename an existing container\r\n    restart   Restart a running container\r\n    rm        Remove one or more containers\r\n    rmi       Remove one or more images\r\n    run       Run a command in a new container\r\n    save      Save an image to a tar archive\r\n    search    Search for an image on the Docker Hub\r\n    start     Start a stopped container\r\n    stats     Display a stream of a containers\' resource usage statistics\r\n    stop      Stop a running container\r\n    tag       Tag an image into a repository\r\n    top       Lookup the running processes of a container\r\n    unpause   Unpause a paused container\r\n    version   Show the Docker version information\r\n    wait      Block until a container stops, then print its exit code\r\n\r\nRun \'docker COMMAND --help\' for more information on a command.\r\n```\r\n\r\nSummary\r\n========\r\n---------\r\n\r\nIn this article, you learned how to check the Docker client installation.','2015-06-13 17:56:23','2015-06-13 17:57:21'),(2361,'Docker Basics : Docker Images','Objective\r\n=========\r\n---------\r\n\r\n- To understand images and image tags\r\n- To learn the commands used to search, download and list Docker images.\r\n\r\nDiscussion\r\n=========\r\n---------\r\n\r\nWhat are Images?\r\n---------\r\nAn image is a collection of file. You build custom images on top of base images such as Ubuntu, Busybox, Fedora etc. Images are layers and each layer represents what changed from the previous layer. \r\n\r\nDifference Between Containers and Images\r\n---------\r\nContainers represent an encapsulated set of processes based on an image. You spawn them with the docker run command. In the [Docker Hello World] (https://rubyplus.com/articles/2381 \'Docker Hello World\') article, we created a new container by executing docker run. It was based on busybox image and we rant the echo command. Images are like templates or stencils that you can create containers from.\r\n\r\nHow Do You Store and Manage Images?\r\n---------\r\n\r\nImages can be store on your Docker host or in a Docker registry. You can use Docker client to manage images.\r\n\r\nFind an Image\r\n=========\r\n---------\r\n\r\nRun the docker search command:\r\n\r\n```sh\r\n$ docker search fedora\r\n```\r\n\r\nYou should see:\r\n\r\n```sh\r\nNAME                                   DESCRIPTION                                     STARS     OFFICIAL   AUTOMATED\r\nfedora                                 Official Fedora 21 base image and semi-off...   171       [OK]       \r\nfedora/couchdb                                                                         30                   [OK]\r\nfedora/apache                                                                          30                   [OK]\r\nfedora/mariadb                                                                         22                   [OK]\r\nfedora/ssh                                                                             19                   [OK]\r\nfedora/memcached                                                                       18                   [OK]\r\nfedora/nginx                                                                           18                   [OK]\r\nfedora/earthquake                                                                      17                   [OK]\r\ntutum/fedora                           Fedora image with SSH access. For the root...   7                    [OK]\r\nvbatts/fedora-varnish                  https://github.com/vbatts/laughing-octo/tr...   2                    [OK]\r\ndockingbay/fedora-rust                 Trusted build of Rust programming language...   2                    [OK]\r\nfedora/owncloud                                                                        2                    [OK]\r\nneroinc/fedora-apache-php-phalcon      Apache, PHP and the Phalcon PHP Framework ...   1                    [OK]\r\nneroinc/fedora-apache-php-phalcon1.2   Apache, PHP and the Phalcon PHP Framework ...   1                    [OK]\r\nneroinc/fedora-apache-php              Apache and PHP based on fedora:20               1                    [OK]\r\nneroinc/fedora-apache                  Plain and simple image with Apache httpd b...   1                    [OK]\r\nstartx/fedora                                                                          1                    [OK]\r\ndasrick/fedora-nginx                   NGINX image - port 80, 443 - based on Fedo...   0                    [OK]\r\nopencpu/fedora                         Development build of opencpu based on Fedora    0                    [OK]\r\ndasrick/fedora-mariadb                 MariaDB image - port 3306 - based on Fedora20   0                    [OK]\r\ntimhughes/fedora                       Fedora plus systemd                             0                    [OK]\r\ngkhachik/rhq-fedora.20                 Docker image for RHQ release(s).  Recent R...   0                    [OK]\r\nmacheins/fedora                                                                        0                    [OK]\r\nrosstimson/fedora-chef                                                                 0                    [OK]\r\ncloudrunnerio/fedora                                                                   0                    [OK]\r\n```\r\n\r\nThere are three namespaces:\r\n\r\n- Root like : fedora\r\n\r\nRoot namespace is for official images. Those images include barebones distro images like Ubuntu, Fedora, Centos etc. These are ready to be used as bases for your own images.\r\n\r\n- User : opencpu/fedora \r\n\r\nThe user namespace hold images for Docker Hub users and organizations. The Docker Hub user is opencpu and the image name is fedora\r\n\r\n- Self-Hosted : registry.rubyplus.com:5000/my-private-image\r\n\r\nA self-hosted registry can be public or private. \r\n\r\nDownload an Image\r\n=========\r\n---------\r\n\r\nPull down the fedora image you just searched using the docker pull command.\r\n\r\n```sh\r\n$docker pull fedora\r\n```\r\n\r\nYou should see :\r\n\r\n```sh\r\nlatest: Pulling from fedora\r\n48ecf305d2cf: Download complete\r\nded7cd95e059: Download complete\r\n```\r\n\r\nShow Currently Installed Images\r\n=========\r\n---------\r\n\r\nLet\'s look at what images are on our host now.\r\n\r\n```sh\r\n$ docker images\r\n```\r\n\r\nYou should see:\r\n\r\n```sh\r\nREPOSITORY          TAG                 IMAGE ID            CREATED             VIRTUAL SIZE\r\nnginx               latest              a785ba7493fd        2 weeks ago         132.9 MB\r\nfedora              latest              ded7cd95e059        2 weeks ago         186.5 MB\r\nfedora              20                  d7f0e75cf11f        7 weeks ago         360.3 MB\r\nhello-world         latest              91c95931e552        8 weeks ago         910 B\r\nubuntu              latest              ad892dd21d60        12 months ago       275.5 MB\r\n```\r\n\r\nDownload a Tagged Image\r\n=========\r\n---------\r\n\r\nImages can have tags. Tags define image variants. It is always best to be specific when using images. The output above shows that there are two tags for fedora latest and 20. Let\'s download an image with a tag.\r\n\r\n```sh\r\n$ docker pull fedora:20\r\n```\r\n\r\nYou should see:\r\n\r\n```sh\r\n20: Pulling from fedora\r\neb8e83ebb17d: Download complete\r\nd7f0e75cf11f: Download complete \r\n```\r\n\r\nYou can see that the images are made up of layers. Docker has downloaded all the necessary layers.\r\n\r\nSummary\r\n========\r\n---------\r\n\r\nIn this article, you learned how to use commands to search, download and list docker images.','2015-06-13 18:08:47','2015-06-14 20:15:35'),(2371,'Docker Basics : Running a Nginx in a Container','Objective\r\n=========\r\n---------\r\n\r\nTo run a nginx web server in a container on Mac OS.\r\n\r\nPre-requisites\r\n=========\r\n---------\r\n\r\n1. Install VirtualBox\r\n2. Install Docker and boot2docker\r\n3. Initialize boot2docker. This is done once by running:\r\n\r\n```sh\r\n$boot2docker init\r\n```\r\n\r\nSteps\r\n=========\r\n---------\r\n\r\nStep 1\r\n---------\r\n\r\nStart boot2docker\r\n\r\n```sh\r\n$boot2docker up\r\n```\r\n\r\nYou will see:\r\n\r\n```sh\r\nWaiting for VM and Docker daemon to start...\r\n.o\r\nStarted.\r\nWriting /Users/zepho/.boot2docker/certs/boot2docker-vm/ca.pem\r\nWriting /Users/zepho/.boot2docker/certs/boot2docker-vm/cert.pem\r\nWriting /Users/zepho/.boot2docker/certs/boot2docker-vm/key.pem\r\n\r\nTo connect the Docker client to the Docker daemon, please set:\r\n    export DOCKER_HOST=tcp://192.168.59.103:2376\r\n    export DOCKER_CERT_PATH=/Users/zepho/.boot2docker/certs/boot2docker-vm\r\n    export DOCKER_TLS_VERIFY=1\r\n```\r\n\r\nStep 2\r\n---------\r\n\r\nSet environment variables:\r\n\r\n```sh\r\n$ export DOCKER_HOST=tcp://192.168.59.103:2376\r\n$ export DOCKER_CERT_PATH=/Users/zepho/.boot2docker/certs/boot2docker-vm\r\n$ export DOCKER_TLS_VERIFY=1\r\n```\r\n\r\nStep 3\r\n---------\r\n\r\n```sh\r\n$ docker info\r\n```\r\n\r\nYou will see:\r\n\r\n```sh\r\nContainers: 6\r\nImages: 23\r\nStorage Driver: aufs\r\n Root Dir: /mnt/sda1/var/lib/docker/aufs\r\n Backing Filesystem: extfs\r\n Dirs: 35\r\n Dirperm1 Supported: true\r\nExecution Driver: native-0.2\r\nKernel Version: 4.0.3-boot2docker\r\nOperating System: Boot2Docker 1.6.2 (TCL 5.4); master : 4534e65 - Wed May 13 21:24:28 UTC 2015\r\nCPUs: 8\r\nTotal Memory: 997.3 MiB\r\nName: boot2docker\r\nID: ZAD4:3F4J:2OJX:7KZW:PMEL:X6FO:EJHG:MANH:TUBU:HVSF:LFSA:P52G\r\nDebug mode (server): true\r\nDebug mode (client): false\r\nFds: 12\r\nGoroutines: 17\r\nSystem Time: Sat Jun 13 23:37:26 UTC 2015\r\nEventsListeners: 0\r\nInit SHA1: 7f9c6798b022e64f04d2aff8c75cbf38a2779493\r\nInit Path: /usr/local/bin/docker\r\nDocker Root Dir: /mnt/sda1/var/lib/docker\r\n$ docker run -d -P --name web nginx\r\nFATA[0000] Error response from daemon: Conflict. The name \"web\" is already in use by container 603f6666054b. You have to delete (or rename) that container to be able to reuse that name. \r\n$ docker run -d -P --name web2 nginx\r\n4e7ef0695ace05a57c7a4bf083544a5030de31883b8087dc21279f7d9cca43c3\r\n```\r\n\r\nStep 4\r\n---------\r\n\r\n```sh\r\n$docker ps\r\n```\r\n\r\nYou will see:\r\n\r\n```sh\r\nCONTAINER ID        IMAGE               COMMAND                CREATED             STATUS              PORTS                                           NAMES\r\n4e7ef0695ace        nginx:latest        \"nginx -g \'daemon of   8 seconds ago       Up 7 seconds        0.0.0.0:32769->80/tcp, 0.0.0.0:32768->443/tcp   web2                \r\n```\r\n\r\nStep 5\r\n---------\r\n\r\nLooking at the above output, if we try:\r\n\r\n```sh\r\n$curl 0.0.0.0:32769\r\n```\r\n\r\nWe get:\r\n\r\n```sh\r\ncurl: (7) couldn\'t connect to host\r\n```\r\n\r\nStep 6\r\n---------\r\n\r\nSo, let\'s find the IP address:\r\n\r\n```sh\r\n$boot2docker ip\r\n```\r\n\r\nYou will see:\r\n\r\n```sh\r\n192.168.59.103\r\n```\r\n\r\nStep 7\r\n---------\r\n\r\nRun :\r\n\r\n```sh\r\n$curl 192.168.59.103:32769\r\n```\r\n\r\nYou will see:\r\n\r\n```html\r\n<!DOCTYPE html>\r\n<html>\r\n<head>\r\n<title>Welcome to nginx!</title>\r\n<style>\r\n    body {\r\n        width: 35em;\r\n        margin: 0 auto;\r\n        font-family: Tahoma, Verdana, Arial, sans-serif;\r\n    }\r\n</style>\r\n</head>\r\n<body>\r\n<h1>Welcome to nginx!</h1>\r\n<p>If you see this page, the nginx web server is successfully installed and\r\nworking. Further configuration is required.</p>\r\n\r\n<p>For online documentation and support please refer to\r\n<a href=\"http://nginx.org/\">nginx.org</a>.<br/>\r\nCommercial support is available at\r\n<a href=\"http://nginx.com/\">nginx.com</a>.</p>\r\n\r\n<p><em>Thank you for using nginx.</em></p>\r\n</body>\r\n</html>\r\n```\r\n\r\nBrowse to http://192.168.59.103:32769/ You will the Welcome to nginx! static page.\r\n\r\nStep 8\r\n---------\r\n\r\nStop the container:\r\n\r\n```sh\r\n$docker stop web2\r\n```\r\n\r\nYou will see: web2\r\n\r\nRemove the container:\r\n\r\n```sh\r\n$docker rm web2\r\n```\r\n\r\nYou will see: web2\r\n\r\nNote that since I already have a web container called \'web\' running, I had to use web2 for this article.\r\n\r\nReference\r\n========\r\n---------\r\n\r\n[How to Use Docker on OS X: The Missing Guide](http://viget.com/extend/how-to-use-docker-on-os-x-the-missing-guide \'How to Use Docker on OS X: The Missing Guide\')','2015-06-14 00:00:20','2015-06-14 00:06:58'),(2381,'Docker Basics : Hello World','Objective\r\n=========\r\n---------\r\n\r\nTo run a \'hello world\' program using Docker container.\r\n\r\nSteps\r\n=========\r\n---------\r\n\r\nStep 1\r\n---------\r\n\r\nRun:\r\n\r\n```sh\r\n$ docker run busybox echo hello world\r\n```\r\n\r\nBusybox is a small and lean image. You will see:\r\n\r\n```sh\r\nUnable to find image \'busybox:latest\' locally\r\nlatest: Pulling from busybox\r\ncf2616975b4a: Pull complete \r\n6ce2e90b0bc7: Pull complete \r\n8c2e06607696: Already exists \r\nbusybox:latest: The image you are pulling has been verified. Important: image verification is a tech preview feature and should not be relied on to provide security.\r\nDigest: sha256:38a203e1986cf79639cfb9b2e1d6e773de84002feea2d4eb006b52004ee8502d\r\nStatus: Downloaded newer image for busybox:latest\r\nhello world\r\n```\r\n\r\nWe ran a single process in the docker container that echo\'ed \'hello world\'. \r\n\r\nStep 2\r\n---------\r\n\r\nThe Busybox image doesn\'t do much. Let\'s use a beefier Ubuntu image now.\r\n\r\n```sh\r\n$ docker pull ubuntu:latest\r\n```\r\n\r\nYou will see:\r\n\r\n```sh\r\natest: Pulling from ubuntu\r\n428b411c28f0: Downloading [=========================>                         ] 33.52 MB/65.77 MB\r\n435050075b3f: Download complete \r\n9fd3c8c9af32: Download complete \r\n6d4946999d4f: Download complete \r\n```\r\n\r\nIt will take a few minutes to complete.\r\n\r\n```sh\r\nlatest: Pulling from ubuntu\r\n428b411c28f0: Pull complete \r\n435050075b3f: Pull complete \r\n9fd3c8c9af32: Pull complete \r\n6d4946999d4f: Already exists \r\nubuntu:latest: The image you are pulling has been verified. Important: image verification is a tech preview feature and should not be relied on to provide security.\r\nDigest: sha256:45e42b43f2ff4850dcf52960ee89c21cda79ec657302d36faaaa07d880215dd9\r\nStatus: Downloaded newer image for ubuntu:latest\r\n```\r\n\r\nDiscussion\r\n========\r\n---------\r\n\r\nDocker is a client-server application. It consists of Docker daemon which is the Docker server. It receives and processes incoming Docker API requests. The Docker client is a command line tool that allows us to talk to the Docker daemon via the Docker API. Let\'s now run the \'hello world\' again using the latest Ubuntu.\r\n\r\nStep 3\r\n---------\r\n\r\n```sh\r\n$ docker run ubuntu echo hello world\r\n```\r\n\r\nYou will see: **hello world**.\r\n\r\nSummary\r\n========\r\n---------\r\n\r\nIn this article, we wrote a simple \'hello world\' program using Docker container.','2015-06-14 00:30:47','2015-06-14 00:33:13'),(2391,'Docker Basics : Building Docker Images','Objectives\r\n=========\r\n---------\r\n\r\n- Understand the instructions for a Dockerfile\r\n- Create your own Dockerfile\r\n- Build an image from a Dockerfile\r\n- Override the CMD when you run : docker run\r\n\r\nBuilding Images\r\n=========\r\n---------\r\n\r\nDockerfile \r\n---------\r\n\r\nWe can build our own images using a Dockerfile. A Dockerfile holds Docker image definitions. It has a set of instructions that tells Docker how an image is created.\r\n\r\nOur first Dockerfile\r\n---------\r\n\r\n```sh\r\nFROM ubuntu:14.04\r\n```\r\n\r\nFROM specifies a source image for our new image. This is required. You can specify a base image, tagged image, user image or self-hosted image. \r\n\r\n```sh\r\nMAINTAINER Docker Education Team <education@docker.com>\r\n```\r\n\r\nMAINTAINER tells us who maintains this image.\r\n\r\n```sh\r\nRUN apt-get update\r\n```\r\n\r\nEach RUN instruction executes a command to build our image. It can be specified with shell wrapping, which runs the specified command inside a shell with /bin/sh as above. It can also use the exec method, which avoids shell string expansiong and allows execution in images that don\'t have /bin/sh:\r\n\r\n```sh\r\nRUN [\'apt-get\', \'update\']\r\n```\r\n\r\nRUN will execute the command, record changes made to the filesystem. It can be used to install libraries, packages and various files. RUN will not record state of processes and will not automatically start daemons. If you want to start something automatically when the container runs, you should use CMD or ENTRYPOINT.\r\n\r\n```sh\r\nCMD [ \"nginx\", \"-g\", \"daemon off;\" ]\r\n```\r\n\r\nCMD defines the default command to run when a container is launched from this image. So in this case, instead of doing:\r\n\r\n```sh\r\ndocker run web nginx -g \"daemon off;\"\r\n```\r\n\r\nWe can just do:\r\n\r\n```sh\r\ndocker run web\r\n```\r\n\r\nJust like RUN, the CMD instruction somes in two forms. The first executes in a shell:\r\n\r\n```sh\r\nCMD nginx -g \"daemon off;\"\r\n```\r\n\r\nThe second executes directly, without shell processing:\r\n\r\n```sh\r\nCMD [\"nginx\", \"-g\", \"daemon off;\"]\r\n```\r\n\r\nThe CMD can be overridden when you run the container:\r\n\r\n```sh\r\ndocker run -t -i web /bin/bash\r\n```\r\n\r\nThis command will run /bin/bash instead of nginx -g \"daemon off;\"\r\n\r\n```sh\r\nEXPOSE 80\r\n```\r\n\r\nEXPOSE lists the network ports to open when a container is launched from this image. All ports are private by default. The Dockerfile does not control if a port is publicly available. When you run : \r\n\r\n```sh\r\ndocker run -p <port>\r\n```\r\n\r\nthat port becomes public. Even if it was declared with EXPOSE. \r\n\r\nWhen you run:\r\n\r\n```sh\r\ndocker run -P \r\n```\r\n\r\nwithout port number, all ports declared with EXPOSE become public. A public port is reachable from other containers and from outside the host. A private port is not reachable from outside. Here is the complete Dockerfile.\r\n\r\n```sh\r\nFROM ubuntu:14.04\r\nMAINTAINER Docker Education Team <education@docker.com>\r\n\r\nRUN apt-get update\r\nRUN apt-get install -y nginx\r\nRUN echo \'Hi, I am in your container\' \\\r\n    >/usr/share/nginx/html/index.html\r\n\r\nCMD [ \"nginx\", \"-g\", \"daemon off;\" ]\r\n\r\nEXPOSE 80\r\n```\r\n\r\n######Things to Keep in Mind\r\n\r\n- Dockerfile instructions are executed in order.\r\n- Each instruction creates a new layer in the image.\r\n- Instructions are cached. If no changes are detected then the instruction is skipped and the cached layer used.\r\n- The FROM instruction MUST be the first non-comment instruction.\r\n- Lines starting with # are treated as comments.\r\n- You can only have one CMD and one ENTRYPOINT instruction in a Dockerfile.\r\n\r\ndocker build\r\n---------\r\n\r\nThe docker build command builds an image from a Dockerfile. Create a new project folder for this exercise and go to that directory. Create a Dockerfile with contents shown in the section \'Our first Dockerfile\'.\r\n\r\n```sh\r\ndocker build -t web .\r\n```\r\n\r\nThe -t flag tags an image. The . indicates the location of the Dockerfile being built.\r\n\r\nYou will see:\r\n\r\n```sh\r\nSending build context to Docker daemon 2.048 kB\r\nSending build context to Docker daemon \r\nStep 0 : FROM ubuntu:14.04\r\n14.04: Pulling from ubuntu\r\n428b411c28f0: Already exists \r\n435050075b3f: Already exists \r\n9fd3c8c9af32: Already exists \r\n6d4946999d4f: Already exists \r\nubuntu:14.04: The image you are pulling has been verified. Important: image verification is a tech preview feature and should not be relied on to provide security.\r\nDigest: sha256:59662c823007a7a6fbc411910b472cf4ed862e8f74603267ddfe20d5af4f9d79\r\nStatus: Downloaded newer image for ubuntu:14.04\r\n ---> 6d4946999d4f\r\nStep 1 : MAINTAINER Docker Education Team <education@docker.com>\r\n ---> Running in 29b2b054addd\r\n ---> 2636ed8ef6b6\r\nRemoving intermediate container 29b2b054addd\r\nStep 2 : RUN apt-get update\r\n ---> Running in 89dc81b5d5cf\r\nIgn http://archive.ubuntu.com trusty InRelease\r\nIgn http://archive.ubuntu.com trusty-updates InRelease\r\nIgn http://archive.ubuntu.com trusty-security InRelease\r\n...\r\n...\r\nSetting up nginx (1.4.6-1ubuntu3.2) ...\r\nProcessing triggers for libc-bin (2.19-0ubuntu6.6) ...\r\nProcessing triggers for sgml-base (1.26+nmu4ubuntu1) ...\r\n ---> dbb3cba0ad61\r\nRemoving intermediate container 9b8df578f357\r\nStep 4 : RUN echo \'Hi, I am in your container\'     >/usr/share/nginx/html/index.html\r\n ---> Running in e0da0dab3b4b\r\n ---> ec66ae5f793b\r\nRemoving intermediate container e0da0dab3b4b\r\nStep 5 : CMD nginx -g daemon off;\r\n ---> Running in d8120867dbbf\r\n ---> e0e40dd40a42\r\nRemoving intermediate container d8120867dbbf\r\nStep 6 : EXPOSE 80\r\n ---> Running in 16f26071ec13\r\n ---> a1e94d444e2e\r\nRemoving intermediate container 16f26071ec13\r\nSuccessfully built a1e94d444e2e\r\n```\r\n\r\nStep 3\r\n---------\r\n\r\nLet\'s look at our newly created image.\r\n\r\n```sh\r\n$ docker images\r\n```\r\n\r\nThis will show you all the images including the web image you just created.\r\n\r\n```sh\r\nREPOSITORY          TAG                 IMAGE ID            CREATED             VIRTUAL SIZE\r\nweb                 latest              a1e94d444e2e        24 minutes ago      227.4 MB\r\nubuntu              14.04               6d4946999d4f        2 days ago          188.3 MB\r\nubuntu              latest              6d4946999d4f        2 days ago          188.3 MB\r\nnginx               latest              a785ba7493fd        2 weeks ago         132.9 MB\r\nfedora              latest              ded7cd95e059        2 weeks ago         186.5 MB\r\nfedora              20                  d7f0e75cf11f        7 weeks ago         360.3 MB\r\nhello-world         latest              91c95931e552        8 weeks ago         910 B\r\nbusybox             latest              8c2e06607696        8 weeks ago         2.433 MB\r\n<none>              <none>              ad892dd21d60        12 months ago       275.5 MB\r\n```\r\n\r\nSummary\r\n========\r\n---------\r\n\r\nIn this article, you learned the basics of Dockerfile and how to build your own Docker image using a Dockerfile.','2015-06-14 21:01:53','2015-06-14 21:07:41'),(2401,'Docker Basics : Container Basics','Objectives\r\n=========\r\n---------\r\n\r\n- Understand the different types of containers\r\n- Start a container\r\n- See a container\'s status\r\n- Inspect a container\r\n- Restart and attach to a container\r\n\r\nSteps\r\n=========\r\n---------\r\n\r\nContainers are created with the docker run command. Containers can run in two modes: Daemonized and Interactive. Daemonized container runs in the background. The docker run command is launched with the -d command line flag. The container runs until it is stopped or killed.\r\n\r\nInteractive containers run in the foreground. It is attached to a pseudo-terminal, ie., let\'s you get input and output from the container. The container also runs unless its controlling process stops or it is stopped or killed.\r\n\r\nStep 1\r\n---------\r\n\r\nLet\'s create a new container from the ubuntu image.\r\n\r\n```sh\r\n$docker run -i -t ubuntu:12.04 /bin/bash\r\n```\r\n\r\n• The -i flag sets Docker\'s mode to interactive.\r\n• The -t flag creates a pseudo terminal (or PTY) in the container.\r\n• We\'ve specified the ubuntu:12.04 image from which to create our container.\r\n• We passed a command to run inside the container, /bin/bash.\r\n\r\nYou will see:\r\n\r\n```sh\r\nUnable to find image \'ubuntu:12.04\' locally\r\n12.04: Pulling from ubuntu\r\nb5da78899d3a: Pull complete \r\n87183ecb6716: Pull complete \r\n82ed8e312318: Pull complete \r\n78cef618c77e: Already exists \r\nubuntu:12.04: The image you are pulling has been verified. Important: image verification is a tech preview feature and should not be relied on to provide security.\r\nDigest: sha256:dd470ce8a41ded321956ea32b1fc4897ecc4c0ec11ff1ea5c732d7c2f4e08e1f\r\nStatus: Downloaded newer image for ubuntu:12.04\r\nroot@5fef10b1016b:/# \r\n```\r\n\r\n• That command has launched a Bash shell inside our container.\r\n• The hexadecimal number after root@ is the container\'s identifier\r\n\r\nStep 2\r\n---------\r\n\r\nLet\'s run a command inside our container.\r\n\r\n```sh\r\n$uname -rn\r\n```\r\n\r\nYou will see:\r\n\r\n```sh\r\n5fef10b1016b 4.0.3-boot2docker\r\n```\r\n\r\nExit the container.\r\n\r\n```sh\r\nexit\r\n```\r\n\r\nStep 3\r\n---------\r\n\r\nCheck the Kernel version and host name outside the container.\r\n\r\n```sh\r\n$uname -rn\r\n```\r\n\r\nIn my case, it is:\r\n\r\n```sh\r\nzepho-mac-pro.local 11.4.2\r\n```\r\n\r\nWhen I ran this on my Ubuntu 14.04 VM on VirtualBox:\r\n\r\n```sh\r\nroot@a124e4f82187:/# uname -rn\r\na124e4f82187 3.13.0-39-generic\r\nroot@a124e4f82187:/# exit\r\n```\r\n\r\n```sh\r\nuname -rnroot@riak:/home/bparanj/projects/namer# uname -rn\r\nriak 3.13.0-39-generic\r\n```\r\n\r\nThe kernel version is the same. Host name is different.\r\n\r\nStep 4\r\n---------\r\n\r\nYou can see the container status using the docker ps command.\r\n\r\n```sh\r\n$docker ps\r\n```\r\n\r\nOn my Mac, I have only one container that is running.\r\n\r\n```sh\r\nCONTAINER ID        IMAGE                   COMMAND             CREATED             STATUS              PORTS                  NAMES\r\n70202794de9d        training/namer:latest   \"rackup\"            About an hour ago   Up About an hour    0.0.0.0:80->9292/tcp   grave_einstein      \r\n```\r\n\r\nStep 5\r\n---------\r\n\r\nWe can check the last container status by using the -l flag.\r\n\r\n```sh\r\n$docker ps -l\r\n```\r\n\r\nIn my case, it shows the previous container that was running:\r\n\r\n```sh\r\nCONTAINER ID        IMAGE               COMMAND             CREATED             STATUS                     PORTS               NAMES\r\n5fef10b1016b        ubuntu:12.04        \"/bin/bash\"         10 minutes ago      Exited (0) 8 minutes ago                       kick_land  \r\n```\r\n\r\nStep 6\r\n---------\r\n\r\nWe can use docker ps command with the -a flag to show status of all containers. \r\n\r\n```sh\r\n$docker ps -a\r\n```\r\n\r\n```sh\r\nCONTAINER ID        IMAGE                   COMMAND                CREATED             STATUS                           PORTS                  NAMES\r\n5fef10b1016b        ubuntu:12.04            \"/bin/bash\"            12 minutes ago      Exited (0) 10 minutes ago                               kickass_lalande      \r\n70202794de9d        training/namer:latest   \"rackup\"               About an hour ago   Up About an hour                 0.0.0.0:80->9292/tcp   grave_einstein       \r\ne890f9a07aeb        training/namer:latest   \"rackup --host 0.0.0   About an hour ago   Exited (1) About an hour ago                            mynamer              \r\nd73afb15cacb        training/namer:latest   \"rackup --host 0.0.0   About an hour ago   Exited (1) About an hour ago                            namer                \r\n06fe017c75a4        training/namer:latest   \"rackup\"               About an hour ago   Exited (137) About an hour ago                          sharp_galileo        \r\ne96dc63b23fe        ubuntu:latest           \"echo hello world\"     22 hours ago        Exited (0) 22 hours ago                                 sharp_wilson         \r\nfcfd6a016f57        busybox:latest          \"echo hello world\"     23 hours ago        Exited (0) 23 hours ago                                 romantic_hopper      \r\nd8ddc3b65d89        ubuntu:latest           \"echo hello world\"     29 hours ago        Exited (0) 29 hours ago                                 suspicious_euclid    \r\nfae9dbf52e57        ubuntu:latest           \"/bin/bash\"            38 hours ago        Exited (0) 38 hours ago                                 jovial_torvalds      \r\n603f6666054b        nginx:latest            \"nginx -g \'daemon of   39 hours ago        Exited (0) 39 hours ago                                 web                  \r\na37ce803ab5e        hello-world:latest      \"/hello\"               39 hours ago        Exited (0) 39 hours ago                                 determined_goodall   \r\n9712ded4e575        ubuntu:latest           \"echo hello world\"     12 months ago       Exited (0) 12 months ago                                sad_mayer            \r\n6d251526d353        ubuntu:latest           \"echo hello world\"     12 months ago       Exited (0) 12 months ago                                focused_bartik   \r\n```\r\n\r\nUsing the -a flag shows all containers that could be running or stopped. \r\n\r\n• CONTAINER ID is a unique identifier generated by Docker for our container. You can use it to manage the container (e.g. stop it, examine it, etc)\r\n• IMAGE is the image used to create that container. We did docker run ubuntu, and Docker selected ubuntu:12.04.\r\n• COMMAND is the exact command that we asked Docker to run: /bin/bash.\r\n• You can name your containers (with the --name option). If you don\'t, Docker will generate a random name for you, like sad_pare. That name shows up in the NAMES column.\r\n\r\nStep 7\r\n---------\r\n\r\nWe can get the ID of the last container.\r\n\r\n```sh\r\n$docker ps -l -q\r\n```\r\n\r\n```sh\r\n5fef10b1016b\r\n```\r\n\r\n- -l means show only the last container started.\r\n- -q means show only the short ID of the container.\r\n\r\nStep 8\r\n---------\r\n\r\nWe can use docker inspect command to inspect a container.\r\n\r\n```sh\r\n$docker inspect $(docker ps -l -q) \r\n```\r\n\r\nYou will see:\r\n\r\n```sh\r\n[{\r\n    \"AppArmorProfile\": \"\",\r\n    \"Args\": [],\r\n    \"Config\": {\r\n        \"AttachStderr\": true,\r\n        \"AttachStdin\": true,\r\n        \"AttachStdout\": true,\r\n        \"Cmd\": [\r\n            \"/bin/bash\"\r\n        ],\r\n        \"CpuShares\": 0,\r\n        \"Cpuset\": \"\",\r\n        \"Domainname\": \"\",\r\n        \"Entrypoint\": null,\r\n        \"Env\": null,\r\n        \"ExposedPorts\": null,\r\n        \"Hostname\": \"5fef10b1016b\",\r\n        \"Image\": \"ubuntu:12.04\",\r\n        \"Labels\": {},\r\n        \"MacAddress\": \"\",\r\n        \"Memory\": 0,\r\n        \"MemorySwap\": 0,\r\n        \"NetworkDisabled\": false,\r\n        \"OnBuild\": null,\r\n        \"OpenStdin\": true,\r\n        \"PortSpecs\": null,\r\n        \"StdinOnce\": true,\r\n        \"Tty\": true,\r\n        \"User\": \"\",\r\n        \"Volumes\": null,\r\n        \"WorkingDir\": \"\"\r\n    },\r\n    \"Created\": \"2015-06-14T23:06:23.221206404Z\",\r\n    \"Driver\": \"aufs\",\r\n    \"ExecDriver\": \"native-0.2\",\r\n    \"ExecIDs\": null,\r\n    \"HostConfig\": {\r\n        \"Binds\": null,\r\n        \"CapAdd\": null,\r\n        \"CapDrop\": null,\r\n        \"CgroupParent\": \"\",\r\n        \"ContainerIDFile\": \"\",\r\n        \"CpuShares\": 0,\r\n        \"CpusetCpus\": \"\",\r\n        \"Devices\": [],\r\n        \"Dns\": null,\r\n        \"DnsSearch\": null,\r\n        \"ExtraHosts\": null,\r\n        \"IpcMode\": \"\",\r\n        \"Links\": null,\r\n        \"LogConfig\": {\r\n            \"Config\": null,\r\n            \"Type\": \"json-file\"\r\n        },\r\n        \"LxcConf\": [],\r\n        \"Memory\": 0,\r\n        \"MemorySwap\": 0,\r\n        \"NetworkMode\": \"bridge\",\r\n        \"PidMode\": \"\",\r\n        \"PortBindings\": {},\r\n        \"Privileged\": false,\r\n        \"PublishAllPorts\": false,\r\n        \"ReadonlyRootfs\": false,\r\n        \"RestartPolicy\": {\r\n            \"MaximumRetryCount\": 0,\r\n            \"Name\": \"no\"\r\n        },\r\n        \"SecurityOpt\": null,\r\n        \"Ulimits\": null,\r\n        \"VolumesFrom\": null\r\n    },\r\n    \"HostnamePath\": \"/mnt/sda1/var/lib/docker/containers/5fef10b1016b36dd60ee227bab7f8cd5a32bf28a8c23ab258c8de95ea39a0128/hostname\",\r\n    \"HostsPath\": \"/mnt/sda1/var/lib/docker/containers/5fef10b1016b36dd60ee227bab7f8cd5a32bf28a8c23ab258c8de95ea39a0128/hosts\",\r\n    \"Id\": \"5fef10b1016b36dd60ee227bab7f8cd5a32bf28a8c23ab258c8de95ea39a0128\",\r\n    \"Image\": \"78cef618c77e86749226ad7855e5e884a7bdbd85fa1c9361b8653931b4adaec5\",\r\n    \"LogPath\": \"/mnt/sda1/var/lib/docker/containers/5fef10b1016b36dd60ee227bab7f8cd5a32bf28a8c23ab258c8de95ea39a0128/5fef10b1016b36dd60ee227bab7f8cd5a32bf28a8c23ab258c8de95ea39a0128-json.log\",\r\n    \"MountLabel\": \"\",\r\n    \"Name\": \"/kickass_lalande\",\r\n    \"NetworkSettings\": {\r\n        \"Bridge\": \"\",\r\n        \"Gateway\": \"\",\r\n        \"GlobalIPv6Address\": \"\",\r\n        \"GlobalIPv6PrefixLen\": 0,\r\n        \"IPAddress\": \"\",\r\n        \"IPPrefixLen\": 0,\r\n        \"IPv6Gateway\": \"\",\r\n        \"LinkLocalIPv6Address\": \"\",\r\n        \"LinkLocalIPv6PrefixLen\": 0,\r\n        \"MacAddress\": \"\",\r\n        \"PortMapping\": null,\r\n        \"Ports\": null\r\n    },\r\n    \"Path\": \"/bin/bash\",\r\n    \"ProcessLabel\": \"\",\r\n    \"ResolvConfPath\": \"/mnt/sda1/var/lib/docker/containers/5fef10b1016b36dd60ee227bab7f8cd5a32bf28a8c23ab258c8de95ea39a0128/resolv.conf\",\r\n    \"RestartCount\": 0,\r\n    \"State\": {\r\n        \"Dead\": false,\r\n        \"Error\": \"\",\r\n        \"ExitCode\": 0,\r\n        \"FinishedAt\": \"2015-06-14T23:08:09.121615275Z\",\r\n        \"OOMKilled\": false,\r\n        \"Paused\": false,\r\n        \"Pid\": 0,\r\n        \"Restarting\": false,\r\n        \"Running\": false,\r\n        \"StartedAt\": \"2015-06-14T23:06:23.512852607Z\"\r\n    },\r\n    \"Volumes\": {},\r\n    \"VolumesRW\": {}\r\n}\r\n]\r\n```\r\n\r\nStep 9\r\n---------\r\n\r\nWe can use docker inspect command to find specific things about out container, for example:\r\n\r\n```sh\r\n$docker inspect --format=\'{{.State.Running}}\' $(docker ps -l -q)\r\n```\r\n\r\nThis returned : false.\r\n\r\nThe --format flag is used to specify a single value from our inspect hash result. This will return its value, in this case a Boolean value for the container\'s status.\r\n\r\n\r\nStep 10\r\n---------\r\n\r\nInspect container using its container id.\r\n\r\n```sh\r\n$docker inspect 7020\r\n```\r\n\r\nYou can use the first few characters to inspect the container.\r\n\r\n\r\nStep 11\r\n---------\r\n\r\nYou can restart a stopped container using its ID.\r\n\r\n```sh\r\n$docker start 5fef\r\n```\r\n\r\n```sh\r\n$docker ps\r\n```\r\n\r\n```sh\r\nCONTAINER ID        IMAGE                   COMMAND             CREATED             STATUS              PORTS                  NAMES\r\n5fef10b1016b        ubuntu:12.04            \"/bin/bash\"         25 minutes ago      Up 14 seconds                              kickass_lalande     \r\n70202794de9d        training/namer:latest   \"rackup\"            About an hour ago   Up About an hour    0.0.0.0:80->9292/tcp   grave_einstein      \r\n```\r\n\r\nYou can also use the container name to start.\r\n\r\n```sh\r\n$docker start web\r\nweb\r\n```\r\n\r\n```sh\r\n$ docker ps\r\n```\r\n\r\n```sh\r\nCONTAINER ID        IMAGE                   COMMAND                CREATED             STATUS              PORTS                                           NAMES\r\n5fef10b1016b        ubuntu:12.04            \"/bin/bash\"            25 minutes ago      Up 44 seconds                                                       kickass_lalande     \r\n70202794de9d        training/namer:latest   \"rackup\"               About an hour ago   Up About an hour    0.0.0.0:80->9292/tcp                            grave_einstein      \r\n603f6666054b        nginx:latest            \"nginx -g \'daemon of   39 hours ago        Up 3 seconds        0.0.0.0:32773->80/tcp, 0.0.0.0:32772->443/tcp   web  \r\n```\r\n\r\nStep 12\r\n---------\r\n\r\nYou can attach to a running container using the attach command.\r\n\r\n```sh\r\n$docker attach 5fef\r\n```\r\n\r\n```sh\r\n$docker attach grave_einstein\r\n```\r\n\r\nYou can use either the container id or its name.\r\n\r\nStep 13\r\n---------\r\n\r\nWe can start and attach by using the -a flag to combine attach with start.\r\n\r\n```sh\r\n$docker start -a <container id>\r\n```\r\n\r\n```sh\r\n$docker start -a 6d25\r\nhello world\r\n```\r\n\r\nSummary\r\n========\r\n---------\r\n\r\nIn this article, you learned the different types of containers. You also learned how to start a container, see it\'s status, inspect it, start and attach to a container.','2015-06-14 23:52:31','2015-06-15 00:00:54'),(2411,'Chef Solo Basics : Installing Nginx Webserver ','Objective\r\n=========\r\n---------\r\n\r\nTo learn how to use Chef Solo to install nginx webserver on VM using Vagrant 1.7.2, Chef 12.3 and VirtualBox 4.3.28.\r\n\r\nSteps\r\n=========\r\n---------\r\n\r\nStep 1\r\n---------\r\n\r\n```sh\r\n$gem install chef\r\n```\r\n\r\nStep 2\r\n---------\r\n\r\n```sh\r\n$mkdir cengine\r\n$cd cengine\r\n$mkdir cookbooks\r\n```\r\n\r\nStep 3\r\n---------\r\n\r\n```sh\r\n$knife cookbook create nginx -o cookbooks\r\n```\r\n\r\nStep 4\r\n---------\r\n\r\nEdit recipes/default.rb:\r\n\r\n```ruby\r\npackage \'nginx\' do\r\n  action :install\r\nend\r\n```\r\n\r\nStep 5\r\n---------\r\n\r\n```sh\r\n$vagrant init\r\n```\r\n\r\nStep 6\r\n---------\r\n\r\nCopy URL for Ubuntu 14:04 from www.vgrantbox.es and configure it in Vagrantfile.\r\n\r\n```ruby\r\nVagrant.configure(2) do |config|\r\n  config.vm.box = \"ubuntu-14.04\"\r\n  config.vm.box_url = \'https://cloud-images.ubuntu.com/vagrant/trusty/current/trusty-server-cloudimg-amd64-vagrant-disk1.box\'\r\n\r\nend\r\n```\r\n\r\nStep 7\r\n---------\r\n\r\nAdd chef solo configuration for installing nginx:\r\n\r\n```ruby\r\nVagrant.configure(2) do |config|\r\n\r\n  config.vm.provision :chef_solo do |chef|\r\n    chef.run_list = [\r\n      \"recipe[nginx]\"\r\n    ]\r\n  end\r\n\r\nend\r\n```\r\n\r\nStep 8\r\n---------\r\n\r\nThe Vagrantfile now looks like this:\r\n\r\n```ruby\r\nVagrant.configure(2) do |config|\r\n  config.vm.box = \"ubuntu-14.04\"\r\n  config.vm.box_url = \'https://cloud-images.ubuntu.com/vagrant/trusty/current/trusty-server-cloudimg-amd64-vagrant-disk1.box\'\r\n\r\n  config.vm.provision :chef_solo do |chef|\r\n    chef.run_list = [\r\n      \"recipe[nginx]\"\r\n    ]\r\n  end\r\n\r\nend\r\n```\r\n\r\nSSH into VM and check the nginx installation.\r\n\r\n```sh\r\n$vagrant ssh\r\n```\r\n\r\n```sh\r\nvagrant@vagrant-ubuntu-trusty-64:~$ nginx -v\r\n```\r\n\r\nYou will see:\r\n\r\n```sh\r\nnginx version: nginx/1.4.6 (Ubuntu)\r\n```\r\n\r\nExit the VM.\r\n\r\n```sh\r\nvagrant@vagrant-ubuntu-trusty-64:~$exit\r\n```\r\n\r\nStep 9\r\n---------\r\n\r\nAdd:\r\n\r\n```ruby\r\nexecute \'apt-get update\' do\r\n  action :run\r\nend\r\n```\r\n\r\nto nginx/recipes/default.rb. The file now looks like this:\r\n\r\n```ruby\r\nexecute \'apt-get update\' do\r\n  action :run\r\nend\r\n\r\npackage \'nginx\' do\r\n  action :install\r\nend\r\n```\r\n\r\nStep 10\r\n---------\r\n\r\nLet\'s provision the VM to apply the changes to the recipe.\r\n\r\n```sh\r\n$vagrant provision\r\n```\r\n\r\nStep 11\r\n---------\r\n\r\nVerify the installation.\r\n\r\n```sh\r\n$vagrant ssh\r\n```\r\n\r\n```sh\r\n$nginx -v\r\n```\r\n\r\n```sh\r\n$exit\r\n```\r\n\r\nSummary\r\n========\r\n---------\r\n\r\nIn this article,  we installed nginx webserver on VM using Chef Solo using Vagrant and VirtualBox.','2015-06-17 08:56:20','2015-06-17 09:00:47'),(2421,'Docker Basics : Container Networking','Objectives\r\n=========\r\n---------\r\n\r\n• Expose a network port.\r\n• Manipulate container networking basics.\r\n• Find a container\'s IP address.\r\n• Stop and remove a container.\r\n\r\nDiscussion\r\n=========\r\n---------\r\n\r\nWe are going to build a web server in a daemonized container.\r\n\r\nSteps\r\n=========\r\n---------\r\n\r\nStep 1\r\n---------\r\n\r\nLet\'s create our new container.\r\n\r\n```sh\r\n$ docker run -d -p 80 training/webapp python -m SimpleHTTPServer 80\r\n```\r\n\r\n• We\'ve used the -d flag to daemonize the container.\r\n• The -p flag exposes port 80 in the container.\r\n• We\'ve used the training/webapp image, which happens to have Python.\r\n• We\'ve used Python to create a web server.\r\n\r\nYou will see:\r\n\r\n```sh\r\nUnable to find image \'training/webapp:latest\' locally\r\nlatest: Pulling from training/webapp\r\n23f0158a1fbe: Pull complete \r\n0a4852b23749: Pull complete \r\n7d0ff9745632: Pull complete \r\n99b0d955e85d: Pull complete \r\n33e109f2ff13: Pull complete \r\ncc06fd877d54: Pull complete \r\nb1ae241d644a: Pull complete \r\nb37deb56df95: Pull complete \r\n02a8815912ca: Already exists \r\ne9e06b06e14c: Already exists \r\na82efea989f9: Already exists \r\n37bea4ee0c81: Already exists \r\n07f8e8c5e660: Already exists \r\nDigest: sha256:06e9c1983bd6d5db5fba376ccd63bfa529e8d02f23d5079b8f74a616308fb11d\r\nStatus: Downloaded newer image for training/webapp:latest\r\n7e87240f931b13f65cbae7930d409b0444e89e91ef537153875ec782ced18954\r\n```\r\n\r\nStep 2\r\n---------\r\n\r\nLet\'s check that the container is running.\r\n\r\n```sh\r\n$docker ps\r\n```\r\n\r\nYou will see:\r\n\r\n```sh\r\nCONTAINER ID   IMAGE                    COMMAND                PORTS                                           NAMES\r\n7e87240f931b   training/webapp:latest   \"python -m SimpleHTT   5000/tcp, 0.0.0.0:32774->80/tcp                 jones\r\n603f6666054b   nginx:latest             \"nginx -g \'daemon of   0.0.0.0:32773->80/tcp, 0.0.0.0:32772->443/tcp   web \r\n```\r\n\r\nThe -p flag maps a random high port, here 32774 to port 80 inside the container. We can see it in the PORTS column. We can use the docker port command to find our mapped port. \r\n\r\n```sh \r\n$docker port 7e87\r\n```\r\n\r\nYou will see:\r\n\r\n```sh \r\n80/tcp -> 0.0.0.0:32774\r\n```\r\n\r\nWe can specify the container ID and the port number for which we want to find the mapped port.\r\n\r\n```sh\r\n$docker port 7e87 80\r\n```\r\n\r\nYou will see:\r\n\r\n```sh\r\n0.0.0.0:32774\r\n```\r\n\r\nStep 3\r\n---------\r\n\r\nUse the command boot2docker ip and browse to http://192.168.59.103:32774/\r\n\r\nThis displays:\r\n\r\nDirectory listing for /\r\n\r\n```sh\r\n.gitignore\r\napp.py\r\nProcfile\r\nrequirements.txt\r\ntests.py\r\n```\r\n\r\nin the browser.\r\n\r\n\r\nStep 4\r\n---------\r\n\r\nYou can also manaully map port.\r\n\r\n```sh\r\n$docker run -d -p 8080:80 training/webapp python -m SimpleHTTPServer 80\r\n```\r\n\r\nYou will see:\r\n\r\n```sh\r\n61a9a4e4dcf0d12bf6f3b3df6ecc68a8d763c97ca9e32396f95104bfad1f26d3\r\n```\r\n\r\nThe -p flag takes the form: host_port:container_port. This maps port 8080 on the host to port 80 inside the container. This prevents you from spinning up multiple instances of the same image. Since the ports will conflict. Containers also have their own private IP address.\r\n\r\n```sh\r\n$ docker ps\r\n```\r\n\r\nYou will see:\r\n\r\n```sh\r\nCONTAINER ID        IMAGE                    COMMAND                CREATED             STATUS              PORTS                                           NAMES\r\n61a9a4e4dcf0        training/webapp:latest   \"python -m SimpleHTT   5 seconds ago       Up 4 seconds        5000/tcp, 0.0.0.0:8080->80/tcp                  tender_hoover       \r\n7e87240f931b        training/webapp:latest   \"python -m SimpleHTT   2 days ago          Up 2 days           5000/tcp, 0.0.0.0:32774->80/tcp                 hungry_jones        \r\n603f6666054b        nginx:latest             \"nginx -g \'daemon of   4 days ago          Up 2 days           0.0.0.0:32773->80/tcp, 0.0.0.0:32772->443/tcp   web  \r\n```\r\n\r\nStep 5\r\n---------\r\n\r\nWe can use docker inspect command to find the IP address of the container. \r\n\r\n```sh\r\n$ docker inspect --format \'{{ .NetworkSettings.IPAddress }}\' 61a9\r\n```\r\n\r\nYou will see the IP.\r\n\r\n```sh\r\n172.17.0.18\r\n```\r\n\r\nThe --format flag selects a portion of the output returned by the docker inspect command. The default network used for Docker containers is 172.17.0.0/16. If it is already in use on your system, Docker will pick another one.\r\n\r\nStep 6\r\n---------\r\n\r\nWe can test connectivity to the container using the IP address we found out in the previous step. \r\n\r\n```sh\r\n$ping 172.17.0.18\r\n```\r\n\r\nFor some reason I am getting:\r\n\r\n```sh\r\nPING 172.17.0.18 (172.17.0.18): 56 data bytes\r\nRequest timeout for icmp_seq 0\r\nRequest timeout for icmp_seq 1\r\n36 bytes from svl-edge-22.inet.qwest.net (65.113.32.217): Destination Net Unreachable\r\nVr HL TOS  Len   ID Flg  off TTL Pro  cks      Src      Dst\r\n 4  5  00 5400 87be   0 0000  3d  01 3ec1 10.0.1.7  172.17.0.18 \r\n\r\nRequest timeout for icmp_seq 2\r\n36 bytes from svl-edge-22.inet.qwest.net (65.113.32.217): Destination Net Unreachable\r\nVr HL TOS  Len   ID Flg  off TTL Pro  cks      Src      Dst\r\n 4  5  00 5400 632f   0 0000  3d  01 6350 10.0.1.7  172.17.0.18 \r\n```\r\n\r\nDebug Session from Another Machine\r\n\r\n```sh\r\n~/temp/namer $docker run -d -p 80 training/webapp python -m SimpleHTTPServer 80\r\nUnable to find image \'training/webapp:latest\' locally\r\nlatest: Pulling from training/webapp\r\n23f0158a1fbe: Pull complete \r\n0a4852b23749: Pull complete \r\na82efea989f9: Already exists \r\n37bea4ee0c81: Already exists \r\nDigest: sha256:06e9c1983bd6d5db5fba376ccd63bfa529e8d02f23d5079b8f74a616308fb11d\r\nStatus: Downloaded newer image for training/webapp:latest\r\n9d1e6da2594ac99a758e56782bdbeedb34e14cc6934cbc6335867f57352f8530\r\n~/temp/namer $docker ps\r\nCONTAINER ID        IMAGE               COMMAND                CREATED             STATUS              PORTS                             NAMES\r\n9d1e6da2594a        training/webapp     \"python -m SimpleHTT   17 seconds ago      Up 16 seconds       5000/tcp, 0.0.0.0:32768->80/tcp   desperate_davinci   \r\n~/temp/namer $docker port 9d1e6da2594a\r\n80/tcp -> 0.0.0.0:32768\r\n~/temp/namer $boot2docker ip\r\n192.168.59.103\r\n~/temp/namer $docker inspect --format \'{{ .NetworkSettings.IPAddress }}\' 9d1e6da2594a\r\n172.17.0.29\r\n~/temp/namer $ping 172.17.0.29\r\nPING 172.17.0.29 (172.17.0.29): 56 data bytes\r\nRequest timeout for icmp_seq 0\r\nRequest timeout for icmp_seq 1\r\n--- 172.17.0.29 ping statistics ---\r\n11 packets transmitted, 0 packets received, 100.0% packet loss\r\n~/temp/namer $ifconfig | less\r\n~/temp/namer $ifconfig | less -p 172\r\n~/temp/namer $docker ps\r\nCONTAINER ID        IMAGE               COMMAND                CREATED             STATUS              PORTS                             NAMES\r\n9d1e6da2594a        training/webapp     \"python -m SimpleHTT   3 minutes ago       Up 3 minutes        5000/tcp, 0.0.0.0:32768->80/tcp   desperate_davinci   \r\n~/temp/namer $docker exec -it 9d bash\r\nroot@9d1e6da2594a:/opt/webapp# ifconfig \r\neth0      Link encap:Ethernet  HWaddr 02:42:ac:11:00:1d  \r\n          inet addr:172.17.0.29  Bcast:0.0.0.0  Mask:255.255.0.0\r\n          inet6 addr: fe80::42:acff:fe11:1d/64 Scope:Link\r\n          UP BROADCAST RUNNING  MTU:1500  Metric:1\r\n          RX packets:21 errors:0 dropped:0 overruns:0 frame:0\r\n          TX packets:21 errors:0 dropped:0 overruns:0 carrier:0\r\n          collisions:0 txqueuelen:0 \r\n          RX bytes:2201 (2.2 KB)  TX bytes:2427 (2.4 KB)\r\n\r\nlo        Link encap:Local Loopback  \r\n          inet addr:127.0.0.1  Mask:255.0.0.0\r\n          inet6 addr: ::1/128 Scope:Host\r\n          UP LOOPBACK RUNNING  MTU:65536  Metric:1\r\n          RX packets:0 errors:0 dropped:0 overruns:0 frame:0\r\n          TX packets:0 errors:0 dropped:0 overruns:0 carrier:0\r\n          collisions:0 txqueuelen:0 \r\n          RX bytes:0 (0.0 B)  TX bytes:0 (0.0 B)\r\n\r\nroot@9d1e6da2594a:/opt/webapp# ps -ef | grep \r\nUsage: grep [OPTION]... PATTERN [FILE]...\r\nTry \'grep --help\' for more information.\r\nroot@9d1e6da2594a:/opt/webapp# ps -ef        \r\nUID        PID  PPID  C STIME TTY          TIME CMD\r\nroot         1     0  0 02:59 ?        00:00:01 python -m SimpleHTTPServer 8\r\nroot         5     0  1 03:03 ?        00:00:00 bash\r\nroot        21     5  0 03:03 ?        00:00:00 ps -ef\r\nroot@9d1e6da2594a:/opt/webapp# ping 172.17.0.29 \r\nPING 172.17.0.29 (172.17.0.29) 56(84) bytes of data.\r\n64 bytes from 172.17.0.29: icmp_seq=1 ttl=64 time=0.115 ms\r\n64 bytes from 172.17.0.29: icmp_seq=2 ttl=64 time=0.385 ms\r\n64 bytes from 172.17.0.29: icmp_seq=3 ttl=64 time=0.017 ms\r\n^C\r\n--- 172.17.0.29 ping statistics ---\r\n3 packets transmitted, 3 received, 0% packet loss, time 2014ms\r\nrtt min/avg/max/mdev = 0.017/0.172/0.385/0.155 ms\r\nroot@9d1e6da2594a:/opt/webapp# exit\r\n~/temp/namer $docker ps \r\nCONTAINER ID        IMAGE               COMMAND                CREATED             STATUS              PORTS                             NAMES\r\n9d1e6da2594a        training/webapp     \"python -m SimpleHTT   5 minutes ago       Up 5 minutes        5000/tcp, 0.0.0.0:32768->80/tcp   desperate_davinci   \r\n~/temp/namer $docker exec -it 9d bash\r\nroot@9d1e6da2594a:/opt/webapp# curl 0.0.0.0:5000\r\nbash: curl: command not found\r\nroot@9d1e6da2594a:/opt/webapp# apt\r\napt                   apt-extracttemplates  apt-mark\r\napt-cache             apt-ftparchive        apt-sortpkgs\r\napt-cdrom             apt-get               \r\napt-config            apt-key               \r\nroot@9d1e6da2594a:/opt/webapp# apt-get install -y curl\r\nReading package lists... Done\r\nBuilding dependency tree       \r\nReading state information... Done\r\nThe following extra packages will be installed:\r\n  krb5-locales libasn1-8-heimdal libcurl3 libgssapi-krb5-2 libgssapi3-heimdal\r\n  libhcrypto4-heimdal libheimbase1-heimdal libheimntlm0-heimdal\r\n  libhx509-5-heimdal libidn11 libk5crypto3 libkeyutils1 libkrb5-26-heimdal\r\n  libkrb5-3 libkrb5support0 libldap-2.4-2 libroken18-heimdal librtmp0\r\n  libsasl2-2 libsasl2-modules libsasl2-modules-db libwind0-heimdal\r\nSuggested packages:\r\n  krb5-doc krb5-user libsasl2-modules-otp libsasl2-modules-ldap\r\n  libsasl2-modules-sql libsasl2-modules-gssapi-mit\r\n  libsasl2-modules-gssapi-heimdal\r\nThe following NEW packages will be installed:\r\n  curl krb5-locales libasn1-8-heimdal libcurl3 libgssapi-krb5-2\r\n  libgssapi3-heimdal libhcrypto4-heimdal libheimbase1-heimdal\r\n  libheimntlm0-heimdal libhx509-5-heimdal libidn11 libk5crypto3 libkeyutils1\r\n  libkrb5-26-heimdal libkrb5-3 libkrb5support0 libldap-2.4-2\r\n  libroken18-heimdal librtmp0 libsasl2-2 libsasl2-modules libsasl2-modules-db\r\n  libwind0-heimdal\r\n0 upgraded, 23 newly installed, 0 to remove and 3 not upgraded.\r\nNeed to get 2008 kB of archives.\r\nAfter this operation, 10.2 MB of additional disk space will be used.\r\n0% [Connecting to archive.ubuntu.com]^C\r\nroot@9d1e6da2594a:/opt/webapp#   \r\nDisplay all 873 possibilities? (y or n)^C\r\nroot@9d1e6da2594a:/opt/webapp# exit    \r\n\r\n~/temp/namer $docker run -d -p 80 training/webapp python -m SimpleHTTPServer 80\r\n~/temp/namer $docker ps -a\r\nCONTAINER ID        IMAGE               COMMAND               PORTS                             NAMES\r\n9d1e6da2594a        training/webapp     \"python -m SimpleHTT  5000/tcp, 0.0.0.0:32768->80/tcp   desperate_davinci       \r\nf6b5cf85fafe        training/namer      \"/bin/bash\"                                             cocky_newton            \r\n79d6c2d2e66b        training/namer      \"/bin/bash\"                                             serene_poincare         \r\n410dc3704fd9        training/namer      \"/bin/bash\"                                             admiring_mcclintock     \r\nbd09308a91d5        training/namer      \"/bin/bash\"                                             insane_lovelace         \r\nce525b98a46f        training/namer      \"/bin/bash\"                                             grave_rosalind          \r\nf7d41edb061a        training/namer      \"/bin/bash\"                                             tender_einstein         \r\n0ac7f8566c3a        training/namer      \"/bin/bash\"                                             prickly_mcclintock      \r\nd66f1d19515b        training/namer      \"rackup\"                                                drunk_ritchie           \r\n88271d810807        training/namer      \"rackup\"                                                compassionate_einstein  \r\n0503074f21c9        bparanj/hello       \"/bin/bash\"                                             cocky_kilby             \r\n12a028f7aa07        ruby                \"bash\"                                                  determined_hypatia      \r\n48d6cf513dfc        bparanj/hello       \"ruby hello.rb\"                                         agitated_fermat         \r\n\r\n~/temp/namer $docker ps\r\nCONTAINER ID        IMAGE               COMMAND              PORTS                             NAMES\r\n9d1e6da2594a        training/webapp     \"python -m SimpleHTT 5000/tcp, 0.0.0.0:32768->80/tcp   desperate_davinci   \r\n~/temp/namer $docker kill 9d\r\n9d\r\n~/temp/namer $docker run -d -p 80:80 -p 5000:5000 training/webapp python -m SimpleHTTPServer 80\r\n34bf5c456f457689a46127c243bbe2c5297457e9df18939af920bbeb02a288fb\r\n  501 99086   346   0  4Jun15 ??         0:00.16 /usr/libexec/USBAgent\r\n    0   466   359   0 27May15 ttys000    0:00.02 login -pfl bparanj /bin/bash -c exec -la bash /bin/bash\r\n  501   467   466   0 27May15 ttys000    0:00.21 -bash\r\n    0 80947   359   0  7:27PM ttys001    0:00.43 login -pf bparanj\r\n  501 80948 80947   0  7:27PM ttys001    0:00.46 -bash\r\n    0 81558 80948   0  8:06PM ttys001    0:00.01 ps -ef\r\n    0 81261   359   0  7:46PM ttys002    0:00.02 login -pfl bparanj /bin/bash -c exec -la bash /bin/bash\r\n  501 81262 81261   0  7:46PM ttys002    0:00.19 -bash\r\n    0   933   359   0 27May15 ttys007    0:00.02 login -pfl bparanj /bin/bash -c exec -la bash /bin/bash\r\n  501   934   933   0 27May15 ttys007    0:04.10 -bash\r\n  501 69416   934   0 11Jun15 ttys007    0:01.38 ruby /Users/bparanj/.rvm/gems/ruby-2.2.2@alex/bin/knife solo prepare vagrant@localhost -i /Users/bparanj/.vagrant.d/insecure_private_key -p 2222 -N local.vagrant.json           \r\n    0   949   359   0 27May15 ttys008    0:00.02 login -pfl bparanj /bin/bash -c exec -la bash /bin/bash\r\n  501   961   949   0 27May15 ttys008    0:04.09 -bash\r\n    0  1077   359   0 27May15 ttys009    0:00.02 login -pfl bparanj /bin/bash -c exec -la bash /bin/bash\r\n  501  1078  1077   0 27May15 ttys009    0:00.74 -bash\r\n    0  1218   359   0 27May15 ttys011    0:00.02 login -pfl bparanj /bin/bash -c exec -la bash /bin/bash\r\n  501  1224  1218   0 27May15 ttys011    0:00.21 -bash\r\n    0  1392   359   0 27May15 ttys013    0:00.02 login -pfl bparanj /bin/bash -c exec -la bash /bin/bash\r\n  501  1393  1392   0 27May15 ttys013    0:00.47 -bash\r\n    0  1456   359   0 27May15 ttys014    0:00.02 login -pfl bparanj /bin/bash -c exec -la bash /bin/bash\r\n  501  1493  1456   0 27May15 ttys014    0:01.05 -bash\r\n~/temp/namer $docker ps\r\nCONTAINER ID        IMAGE               COMMAND                CREATED             STATUS              PORTS                                        NAMES\r\n34bf5c456f45        training/webapp     \"python -m SimpleHTT   13 seconds ago      Up 11 seconds       0.0.0.0:80->80/tcp, 0.0.0.0:5000->5000/tcp   loving_hodgkin      \r\n~/temp/namer $telnet 0.0.0.0 5000\r\nTrying 0.0.0.0...\r\ntelnet: connect to address 0.0.0.0: Connection refused\r\ntelnet: Unable to connect to remote host\r\n~/temp/namer $docker exec -it 34 bash\r\nroot@34bf5c456f45:/opt/webapp# netstat -tnaup \r\nActive Internet connections (servers and established)\r\nProto Recv-Q Send-Q Local Address           Foreign Address         State       PID/Program name\r\ntcp        0      0 0.0.0.0:80              0.0.0.0:*               LISTEN      1/python        \r\ntcp        0      0 172.17.0.30:80          192.168.59.3:61502      TIME_WAIT   -               \r\nroot@34bf5c456f45:/opt/webapp# \r\n```\r\n \r\nStep 7\r\n---------\r\n\r\nTo stop the running container:\r\n\r\n```sh\r\ndocker stop container-id\r\n```\r\n\r\nStep 8\r\n---------\r\n\r\nTo remove the container.\r\n\r\n```sh\r\ndocker rm container-id\r\n```\r\n\r\nSummary\r\n========\r\n---------\r\n\r\nIn this article, you learned how to expose a network port, container networking basics such as finding it\'s IP address, stopping and removing container.','2015-06-17 23:30:49','2015-06-21 22:31:18'),(2431,'Docker Basics : Working with Volumes','Objectives\r\n=========\r\n---------\r\n\r\n- Create containers holding volumes\r\n- Share volumes across containers\r\n- Share a host directory with one or many containers\r\n\r\nDiscussion\r\n=========\r\n---------\r\n\r\nDocker volumes can be used to achieve things like:\r\n\r\n- Bypassing the copy-on-write system to obtain native disk I/O performance\r\n- Bypassing copy-on-write to leave some files out of docker commit\r\n- Sharing a directory between multiple containers\r\n- Sharing a directory between the host and a container\r\n- Sharing a single file between the host and a container\r\n\r\nSteps\r\n=========\r\n---------\r\n\r\nStep 1\r\n---------\r\n\r\nVolumes can be declared in two different ways. Within a Dockerfile, with a VOLUME instruction.\r\n\r\n```sh\r\nVOLUME /var/lib/postgresql\r\n```\r\n\r\nOn the command-line, with the -v flag for docker run.\r\n\r\n```sh\r\n$docker run -d -v /var/lib/postgresql training/postgres\r\n```\r\n\r\n```sh\r\nUnable to find image \'training/postgres:latest\' locally\r\nPulling repository training/postgres\r\n258105bea10d: Download complete \r\n... \r\nStatus: Downloaded newer image for training/postgres:latest\r\n7ecbc638f0fc6d7f20a11f53442abba1b616159b470a37afa6529b7ad5286ea4\r\n```\r\n\r\nIn both cases, /var/lib/postgresql inside the container will be a volume. Volumes bypass the copy-on-write system. Volumes act as passthroughts to the host filesystem. \r\n\r\n- The I/O performance on a volume is exactly the same as I/O performance on the Docker host.\r\n- When you docker commit, the content of volumes is not brought into the resulting image.\r\n- If a RUN instruction in a Dockerfile changes the content of a volume, those changes are not recorded either.\r\n\r\nStep 2\r\n---------\r\n\r\nVolumes can be shared across containers. You can start a container with exactly the same volumes as another one. The new container will have the same volumes, in the same directories. They will contain exactly the same thing and remain in sync. Under the hood, they are actually the same directories on the host anyway.\r\n\r\n```sh\r\n$docker run --name alpha -t -i -v /var/log ubuntu bash\r\nroot@fa89eab1310a:/# date > /var/log/now\r\n```\r\n\r\nIn another terminal, let\'s start another container with the same volume.\r\n\r\n```sh\r\n$docker run --volumes-from alpha ubuntu cat /var/log/now\r\n```\r\n\r\n```sh\r\nFATA[0000] Post http://127.0.0.1:2375/v1.18/containers/create: EOF. Are you trying to connect to a TLS-enabled daemon without TLS? \r\n```\r\n\r\nTo solve this problem:\r\n\r\n```sh\r\n$ boot2docker start\r\nWaiting for VM and Docker daemon to start...\r\n.o\r\nStarted.\r\nWriting /Users/zepho/.boot2docker/certs/boot2docker-vm/ca.pem\r\nWriting /Users/zepho/.boot2docker/certs/boot2docker-vm/cert.pem\r\nWriting /Users/zepho/.boot2docker/certs/boot2docker-vm/key.pem\r\n\r\nTo connect the Docker client to the Docker daemon, please set:\r\n    export DOCKER_CERT_PATH=/Users/zepho/.boot2docker/certs/boot2docker-vm\r\n    export DOCKER_TLS_VERIFY=1\r\n    export DOCKER_HOST=tcp://192.168.59.103:2376\r\n\r\nzepho-mac-pro:~ zepho$ export DOCKER_CERT_PATH=/Users/zepho/.boot2docker/certs/boot2docker-vm\r\nzepho-mac-pro:~ zepho$ export DOCKER_TLS_VERIFY=1\r\nzepho-mac-pro:~ zepho$ export DOCKER_HOST=tcp://192.168.59.103:2376\r\nzepho-mac-pro:~ zepho$ docker run   --volumes-from alpha ubuntu cat /var/log/now\r\nWed Jun 17 23:58:04 UTC 2015\r\n```\r\n\r\nVolumes exist independently of containers. If a container is stopped, its volumes still exist and are available. In the last example, it doesn\'t matter if container alpha is running or not.\r\n\r\nStep 3\r\n---------\r\n\r\nA data container is a container created for the sole purpose of referencing one or many volumes. It is typically created with a no-op command:\r\n\r\n```sh\r\n$docker run --name wwwdata -v /var/lib/www busybox true\r\n$docker run --name wwwlogs -v /var/log/www busybox true\r\n```\r\n\r\n- We created two data containers.\r\n- They are using the busybox image, a tiny image.\r\n- We used the command true, possibly the simplest command in the world.\r\n- We named each container to reference them easily later.\r\n\r\nStep 4\r\n---------\r\n\r\nThis is not working right now. Data containers are used by other containers via --volumes-from. Here is an example using the previously created volumes:\r\n\r\n```sh\r\ndocker run -d --volumes-from wwwdata --volumes-from wwwlogs webserver\r\n```\r\n\r\n```sh\r\nUnable to find image \'webserver:latest\' locally\r\nPulling repository webserver\r\nFATA[0002] Error: image library/webserver:latest not found \r\n```\r\n\r\nThe webserver:latest image does not exist, let\'s use nginx:\r\n\r\n```sh\r\nnginx:latest: The image you are pulling has been verified. Important: image verification is a tech preview feature and should not be relied on to provide security.\r\nDigest: sha256:0952acc92b56f936b5b5b93a6b7abb9205ec7ec64b920e113a6d9dae50f6f49d\r\nStatus: Downloaded newer image for nginx:latest\r\n3a1fb0c845205d3d53011867cb2cb24385582f2592f3a95d2363fa6e3a274fa2\r\n```\r\n\r\n```sh\r\ndocker run -d --volumes-from wwwdata ftpserver\r\n```\r\n\r\n```sh\r\nPulling repository ftpserver\r\nFATA[0002] Error: image library/ftpserver:latest not found \r\n```\r\n\r\n```sh\r\ndocker run -d --volumes-from wwwlogs pipestash\r\n```\r\n\r\n```sh\r\nPulling repository pipestash\r\nFATA[0002] Error: image library/pipestash:latest not found \r\n```\r\n\r\nThe current docker registry at https://registry.hub.docker.com/ does not have the ftpserver or pipestash images available. That\'s the reason for the failures. The first container runs a webserver, serving content from /var/lib/www and logging to /var/log/www. The second container runs a FTP server, allowing to upload content to the same /var/lib/www path. The third container collects the logs and sends them to logstash, a log storage and analysis system.\r\n\r\nStep 5\r\n---------\r\n\r\nSharing a directory between the host and a container.\r\n\r\n```sh\r\n$docker run -t -i -v /src/webapp:/var/html/webapp ubuntu /bin/bash\r\n```\r\n\r\nThis will mount the /src/webapp directory into the container at /var/www/html/webapp.\r\n\r\n```sh\r\nroot@4f3524ebb182:/# pwd\r\n/\r\nroot@4f3524ebb182:/# cd /src\r\nbash: cd: /src: No such file or directory\r\nroot@4f3524ebb182:/# cd /var\r\nroot@4f3524ebb182:/var# cd html\r\nroot@4f3524ebb182:/var/html# ll\r\ntotal 8\r\ndrwxr-xr-x  3 root root 4096 Jun 18 00:23 ./\r\ndrwxr-xr-x 13 root root 4096 Jun 18 00:23 ../\r\ndrwxr-xr-x  2 root root   40 Jun 18 00:23 webapp/\r\nroot@4f3524ebb182:/var/html# cd webapp\r\nroot@4f3524ebb182:/var/html/webapp# ll\r\ntotal 4\r\ndrwxr-xr-x 2 root root   40 Jun 18 00:23 ./\r\ndrwxr-xr-x 3 root root 4096 Jun 18 00:23 ../\r\n```\r\n\r\nIt defaults to mounting read-write but we can also mount read-only.\r\n\r\n```sh\r\n$docker run -t -i -v /src/webapp:/var/www/html/webapp:ro ubuntu /bin/bash\r\n```\r\n\r\nThose volumes can also be shared with --volumes-from.\r\n\r\nStep 6\r\n---------\r\n\r\nChecking volumes used by a container.\r\n\r\n```sh\r\n$docker ps\r\n```\r\n\r\n```sh\r\nCONTAINER ID        IMAGE                      COMMAND               PORTS                                           NAMES\r\n7ecbc638f0fc        training/postgres:latest   \"su postgres -c \'/us  5432/tcp                                        naughty_yonath      \r\n7e87240f931b        training/webapp:latest     \"python -m SimpleHTT  5000/tcp, 0.0.0.0:32774->80/tcp                 hungry_jones        \r\n603f6666054b        nginx:latest               \"nginx -g \'daemon of  0.0.0.0:32773->80/tcp, 0.0.0.0:32772->443/tcp   web                \r\n```\r\n\r\nTo find the paths that are volumes and to what they are bound, use docker inspect.\r\n\r\n```sh\r\ndocker inspect 7ecb\r\n```\r\n\r\n```sh\r\n[{\r\n    \"AppArmorProfile\": \"\",\r\n    \"Args\": [\r\n        \"postgres\",\r\n        \"-c\",\r\n        \"/usr/lib/postgresql/$PG_VERSION/bin/postgres -D /var/lib/postgresql/$PG_VERSION/main/ -c config_file=/etc/postgresql/$PG_VERSION/main/postgresql.conf\"\r\n    ],\r\n\r\n  \"Volumes\": {\r\n        \"/var/lib/postgresql\": \"/mnt/sda1/var/lib/docker/vfs/dir/3957ebad3f0860b3295d67e8a8993b636e8963432e65a23ba2fd40a2d19e18e6\"\r\n    },\r\n    \"VolumesRW\": {\r\n        \"/var/lib/postgresql\": true\r\n    }\r\n}\r\n]\r\n```\r\n\r\nWe can see that our volume is present on the file system of the Docker host.\r\n\r\nStep 7\r\n---------\r\n\r\nSharing a single file between the host and a container. The -v flag can be used to share a single file.\r\n\r\n```sh\r\n$ echo 123456789 > /tmp/numbers\r\nzepho-mac-pro:namer zepho$ cat /tmp/numbers\r\n123456789\r\nzepho-mac-pro:namer zepho$ docker run -t -i -v /tmp/numbers:/numbers ubuntu bash\r\nroot@7adde2f7e43f:/# cat /numbers\r\ncat: /numbers: Is a directory\r\n```\r\n\r\nThis is not working.\r\n\r\nSummary\r\n========\r\n---------\r\n\r\nIn this article, you learned how to create containers holding volumes, share volumes across containers and share a host directory with one or many containers.','2015-06-18 20:51:36','2015-06-21 22:05:23'),(2441,'Docker Basics : Connecting Containers','Objectives\r\n=========\r\n---------\r\n\r\n- Launch named containers.\r\n- Create links between containers.\r\n- Use names and links to communicate across containers.\r\n- Use these features to decouple app dependencies and reduce complexity.\r\n\r\nDiscussion\r\n=========\r\n---------\r\n\r\nWe will learn how to use name and links to expose one container\'s ports to another. Why? So each component of your app such as DB, web app can run independently with its own dependencies. We\'re going to:\r\n\r\n- get two images: a PostgreSQL database image and a Ruby on Rails application image. \r\n- start containers from each image. \r\n- link the containers running our Rails application and database using Docker\'s link primitive. \r\n\r\nSteps\r\n=========\r\n---------\r\n\r\nStep 1\r\n---------\r\n\r\nLet\'s pull down the database image.\r\n\r\n```sh\r\n$docker pull training/postgres\r\n```\r\n\r\n```sh\r\nPulling repository training/postgres\r\n258105bea10d: Download complete \r\n511136ea3c5a: Download complete \r\n...\r\nStatus: Image is up to date for training/postgres:latest\r\n```\r\n\r\nLet\'s review the image:\r\n\r\n```sh\r\n$docker images training/postgres\r\n```\r\n\r\n```sh\r\nREPOSITORY          TAG                 IMAGE ID            CREATED             VIRTUAL SIZE\r\ntraining/postgres   latest              258105bea10d        12 months ago       364.6 MB\r\n```\r\n\r\nStep 2\r\n---------\r\n\r\nLet\'s look at the Dockerfile that built this image. \r\n\r\n```sh\r\nFROM ubuntu:14.04\r\nMAINTAINER Docker Education Team <education@docker.com>\r\n\r\nENV PG_VERSION 9.3\r\nRUN locale-gen en_US.UTF-8\r\nRUN apt-get update\r\nRUN apt-get -y install postgresql postgresql-client postgresql-contrib\r\n\r\nRUN pg_dropcluster $PG_VERSION main && pg_createcluster --locale en_US.UTF-8 $PG_VERSION main\r\n\r\nRUN echo \"host    all             all             0.0.0.0/0 trust\" >> /etc/postgresql/$PG_VERSION/main/pg_hba.conf\r\nRUN echo \"listen_addresses=\'*\'\" >> /etc/postgresql/$PG_VERSION/main/postgresql.conf\r\n\r\nRUN service postgresql start && \\\r\n su postgres sh -c \"createuser -d -r -s docker\" && \\\r\n su postgres sh -c \"createdb -O docker docker\" && \\\r\n su postgres sh -c \"psql -c \\\"GRANT ALL PRIVILEGES ON DATABASE docker to docker;\\\"\"\r\n\r\nEXPOSE 5432\r\nCMD [\"su\", \"postgres\", \"-c\", \"/usr/lib/postgresql/$PG_VERSION/bin/postgres -D /var/lib/postgresql/$PG_VERSION/main/ -c config_file=/etc/postgresql/$PG_VERSION/main/postgresql.conf\"]\r\n```\r\n\r\nThis image is based on ubuntu:14.04 base image. It specifies a number of environment variables. It install the required packages and configures the PostgreSQL database settings. It exposes port 5432. It runs the PostgreSQL database when a container is launched from the image.\r\n\r\n```sh\r\nEXPOSE 5432\r\n```\r\n\r\nwill expose a port to our Rails application in another container, not to the host.\r\n\r\nStep 3\r\n---------\r\n\r\nLet\'s luanch a container from the training/postgres image.\r\n\r\n```sh\r\n$docker run -d --name database training/postgres\r\n```\r\n\r\n```sh\r\n802443b6a4f2e05bf09d75adaa7a05b56c285f5843873ff7e4933b6f5ef97d4b\r\n```\r\n\r\nLet\'s check the container is running.\r\n\r\n```sh\r\n$docker ps -l\r\n```\r\n\r\n```sh\r\nCONTAINER ID        IMAGE                      COMMAND                CREATED             STATUS              PORTS               NAMES\r\n802443b6a4f2        training/postgres:latest   \"su postgres -c \'/us   30 seconds ago      Up 28 seconds       5432/tcp            database         \r\n```\r\n\r\nOur container is launched and running a PostgreSQL database. Using the --name flag, we have given it a name: database. Container names are unique. We are going to use that name.\r\n\r\nStep 4\r\n---------\r\n\r\nLet\'s pull down our Rails application image.\r\n\r\n```sh\r\n$docker pull training/notes\r\n```\r\n\r\n```sh\r\nPulling repository training/notes\r\nd347176e7bb1: Download complete \r\n511136ea3c5a: Download complete \r\n...\r\nStatus: Downloaded newer image for training/notes:latest\r\n```\r\n\r\nReview it:\r\n\r\n```sh\r\n$docker images training/notes\r\n```\r\n\r\n```sh\r\nREPOSITORY          TAG                 IMAGE ID            CREATED             VIRTUAL SIZE\r\ntraining/notes      latest              d347176e7bb1        9 months ago        476.7 MB\r\n```\r\n\r\nStep 5\r\n---------\r\n\r\nLet\'s look at the Dockerfile that built this image.\r\n\r\n```sh\r\nFROM ubuntu:14.04\r\nMAINTAINER Docker Education Team <education@docker.com>\r\n\r\nRUN apt-get update\r\nRUN apt-get install -y ruby ruby-dev libpq-dev build-essential\r\nRUN gem install sinatra bundler --no-ri --no-rdoc\r\n\r\nADD . /opt/dockernotes\r\n\r\nWORKDIR /opt/dockernotes\r\nRUN bundle install\r\n\r\nEXPOSE 3000\r\nCMD bundle exec rails s\r\n```\r\n\r\nThis image is based on the ubuntu base image using the 14.04 tag to get Ruby 1.9.3. It installs the required packages. Adds the Rails application itself to the /opt/dockernotes directory. Exposes port 3000. Runs Ruby on Rails when a container is launched from the image.\r\n\r\nStep 6\r\n---------\r\n\r\nLet\'s launch a container from the training/notes image. Let\'s setup the application database schema.\r\n\r\n```sh\r\ndocker run --name rails training/notes rake db:create db:migrate\r\n```\r\n\r\nThe container fails to start.\r\n\r\n```sh\r\ncould not connect to server: No such file or directory\r\n	Is the server running locally and accepting\r\n	connections on Unix domain socket \"/var/run/postgresql/.s.PGSQL.5432\"?\r\n```\r\n	\r\nThe Rails application needs access to the database to run.\r\n\r\nStep 7\r\n---------\r\n\r\nContainer names are unique. You can only have one container named rails at a time. Let\'s delete our container so we can use that name again.\r\n\r\n```sh\r\n$docker rm rails\r\n```\r\n\r\nStep 8\r\n---------\r\n\r\nLet\'s link our container to our existing PostgreSQL container. The rake command below is a one-time process that needs to be done in all Rails applications to initialize the database.\r\n\r\n```sh\r\n$docker run -i -t --name rails --link database:db training/notes rake db:create db:migrate\r\n```\r\n\r\n```sh\r\n==  CreateNotes: migrating ====================================================\r\n-- create_table(:notes)\r\n   -> 0.0062s\r\n==  CreateNotes: migrated (0.0064s) ===========================================\r\n```\r\n\r\nThe --link flag connects one container to another. We specify the name of the container to link to, database, and an alias for the link \'db\'.\r\n\r\nStep 9\r\n---------\r\n\r\nWe can remove the container.\r\n\r\n```sh\r\ndocker rm rails\r\n```\r\n\r\nStep 10\r\n---------\r\n\r\nThe link provides a secure tunnel between containers. On our database container port 5432 has been exposed to the linked container. Docker will automatically set environment variables in our container, to indicate connection information. Let\'s see that information.\r\n\r\n```sh\r\ndocker run --rm --link database:db training/notes env\r\n```\r\n\r\n```sh\r\nPATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin\r\nHOSTNAME=1d5cae52b3f6\r\nDB_PORT=tcp://172.17.0.33:5432\r\nDB_PORT_5432_TCP=tcp://172.17.0.33:5432\r\nDB_PORT_5432_TCP_ADDR=172.17.0.33\r\nDB_PORT_5432_TCP_PORT=5432\r\nDB_PORT_5432_TCP_PROTO=tcp\r\nDB_NAME=/reverent_ptolemy/db\r\nDB_ENV_PG_VERSION=9.3\r\nHOME=/\r\n```\r\n\r\nEach variable is prefixed with the link alias: db. It includes connection information plus any environment variables set in the database container via ENV instructions. The --rm removes the container after it exits, as this is not a long running container.\r\n\r\nStep 11\r\n---------\r\n\r\nNow we\'ve configured our database. Let\'s start the application in a new container.\r\n\r\n```sh\r\n$docker run -d -p 80:3000 --name rails --link database:db training/notes\r\n```\r\n\r\nYou will see:\r\n\r\n```sh\r\nc8f36026e8a2c1fdc3dfd43b99101f90bf895b22514f513f3efae4a4313ee858\r\n```\r\n\r\nCheck the container is running.\r\n\r\n```sh\r\n$docker ps -l\r\n```\r\n\r\n```sh\r\nCONTAINER ID        IMAGE                   COMMAND                CREATED             STATUS              PORTS                  NAMES\r\nc8f36026e8a2        training/notes:latest   \"/bin/sh -c \'bundle    29 seconds ago      Up 28 seconds       0.0.0.0:80->3000/tcp   rails               \r\n```\r\nStep 12\r\n---------\r\n\r\nBrowse to http://192.168.59.103:80 to view the Rails application. You can find the IP address to use by running:\r\n\r\n```sh\r\n$boot2docker ip\r\n192.168.59.103\r\n```\r\n\r\nStep 13\r\n---------\r\n\r\nLet\'s cleanup.\r\n\r\n```sh\r\n$ docker kill rails database\r\nrails\r\ndatabase\r\n```\r\n\r\n```sh\r\n$ docker rm rails database\r\nrails\r\ndatabase\r\n```\r\n\r\nWe can use container names to stop and remove them. We removed them so we can re-use their name later. \r\n\r\nSummary\r\n========\r\n---------\r\n\r\nIn this article, we learned how to launch named containers, create links between containers, use name and links to communicate across containers. Use these features to decouple app dependencies and reduce complexity.','2015-06-18 22:25:22','2015-06-18 22:25:22'),(2451,'Docker Basics : Local Development Workflow with Docker','Objectives\r\n=========\r\n---------\r\n\r\n- Share code between container and host\r\n- Use a simple local development workflow\r\n\r\nDiscussion\r\n=========\r\n---------\r\n\r\nDocker containers are perfect for local development. Let\'s pull a web application image to see how to use a Docker container for local development.\r\n\r\nSteps\r\n=========\r\n---------\r\n\r\nStep 1\r\n---------\r\n\r\n```sh\r\n$docker pull training/namer\r\n```\r\n\r\nThe training/namer image is based on the Ubuntu image. It contains:\r\n\r\n- Ruby\r\n- Sinatra\r\n- Required dependencies\r\n\r\nYou will see:\r\n\r\n```sh\r\nlatest: Pulling from training/namer\r\ne9e06b06e14c: Pull complete \r\na82efea989f9: Pull complete \r\n...\r\n15faf92cfc78: Already exists \r\nDigest: sha256:23c65dee5c9f8fe46dcf9a9dbd1c91e7550235bd772df9839094dcec460386a4\r\nStatus: Downloaded newer image for training/namer:latest\r\n```\r\n\r\nStep 2\r\n---------\r\n\r\nAdding our source code. Download our application source code.\r\n\r\n```sh\r\ngit clone https://github.com/docker-training/namer.git\r\ncd namer\r\nls -l\r\n```\r\n\r\nYou will see:\r\n\r\n```sh\r\n-rw-r--r--  1 zepho  staff  342 Jun 14 14:27 Dockerfile\r\n-rw-r--r--  1 zepho  staff   79 Jun 14 14:27 Gemfile\r\n-rw-r--r--  1 zepho  staff   81 Jun 14 14:27 README.md\r\n-rw-r--r--  1 zepho  staff  513 Jun 14 14:27 company_name_generator.rb\r\n-rw-r--r--  1 zepho  staff  115 Jun 14 14:27 config.ru\r\n```\r\n\r\nStep 3\r\n---------\r\n\r\nLet\'s create a container from our image. We have an image, source code and now we can add a container to run that code.\r\n\r\n```sh\r\n$docker run -d -v $(pwd):/opt/namer -w /opt/namer -p 80:9292 training/namer rackup\r\n```\r\n\r\n• The -d flag indicates that the container should run in daemon mode (in the background).\r\n• The -v flag provides volume mounting inside containers.\r\n• The -w flag sets the working directory inside the container.\r\n• The -p flag maps port 9292 inside the container to port 80 on the host.\r\n\r\nYou will see:\r\n\r\n```sh\r\n06fe017c75a4161d6b743bb3d959228390795d104297787700e8b4ec4694c122\r\n```\r\n\r\nWe have launched the application with the training/namer image and the rackup command. Notes on Mounting volumes inside containers: The -v flag mounts a directory from your host into your Docker container. The flag structure is:\r\n\r\n```sh\r\n[host-path]:[container-path]:[rw|ro]\r\n```\r\n\r\n• If [host-path] or [container-path] doesn\'t exist it is created.\r\n• You can control the write status of the volume with the ro and rw options.\r\n• If you don\'t specify rw or ro, it will be rw by default.\r\n\r\nStep 4\r\n---------\r\n\r\nNow let\'s see if our new container is running.\r\n\r\n```sh\r\n$docker ps\r\n```\r\n\r\nYou will see:\r\n\r\n```sh\r\nCONTAINER ID        IMAGE                   COMMAND             CREATED             STATUS              PORTS                  NAMES\r\n06fe017c75a4        training/namer:latest   \"rackup\"            7 minutes ago       Up 7 minutes        0.0.0.0:80->9292/tcp   sharp_galileo    \r\n```\r\n\r\nStep 5\r\n---------\r\n\r\nLet\'s browse to our web application on http://<your-host-ip>:80\r\n\r\nYou can find your IP address by running:\r\n\r\n```sh\r\n$boot2docker ip\r\n```\r\n\r\nIn my case the URL is http://192.168.59.103:80. This will fail on both Mac OS and Ubuntu. The reason is that the server binds to localhost. So we need to start the Rack app like this :\r\n\r\n```sh\r\nroot@f6b5cf85fafe:/opt/namer# rackup -o 0.0.0.0\r\n```\r\n\r\ninside the container to bind the server to 0.0.0.0. You will see:\r\n\r\n```sh\r\n[2015-06-21 02:52:17] INFO  WEBrick 1.3.1\r\n[2015-06-21 02:52:17] INFO  ruby 1.9.3 (2013-11-22) [x86_64-linux]\r\n[2015-06-21 02:52:17] INFO  WEBrick::HTTPServer#start: pid=19 port=9292\r\n192.168.59.3 - - [21/Jun/2015:02:52:25 +0000] \"GET / HTTP/1.1\" 200 381 0.8535\r\n192.168.59.3 - - [21/Jun/2015:02:52:25 +0000] \"GET /favicon.ico HTTP/1.1\" 404 541 0.0018\r\n192.168.59.3 - - [21/Jun/2015:02:56:01 +0000] \"GET / HTTP/1.1\" 200 381 0.0065\r\n```\r\n\r\nThen you can browse to http://192.168.59.103/ on the host to view the application. The [Container Basics](https://rubyplus.com/articles/2401 \'Container Basics\') article shows how to get inside a container.\r\n\r\nStep 6\r\n---------\r\n\r\n```sh\r\n$docker stop sharp_galileo\r\n```\r\n\r\nStep 7\r\n---------\r\n\r\n```sh\r\n$docker ps\r\n```\r\n\r\nSummary\r\n========\r\n---------\r\n\r\nIn this article, we saw how to share code between container and host. We also saw a simple local development workflow.','2015-06-19 00:54:19','2015-06-21 22:16:12'),(2461,'Docker Basics : Running a Hello World Sinatra App in a Container','Objective\r\n=========\r\n---------\r\n\r\nTo learn how to run a simple Sinatra app in a Docker container.\r\n\r\nPre-requisites\r\n=========\r\n---------\r\n\r\nYou must already know the basics of creating a Sinatra app and bundler.\r\n\r\nSteps\r\n=========\r\n---------\r\n\r\nStep 1\r\n---------\r\n\r\n\r\n[Install Docker on Mac OS](https://github.com/boot2docker/osx-installer/releases/tag/v1.7.0 \'Install Docker on Mac OS\')\r\n\r\nStep 2\r\n---------\r\n\r\nCreate a hello directory to work on this tutorial example. Create a Dockerfile in hello directory.\r\n\r\n```sh\r\nFROM ruby:2.2.1\r\nMAINTAINER Bugs Bunny <bbunny@rubyplus.com>\r\n\r\nRUN apt-get update && \\\r\n    apt-get install -y net-tools\r\n\r\n# Install gems\r\nENV APP_HOME /app\r\nENV HOME /root\r\nRUN mkdir $APP_HOME\r\nWORKDIR $APP_HOME\r\nCOPY Gemfile* $APP_HOME/\r\nRUN bundle install\r\n\r\n# Upload source\r\nCOPY . $APP_HOME\r\n\r\n# Start server\r\nENV PORT 3000\r\nEXPOSE 3000\r\nCMD [\"ruby\", \"hello.rb\"]\r\n```\r\n\r\nStep 3\r\n---------\r\n\r\nCreate a Gemfile:\r\n\r\n```sh\r\nsource \'https://rubygems.org\'\r\n\r\ngem \'rack\'\r\ngem \'rack-test\'\r\ngem \'sinatra\'\r\n```\r\n\r\nStep 4\r\n---------\r\n\r\nCreate hello.rb:\r\n\r\n```sh\r\nrequire \'sinatra\'\r\n\r\nset :bind, \'0.0.0.0\'\r\n\r\nget \'/\' do\r\n  \"Hello World #{params[:name]}\".strip\r\nend\r\n```\r\n\r\nStep 5\r\n---------\r\n\r\n```sh\r\n~ $cd temp/hello/\r\n~/temp/hello $docker build -t bparanj/hello .\r\n```\r\n\r\nIf you get this error:\r\n\r\n```sh\r\nSending build context to Docker daemon \r\nPost http:///var/run/docker.sock/v1.19/build?cgroupparent=&cpuperiod=0&cpuquota=0&cpusetcpus=&cpusetmems=&cpushares=0&dockerfile=Dockerfile&memory=0&memswap=0&rm=1&t=bparanj%2Fhello: dial unix /var/run/docker.sock: no such file or directory. Are you trying to connect to a TLS-enabled daemon without TLS?\r\n```\r\n\r\nYou must run the init:\r\n\r\n```sh\r\n~/temp/hello $boot2docker init\r\n```\r\n\r\nYou will see:\r\n\r\n```sh\r\nLatest release for github.com/boot2docker/boot2docker is v1.7.0\r\nDownloading boot2docker ISO image...\r\nSuccess: downloaded https://github.com/boot2docker/boot2docker/releases/download/v1.7.0/boot2docker.iso\r\n	to /Users/bparanj/.boot2docker/boot2docker.iso\r\nGenerating public/private rsa key pair.\r\nYour identification has been saved in /Users/bparanj/.ssh/id_boot2docker.\r\nYour public key has been saved in /Users/bparanj/.ssh/id_boot2docker.pub.\r\nThe key fingerprint is:\r\nf8:c4:ca:9c:97:9c:a6:fd:74:38:1a:7f:c5:22:35:4d bparanj@Millions.local\r\nThe key\'s randomart image is:\r\n+--[ RSA 2048]----+\r\n|                 |\r\n|              E  |\r\n|             o   |\r\n|       o    o .  |\r\n|      . S  . o   |\r\n|     o * o... o  |\r\n|      = O +..o   |\r\n|       = = o.    |\r\n|      . o.o.     |\r\n+-----------------+\r\n```\r\n\r\nStep 6\r\n---------\r\n\r\n```sh\r\n~/temp/hello $boot2docker up\r\n```\r\n\r\nYou will see:\r\n\r\n```sh\r\nWaiting for VM and Docker daemon to start...\r\n......................................ooooooooooooooooooooooooooo\r\nStarted.\r\nWriting /Users/bparanj/.boot2docker/certs/boot2docker-vm/ca.pem\r\nWriting /Users/bparanj/.boot2docker/certs/boot2docker-vm/cert.pem\r\nWriting /Users/bparanj/.boot2docker/certs/boot2docker-vm/key.pem\r\n\r\nTo connect the Docker client to the Docker daemon, please set:\r\n    export DOCKER_CERT_PATH=/Users/bparanj/.boot2docker/certs/boot2docker-vm\r\n    export DOCKER_TLS_VERIFY=1\r\n    export DOCKER_HOST=tcp://192.168.59.103:2376\r\n```\r\n\r\nStep 7\r\n---------\r\n\r\nSet the environment variables.\r\n\r\n```sh\r\n~/temp/hello $  export DOCKER_CERT_PATH=/Users/bparanj/.boot2docker/certs/boot2docker-vm\r\n~/temp/hello $  export DOCKER_TLS_VERIFY=1\r\n~/temp/hello $  export DOCKER_HOST=tcp://192.168.59.103:2376\r\n```\r\n\r\nStep 8\r\n---------\r\n\r\nNow build the image.\r\n\r\n```sh\r\n~/temp/hello $docker build -t bparanj/hello .\r\n```\r\n\r\nYou will see:\r\n\r\n```sh\r\nSending build context to Docker daemon 92.67 kB\r\nSending build context to Docker daemon \r\nStep 0 : FROM ruby:2.2.1\r\n2.2.1: Pulling from ruby\r\n511136ea3c5a: Pull complete \r\nd338bb63f151: Pull complete \r\n65688f7c61c4: Pull complete \r\nb7820d1ee4ee: Pull complete \r\n938e3817ad84: Pull complete \r\n2b7102d6f8b7: Pull complete \r\n13e80363fdbe: Pull complete \r\ncea0b47616cc: Pull complete \r\n07765c61a581: Pull complete \r\n455a7f74b799: Pull complete \r\nf6d62680d042: Pull complete \r\n8f4076e0c1e7: Pull complete \r\n8d3b208c8cb3: Pull complete \r\nf24a9de1806d: Pull complete \r\n279be1187a0e: Pull complete \r\nef6e4b7dc7cd: Already exists \r\nruby:2.2.1: The image you are pulling has been verified. Important: image verification is a tech preview feature and should not be relied on to provide security.\r\nDigest: sha256:5fe48ac5a2b631a72477d1c0e9fa7ab7d73cac56f476319320f88119236d1741\r\nStatus: Downloaded newer image for ruby:2.2.1\r\n ---> ef6e4b7dc7cd\r\nStep 1 : MAINTAINER Tung Nguyen <tnguyen@bleacherreport.com>\r\n ---> Running in b77e2655f8d4\r\n ---> 695684b308e4\r\nRemoving intermediate container b77e2655f8d4\r\nStep 2 : RUN apt-get update &&     apt-get install -y net-tools\r\n ---> Running in 301ed3776103\r\nGet:1 http://security.debian.org jessie/updates InRelease [63.1 kB]\r\nGet:2 http://http.debian.net jessie InRelease [134 kB]\r\nGet:3 http://http.debian.net jessie-updates InRelease [126 kB]\r\nGet:4 http://security.debian.org jessie/updates/main amd64 Packages [129 kB]\r\nGet:5 http://http.debian.net jessie/main amd64 Packages [9038 kB]\r\nGet:6 http://http.debian.net jessie-updates/main amd64 Packages [3616 B]\r\nFetched 9494 kB in 9s (1006 kB/s)\r\nReading package lists...\r\nReading package lists...\r\nBuilding dependency tree...\r\nReading state information...\r\nThe following NEW packages will be installed:\r\n  net-tools\r\n0 upgraded, 1 newly installed, 0 to remove and 69 not upgraded.\r\nNeed to get 225 kB of archives.\r\nAfter this operation, 803 kB of additional disk space will be used.\r\nGet:1 http://http.debian.net/debian/ jessie/main net-tools amd64 1.60-26+b1 [225 kB]\r\ndebconf: delaying package configuration, since apt-utils is not installed\r\nFetched 225 kB in 1s (195 kB/s)\r\nSelecting previously unselected package net-tools.\r\n(Reading database ... 27883 files and directories currently installed.)\r\nPreparing to unpack .../net-tools_1.60-26+b1_amd64.deb ...\r\nUnpacking net-tools (1.60-26+b1) ...\r\nSetting up net-tools (1.60-26+b1) ...\r\n ---> ef66bfea86c0\r\nRemoving intermediate container 301ed3776103\r\nStep 3 : ENV APP_HOME /app\r\n ---> Running in 4e082ec44bc9\r\n ---> 8381274803ef\r\nRemoving intermediate container 4e082ec44bc9\r\nStep 4 : ENV HOME /root\r\n ---> Running in 590a5c1130ec\r\n ---> 7a314bf9dd1f\r\nRemoving intermediate container 590a5c1130ec\r\nStep 5 : RUN mkdir $APP_HOME\r\n ---> Running in 38153ae9ade1\r\n ---> 151f938534b3\r\nRemoving intermediate container 38153ae9ade1\r\nStep 6 : WORKDIR $APP_HOME\r\n ---> Running in 826a540a37fa\r\n ---> 9bc90cc0be66\r\nRemoving intermediate container 826a540a37fa\r\nStep 7 : COPY Gemfile* $APP_HOME/\r\n ---> 2b1d0e4460f1\r\nRemoving intermediate container 13eedae4464d\r\nStep 8 : RUN bundle install\r\n ---> Running in 7626c821f248\r\nDon\'t run Bundler as root. Bundler can ask for sudo if it is needed, and\r\ninstalling your bundle as root will break this application for all non-root\r\nusers on this machine.\r\nFetching gem metadata from https://rubygems.org/..........\r\nFetching version metadata from https://rubygems.org/..\r\nInstalling rack 1.4.1\r\nInstalling rack-protection 1.5.3\r\nInstalling rack-test 0.6.3\r\nInstalling tilt 1.4.1\r\nInstalling sinatra 1.4.5\r\nUsing bundler 1.9.2\r\nBundle complete! 3 Gemfile dependencies, 6 gems now installed.\r\nBundled gems are installed into /usr/local/bundle.\r\n ---> c1a40addc15e\r\nRemoving intermediate container 7626c821f248\r\nStep 9 : COPY . $APP_HOME\r\n ---> 4d17d8ca2e5a\r\nRemoving intermediate container b842914afe96\r\nStep 10 : ENV PORT 3000\r\n ---> Running in ea7a0b4322b7\r\n ---> c9a1091260cc\r\nRemoving intermediate container ea7a0b4322b7\r\nStep 11 : EXPOSE 3000\r\n ---> Running in 00e4a9631d92\r\n ---> 6f786344cb53\r\nRemoving intermediate container 00e4a9631d92\r\nStep 12 : CMD ruby hello.rb\r\n ---> Running in e255db640718\r\n ---> d881ae171075\r\nRemoving intermediate container e255db640718\r\nSuccessfully built d881ae171075\r\n```\r\n\r\nStep 9\r\n---------\r\n\r\nRun the Sinatra app in the container.\r\n\r\n```sh\r\n~/temp/hello $docker run --rm -p 3000:3000 bparanj/hello\r\n```\r\n\r\nYou will see:\r\n\r\n```sh\r\n[2015-06-20 10:53:23] INFO  WEBrick 1.3.1\r\n[2015-06-20 10:53:23] INFO  ruby 2.2.1 (2015-02-26) [x86_64-linux]\r\n== Sinatra/1.4.5 has taken the stage on 3000 for development with backup from WEBrick\r\n[2015-06-20 10:53:23] INFO  WEBrick::HTTPServer#start: pid=1 port=3000\r\n192.168.59.3 - - [20/Jun/2015 10:54:06] \"GET / HTTP/1.1\" 200 11 0.0067\r\n192.168.59.3 - - [20/Jun/2015:10:54:06 UTC] \"GET / HTTP/1.1\" 200 11\r\n- -> /\r\n192.168.59.3 - - [20/Jun/2015 10:54:07] \"GET /favicon.ico HTTP/1.1\" 404 453 0.0007\r\n192.168.59.3 - - [20/Jun/2015:10:54:07 UTC] \"GET /favicon.ico HTTP/1.1\" 404 453\r\nhttp://192.168.59.103:3000/ -> /favicon.ico\r\n```\r\n\r\nStep 10\r\n---------\r\n\r\nFor Mac OS:\r\n\r\n```sh\r\n$boot2docker ip\r\n```\r\n\r\nUse the ip from the above command to view the application on a browser: http://192.168.59.103:3000/\r\n\r\nSummary\r\n========\r\n---------\r\n\r\nIn this article, we created a Dockerfile and built an image based on this Dockerfile. Then we ran a simple Sinatra app in a Docker container.','2015-06-20 19:28:50','2015-06-20 19:31:36'),(2471,'Docker Basics : Rebuilding Images','Objective\r\n=========\r\n---------\r\n\r\nWe will upgrade Ruby and Learn how to rebuild images.\r\n\r\nSteps\r\n=========\r\n---------\r\n\r\nStep 1\r\n---------\r\n\r\nChange the Ruby version in Dockerfile:\r\n\r\n```sh\r\nruby:2.2.2\r\n```\r\n\r\nYou can see all the available tags for Ruby here: https://github.com/docker-library/docs/tree/master/ruby\r\n\r\nStep 2\r\n---------\r\n\r\n```sh\r\n$ docker build -t bparanj/hello .\r\n```\r\n\r\nThis will rebuild the image. When you run the app you will see the Ruby version is 2.2.2. \r\n\r\nStep 3\r\n---------\r\n\r\nYou can also check the list of images by doing:\r\n\r\n```sh\r\n$ docker images\r\n```\r\n\r\nStep 4\r\n---------\r\n\r\nYou can verify the Ruby version by going into the container:\r\n\r\n```sh\r\n$ docker run -i -t bparanj/hello /bin/bash\r\n```\r\n\r\n```sh\r\nroot@0503074f21c9:/app# ruby -v\r\n```\r\n\r\nYou will see:\r\n\r\n```sh\r\nruby 2.2.2p95 (2015-04-13 revision 50295) [x86_64-linux]\r\n```\r\n\r\nYou can download the code from here: https://github.com/bparanj/hello\r\n\r\nSummary\r\n========\r\n---------\r\n\r\nIn this article, we saw how we can upgrade Ruby by specifying the Ruby version in the Dockerfile and rebuilding the image.','2015-06-20 19:46:09','2015-06-20 19:48:31'),(2481,'Ruby Productivity Scripts : Clone a Git Project','Objective\r\n=========\r\n---------\r\n\r\nTo write a simple script to automate git clone and browsing the source code.\r\n\r\nSteps\r\n=========\r\n---------\r\n\r\nStep 1\r\n---------\r\n\r\nAs developers, we are so busy that we don\'t have time to think about the amount of repetitive tasks we do on a daily basis. The following steps:\r\n\r\n1. Change directory to ~/temp\r\n2. git clone git_url\r\n3. mate downloaded-project-directory\r\n\r\nare repeated for every project that I want to read the source code to learn about how to use and to learn some new tricks. So, why not automate this task and learn Ruby at the same time? \r\n\r\nStep 2\r\n---------\r\n\r\n```sh\r\n#!/usr/bin/env ruby -w\r\n\r\nrequire \'uri\'\r\nrequire \'fileutils\'\r\n\r\nif ARGV[0].nil?\r\n  raise \'specify git url to clone\'\r\nelse\r\n  git_url = ARGV[0]\r\nend\r\n\r\nu = URI(git_url)\r\n\r\nproject_name = u.path.split(\'/\').last\r\ndirectory_name = project_name.split(\'.\').first\r\n\r\nDir.chdir(\"/Users/bparanj/temp\")\r\n\r\nunless File.directory?(\"./#{directory_name}\")  \r\n  system(\"git clone #{git_url}\")\r\nend\r\n\r\nsystem(\"mate #{directory_name}\")\r\n```\r\n\r\nI have hardcoded the directory, since I usually use the temp directory for downloading projects. You can modify the script to read the project directory to use from the command line.\r\n\r\nStep 3\r\n---------\r\n\r\nMake the script executable:\r\n\r\n```sh\r\n$chmod 0755\r\n```\r\n\r\nRun it:\r\n\r\n```sh\r\n$./giter.rb https://github.com/br/hello.git\r\n```\r\n\r\nSummary\r\n========\r\n---------\r\n\r\nIn this article, we wrote a simple pure ruby script to automate a frequent task of cloning a git repo and browsing the code.\r\n\r\nReferences\r\n========\r\n---------\r\n\r\n[Ruby Docs Dir] (http://ruby-doc.org/core-2.2.0/Dir.html \'Dir\')\r\n[Ruby Docs Dir#exists] (http://ruby-doc.org/core-2.2.0/Dir.html#method-c-exists-3F \'Ruby Docs Dir#exists\')\r\n[Ruby Docs URI] (http://ruby-doc.org/stdlib-2.1.1/libdoc/uri/rdoc/URI.html \'Ruby Docs URI\')','2015-06-20 20:03:41','2016-12-22 21:45:06'),(2491,'Ruby Gem Basics : Packaging Your Gem','Objective\r\n=========\r\n---------\r\n\r\nTo package anagram program into a gem.\r\n\r\nDiscussion\r\n=========\r\n---------\r\n\r\nIn the previous article of the Ruby Gem series, [Ruby Gem Basics : Pimp My Anagram](https://rubyplus.com/articles/2331 \'Ruby Gem Basics : Pimp My Anagram\'), we developed a simple library that creates a letter by rearranging the letters of another. For example, cinema formed from iceman. In this article, we are going to package that application as a gem so that it can be distributed and used by other developers.\r\n\r\nWhy do we need to create a gem manually when we can use generators provided by Bundler or Jeweler? These tools make certain assumptions, such as, you will be publishing them as an open source gem on a public gem server. If such assumptions are not valid, then it is just a matter of time before someone accidentally publishes one of your gems that is meant to be hosted on a private gem server. Remember the Murphy\'s Law. It also gives you more control over managing your gems.\r\n\r\nSteps\r\n=========\r\n---------\r\n\r\nStep 1\r\n---------\r\n\r\nCreate anagram.gemspec in the top-level directory of the application.\r\n\r\n```ruby\r\nGem::Specification.new do |s|\r\n  s.name = \"anagram\"\r\n  s.summary = \"Find anagrams of words supplied on the command line\"\r\n  s.description = File.read(File.join(File.dirname(__FILE__), \'README\'))\r\n  s.requirements = [ \'An installed dictionary (most Unix systems have one)\' ]\r\n  # Read about Semantic Versioning http://semver.org/ for more details\r\n  s.version = \"0.0.1\"\r\n  s.author = \"Dave Thomas\"\r\n  s.email = \"dave@pragprog.com\"\r\n  s.homepage = \"http://pragdave.pragprog.com\"\r\n  # This value means that our gem is pure Ruby code\r\n  s.platform = Gem::Platform::RUBY\r\n  # The gem uses require_relative, so our gem will run only with Ruby 1.9 or above\r\n  s.required_ruby_version = \'>=1.9\'\r\n  # What files to include when creating the gem package. Here everything is included.\r\n  s.files = Dir[\'**/**\']\r\n  # Install the anagram command-line script when the gem gets installed on a user\'s machine\r\n  s.executables = [ \'anagram\' ]\r\n  \r\n  s.test_files = Dir[\"test/test*.rb\"]\r\n  # Do not extract documentation when the gem is installed\r\n  s.has_rdoc = false\r\nend\r\n```\r\n\r\nFor a list of all gemspec attributes that you can use, refer : http://guides.rubygems.org/specification-reference/\r\n\r\nStep 2\r\n---------\r\n\r\nCreate README file that explain what the gem does and how to use it and a LICENSE file that contains the license information in the top-leve directory of the application. You can refer : http://opensource.org/licenses/alphabetical for copying text for the LICENSE file.\r\n\r\nStep 3\r\n---------\r\n\r\nMake the bin/anagram executable.\r\n\r\n```sh\r\n$chmod 755 bin/anagram \r\n```\r\n\r\nStep 4\r\n---------\r\n\r\nCreate the gem.\r\n\r\n```sh\r\n$gem build anagram.gemspec\r\n```\r\n\r\nThis will create the anagram-0.0.1.gem file in your current directory.\r\n\r\nStep 5\r\n---------\r\n\r\nFrom the project root directory, you can install the gem by:\r\n\r\n```sh\r\ngem install anagram-0.0.1.gem \r\n```\r\n\r\nYou will see:\r\n\r\n```sh\r\nSuccessfully installed anagram-0.0.1\r\n1 gem installed\r\n```\r\n\r\nStep 6\r\n---------\r\n\r\nGet details about the anagram gem.\r\n\r\n```sh\r\n$gem list anagram -d\r\n```\r\n\r\nYou will see:\r\n\r\n```sh\r\n*** LOCAL GEMS ***\r\n\r\nanagram (0.0.1)\r\n    Author: Dave Thomas\r\n    Homepage: http://pragdave.pragprog.com\r\n    Installed at: /Users/zepho/.rvm/gems/ruby-2.1.2\r\n\r\n    Find anagrams of words supplied on the command line\r\n```\r\n\r\nStep 7\r\n---------\r\n\r\nYou can now host your gem on a private server or push it to public server on rubygems.org by doing:\r\n\r\n```sh\r\n$gem push anagram-0.0.1.gem\r\n```\r\n\r\nSummary\r\n========\r\n---------\r\n\r\nIn this article, we packaged our library into a gem that can be published in our own private gem server or on a public gem server.','2015-06-22 07:09:28','2015-06-22 07:11:36'),(2501,'Rails Basics  : Using Dropdowns','Objective\r\n=========\r\n---------\r\n\r\nTo illustrate how to use drop-down in Rails 4.2.2\r\n\r\nSteps\r\n=========\r\n---------\r\n\r\nStep 1\r\n---------\r\n\r\nDefine the helper in app/helpers/welcome_helper.rb:\r\n\r\n```ruby\r\nmodule WelcomeHelper\r\n  def us_states\r\n      [\r\n        [\'Alabama\', \'AL\'],\r\n        [\'Alaska\', \'AK\'],\r\n        [\'Arizona\', \'AZ\'],\r\n        [\'Arkansas\', \'AR\'],\r\n        [\'California\', \'CA\'],\r\n        [\'Colorado\', \'CO\'],\r\n        [\'Connecticut\', \'CT\'],\r\n        [\'Delaware\', \'DE\'],\r\n        [\'District of Columbia\', \'DC\'],\r\n        [\'Florida\', \'FL\'],\r\n        [\'Georgia\', \'GA\'],\r\n        [\'Hawaii\', \'HI\'],\r\n        [\'Idaho\', \'ID\'],\r\n        [\'Illinois\', \'IL\'],\r\n        [\'Indiana\', \'IN\'],\r\n        [\'Iowa\', \'IA\'],\r\n        [\'Kansas\', \'KS\'],\r\n        [\'Kentucky\', \'KY\'],\r\n        [\'Louisiana\', \'LA\'],\r\n        [\'Maine\', \'ME\'],\r\n        [\'Maryland\', \'MD\'],\r\n        [\'Massachusetts\', \'MA\'],\r\n        [\'Michigan\', \'MI\'],\r\n        [\'Minnesota\', \'MN\'],\r\n        [\'Mississippi\', \'MS\'],\r\n        [\'Missouri\', \'MO\'],\r\n        [\'Montana\', \'MT\'],\r\n        [\'Nebraska\', \'NE\'],\r\n        [\'Nevada\', \'NV\'],\r\n        [\'New Hampshire\', \'NH\'],\r\n        [\'New Jersey\', \'NJ\'],\r\n        [\'New Mexico\', \'NM\'],\r\n        [\'New York\', \'NY\'],\r\n        [\'North Carolina\', \'NC\'],\r\n        [\'North Dakota\', \'ND\'],\r\n        [\'Ohio\', \'OH\'],\r\n        [\'Oklahoma\', \'OK\'],\r\n        [\'Oregon\', \'OR\'],\r\n        [\'Pennsylvania\', \'PA\'],\r\n        [\'Puerto Rico\', \'PR\'],\r\n        [\'Rhode Island\', \'RI\'],\r\n        [\'South Carolina\', \'SC\'],\r\n        [\'South Dakota\', \'SD\'],\r\n        [\'Tennessee\', \'TN\'],\r\n        [\'Texas\', \'TX\'],\r\n        [\'Utah\', \'UT\'],\r\n        [\'Vermont\', \'VT\'],\r\n        [\'Virginia\', \'VA\'],\r\n        [\'Washington\', \'WA\'],\r\n        [\'West Virginia\', \'WV\'],\r\n        [\'Wisconsin\', \'WI\'],\r\n        [\'Wyoming\', \'WY\']\r\n      ]\r\n  end\r\nend\r\n```\r\n\r\nStep 2\r\n---------\r\n\r\nFor submitting a form value that is not backed by ActiveRecord. Add the view code to app/views/welcome/index.html.erb:\r\n\r\n```ruby\r\n<%= form_tag(\'/articles\') do %>\r\n\r\n	<%= select_tag :state, options_for_select(us_states) %> \r\n	<%= submit_tag %>\r\n\r\n<% end %>\r\n```\r\n\r\nStep 3\r\n---------\r\n\r\nIf you are using a model backed form:\r\n\r\n```ruby\r\n<%= form_for(@article) do |f| %>\r\n	<%= f.select :state, options_for_select(us_states) %> \r\n	<%= f.submit %>\r\n<% end %>\r\n```\r\n\r\nYou can download the entire project at : https://bitbucket.org/bparanj/states\r\n\r\nSummary\r\n========\r\n---------\r\n\r\nIn this article, you learned how to use dropdown in Rails 4.2.2 and Ruby 2.2.2.','2015-06-22 08:53:28','2015-06-22 08:53:28'),(2511,'Provisioning a Server using Sunzi','Objective\r\n=========\r\n---------\r\n\r\nTo install and configure nginx server to display a static web page on a VPS.\r\n\r\nDiscussion\r\n=========\r\n---------\r\n\r\nSunzi is the Sinatra of provisioning libraries. It is simple with minimal learning curve. It can be frustrating experience to provision a server using tools like Chef, Puppet or other tools. Sunzi is a breath of fresh air. If you find a blog post that shows you how to setup something on a server manually, you can easily convert it into a Sunzi recipe in minutes. Good news is that regardless of what stack you want for your server, there is ton of resources online to get things working on the server. Sunzi makes it easy to automate those manual tasks. There is almost no mental mapping between what you want to do and the actual code that does the work. If you just want to provision your server on Digital Ocean or Linode VPS within days instead of spending weeks on trying to learn a DSL, you will find this article useful.\r\n\r\nSteps\r\n=========\r\n---------\r\n\r\nStep 1\r\n---------\r\n\r\nFirst watch the 25 minutes screen cast on how to provision a server using Sunzi [Deploy Rails 4.1 App with Sunzi and Capistrano 3](https://www.youtube.com/watch?v=3mwupXqtkmg&feature=youtu.be \'Deploy Rails 4.1 App with Sunzi and Capistrano 3\')\r\n\r\nHere is the link to my [Deploy Rails 4.1 App with Sunzi and Capistrano 3 Screencast Notes](http://bparanj.blogspot.com/2015/06/deploy-rails-41-app-with-sunzi-and.html \'Deploy Rails 4.1 App with Sunzi and Capistrano 3\'). \r\n\r\nStep 2\r\n---------\r\n\r\nI read the blog post on [Static Site Hosting with Nginx ](http://mockra.com/2014/02/17/nginx-static-sites/ \'Static Site Hosting with Nginx\'). I ran the commands manually on the server and got it working. Then I deleted everything related to nginx and uninstalled nginx. \r\n\r\n```sh\r\n$apt-get purge nginx nginx-common\r\n```\r\n\r\nStep 3\r\n---------\r\n\r\nThe commands from the blog post related to ngnix installation and setup:\r\n\r\n```sh\r\nsudo apt-get install nginx\r\nsudo mkdir -p /var/www/clickplan.net/public\r\nsudo chown -R root:root /var/www/clickplan.net/public/\r\nsudo chmod 755 /var/www\r\nsudo cp /etc/nginx/sites-available/default /etc/nginx/sites-available/clickplan.net\r\nsudo vim /etc/nginx/sites-available/clickplan.net\r\n```\r\n\r\n```sh\r\nserver {\r\n  listen   80;\r\n \r\n  root /var/www/clickplan.net/public;\r\n  index index.html index.htm;\r\n \r\n  server_name clickplan.net www.clickplan.net;\r\n  \r\n  location / {\r\n   default_type \"text/html\";\r\n   try_files $uri.html $uri $uri/ /index.html;\r\n  }\r\n}\r\n```\r\n\r\n```sh\r\nsudo ln -s /etc/nginx/sites-available/clickplan.net /etc/nginx/sites-enabled/clickplan.net\r\necho \'Webserver provisioned by sunzi is working\' > /var/www/clickplan.net/public/index.html\r\nsudo service nginx restart\r\n```\r\n\r\nStep 4\r\n---------\r\n\r\nI have already followed the screencast to do the intial setup. This article will focus on things that is not covered in the screencast. Let\'s now automate these manual steps by using Sunzi. Go to your app-name/config/sunzi/recipes folder and create nginx.sh:\r\n\r\n```sh\r\nif aptitude search \'~i ^nginx$\' | grep -q nginx; then\r\n  echo \"nginx already installed, skipping.\"\r\nelse\r\n  add-apt-repository ppa:nginx/stable --yes\r\n  apt-get -y update\r\n  apt-get -y install nginx\r\n  \r\n  mkdir -p /var/www/clickplan.net/public\r\n  chown -R root:root /var/www/clickplan.net/public/\r\n  chmod 755 /var/www\r\n  mv files/nginx.conf /etc/nginx/sites-available/clickplan.net\r\n  \r\n  sudo ln -s /etc/nginx/sites-available/clickplan.net /etc/nginx/sites-enabled/clickplan.net\r\n  echo \'Webserver provisioned by sunzi is working\' > /var/www/clickplan.net/public/index.html\r\n  service nginx restart\r\nfi\r\n```\r\n\r\nFor the first version, I am hard-coding most of the values in this file. You can define variables in the sunzi.yml and use it here using erb tags.\r\n\r\nStep 5\r\n---------\r\n\r\nThe configuration file nginx.conf must be copied to the sunzi/files folder:\r\n\r\n```sh\r\nserver {\r\n  listen   80;\r\n \r\n  root /var/www/clickplan.net/public;\r\n  index index.html index.htm;\r\n \r\n  server_name clickplan.net www.clickplan.net;\r\n  \r\n  location / {\r\n   default_type \"text/html\";\r\n   try_files $uri.html $uri $uri/ /index.html;\r\n  }\r\n}\r\n```\r\n\r\nNow when the recipe is run on the server, this file will get copied to the appropriate directory. You can see the move operation in the previous step.\r\n\r\nStep 6\r\n---------\r\n\r\nRun:\r\n\r\n```sh\r\nsunzi compile\r\n```\r\n\r\nSay yes for overwriting the existing recipe to update the existing recipe and run:\r\n\r\n```sh\r\nsunzi deploy IP-Address-of-Your-Server\r\n```\r\n\r\nYou can now browse to the site to see \'Webserver provisioned by sunzi is working\' in the browser.\r\n\r\nStep 7\r\n---------\r\n\r\nLet\'s say you want to install pdftk on the server. You can create a new file called config/sunzi/recipes/pdf.sh:\r\n\r\n```sh\r\nif aptitude search \'~i ^pdftk$\' | grep -q pdftk; then\r\n  echo \'pdftk already installed, skipping.\'\r\nelse\r\n  apt-get -y install pdftk\r\nfi\r\n```\r\n\r\nThen add this line:\r\n\r\n```sh\r\nsource recipes/pdf.sh\r\n```\r\n\r\nin sunzi/install.sh. Then you can re-compile and deploy as shown in Step 6. \r\n\r\nSummary\r\n========\r\n---------\r\n\r\nIn this article, we saw how you can stop pulling your hair doing devops work and get back to real work by using Sunzi to provision your server on a VPS. It feels good when you realize that you don\'t need any stinkin DSL.','2015-06-23 02:52:37','2015-06-23 23:04:33'),(2521,'Ruby Productivity Scripts : Simple Whois Client','Objective\r\n=========\r\n---------\r\n\r\nTo write a simple whois client using Ruby socket library.\r\n\r\nDiscussion\r\n=========\r\n---------\r\n\r\nAs web developers we have thousands of ideas for web applications than can make us rich quick. We buy domains in bulk when we get too excited. Why do we need to Google for the details? Why do we put up with Captchas? Why not write our own scripts to get the details from a terminal?\r\n\r\nWhat is whois? \r\n---------\r\n\r\n```sh\r\nman whois \r\n```\r\n\r\nshows you:  \r\n\r\n```sh\r\nwhois -- Internet domain name and network number directory service. \r\n```\r\n\r\nThe clients make a request to whois servers such as whois.internic.net to get details about a domain.\r\n\r\nSteps\r\n=========\r\n---------\r\n\r\nStep 1\r\n---------\r\n\r\nGo to a terminal and run:\r\n\r\n```sh\r\nwhois com\r\n```\r\n\r\nYou will see:\r\n\r\n```sh\r\nWhois Server Version 2.0\r\n\r\nDomain names in the .com and .net domains can now be registered\r\nwith many different competing registrars. Go to http://www.internic.net\r\nfor detailed information.\r\n\r\nAborting search 50 records found .....\r\nCOM---------------------------------------------------------WWW.COM\r\nCOM--------------------CN.COM\r\nCOM------COM.COM\r\n\r\nBLAH, BLAH, BLAH...\r\n```\r\n\r\nLet\'s get some details about the next hotshot:\r\n\r\n```sh\r\nwhois docker.com\r\n```\r\n\r\nThe terminal utility speaks the whois protocol.\r\n\r\nStep 2\r\n---------\r\n\r\nLet\'s learn how to talk like a whois client.\r\n\r\n```sh\r\n$telnet whois.internic.net 43\r\n```\r\n\r\nYou will see:\r\n\r\n```sh\r\nTrying 199.7.50.74...\r\nConnected to whois.internic.net.\r\nEscape character is \'^]\'.\r\nrubyplus.com[Hit Enter here]\r\n\r\nWhois Server Version 2.0\r\n\r\nDomain names in the .com and .net domains can now be registered\r\nwith many different competing registrars. Go to http://www.internic.net\r\nfor detailed information.\r\n\r\n   Domain Name: RUBYPLUS.COM\r\n   Registrar: ENOM, INC.\r\n   Sponsoring Registrar IANA ID: 48\r\n   Whois Server: whois.enom.com\r\n   Referral URL: http://www.enom.com\r\n   Name Server: NS1.LINODE.COM\r\n   Name Server: NS2.LINODE.COM\r\n   Name Server: NS3.LINODE.COM\r\n   Name Server: NS4.LINODE.COM\r\n   Name Server: NS5.LINODE.COM\r\n   Status: clientTransferProhibited http://www.icann.org/epp#clientTransferProhibited\r\n   Updated Date: 02-feb-2015\r\n   Creation Date: 12-feb-2007\r\n   Expiration Date: 12-feb-2021\r\n\r\n>>> Last update of whois database: Wed, 24 Jun 2015 00:07:00 GMT <<<\r\n\r\nNOTICE: The expiration date displayed in this record is the date the \r\nblah, blah, blah...\r\nConnection closed by foreign host.\r\n```\r\n\r\nWe connect to a whois server on port 43, enter a domain, and hit return. The server sent us response packets to us and then disconnected the connection.\r\n\r\nStep 3\r\n---------\r\n\r\nWe can now describe our program at a high level.\r\n\r\n####High Level Description\r\n\r\n1. Create a TCP client connection to a Whois server such as whois.internic.net on port 43.\r\n2. Send the domain followed by a return character as the request.\r\n2. Read the response from the server.\r\n3. Print the response to standard output.\r\n\r\nStep 4\r\n---------\r\n\r\nHere is the code.\r\n\r\n```ruby\r\nrequire \'socket\'\r\n \r\nhost = \'whois.internic.net\'         # The whois server\r\nport = 43                           # Default whois port\r\n\r\n# This is the whois request we send to get domain details\r\nrequest = \"rubyflow.com\\r\\n\\r\\n\"\r\n\r\nsocket = TCPSocket.open(host,port)  # Connect to server\r\nsocket.print(request)               # Send request\r\nresponse = socket.read              # Read complete response\r\n\r\nprint response                      # And display it\r\n```\r\nThe Process\r\n========\r\n---------\r\n\r\nReverse engineer to find out how something is implemented by reading code. The ruby gems that has evolved over a period of years is not readable because the \'why\' is hidden. It is explained as a blog post with diagrams on the whois ruby gem author\'s blog. \r\n\r\nIt is easier to read similar programs in other languages such as PHP, C# and Python. Especially if it is small and is focused on doing what you want to accomplish.\r\n\r\nAfter reading the code, create a high-level description of what the program should do. Write down all the steps. For each step, read Ruby docs, figure out the needed code to implement the desired functionality.\r\n\r\nSummary\r\n========\r\n---------\r\n\r\nIn this article, we wrote a simple whois client to retrieve details about a domain. We learned how to use Ruby during this process. You can send query to get more details by reading the whois protocol specification. I found it difficult to understand the existing code of whois gem. It is easier to read PHP example with just one file containing 400 lines of code to get a sense of how to write a whois client. Do not be afraid of reading source code of examples from languages such as PHP, C# and Python. You will learn a lot and it can lead to cross pollination of ideas,  enabling you to build better gems.\r\n\r\nReferences\r\n========\r\n---------\r\n\r\n1. [Simple C# Class to Get Whois Information] (https://coderbuddy.wordpress.com/2010/10/12/a-simple-c-class-to-get-whois-information/ \'A simple C# class to get whois information\'\r\n)\r\n2. [Ruby Docs](http://ruby-doc.org/stdlib-1.9.3/libdoc/socket/rdoc/TCPSocket.html \'Ruby Docs\')\r\n3. [Whois Protocol] (https://tools.ietf.org/html/rfc3912 \'Whois Protocol\')\r\n4. [Python Whois Client](http://www.binarytides.com/python-program-to-fetch-domain-whois-data-using-sockets/ \'Python Whois Client\')\r\n5. [How does whois work](http://semmyfun.blogspot.com/2010/08/how-does-whois-work-dirty-guide.html \'How does whois work\')\r\n6. [An intelligent pure Ruby WHOIS client and parser] (https://github.com/weppos/whois \'An intelligent pure Ruby WHOIS client and parser\')\r\n7. [Whois Client in PHP](http://www.phpeasycode.com/whois/ \'Whois Client in PHP\')','2015-06-24 00:37:15','2015-10-25 06:11:28'),(2531,'TDD Beyond Basics : Outside In Perspective','Objective\r\n=========\r\n---------\r\n\r\nTo learn how to do TDD effectively by using outside in perspective.\r\n\r\nDiscussion\r\n=========\r\n---------\r\n\r\nSometimes it is difficult to switch perspective and look at the system from the outside. By focusing on the intent, we can drive the design of the system. I developed the [Pair Ranking](https://bitbucket.org/bparanj/rasam \'Pair Ranking\') gem driven by tests. Initially the tests were ugly with loops and complicated code for testing different scenarios. So I extracted them into a Engine and simulator classes. \r\n\r\nAfter I released the gem, I installed it and wrote a simple command line interface using highline gem. By looking at the code in this script I could see which interface was required for pair ranking a given set of choices. I was able to hide certain implementation details that was not obvious while writing the tests. It was obvious by looking at the client code that I did not need the Engine or Simulator classes. So I was able to move it test_helper.rb. These classes were relevant only in the tests. Here is the command line interface to the Pair Ranking gem:\r\n\r\n```ruby\r\nrequire \'highline/import\'\r\nrequire \"pp\"\r\nrequire \'rasam\'\r\n\r\ninclude Rasam\r\n\r\noptions = ask(\"Enter your choices (or a blank line to quit):\",\r\nlambda { |ans| ans =~ /^-?\\d+$/ ? Integer(ans) : ans} ) do |q|\r\n  q.gather = \"\"\r\nend\r\n\r\n@pr = PairRank.new(options)\r\n@saved_combinations = Array.new(@pr.combinations)\r\ncombinations = Array.new(@pr.combinations)\r\n\r\npair = combinations.shift\r\n\r\ndef get_user_choice_for(pair)\r\n  choose do |menu|\r\n    menu.prompt = \"Please choose your favorite: \"\r\n\r\n    pair.each do |c|\r\n      menu.choice(c) do\r\n        say(c)\r\n        rationale = ask(\"Why?  \")\r\n        say(rationale)\r\n        \r\n        @pr.make_rational_choice(pair, c, rationale)\r\n      end\r\n    end\r\n  end\r\nend\r\n\r\nloop do\r\n  p pair    \r\n  get_user_choice_for(pair)\r\n  break if combinations.empty?\r\n  pair = combinations.shift\r\nend\r\n\r\n\r\n@pr.decisions.each do |d|\r\n  p d.to_s\r\nend \r\n\r\np @pr.score_for(\'A\')\r\np @pr.score_for(\'B\')\r\np @pr.score_for(\'C\')\r\n\r\nloop do\r\n  p \'Handling a tie\'\r\n  if @pr.tied_pair.empty?\r\n    break\r\n  else\r\n    get_user_choice_for(@pr.tied_pair)\r\n    \r\n    @pr.decisions.each do |d|\r\n      p d.to_s\r\n    end \r\n    \r\n    p @pr.score_for(\'A\')\r\n    p @pr.score_for(\'B\')\r\n    p @pr.score_for(\'C\')\r\n    p @pr.tied_pair\r\n  end\r\nend\r\n```\r\n\r\nSummary\r\n========\r\n---------\r\n\r\nIn this article, you learned that using a command line interface for your gem can help you switch perspective and look at the system from outside in. This will help you come up with a better solution. You don\'t need complicated frameworks like Cucumber to help you with outside-in development. Become a user of your own library and see where you need to polish your existing gem. It is the best way to make your gems better.','2015-06-27 01:29:10','2015-06-27 02:17:21'),(2541,'TDD Beyond Basics : How to Fake User Input','Discussion\r\n==========\r\n----------\r\n\r\nI used highline gem to test drive my pair ranking gem, rasam. I knew that StringIO can be used in tests as VirtualFile to simulate File. But how do you simulate user input? Reading the source code of the highline library, I came across HighLine::Simulate class that simulates user input that can be used in tests. It uses meta-programming. It is based on the gist by Jason Morrison. I have simplified the original gist. Here is the source:\r\n\r\n```ruby\r\nrequire \'test/unit\'\r\n \r\nclass VirtualInput\r\n  def initialize(strings)\r\n    @strings = strings\r\n  end\r\n \r\n  def gets\r\n    next_string = @strings.shift\r\n    # Uncomment the following line if you\'d like to see the faked $stdin#gets\r\n    puts \"(DEBUG) Faking #gets with: #{next_string}\"\r\n    next_string\r\n  end\r\n \r\n  def self.with_fake_input(strings)\r\n    $stdin = VirtualInput.new(strings)\r\n    yield\r\n  ensure\r\n    $stdin = STDIN\r\n  end\r\nend\r\n \r\nclass Waiter\r\n  attr_accessor :orders\r\n  \r\n  def take_orders\r\n    self.orders = {}\r\n \r\n    puts \"Hello, diner.  What is your name?\"\r\n    name = gets\r\n\r\n    puts \"Please to meet you. #{name}, what would you like for dinner?\"\r\n    order = gets\r\n\r\n    orders[name] = order\r\n  end\r\nend\r\n \r\nclass WaiterTest < Test::Unit::TestCase\r\n  def test_ordering\r\n    VirtualInput.with_fake_input([\"Harry\", \"The tarte tomate\"]) do\r\n      waiter = Waiter.new\r\n      waiter.take_orders\r\n \r\n      assert waiter.orders.has_key?(\"Harry\")\r\n      assert_equal \"The tarte tomate\", waiter.orders[\"Harry\"]\r\n    end\r\n  end\r\nend\r\n```\r\n\r\nYou can see how the `with_fake_input` hijacks the $stdin value to the VirtualInput and reverts it back once it completes. \r\n\r\nWe can use Highline::Simulate class to automate the script that tests the rasam gem. This will be useful to write our acceptance test.\r\n\r\nSummary\r\n===========\r\n-----------\r\n\r\nIn this article, you learned how to simulate user input so that we can write tests without having to manually enter the data to the script.','2015-06-29 02:03:08','2015-10-25 22:53:05'),(2551,'Ruby Basics : Hiding a Class Method','Objective\r\n=====\r\n-----\r\n\r\nTo learn how the private keyword differs when it is used to hide class methods.\r\n\r\nSteps\r\n=====\r\n-----\r\n\r\nStep 1\r\n------\r\n\r\n```ruby\r\nclass Foo\r\n  def self.greet\r\n    p \'hi\'\r\n  end  \r\nend\r\n\r\nFoo.greet\r\n```\r\n\r\nThis prints \'hi\'.\r\n\r\nStep 2\r\n------\r\n\r\n```ruby\r\nclass Foo\r\n  def self.greet\r\n    p \'hi\'\r\n  end\r\n  \r\n  private\r\n  \r\n  def bar\r\n    p \'bar\'\r\n  end\r\n  \r\nend\r\n\r\nFoo.new.bar\r\n```\r\n\r\nWe get:\r\n\r\n```sh\r\nNoMethodError: private method ‘bar’ called for #<Foo:0x00200>. \r\n```\r\n\r\nThis is as expected.\r\n\r\nStep 3\r\n------\r\n\r\n```ruby\r\nclass Foo\r\n  def self.greet\r\n    p \'hi\'\r\n  end\r\n  \r\n  private\r\n    \r\n  def self.gold\r\n    p \'gold\'\r\n  end\r\nend\r\n\r\nFoo.gold\r\n```\r\n\r\nThis is a surprise because it prints gold. The private keyword does not prevent the gold from getting called outside of Foo class. \r\n\r\nStep 4\r\n------\r\n\r\nHow do we hide a class method?\r\n\r\n```ruby\r\nclass Foo\r\n  \r\n  class << Foo\r\n    private \r\n    \r\n    def gold\r\n      p \'gold\'\r\n    end\r\n  end\r\nend\r\n\r\nFoo.gold\r\n```\r\n\r\nNow we get: \r\n\r\n```sh\r\nNoMethodError: private method ‘gold’ called for Foo:Class\r\n```\r\n\r\nStep 5\r\n------\r\n\r\n```ruby\r\nclass Foo\r\n  def self.greet\r\n    gold\r\n  end\r\n  \r\n  private\r\n    \r\n  class << Foo\r\n    private \r\n    \r\n    def gold\r\n      p \'gold\'\r\n    end\r\n  end\r\nend\r\n\r\nFoo.greet\r\n```\r\n\r\nThis prints \'gold\'. So, you can use the public interface that calls the private class method. It will work.\r\n\r\nStep 6\r\n------\r\n\r\nYou can also use private_class_method to make existing class methods private as suggested by Matt Brictson on rubyflow.com. \r\n\r\n```ruby\r\nclass Foo\r\n\r\n  private_class_method :gold\r\n\r\n  def self.gold\r\n    p \'gold\'\r\n  end\r\nend\r\n\r\nFoo.gold\r\n```\r\n\r\nIf you run this, you will see:\r\n\r\n```sh\r\nNameError: undefined method ‘gold’ for class `Class\'\r\n```\r\n\r\nSummary\r\n===========\r\n-----------\r\n\r\nIn this article, we saw how the private keyword does not hide class methods and what we can do if we need to hide them.','2015-07-02 22:12:55','2015-07-03 04:59:57'),(2561,'Micro Gem : A Look at the Future by Looking at the Past','What is a Micro Gem ?\r\n==========\r\n----------\r\n\r\nA Micro Gem is a gem that is self-contained and focused on only one feature.  The aim of Micro Gem is to make the unit of reuse as small as possible to give it the best chance for survival over time in different contexts. \r\n\r\nWhat is Not a Micro Gem ?\r\n==========\r\n----------\r\n\r\nA gem that cuts through different layers is not a Micro Gem. The focus of a Micro Gem is on only one layer.  \r\n\r\nMotivation\r\n==========\r\n----------\r\n\r\nThe Micro Gem is motivated by the desire to separate things that change at different rates. It was painful to see one of my Rails app evolve from 2.2 to 4.2. For instance, Twitter Bootstrap changes at a different rate than Stripe API. \r\n\r\nWe must contain the dependencies and manage the changes that differ for different reasons independently. This prevents the ripple effects of the changes made to an unrelated layer. It is easier to manage the dependencies in a project using Micro Gems. \r\n\r\nAim\r\n==========\r\n----------\r\n\r\nA Micro Gem aims for very minimal dependencies on other gems. If we can implement the feature without using any other gem, then we just make it pure Ruby with no external dependencies. There must be only one reason to change a Micro Gem. It must be very simple.\r\n\r\nYou either use everything provided by the gem or you don\'t use it at all. It\'s like a Bento Box. There is no waste. It provides a cohesive service.  \r\n\r\nAim Small Miss Small\r\n==========\r\n----------\r\n\r\nWe aim for 200 lines of code and 2 classes. If we exceed that, we reflect on the code and find a way to reduce it\'s size without impacting the useful functionality provided by the Micro Gem. The constraint on the code mass forces us to find creative solutions to the problem. We want simplicity not something that is simplistic.\r\n\r\nInspiration\r\n==========\r\n----------\r\n\r\nThe Micro Gem idea is inspired by the concepts found in Unix, Docker and Micro Services architecture. \r\n\r\n- Unix command line utilities that can be combined in different ways using pipes to solve different problems.\r\n- Micro Services architecture puts each element of functionality into a separate service.\r\n- Docker allows you to package an application with all of its dependencies into a standardized unit for software development.\r\n\r\nWhat if we could build a gem that is self-contained and is focused on providing only one feature?\r\n\r\nCharacteristics of a Micro Gem\r\n==========\r\n----------\r\n\r\n- It is less than 200 lines with one or two classes.\r\n- You can develop it in a few days.\r\n- You can express what it does with one phrase.\r\n- You can easily upgrade in a few hours.\r\n- Tests run fast because it has only one feature.Yay!\r\n\r\nExamples of Micro Gems \r\n==========\r\n----------\r\n\r\n1. Merlot : PDF Stamping \r\n2. Cognac : Amazon S3 Upload\r\n3. Colt : Recurring billing using Stripe API\r\n\r\nThey are all lightweight with useful functionality.\r\n\r\nWhy?\r\n==========\r\n----------\r\n\r\n- Work can be assigned to one developer with minimal communication with other developers on the team.\r\n- There is no cognitive overload. \r\n- There is no WTF moments when you look at your own codebase later.\r\n- You can fit the entire code base in your head. Easy to mull over the codebase and improve the design incrementally over time.\r\n- It is not intimidating to work on it during your spare time. Because there is very minimal context that needs to be set before you can start doing something. You will not be wasting time to figure out:\r\n    * What should I do next?\r\n    * Where do I start?\r\n- Satisfaction in completing the development and releasing it quickly. I can say it is \'DONE\' which feels good instead of always being in a \'IN-PROGRESS\' state which drains your energy.\r\n- You don\'t have to be a meta-programming Ninja to develop a Micro Gem. If you found useful snippet of code on stackoverflow, pastie or gist on github, you can easily turn that into a Micro Gem.\r\n- This encourages even newbies to Ruby to contribute to open source.\r\n- The mapping of feature to the dependencies required to implement that feature becomes very clear. Take a look at the gemspec file or Gemfile.lock.\r\n- Does the assumptions not fit your needs? Just fork the repo and customize it to suit your needs.\r\n- You can encapsulate knowledge in how to articles into Micro Gem. \r\n\r\nRight Level of Granularity\r\n==========\r\n----------\r\n\r\nAll of my Micro Gems are extracted from real projects. So the functionality offered is neither too small or trivial to be used in a real project nor too big to become a maintenance nightmare. It is also easier to see what the simplified API will look like from a client\'s perspective before the gem is developed.\r\n\r\nSummary\r\n==========\r\n----------\r\n\r\nThe UNIX has survived for almost 5 decades and will survive for another 5 decades. What if we could build Micro Gems that could evolve and still provide useful unit of functionality for decades to come? The \'What\' is found in the tests, the \'How\' is found in the production code and the \'Why\' is not found in any form of code. The \'Why\' is the design decisions that developers make and it evolves over time. Some of the \'why\'s can be found in the form of comments, blog posts and as discussion threads between the developers on forums. How can we minimize the time spent on \'Why?\'. Can developers become more productive by developing Micro Gems that follow the UNIX philosophy? Only time can answer those questions. Let\'s see how the future unfolds.','2015-07-03 03:14:44','2015-07-17 22:50:11'),(2571,'TDD Basics : Using Factorial kata to illustrate Transformation Priority Premise','Objective\r\n==========\r\n----------\r\n\r\nTo learn how to apply Transformation Priority Premise to Factorial problem\r\n\r\nSteps\r\n=====\r\n\r\nStep 1\r\n------\r\n\r\nCreate test_factorial.rb with :\r\n\r\n```ruby\r\nclass TestFactorial < MiniTest::Test\r\n  def test_zero_factorial_is_one\r\n    result = Factorial.calculate(0)\r\n    \r\n    assert_equal 1, result\r\n  end\r\nend\r\n```\r\n\r\nRun the test: \r\n\r\n```sh\r\n$ruby -rminitest/pride test_factorial.rb --verbose\r\n```\r\n\r\nStep 2\r\n------\r\n\r\nAdd the Factorial class to the top of the file.\r\n\r\n```ruby\r\nclass Factorial\r\n  def self.calculate(n)\r\n  end  \r\nend\r\n```\r\n\r\nThe test fails.\r\n\r\nStep 3\r\n------\r\n\r\nReturn hard coded value.\r\n\r\n```ruby\r\nclass Factorial\r\n  def self.calculate(n)\r\n    1\r\n  end  \r\nend\r\n```\r\n\r\nNow the test passes.\r\n\r\nStep 4\r\n------\r\n\r\nAdd the second test:\r\n\r\n```ruby\r\n  def test_one_factorial_is_one\r\n    result = Factorial.calculate(1)\r\n\r\n    assert_equal 1, result\r\n  end\r\n```\r\n\r\nThis test passes without failing.\r\n\r\nStep 5\r\n------\r\n\r\nAdd the third test.\r\n\r\n```ruby\r\n  def test_two_factorial_is_two\r\n    result = Factorial.calculate(2)\r\n\r\n    assert_equal 2, result\r\n  end\r\n```\r\n\r\nThis test fails.\r\n\r\nStep 6\r\n------\r\n\r\nChange the factorial implementation:\r\n\r\n```ruby\r\n  if n < 2\r\n    1\r\n  else\r\n    n\r\n  end\r\n```\r\n\r\nThe test now passes.\r\n\r\nStep 7\r\n------\r\nAdd the fourth test.\r\n\r\n```ruby\r\n  def test_three_factorial_is_six\r\n    result = Factorial.calculate(3)\r\n\r\n    assert_equal 6, result\r\n  end\r\n```\r\n\r\nStep 8\r\n------\r\n\r\nChange the Factorial implementation:\r\n\r\n```ruby\r\n  if n < 2\r\n    1\r\n  else\r\n    result = 1\r\n    begin\r\n      next_number = result + 1\r\n      result *= next_number\r\n    end while(next_number < n)\r\n    result\r\n  end\r\n```\r\n\r\nThe result we get 42 is wrong. We expect 24. Let\'s analyze our code.\r\n\r\n    Run 1 :\r\n\r\n    result = 1\r\n    next_number = 2\r\n    result = 2\r\n    next_number < n (2 < 4) yes\r\n\r\n    Run 2 :\r\n\r\n    next_number = 2 + 1 = 3\r\n    result = 2 * 3 = 6\r\n    next_number < n ( 3 < 4) yes\r\n\r\n    Run 3 :\r\n\r\n    next_number = 6 + 1\r\n    result = 6 * 7 = 42\r\n\r\nThe problem is that we need to increment the index into an array. Don\'t do next_number = result + 1 (finding the next number is not the same as the intermediate result + 1)\r\n\r\nStep 9\r\n------\r\n\r\nChange the Factorial implementation:\r\n\r\n```ruby\r\n  if n < 2\r\n    1\r\n  else\r\n    result = 1\r\n    for i in (1..n).to_a\r\n      result *= i\r\n    end\r\n    result\r\n  end\r\n```\r\n\r\nThe test now passes.\r\n\r\nStep 10\r\n------\r\n\r\nLet\'s cleanup.\r\n\r\n```ruby\r\n  result = 1\r\n  for i in (1..n).to_a\r\n    result *= i\r\n  end\r\n  result\r\n```\r\n\r\nThe following implementations will also work.\r\n\r\n```ruby\r\n  result = 1\r\n  1.upto(n) do |i|\r\n    result *= i\r\n  end\r\n  result\r\n```\r\n\r\n```ruby\r\n  result = 1\r\n  (1..n).to_a.each do |i|\r\n    result *= i\r\n  end\r\n  result\r\n```\r\n\r\nSummary\r\n==========\r\n----------\r\n\r\nYou can see how the code evolved from no code at all where it was returning nil to hard coded value of 1. Then we had a split in the execution path by using the if-else statement. Then the else block was generalized to handle larger numbers and eventually we got rid of the if-else statement. The challenge is picking the transformations on top of the Transformation Priority Premise list.\r\n','2015-07-26 03:32:57','2015-07-26 03:34:53'),(2581,'How to recognize design cues by looking at the tests? ','Objective\r\n=========\r\n---------------\r\n\r\nIn this article, you will learn how to recognize design cues by looking at the tests so that you can improve your design.\r\n\r\nDiscussion\r\n=========\r\n---------------\r\n\r\nIn an existing Rails project, I was creating objects like this in the tests:\r\n\r\n```ruby\r\nFoo.new(x, nil, nil)\r\n```\r\n\r\nAs you can see from the specs:\r\n\r\n```ruby\r\ndescribe FraudPolicy do\r\n  \r\n  context \'Spoofed receiver_email\' do\r\n    before do\r\n      order = double(\'Order\') \r\n      order.stub_chain(:product, :user, :primary_paypal_email) { \'seller@rubyplus.com\' }\r\n      Order.stub(:find_by_number) { order }    \r\n    end\r\n\r\n    it \'should identify spoofed receiver email\' do\r\n      notify = stub(\'Notify\', invoice: 10, account: \'spoofer@spooky.net\')\r\n      \r\n      fraud_policy = FraudPolicy.new(notify, nil, nil)\r\n\r\n      expect(fraud_policy.spoofed_receiver_email?).to be(true)\r\n    end\r\n\r\n    it \'should identify non spoofed receiver email\' do\r\n      notify = stub(\'Notify\', invoice: 10, account: \'seller@rubyplus.com\')\r\n      \r\n      fraud_policy = FraudPolicy.new(notify, nil, nil)\r\n\r\n      expect(fraud_policy.spoofed_receiver_email?).to be(false)    \r\n    end    \r\n  end\r\nend\r\n```\r\n\r\nIn another context:\r\n\r\n```ruby\r\nFoo.new(x, y, z)\r\n```\r\n\r\nI was using all the parameters. This means some of the tests does not need some attributes to exercise their functionality. This happens when the class operates on its attributes for some of the operations. Ideally we want our classes to have very high cohesion. This can be achieved by creating classes that operate on its data most of the time. \r\n\r\nNo Pain No Gain, Really?\r\n=========\r\n----------------\r\n\r\nThe tests does not tell you explicitly that your design needs improvement. If there is no pain in testing, you usually move on to the next task. In this case, the test was easy to write and I moved on to other tasks without reflecting on the resulting design. The question is : How can we gain when there is no pain?\r\n\r\nSmall Cohesive Composable Objects\r\n=========\r\n----------------\r\n\r\n![Legos](https://1.bp.blogspot.com/-QGVAZ5K96nM/VgpRFc3fvrI/AAAAAAAAA7E/RXBTuuGcu2k/s1600/legos.jpg \"Legos\")\r\n\r\nLater, I extracted bacardi gem from this project and improved the design. Let\'s use bacardi gem as an example for our discussion. After refactoring, the FraudCheck class now looks like this:\r\n\r\n```ruby\r\nmodule Bacardi\r\n  \r\n  class FraudCheck\r\n    def initialize(order, notifier)\r\n      @order = order\r\n      @notifier = notifier\r\n    end\r\n    \r\n    def no_malicious_product_change?\r\n       (@order.product_id == @notifier.item_number) && (@order.product_name == @notifier.item_name)\r\n    end\r\n  end\r\n  \r\nend\r\n```\r\n\r\nBoth attributes are used by the only method in this class. It also resulted in lot of small classes that were split to increase the cohesion. I was able to compose the small objects in another class to implement the required functionality. Here is another class from that project:\r\n\r\n```ruby\r\nrequire \'bigdecimal\'\r\n\r\nmodule Bacardi\r\n  \r\n  class Notification\r\n    def initialize(notifier)\r\n      @notifier = notifier\r\n    end\r\n    \r\n    def paid_currency\r\n      @notifier.currency\r\n    end\r\n    \r\n    def paid_gross\r\n      BigDecimal.new((@notifier.gross.to_f.abs.to_i) * 100)\r\n    end\r\n    \r\n    def confirmation_number\r\n      @notifier.invoice\r\n    end\r\n    \r\n    def receiver_email\r\n      @notifier.account\r\n    end\r\n  end\r\n  \r\nend\r\n```\r\n\r\nThe notifier attribute is used by all the methods in this case. Here is another small class with very high cohesion:\r\n\r\n```ruby\r\nrequire \'bigdecimal\'\r\n\r\nmodule Bacardi\r\n  \r\n  class Payment\r\n    def initialize(transaction)\r\n      @transaction = transaction\r\n    end\r\n    \r\n    def actual_currency\r\n      @transaction.currency\r\n    end\r\n    \r\n    def actual_gross\r\n      BigDecimal.new((@transaction.gross.to_f.abs.to_i) * 100)\r\n    end\r\n  end\r\n  \r\nend\r\n```\r\n\r\nFinally:\r\n\r\n```ruby\r\nrequire \'money\'\r\n\r\nmodule Bacardi\r\n  \r\n  class ProductAmount\r\n    def initialize(notification, payment)\r\n      @notification = notification\r\n      @payment = payment\r\n    end\r\n    \r\n    def correct?\r\n      actual_gross = @payment.actual_gross\r\n      actual_currency = @payment.actual_currency\r\n      paid_gross = @notification.paid_gross\r\n      paid_currency = @notification.paid_currency\r\n      \r\n      actual = ::Money.new(actual_gross, actual_currency)\r\n      paid = ::Money.new(paid_gross, paid_currency)\r\n      actual == paid\r\n    end\r\n  end\r\n  \r\nend\r\n```\r\n\r\nThis class is small and similar to other classes. The difficulty is in coming up with good names for the new classes. It forces you to find the missing abstraction. So you have to think hard to name them.\r\n\r\nSummary\r\n========\r\n--------------\r\n\r\nThe symmetry in code results in beautiful code. If you observe that tests lack symmetry in the constructor you can think about increasing cohesion and decompose the bigger class into smaller cohesive units to improve the overall design. The resulting design uses composition to compose the smaller objects and implements the desired functionality using delegation.\r\n','2015-09-07 18:21:29','2015-09-29 08:57:15'),(2591,'How to identify design cues by looking at the tests? Part 2','Objective \r\n=========\r\n---------\r\n\r\nLearn how to use design cues found in the tests to improve the design\r\n\r\nDiscussion\r\n=========\r\n---------\r\n\r\nA test that has complicated setup knows too much about the structure of the objects. Here is an example:\r\n\r\n```ruby\r\n  context \'Identify fraudulent changes\' do\r\n    before do\r\n      @item_number = 1\r\n      item_name = \'Essential TDD\'\r\n      @actual_amount = 100.00\r\n      @transaction = double(\'Transaction\')\r\n      @transaction.stub(:amount) { @actual_amount }\r\n      @transaction.stub(:currency) { \'USD\' }      \r\n      @notify = double(\'Notify\')      \r\n      @notify.stub(:currency) { \'USD\' }\r\n      @notify.stub(:item_number) { @item_number }\r\n      @notify.stub(:item_name) { item_name }\r\n      @notify.stub(:gross) { 1 }\r\n      @order = double(\'Order\')\r\n      @order.stub_chain(:product, :name) { item_name }\r\n    end\r\n    \r\n    it \'should identify fraudulent change when payment does not have correct amount\' do\r\n      @order.stub(:product_id) { @item_number }\r\n      @notify.stub(:gross) { @actual_amount - 50.00 }\r\n\r\n      fraud_policy = FraudPolicy.new(@notify, @transaction, @order)\r\n\r\n      expect(fraud_policy.no_fraudulent_change?).to be(false)\r\n    end\r\n\r\n    it \'should not be fraudulent change when payment has correct amount\' do\r\n      @order.stub(:product_id) { @item_number }\r\n\r\n      fraud_policy = FraudPolicy.new(@notify, @transaction, @order)\r\n\r\n      expect(fraud_policy.no_fraudulent_change?).to be(true)\r\n    end    \r\n    \r\n    it \'should be fraudulent change when item number (product_id) is not the same\' do\r\n      @order.stub(:product_id) { 2 }\r\n\r\n      fraud_policy = FraudPolicy.new(@notify, @transaction, @order)\r\n\r\n      expect(fraud_policy.no_fraudulent_change?).to be(false)      \r\n    end\r\n    \r\n    it \'should not be fraudulent change when item number (product_id) is the same\' do\r\n      @order.stub(:product_id) { @item_number }\r\n\r\n      fraud_policy = FraudPolicy.new(@notify, @transaction, @order)\r\n      \r\n      expect(fraud_policy.no_fraudulent_change?).to be(true)      \r\n    end\r\n    \r\n    it \'should be fraudulent change when item name (product name) is not the same\' do\r\n      @order.stub(:product_id) { @item_number }\r\n      @notify.stub(:item_name) { \'Sneaky Thing\' }\r\n      \r\n      fraud_policy = FraudPolicy.new(@notify, @transaction, @order)\r\n\r\n      expect(fraud_policy.no_fraudulent_change?).to be(false)      \r\n    end\r\n\r\n    it \'should not be fraudulent change when item name (product name) is the same\' do\r\n      @order.stub(:product_id) { @item_number }\r\n      \r\n      fraud_policy = FraudPolicy.new(@notify, @transaction, @order)\r\n\r\n      expect(fraud_policy.no_fraudulent_change?).to be(true)      \r\n    end\r\n    \r\n  end\r\n```\r\n\r\nThe individual tests override the values to put the required objects to a certain state for that particular test. The test seems to be easy to read, nevertheless, it leaks the structure of the objects and therefore does not hide the implementation details.\r\n\r\nAfter the redesign, the tests have much less context to build before we can exercise the SUT.\r\n\r\n```ruby\r\ndescribe Bacardi::FraudCheck do\r\n  \r\n  it \'return true if there is no malicious change in product_id and product_name\' do\r\n    order = Order.new\r\n    order.product_name = \'ETDD\'\r\n    order.product_id = 1\r\n    \r\n    notifier = Notifier.new\r\n    notifier.item_number = 1\r\n    notifier.item_name = \'ETDD\'\r\n    \r\n    fc = Bacardi::FraudCheck.new(order, notifier)\r\n    \r\n    result = fc.no_malicious_product_change?\r\n    \r\n    expect(result).to be_truthy\r\n  end\r\n  \r\n  it \'return false if there is malicious change in product_id and product_name\' do\r\n    order = Order.new\r\n    order.product_name = \'ETDD\'\r\n    order.product_id = 1\r\n    \r\n    notifier = Notifier.new\r\n    notifier.item_number = 1\r\n    notifier.item_name = \'ETDD2\'\r\n    \r\n    fc = Bacardi::FraudCheck.new(order, notifier)\r\n    \r\n    result = fc.no_malicious_product_change?\r\n    \r\n    expect(result).to be_falsy\r\n  end\r\n  \r\nend\r\n```\r\n\r\nHere there is only two objects that is required in the setup phase. Similarly, here is notification_spec.rb:\r\n\r\n```ruby\r\ndescribe Bacardi::Notification do\r\n  \r\n  before do\r\n    @notifier = Notifier.new\r\n  end\r\n  \r\n  it \'retrieve paid currency\' do\r\n    @notifier.currency = \'USD\'\r\n    notification = Bacardi::Notification.new(@notifier)\r\n    \r\n    result = notification.paid_currency\r\n    \r\n    expect(result).to eq(\'USD\')\r\n  end\r\n  \r\n  it \'retrieve paid gross\' do\r\n    @notifier.gross = \'20\'\r\n    notification = Bacardi::Notification.new(@notifier)\r\n    \r\n    result = notification.paid_gross\r\n    \r\n    expect(result).to eq(BigDecimal.new(2000))\r\n  end\r\n  \r\n  it \'retrieve confirmation number\' do\r\n    @notifier.invoice = \'1\'\r\n    notification = Bacardi::Notification.new(@notifier)\r\n    \r\n    result = notification.confirmation_number\r\n    \r\n    expect(result).to eq(\'1\')\r\n  end\r\n  \r\n  it \'retrieve receiver email\' do\r\n    @notifier.account = \'bugs@rubyplus.com\'\r\n    notification = Bacardi::Notification.new(@notifier)\r\n    \r\n    result = notification.receiver_email\r\n    \r\n    expect(result).to eq(\'bugs@rubyplus.com\')\r\n  end\r\n  \r\nend\r\n```\r\n\r\nThe payment_spec.rb also has simpler setup.\r\n\r\n```ruby\r\ndescribe Bacardi::Payment do\r\n  \r\n  before do\r\n    @transaction = Transaction.new    \r\n  end\r\n  \r\n  it \'retrieve currency for a transaction\' do\r\n    @transaction.currency = \'USD\'\r\n    payment = Bacardi::Payment.new(@transaction)\r\n    \r\n    actual_currency = payment.actual_currency \r\n    \r\n    expect(actual_currency).to eq(\'USD\')\r\n  end\r\n  \r\n  it \'retrieve gross for a transaction\' do\r\n    @transaction.gross = \'300.00\'\r\n    \r\n    payment = Bacardi::Payment.new(@transaction)\r\n    \r\n    actual_gross = payment.actual_gross \r\n    expected_amount_in_cents = BigDecimal.new(30000)\r\n    \r\n    expect(actual_gross).to eq(expected_amount_in_cents)\r\n  end\r\n  \r\nend\r\n```\r\n\r\nYou can browse the entire source code of [Bacardi gem](https://bitbucket.org/bparanj/neon \"Bacardi gem\") to see how the tests are simpler. This results in a better design.\r\n\r\nConclusion\r\n=========\r\n---------\r\n\r\nThe setup methods that knows too much about the object structure leaks implementation details to the client. Our tests are the very first client of our code. We must look for ways to reduce the context required to test for a given scenario, this will result in better design and easier to read tests.','2015-09-13 05:39:20','2015-09-13 05:39:20'),(2601,'Actor Action Object in Rails Projects','Objective\r\n==========\r\n----------\r\n\r\n- Learn how procedural code can be used in conjunction with object-oriented paradigm in your Rails projects\r\n\r\nDiscussion\r\n==========\r\n----------\r\n\r\nI was reading the \'Problem Restatement\' chapter from the book \'The Thinker\'s Toolkit\' by Morgan D. Jones. He was explaining how double negation is not natural to our mind. The double negation was also discussed by Steve McConnell in his Code Complete 2 book in the context of code. Then I came across the section \'Active Voice Facilitates\', where he states:\r\n\r\n>> A statement in passive voice takes longer to process than one in active voice. Because the mind\'s basic linguistic programming interprets and forms sentences in terms of actor-action-object, not object-action-actor. When children first begin speaking, they say, \'Tom throws the ball\' not \'The ball is thrown by Tom\'. Of course, children quickly learn to make sense of passive voice, but to do so, they first have to mentally rearrange the sentence to identify the actor, the action and the object. By the time we\'re adults, our minds have become adept at forming and interpreting complicated statements in passive voice. Nevertheless, our mental linguistic machinery, which is hardwired into the brain, doesn\'t change. When the object in a statement comes first, the mind must still set the object aside until the actor and action become known. The slight difficulty we have with passive voice probably stems from the mind\'s built-in propensity to view the world in terms of cause-and-effect relationships. Thus, the mind is programmed to see cause first and effect second. But passive voice puts the effect ahead of cause, so the mind has to reverse their order to interpret the statement.\r\n         ---- The Thinkers\'s Toolkit by Morgan D. Jones\r\n\r\nActor Action Object\r\n==========\r\n----------\r\n\r\nSo the question is : \r\n\r\n### How can we represent the Actor-Action-Object in our Rails projects? \r\n\r\nYou can see how I structure my code in [Striped](https://bitbucket.org/bparanj/striped \"Striped\") Rails project. The folder structure looks like this : app/actors/customer/use_cases. In this folder the use cases are listed as files with names : \r\n\r\n```\r\nadd_new_credit_card.rb\r\nguest_checkout.rb\r\none_click_checkout.rb\r\nregister_for_an_account.rb \r\n```\r\n\r\nand so on. This represents the Actor-Action part of the Actor-Action-Object structure.  The Action part, `add_new_credit_card.rb` is not an object. It is a method. The source code looks like this:\r\n\r\n```ruby\r\nmodule Actors\r\n  module Customer\r\n    module UseCases\r\n      \r\n      def self.add_new_credit_card(user, stripe_token)\r\n        card = StripeGateway.add_new_credit_card(user.stripe_customer_id, stripe_token)\r\n              \r\n        # Update our database with last 4 digits, expiration date and month.          \r\n        StripeCustomer.save_credit_card_details(card, user)\r\n        card\r\n      end      \r\n      \r\n    end\r\n  end\r\nend\r\n```\r\n\r\nThis is consistent with the fact that Action in Actor-Action-Object represents the verb, the actual use case name. The actor is interacting with our system, the use case name represents that interaction. The Action part encapsulates all the objects that are required to satisfy the use case. Here is the guest_checkout.rb:\r\n\r\n```ruby\r\nmodule Actors\r\n  module Customer\r\n    module UseCases\r\n      \r\n      def self.guest_checkout(product_id, stripe_token, user)\r\n        amount = Product.price_in_cents_for(product_id)\r\n        customer = StripeGateway.save_credit_card(stripe_token)\r\n        charge = StripeGateway.charge(amount, customer.id)\r\n        \r\n        StripeCustomer.save_credit_card_and_stripe_customer_id(customer, user)      \r\n        StripeCustomer.create_payment(product_id, user.id, charge.id)\r\n      end      \r\n      \r\n    end\r\n  end\r\nend\r\n```\r\n\r\nThe use case delegates all the work to appropriate classes or objects. It does not do any work, it knows how to co-ordinate the work that needs to be done by different classes or objects. So the Object part of our Actor-Action-Object structure is usually many.\r\n\r\nThe controller calls these methods, for instance, subscription_controller create action does this:\r\n\r\n```ruby\r\n@success = Actors::Customer::UseCases.subscribe_to_a_plan(current_user, \r\n                                                          params[:stripeToken], \r\n                                                          params[:plan_name])  \r\n```\r\n\r\nService Objects in the Wild\r\n==========\r\n----------\r\n\r\nThe use cases are named with the name of the corresponding use case. The file name is not a class name but a verb. Each use case is encapsulated as a stateless method in a module. It is not an object. So you cannot say my implementation uses a \'Service Object\' because it is not an object. It does not have any state. \r\n\r\nIt resembles a service object in the sense, it follows the accept input, perform work, return result structure. It is also similar to a \'service\' in the sense, it does describe system interactions. It usually will involve more than one object in our application.\r\n\r\nI don\'t name classes with verbs, looks like developers are not following the basics of OO design. They try to fit square peg in a round hole. Here is an example [Service Objects in Rails](https://netguru.co/blog/service-objects-in-rails-will-help \"Service Objects in Rails\") where he names an object as CreateInvoice. This is wrong, not just naming wise, you don\'t need to create an object in order to just invoke call on that object. You could easily turn that into a stateless method. Why unnecessarily create objects when you don\'t need them?\r\n\r\nThis post [Gourmet Service Objects] (http://brewhouse.io/blog/2014/04/30/gourmet-service-objects.html \'Gourmet Service Objects\') says Service Object does only one thing. My use case handler does more than just one thing. It interacts with external systems, updates the database, send emails etc.\r\n\r\nThis article here [Rails Controllers and Services] (https://blog.engineyard.com/2014/keeping-your-rails-controllers-dry-with-services \'Rails Controllers and Services\') uses Service Object for credit card processing. I would use the Gateway Object (An object that encapsulates access to an external system or resource) as discussed by Martin Fowler in his [Patterns of Enterprise Application Architecture](http://martinfowler.com/eaaCatalog/gateway.html \'Patterns of Enterprise Application Architecture\') book.\r\n\r\nWhen you find yourself violating the basic principles of OO design, it is a sign that your design needs improvement. There is no need to hide the use cases in your system. Make them explicit. Use cases are procedural in nature. It will cut across objects in different layers of your system. We don\'t have to represent them as objects. There seems to be lot of confusion about Service Objects because developers are not following the industry standard terminology in the Ruby community.\r\n\r\nSummary\r\n=========\r\n----------\r\n\r\nWe can represent the Actor-Action-Object in our Rails project to make the code easy to read. We can easily find out the use cases supported by the Rails project simply by looking at the use_cases folder. It also allows us to implement the \"Tell Don\'t Ask\" principle easily. I don\'t agree with Eric Evans about the need for Service Object, especially in web applications. I believe Actor-Action-Object results in a better design. Because a developer\'s mental model maps well to the system when you use Actor-Action-Object Pattern.','2015-09-15 03:22:25','2016-12-22 23:15:46'),(2611,'Problem Solving Techniques for Developers','Objective\r\n=====\r\n-----\r\n\r\nTo learn how to use Fishbone Diagram, Why-Why Diagram and How-How Diagrams\r\n\r\nFishbone Diagram\r\n=====\r\n-----\r\n\r\nFishbone Diagram is an useful approach to identifying problems. It was developed by Professor Kaoru Ishikawa of the University of Tokyo. The primary purpose of this exercise is to identify and list all the possible causes of the problem. The problem and its causes are recorded as a diagram that resembles the skeleton of a fish. \r\n\r\n<img src=\"https://3.bp.blogspot.com/-X8xRSmGM9Nw/VfvJVcrOJGI/AAAAAAAAA6M/s-zduLGJytI/s1600/pss4rp-1.jpg\" alt=\"Fish Bone Diagram\" width=\"825\" height=\"697\"/>\r\n\r\nIn the example, you can see that the problem is on the fish head. The causes of the problem is listed on the stems. Ishikawa describes the process as one in which \'you write your problem down on the head of the fish and then let it cook overnight\'. The completed diagram is analyzed to determine the problems that needs to be solved. In order to determine the relative important of the causes, we can use [Pair Ranking](https://bitbucket.org/bparanj/rasam \'Pair Ranking\') algorithm.  \r\n\r\nWhy-Why Diagram\r\n=====\r\n-----\r\n\r\nThis technique is a variation of the Fishbone Diagram. It is used to identify the causes of a problem in a systematic way. It moves from left to right. The problem statement is on the left-hand side. You ask the question \'Why?\' and list the possible causes in ovals that connects to the problem statement. For each of the causes, we ask the question \'Why?\' to identify the possible causes. This is listed and connects to its corresponding cause.\r\n\r\n<img src=\"https://2.bp.blogspot.com/-vEXYfxSQVe8/VfvLhxKzTzI/AAAAAAAAA6s/qqrItba2pC0/s1600/why-why-diagram.jpg\" alt=\"Why Why Diagram\" width=\"825\" height=\"697\"/>\r\n\r\n<img src=\"https://2.bp.blogspot.com/-5f_d6S3Hqt4/VfvJarvTs4I/AAAAAAAAA6U/d9Wob7FRfso/s1600/pss4rp-4.jpg\" alt=\"Why Why Diagram\" width=\"825\" height=\"697\"/>\r\n\r\nHow-How Diagram\r\n=====\r\n-----\r\n\r\nThe How-How Diagram is used to identify the steps necessary to implement a solution. You ask \'How?\' and list the possible solutions on the left side of the paper. For each of the solution, you ask the question \'How?\'. The answer with a more detailed action plan is placed on the right. This technique is extremely useful to think about the details of implementation.\r\n\r\n<img src=\"https://3.bp.blogspot.com/-aROzFDkp6q4/VfvJbOaj-KI/AAAAAAAAA6Y/Jx-yiVJtsHg/s1600/pss4rp-3.jpg\" alt=\"How How Diagram\" width=\"825\" height=\"697\"/>\r\n\r\nSummary\r\n=====\r\n-----\r\n\r\nThe Fishbone Diagram, Why-Why Diagram and How-How Diagram are extremely useful to solve problems. It can be used to analyze a problem in a systematic way and discuss the alternative solutions to any problem. You can use them with other developers to come up with better design for your software projects.\r\n\r\nReference:\r\n=====\r\n-----\r\n\r\n101 Creative Problem Solving Techniques by James M. Higgins','2015-09-18 09:09:57','2016-04-02 20:02:01'),(2621,'Unit Testing Sending Emails in Rails 4.2.4 using EmailSpec gem','Objective \r\n=========\r\n---------\r\n\r\nTo learn how to write unit test for sending emails in Rails 4.2.4 webapp.\r\n\r\nSteps\r\n=========\r\n---------\r\n\r\nStep 1 \r\n---------\r\n\r\nInstall email_spec gem. Add the gem to the Gemfile:\r\n\r\n```ruby\r\ngroup :test do\r\n  gem \'email_spec\'\r\nend\r\n```\r\n\r\nand run :\r\n\r\n```sh   \r\nbundle\r\n```\r\n\r\nStep 2 \r\n---------\r\n\r\nCreate a file spec/support/email_spec.rb:\r\n\r\n```ruby\r\nrequire \'email_spec\'\r\n\r\nRSpec.configure do |config|\r\n\r\n  config.include EmailSpec::Helpers\r\n  config.include EmailSpec::Matchers\r\n\r\n  config.before(:each) do\r\n    reset_mailer # Clears out ActionMailer::Base.deliveries\r\n  end\r\n\r\nend\r\n```\r\n\r\nStep 3\r\n---------\r\n\r\nRequire `email_spec` in your `spec_helper.rb`:\r\n\r\n```ruby\r\nrequire \"email_spec\"\r\n```\r\n\r\nYou might get an error:\r\n\r\n```sh\r\nNeither Pony nor ActionMailer appear to be loaded so email-spec is requiring ActionMailer.\r\n```\r\n\r\nTo get rid of this message, you can require `action_mailer` before `email_spec` like this:\r\n\r\n```ruby\r\nrequire \'action_mailer\'\r\nrequire \"email_spec\"\r\n```\r\n\r\nStep 4\r\n---------\r\n\r\nStart making use of `email_spec` helpers and matchers.  Here is my `spec/mailers/purchase_confirmation_mailer_spec.rb`:\r\n\r\n```ruby\r\nrequire \"rails_helper\"\r\n\r\nRSpec.describe PurchaseConfirmationMailer, :type => :mailer do\r\n  \r\n  before do\r\n    @product = Fabricate(:product)\r\n    customer = Fabricate(:customer_with_orders)\r\n    @payment = customer.payments.first\r\n        \r\n    @email = PurchaseConfirmationMailer.receipt_email(@product, @payment, customer).deliver_now\r\n  end\r\n  \r\n  it \'purchase confirmation mail has from address\' do    \r\n    expect(@email.from).to eq([\'support@zepho.com\'])\r\n  end\r\n  \r\n  it \'purchase confirmation mail has email subject\' do\r\n    expect(@email.subject).to eq(\'[RubyPlus] Purchase Confirmation\')\r\n  end\r\n\r\n \r\n  it \"purchase confirmation mail is sent to customer\'s email\" do\r\n    expect(@email).to deliver_to(\'bugs-bunny@zepho.com\')\r\n  end\r\n\r\n  it \"purchase confirmation mail has receipt number\" do\r\n    expect(@email).to have_body_text(@payment.receipt_number)\r\n  end\r\n\r\n  it \"purchase confirmation mail has product name\" do\r\n    expect(@email).to have_body_text(@product.name)\r\n  end\r\n\r\n  it \"purchase confirmation mail has product price\" do\r\n    expect(@email).to have_body_text(@product.price.to_s)\r\n  end\r\n\r\n  it \"purchase confirmation mail has login url\" do\r\n    expect(@email).to have_body_text(/#{new_customer_session_url}/)\r\n  end\r\n\r\nend\r\n```\r\n\r\nThe tested `app/mailers/purchase_confirmation_mailer.rb` class looks like this:\r\n\r\n```ruby\r\nclass PurchaseConfirmationMailer < ActionMailer::Base\r\n  default from: \"support@zepho.com\"\r\n  \r\n  def receipt_email(product, payment, customer)\r\n    @product = product\r\n    @payment = payment\r\n    \r\n    category \'Purchase Confirmation\'\r\n    mail(to: customer.email, subject: \'[RubyPlus] Purchase Confirmation\')\r\n  end\r\nend\r\n```\r\n\r\n*Note* : If you are using sendgrid-emails gem to send emails make sure the `config/initializers/mail.rb` has a `dummy_recipient` set up like this:\r\n\r\n```ruby\r\nSendGrid.configure do |config|\r\n  config.dummy_recipient = \'bugs-bunny@zepho.com\'\r\nend\r\n```\r\n\r\nSummary\r\n=========\r\n---------\r\n\r\nWe can easily write unit tests using email_spec gem to check that we are sending the email to the right person, from the right email address with the correct subject. We also check that the variables used in the templates are rendered in the email text.','2015-09-19 23:44:59','2015-12-17 20:22:17'),(2631,'Stepwise Refinement','Objective\r\n=========\r\n---------\r\n\r\nTo learn about Stepwise Refinement\r\n\r\nProblem\r\n=====\r\n-----\r\n\r\nI am the laziest professor ever. I\'ve given a multiple choice test (A-D are valid answers) but I lost my test key. I\'ll assume that whatever answer was most popular for a question is the correct answer.\r\n\r\nI\'ve included a file that contains the students quiz answers. Each row represents one student. Write code that figures out the most popular answer to each question and then prints out the key.\r\n\r\nExample\r\n=====\r\n-----\r\n\r\nGiven:\r\n-----\r\n\r\nABCCADCB\r\nDDDCAACB\r\nABDDABCB\r\nAADCAACC\r\nBBDDAACB\r\nABDCCABB\r\nABDDCACB\r\n\r\nOutput:\r\n-----\r\n\r\nABDCAACB\r\n\r\nAnalysis\r\n=====\r\n-----\r\n\r\nQuestion # : 1 2 3 4 5 6 7 8\r\nAnswers    :  ?\r\n\r\nThere are seven students.\r\nThere are eight questions.\r\n\r\nSteps\r\n=====\r\n-----\r\n\r\nStep 1\r\n-----\r\n\r\n1. Figure out the most popular answer to each question\r\n2. Print out the key\r\n\r\nStep 2\r\n-----\r\n\r\n1. Figure out the most popular answer to each question\r\n\r\n```sh\r\n      for each of the 8 questions\r\n        Find the most popular answer\r\n        Save the answer\r\n      end\r\n```\r\n\r\n2. Print out the key\r\n      Print the answer for each question in the saved answer key\r\n\r\nStep 3\r\n-----\r\n\r\n1. Figure out the most popular answer to each question\r\n\r\n```sh\r\n      for each of the 8 questions\r\n        Find the most popular answer\r\n              Possible Answers are : A, B, C, D\r\n              Initialize the number of answers to 0 for all the possible answers\r\n              For each of the 7 students\r\n                Check the answer by the student\r\n                Increment the count for the answer\r\n              end  \r\n        Save the answer\r\n      end\r\n```\r\n\r\n2. Print out the key\r\n      Print the answer for each question in the saved answer key\r\n        \r\nThis is the blueprint for our program. This blueprint can be used to code the solution in any language.\r\n\r\nStep 4\r\n-----\r\n\r\nWhat is the structure of the input? Let\'s assume an array of answers arranged by students:\r\n\r\n[\'ABCCADCB\',\'DDDCAACB\', \'ABDDABCB\', \'AADCAACC\', \'BBDDAACB\', \'ABDCCABB\', \'ABDDCACB\']\r\n\r\nStep 5\r\n-----\r\n\r\n```ruby\r\n@submissions = [\'ABCCADCB\',\'DDDCAACB\', \'ABDDABCB\', \'AADCAACC\', \'BBDDAACB\', \'ABDCCABB\', \'ABDDCACB\']\r\nanswer_key = []\r\n\r\ndef find_most_popular_answer_for(question)\r\n  key = Hash.new(0)  \r\n  \r\n  for submission in @submissions\r\n    key[submission[question]] += 1\r\n  end\r\n  key.max_by{|k,v| v}\r\nend\r\n\r\nfor question in (0..7).to_a \r\n  answer_key << find_most_popular_answer_for(question)\r\nend\r\n\r\nputs answer_key\r\n```\r\n\r\nAfter I wrote the program, I had to add max_by to retain only the highest scoring answer for the given question. You can always go back and refine the step when required.\r\n\r\nSummary\r\n=====\r\n-----\r\n\r\nStepwise Refinement is a useful technique for solving problems. We can start with the \'What\' and gradually move towards the \'How\' and finally code the solution for a given problem.\r\n\r\nResources\r\n=====\r\n-----\r\n\r\n[Lazy Professor](https://github.com/SeaRbSg/braincandy/blob/master/lazy-professor/README.md \'Lazy Professor\')\r\n\r\nProgram Development by Stepwise Refinement Niklaus Wirth','2015-10-02 00:48:17','2015-10-02 01:32:55'),(2641,'Single Purpose Principle ','Objective\r\n==========\r\n----------\r\n\r\n- To learn about Single Purpose Principle\r\n\r\n>> A class should capture one and only one key abstraction\r\n>> Object Oriented Design Heuristics by Arthur Riel\r\n\r\nWhere Did this Confusion Begin?\r\n==========\r\n----------\r\n\r\nRobert C. Martin came up with the Single Responsibility Principle in 1995. The problem is CRC card already had used the term Responsibility to mean something different. CRC cards came way back in 1989. Also Robert Martin redefined the term responsibility to mean a reason to change. He basically took the concept of cohesion and added his own insights to come up with Single Responsibility Principle. \r\n\r\n![alt text](https://images.rubyplus.com/bigstock_Time_For_Change.jpg \"Time to Change\")\r\n\r\nThe main point of this principle is that there should be only one reason to change. I don\'t want to call it Single Responsibility Principle because of the confusion it creates with the existing terminology. Since this principle says that the set of responsibilities (as used by CRC cards) should be focused on one purpose, I think it is appropriate to call it `Single Purpose Principle`.\r\n\r\nSingle Purpose\r\n==========\r\n----------\r\n\r\n![alt text](https://images.rubyplus.com/unix_test.png \"Good Design is Timeless\")\r\n\r\nUnix is a perfect example for following the Single Purpose Principle. Each command line utility does one thing really well. It proves that good design is timeless.\r\n\r\nHow to Recognize Violation of Single Purpose Principle?\r\n===================\r\n-------------------\r\n\r\nLet\'s discuss the examples that are used in Robert C. Martins\'s SRP: The Single Responsibility Principle.\r\n\r\nExample 1 : Bowling\r\n------------\r\n\r\n```\r\nGame - Keep track of frames\r\nScorer - Calculate the score\r\n```\r\n\r\nEach of the above is an axis of change. What is an axis of change? How do you recognize different axes of change? He does not explain in his paper. It is confusing. If you ask yourself the questions:\r\n\r\n1. Does the operations operate on the data most of time?\r\n2. Is the data and operations on it related together?\r\n3. Is this class highly cohesive?\r\n\r\nthen it will be easy to recognize that we need to separate the Game and Scorer objects. In this example the abstractions are consistent and they are at the application level.\r\n\r\nExample 2 : Rectangle\r\n------------\r\n\r\n```\r\nApplication 1 : Computational geometry\r\nApplication 2 : Graphical in nature\r\n```\r\n\r\nThese are different abstractions. One is at the UI level and the other is at the domain level. The abstractions must be consistent, you cannot mix different levels of abstraction into one class. \r\n\r\nHe says : \r\n\r\n>> In the context of the Single Responsibility Principle (SRP) we define a responsibility to be `a reason for change`. If you can think of more than one motive for changing a class, then that class has more than one responsibility. This is sometimes hard to see.\r\n\r\nYes, it is hard to see because, you can always say that there is only one reason to change when in reality there is more than one reason. This happens when you mix different levels of abstraction. \r\n\r\nFor instance, I worked on a project where I had to upload files to Amazon S3. The requirements demanded that I configure the number of threads that can upload files at once to S3. I wrote threading library that did not have any dependency on the S3 file uploader. The S3 file uploader was not aware that it was used by multiple threads. The plumbing code was separated from the actual task in the application. Later I can replace the threading library with a library that uses Celluloid to abstract away the plumbing code. This change will not impact the S3 file uploader.\r\n\r\nExample 3 : Modem \r\n------------\r\n\r\nThis example also mixes different levels of abstraction.\r\n\r\n```\r\nConnection : Plumbing level abstraction (dial and hangup)\r\nData Channel : Application level abstraction (send and receive)\r\n```\r\n\r\nThe plumbing and application level abstractions are not separated.\r\n\r\nExample 4 : Employee\r\n------------\r\n\r\nEmployee class with `calculate_pay`, `save`, `report_hours` methods violates the SRP. In this case, he argues that the people who request changes for the business rules are different from those who request changes to the saving functionality related to the database.\r\n\r\nIt is very clear in this example also that the Employee class mixes different levels of abstraction. We need to separate persistence level abstraction from application level abstraction. By applying `Separation of Concerns` we can easily recognize that the class has more than one purpose.\r\n\r\nHis Conclusion\r\n------------\r\n\r\nThe SRP is one of the simplest of the principle, and one of the hardest to get right. Conjoining responsibilities is something that we do naturally. Finding and separating those responsibilities from one another is much of what software design is really about.\r\n\r\nMy Thoughts\r\n------------\r\n\r\nAnother flaw in his reasoning can be illustrated by using the Amazon S3 uploader I mentioned earlier. In this case, the stake holders who would demand changes due to threading is not different from file uploading aspect. So since the stake holder is the same you would think it follows Single Purpose Principle. But that is wrong. Because we know that we are mixing different levels of abstraction and it can change due to two different reasons: plumbing related code and the file uploading related code.\r\n\r\nFocus on keeping abstractions consistent. Do not mix different levels of abstraction. It will be easier to make better design decisions. You can read `Code Complete 2` by Steve McConnell for more detailed explanation.    \r\n\r\nSummary\r\n===========\r\n-----------\r\n\r\nIn this article you learned about Single Purpose principle. If we apply Single Purpose Principle throughout the system we will obey the Separation of Concerns principle and the system will be organized into different layers. Each layer will be focused on fulfilling one purpose such as Object Relational Mapping layer, data conversion for external system and so on. For a good discussion on this topic, read [The Art of Separation of Concerns](http://aspiringcraftsman.com/2008/01/03/art-of-separation-of-concerns/ \'The Art of Separation of Concerns\'). ','2015-10-06 06:00:18','2016-12-22 23:17:47'),(2651,'The Three Basic Rules for a Good Design','Objective\r\n=========\r\n---------\r\n\r\nTo learn how to apply basic object oriented design principles\r\n\r\nProblem\r\n=========\r\n---------\r\n\r\nWrite a program that:\r\n\r\n1. Loads a set of employee records from a flat file\r\n2. Sends a greetings email to all employees whose birthday is today\r\n\r\nThe flat file is a sequence of records, separated by newlines; these are the first few lines:\r\n\r\n```sh\r\nlast_name, first_name, date_of_birth, email\r\nDoe, John, 1982/10/08, john.doe@foobar.com\r\nAnn, Mary, 1975/09/11, mary.ann@foobar.com\r\n```\r\n\r\nThe greetings email contains the following text:\r\n\r\n```sh\r\nSubject: Happy birthday!\r\n\r\nHappy birthday, dear <first_name>!\r\n\r\nwhere first_name is the place holder for first name.\r\n```\r\n\r\nObject Oriented Design Basic Principles\r\n=========\r\n---------\r\n\r\nWe will apply the following three basic principles:\r\n\r\n1. Separate things that change from things that stays the same. Encapsulate what varies behind a well-defined interface.\r\n2. Program to interfaces, not implementations. This exploits polymorphism.\r\n3. Depend on abstractions. Do not depend on concrete classes.\r\n\r\nHigh Level Steps\r\n=========\r\n---------\r\n\r\n1. Read data.txt file\r\n2. Check if date of birth is today\r\n3. Send greetings email if today is the person\'s birthday\r\n\r\nLet\'s read a CSV file that contains data.\r\n\r\n```ruby\r\nfile_name = \"data.txt\"\r\n\r\ntext = open(file_name)\r\n\r\nprint text.read\r\n```\r\n\r\nRefine the step 1.\r\n\r\n```sh\r\n1. Read data.txt CSV file\r\n	Skip the header\r\n2. Check if date of birth is today\r\n3. Send greetings email if today is birthday\r\n```\r\n\r\nHere is our simple program that we can start playing with:\r\n\r\n```ruby\r\nrequire \'csv\'\r\n\r\nfile_name = \"#{Dir.pwd}/data.txt\"\r\n\r\ndata = CSV.read(file_name, {headers: true}) \r\n\r\ndata.each do |x|\r\n  p x\r\nend\r\n```\r\n\r\nRefine the step 2\r\n\r\n```sh\r\n1. Read data.txt CSV file\r\n	Skip the header\r\n2. Check if date of birth is today\r\n	Retrieve the third column\r\n	Remove the spaces at the ends\r\n	Check if month and date is the same as today\'s month and date\r\n	If yes, return the person\'s first name\r\n3. Send greetings email if today is birthday\r\n```\r\n\r\nRefine the step 3\r\n\r\n```sh\r\n1. Read data.txt CSV file\r\n	Skip the header\r\n2. Check if date of birth is today\r\n	Retrieve the third column\r\n	Remove the spaces at the ends\r\n	Check if month and date is the same as today\'s month and date\r\n	If yes, return the person\'s first name\r\n3. Send greetings email\r\n	Use Gmail, Sendgrid, Pony etc.\r\n```\r\n\r\nBefore\r\n=========\r\n---------\r\n\r\nThe program written that does not apply the 3 design principles looks like this: \r\n\r\n```ruby\r\nrequire \'csv\'\r\n\r\nfile_name = \"#{Dir.pwd}/data.txt\"\r\n\r\ndata = CSV.read(file_name, {headers: true}) \r\n\r\ndata.each do |x|\r\n  birth_date = x[2].strip!\r\n  month = birth_date[5..6]\r\n  day = birth_date[8..9]  \r\n  \r\n  if (month.to_i == Date.today.month) and (day.to_i == Date.today.day)\r\n    p x[1].strip\r\n    \r\n    email = <<EMAIL_TEXT\r\nSubject: Happy birthday!\r\n\r\n    Happy birthday, dear #{x[1].strip}!\r\nEMAIL_TEXT\r\n    \r\n    p email\r\n  end\r\nend\r\n```\r\n\r\nAnalysis\r\n=========\r\n---------\r\n\r\nThis program has the following responsibilities:\r\n\r\n1. Parsing CSV file\r\n2. Checking if today is the birthday of a person\r\n3. Sending email\r\n\r\nLet\'s make a list of things that can change.\r\n\r\n- Input data source\r\n- How greetings is sent\r\n\r\nThings that stays the same are:\r\n\r\n- Logic to find if someone\'s birthday is today.\r\n\r\nStep 1\r\n=========\r\n---------\r\n\r\nThe PersonFileStore class will have records method that will return a list of Person objects. The code that applies what we did in analysis now looks like this:\r\n\r\n```ruby\r\nrequire \'csv\'\r\n\r\n# This is a domain object\r\n# This object has no dependency on other objects. It is agnostic to storage mechanism\r\nclass Person \r\n  attr_reader :first_name\r\n  \r\n  def initialize(first_name, last_name, date_of_birth, email)\r\n    @first_name = first_name\r\n    @last_name = last_name\r\n    @date_of_birth = date_of_birth\r\n    @email = email\r\n  end\r\n  \r\n  def birth_day\r\n    @date_of_birth[8..9]  \r\n  end\r\n  \r\n  def birth_month\r\n    @date_of_birth[5..6]\r\n  end\r\nend  \r\n\r\n# This class knows how to parse the CSV file to create Person objects\r\n# The direction of dependency is from PersonFileStore to the domain object\r\nclass PersonFileStore\r\n  def initialize(file)\r\n    @file = file\r\n  end\r\n\r\n  def records\r\n    result = []\r\n    data = CSV.read(@file, {headers: true}) \r\n    data.each do |x|\r\n      person = Person.new(x[1], x[0], x[2].strip!, x[3])\r\n      \r\n      result << person\r\n    end    \r\n    result\r\n  end\r\nend\r\n\r\n# This section of the code is not yet cleaned up.\r\npfs = PersonFileStore.new(\"#{Dir.pwd}/data.txt\")\r\nrecords = pfs.records\r\n\r\nrecords.each do |person|\r\n  month = person.birth_month\r\n  day = person.birth_day\r\n  \r\n  if (month.to_i == Date.today.month) and (day.to_i == Date.today.day)\r\n    \r\n    email = <<EMAIL_TEXT\r\nSubject: Happy birthday!\r\n\r\n    Happy birthday, dear #{person.first_name}!\r\nEMAIL_TEXT\r\n    \r\n    p email\r\n  end\r\n  \r\nend\r\n```\r\n\r\nStep 2\r\n=========\r\n---------\r\n\r\nLet\'s extract the logic to find if anyone has a birthday today.\r\n\r\n```ruby\r\n# Person and PersonFileStore classes is same as before.\r\n\r\n# This class encapsulates the logic to find out if the birthday is today or not.\r\n# It has no dependency on other objects\r\nclass BirthDay\r\n  def initialize(month, day)\r\n    @month = month\r\n    @day = day\r\n  end\r\n  \r\n  def today?\r\n    (@month.to_i == Date.today.month) and (@day.to_i == Date.today.day)\r\n  end\r\nend\r\n\r\npfs = PersonFileStore.new(\"#{Dir.pwd}/data.txt\")\r\nrecords = pfs.records\r\n\r\nrecords.each do |person|\r\n  month = person.birth_month\r\n  day = person.birth_day\r\n  \r\n  birth_day = BirthDay.new(month, day)\r\n\r\n  if birth_day.today?\r\n    \r\n    email = <<EMAIL_TEXT\r\nSubject: Happy birthday!\r\n\r\n    Happy Birthday, Dear #{person.first_name}!\r\nEMAIL_TEXT\r\n    \r\n    p email\r\n  end\r\n  \r\nend\r\n```\r\n\r\nStep 3\r\n=========\r\n---------\r\n\r\nLet\'s extract sending greeting.\r\n\r\n```ruby\r\n# Person, PersonFileStore and Birthday classes is same as before.\r\n\r\n# Sending email to the console output is encapsulated within the send interface\r\nclass GreetingConsole\r\n  def initialize(message, email)\r\n    @message = message\r\n	@email = email\r\n  end\r\n  \r\n  def send\r\n    p \"Sending email to : #{email}\"\r\n    p @message    \r\n  end\r\nend\r\n\r\n# The following code is the client code\r\npfs = PersonFileStore.new(\"#{Dir.pwd}/data.txt\")\r\nrecords = pfs.records\r\n\r\nrecords.each do |person|\r\n  month = person.birth_month\r\n  day = person.birth_day\r\n  \r\n  birth_day = BirthDay.new(month, day)\r\n\r\n  if birth_day.today?\r\n    message = <<EMAIL_TEXT\r\nSubject: Happy Birthday!\r\n\r\n    Happy Birthday, Dear #{person.first_name}!\r\nEMAIL_TEXT\r\n    # Client is tied to a specific implementation of sending an email message\r\n    # This needs to change to GreetingEmail.new(message), greeting.send to send email greeting\r\n    greeting = GreetingConsole.new(message)\r\n    greeting.send\r\n  end\r\n  \r\nend\r\n```\r\n\r\nStep 4\r\n=========\r\n---------\r\n\r\nLet\'s add an in-memory data source and make it work.\r\n\r\n```ruby\r\nclass PersonMemoryStore\r\n\r\n  def records\r\n    result = []\r\n    \r\n    person = Person.new(\'Bugs\', \'Bunny\', \'1982/10/06\', \'bbunny@rubyplus.com\')\r\n    result << person\r\n\r\n    person = Person.new(\'Daffy\', \'Duck\', \'1975/09/11\', \'dduck@rubyplus.com\')          \r\n    result << person\r\n    \r\n    result\r\n  end\r\n  \r\nend\r\n\r\n# The following code is the client code\r\npfs = PersonMemoryStore.new\r\nrecords = pfs.records\r\n\r\nrecords.each do |person|\r\n  month = person.birth_month\r\n  day = person.birth_day\r\n  \r\n  birth_day = BirthDay.new(month, day)\r\n\r\n  if birth_day.today?\r\n    message = <<EMAIL_TEXT\r\nSubject: Happy Birthday!\r\n\r\n    Happy Birthday, Dear #{person.first_name}!\r\nEMAIL_TEXT\r\n    # Client is tied to a specific implementation of sending an email message\r\n    # This needs to change to GreetingEmail.new(message), greeting.send to send email greeting\r\n    greeting = GreetingConsole.new(message)\r\n    greeting.send\r\n  end\r\n  \r\nend\r\n```\r\n\r\nNotice that the PersonMemoryStore has the same interface as the PersonFileStore class. In a real project, we could use SQLite in-memory database.\r\n\r\nStep 5\r\n=========\r\n---------\r\n\r\nLet\'s add a different way to send email by using Pony gem.\r\n\r\n```ruby\r\nrequire \'pony\'\r\n\r\n# Sending a real email using Pony gem\r\nclass GreetingPony\r\n  def initialize(message, email)\r\n    @message = message\r\n    @email = email\r\n  end\r\n  \r\n  def send\r\n    Pony.mail(:to => @email, :from => \'admin@rubyplus.com\', :subject => \'Happy Birthday!\', :body => @message)\r\n  end\r\nend\r\n```\r\n\r\nAfter\r\n=========\r\n---------\r\n\r\nThe channel folder has `greeting_console.rb` and `greeting_pony.rb` classes. The GreetingConsole class looks like this:\r\n\r\n```ruby\r\n# Sending email to the console output is encapsulated within the send interface\r\nclass GreetingConsole\r\n  def initialize(message, email)\r\n    @message = message\r\n    @email = email\r\n  end\r\n  \r\n  def send\r\n    p \"Sending email to : #{@email}\"\r\n    p \"Subject : Happy Birthday!\"\r\n    p @message    \r\n  end\r\nend\r\n```\r\n\r\nHere is the GreetingPony class:\r\n\r\n```ruby\r\nrequire \'pony\'\r\n\r\n# Sending a real email using Pony gem\r\nclass GreetingPony\r\n  def initialize(message, email)\r\n    @message = message\r\n    @email = email\r\n  end\r\n  \r\n  def send\r\n    Pony.mail(:to => @email, :from => \'admin@rubyplus.com\', :subject => \'Happy Birthday!\', :body => @message)\r\n  end\r\nend\r\n```\r\n\r\nThe domain folder contains the BirthDay and Person classes. Here is the BirthDay class:\r\n\r\n```ruby\r\nrequire \'date\'\r\n\r\n# This class encapsulates the logic to find out if the birthday is today or not.\r\n# It has no dependency on other objects\r\nclass BirthDay\r\n  def initialize(month, day)\r\n    @month = month\r\n    @day = day\r\n  end\r\n  \r\n  def today?\r\n    (@month.to_i == Date.today.month) and (@day.to_i == Date.today.day)\r\n  end\r\nend\r\n```\r\n\r\nHere is the Person class:\r\n\r\n```ruby\r\n# This is a domain object\r\n# This object has no dependency on other objects. It is agnostic to storage mechanism\r\nclass Person \r\n  attr_reader :first_name, :email\r\n  \r\n  def initialize(first_name, last_name, date_of_birth, email)\r\n    @first_name = first_name\r\n    @last_name = last_name\r\n    @date_of_birth = date_of_birth\r\n    @email = email\r\n  end\r\n  \r\n  def birth_day\r\n    @date_of_birth[8..9]  \r\n  end\r\n  \r\n  def birth_month\r\n    @date_of_birth[5..6]\r\n  end\r\nend  \r\n```\r\n\r\nThe source folder contains `person_file_store.rb` and `person_memory_store.rb`.\r\n\r\n```ruby\r\nrequire \'csv\'\r\nrequire_relative \'../domain/person\'\r\n\r\n# This class knows how to parse the CSV file to create Person objects\r\n# The direction of dependency is from PersonFileStore to the domain object\r\nclass PersonFileStore\r\n  def initialize(file)\r\n    @file = file\r\n  end\r\n\r\n  def records\r\n    result = []\r\n    data = CSV.read(@file, {headers: true}) \r\n    data.each do |x|\r\n      person = Person.new(x[1], x[0], x[2].strip!, x[3])\r\n      \r\n      result << person\r\n    end    \r\n    result\r\n  end\r\nend\r\n```\r\n\r\nYou can see that we need the require\\_relative statement, since it has dependency on the Person domain object. The PersonMemoryStore class looks like this:\r\n\r\n```ruby\r\nrequire_relative \'../domain/person\'\r\n\r\n#  This class provides in-memory implementation of the data source interface\r\n#  Useful in writing tests\r\nclass PersonMemoryStore\r\n\r\n  def records\r\n    result = []\r\n    \r\n    person = Person.new(\'Bugs\', \'Bunny\', \'1982/10/08\', \'bbunny@rubyplus.com\')\r\n    result << person\r\n\r\n    person = Person.new(\'Daffy\', \'Duck\', \'1975/09/11\', \'dduck@rubyplus.com\')          \r\n    result << person\r\n    \r\n    result\r\n  end\r\n  \r\nend\r\n```\r\n\r\nVisual Representation\r\n=========\r\n---------\r\n\r\n<img src=\"http://3.bp.blogspot.com/-U5JXcTph9Rw/VmUATJcHqII/AAAAAAAAA9s/2KImblS9kxQ/s1600/3-design-rule.png\" alt=\"Layered Design\" width=\"825\" height=\"697\"/>\r\n\r\nYou can download the final refactored code that has a better design here: [Ruby Greeter] (https://bitbucket.org/bparanj/greeter \'Ruby Greeter\')\r\n\r\nSummary\r\n=========\r\n---------\r\n\r\nWe separated the input data source that can change into it\'s own source folder. We encapsulated it behind a well-defined interface. We did the same for different ways to send birthday greetings by moving all the relevant classes to the channel folder. We depend on the send method for greeting delivery and records method for data source, so we program to the interface. The glue code in main.rb that uses the classes in the channel, domain and source folders depends on concrete classes. You can use dependency injection and vary the input source and the channel to make them depend on abstractions instead of concrete classes. \r\n\r\nReference\r\n=========\r\n---------\r\n\r\n[The birthday greetings kata](http://matteo.vaccari.name/blog/archives/154 \"The birthday greetings kata\")\r\n','2015-10-08 21:03:13','2016-12-22 23:19:19'),(2661,'Basics of Abstraction','Definition\r\n=========\r\n---------\r\n\r\nThe dictionary says abstraction means to `draw away`, to remove characteristics from something in order to reduce it to a set of essential characteristics. It is a tool for simplification. We find the essence by ignoring irrelevant details. \r\n\r\n<img src=\"https://4.bp.blogspot.com/-HgPjGNs3VJQ/VpxAgwzXEMI/AAAAAAAABAg/71pB0Tqhgt4/s1600/computer-scientist.png\" alt=\"Abstraction\" />\r\n\r\n<img src=\"https://2.bp.blogspot.com/-76-CxhGl6RY/VpxAfw9hSvI/AAAAAAAABAM/L8bK2Qi4So0/s1600/abstraction-concept-map.png\" alt=\"Abstraction\" />\r\n\r\nIn his paper \'Is Abstraction the Key to Computing?`, Jeff Kramer says abstraction also means:\r\n\r\n- The process of formulating general concepts by abstracting common properties of instances, and;\r\n\r\n<img src=\"https://4.bp.blogspot.com/-avGBLvmsze4/VmT8kgdbn7I/AAAAAAAAA9g/DSFTlIvj64E/s1600/abstraction-how-instance.png\" alt=\"Abstraction View\" width=\"860\" height=\"516\"/>\r\n\r\n- A general concept formed by extracting common features from specific examples. \r\n\r\n<img src=\"https://1.bp.blogspot.com/-Hach6C5PXcg/VmT8apOMK-I/AAAAAAAAA9U/6UTwfsBarJA/s1600/abstraction-how-example.png\" alt=\"Abstraction View\" width=\"843\" height=\"410\"/>\r\n\r\nExample 1\r\n=========\r\n---------\r\n\r\nChemistry is an abstraction of physics. \r\n\r\n<img src=\"https://3.bp.blogspot.com/-6rdWpNFi3yk/VpxAht65u9I/AAAAAAAABAs/pAJTL1fcejQ/s1600/molecule-interaction.png\" alt=\"Molecule Interaction\" />\r\n\r\nVS\r\n\r\n<img src=\"https://4.bp.blogspot.com/-Ohrgql4JHNE/VpxAgE7ZILI/AAAAAAAABAU/p8RlRtRX2LQ/s1600/basic-elements.png\" alt=\"Basic Elements\" />\r\n\r\nBiology is an abstraction of chemistry. \r\n\r\n<img src=\"https://2.bp.blogspot.com/-slNk3Z9PPdI/VpxAg8JvROI/AAAAAAAABAk/0PzoAULXOhQ/s1600/living-things.png\" alt=\"Living Things\" />\r\n\r\nVS\r\n\r\n<img src=\"https://3.bp.blogspot.com/-6rdWpNFi3yk/VpxAht65u9I/AAAAAAAABAs/pAJTL1fcejQ/s1600/molecule-interaction.png\" alt=\"Molecule Interaction\" />\r\n\r\nGenetics is an abstraction of biology.\r\n\r\n<img src=\"https://3.bp.blogspot.com/-jaXI_BIwvzA/VpxHOGnlT_I/AAAAAAAABBI/V_bECYNkBgY/s1600/genes.png\" alt=\"Genes\" />\r\n\r\nVS\r\n\r\n<img src=\"https://3.bp.blogspot.com/-4B2FgtmKZ2Q/VpxAgNM6nEI/AAAAAAAABAQ/bz9kHIOx90w/s1600/cells.png\" alt=\"Cells\" />\r\n\r\nExample 2\r\n=========\r\n---------\r\n\r\nThe London Underground map that overlays the underground system onto a conventional geographical map.\r\n\r\n<img src=\"https://3.bp.blogspot.com/-_3o5EXJ5Ozc/ViNJPTCfZKI/AAAAAAAAA8c/2St_SLIgFnI/s1600/london-railways-1928.png\" alt=\"London Underground Map\" width=\"825\" height=\"697\"/>\r\n\r\nIn this map, you can see:\r\n\r\n- River Thames\r\n- Relative distances between stations. \r\n\r\nHarry Beck\'s simplified map.\r\n\r\n<img src=\"https://1.bp.blogspot.com/-4I68wg27KP0/ViNI_mvIq4I/AAAAAAAAA8U/PQTi-LeJLN4/s1600/underground-harry-beck.jpg\" alt=\"Harry Beck\'s Simplified Map\" width=\"960\" height=\"622.5\"/>\r\n\r\n- This fits the purpose of navigating around the London Underground.\r\n- It is misleading for other purposes.\r\n\r\nLet\'s consider two extremes:\r\n\r\n==Too abstract== : The map would not provide sufficient information for the purpose.\r\n==Too detailed== : The map becomes confusing and less comprehensible.\r\n\r\nThe level, benefit and value of a particular abstraction depend on its purpose.\r\n\r\nAbstraction in Software\r\n=========\r\n---------\r\n\r\nTo quote Booch in ==Object-Oriented Analysis and Design with Applications==: \r\n\r\n> An abstraction denotes the essential characteristics of an object that distinguish it from all other kinds of objects and thus provide crisply defined conceptual boundaries, relative to the perspective of the viewer.\"\r\n \r\nThe *term perspective of the viewer* needs an explanation. Let us consider a House object, when a banker sees this house, he thinks in terms of the value of the property, opportunity for appreciation, etc whereas when a decorator views it, he thinks in terms of what color the house should be painted, total area to be painted, etc. The same object House can be viewed from different perspectives and can lead to entirely different abstractions by different people.\r\n\r\n<img src=\"https://1.bp.blogspot.com/-y8oFatPnV7Q/VmT8YOiaLMI/AAAAAAAAA9I/0u1qFc6X1to/s1600/abstraction-view.png\" alt=\"Abstraction View\" width=\"817\" height=\"639\"/>\r\n\r\n==Booch, Fairsmith, Henderson-Sellers== define abstraction as: \r\n\r\n> Any model that includes the most important, essential, or distinguishing aspects of something while suppressing or ignoring less important, immaterial, or diversionary details.\r\n\r\n==Coad, Fairsmith, Henderson-Sellers, Rumbaugh== define abstraction as:\r\n\r\n> The cognitive tool for rationalizing the world by considering only those details necessary for the current purpose.\r\n\r\nSo, abstraction is about what details we choose to emphasize and what details we choose to ignore. What we choose to emphasize is dictated by the application. It simplifies the things that we look at in the real world. For example, a chair can be made up of different kinds of material, height adjusting knobs, reclining adjustment knobs etc. If every time we looked at the chair, if we had to deal with what material it is made up of, how the height adjustment knobs are designed and other irrelevant details related to our purpose using a chair to sit, our brains will be exhausted. So, the abstraction process simplifies things and allows us to manage complexity during problem solving process.\r\n\r\n> Computer science is a science of abstraction — creating the right model for thinking about a problem and devising the appropriate mechanizable techniques to solve it. Every other science deals with the universe as it is. The physicist’s job, for example, is to understand how the world works, not to invent a world in which physical laws would be simpler or more pleasant to follow. Computer scientists, on the other hand, must create abstractions of real-world problems that can be understood by computer users and, at the same time, that can be represented and manipulated inside a computer. \r\n\r\n> Abstraction in the sense we use it implies simplification, the replacement of a complex and detailed real-world situation by an understandable model within which we can solve a problem. That is, we “abstract away” the details whose effect on the solution to a problem is minimal or nonexistent, thereby creating a model that lets us deal with the essence of the problem.\r\n\r\n> -- From the book \'Foundations of Computer Science\' by Alfred V Aho and Jeffrey D Ullman \r\n\r\nWhy Abstraction?\r\n=========\r\n---------\r\n\r\nAbstraction is crucial to produce clear, elegant designs and programs. It is useful to manage complexity. We can diagnose components at the interfaces rather than by exhaustively tracing functions of all components.\r\n\r\nAdvantages in Treating Systems by Levels of Abstraction\r\n---------\r\n\r\n- Each level has its own definition and specification. So development can proceed concurrently at each level.\r\n- We can allocate work according to strength.\r\n- A system can evolve by evolving components separately. It is not necessary to re-implement the entire system when one component changes. This avoids ==Second System Syndrome==.\r\n\r\nAbstraction in Daily Life\r\n=========\r\n---------\r\n\r\nYou use abstraction in everyday things in your life. For instance you say : I am going to a *Rock Concert* this weekend. You don\'t say: \"I am going to a musical performance characterized by electric guitar, electric bass guitar and drums this weekend\".\r\n\r\nHow to Abstract\r\n=========\r\n---------\r\n\r\nIn order to learn the process of abstraction you need to learn how to find the essence of something. Oxford dictionary defines essence as : \r\n\r\n> The intrinsic nature or indispensable quality of something that determines its character. \r\n\r\nLet\'s now think about the following question to illustrate finding the essence.\r\n\r\n- What is the essence of a chair?\r\n\r\nA chair is a thing and it has a form and function. If you assume sitting as the function of a chair, then you have the attributes such as number of legs, material of the chair, whether it has a support for the back and so on as the variables that can be varied in the chair definition. The question now is what is the least amount of these attributes we need but still retain the concept of chair? Can a chair have no support for the back? Yes. So we can consider this as irrelevant to the chair concept. We can continue this process for other attributes to come up with the essence of a chair.\r\n\r\nLeaky Abstraction\r\n=========\r\n---------\r\n\r\nAbstraction that is leaky will force us to look at implementation to learn about the usage of the API. This is like looking under the hood of your car and understanding the working of the internals of the car engine in order to learn how to drive the car.\r\n\r\nConclusion\r\n=========\r\n---------\r\n\r\nIn this article we discussed the what and the why of abstraction. Abstraction is one of the most important concepts that is taught in Computer Science. But developers still find it difficult to apply it in software development.\r\n\r\nExercises\r\n=========\r\n---------\r\n\r\n- What is the essence of a pen?\r\n- What is the essence of a car?\r\n\r\nReferences\r\n=========\r\n---------\r\n\r\n[Abstraction in Computer Science & Software Engineering: A Pedagogical Perspective] (https://edu.technion.ac.il/Faculty/OritH/HomePage/FrontierColumns/OritHazzan_SystemDesigFrontier_Column5.pdf \'Abstraction in Computer Science\')\r\n[Is Abstraction the Key to Computing?] (https://www.ics.uci.edu/~andre/informatics223s2007/kramer.pdf \'Is Abstraction the Key to Computing\')\r\n[Computational Thinking](https://www.cs.cmu.edu/~15110-s13/Wing06-ct.pdf \'Computational Thinking\')','2015-10-17 21:24:15','2016-01-18 02:03:25'),(2671,'Factory Girl Basics using Rails 3.2, Factory Girl 4.2','Objective\r\n=========\r\n---------\r\n\r\nTo learn how to create objects for has_one association \r\n\r\nCreating an Instance\r\n=========\r\n---------\r\n\r\nStep 1\r\n---------\r\n\r\nLet\'s create an instance of an article using FactoryGirl.\r\n\r\nCreate spec/factories/factories.rb:\r\n\r\n```ruby\r\nFactoryGirl.define do\r\n  factory :article do\r\n    title \'How to get rich quick\'\r\n  end  \r\nend\r\n```\r\n\r\nStep 2\r\n---------\r\n\r\nHere is the spec/models/article_spec.rb:\r\n\r\n```ruby\r\nrequire \'spec_helper\'\r\n\r\ndescribe Article do\r\n\r\n  it \"creating an instance\" do\r\n    article = FactoryGirl.create(:article)\r\n    \r\n    expect(article.title).to eq(\'How to get rich quick\')\r\n  end\r\n\r\nend\r\n```\r\n\r\nHas One Association\r\n=========\r\n---------\r\n\r\nStep 1\r\n---------\r\n\r\nThe article has_one :author:\r\n\r\n```ruby\r\nclass Article < ActiveRecord::Base\r\n  has_one :author\r\nend\r\n\r\nclass Author < ActiveRecord::Base\r\nend\r\n```\r\n\r\nStep 2\r\n---------\r\n\r\nCreate the author first:\r\n\r\n```ruby\r\nFactoryGirl.define do\r\n  factory :author do\r\n    name \'Bugs Bunny\'\r\n  end  \r\nend\r\n```\r\n\r\nThen associate the author to the article:\r\n\r\n```ruby\r\nFactoryGirl.define do\r\n  factory :article do\r\n    title \'How to get rich quick\'\r\n    \r\n    author { create(:author) }\r\n  end  \r\nend\r\n```\r\n\r\nSo the entire factories.rb file looks like this:\r\n\r\n```ruby\r\nFactoryGirl.define do\r\n  factory :author do\r\n    name \'Bugs Bunny\'\r\n  end  \r\n\r\n  factory :article do\r\n    title \'How to get rich quick\'\r\n    \r\n    author { create(:author) }\r\n  end  \r\nend\r\n```\r\n\r\nStep 3\r\n---------\r\n\r\nAdd a new test :\r\n\r\n```ruby\r\n  it \"mapping has_one association to factory_girl\" do\r\n    article = FactoryGirl.create(:article)\r\n    \r\n    expect(article.title).to eq(\'How to get rich quick\')\r\n    expect(article.author.name).to eq(\'Bugs Bunny\')\r\n  end\r\n```\r\n\r\nSo the factories.rb now looks like this:\r\n\r\n```ruby\r\nrequire \'spec_helper\'\r\n\r\ndescribe Article do\r\n\r\n  it \"creating an instance\" do\r\n    article = FactoryGirl.create(:article)\r\n    \r\n    expect(article.title).to eq(\'How to get rich quick\')\r\n  end\r\n\r\n  it \"mapping has_one association to factory_girl\" do\r\n    article = FactoryGirl.create(:article)\r\n    \r\n    expect(article.title).to eq(\'How to get rich quick\')\r\n    expect(article.author.name).to eq(\'Bugs Bunny\')\r\n  end\r\n\r\nend\r\n```\r\n\r\nBoth the tests will pass. The factory name \'author\' is the same as the association name `Article has_one :author`, so we can simplify the second factory as follows:\r\n\r\n```ruby\r\nFactoryGirl.define do\r\n  factory :article do\r\n    title \'How to get rich quick\'\r\n    \r\n    author\r\n  end  \r\nend\r\n```\r\n\r\nIt would have been easier to map the sytnax if it was like this:\r\n\r\n```ruby\r\nFactoryGirl.define do\r\n  factory :article do\r\n    title \'How to get rich quick\'\r\n    \r\n    has_one :author\r\n  end  \r\nend\r\n```\r\n\r\nSummary\r\n========\r\n---------\r\n\r\nIn this article you learned how to create objects using FactoryGirl for a has_one association in Rails. I do not recommend using FactoryGirl on new projects, it has convoluted syntax and adds to your learning curve which can make it difficult to keep your tests up-to date in a team with varying skill sets. If you are starting a new project, I highly recommend looking at other libraries like Fabrication. ','2015-10-24 19:25:44','2015-10-24 20:55:03'),(2681,'Factory Girl Basics using Rails 3.2, Factory Girl 4.2 : Part 2','Objective\r\n=========\r\n---------\r\n\r\nTo learn how to create objects using FactoryGirl for has_many association \r\n\r\nSteps\r\n=========\r\n---------\r\n\r\nStep 1\r\n---------\r\n\r\nDefine the factory for comment model.\r\n\r\n```ruby\r\nfactory :comment do\r\n  description \'Yes I want to buy this book\'  \r\nend\r\n```\r\n\r\nStep 2\r\n---------\r\n\r\nChange the article factory as follows:\r\n\r\n```ruby\r\nfactory :article do\r\n  title \'How to get rich quick\'\r\n  \r\n  author\r\n  \r\n  factory :article_with_comments do\r\n    \r\n    ignore do\r\n      comments_count 2\r\n    end\r\n    \r\n    after(:create) do |article, evaluator|\r\n      create_list(:comment, evaluator.comments_count, article: article)\r\n    end\r\n  end\r\nend  \r\n```\r\n\r\nNote: For version we are using, you will get:\r\n\r\n```\r\n undefined method `comments_count\' for #<FactoryGirl::SyntaxRunner:0x04a8>` if you use `transient` instead of `ignore`. \r\n```\r\n \r\n Refer the [Transient vs Ignore](https://github.com/thoughtbot/factory_girl/issues/658 \'Transient vs Ignore\') ticket for more details.\r\n\r\nStep 3\r\n---------\r\n\r\nYou can now use the factory in your tests as follows:\r\n\r\n```ruby\r\n  it \"mapping has_many association to factory_girl : example 1\" do\r\n    article = FactoryGirl.create(:article)\r\n    \r\n    expect(article.comments.length).to eq(0)\r\n  end\r\n\r\n  it \"mapping has_many association to factory_girl : example 2\" do\r\n    article = FactoryGirl.create(:article_with_comments)\r\n    \r\n    expect(article.comments.length).to eq(2)\r\n  end\r\n\r\n  it \"mapping has_many association to factory_girl : example 3\" do\r\n    article = FactoryGirl.create(:article_with_comments, comments_count: 3)\r\n    \r\n    expect(article.comments.length).to eq(3)\r\n  end\r\n```\r\n\r\nYou can find the repo for this project at https://github.com/bparanj/fgirl\r\n\r\nSummary\r\n========\r\n---------\r\n\r\nIn this article we saw how to create objects for has_many association using FactoryGirl. ','2015-10-24 21:18:08','2015-10-25 19:28:15'),(2691,'ActiveResource Basics using Rails 4.2.4','Objective\r\n=========\r\n---------\r\n\r\nTo learn how to use ActiveResource 4.0 gem with Rails 4.2.4 Rails apps.\r\n\r\nSteps\r\n=========\r\n---------\r\n\r\nStep 1\r\n---------\r\n\r\nAdd the activeresource gem to the Gemfile and run bundle:\r\n\r\n```ruby\r\ngem \'activeresource\'\r\n```\r\n\r\n```sh\r\n$bundle\r\n```\r\n\r\nStep 2\r\n---------\r\n\r\nGenerate the book application using scaffold.\r\n\r\n```sh\r\n$rails g scaffold book title:string isbn:string\r\n```\r\n\r\nIf you make any mistakes you can do:\r\n\r\n```sh\r\n$rails destroy scaffold book\r\n```\r\n\r\nStep 3\r\n---------\r\n\r\nCreate an inventory application.\r\n\r\n```sh\r\nrails g scaffold inventory quantity:integer isbn:string\r\n```\r\n\r\nStep 4\r\n---------\r\n\r\nCreate a Inventory class in models folder in the book application. \r\n\r\n```ruby\r\nrequire \'active_resource\'\r\n\r\nclass Inventory < ActiveResource::Base\r\n  self.site = \'http://localhost:3001\'\r\nend\r\n```\r\n\r\nNote: You have to require active_resource to play with it in the rails console.\r\n\r\n```ruby\r\nrequire \'active_resource\'\r\n```\r\n\r\nStep 5\r\n---------\r\n\r\nRun the book application on port 3000 and the inventory application on port 3001. Create a book in the book application and an inventory record in the inventory application. Make sure the isbn is the same in both cases.\r\n\r\nStep 6\r\n---------\r\n\r\nNow, let\'s go to the rails console of the book application and find an inventory.\r\n\r\n```sh\r\n$ rails c\r\nLoading development environment (Rails 4.2.4)\r\n > i = Inventory.find(1)\r\n => #<Inventory:0x007ffed69614f0 @attributes={\"id\"=>1, \"quantity\"=>100, \"isbn\"=>\"1z\", \"created_at\"=>\"2015-11-07T16:51:32.735Z\", \"updated_at\"=>\"2015-11-07T16:51:32.735Z\"}, @prefix_options={}, @persisted=true> \r\n```\r\n\r\nWe found the inventory record that we had created using the inventory application UI. You can see the request made to the remote service in the terminal.\r\n\r\n```sh \r\n Started GET \"/inventories/1.json\" for ::1 at 2015-11-07 08:54:43 -0800\r\n Processing by InventoriesController#show as JSON\r\n   Parameters: {\"id\"=>\"1\"}\r\n   Inventory Load (0.1ms)  SELECT  \"inventories\".* FROM \"inventories\" WHERE \"inventories\".\"id\" = ? LIMIT 1  [[\"id\", 1]]\r\n   Rendered inventories/show.json.jbuilder (3.1ms)\r\n Completed 200 OK in 9ms (Views: 8.0ms | ActiveRecord: 0.1ms)\r\n```\r\n\r\nStep 7\r\n---------\r\n\r\nYou can use ActiveRecord like query to find records. \r\n \r\n```sh\r\nx = Inventory.where(isbn: \'1z\')\r\n  => #<ActiveResource::Collection:0x007ffed6908d28 @elements=[#<Inventory:0x007ffed6908b70 @attributes={\"id\"=>1, \"quantity\"=>100, \"isbn\"=>\"1z\", \"url\"=>\"http://localhost:3001/inventories/1.json\"}, @prefix_options={}, @persisted=true>], @resource_class=Inventory, @original_params={:isbn=>\"1z\"}>\r\n```  \r\n\r\nThis returns `ActiveResource::Collection ` instance.\r\n\r\n```sh  \r\n  > x.class\r\n   => ActiveResource::Collection \r\n```   \r\n\r\nStep 8\r\n---------\r\n\r\nWe can get an array of Inventory objects by calling the to_a method on it.\r\n\r\n```sh   \r\nelements = x.to_a\r\n=> [#<Inventory:0x007ffed6908b70 @attributes={\"id\"=>1, \"quantity\"=>100, \"isbn\"=>\"1z\", \"url\"=>\"http://localhost:3001/inventories/1.json\"}, @prefix_options={}, @persisted=true>]\r\n```	\r\n\r\n```sh	\r\nelement = elements[0]\r\n => #<Inventory:0x007ffed6908b70 @attributes={\"id\"=>1, \"quantity\"=>100, \"isbn\"=>\"1z\", \"url\"=>\"http://localhost:3001/inventories/1.json\"}, @prefix_options={}, @persisted=true> \r\n > element.class\r\n => Inventory \r\n``` \r\n\r\nStep 9\r\n---------\r\n\r\nWe have 100 books.	\r\n\r\n```sh\r\nelement.quantity\r\n=> 100 \r\n```	\r\n	\r\nSummary\r\n========\r\n---------\r\n\r\nIn this article we saw how to use ActiveResource 4.0 gem with Rails 4.2.4 apps. ','2015-11-07 19:49:32','2015-11-07 19:50:32'),(2701,'Basics of Protected Methods in Ruby 2.2.3','Objective\r\n==========\r\n----------\r\n\r\nTo learn the basics of protected methods in Ruby\r\n\r\n----------\r\n\r\n#### Calling a Protected Method from an Instance of a Given Class\r\n\r\n```ruby\r\nclass Car\r\n  protected\r\n\r\n  def shift\r\n    p \'shifting\'\r\n  end\r\nend\r\n\r\nc = Car.new\r\nc.shift\r\n```\r\n\r\nWe get the error:\r\n\r\n```sh\r\nNoMethodError: protected method ‘shift’ called for #<Car:0x007f>\r\n```\r\n\r\nwhen we run this program. So the protected method cannot be called by an instance of Car.\r\n\r\n#### Calling a Protected Method from an Instance of a Given Subclass\r\n\r\nCan an instance of a subclass of Car call protected method?\r\n\r\n```ruby\r\nclass Car\r\n  protected\r\n\r\n  def shift\r\n    p \'shifting\'\r\n  end\r\nend\r\n\r\nclass Beetle < Car\r\nend\r\n\r\nb = Beetle.new\r\nb.shift\r\n```\r\n\r\nWe get the error:\r\n\r\n```sh\r\nNoMethodError: protected method ‘shift’ called for #<Beetle:0x007f>\r\n```\r\n\r\n#### How Can the Subclass call the Protected Method?\r\n\r\n```ruby\r\nclass Car\r\n  protected\r\n\r\n  def shift\r\n    p \'shifting\'\r\n  end\r\nend\r\n\r\nclass Beetle < Car\r\n  def start\r\n    shift\r\n  end\r\nend\r\n\r\nb = Beetle.new\r\nb.start\r\n```\r\n\r\nThis prints `shifting`. So we can call the protected method from a public method of the subclass.\r\n\r\n#### Comparison with Private Method\r\n\r\nLet\'s compare the above example to private method, if you change the protected to private:\r\n\r\n```ruby\r\nclass Car\r\n  private\r\n\r\n  def shift\r\n    p \'shifting\'\r\n  end\r\nend\r\n\r\nclass Beetle < Car\r\n  def start\r\n    shift\r\n  end\r\nend\r\n\r\nb = Beetle.new\r\nb.start\r\n```\r\n\r\nIt still works. In this case it is better to use private than protected to hide the implementation details.\r\n\r\n#### Comparison with Class Method\r\n\r\nIf the shift() method is a class method, we can call the method inside the class like this:\r\n\r\n```ruby\r\nclass Car\r\n  protected\r\n\r\n  def self.shift\r\n    p \'shifting\'\r\n  end\r\nend\r\n\r\nclass Beetle < Car\r\n  shift\r\nend\r\n```\r\n\r\nThis will print `shifting`. In this case we don\'t need to create an instance and invoke the class method.\r\n\r\n#### Calling Protected Method from Other Instances of a Given Class\r\n\r\nProtected method can also be called from other instance of the Car class. Here is an example:\r\n\r\n```ruby\r\nclass Car\r\n  def start\r\n    c = Car.new\r\n    c.shift\r\n  end\r\n\r\n  protected\r\n\r\n  def shift\r\n    p \'shifting\'\r\n  end\r\nend\r\n\r\nc = Car.new\r\nc.start\r\n```\r\n\r\nThis prints `shifting`. In the start method, we create an instance of Car and this instance is able to invoke the protected method shift. Let\'s compare this to the private method, if you change protected to private:\r\n\r\n```ruby\r\nclass Car\r\n  def start\r\n    c = Car.new\r\n    c.shift\r\n  end\r\n\r\n  private\r\n\r\n  def shift\r\n    p \'shifting\'\r\n  end\r\nend\r\n\r\nc = Car.new\r\nc.start\r\n```\r\n\r\nYou will get `NoMethodError: private method ‘shift’ called for #<Car:0x007fe>` error. So using protected in this example provides access to the `shift` method from other instances of the Car class.\r\n\r\nSummary\r\n=====\r\n-----\r\n\r\nIn this article we saw two different ways to invoke protected methods in Ruby. A subclass can call the protected methods defined in its parent from a public method. Protected methods can also be called from other instances of the class defining the protected method.\r\n\r\nReference\r\n=====\r\n-----\r\n\r\n[Ruby 2 Methodology by Akira Matsuda](https://speakerdeck.com/a_matsuda/ruby-2-methodology \'Ruby 2 Methodology by Akira Matsuda\')','2015-11-21 22:17:44','2015-11-22 22:20:28'),(2711,'Redefining a Private Method in Ruby','Objective\r\n==========\r\n----------\r\n\r\nTo learn different ways to redefine a private method in Ruby.\r\n\r\nWhy ?\r\n----------\r\n\r\nIt is not a good idea to redefine a private method. This can be found in code written by bad developers and you will encounter this kind of horrible code in real life projects. If you know how this works, you will be able to understand existing code base and be able to upgrade and maintain.\r\n\r\nRedefine a Private Method by Opening an Existing Class\r\n----------\r\n\r\nLet\'s see how to redefine a private method in an existing class called ActiveRecord. \r\n\r\n```ruby\r\nclass ActiveRecord\r\n\r\n  private\r\n\r\n  def hi\r\n    \'I am private\'\r\n  end\r\nend\r\n```\r\n\r\nAssume that the above class is defined in the Rails framework. Now open the ActiveRecord class and put your implementation of hi() private method like this:\r\n\r\n```ruby\r\nclass ActiveRecord\r\n\r\n  def greet\r\n    hi\r\n  end\r\n\r\n  private\r\n\r\n  def hi\r\n    \'I am redefining you\'\r\n  end\r\n\r\nend\r\n\r\na = ActiveRecord.new\r\np a.greet\r\n```\r\n\r\nThis will print `I am redefining you`.\r\n\r\nUsing Inheritance to Redefine a Private Method\r\n----------\r\n\r\nAssume ActiveRecord is in the Rails framework code.\r\n\r\n```ruby\r\nclass ActiveRecord\r\n\r\n  private\r\n\r\n  def hi\r\n    \'I am private\'\r\n  end\r\nend\r\n```\r\n\r\nIn your project you create a subclass that over-rides the private method, like this:\r\n\r\n```ruby\r\nclass MyActiveRecord < ActiveRecord\r\n\r\n  def greet\r\n    hi\r\n  end\r\n\r\n  private\r\n\r\n  def hi\r\n    \'I am redefining you\'\r\n  end\r\n\r\nend\r\n\r\na = MyActiveRecord.new\r\n\r\np a.greet\r\n```\r\n\r\nThis is not a good solution. You have to look at the parent class which has a gazillion of methods to figure out that the private method is being redefined in your code base. When you upgrade your Rails version, it is very likely that the private method has changed and things will break causing headaches and slowing down the upgrade process. If you take this approach, your cats will die of cancer.\r\n\r\n> Inheritance creates tight coupling to the super class. Prefer delegation over inheritance to create elegant designs.\r\n\r\nUsing Meta-Programming to Redefine a Private Method\r\n----------\r\n\r\n```ruby\r\nclass Client\r\n\r\n  def print\r\n    say\r\n  end\r\n\r\n  private\r\n \r\n  def say\r\n    \"hello\"\r\n  end\r\nend\r\n\r\n# Create a subclass of Client\r\nMyClient = Class.new(Client) do\r\n  define_method(:say) do\r\n    \"hello from an over-ridden private method\"\r\n  end\r\nend\r\n\r\nputs MyClient.superclass\r\n\r\nmy_client = MyClient.new\r\nputs my_client.print\r\n```\r\n\r\nWe create a subclass of the original class and use define_method to over-ride the private method. This prints `hello from an over-ridden private method`. Note that we don\'t even have to make the redefined method private to over-ride the private method of the parent class. \r\n\r\nThis solution has unnecessary complexity and I would not recommend it unless it allows us to solve some problem that other approaches cannot solve. The above implementation can be simplified to accomplish the same thing like this:\r\n\r\n```ruby\r\nclass Client\r\n\r\n  def print\r\n    say\r\n  end\r\n\r\n  private\r\n \r\n  def say\r\n    \"hello\"\r\n  end\r\nend\r\n\r\nclass MyClient < Client\r\n  def say\r\n    \"hello from an overridden private method\"\r\n  end\r\nend\r\n\r\nputs MyClient.superclass\r\n\r\nmy_client = MyClient.new\r\nputs my_client.print\r\n```\r\n\r\nSummary\r\n=====\r\n-----\r\n\r\nIn this article you learned how to redefine a private method in Ruby. You can avoid unnecessary complexity and headaches during upgrade by using the simpler solution as discussed in this article.\r\n\r\nFeedback\r\n=====\r\n-----\r\n\r\nTim Case pointed out on rubyflow.com:\r\n\r\n> The variable scoping in Ruby (public, protected, private) is merely a suggestion and not a hard barrier like it is in other languages. There’s also this way of calling a private method: `obj.send(:any_private_method?)`\r\n','2015-11-22 18:01:59','2015-11-24 05:42:51'),(2721,'Inspecting Method Parameters in Ruby 2.2.3','### Required Parameter\r\n\r\n```ruby\r\nclass Car\r\n  def drive(speed)\r\n  end\r\nend\r\n\r\ncar = Car.new\r\nmethod = car.method(:drive)\r\n\r\np method.parameters\r\n```\r\n\r\nThis prints : `[[:req, :speed]]`. The :req symbol means required argument.\r\n\r\n### Optional Parameter\r\n\r\n```ruby\r\nclass Car\r\n  def drive(speed, options = {})\r\n  end\r\nend\r\n\r\ncar = Car.new\r\nmethod = car.method(:drive)\r\n\r\np method.parameters\r\n```\r\n\r\nThis prints : `[[:req, :speed], [:opt, :options]]`. The :opt symbol means option parameter.\r\n\r\n### Splat Operator \r\n\r\n```ruby\r\nclass Car\r\n  def drive(speed, options = {}, *args, &blk)\r\n  end\r\nend\r\n\r\ncar = Car.new\r\nmethod = car.method(:drive)\r\n\r\np method.parameters\r\n```\r\n\r\nThis prints `[[:req, :speed], [:opt, :options], [:rest, :args], [:block, :blk]]`. The :rest symbol is for variable length argument list.\r\n\r\n### Keyword Arguments\r\n\r\n```ruby\r\nclass Car\r\n  def drive(direction:, speed: :high, **args)\r\n    p direction\r\n  end\r\nend\r\n\r\ncar = Car.new\r\nmethod = car.method(:drive)\r\n\r\np method.parameters\r\n```\r\n\r\nThis prints `[[:keyreq, :direction], [:key, :speed], [:keyrest, :args]]`\r\n\r\nSummary\r\n=====\r\n-----\r\n\r\nIn this article we saw how we can inspect method parameters in Ruby. For a practical application of this concept, check out action_args Rails plugin.\r\n\r\nReference\r\n=====\r\n-----\r\n\r\n[Ruby 2 Methodology by Akira Matsuda](https://speakerdeck.com/a_matsuda/ruby-2-methodology \'Ruby 2 Methodology by Akira Matsuda\')','2015-11-24 06:34:05','2015-11-26 20:17:25'),(2731,'Rails 5 Basics : Running the Server','## Objective ##\r\n\r\n- To run your rails application on your machine and check your application\'s environment.\r\n\r\n## Steps ##\r\n\r\n### Step 1					\r\n\r\nCheck the versions of installed ruby, rails and ruby gems by running the following commands in the terminal:\r\n\r\n```ruby\r\n$ruby -v\r\n```\r\n\r\nThe output on my machine is : ruby 2.2.3p173 (2015-08-18 revision 51636) [x86_64-darwin14]\r\n\r\n```ruby  \r\n$rails -v\r\n```\r\nThe output on my machine is: Rails 5.0.0.alpha\r\n\r\n```sh    \r\n$rails c\r\nLoading development environment (Rails 5.0.0.alpha)\r\na2.2.3 :001 > Rails.version\r\n => \"5.0.0.alpha\" \r\n```\r\n\r\nYou can also check the version in the rails console.\r\n \r\n```ruby    \r\n$gem env\r\n```		 \r\nThe output on my machine is: RUBYGEMS VERSION: 2.4.5.1\r\n\r\n### Step 2 ###\r\n \r\nChange directory to where you want to work on new projects. \r\n\r\n```ruby\r\n$cd projects\r\n```\r\n\r\n### Step 3 ###\r\n\r\nCreate a new Rails project called blog by running the following command.\r\n\r\n```ruby\r\n$rails new blog\r\n```\r\n\r\n### Step 4 ###\r\n\r\nOpen a terminal and change directory to the blog project.\r\n\r\n```ruby\r\n$cd blog\r\n```\r\n\r\n### Step 5 ###\r\n\r\nOpen the blog project in your favorite IDE. For Textmate :\r\n\r\n```ruby\r\n$mate .\r\n```\r\n\r\n### Step 6 ###\r\n\r\nRun the rails server:\r\n\r\n```ruby\r\n$rails s\r\n```\r\n\r\n### Step 7 ###\r\n\r\nOpen a browser window and enter `http://localhost:3000`. Welcome page is displayed as the home page.\r\n\r\n### Step 8 ###\r\n\r\nYou can shutdown your server by pressing Control+C. \r\n\r\n### Step 9 ###\r\n\r\nClick on the \'About\' link and check the versions of software installed. If the background of the about section is yellow, installation is fine. If it is red then something is wrong with the installation.\r\n\r\n## Explanation					\r\n\r\nThe rails generator automatically runs the Bundler command bundle to install your application dependencies by reading the Gemfile. The Gemfile contains all the gems that your application needs. rails s (s is a short-cut for server) runs your server on your machine on port 3000.\r\n\r\n## Summary ##\r\n\r\nIn this lesson you learned how to run the server locally. We also saw how to check if everything is installed properly on our machine. In the next lesson you will learn how to create a home page for your web application.\r\n','2015-11-26 05:04:14','2015-11-26 05:06:44'),(2741,'Rails 5 Basics : Hello Rails','## Objective ##\r\n\r\n- To create a home page for your web application.\r\n\r\n## Steps ##\r\n\r\n### Step 1 ###\r\n\r\nOpen the config/routes.rb file in your IDE, routes.rb defines the routes that is installed on your web application. Rails will recognize the routes you define in this configuration file.\r\n\r\n### Step 2 ###\r\n\r\nAdd the line :   \r\n \r\n```ruby\r\nroot \'welcome#index\'\r\n```\r\n\r\nto the routes.rb. So it now looks like this:\r\n\r\n```ruby\r\nRails.application.routes.draw do\r\n  root \'welcome#index\'\r\nend\r\n```\r\n\r\nThe method root() takes a string parameter. In this case it maps the home page of your site to welcome controller (a class), index action (a method).\r\n\r\n### Step 3 ###\r\n\r\nGo to the terminal and change directory to the blog project and run:\r\n\r\n```ruby\r\nrake routes\r\n```\r\n\r\n```sh\r\nPrefix Verb URI Pattern Controller#Action\r\n  root GET  /           welcome#index\r\n```\r\n\r\nThe output of this command shows you the installed routes. Rails will be able to recognize the GET request for welcome page. The output has four columns, namely Prefix, Verb, URI Pattern and Controller#Action. Prefix is the name of the helper that you can use in your view and controller to take the user to a given view or controller. In this case it is root_path or root_url that is mapped to your home page. Verb is the Http Verb such as GET, POST, PUT, DELETE etc. URI Pattern is what you see in the browser URL. In this case, it is `http://localhost:3000`.\r\n\r\n### Step 4 ###\r\n\r\nGo to the browser and reload the page : `http://localhost:3000`. We see the uninitialized constant WelcomeController error. This happens because we don\'t have a welcome controller to handle the incoming GET request for the home page.\r\n\r\n### Step 5 ###\r\n\r\nYou can either open a new terminal and go to the blog project directory or open a new tab in your terminal and go to the blog project directory.\r\n\r\n### Step 6 ###\r\n\r\nIn this new tab or the terminal, go the blog project directory and type:\r\n \r\n```ruby\r\n$rails g controller welcome index\r\n```\r\n\r\n```sh\r\ncreate  app/controllers/welcome_controller.rb\r\n route  get \'welcome/index\'\r\ninvoke  erb\r\ncreate    app/views/welcome\r\ncreate    app/views/welcome/index.html.erb\r\ninvoke  test_unit\r\ncreate    test/controllers/welcome_controller_test.rb\r\ninvoke  helper\r\ncreate    app/helpers/welcome_helper.rb\r\ninvoke    test_unit\r\ninvoke  assets\r\ninvoke    coffee\r\ncreate      app/assets/javascripts/welcome.coffee\r\ninvoke    scss\r\ncreate      app/assets/stylesheets/welcome.scss\r\n```\r\n\r\nrails command takes the arguments g for generate, then the controller name and the action. In this case the controller name is welcome and the action name is index.\r\n\r\n### Step 7 ###\r\n\r\nReload the web browser again.  You will now see the welcome page.\r\n\r\n### Step 8 ###\r\n\r\nGo to app/views/welcome/index.html.erb and change it to \'Hello Rails\' like this:\r\n\r\n```ruby\r\n<h1>Hello Rails</h1>\r\n```\r\n\r\nSave the file.\r\n\r\nYou can embed ruby in .html.erb files. The .erb stands for embedded Ruby. In this case we have html only. We will see how to embed ruby in views in the next lesson.\r\n\r\n### Step 9 ###\r\n\r\nReload the browser. Now you will see \'Hello Rails\' as the home page content.\r\n\r\n### Step 10 ###\r\n\r\nOpen the welcome_controller.rb in app/controllers directory and look at the index action. \r\n\r\n### Step 11 ###\r\n\r\nLook at the terminal where you have the rails server running, you will see the request shown in the following image:\r\n\r\nYou can see that the browser made a GET request for the resource \'/\' which is the home page of your site. The request was processed by the server where Rails recognized the request and it routed the request to the welcome controller, index action. Since we did not do anything in the index action, Rails looks for the view that has the same name as the action and renders that view. In this case, the view that corresponds to the index action is app/views/welcome/index.html.erb.\r\n\r\n### Step 12 ###\r\n\r\nOpen a new terminal or a new tab and go to Rails console by running:\r\n\r\n```ruby\r\n$rails c\r\n```\r\n\r\nfrom the blog project directory.\r\n\r\n### Step 13 ###\r\n\r\nIn Rails console run:\r\n\r\n```ruby\r\napp.get \'/\'\r\n```\r\n\r\nHere we are simulating the browser GET request for the resource \'/\', which is your home page. You can see the http status code is 200. You can also see which view was rendered for this request.\r\n \r\n## Exercise ##\r\n\r\nCan you go to http://localhost:3000/welcome/index and explain why you see the contents shown in the page?\r\n\r\nBefore you go read the answer, make an attempt to answer this question.\r\n\r\n## Answer ##\r\n\r\nYou will see the same \'Hello Rails\' page. Because if you check the rails server log you can see it made a request : GET \'/welcome/index\' and if you look at the config/routes.rb file, you see :\r\n\r\n```ruby\r\nget \'welcome/index\'\r\n```\r\n\r\nThis line in routes was added when you ran the rails generator to create the welcome controller. This definition is used by the Rails router to handle this request. It knows the URI pattern of the format \'welcome/index\' with http verb GET must be handled by the welcome controller, index action.\r\n  \r\n### Step 14 ###\r\n\r\nDelete the  get \"welcome/index\"  line in the config/routes.rb file. Reload the page, by entering this URL in the browser : http://localhost:3000/welcome/index\r\n \r\nYou will now see the error page. Since we no longer need this route, we can ignore this error message because the home page will be accessed by typing just the domain name of your site like this: `www.mysite.com`.\r\n \r\n## Summary ##\r\n \r\n In this lesson we wrote a simple *Hello Rails* program. We saw how the router recognizes the browser request and how the view and controller work in Rails to handle it. We have seen just the View and Controller part of MVC framework. We will see how the model fits in the MVC framework in the next lesson.\r\n ','2015-11-26 20:12:15','2015-11-26 20:12:15'),(2751,'Rails 5 Basics : Model','## Objective ##\r\n\r\n- To learn the model part M of the MVC framework\r\n\r\n## Context \r\n\r\nWe are going to create an web application that will have articles to read, create, list, update and delete.\r\n\r\n## Steps ##\r\n### Step 1 ##\r\n\r\nIn Rails, model is a persistent object that can also contain business logic. Model is the Object Relational Mapping (ORM) layer that uses ActiveRecord design pattern. Open config/routes.rb file and add :\r\n\r\n```ruby\r\nresources :articles\r\n```\r\n \r\nSave the file. Your file should like this :\r\n\r\n```ruby \r\nBlog::Application.routes.draw do\r\n  resources :articles\r\n  \r\n  root \'welcome#index\'\r\nend\r\n```\r\n \r\nWhat is a resource? Resource can represent any concept. For instance if you read the documentation for [Twitter API](https://dev.twitter.com/docs/api/1.1/ \"Twitter API\"), you will see that Timeline is a resource. It is defined in the documentation as collections of Tweets, ordered with the most recent first. \r\n\r\nThere may not be a one-to-one correspondence between a resource and a database table. In our case we have one-to-one correspondence between the database table articles and the article resource.\r\n\r\nWe have a plural resource, so we will have index page that displays a list of all the articles in our case. Singular resource can be used when you don\'t need index action, for instance if a customer has a billing profile then from the perspective of a customer you can use a singular resource for billing_profile. From an admin perspective you could have a plural resource to manage billing profiles of customers (most likely using admin namespace in the routes).\r\n\r\n### Step 2 ##\r\n\r\nGo to the blog directory in the terminal and run:\r\n\r\n```ruby\r\n$rake routes\r\n```\r\n\r\n```sh\r\n$rake routes\r\n      Prefix Verb   URI Pattern                  Controller#Action\r\n    articles GET    /articles(.:format)          articles#index\r\n             POST   /articles(.:format)          articles#create\r\n new_article GET    /articles/new(.:format)      articles#new\r\nedit_article GET    /articles/:id/edit(.:format) articles#edit\r\n     article GET    /articles/:id(.:format)      articles#show\r\n             PATCH  /articles/:id(.:format)      articles#update\r\n             PUT    /articles/:id(.:format)      articles#update\r\n             DELETE /articles/:id(.:format)      articles#destroy\r\n        root GET    /                            welcome#index\r\n```\r\n\r\nThe output shows that defining the articles resource in the `routes.rb` gives us routing for :\r\n\r\n```sh\r\nAction         Purpose       								 \r\n------------  ------------------------------ \r\n create       creating a new article         \r\n update       updating a given article       \r\n delete       deleting a given article       \r\n show         displaying a given article     \r\n index        displaying a list of articles \r\n```\r\n\r\nSince we have plural resources in the `routes.rb`, we get the index action. If you had used a singular resource : \r\n\r\n```ruby\r\nresource :article\r\n```\r\n \r\nthen you will not have a routing for index action. \r\n\r\n```sh\r\n      Prefix Verb   URI Pattern             Controller#Action\r\n     article POST   /article(.:format)      articles#create\r\n new_article GET    /article/new(.:format)  articles#new\r\nedit_article GET    /article/edit(.:format) articles#edit\r\n             GET    /article(.:format)      articles#show\r\n             PATCH  /article(.:format)      articles#update\r\n             PUT    /article(.:format)      articles#update\r\n             DELETE /article(.:format)      articles#destroy\r\n```\r\n		 \r\nBased on the requirements you will choose a singular or plural resources for your application.\r\n\r\n### Step 3	 \r\n\r\nIn the previous lesson we saw how the controller and view work together. Now let\'s look at the model. Create an active_record object by running the following command:\r\n\r\n```ruby\r\n$rails g model article title:string description:text\r\n```\r\n \r\nIn this command the rails generator generates a model by the name of article. The active_record class name is in the singular form, the database will be plural form called as articles. The articles table will have a title column of type string and description column of type text. \r\n\r\n### Step 4 ##\r\n\r\nOpen the file `db/migrate/xyz_create_articles.rb` file. The xyz will be a timestamp and it will differ based on when you ran the command. The class CreateArticles is a subclass of ActiveRecord::Migration class.\r\n\r\nThere is a change() method in the migration file. Inside the change() method there is `create_table()` method that takes the name of the table to create and also the columns and it\'s data type. \r\n\r\nIn our case we are creating the articles table, t.timestamps gives `created_at` and `updated_at` timestamps that tracks when a given record was created and updated respectively. By convention the primary key of the table is id. So you don\'t see it in the migration file.\r\n\r\n### Step 5 ##\r\n\r\nGo to the blog directory in the terminal and run :\r\n\r\n```ruby\r\n$rake db:migrate\r\n```\r\n\r\n```sh\r\n$rake db:migrate\r\n== 20151127034514 CreateArticles: migrating ===================================\r\n-- create_table(:articles)\r\n   -> 0.0016s\r\n== 20151127034514 CreateArticles: migrated (0.0017s) ==========================\r\n```\r\n \r\nThis will create the articles table. \r\n \r\n### Step 6 ##\r\n\r\nIn the blog directory run:\r\n\r\n```ruby\r\n$rails db\r\n```\r\n \r\nThis will drop you into the database console. You can run SQL commands to query the development database.\r\n \r\n### Step 7 ##\r\n\r\nIn the database console run:\r\n\r\n```sh\r\nselect count(*) from articles;\r\n```\r\n \r\nYou can see from the output there are no records in the database. If you want to exit the db console type `.quit`.\r\n\r\n### Step 8 ##\r\n \r\nOpen another tab in the terminal and go to the blog directory. Run the following command:\r\n\r\n```ruby\r\n$rails c\r\n```\r\n \r\nc is the alias for console. This will take you to rails console where you can execute Ruby code and experiment to learn Rails.\r\n\r\n### Step 9 ##\r\n \r\nType : \r\n\r\n```ruby\r\nArticle.count \r\n```\r\n\r\nin the rails console. \r\n\r\n```sh\r\n (0.1ms)  SELECT COUNT(*) FROM \"articles\"\r\n => 0 \r\n```\r\n\r\nYou can see that ActiveRecord generated the SQL query we used in Step 7. The count is 0. Let\'s create a new record in the articles table. \r\n\r\n### Step 10 ##\r\n\r\nType : \r\n\r\n```ruby\r\nArticle.create(title: \'test\', description: \'first row\')\r\n```\r\n\r\n```sh\r\n(0.1ms)  begin transaction\r\nSQL (0.5ms)  INSERT INTO \"articles\" (\"title\", \"description\", \"created_at\", \"updated_at\") VALUES (?, ?, ?, ?)  [[\"title\", \"test\"], [\"description\", \"first row\"], [\"created_at\", 2015-11-27 03:52:06 UTC], [\"updated_at\", 2015-11-27 03:52:06 UTC]]\r\n  (45.5ms)  commit transaction\r\n=> #<Article id: 1, title: \"test\", description: \"first row\", created_at: \"2015-11-27 03:52:06\", updated_at: \"2015-11-27 03:52:06\"> \r\n```\r\n \r\nThe create class method inherited from ActiveRecord by Article creates a row in the database. You can see the ActiveRecord generated insert SQL query in the output. \r\n\r\n## Exercise 1 ##\r\n\r\nCheck the number of articles count by using the database console or the rails console.\r\n\r\n### Step 11 ##\r\n\r\nLet\'s create another record by running the following command in the rails console:\r\n\r\n```ruby   \r\n$article = Article.new(title: \'record two\', description: \'second row\')\r\n```\r\n\r\n```sh\r\n => #<Article id: nil, title: \"record two\", description: \"second row\", created_at: nil, updated_at: nil> \r\n```\r\n\r\nNow it\'s time for the second exercise.\r\n\r\n## Exercise 2 ##\r\n\r\nCheck the number of articles count by using the database console or the rails console. How many rows do you see in the articles table? Why?\r\n\r\nThe reason you see only one record in the database is that creating an instance of Article does not create a record in the database. The article instance in this case is still in memory. \r\n\r\nIn order to save this instance to the articles table, you need to call the save method like this:\r\n\r\n```ruby\r\n$article.save\r\n```\r\n\r\n```sh \r\n  (0.1ms)  begin transaction\r\n  SQL (0.5ms)  INSERT INTO \"articles\" (\"title\", \"description\", \"created_at\", \"updated_at\") VALUES (?, ?, ?, ?)  [[\"title\", \"record two\"], [\"description\", \"second row\"], [\"created_at\", 2015-11-27 03:54:02 UTC], [\"updated_at\", 2015-11-27 03:54:02 UTC]]\r\n   (51.3ms)  commit transaction\r\n => true \r\n```\r\n \r\nNow query the articles table to get the number of records. \r\n\r\n## Summary ##\r\n\r\nIn this chapter we focused on learning the model part M of the MVC framework. We experimented in the rails console and database console to create records in the database. In the next lesson we will display all the records in articles table on the browser. We will also see how the different parts of the MVC interact to create database driven dynamic web application.\r\n','2015-11-27 04:01:38','2016-12-22 23:25:14'),(2761,'Rails 5 Basics : Model View Controller','## Objectives ##\r\n\r\n- Learn how the View communicates with the Controller \r\n- Learn how Controller interacts with the Model and how Controller picks the next View to show to the user.\r\n\r\n## Context ##\r\n\r\nRouter knows which controller can handle the incoming request. Controller is like a traffic cop who controls the flow of traffic on busy streets. Controller has the knowledge of which model can get the job done, so it delegates the work to the appropriate model object. Controller also knows which view to display to the user after the incoming request has been processed.\r\n\r\nWhy MVC architecture? The advantage of MVC is the clean separation of View from the Model and Controller. It allows you to allocate work to teams according to their strengths. The View layer can be developed in parallel by the front-end developers without waiting for the Model and Controller parts to be completed by the back-end developers.\r\n\r\nIf we agree on the contract between the front-end and back-end by defining the data representation exchanged between the client and server then we can develop in parallel.\r\n\r\n## Steps ##\r\n\r\n### Step 1 ###\r\n\r\nLet\'s modify the existing static page in app/views/welcome/index.html.erb to use a view helper for hyperlink:\r\n\r\n```ruby\r\n<%= link_to \'My Blog\', ? %>\r\n```\r\n\r\nThe tag `<%=` should be used whenever you want the generated output to be shown in the browser. If it is not to be shown to the browser and it is only for dynamic embedding of Ruby code then you should use `<% %>` tags.\r\n\r\nThe `link_to(text, url)` method is a view helper that will generate an html hyperlink that users can click to navigate to a web page. In this case we want the user to go to articles controller, index page. Because we want to get all the articles from the database and display them in the app/views/articles/index.html.erb page.\r\n \r\nSo the question is what should replace the ? in the second parameter to the `link_to` view helper? Since we know we need to go to articles controller, index action, let\'s use the output of rake routes to find the name of the view helper we can use.\r\n\r\n```sh\r\n      Prefix Verb   URI Pattern                  Controller#Action\r\n    articles GET    /articles(.:format)          articles#index\r\n             POST   /articles(.:format)          articles#create\r\n new_article GET    /articles/new(.:format)      articles#new\r\nedit_article GET    /articles/:id/edit(.:format) articles#edit\r\n     article GET    /articles/:id(.:format)      articles#show\r\n             PATCH  /articles/:id(.:format)      articles#update\r\n             PUT    /articles/:id(.:format)      articles#update\r\n             DELETE /articles/:id(.:format)      articles#destroy\r\n        root GET    /                            welcome#index\r\n```\r\n \r\nAs you can see from the output, for articles#index the Prefix value is articles. So we can use either `articles_path`  (relative url, which would be /articles) or `articles_url`  (absolute url, which would be `www.example.com/articles`). \r\n \r\n### Step 2 ###\r\n\r\nChange the link as follows :\r\n\r\n```ruby\r\n<%= link_to \'My Blog\', articles_path %>\r\n```\r\n\r\n### Step 3 ###\r\n   \r\nGo to the home page by going to the `http://localhost:3000` in the browser.  What do you see in the home page? You will see the hyper link in the home page. \r\n\r\n### Step 4 ###\r\n\r\nRight click and do \'View Page Source\' in Chrome or \'Show Page Source\' in Safari. You will see the hyperlink which is a relative url. \r\n\r\n```html\r\n<a href=\"/articles\">My Blog</a>\r\n```\r\n\r\n### Step 5 ###\r\n\r\nChange the articles\\_path to articles\\_url in the welcome/index.html.erb. Reload the page. \r\n\r\n```html\r\n<a href=\"http://localhost:3000/articles\">My Blog</a>\r\n```\r\n\r\nYou will see the absolute URL.\r\n\r\n### Step 6 ###\r\n\r\nClick on the \'My Blog\' link. \r\n\r\nYou will see the above error page with \'uninitialized constant ArticlesController\' error.\r\n\r\n### Step 7 ###\r\n\r\nWhen you click on that link, you can see from rails server log that the client made a request:\r\n\r\n```sh\r\nStarted GET \"/articles\" for ::1 at 2015-11-27 11:09:42 -0800\r\n\r\nActionController::RoutingError (uninitialized constant ArticlesController):\r\n```\r\n\r\nGET \'/articles\' that was recognized by the Rails router and it looked for articles controller. Since we don\'t have the articles controller, we get the error message for the uninitialized constant. In Ruby, class names are constant.\r\n\r\nYou can also use HTTP Live Headers Chrome plugin to see the client and server interactions.\r\n\r\nHere you see the client-server interaction details. As you see in the above figure, you can learn a lot by looking at the Live HTTP Header details such as Etag which is used for caching by Rails.\r\n\r\n### Step 8 ###\r\n\r\nCreate the articles controller by running the following command in the blog directory:\r\n\r\n```ruby\r\n$rails g controller articles index \r\n```\r\n\r\n### Step 9 ###\r\n\r\nGo back to the home page and click on My Blog link.  You will see a static page.\r\n\r\n### Step 10 ###\r\n\r\nWe need to replace the static page with the list of articles from the database. Open the articles\\_controller.rb in the app/controllers directory and change the index method as follows :\r\n\r\n```ruby\r\ndef index\r\n  @articles = Article.all\r\nend\r\n```\r\n\r\nHere the @articles is an instance variable of the articles controller class. It is made available to the corresponding view class by Rails. In this case the view is app/views/articles/index.html.erb\r\n\r\nThe class method `all` retrieves all the records from the articles table.\r\n\r\n### Step 11 ###\r\n\r\nOpen the app/views/articles/index.html.erb in your code editor and add the following code:\r\n\r\n```ruby\r\n<h1>Listing Articles</h1>\r\n\r\n<% @articles.each do |article| %>\r\n\r\n  <%= article.title %> \r\n\r\n  <%= article.description %>\r\n<br/>\r\n<% end %>\r\n```\r\n\r\nHere we are using the Ruby scriptlet tag `<% %>` for looping through all the records in the articles collection and the values of each record is displayed in the browser using `<%= %>` tags.\r\n\r\nIf you make a mistake and use `<%= %>` tags instead of Ruby scriptlet tag in app/views/index.html.erb like this:\r\n\r\n```ruby\r\n<%= @articles.each do |article| %>\r\n```\r\n\r\nYou will see the objects in the array displayed on the browser. Articles are displayed as objects inside an array.\r\n\r\nIf you use the Ruby scriptlet tag :\r\n\r\n```ruby\r\nTitle : 	<% article.title %>\r\n```\r\n\r\ninstead of the tags used to evaluate expressions and display to the browser then you will not see it in the browser.\r\n\r\n### Step 12 ###\r\n\r\nGo to the browser and reload the page for `http://localhost:3000/articles`.  You will see the list of articles now displayed in the browser.\r\n\r\nAs you can see from the diagram Controller controls the flow of data into and out of the database and also decides which View should be rendered next.\r\n\r\n## Exercise ##\r\n\r\nGo to the rails server log terminal, what is the http verb used to make the request for displaying all the articles? What is the resource that was requested?\r\n\r\n##  Summary ##\r\n \r\nIn this lesson we went from the view (home page) to the controller for articles and to the article model and back to the view (index page for articles). So the MVC components interaction as shown in the diagram: \r\n\r\n1. View to Controller \r\n2. Controller to Model \r\n3. Controller to View\r\n\r\nThe data flow was from the database to the user. In the real world the user data comes from the user so we cannot create them in the rails console or in the database directly. In the next lesson we will see how we can capture data from the view provided by the user and save it in the database.','2015-11-28 01:38:44','2016-12-22 23:29:09'),(2771,'Rails 5 Basics : View to Model','## Objective ##\r\n\r\n - Learn how to get data from the user and save it in the database\r\n \r\n## Steps ##\r\n\r\n### Step 1 ###\r\n\r\nWe need to display a form for the user to fill out the text field for the article title and text area for the description. In order for the user to go to this form, let\'s create a \'New Article\' link to load an empty form in the articles index page.\r\n\r\nAdd the following code to the bottom of the app/views/articles/index.html file:\r\n\r\n```ruby\r\n<%= link_to \'New Article\', ? %>\r\n```\r\n\r\n### Step 2 ###\r\n\r\nWhat is the url helper we should use? We know we need to display the articles/new.html.erb page. We also know that the action that is executed is \'new\' before new.html.erb is displayed. Take a look at the rake routes output.\r\n\r\nThe first column named Prefix gives us the URL helper we can use. We can either append \'url\' or \'path\' to the prefix. Let\'s fill in the url helper to load the new page as follows:\r\n\r\n```ruby\r\n<%= link_to \'New Article\', new_article_path %>\r\n```\r\n\r\n### Step 3 ###\r\n\r\nReload the page `http://localhost:3000/articles` in the browser.  The hyperlink for creating a new article will now be displayed.\r\n\r\n### Step 4 ###\r\n\r\nRight click on the browser and click \'View Page Source\'.  You will see \'New Article\' link pointing to the resource \"/articles/new\".\r\n\r\n```html\r\n<a href=\"/articles/new\">New Article</a>\r\n```\r\n\r\n### Step 5 ###\r\n\r\nClick the \'New Article\' link. Go to the terminal and look at the server output.\r\n\r\n```sh\r\nStarted GET \"/articles/new\" for ::1 at 2015-11-28 14:20:54 -0800\r\n\r\nAbstractController::ActionNotFound (The action \'new\' could not be found for ArticlesController):\r\n```\r\n\r\nYou can see that the browser made a http GET request for the resource \"/articles/new\".  You will see the unknown action error page.\r\n\r\n### Step 6 ###\r\n\r\nLet\'s create the new action in articles controller. Add the following code to articles controller:\r\n\r\n```ruby\r\ndef new\r\n  \r\nend\r\n```\r\n\r\n### Step 7 ###\r\n\r\nReload the browser `http://localhost:3000/articles/new` page. In the log, you will see:\r\n\r\n```sh\r\nStarted GET \"/articles/new\" for ::1 at 2015-11-28 14:22:55 -0800\r\nProcessing by ArticlesController#new as HTML\r\nNo template found for ArticlesController#new, rendering head :no_content\r\nCompleted 204 No Content in 4ms (ActiveRecord: 0.0ms)\r\n```\r\n\r\nAfter the new action is executed Rails looks for view whose name is the same as the action, in this case app/views/articles/new.html.erb.\r\n\r\n### Step 8 ###\r\n\r\nSo lets create new.html.erb under app/views/articles directory with the following content:\r\n\r\n```ruby\r\n<%= form_for @article do |f| %>\r\n  <p>\r\n    <%= f.label :title %><br>\r\n    <%= f.text_field :title %>\r\n  </p>\r\n \r\n  <p>\r\n    <%= f.label :description %><br>\r\n    <%= f.text_area :description %>\r\n  </p>\r\n \r\n  <p>\r\n    <%= f.submit %>\r\n  </p>\r\n<% end %>\r\n```\r\n\r\n### Step 9 ###\r\n\r\nClick on the \'New Article\' link on the \'Listing Articles\' page.\r\n\r\n```sh\r\nActionView::Template::Error (First argument in form cannot contain nil or be empty):\r\n    1: <%= form_for @article do |f| %>\r\n    2:   <p>\r\n    3:     <%= f.label :title %><br>\r\n    4:     <%= f.text_field :title %>\r\n  app/views/articles/new.html.erb:\r\n```\r\n  \r\nYou will now see the above error.\r\n\r\n### Step 10 ###\r\n\r\nChange the new method in articles controller as follows:\r\n\r\n```ruby\r\ndef new\r\n  @article = Article.new\r\nend\r\n```\r\n\r\nHere we are instantiating an instance of Article class, this gives Rails a clue that the form fields is for Article model.\r\n\r\n### Step 11 ###\r\n\r\nReload the browser `http://localhost:3000/articles/new `page.  You will now see an empty form to create a new article.\r\n\r\n### Step 12 ###\r\n\r\nRight click and select \'View Page Source\' on the new article form page. \r\n\r\n```html\r\n<form class=\"new_article\" id=\"new_article\" action=\"/articles\" accept-charset=\"UTF-8\" method=\"post\"><input name=\"utf8\" type=\"hidden\" value=\"&#x2713;\" />\r\n```\r\n\r\nAs you can see, form will be submitted to the url \'/articles\' and the http verb used is POST. When the user submits the form, which controller and which action will be executed?\r\n\r\n### Step 13 ###\r\n\r\nLook at the output of rake routes, the combination of the http verb and the URL uniquely identifies the resource end point.\r\n\r\n```sh\r\nPOST   /articles(.:format)          articles#create\r\n```\r\n\r\nIn this case we see that it maps to the articles controller and create action.\r\n\r\n### Step 14 ###\r\n\r\nFill out the form and click \'Create Article\'. Check the server log output.\r\n\r\n```sh\r\nStarted POST \"/articles\" for ::1 at 2015-11-28 14:30:23 -0800\r\n\r\nAbstractController::ActionNotFound (The action \'create\' could not be found for ArticlesController):\r\n```\r\n\r\nYou can see that the browser made a post to the URL \'/articles\'. This error is due to absence of the create action in the articles controller.\r\n\r\n### Step 15 ###\r\n\r\nDefine the create method in the articles controller as follows:\r\n\r\n```ruby\r\ndef create\r\n  \r\nend\r\n```\r\n\r\n### Step 16 ###\r\n\r\nFill out the form and click \'Create Article\'. You can see that the form values submitted by the user is sent to the server. Rails automatically populates a hash called params which contains a key whose name is the article symbol and the values are the different database columns and its values.\r\n\r\n```sh\r\nStarted POST \"/articles\" for ::1 at 2015-11-28 14:31:43 -0800\r\nProcessing by ArticlesController#create as HTML\r\n  Parameters: {\"utf8\"=>\"✓\", \"authenticity_token\"=>\"WMLaonfuPgGzeToGAkkQTfgfxHCf3IutOxMtY8bd3Y28D7lNncl9VSpKjOiUM0u82E/C1P2LtC7MNFltq9rSMA==\", \"article\"=>{\"title\"=>\"How to get rick quick\", \"description\"=>\"It\'s very easy. Borrow lot of money and build lot of houses. If Donald Trump can do it, you can do it!\"}, \"commit\"=>\"Create Article\"}\r\nNo template found for ArticlesController#create, rendering head :no_content\r\nCompleted 204 No Content in 3ms (ActiveRecord: 0.0ms)\r\n```\r\n\r\nYou will see `No template found` in the log file.\r\n\r\n### Step 17 ###\r\n\r\nBefore we fix the missing template issue, we need to save the data submitted by the user in the database. You already know how to use the ActiveRecord class method \'create\' to save a record. You also know how Rails populates the params hash, this hash is made available to you in the controller. So we can access it like this :\r\n\r\n```ruby\r\ndef create\r\n  Article.create(params[:article])\r\nend\r\n```\r\n\r\nIn Figure 50, you see that the hash key article is a string, but I am using the symbol :article in the create method. How does this work? \r\n\r\nAs you can see from the rails console, params hash is not a regular Ruby hash, it is a special hash called HashWithIndifferentAccess. It allows you to set the value of the hash with either a symbol or string and retreive the value using either string or symbol.\r\n\r\n### Step 18 ###\r\n\r\nFill out the form and submit again. Now we get a forbidden attributes error.\r\n\r\n### Step 19 ###\r\n\r\nDue to security reasons we need to specify which fields must be permitted as part of the form submission. Modify the create method as follows:\r\n\r\n```ruby\r\ndef create\r\n  Article.create(params.require(:article).permit(:title, :description))\r\nend\r\n```\r\n\r\n### Step 20 ###\r\n\r\nFill out the form and submit again. You will get the template missing error but you will now see that the user submitted data has been saved to the database.\r\n\r\n```sh\r\nStarted POST \"/articles\" for ::1 at 2015-11-28 14:34:42 -0800\r\nProcessing by ArticlesController#create as HTML\r\n  Parameters: {\"utf8\"=>\"✓\", \"authenticity_token\"=>\"BRSA/7OMJLr6kUTeE8yVhC+2SSZaZlhVDkA3A1x5dybh2eMQWatn7mOi8jCFts51D+ZPgjgxZ9b5Z0MNMX54mw==\", \"article\"=>{\"title\"=>\"adfsda\", \"description\"=>\"afdadsfa\"}, \"commit\"=>\"Create Article\"}\r\n   (0.1ms)  begin transaction\r\n  SQL (0.5ms)  INSERT INTO \"articles\" (\"title\", \"description\", \"created_at\", \"updated_at\") VALUES (?, ?, ?, ?)  [[\"title\", \"adfsda\"], [\"description\", \"afdadsfa\"], [\"created_at\", 2015-11-28 22:34:42 UTC], [\"updated_at\", 2015-11-28 22:34:42 UTC]]\r\n   (49.3ms)  commit transaction\r\nNo template found for ArticlesController#create, rendering head :no_content\r\nCompleted 204 No Content in 66ms (ActiveRecord: 51.0ms)\r\n```\r\n\r\n```ruby\r\n$rails c\r\nLoading development environment (Rails 5.0.0.alpha)\r\n > Article.last\r\n  Article Load (0.1ms)  SELECT  \"articles\".* FROM \"articles\" ORDER BY \"articles\".\"id\" DESC LIMIT 1\r\n => #<Article id: 3, title: \"test\", description: \"some description\", created_at: \"2015-11-28 22:34:42\", updated_at: \"2015-11-28 22:34:42\"> \r\n```\r\n\r\nThe ActiveRecord class method \'last\' method retrieves the last row in the articles table. \r\n\r\n### Step 21 ###\r\n\r\nLet\'s now address the missing template error. Once the data is saved in the database we can either display the index page or the show page for the article. Let\'s redirect the user to the index page. We will be able to see all the records including the new record that we created. Modify the create method as follows:\r\n\r\n```ruby\r\ndef create\r\n  Article.create(params.require(:article).permit(:title, :description))\r\n  \r\n  redirect_to articles_index_path\r\nend\r\n```\r\n\r\nHow do we know that we need to use `articles_index_path` url helper? We already saw how to find the URL helper to use in the view, we can do the same. If you see the output of rake routes command, we know the resource end point, to find the URL helper we look at the Prefix column.\r\n\r\n### Step 22 ###\r\n\r\nFill out the form and submit again. You will now see all the articles displayed in the index page. \r\n\r\n## Summary ##\r\n\r\nWe saw how we can save the user submitted data in the database. We went from the View to the Controller to the Model. We also saw how the controller decides which view to render next. We learned about the http verb and identifying resource endpoint in our application. Now we know how the new and create action works. In the next lesson we will see how edit and update action works to make changes to an existing record in the database.\r\n','2015-11-28 22:44:28','2016-12-22 23:30:26'),(2781,'Rails 5 Basics : Update Article','## Objective ##\r\n\r\n- Learn how to update an existing record in the database\r\n\r\n## Steps ##\r\n\r\n### Step 1 ###\r\n\r\nLet\'s add \'Edit\' link to each record that is displayed in the index page. Open the app/views/articles/index.html.erb and add the edit link:\r\n\r\n```ruby\r\n<%= link_to \'Edit\', ? %>\r\n```\r\n\r\nWhat should be the url helper to use in the second parameter to the link_to method? \r\n\r\n### Step 2\r\n\r\nWe know that when someone clicks the \'Edit\' link we need to load a form for that particular row with the existing values for that record. So we know the resource endpoint is articles#edit, if you look at the rake routes output, the Prefix column gives us the url helper to use. \r\n\r\nSo we now have:\r\n\r\n```ruby\r\n<%= link_to \'Edit\', edit_article_path() %>\r\n```\r\n\r\n### Step 3 ###\r\n\r\nGo to Rails console and type `app.edit_article_path`:\r\n\r\n```ruby\r\n$rails c\r\nLoading development environment (Rails 5.0.0.alpha)\r\n > app.edit_article_path\r\nActionController::UrlGenerationError: No route matches {:action=>\"edit\", :controller=>\"articles\"} missing required keys: [:id]\r\n```\r\n\r\nRails does not recognize `edit_article_path` helper method.\r\n\r\n### Step 4 ###\r\n\r\nExamine the output of rake routes command. In the URI Pattern column you see the pattern for edit as : `/articles/:id/edit`\r\n\r\nURI Pattern can consist of symbols which represent variable. You can think of it as a place holder. The symbol :id in this case represents the primary key of the record we want to update. So we pass an instance of an article to url helper. We could call the id method on article, since Rails automatically calls id on this instance, we will just let Rails do its magic. Modify the `link_to` method as follows:\r\n\r\n```ruby\r\n<%= link_to \'Edit\', edit_article_path(article) %>\r\n```\r\n\r\nRails recognizes `edit_article_path` when the primary key :id value is passed in as the argument.\r\n\r\n### Step 5 ###\r\n\r\nThe app/views/articles/index.html.erb will look like this :\r\n\r\n```ruby\r\n<h1>Listing Articles</h1>\r\n\r\n<% @articles.each do |article| %>\r\n\r\n	<%= article.title %> : \r\n\r\n	<%= article.description %> \r\n	\r\n	<%= link_to \'Edit\', edit_article_path(article) %>\r\n	\r\n	<br/>\r\n\r\n<% end %>\r\n<br/>\r\n<%= link_to \'New Article\', new_article_path %>\r\n```\r\n\r\n### Step 6 ###\r\n\r\nReload the `http://localhost:3000/articles` page. You will now see the \'Edit\' link for each article in the database.\r\n\r\n### Step 7 ###\r\n\r\nRight click on the browser and select \'View Page Source\'. You will see the primary keys of the corresponding row for the :id variable.\r\n\r\n```html\r\n<body>\r\n  <h1>Listing Articles</h1>\r\n  test \r\n  first row\r\n  <a href=\"/articles/1/edit\">Edit</a>\r\n<br/>\r\n  record two \r\n  second row\r\n  <a href=\"/articles/2/edit\">Edit</a>\r\n  \r\n<a href=\"/articles/new\">New Article</a>\r\n\r\n</body>\r\n```\r\n\r\n### Step 8 ###\r\n\r\nClick on the \'Edit\' link.  You will see `The action \'edit\' could not be found for ArticlesController` error page.\r\n\r\n### Step 9 ###\r\n\r\nLet\'s define the edit action in the articles controller :\r\n\r\n```ruby\r\ndef edit\r\n  \r\nend\r\n```\r\n\r\n### Step 10 ###\r\n\r\nClick on the \'Edit\' link. You now get `no template found` error in the rails console. \r\n\r\n```sh\r\nStarted GET \"/articles/4/edit\" for ::1 at 2015-11-29 12:21:58 -0800\r\nProcessing by ArticlesController#edit as HTML\r\n  Parameters: {\"id\"=>\"4\"}\r\nNo template found for ArticlesController#edit, rendering head :no_content\r\nCompleted 204 No Content in 3ms (ActiveRecord: 0.0ms)\r\n```\r\n\r\nLet\'s create app/views/articles/edit.html.erb with the following contents:\r\n\r\n```ruby\r\n<%= form_for @article do |f| %>\r\n  <p>\r\n    <%= f.label :title %><br>\r\n    <%= f.text_field :title %>\r\n  </p>\r\n \r\n  <p>\r\n    <%= f.label :description %><br>\r\n    <%= f.text_area :description %>\r\n  </p>\r\n \r\n  <p>\r\n    <%= f.submit %>\r\n  </p>\r\n<% end %>\r\n```\r\n\r\n### Step 11 ###\r\n\r\nClick on the \'Edit\' link. You now get the following error page:\r\n\r\n```ruby\r\nActionView::Template::Error (First argument in form cannot contain nil or be empty):\r\n    1: <%= form_for @article do |f| %>\r\n    2:   <p>\r\n    3:     <%= f.label :title %><br>\r\n    4:     <%= f.text_field :title %>\r\n  app/views/articles/edit.html.erb:1:in `_app_views_articles_edit_html_erb\'\r\n```\r\n\r\nWe are getting this error because the first argument to `form_for` helper method cannot be nil or empty. In our case, it is nil.\r\n\r\n### Step 12 ###\r\n\r\nLook at the server log:\r\n\r\n```sh\r\nStarted GET \"/articles/4/edit\" for ::1 at 2015-11-29 12:24:11 -0800\r\nProcessing by ArticlesController#edit as HTML\r\n  Parameters: {\"id\"=>\"4\"}\r\n  Rendered articles/edit.html.erb within layouts/application (2.3ms)\r\nCompleted 500 Internal Server Error in 8ms (ActiveRecord: 0.0ms)\r\n```\r\n\r\nYou can see that the primary key of the selected article id and it\'s value. Rails automatically populates params hash and makes it available to the controllers.\r\n\r\n### Step 13 ###\r\n\r\nIn the edit action we need to load the selected record from the database so that we can display it with the existing values for its columns. You already know that Rails populates params hash with the values submitted in the GET request for resource \'/articles/1/edit\'. We can now define the edit method as follows:\r\n\r\n```ruby\r\ndef edit\r\n  @article = Article.find(params[:id])\r\nend\r\n```\r\n\r\nHere we find the record for the given primary key and save it in the instance variable @article. Since this variable is available in the view, we can now display the record with its existing values.\r\n\r\n### Step 14 ###\r\n\r\nClick on the \'Edit\' link.  You will now see the form with values populated.\r\n\r\n### Step 15 ###\r\n\r\nRight click on the browser and click \'View Page Source\'.\r\n\r\n```html\r\n<form class=\"edit_article\" id=\"edit_article_3\" action=\"/articles/3\" accept-charset=\"UTF-8\" method=\"post\">\r\n```\r\n\r\nWe see that the URI pattern is \'/articles/3\' and the http verb is POST. If you look at the output of rake routes you will see that POST is used only once for create. The browser knows only GET and POST, it does not know how to use any other http verbs. \r\n\r\nThe question is how to overcome the inability of browsers to speak the entire RESTful vocabulary of using the appropriate http verb for a given operation?\r\n\r\nThe answer lies in the hidden field called _method that has the value PATCH. Rails piggybacks on the POST http verb to actually sneak in a hidden variable that tells the server it is actually a PATCH http verb. \r\n\r\n```html\r\n<input type=\"hidden\" name=\"_method\" value=\"patch\" />\r\n```\r\n\r\nIf you look at the output of rake routes, for the combination of PATCH and \'/articles/3\' you will see that it maps to update action in the articles controller.\r\n\r\n```sh\r\nPATCH  /articles/:id(.:format)      articles#update\r\n```\r\n\r\nRails 5 uses PATCH instead of PUT that it used in previous versions. This is because PUT is an idempotent operation so for any request that needs to modify the state on the server PATCH is used.\r\n\r\n### Step 16 ###\r\n\r\nLet\'s implement the update method that will take the new values provided by user for the existing record and update it in the database. Add the following update method to articles controller.\r\n\r\n```ruby\r\ndef update\r\n  @article = Article.find(params[:id])\r\n  @article.update_attributes(params[:article])\r\nend\r\n```\r\n\r\nBefore we update the record we need to load the existing record from the database. Why? Because the instance variable in the controller will only exist for one request-response cycle. Since http is stateless we need to retrieve it again before we can update it.\r\n\r\n### Step 17 ###\r\n\r\nGo to articles index page by going to `http://localhost:3000/articles`. Click on the \'Edit\' link. In the edit form, you can change the value of either the title or description and click \'Update Article\'.\r\n\r\n### Step 18 ###\r\n\r\nWe can see in the console:\r\n\r\n```sh\r\nStarted PATCH \"/articles/3\" for ::1 at 2015-11-29 12:34:58 -0800\r\nProcessing by ArticlesController#update as HTML\r\n```\r\n\r\nThe combination of PATCH http verb and \'/articles/3\' routed the request to the update action of the articles controller.  To fix the forbidden attributes error, we can do the same thing we did for create action. Change the update method as follows:\r\n\r\n```ruby\r\ndef update\r\n  @article = Article.find(params[:id])\r\n  permitted_columns = params.require(:article).permit(:title, :description)\r\n  @article.update_attributes(permitted_columns)\r\nend\r\n```\r\n\r\nChange the title and click \'Update Article\'. We see in the console, the template is missing but the record has been successfully updated.\r\n\r\n```sh\r\nSQL (0.4ms)  UPDATE \"articles\" SET \"title\" = ?, \"description\" = ?, \"updated_at\" = ? WHERE \"articles\".\"id\" = ?  [[\"title\", \"new title\"], [\"description\", \"old description\"], [\"updated_at\", 2015-11-29 20:38:33 UTC], [\"id\", 3]]\r\n   (71.8ms)  commit transaction\r\nNo template found for ArticlesController#update, rendering head :no_content\r\n```		\r\n\r\n### Step 19 ###\r\n\r\nLet\'s address the template is missing error. We don\'t need update.html.erb, we can redirect the user to the index page where all the records are displayed. Change the update method as follows:\r\n\r\n```ruby\r\ndef update\r\n  @article = Article.find(params[:id])\r\n  permitted_columns = params.require(:article).permit(:title, :description)\r\n  @article.update_attributes(permitted_columns)\r\n  \r\n  redirect_to articles_path\r\nend\r\n```\r\n\r\n### Step 20 ###\r\n\r\nEdit the article and click \'Update Article\'. You should see that it now updates the article and redirects the user to the articles index page.\r\n\r\n### Step 21 ###\r\n\r\nAn annoying thing about Rails 5 is that when you run the rails generator to create a controller with a given action it also creates an entry in the routes.rb which is not required for a RESTful route. Because we already have resources :articles declaration in the routes.rb, let\'s delete the following line: \r\n\r\n```ruby\r\nget \"articles/index\"\r\n```\r\n\r\nin the config/routes.rb file. Now we longer have the `articles_index_path` helper, let\'s update the create method to use the `articles_path` as follows:\r\n\r\n```ruby\r\ndef create\r\n  Article.create(params.require(:article).permit(:title, :description))\r\n  \r\n  redirect_to articles_path\r\nend\r\n```\r\n\r\n## Summary ##\r\n\r\nIn this lesson you learned how to update an existing record by displaying a form for an existing article and saving the new values in the database. In the next lesson we will see how to display a given article.','2015-11-29 20:48:16','2015-11-29 20:57:11'),(2791,'Ruby Comparable Basics','### Delegating the Implementation for Spaceship Operator\r\n\r\nCreate a person class with the spaceship operator that delegates the comparison logic to the size of the name (string).\r\n\r\n```ruby\r\nclass Person\r\n  attr_reader :name\r\n  \r\n  def initialize(name)\r\n    @name = name\r\n  end\r\n  \r\n  def <=>(other)\r\n    name.size <=> other.name.size\r\n  end\r\n  \r\nend\r\n\r\nlist = [Person.new(\'Bugs\'), Person.new(\'Daffy Duck\')]\r\n\r\np list.sort\r\n```\r\n\r\nThis prints:\r\n\r\n```sh\r\n[#<Person:0x007f @name=\"Bugs\">, #<Person:0x007b @name=\"Daffy Duck\">]\r\n```\r\n\r\nYou can think of the <=> operator as `compare_to`, so it is easier to remember that you need the other object as the parameter to compare.\r\n\r\n### Default Spaceship Implementation\r\n\r\nWe can delegate to the default <=> implementation for the String object:\r\n\r\n```ruby\r\nclass Person\r\n  attr_reader :name\r\n  \r\n  def initialize(name)\r\n    @name = name\r\n  end\r\n  \r\n  def <=>(other)\r\n    name <=> other.name\r\n  end\r\n  \r\nend\r\n\r\nlist = [Person.new(\'Bugs\'), Person.new(\'Daffy Duck\')]\r\n\r\np list.sort\r\n```\r\n\r\nIn this case, we don\'t call the size method. This prints:\r\n\r\n```sh\r\n[#<Person:0x007f @name=\"Bugs\">, #<Person:0x0078 @name=\"Daffy Duck\">]\r\n```\r\n\r\nSo the string object sorts the list in alphabetical order, so the first element is Bugs. If you do:\r\n\r\n```ruby\r\np \'Bugs Bunny\' < \'Daffy Duck\'\r\n```\r\n\r\nThe output is `true`. If you do:\r\n\r\n```ruby\r\np \'Yosemite Sam\' < \'Daffy Duck\'\r\n```\r\n\r\nThe output is `false`, because Yosemite Sam will be the last element among these three cartoon characters.\r\n\r\nThe spaceship operator is the basis for the methods <, <=, >, >= and between? methods included in Comparable module. It is also the basis for comparisons when you use `sort` method.\r\n\r\n### Custom Logic for Spaceship Operator\r\n\r\n```ruby\r\nclass Person\r\n  attr_reader :name\r\n  \r\n  def initialize(name)\r\n    @name = name\r\n  end\r\n  \r\n  def <=>(other)\r\n    if some_condition\r\n	  return -1\r\n	elsif some_other_condition\r\n	  return 0\r\n	else\r\n	  return 1\r\n	end \r\n  end\r\n  \r\nend\r\n```\r\n\r\nBased on your domain logic you can implement the <=> operator by comparing the receiver against another object and return -1, 0 or 1 depending on whether the receiver is <, == or > other object. \r\n\r\n### Example from New Relic Gem \r\n\r\n```ruby\r\n#!/usr/bin/ruby\r\n# encoding: utf-8\r\n# This file is distributed under New Relic\'s license terms.\r\n# See https://github.com/newrelic/rpm/blob/master/LICENSE for complete details.\r\n\r\n\r\nmodule NewRelic\r\n  module VERSION #:nodoc:\r\n    def self.build_version_string(*parts)\r\n      parts.compact.join(\'.\')\r\n    end\r\n\r\n    MAJOR = 3\r\n    MINOR = 14\r\n    TINY  = 0\r\n\r\n    begin\r\n      require File.join(File.dirname(__FILE__), \'build\')\r\n    rescue LoadError\r\n      BUILD = nil\r\n    end\r\n\r\n    STRING = build_version_string(MAJOR, MINOR, TINY, BUILD)\r\n  end\r\n\r\n  # Helper class for managing version comparisons\r\n  class VersionNumber\r\n    attr_reader :parts\r\n    include Comparable\r\n    def initialize(version_string)\r\n      version_string ||= \'1.0.0\'\r\n      @parts = version_string.split(\'.\').map{|n| n =~ /^\\d+$/ ? n.to_i : n}\r\n    end\r\n    def major_version; @parts[0]; end\r\n    def minor_version; @parts[1]; end\r\n    def tiny_version; @parts[2]; end\r\n\r\n    def <=>(other)\r\n      other = self.class.new(other) if other.is_a? String\r\n      self.class.compare(self.parts, other.parts)\r\n    end\r\n\r\n    def to_s\r\n      @parts.join(\".\")\r\n    end\r\n\r\n    def hash\r\n      @parts.hash\r\n    end\r\n\r\n    def eql? other\r\n      (self <=> other) == 0\r\n    end\r\n\r\n    private\r\n    def self.compare(parts1, parts2)\r\n      a, b = parts1.first, parts2.first\r\n      case\r\n        when a.nil? && b.nil? then 0\r\n        when a.nil? then b.is_a?(Fixnum) ?  -1 : 1\r\n        when b.nil? then -compare(parts2, parts1)\r\n        when a.to_s == b.to_s then compare(parts1[1..-1], parts2[1..-1])\r\n        when a.is_a?(String) then b.is_a?(Fixnum) ?  -1 : (a <=> b)\r\n        when b.is_a?(String) then -compare(parts2, parts1)\r\n        else # they are both fixnums, not nil\r\n          a <=> b\r\n      end\r\n    end\r\n  end\r\nend\r\n```\r\n\r\nSummary\r\n=========\r\n-----------\r\n\r\nBy providing a custom implementation for <=> operator, you get a good return on your efforts because the Comparable module gives you <, <=, >, >= and between? methods for free. In addition to that you also get the sort method if you store your objects in an Array and would like to sort based on your own custom logic.\r\n\r\nReference\r\n=========\r\n-----------\r\n\r\n[Ruby 2.2.3 Comparable Basics](http://bparanj.blogspot.com/2015/10/ruby-223-comparable-basics.html \'Ruby 2.2.3 Comparable Basics\')\r\n','2015-12-02 05:27:51','2015-12-02 06:21:53'),(2801,'Rails 5 Basics : Show Article','## Objective ##\r\n\r\n- Learn how to display a selected article in the article show page.\r\n\r\n## Steps ##\r\n\r\n### Step 1 ###\r\n\r\nAdd the \'Show\' link to each article in the index page. The hyperlink text will be \'Show\'.\r\n\r\n```ruby\r\n<%= link_to \'Show\', ? %>\r\n```\r\n\r\nWhen the user clicks the \'Show\' link we need to go the articles controller, show action. We will retrieve the record from the database and display it in the view.  What should be the url helper? \r\n\r\nYou can view the output of rake routes to find the url helper to use in the view. In this case we know the resource end point. We go from the right most column to the left most column and find the url helper under the Prefix column.\r\n\r\n```sh\r\n      Prefix Verb   URI Pattern                  Controller#Action\r\n    articles GET    /articles(.:format)          articles#index\r\n             POST   /articles(.:format)          articles#create\r\n new_article GET    /articles/new(.:format)      articles#new\r\nedit_article GET    /articles/:id/edit(.:format) articles#edit\r\n     article GET    /articles/:id(.:format)      articles#show\r\n             PATCH  /articles/:id(.:format)      articles#update\r\n             PUT    /articles/:id(.:format)      articles#update\r\n             DELETE /articles/:id(.:format)      articles#destroy\r\n```\r\n\r\nSo, we now have :\r\n\r\n```ruby\r\n<%= link_to \'Show\', article_path %>\r\n```\r\n\r\n### Step 2 ###\r\n\r\nGo to Rails console and type:\r\n\r\n```ruby\r\n>   app.article_path\r\nActionController::UrlGenerationError: No route matches {:action=>\"show\", :controller=>\"articles\"} missing required keys: [:id]\r\n```\r\n\r\nRails does not recognize the article_path. \r\n\r\n### Step 3 ###\r\n\r\nLook at the output of rake routes command. You can see in the URI pattern column the :id variable for primary key. \r\n\r\n```sh\r\narticle GET    /articles/:id(.:format)      articles#show\r\n```\r\n\r\nSo we need to pass the id as the parameter as shown below:\r\n\r\n```ruby\r\n<%= link_to \'Show\', article_path(article.id) %>\r\n```\r\n\r\nRails recognizes article path when an id is passed in as the parameter to the url helper method.\r\n\r\n```ruby\r\n<a href=\"/articles/1\">Show</a>\r\n```\r\n\r\nYou can see the generated string is the same as the URI pattern in the output of the rake routes command.\r\n\r\nWe can simplify it even further by letting Rails call the id method for us by just passing the article object.\r\n\r\n### Step 4 ###\r\n\r\nSince Rails automatically calls the id method of the ActiveRecord we can simplify it as follows:\r\n\r\n```ruby\r\n<%= link_to \'Show\', article_path(article) %>\r\n```\r\n\r\n### Step 5 ###\r\n\r\nRails has optimized this even further so you can do :\r\n\r\n```ruby\r\n<%= link_to \'Show\', article %>\r\n```\r\n\r\nLet\'s now see how Rails makes this magic happen. \r\n\r\n```ruby\r\n> a = Article.first\r\n  Article Load (0.2ms)  SELECT  \"articles\".* FROM \"articles\" ORDER BY \"articles\".\"id\" ASC LIMIT 1\r\n => #<Article id: 1, title: \"test first\", description: \"first row\", created_at: \"2015-11-27 03:52:06\", updated_at: \"2015-11-29 20:41:16\"> \r\n```\r\n\r\nRetrieving first article from database in Rails console.\r\n\r\n```ruby\r\n > app.article_path(a.id)\r\n => \"/articles/1\" \r\n > app.article_path(a)\r\n => \"/articles/1\" \r\n```\r\n\r\nExperimenting in Rails console to check the generated URI for a given article resource. Rails internally uses the polymorphic_path method that takes an argument to generate the url.\r\n\r\n### Step 6 ###\r\n\r\nThe app/views/articles/index.html.erb looks as shown below:\r\n\r\n```ruby\r\n<h1>Listing Articles</h1>\r\n\r\n<% @articles.each do |article| %>\r\n\r\n	<%= article.title %> : \r\n\r\n	<%= article.description %> \r\n	\r\n	<%= link_to \'Edit\', edit_article_path(article) %>\r\n	<%= link_to \'Show\', article_path(article) %>\r\n	\r\n	<br/>\r\n\r\n<% end %>\r\n<br/>\r\n<%= link_to \'New Article\', new_article_path %>\r\n```\r\n\r\n### Step 7 ###\r\n\r\nReload the articles index page `http://localhost:3000/articles`. You will see the show link.\r\n\r\n### Step 8 ###\r\n\r\nIf you view the page source for articles index page, you will see the hyperlink for \'Show\' with the URI pattern \'/articles/1\'. Since this is a hyperlink the browser will use the http verb GET when the user clicks on show.\r\n\r\nIn the rails server log you will see the GET request for the resource \'/articles/1\'. In this case the value of :id is 1. Rails will automatically populate the params hash with :id as the key and the value as the primary key of the record which in this case is 1. We can retrieve the value of the primary key from the params hash and load the record from the database.\r\n\r\n```sh\r\nStarted GET \"/articles/1\" for ::1 at 2015-12-03 08:04:21 -0800\r\n```\r\n\r\nServer log is another friend.\r\n\r\n### Step 9 ###\r\n\r\nIf you click on the \'Show\' link you will get the \'Unknown action\' error.\r\n\r\n```sh\r\nAbstractController::ActionNotFound (The action \'show\' could not be found for ArticlesController):\r\n```\r\n\r\nAs we saw in the previous step, we can get the primary key from the params hash. So, define the show action in the articles controller as follows:\r\n\r\n```ruby\r\ndef show\r\n  @article = Article.find(params[:id])\r\nend\r\n```\r\n\r\nWe already know the instance variable @article will be made available in the view.\r\n\r\n### Step 10 ###\r\n\r\nIf you click the \'Show\' link, you will get the error:\r\n\r\n```sh\r\nNo template found for ArticlesController#show, rendering head :no_content\r\n```\r\n\r\nWe need a view to display the selected article. Let\'s define app/views/show.html.erb with the following content:\r\n\r\n```ruby\r\n<p>\r\n  <%= @article.title %><br>\r\n</p>\r\n\r\n<p>\r\n  <%= @article.description %><br>\r\n</p>\r\n```\r\n\r\nSince the @article variable was initialized in the show action, we can retrieve the values of the columns for this particular record and display it in the view. Now the \'Show\' link will work. \r\n\r\n## Summary ##\r\n\r\nIn this lesson we saw how to display a selected article in the show page. In the next lesson we will see how to delete a given record from the database.','2015-12-03 16:11:58','2015-12-03 16:11:58'),(2811,'Rails 5 Basics : Delete Article','## Objectives ##\r\n\r\n- Learn how to delete a given article.\r\n- Learn how to use flash messages.\r\n\r\n## Steps ##\r\n\r\n### Step 1 ###\r\n\r\nLet\'s add \'Delete\' link to each record displayed in the articles index page. Look at the output of `rails routes`.\r\n\r\n```sh\r\n      Prefix Verb   URI Pattern                  Controller#Action\r\n    articles GET    /articles(.:format)          articles#index\r\n             POST   /articles(.:format)          articles#create\r\n new_article GET    /articles/new(.:format)      articles#new\r\nedit_article GET    /articles/:id/edit(.:format) articles#edit\r\n     article GET    /articles/:id(.:format)      articles#show\r\n             PATCH  /articles/:id(.:format)      articles#update\r\n             PUT    /articles/:id(.:format)      articles#update\r\n             DELETE /articles/:id(.:format)      articles#destroy\r\n```			 \r\n\r\nThe last row is the route for destroy. The Prefix column is empty in this case. It means whatever is above that column that is not empty carries over to that row. So we can create our hyperlink as:\r\n\r\n```ruby\r\n<%= link_to \'Delete\', article_path(article) %> \r\n```\r\n\r\nThis will create an hyperlink, when a user clicks on the link the browser will make a http GET request, which means it will end up in show action instead of destroy. Look the Verb column, you see we need to use DELETE http verb to hit the destroy action in the articles controller. So now we have:\r\n\r\n```ruby\r\n<%= link_to \'Delete\', article_path(article), method: :delete %> \r\n```\r\n\r\nThe third parameter specifies that the http verb to be used is `DELETE`. Since this is an destructive action we want to avoid accidental deletion of records, so let\'s popup a javascript confirmation for delete like this:\r\n\r\n```ruby\r\n<%= link_to \'Delete\', \r\n             article_path(article), \r\n						 method: :delete, \r\n						 data: { confirm: \'Are you sure?\' } %> \r\n```\r\n\r\nThe fourth parameter will popup a window that confirms the delete action. The app/views/articles/index.html.erb now looks like this:\r\n\r\n```ruby\r\n<h1>Listing Articles</h1>\r\n\r\n<% @articles.each do |article| %>\r\n\r\n	<%= article.title %> : \r\n\r\n	<%= article.description %> \r\n	\r\n	<%= link_to \'Edit\', edit_article_path(article) %>\r\n	<%= link_to \'Show\', article %>\r\n	<%= link_to \'Delete\', \r\n	             article_path(article), \r\n							 method: :delete, \r\n							 data: { confirm: \'Are you sure?\' } %> \r\n	\r\n	<br/>\r\n\r\n<% end %>\r\n<br/>\r\n<%= link_to \'New Article\', new_article_path %>\r\n```\r\n\r\n### Step 2 ###\r\n\r\nReload the articles index page `http://localhost:3000/articles`. You will see the delete link in the browser.\r\n\r\n### Step 3 ###\r\n\r\nIn the articles index page, do a \'View Page Source\'.\r\n\r\n```html\r\n<a data-confirm=\"Are you sure?\" rel=\"nofollow\" data-method=\"delete\" href=\"/articles/1\">Delete</a>\r\n```\r\n\r\nYou see the html 5 data attribute `data-confirm` with the value \'Are you sure?\'. This is the text displayed in the confirmation popup window. The `data-method` attribute value is delete. This is the http verb to be used for this link. The `rel=nofollow` tells spiders not to crawl these links because it will delete records in the database.\r\n\r\nThe combination of the URI pattern and the http verb `DELETE` uniquely identifies a resource endpoint on the server.\r\n\r\n### Step 4 ###\r\n\r\nRight click on the `http://localhost:3000/articles` page. Click on the `/assets/application.debug-xyz.js` link. \r\n\r\n```javascript\r\n// Link elements bound by jquery-ujs\r\n    linkClickSelector: \'a[data-confirm], a[data-method], a[data-remote], a[data-disable-with], a[data-disable]\',\r\n```\r\n\r\nSearch for \'confirm\'. The first occurrence shows you the link element bound by `jquery-ujs`. UJS stands for Unobtrusive Javascript. It is unobtrusive because you don\'t see any javascript code in the html page.\r\n\r\n```javascript\r\n// Default confirm dialog, may be overridden with custom confirm dialog in $.rails.confirm\r\n    confirm: function(message) {\r\n      return confirm(message);\r\n    },\r\n```	\r\n\r\nIf you scroll down you the see default confirm dialog as shown in the above code snippet.\r\n\r\n```javascript\r\n// Handles \"data-method\" on links such as:\r\n    // <a href=\"/users/5\" data-method=\"delete\" rel=\"nofollow\" data-confirm=\"Are you sure?\">Delete</a>\r\n    handleMethod: function(link) {\r\n      var href = rails.href(link),\r\n        method = link.data(\'method\'),\r\n        target = link.attr(\'target\'),\r\n        csrfToken = rails.csrfToken(),\r\n        csrfParam = rails.csrfParam(),\r\n        form = $(\'<form method=\"post\" action=\"\' + href + \'\"></form>\'),\r\n        metadataInput = \'<input name=\"_method\" value=\"\' + method + \'\" type=\"hidden\" />\';\r\n```\r\n\r\nYou can search for `method`. You can see handler method that handles \'data-method\' on links as shown in the above code snippet.\r\n\r\n### Step 5 ###\r\n\r\nIn the articles index page, click on the \'Delete\' link. Click \'Cancel\' of the confirmation popup window.\r\n\r\n### Step 6 ###\r\n\r\nDefine the destroy method in articles controller as follows:\r\n\r\n```ruby\r\ndef destroy\r\n  @article = Article.find(params[:id])\r\n  @article.destroy\r\n  \r\n  redirect_to articles_path\r\nend\r\n```\r\n\r\nThis method is very similar to update method. Instead of updating the record we are deleting it. You already know by this time how to look at the values sent by the browser to the server by looking at the server log output. You also know that params hash will contain the data sent to the server and Rails automatically populates the params hash.\r\n\r\n### Step 7 ###\r\n\r\nIn the articles index page, click on the \'Delete\' link. Click \'Ok\' in the confirmation popup. The record will now be deleted from the database and you will be redirected back to the articles index page.\r\n\r\n```sh\r\nStarted DELETE \"/articles/2\" for ::1 at 2015-12-05 11:17:26 -0800\r\nProcessing by ArticlesController#destroy as HTML\r\n  Parameters: {\"authenticity_token\"=>\"jVu7/OGkqy+smP7So+b/orTq4E5oc9uZ39OQ7K50DENpltgTC4PoezWrSDw1nKRTlLrm6gok5Boo9OTiw3MD/g==\", \"id\"=>\"2\"}\r\n  Article Load (0.2ms)  SELECT  \"articles\".* FROM \"articles\" WHERE \"articles\".\"id\" = ? LIMIT 1  [[\"id\", 2]]\r\n   (0.1ms)  begin transaction\r\n  SQL (0.3ms)  DELETE FROM \"articles\" WHERE \"articles\".\"id\" = ?  [[\"id\", 2]]\r\n   (44.5ms)  commit transaction\r\nRedirected to http://localhost:3000/articles\r\nCompleted 302 Found in 67ms (ActiveRecord: 45.9ms)\r\n\r\nStarted GET \"/articles\" for ::1 at 2015-12-05 11:17:26 -0800\r\nProcessing by ArticlesController#index as HTML\r\n  Article Load (0.2ms)  SELECT \"articles\".* FROM \"articles\"\r\n  Rendered articles/index.html.erb within layouts/application (2.4ms)\r\nCompleted 200 OK in 16ms (Views: 13.7ms | ActiveRecord: 0.2ms)\r\n```\r\n\r\nDid we really delete the record? \r\n\r\n### Step 8 ###\r\n\r\nThe record was deleted but there is no feedback to the user. Let\'s modify the destroy action as follows:\r\n\r\n```ruby\r\ndef destroy\r\n  @article = Article.find(params[:id])\r\n  @article.destroy\r\n  \r\n  redirect_to articles_path, notice: \"Delete success\"\r\nend\r\n```\r\n\r\nAdd the following code after the body tag in the application layout file, `app/views/layouts/application.html.erb`.\r\n\r\n```ruby\r\n<% flash.each do |name, msg| -%>\r\n     <%= content_tag :div, msg, class: name %>\r\n<% end -%>\r\n```\r\n\r\nYour updated layout file will now look like this:\r\n\r\n```ruby\r\n<!DOCTYPE html>\r\n<html>\r\n<head>\r\n<title>Blog</title>\r\n<%= stylesheet_link_tag \"application\",  media: \"all\",  \"data-turbolinks-track\" => true %>\r\n<%= javascript_include_tag \"application\",  \"data-turbolinks-track\" => true %>\r\n<%= csrf_meta_tags %>\r\n</head>\r\n<body>\r\n\r\n<% flash.each do |name, msg| -%>\r\n	<%= content_tag :div, msg, class: name %>\r\n<% end -%>\r\n\r\n<%= yield %>\r\n\r\n</body>\r\n</html>\r\n```\r\n\r\n### Step 9 ###\r\n\r\nIn the articles index page, click on the \'Delete\' link. Now you see the feedback that is displayed to the user after delete operation.\r\n\r\n### Step 10 ###\r\n\r\nIn the articles index page, do a \'View Page Source\'.\r\n\r\n```html\r\n<div class=\"notice\">Delete success</div>\r\n```\r\n\r\nYou can see the `content_tag` helper generated html for the notice section.\r\n\r\n## Summary ##\r\n\r\nIn this lesson we learned how to delete a given article. We also learned about flash notice to provide user feedback. In the next lesson we will learn about eliminating duplication in views.\r\n','2015-12-05 19:27:54','2016-12-22 23:49:00'),(2821,'Rails 5 Basics : View Duplication','## Objective ##\r\n\r\n- Learn how to eliminate duplication in views by using partials.\r\n\r\n## Steps ##\r\n\r\n### Step 1 ###\r\n\r\nLook at the app/views/new.html.erb and app/views/edit.html.erb. There is duplication. \r\n\r\n### Step 2 ###\r\n\r\nCreate a file called `_form.html.erb` under `app/views/articles` directory with the following contents:\r\n\r\n```ruby\r\n<%= form_for @article do |f| %>\r\n  <p>\r\n    <%= f.label :title %><br>\r\n    <%= f.text_field :title %>\r\n  </p>\r\n \r\n  <p>\r\n    <%= f.label :description %><br>\r\n    <%= f.text_area :description %>\r\n  </p>\r\n \r\n  <p>\r\n    <%= f.submit %>\r\n  </p>\r\n<% end %>\r\n```\r\n\r\n### Step 3 ###\r\n\r\nEdit the `app/views/articles/new.html.erb` and change the content as follows:\r\n\r\n```ruby\r\n<h1>New Article</h1>\r\n\r\n<%= render \'form\' %>\r\n```\r\n\r\n### Step 4 ###\r\n\r\nEdit the `app/views/articles/edit.html.erb` and change the content as follows:\r\n\r\n```ruby\r\n<h1>Edit Article</h1>\r\n\r\n<%= render \'form\' %>\r\n```\r\n\r\n### Step 5 ###\r\n\r\nGo to `http://localhost:3000/articles` and create new article and edit existing article. The name of the partial begins with an underscore, when you include the partial by using the render helper you don\'t include the underscore. This is the Rails convention for using partials.\r\n\r\nIf you get the missing partial error. It means you did not create the `app/views/articles/_form.html.erb` file. Make sure you followed the instruction in step 2.\r\n\r\n## Summary ##\r\n\r\nIn this lesson we saw how to eliminate duplication in views by using partials. In the next lesson we will learn about relationships between models.','2015-12-06 21:54:21','2015-12-06 21:54:43'),(2831,'Rails 5 Basics : Relationships ','## Objective ##\r\n\r\n- To learn relationships between models.\r\n\r\n## Steps ##\r\n\r\n### Step 1 ###\r\n\r\nLet\'s create a comment model by using the Rails generator command:\r\n\r\n```ruby\r\n$rails g model comment commenter:string description:text article:references\r\n```\r\n\r\n### Step 2 ###\r\n\r\nOpen the `db/migrate/xyz_create_comments.rb` file in your IDE. You will see the `create_table()` method within `change()` method that takes comments symbol `:comments` as the argument and the description of the columns for the comments table. \r\n\r\nWhat does references do? It creates the foreign key `article_id` in the comments table. We also create an index for this foreign key in order to make the SQL joins faster.\r\n\r\n### Step 3 ###\r\n\r\nRun :\r\n\r\n```ruby\r\n$rake db:migrate\r\n```\r\n\r\n```sh\r\n== 20151206232151 CreateComments: migrating ===================================\r\n-- create_table(:comments)\r\n   -> 0.0067s\r\n== 20151206232151 CreateComments: migrated (0.0067s) ==========================\r\n```\r\n\r\nLet\'s install SQLiteManager Firefox plugin that we can use to open the SQLite database, query, view table structure etc.\r\n\r\n### Step 4 ###\r\n\r\nInstall SqliteManager Firefox plugin [SqliteManager Firefox plugin](https://addons.mozilla.org/en-US/firefox/addon/sqlite-manager/ \"SqliteManager Firefox plugin\").\r\n\r\n### Step 5 ###\r\n\r\nLet\'s now see the structure of the comments table. In Firefox go to :  Tools --> SQLiteManager\r\n\r\n### Step 6 ###\r\n\r\nClick on \'Database\' in the navigation and select \'Connect Database\', browse to `blog/db` folder.\r\n\r\n### Step 7 ###\r\n\r\nChange the file extensions to all files.\r\n\r\n### Step 8 ###\r\n\r\nOpen the development.sqlite3 file. Select the comments table. You can see the foreign key article_id in the comments table. \r\n\r\nYou can also use the rails db command to view the tables, schema and work with database from the command line.\r\n\r\n```sh\r\n$ rails db\r\nSQLite version 3.7.7 2011-06-25 16:35:41\r\nEnter \".help\" for instructions\r\nEnter SQL statements terminated with a \";\"\r\nsqlite> .help\r\nsqlite> .databases\r\nseq  name             file                                                      \r\n---  ---------------  ----------------------------------------------------------\r\n0    main             /Users/zepho/temp/rails5/db/development.sqlite3           \r\nsqlite> .tables\r\narticles           comments           schema_migrations\r\nsqlite> .schema comments\r\nCREATE TABLE \"comments\" (\"id\" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, \"commenter\" varchar, \"description\" text, \"article_id\" integer, \"created_at\" datetime NOT NULL, \"updated_at\" datetime NOT NULL);\r\nCREATE INDEX \"index_comments_on_article_id\" ON \"comments\" (\"article_id\");\r\n```\r\n\r\n### Step 9 ###\r\n\r\nOpen the `app/models/comment.rb` file. You will see the line:\r\n\r\n```ruby\r\nbelongs_to :article\r\n```\r\n\r\ndeclaration. This means you have a foreign key `article_id` in the comments table. The `belongs_to` declaration in the model will not create or manipulate database tables. The `belongs_to` or `references` in the migration will manipulate the database tables. Since your models are not aware of the database relationships, you need to declare them.\r\n\r\n### Step 10 ###\r\n\r\nOpen the `app/models/article.rb` file. Add the following declaration:\r\n\r\n```ruby\r\nhas_many :comments\r\n```\r\n\r\nThis means each article can have many comments. Each comment points to it\'s corresponding article. \r\n\r\n### Step 11 ###\r\n\r\nOpen the `config/routes.rb` and define the route for comments:\r\n\r\n```ruby\r\nresources :articles do\r\n  resources :comments\r\nend\r\n```\r\n\r\nSince we have parent-children relationship between articles and comments we have nested routes for comments.\r\n\r\n### Step 12 ###\r\n\r\nLet\'s create the controller for comments.\r\n\r\n```ruby\r\n$rails g controller comments\r\n```\r\n\r\nReaders can comment on any article. When someone comments we will display the comments for that article on the article\'s show page.\r\n\r\n### Step 13 ###\r\n\r\nLet\'s modify the `app/views/articles/show.html.erb` to let us make a new comment:\r\n\r\n```ruby\r\n<h2>Add a comment:</h2>\r\n<%= form_for([@article, @article.comments.build]) do |f| %>\r\n  <p>\r\n    <%= f.label :commenter %><br />\r\n    <%= f.text_field :commenter %>\r\n  </p>\r\n  <p>\r\n    <%= f.label :description %><br />\r\n    <%= f.text_area :description %>\r\n  </p>\r\n  <p>\r\n    <%= f.submit %>\r\n  </p>\r\n<% end %>\r\n```\r\n\r\nThe `app/views/show.html.erb` file will now look like this:\r\n\r\n```ruby\r\n<p>\r\n  <%= @article.title %><br>\r\n</p>\r\n\r\n<p>\r\n  <%= @article.description %><br>\r\n</p>\r\n\r\n<h2>Add a comment:</h2>\r\n<%= form_for([@article, @article.comments.build]) do |f| %>\r\n  <p>\r\n    <%= f.label :commenter %><br />\r\n    <%= f.text_field :commenter %>\r\n  </p>\r\n  <p>\r\n    <%= f.label :description %><br />\r\n    <%= f.text_area :description %>\r\n  </p>\r\n  <p>\r\n    <%= f.submit %>\r\n  </p>\r\n<% end %>\r\n```\r\n\r\n### Step 14 ###\r\n\r\nGo to `http://localhost:3000/articles` page and click on \'Show\' for one of the article. You will now see the form for filling out the comment for this specific article.\r\n\r\n### Step 15 ###\r\n\r\nView the page source for the article show page by clicking any of the \'Show\' link in the articles index page. You can see the URI pattern and the http method used when someone submits a comment by clicking the \'Create Comment\' button.\r\n\r\n```html\r\n<form class=\"new_comment\" id=\"new_comment\" action=\"/articles/5/comments\" accept-charset=\"UTF-8\" method=\"post\">\r\n```\r\n\r\n## Exercise 1 ##\r\n\r\nTake a look at the output of rake routes and find out the resource endpoint for the URI pattern and http method combination found in step 15.\r\n\r\n### Step 16 ###\r\n\r\nRun rake routes in the blog directory. You can see how the rails router takes the comment submit form to the comments controller, create action.\r\n\r\n```sh\r\nPOST   /articles/:article_id/comments(.:format)          comments#create\r\n```\r\n\r\n### Step 17 ###\r\n\r\nFill out the comment form and click on \'Create Comment\'. You will get a unknown action create for Comments controller error page.\r\n\r\n### Step 18 ###\r\n\r\nDefine the create method in `comments_controller.rb` as follows:\r\n\r\n```ruby\r\ndef create\r\n\r\nend\r\n```\r\n\r\n### Step 19 ###\r\n\r\nFill out the comment form and submit it again. You can see the comment values in the server log.\r\n\r\n```ruby\r\nStarted POST \"/articles/5/comments\" for ::1 at 2015-12-06 15:35:10 -0800\r\nProcessing by CommentsController#create as HTML\r\n  Parameters: {\"utf8\"=>\"✓\", \"authenticity_token\"=>\"zxhxGMjOrL5/zpIfUWN68PjFEStkgAkyztTMcQShrn8r1RL3Iunv6ub9JPHHGSEB2JUXjwbXNrE587h/aaahwg==\", \"comment\"=>{\"commenter\"=>\"bugs\", \"description\"=>\"This is cool\"}, \"commit\"=>\"Create Comment\", \"article_id\"=>\"5\"}\r\nNo template found for CommentsController#create, rendering head :no_content\r\nCompleted 204 No Content in 3ms (ActiveRecord: 0.0ms)\r\n```\r\n\r\n### Step 20 ###\r\n\r\nCopy the entire parameters hash you see from the server log. Go to Rails console and paste it like this:\r\n\r\n```ruby\r\nparams =  {\"comment\"=>{\"commenter\"=>\"test\", \"description\"=>\"tester\"},  \"commit\"=>\"Create Comment\", \"article_id\"=>\"5\"}\r\n```\r\n\r\nHere you initialize the params variable with the hash you copied in the rails server log. You can find the value for comment model by doing: `params[\'comment\']` in the Rails console.\r\n\r\n```ruby\r\n{\"commenter\"=>\"test\", \"description\"=>\"tester\"} \r\n```\r\n\r\nYou can extract the `article_id` from the parameters like this:\r\n\r\n```ruby\r\n > params[\'article_id\']\r\n```\r\n\r\n### Step 21 ###\r\n\r\nLet\'s create a comment for a given article by changing the create action as follows:\r\n\r\n```ruby\r\ndef create\r\n  @article = Article.find(params[:article_id])\r\n  permitted_columns = params[:comment].permit(:commenter, :description)\r\n  @comment = @article.comments.create(permitted_columns)\r\n  \r\n  redirect_to article_path(@article)\r\nend\r\n```\r\n\r\nThe only new thing in the above code is this:\r\n\r\n```ruby\r\n@article.comments.create\r\n```\r\n\r\nSince we have the declaration\r\n\r\n```ruby\r\nhas_many :comments\r\n```\r\n\r\nin the article model. We can navigate from an instance of article to a collection of comments:\r\n\r\n```ruby\r\n@article.comments\r\n```\r\n\r\nWe call the method create on the comments collection like this:\r\n\r\n```ruby\r\n@article.comments.create\r\n```\r\n\r\nThis will automatically populate the foreign key `article_id` in the comments table for us. The `params[:comment]` will retrieve the comment column values.\r\n\r\n### Step 22 ###\r\n\r\nFill out the comment form and submit it.\r\n\r\n```ruby\r\nStarted POST \"/articles/5/comments\" for ::1 at 2015-12-06 15:40:53 -0800\r\nProcessing by CommentsController#create as HTML\r\n  Parameters: {\"utf8\"=>\"✓\", \"authenticity_token\"=>\"OIx2Hx7/lclS0daqtgSfu1QwEz9oh++/cynuU32h13zcQRXw9NjWncviYEQgfsRKdGAVmwrQ0DyEDppdEKbYwQ==\", \"comment\"=>{\"commenter\"=>\"bugs\", \"description\"=>\"cartoon\"}, \"commit\"=>\"Create Comment\", \"article_id\"=>\"5\"}\r\n  Article Load (0.2ms)  SELECT  \"articles\".* FROM \"articles\" WHERE \"articles\".\"id\" = ? LIMIT 1  [[\"id\", 5]]\r\n   (0.1ms)  begin transaction\r\n  SQL (0.4ms)  INSERT INTO \"comments\" (\"commenter\", \"description\", \"article_id\", \"created_at\", \"updated_at\") VALUES (?, ?, ?, ?, ?)  [[\"commenter\", \"bugs\"], [\"description\", \"cartoon\"], [\"article_id\", 5], [\"created_at\", 2015-12-06 23:40:53 UTC], [\"updated_at\", 2015-12-06 23:40:53 UTC]]\r\n   (82.1ms)  commit transaction\r\nRedirected to http://localhost:3000/articles/5\r\nCompleted 302 Found in 89ms (ActiveRecord: 82.8ms)\r\n```\r\n\r\nYou can now view the record in the MySQLite Manager or Rails db console. Let\'s now display the comments made for a article in the articles show page.\r\n\r\n### Step 23 ###\r\n\r\nAdd the following code to the `app/views/articles/show.html.erb`:\r\n\r\n```ruby\r\n<h2>Comments</h2>\r\n<% @article.comments.each do |comment| %>\r\n  <p>\r\n    <strong>Commenter:</strong>\r\n    <%= comment.commenter %>\r\n  </p>\r\n \r\n  <p>\r\n    <strong>Comment:</strong>\r\n    <%= comment.description %>\r\n  </p>\r\n<% end %>\r\n```\r\n\r\nYour `app/views/articles/show.html.erb` will now look like this:\r\n\r\n```ruby\r\n<p>\r\n  <%= @article.title %><br>\r\n</p>\r\n\r\n<p>\r\n  <%= @article.description %><br>\r\n</p>\r\n\r\n<h2>Comments</h2>\r\n<% @article.comments.each do |comment| %>\r\n  <p>\r\n    <strong>Commenter:</strong>\r\n    <%= comment.commenter %>\r\n  </p>\r\n \r\n  <p>\r\n    <strong>Comment:</strong>\r\n    <%= comment.description %>\r\n  </p>\r\n<% end %>\r\n\r\n<h2>Add a comment:</h2>\r\n<%= form_for([@article, @article.comments.build]) do |f| %>\r\n  <p>\r\n    <%= f.label :commenter %><br />\r\n    <%= f.text_field :commenter %>\r\n  </p>\r\n  <p>\r\n    <%= f.label :description %><br />\r\n    <%= f.text_area :description %>\r\n  </p>\r\n  <p>\r\n    <%= f.submit %>\r\n  </p>\r\n<% end %>\r\n```\r\n\r\n### Step 24 ###\r\n\r\nReload the article show page or click on the \'Show\' link for the article with comments by going to the articles index page. You will now see the existing comments for an article.\r\n\r\n## Summary ##\r\n\r\nWe saw how to create parent-child relationship in the database and how to use ActiveRecord declarations in models to handle one to many relationship. We learned about nested routes and how to make forms work in the parent-child relationship. In the next lesson we will implement the feature to delete comments to keep our blog clean from spam.','2015-12-06 23:53:35','2015-12-06 23:57:17'),(2841,'Demystifying the Gem Version Comparison','Comparing Gem Versions in Ruby\r\n========\r\n---------\r\n\r\nI read the [How to compare gem versions in Ruby](https://medium.com/@extendsmymind/how-to-compare-version-strings-in-ruby-ced0916a4b71#.m6qpi1gvq \'How to compare version strings in Ruby\').  Anderson Dias shows us how we can compare using < and > operators. How is this implemented in Ruby gems? I know that comparison is made possible by implementing the <=> method. But where is it in the source code? If you `git clone https://github.com/rubygems/gems.git` you cannot see the implementation for <=>. So let\'s find out where it is defined.\r\n\r\n```ruby\r\n irb\r\n> v = Gem::Version.new(\'2.1.2\')\r\n> v.respond_to?(:<=>)\r\n => true \r\n> v.method(:<=>).source_location\r\n => [\"/Users/bparanj/.rvm/rubies/ruby-2.2.3/lib/ruby/2.2.0/rubygems/version.rb\", 330] \r\n```\r\n\r\nRuby Gems Implementation of <=> Method\r\n========\r\n---------\r\n\r\nOpen the version.rb in your editor and look at line 330:\r\n\r\n```ruby\r\n  ##\r\n  # Compares this version with +other+ returning -1, 0, or 1 if the\r\n  # other version is larger, the same, or smaller than this\r\n  # one. Attempts to compare to something that\'s not a\r\n  # <tt>Gem::Version</tt> return +nil+.\r\n\r\n  def <=> other\r\n    return unless Gem::Version === other\r\n    return 0 if @version == other.version\r\n\r\n    lhsegments = segments\r\n    rhsegments = other.segments\r\n\r\n    lhsize = lhsegments.size\r\n    rhsize = rhsegments.size\r\n    limit  = (lhsize > rhsize ? lhsize : rhsize) - 1\r\n\r\n    i = 0\r\n\r\n    while i <= limit\r\n      lhs, rhs = lhsegments[i] || 0, rhsegments[i] || 0\r\n      i += 1\r\n\r\n      next      if lhs == rhs\r\n      return -1 if String  === lhs && Numeric === rhs\r\n      return  1 if Numeric === lhs && String  === rhs\r\n\r\n      return lhs <=> rhs\r\n    end\r\n\r\n    return 0\r\n  end\r\n```\r\n\r\nYou can see that ruby gems that ships as part of Ruby has the implementation for the <=> method. This is another example of the comparable basic concepts we saw in [Ruby Comparable Basics](https://www.rubyplus.com/articles/2791 \'Ruby Comparable Basics\'). \r\n\r\nSorting Gem Versions\r\n========\r\n---------\r\n\r\nThis allows us to even sort an array of gem versions.\r\n\r\n```ruby\r\n$irb\r\n > v1 = Gem::Version.new(\'1.0\')\r\n => #<Gem::Version \"1.0\"> \r\n > v2 = Gem::Version.new(\'2.0\')\r\n => #<Gem::Version \"2.0\"> \r\n > v15 = Gem::Version.new(\'1.5\')\r\n => #<Gem::Version \"1.5\"> \r\n > list = [v15, v1, v2]\r\n => [#<Gem::Version \"1.5\">, #<Gem::Version \"1.0\">, #<Gem::Version \"2.0\">] \r\n > list.sort\r\n => [#<Gem::Version \"1.0\">, #<Gem::Version \"1.5\">, #<Gem::Version \"2.0\">] \r\n```\r\n\r\nSummary\r\n========\r\n---------\r\n\r\nWe can find the implementation of any given method by using `source_location` method. This is faster than using grep, ack or ag. You learned how the gem comparisons is implemented in ruby gems that comes shipped with Ruby.','2015-12-09 05:33:21','2015-12-10 06:14:54'),(2851,'Rails 5 Basics : Delete Comment','## Objective ##\r\n\r\n- Learn how to work with nested resources\r\n\r\n## Steps ##\r\n\r\n### Step 1 ###\r\n\r\nLet\'s add \'Delete\' link for the comment in `app/views/articles/show.html.erb`. We know the hyperlink text will be \'Delete Comment\', so:\r\n\r\n```ruby\r\n<%= link_to \'Delete Comment\', ? %>\r\n```\r\n\r\nWhat should be URL helper to use in the second parameter?\r\n\r\n### Step 2 ###\r\n\r\nFrom the blog directory run:\r\n\r\n```sh\r\n$rake routes | grep comments\r\n```\r\n\r\nThe output of rake routes:\r\n\r\n```sh\r\n         Prefix 	 Verb   URI Pattern               						  Endpoint	\r\n    article_comments GET    /articles/:article_id/comments(.:format)          comments#index\r\n                     POST   /articles/:article_id/comments(.:format)          comments#create\r\n new_article_comment GET    /articles/:article_id/comments/new(.:format)      comments#new\r\nedit_article_comment GET    /articles/:article_id/comments/:id/edit(.:format) comments#edit\r\n     article_comment GET    /articles/:article_id/comments/:id(.:format)      comments#show\r\n                     PATCH  /articles/:article_id/comments/:id(.:format)      comments#update\r\n                     PUT    /articles/:article_id/comments/:id(.:format)      comments#update\r\n                     DELETE /articles/:article_id/comments/:id(.:format)      comments#destroy\r\n```\r\n\r\nWe are filtering the routes only to the nested routes for comments so that it is easier to read the output in the terminal.\r\n\r\n### Step 3 ###\r\n\r\nThe Prefix column here is blank for the comments controller destroy action. So we go up and look for the very first non blank value in the Prefix column and find the URL helper for delete comment feature. So, we now have:\r\n\r\n```ruby\r\n<%= link_to \'Delete Comment\', article_comment(article, comment) %>\r\n```\r\n\r\nWe need to pass two parameters to the URL helper because in the URI pattern column you can see the :article_id as well as the primary key for comment :id. You already know that Rails is intelligent enough to call the id method on the passed in objects. The order in which you pass the objects is the same order in which it appears in the URI pattern.\r\n\r\n### Step 4 ###\r\n\r\nThere are other URI patterns which are similar to the comments controller destroy action. So we need to do the same thing we did for articles resource. So the link_to now becomes:\r\n\r\n```ruby\r\n<%= link_to \'Delete Comment\', \r\n						article_comment(article, comment), \r\n						method: :delete %>\r\n```\r\n\r\n### Step 5 ###\r\n\r\nThe \'Delete Comment\' is a destructive operation so let\'s add the confirmation popup to the link_to helper.\r\n\r\n```ruby\r\n<%= link_to \'Delete Comment\', \r\n						 article_comment(article, comment), \r\n						 method: :delete,\r\n						 data: { confirm: \'Are you sure?\' } %>									 	 					 \r\n```\r\n\r\nThe `app/views/articles/show.html.erb` now looks as follows:\r\n\r\n```ruby\r\n<p>\r\n  <%= @article.title %><br>\r\n</p>\r\n\r\n<p>\r\n  <%= @article.description %><br>\r\n</p>\r\n\r\n<h2>Comments</h2>\r\n<% @article.comments.each do |comment| %>\r\n  <p>\r\n    <strong>Commenter:</strong>\r\n    <%= comment.commenter %>\r\n  </p>\r\n \r\n  <p>\r\n    <strong>Comment:</strong>\r\n    <%= comment.description %>\r\n  </p>\r\n	\r\n	<%= link_to \'Delete Comment\', \r\n							 article_comment_path(@article, comment), \r\n							 method: :delete,\r\n							 data: { confirm: \'Are you sure?\' } %>	\r\n	\r\n<% end %>\r\n\r\n<h2>Add a comment:</h2>\r\n<%= form_for([@article, @article.comments.build]) do |f| %>\r\n  <p>\r\n    <%= f.label :commenter %><br />\r\n    <%= f.text_field :commenter %>\r\n  </p>\r\n  <p>\r\n    <%= f.label :description %><br />\r\n    <%= f.text_area :description %>\r\n  </p>\r\n  <p>\r\n    <%= f.submit %>\r\n  </p>\r\n<% end %>\r\n```\r\n\r\n### Step 6 ###\r\n\r\nLets implement the destroy action in the `comments_controller.rb` as follows:\r\n\r\n```ruby\r\ndef destroy\r\n  @article = Article.find(params[:article_id])\r\n  @comment = @article.comments.find(params[:id])\r\n  @comment.destroy\r\n  \r\n  redirect_to article_path(@article)\r\nend\r\n```\r\n\r\nWe first find the parent record which in this case is the article. The next step scopes the find for that particular article record due to security. Then we delete the comment by calling the destroy method. Finally we redirect the user to the articles index page similar to the create action.\r\n\r\n### Step 7 ###\r\n\r\nGo to the articles index page by reloading the `http://localhost:3000/articles`. Click on the \'Show\' link for any article that has comments. You will see the \'Delete Comment\' link for every comment of the article. You will get the url error page if you forget to append the `_path` or `_url` to the `article_comment` Prefix.\r\n\r\n```sh\r\nNameError : undefined local variable or method `article\' for #<#<Class:0x007fe>\r\n```\r\n\r\nIf you forget to use the instance variable @article, then you will get the error message.\r\n\r\n```sh\r\nNoMethodError : undefined method `article_comment\' for #<#<Class:0x007fe6>\r\n```\r\n\r\n### Step 8 ###\r\n\r\nClick the \'Delete Comment\' link in the articles show page. The confirmation popup will appear and if you click \'Ok\' the record will be deleted from the database and you will be redirected back to the articles show page.\r\n\r\n```sh\r\nStarted DELETE \"/articles/5/comments/1\" for ::1 at 2015-12-10 19:03:12 -0800\r\nProcessing by CommentsController#destroy as HTML\r\n  Parameters: {\"authenticity_token\"=>\"zKv4eGrsd8D38T7++ToRBJ5kjptyurFYJEdj9Wg/CfEoZpuXgMs0lG7CiBBvQEr1vjSIPxDtjtvTYBf7BTgGTA==\", \"article_id\"=>\"5\", \"id\"=>\"1\"}\r\n  Article Load (0.2ms)  SELECT  \"articles\".* FROM \"articles\" WHERE \"articles\".\"id\" = ? LIMIT 1  [[\"id\", 5]]\r\n  Comment Load (0.1ms)  SELECT  \"comments\".* FROM \"comments\" WHERE \"comments\".\"article_id\" = ? AND \"comments\".\"id\" = ? LIMIT 1  [[\"article_id\", 5], [\"id\", 1]]\r\n   (0.1ms)  begin transaction\r\n  SQL (0.3ms)  DELETE FROM \"comments\" WHERE \"comments\".\"id\" = ?  [[\"id\", 1]]\r\n   (50.3ms)  commit transaction\r\nRedirected to http://localhost:3000/articles/5\r\nCompleted 302 Found in 56ms (ActiveRecord: 51.0ms)\r\n```\r\n\r\n## Exercise 1 ##\r\n\r\nChange the destroy action redirect_to method to use notice that says \'Comment deleted\'. If you are using MySQLite Manager you can click on the \'Refresh\' icon which is the first icon in the top navigation bar to see the comments gets deleted. Refresh icon of Firefox Plugin MySQLite Manager.\r\n\r\n## Exercise 2 ##\r\n\r\nGo to articles index page and delete an article that has comments. Now go to either rails dbconsole or use MySQLite Manager to see if the comments associated with that articles is still in the database.\r\n\r\n### Step 9 ###\r\n\r\nWhen you delete the parent the children do not get deleted automatically. The comment records in our application become useless because they are specific to a given article. In order to delete them when the parent gets deleted we need to change the Article ActiveRecord sub-class like this :\r\n\r\n```ruby\r\nclass Article < ActiveRecord::Base\r\n  has_many :comments, dependent: :destroy\r\nend\r\n```\r\n\r\nNow if you delete the parent that has comments, all the comments associated with it will also be deleted. So you will not waste space in the database by retaining records that are no longer needed.\r\n\r\n### Step 10 ###\r\n\r\nThe polymorphic_path method will throw an error when two arguments are passed. \r\n\r\n```ruby\r\napp.polymorphic_url(a, c)\r\nArgumentError: wrong number of arguments (1 for 0)\r\n```\r\n\r\nRails internally uses polymorphic_path method with an array containing the parent and child objects to generate the url helper. Change the second parameter, url helper to :\r\n\r\n```ruby\r\n[@article, comment]\r\n```\r\n\r\nThe link_to will now look like this:\r\n\r\n```ruby\r\n<%= link_to \'Delete Comment\', \r\n						 [@article, comment], \r\n						 method: :delete,\r\n						 data: { confirm: \'Are you sure?\' } %>	\r\n```\r\n\r\nThe delete functionality will still work. Since Rails allows passing the parent and child instances in an array instead of using the Prefix.\r\n\r\n```ruby\r\na = Article.first\r\nc = a.comments.first\r\napp.polymorphic_url([a, c])\r\n => \"http://www.example.com/articles/4/comments/4\" \r\n```\r\n \r\nYou can learn more about the polymorphic_url by reading the Rails source code. Go to Rails console to find out where it is implemented.\r\n\r\n```ruby\r\n > app.respond_to?(:polymorphic_url)\r\n => true \r\n > app.method(:polymorphic_url).source_location\r\n => [\"/Users/zepho/.rvm/gems/ruby-2.2.3@r5blog/bundler/gems/rails-153d7ca630d1/actionpack/lib/action_dispatch/routing/polymorphic_routes.rb\", 99] \r\n ```\r\n\r\nOpen the polymorphic_routes.rb and look at line 99 in your editor:\r\n\r\n```ruby\r\n module PolymorphicRoutes\r\n   # Constructs a call to a named RESTful route for the given record and returns the\r\n   # resulting URL string. For example:\r\n   #\r\n   #   # calls post_url(post)\r\n   #   polymorphic_url(post) # => \"http://example.com/posts/1\"\r\n   #   polymorphic_url([blog, post]) # => \"http://example.com/blogs/1/posts/1\"\r\n   #   polymorphic_url([:admin, blog, post]) # => \"http://example.com/admin/blogs/1/posts/1\"\r\n   #   polymorphic_url([user, :blog, post]) # => \"http://example.com/users/1/blog/posts/1\"\r\n   #   polymorphic_url(Comment) # => \"http://example.com/comments\"\r\n   #\r\n   # ==== Options\r\n   #\r\n   # * <tt>:action</tt> - Specifies the action prefix for the named route:\r\n   #   <tt>:new</tt> or <tt>:edit</tt>. Default is no prefix.\r\n   # * <tt>:routing_type</tt> - Allowed values are <tt>:path</tt> or <tt>:url</tt>.\r\n   #   Default is <tt>:url</tt>.\r\n   #\r\n   # Also includes all the options from <tt>url_for</tt>. These include such\r\n   # things as <tt>:anchor</tt> or <tt>:trailing_slash</tt>. Example usage\r\n   # is given below:\r\n   #\r\n   #   polymorphic_url([blog, post], anchor: \'my_anchor\')\r\n   #     # => \"http://example.com/blogs/1/posts/1#my_anchor\"\r\n   #   polymorphic_url([blog, post], anchor: \'my_anchor\', script_name: \"/my_app\")\r\n   #     # => \"http://example.com/my_app/blogs/1/posts/1#my_anchor\"\r\n   #\r\n   # For all of these options, see the documentation for <tt>url_for</tt>.\r\n   #\r\n   # ==== Functionality\r\n   #\r\n   #   # an Article record\r\n   #   polymorphic_url(record)  # same as article_url(record)\r\n   #\r\n   #   # a Comment record\r\n   #   polymorphic_url(record)  # same as comment_url(record)\r\n   #\r\n   #   # it recognizes new records and maps to the collection\r\n   #   record = Comment.new\r\n   #   polymorphic_url(record)  # same as comments_url()\r\n   #\r\n   #   # the class of a record will also map to the collection\r\n   #   polymorphic_url(Comment) # same as comments_url()\r\n   #\r\n   def polymorphic_url(record_or_hash_or_array, options = {})\r\n     if Hash === record_or_hash_or_array\r\n       options = record_or_hash_or_array.merge(options)\r\n       record  = options.delete :id\r\n       return polymorphic_url record, options\r\n     end\r\n\r\n     opts   = options.dup\r\n     action = opts.delete :action\r\n     type   = opts.delete(:routing_type) || :url\r\n\r\n     HelperMethodBuilder.polymorphic_method self,\r\n                                            record_or_hash_or_array,\r\n                                            action,\r\n                                            type,\r\n                                            opts\r\n   end\r\n ```\r\n\r\n## Summary ##\r\n\r\nIn this lesson we learned about nested routes and how to deal with deleting records which has children. The current implementation allows anyone to delete records. In the next lesson we will restrict the delete functionality only to blog owner.\r\n','2015-12-11 03:29:03','2015-12-11 03:45:04'),(2861,'Rails 5 Basics : Restricting Operations','## Objective ##\r\n\r\n- To learn how to use simple HTTP authentication to restrict access to actions\r\n\r\n## Steps ##\r\n\r\n### Step 1 ###\r\n\r\nAdd the following code to the top of the `articles_controller.rb`:\r\n\r\n```ruby\r\nclass ArticlesController < ApplicationController\r\n  \r\n  http_basic_authenticate_with name: \'welcome\', \r\n  password: \'secret\', \r\n  except: [:index, :show]\r\n\r\n  <!-- actions such as index, new etc omitted here -->\r\nend\r\n```\r\n\r\nThis declaration protects the creating, editing and deleting functionality. Read only operations such as show and index are not protected.\r\n\r\n### Step 2 ###\r\n\r\nReload the articles index page : `http://localhost:3000/articles`. \r\n\r\n### Step 3 ###\r\n\r\nClick \'Delete\' for any of the article.  You will see popup for authentication.\r\n\r\n### Step 4 ###\r\n\r\nFor user name, enter welcome and for password enter secret. Click \'Login\'. Now the record will be deleted.\r\n\r\n## Exercise 1 ##\r\n\r\nUse http basic authentication to protect deleting comments in the articles show page.\r\n\r\n## Summary ##\r\n\r\nThis completes our quick tour of Rails 5. If you have developed the blog application following the 12 lessons you will now have a strong foundation to build upon by reading other Rails books to continue your journey to master the Rails framework. Good luck.\r\n','2015-12-11 18:08:52','2015-12-11 18:08:52'),(2871,'Dealing with Common Capybara Feature Test Failures','Objective\r\n=========\r\n---------\r\n\r\nTo learn how to workaround some common Capybara test failures and how to minimize the wait time for pdf file to load on the web browser using RSpec 3.2.2 and Rails 4.2.5.\r\n\r\nSteps\r\n=========\r\n---------\r\n\r\nStep 1\r\n---------\r\n\r\nCreate a file for your custom helper in `spec/support/wait_for_pdf_load.rb`. For my project I have:\r\n\r\n```ruby\r\nmodule WaitForPdfLoad\r\n  def have_loaded_pdf\r\n    Timeout.timeout(10) do\r\n      pdf_loaded?\r\n    end\r\n  end\r\n  \r\n  private\r\n  \r\n  def pdf_loaded?\r\n    have_content(\'Automatic\')\r\n  end\r\nend\r\n```\r\n\r\nStep 2 \r\n---------\r\n\r\nIn `spec/rails_helper.rb`, configure RSpec to include your new helper:\r\n\r\n\r\n```ruby\r\nRSpec.configure do |config|\r\n  config.include WaitForPdfLoad, type: :feature\r\nend\r\n```\r\n\r\nStep 3\r\n---------\r\n\r\n#### Before\r\n\r\nThe test with hard-coded sleep method was an ugly workaround for the page to load the pdf file.\r\n\r\n```ruby\r\nfeature \'Download a product\' do\r\n  before(:each) do\r\n    Fabricate(:product)\r\n  end\r\n  \r\n  scenario \'Purchase, Register and Download\', js: true do\r\n    checkout_product\r\n    make_payment(\'4242424242424242\')\r\n\r\n    register_after_guest_checkout(test_email, \'12345678\')\r\n    \r\n    click_link \'Download\'\r\n    sleep 5\r\n  \r\n    expect(page).to have_content(\'Automatic\')\r\n  end\r\nend\r\n```\r\n\r\n#### After\r\n\r\nIn the test, use can now use the new helper like this:\r\n\r\n```ruby\r\nfeature \'Download a product\' do\r\n  before(:each) do\r\n    Fabricate(:product)\r\n  end\r\n  \r\n  scenario \'Purchase, Register and Download\', js: true do\r\n    checkout_product\r\n    make_payment(\'4242424242424242\')\r\n\r\n    register_after_guest_checkout(test_email, \'12345678\')\r\n    \r\n    click_link \'Download\'\r\n        \r\n    expect(page).to have_loaded_pdf\r\n  end\r\nend\r\n```\r\n\r\nBesides reducing the amount of time spent in waiting, this new helper also raises the level of abstraction.\r\n\r\nWait Until the Page Loads\r\n=========\r\n---------\r\n\r\nSometimes the feature tests fail due the link not present, in such cases you can create a `wait_until` helper like this:\r\n\r\n```ruby\r\nmodule WaitForPageLoad\r\n  \r\n  def wait_until\r\n    Timeout.timeout(10) do\r\n      sleep(0.1) until value = yield\r\n      value\r\n    end\r\n  end\r\n    \r\nend\r\n```\r\n\r\nin `spec/support/wait_for_page_load.rb`.  You can now use in your test like this:\r\n\r\n```ruby\r\nrequire \'rails_helper\'\r\nrequire \'spec_helper\'\r\n\r\nfeature \'Download a product\' do\r\n  before(:each) do\r\n    Fabricate(:product)\r\n  end\r\n  \r\n  # Register, Checkout, One-Click Checkout\r\n  scenario \'register, checkout, one-click and download\', js: true do\r\n\r\n    # 1. Register\r\n    sign_up(\'test@example.com\', \'12345678\')\r\n\r\n    # 2. Checkout\r\n    checkout_product\r\n    make_payment(\'4242424242424242\')\r\n\r\n    # 3. One-click checkout.\r\n    checkout_product\r\n    \r\n    wait_until do\r\n      expect(page).to have_content(\'Rails 4 Quickly\')\r\n    end\r\n    \r\n    click_link \'Rails 4 Quickly\'\r\n    \r\n    expect(page).to have_loaded_pdf\r\n  end\r\n\r\nend\r\n```\r\n\r\nIn this example the test was failing in the `click_link` Rails 4 Quickly step because the page was not loaded. So we wait for the `Rails 4 Quickly` link to appear before we click that link. You can also define a helper called `click_link_after_page_load` like this:\r\n\r\n```ruby\r\nmodule WaitForPageLoad\r\n  \r\n  def wait_until\r\n    Timeout.timeout(10) do\r\n      sleep(0.1) until value = yield\r\n      value\r\n    end\r\n  end\r\n  \r\n  def click_link_after_page_load(link_text)\r\n    wait_until do\r\n      expect(page).to have_content(link_text)\r\n    end\r\n    \r\n    click_link link_text\r\n  end  \r\nend\r\n```\r\n\r\nAdd this helper to the configure block in `spec/rails_helper.rb`:\r\n\r\n```ruby\r\nconfig.include WaitForPageLoad, type: :feature\r\n```\r\n\r\nNow the test becomes:\r\n\r\n```ruby\r\n  # Register, Checkout, One-Click Checkout\r\n  scenario \'register, checkout, one-click and download\', js: true do\r\n\r\n    # 1. Register\r\n    sign_up(\'test@example.com\', \'12345678\')\r\n\r\n    # 2. Checkout\r\n    checkout_product\r\n    make_payment(\'4242424242424242\')\r\n\r\n    # 3. One-click checkout.\r\n    checkout_product\r\n        \r\n    click_link_after_page_load(\'Rails 4 Quickly\') \r\n    \r\n    expect(page).to have_loaded_pdf\r\n  end\r\n```\r\n\r\nWorkaround for StaleElementReferenceError\r\n=========\r\n---------\r\n\r\nSome of the feature tests might fail with `StaleElementReferenceError` exception. You can simply catch the exception and retry like this:\r\n\r\n```ruby\r\nrequire \'rails_helper\'\r\nrequire \'spec_helper\'\r\n\r\nfeature \'My orders\' do\r\n  before(:each) do\r\n    Fabricate(:product)\r\n  end\r\n \r\n  # Guest Checkout, Register, View Orders\r\n  scenario \'Complete purchase of one product, register and view orders\', js: true do\r\n    visit products_path\r\n\r\n    checkout_product\r\n    \r\n    begin\r\n      make_payment(\'4242424242424242\')\r\n    \r\n      register_after_guest_checkout(test_email, \'12345678\')\r\n    \r\n      click_link \'My Orders\'\r\n    \r\n      expect(page).to have_content(\'Rails 4 Quickly\')\r\n    rescue Selenium::WebDriver::Error::StaleElementReferenceError\r\n      sleep 1\r\n      retry\r\n    end\r\n  end\r\n\r\nend\r\n```\r\n\r\nIn my case this test was only failing when the entire test suite was run. It was passing when it was run separately.\r\n\r\nSample Project\r\n=========\r\n-----------\r\n\r\nAs I gradually replaced the sleep calls with the wait_until utility, I observed gradual decrease in the time it took to run the tests.\r\n\r\n```sh\r\nFinished in 4 minutes 9.8 seconds (files took 3.17 seconds to load)\r\nFinished in 3 minutes 43.4 seconds (files took 3.45 seconds to load)\r\nFinished in 3 minutes 19.3 seconds (files took 3.14 seconds to load)\r\nFinished in 3 minutes 15.8 seconds (files took 3.12 seconds to load)\r\nFinished in 3 minutes 2.8 seconds (files took 3.23 seconds to load)\r\n```\r\n\r\nYou can download the sample Rails 4.2.5 project that uses RSpec 3.4, Capybara 2.5 and Devise 3.5.3 here [Striped Rails App](https://bitbucket.org/bparanj/striped \'Stripe with Rails 4.2.5\') \r\n\r\nSummary\r\n=========\r\n-----------\r\n\r\nYou can get rid of hard-coded sleep method in your tests to speed it up by waiting only for the required amount of time to give the test a chance to pass. Since I knew the amount of timeout I was using before, I used a value larger than that so that it will pass when all the feature tests are run. We also saw some workaround for common problems in feature tests.','2015-12-11 20:16:43','2015-12-12 22:54:24'),(2881,'Tips for Upgrading Rails 3.2 to Rails 4.2.5','Objective\r\n=========\r\n---------\r\n\r\nTo learn some tips to speed up upgrading Rails 3.2 to 4.2.5\r\n\r\nCan\'t verify CSRF token authenticity\r\n=========\r\n---------\r\n\r\nAdd CSRF Token for Ajax calls by adding `csrf_meta_tags` to the view or the layout file if it is applicable to all views.\r\n\r\n```ruby\r\n<%= csrf_meta_tags %>\r\n```\r\n\r\nMy layout file looks like this:\r\n\r\n```ruby\r\n<!DOCTYPE html>\r\n<html lang=\"en\">\r\n<head>\r\n  <meta charset=\"utf-8\">\r\n  <meta http-equiv=\"X-UA-Compatible\" content=\"IE=edge\">\r\n  <meta name=\"viewport\" content=\"width=device-width, initial-scale=1\">\r\n  \r\n  <title>Ruby Plus</title>\r\n  <%= stylesheet_link_tag    \"application\", media: \"all\", \"data-turbolinks-track\" => true %>\r\n  <%= javascript_include_tag \"application\", \"data-turbolinks-track\" => true %>\r\n    \r\n  <%= csrf_meta_tags %>  \r\n  \r\n</head>\r\n<body>\r\n \r\n \r\n</body>\r\n</html>\r\n```\r\n\r\nGrab the `csrf-token` from the meta tag and set the `X-CSRF-TOKEN` value in the javascript as follows:\r\n\r\n```javascript\r\n$.ajaxSetup({\r\n  headers: {\r\n    \'X-CSRF-Token\': $(\'meta[name=\"csrf-token\"]\').attr(\'content\')\r\n  }\r\n});\r\n```\r\n\r\nThis must be done before any AJAX calls are made in the views.\r\n\r\nProtect From Forgery\r\n=========\r\n---------\r\n\r\nUpdate the application controller:\r\n\r\n```ruby\r\n# Prevent CSRF attacks by raising an exception.\r\n# For APIs, you may want to use :null_session instead.\r\n  protect_from_forgery with: :exception\r\n```\r\n\r\nTo turn off authenticity token check for any controller, do this.\r\n\r\n```ruby\r\nskip_before_action :verify_authenticity_token\r\n```\r\n\r\nAdd \r\n\r\n```ruby\r\nprotect_from_forgery :null_session \r\n```\r\n\r\nfor API \r\n\r\nRename Partial Names with Hyphens\r\n=========\r\n---------\r\n\r\nReplace any hyphen in the partial name with underscore. To find all files that have hyphen in the file names:\r\n\r\n```sh\r\nfind app/views -name \"*-*\" -print\r\n```\r\n\r\nOnce you find the views that have hyphens in it\'s name, we need to find the references to these files in other files, for instance rendering partials from other views. We need to change them to the new partial name. You can use `ag` which is faster than `ack` or `grep`. To install `ag` on a Mac:\r\n\r\n```sh\r\nbrew install the_silver_searcher\r\n```\r\n\r\nFind references to partial that use hyphen it its name:\r\n\r\n```sh\r\nag -w my-partial\r\n```\r\n\r\nHere the my-partial is the partial we found using the find command. We are now going to replace the my-partial to my_partial. Note: ag has no filter to exclude directories at this time. There is a ticket open for this feature. So let\'s use ack to exclude multiple directories from the search using ack:\r\n\r\n```sh\r\nack -w \'my-partial\' --ignore-dir={app/assets,log}\r\n```\r\n\r\nThis gives file name as well as the line number where the match is found. To list only the file so that you can pipe it to your editor, use `-l` switch:\r\n\r\n```sh\r\nack -l -w \'my-partial\' --ignore-dir={app/assets,log} \r\n```\r\n\r\n```sh\r\nack -l -w \'my-partial\' --ignore-dir={app/assets,log} | xargs mate\r\n```\r\n\r\nYou can now go to that line and rename the partial to have underscore instead of hyphen. We don\'t have to do this manually, we can use `sed` for this task, so instead of piping to `xargs` we would pipe it `sed` for substituting the old term to the new term. This might be a better option if there were multiple occurrences. Since the partial is mostly included once in a file, we can just edit it in our editor manually.\r\n\r\nRename SCSS Files\r\n=========\r\n---------\r\n\r\nRename css.scss files to .scss. Here is a script to do that:\r\n\r\n```sh\r\n#! /usr/bin/env bash\r\n\r\nfor f in $(find . -type f -iname \'*.css.scss\'); do\r\n  renamed=$(echo \"${f}\" | sed \'s/.css.scss$/.scss/g\')\r\n  cmd=\"git mv ${f} ${renamed}\"\r\n  echo $cmd\r\n  eval $cmd\r\ndone\r\n```\r\n\r\nYou can also use `rename` utility. To install:\r\n\r\n```sh\r\nbrew install rename\r\n```\r\n\r\nTo rename using it:\r\n\r\n```sh\r\nrename \"s/\\.css.scss/\\.scss/\" *.scss\r\n```\r\n\r\nRoute Changes\r\n=========\r\n---------\r\n\r\nChange routes.rb:\r\n\r\n```ruby\r\nRails.application.routes.draw do\r\n # All routes go inside this block\r\n\r\nend\r\n```\r\n\r\nAny routes that uses match with GET must be changed. Change:\r\n\r\n```ruby\r\nmatch \'something\', via: :get\r\n```\r\n\r\nto:\r\n\r\n```ruby\r\nget \'something\'\r\n```\r\n\r\ndevelopment.rb, test.rb and production.rb\r\n========\r\n---------\r\n\r\nReplace:\r\n\r\n```ruby\r\nconfig.serve_static_assets = true\r\n```\r\n\r\nwith:\r\n\r\n```ruby\r\nconfig.serve_static_files = true\r\n```\r\n\r\nSet the eager_load:\r\n\r\n```ruby\r\nconfig.eager_load = false \r\n```\r\n\r\nfor test and development, true for production.\r\n\r\nRakefile Changes\r\n========\r\n---------\r\n\r\nRakefile must be as follows:\r\n\r\n```ruby\r\n# Add your own tasks in files placed in lib/tasks ending in .rake,\r\n# for example lib/tasks/capistrano.rake, and they will automatically be available to Rake.\r\n\r\nrequire File.expand_path(\'../config/application\', __FILE__)\r\n\r\nRails.application.load_tasks\r\n```\r\n\r\nActionMailer\r\n========\r\n---------\r\n\r\nChange `deliver` to `deliver_now` or `deliver_later`. So instead of doing:\r\n\r\n```ruby\r\nUserMailer.welcome_email(@user).deliver\r\n```\r\n\r\nDo this:\r\n\r\n```ruby\r\nUserMailer.welcome_email(@user).deliver_now\r\n```\r\n\r\nsecrets.yml File\r\n========\r\n---------\r\n\r\nYou can generate `secret_key_base` using:\r\n\r\n```sh\r\nrake secret\r\n```\r\n\r\nYou can hard code the values for development and test. Use environment variable for the production. Here is a sample file:\r\n\r\n```ruby\r\ndevelopment:\r\n  secret_key_base: some-very-long-string-generated-using-rake-secret-command\r\n\r\ntest:\r\n  secret_key_base: some-very-long-string-generated-using-rake-secret-command\r\n  \r\n# Do not keep production secrets in the repository,\r\n# instead read values from the environment.\r\nproduction:\r\n  secret_key_base: <%= ENV[\"SECRET_KEY_BASE\"] %>\r\n```  \r\n\r\nDelete config/initializers/secret_token.rb file. \r\n\r\nconfig/boot.rb\r\n========\r\n---------\r\n\r\nThe `config/boot.rb` file should look like this:\r\n\r\n```ruby\r\nENV[\'BUNDLE_GEMFILE\'] ||= File.expand_path(\'../../Gemfile\', __FILE__)\r\n\r\nrequire \'bundler/setup\' # Set up gems listed in the Gemfile.\r\n```\r\n\r\nbin/rake\r\n========\r\n---------\r\n\r\nThe `bin/rake` file should look like this:\r\n\r\n```ruby\r\n#!/usr/bin/env ruby\r\nrequire_relative \'../config/boot\'\r\nrequire \'rake\'\r\nRake.application.run\r\n```\r\n\r\nbin/bundle\r\n========\r\n---------\r\n\r\nThe `bin/bundle` file should look like this:\r\n\r\n```ruby\r\n#!/usr/bin/env ruby\r\nENV[\'BUNDLE_GEMFILE\'] ||= File.expand_path(\'../../Gemfile\', __FILE__)\r\nload Gem.bin_path(\'bundler\', \'bundle\')\r\n```\r\n\r\nconfig/environment.rb\r\n========\r\n---------\r\n\r\nThe `config/environment.rb` file should look like this:\r\n\r\n```ruby\r\n# Load the Rails application.\r\nrequire File.expand_path(\'../application\', __FILE__)\r\n\r\n# Initialize the Rails application.\r\nRails.application.initialize!\r\n```\r\n\r\nconfig/initializers/session_store.rb\r\n========\r\n---------\r\n\r\nInstead of:\r\n\r\n```ruby\r\nYourWebapp::Application.config.session_store :cookie_store, key: \'_your-webapp_session\'\r\n```\r\n\r\nYou will now have:\r\n\r\n```ruby\r\nRails.application.config.session_store :cookie_store, key: \'_your-webapp_session\'\r\n```\r\nconfig.ru\r\n========\r\n---------\r\n\r\nThe config.ru file should look like this:\r\n\r\n```ruby\r\n# This file is used by Rack-based servers to start the application.\r\n\r\nrequire ::File.expand_path(\'../config/environment\',  __FILE__)\r\nrun Rails.application\r\n```\r\n\r\nAssets Group\r\n========\r\n---------\r\n\r\nGet rid of `group :assets` in Gemfile. All gems underneath that group will not be in any group. Just move them to the top level.\r\n\r\nconfig/initializers/mime_types.rb\r\n========\r\n---------\r\n\r\nSet the mime-types in `config/initializers/mime_types.rb`:\r\n\r\n```ruby\r\n# Be sure to restart your server when you modify this file.\r\n\r\n# Add new mime types for use in respond_to blocks:\r\n# Mime::Type.register \"text/richtext\", :rtf\r\n```\r\n\r\nActive Record Deprecated Dynamic Finders\r\n========\r\n---------\r\n\r\nTo migrate dynamic finders to Rails 4.2+:\r\n\r\n```ruby\r\nfind_all_by_... should become where(...).\r\nfind_last_by_... should become where(...).last.\r\nscoped_by_... should become where(...).\r\nfind_or_initialize_by_... should become find_or_initialize_by(...).\r\nfind_or_create_by_... should become find_or_create_by(...).\r\n```\r\n\r\nForcing a Join in ActiveRecord\r\n========\r\n---------\r\n\r\nAny ActiveRecord queries that uses `:includes` should now add `:references` to force the join.\r\n\r\nHistory of a File\r\n========\r\n---------\r\n\r\n```sh\r\ngitk app/controllers/articles_controller.rb\r\n```\r\n\r\nBrowse through the entire history of a particular file to learn about the why things are the way they are today.\r\n\r\nSummary\r\n========\r\n---------\r\n\r\nIn this article, we saw some of the things that you need to do to upgrade your Rails app from 3.2 to 4.2.5. This is not an exhaustive list. But is a very useful checklist to make sure that you have not missed anything during the upgrade process.\r\n\r\nReferences\r\n========\r\n---------\r\n\r\n[Active Record Deprecated Dynamic Finders](\'https://github.com/rails/activerecord-deprecated_finders\' \'Active Record Deprecated Dynamic Finders\')\r\n','2015-12-12 19:02:11','2016-01-09 04:18:10'),(2891,'Upgrading Server Ruby to 2.2.4 on Linode using Moonshine','Objective\r\n=========\r\n---------\r\n\r\nTo learn how to upgrade ruby to the latest version on your VPS using Moonshine.\r\n\r\nSteps\r\n=========\r\n---------\r\n\r\nStep 1\r\n--------\r\n\r\nIn config/deploy.rb, define your custom Capistrano recipe to install Ruby 2.2.4:\r\n\r\n```ruby\r\nnamespace :ruby do\r\n  task :src224 do\r\n    remove_ruby_from_apt\r\n    libyaml.install\r\n    pv = \"2.2.4\"\r\n    p = \"ruby-#{pv}\"\r\n    run [\r\n      \'cd /tmp\',\r\n      \"sudo rm -rf #{p}* || true\",\r\n      \'sudo rm -rf /usr/lib/ruby/gems/1.8 || true\',\r\n      \'sudo rm -rf /usr/lib/ruby/gems/1.9.1 || true\',\r\n      \'sudo rm -rf /usr/lib/ruby/gems/2.0.0 || true\',\r\n      \'sudo rm -rf /usr/lib/ruby/gems/2.1.0 || true\',\r\n      \'sudo mkdir -p /usr/lib/ruby/gems/2.2.0/gems || true\',\r\n      \"wget -q http://cache.ruby-lang.org/pub/ruby/2.2/#{p}.tar.gz\",\r\n      \"tar xzf #{p}.tar.gz\",\r\n      \"cd /tmp/#{p}\",\r\n      \'./configure --prefix=/usr\',\r\n      \'make\',\r\n      \'sudo make install\'\r\n    ].join(\' && \')\r\n    set :rubygems_version, fetch(:rubygems_version, \'2.4.8\')\r\n    set :bundler_version, fetch(:bundler_version, \'1.11.2\')\r\n  end\r\nend\r\n```\r\n\r\nStep 2\r\n-------\r\n\r\nIn config/moonshine.yml, specify ruby 2.2.4 recipe like this:\r\n\r\n```ruby\r\n:ruby: src224\r\n```\r\n\r\nStep 3\r\n--------\r\n\r\nCommit these code changes to your git repo. Run :\r\n\r\n```sh\r\ncap ruby:upgrade\r\n```\r\n\r\nor \r\n\r\n```sh\r\ncap production ruby:upgrade\r\n```\r\n\r\nif you have setup different environments. If you get:\r\n\r\n```sh\r\nThe gems installed with bundler have been removed.\r\nYou must perform a deploy to reinstall these gems with \'bundle install\'.\r\n```\r\n\r\nJust add a comment to readme or some other file to force bundle install when you do a deploy to re-install the required gems. You can verify that your server is running Ruby 2.2.4 by going to rails console on the server and doing:\r\n\r\n```\r\n$ rails c production\r\nLoading production environment (Rails 4.2.5)\r\nirb(main):001:0> RUBY_VERSION\r\n=> \"2.2.4\"\r\n```\r\n\r\nThat\'s it. Enjoy!\r\n\r\nSummary\r\n========\r\n---------\r\n\r\nUpgrading Ruby on any VPS server is easy if you are using Moonshine to deploy your apps. Last time when I upgraded I edited the code in vendor/plugins. You don\'t have to do that. You can write your own custom Capistrano recipe to upgrade Ruby to any version you like.\r\n\r\nReferences\r\n========\r\n---------\r\n\r\n[Upgrading Ruby with Moonshine](https://github.com/railsmachine/moonshine/wiki/Upgrading-Ruby-with-Moonshine \'Upgrading Ruby with Moonshine\')','2015-12-18 05:19:30','2015-12-18 05:21:19'),(2901,'Upgrading Server Ruby to 2.3.0 on VPS using Moonshine','Objective\r\n=========\r\n---------\r\n\r\nTo learn how to upgrade ruby to the latest version on your VPS using Moonshine.\r\n\r\nSteps\r\n=========\r\n---------\r\n\r\nStep 1\r\n--------\r\n\r\nIn config/deploy.rb, define your custom Capistrano recipe to install Ruby 2.3.0:\r\n\r\n```ruby\r\nnamespace :ruby do\r\n  task :src230 do\r\n    remove_ruby_from_apt\r\n    libyaml.install\r\n    pv = \"2.3.0\"\r\n    p = \"ruby-#{pv}\"\r\n    run [\r\n      \'cd /tmp\',\r\n      \"sudo rm -rf #{p}* || true\",\r\n      \'sudo rm -rf /usr/lib/ruby/gems/1.8 || true\',\r\n      \'sudo rm -rf /usr/lib/ruby/gems/1.9.1 || true\',\r\n      \'sudo rm -rf /usr/lib/ruby/gems/2.0.0 || true\',\r\n      \'sudo rm -rf /usr/lib/ruby/gems/2.1.0 || true\',\r\n      \'sudo mkdir -p /usr/lib/ruby/gems/2.2.0/gems || true\',\r\n      \"wget -q http://cache.ruby-lang.org/pub/ruby/2.3/#{p}.tar.gz\",\r\n      \"tar xzf #{p}.tar.gz\",\r\n      \"cd /tmp/#{p}\",\r\n      \'./configure --prefix=/usr\',\r\n      \'make\',\r\n      \'sudo make install\'\r\n    ].join(\' && \')\r\n    set :rubygems_version, fetch(:rubygems_version, \'2.5.1\')\r\n    set :bundler_version, fetch(:bundler_version, \'1.11.2\')\r\n  end\r\nend\r\n```\r\n\r\nStep 2\r\n-------\r\n\r\nIn config/moonshine.yml, specify ruby 2.3.0 recipe like this:\r\n\r\n```ruby\r\n:ruby: src230\r\n```\r\n\r\nStep 3\r\n--------\r\n\r\nRun :\r\n\r\n```sh\r\ncap ruby:upgrade\r\n```\r\n\r\nor \r\n\r\n```sh\r\ncap production ruby:upgrade\r\n```\r\n\r\nif you have setup different environments. \r\n\r\n\r\nThe installation will hang at:\r\n\r\n```sh\r\n ** [out :: rp] rake\'s executable \"rake\" conflicts with /usr/bin/rake\r\n ** [out :: rp] Overwrite the executable? [yN]\r\n```\r\n\r\nSince Moonshine is not able to say `y` during the installation, the workaround is to delete rake in user/bin manually.\r\n\r\n```sh\r\nrails@li552-13:/usr/bin$ ll rake\r\n-rwxr-xr-x 1 root root 1240 Jul 10  2014 rake*\r\nrails@li552-13:/usr/bin$ rm -rf rake\r\nrm: cannot remove `rake\': Permission denied\r\nrails@li552-13:/usr/bin$ sudo rm -rf rake\r\nrails@li552-13:/usr/bin$ ll rake\r\nls: cannot access rake: No such file or directory\r\n```\r\n\r\nRun upgrade cap task again. You can verify that your server is running Ruby 2.3 by going to rails console on the server and doing:\r\n\r\n```\r\n$ rails c production\r\nLoading production environment (Rails 4.2.5)\r\nirb(main):001:0> RUBY_VERSION\r\n=> \"2.3.0\"\r\n```\r\n\r\nThat\'s it. Enjoy!\r\n\r\nSummary\r\n========\r\n---------\r\n\r\nUpgrading Ruby on any VPS server is easy if you are using Moonshine to deploy your apps. You can write your own custom Capistrano recipe to upgrade Ruby on the same day the new version is released.','2015-12-26 02:56:01','2015-12-26 02:58:27'),(2911,'Color Blind Test your Web Application','Discussion\r\n==========\r\n----------\r\n\r\nDid you know that about 8% of the male population is color blind? Why eliminate that much of a potential market for your Web apps? \r\n\r\nSteps\r\n=====\r\n\r\nStep 1\r\n------\r\n\r\nSEE Chrome plugin allows you to see what your website looks like to a color blind person. Install it.\r\n\r\n<img src=\"https://3.bp.blogspot.com/-cSQqVe1SqDY/VobDaYWx2YI/AAAAAAAAA_M/q_KyhTdwHwQ/s1600/color-blind6.png\" alt=\"SEE Chrom Plugin\" width=489 height=297 />\r\n\r\nStep 2\r\n--------\r\n\r\nChange the different settings for the Color blindness to test different pages on your site.\r\n\r\n<img src=\"https://2.bp.blogspot.com/-N0kZ1K9a86s/VobDaEQBp4I/AAAAAAAAA-8/eUSv6dKkgBk/s1600/color-blind5.png\" alt=\"Ruby Plus\" style=\"border: 1px solid #000; max-width:700px; max-height:600px;\"/>\r\n\r\nTest Protanomaly\r\n\r\n<img src=\"https://3.bp.blogspot.com/-fyG9EJiWSfU/VobDaIa2_YI/AAAAAAAAA-w/vi0DNCnb8i4/s1600/color-blind4.png\" alt=\"Ruby Plus\"  style=\"border: 1px solid #000; max-width:700px; max-height:600px;\"/>\r\n\r\nTest Deuteranomaly\r\n\r\n<img src=\"https://4.bp.blogspot.com/-OFj3kz_oBX8/VobDaBNLywI/AAAAAAAAA_A/wpz_d2bOMU8/s1600/color-blind3.png\" alt=\"Ruby Plus\" style=\"border: 1px solid #000; max-width:700px; max-height:600px;\" />\r\n\r\nTest Tritanomaly\r\n\r\n<img src=\"https://3.bp.blogspot.com/-b4I14GHPLTs/VobDZ0MDNxI/AAAAAAAAA-s/ClOWGuno1wA/s1600/color-blind2.png\" alt=\"Ruby Plus\" style=\"border: 1px solid #000; max-width:700px; max-height:600px;\"/>\r\n\r\nTest Achromatopsy\r\n\r\n<img src=\"https://2.bp.blogspot.com/-ktwqQDehVTc/VobDX7MSCwI/AAAAAAAAA-c/35YX3H_dnaM/s1600/color-blind1.png\" alt=\"Ruby Plus\" style=\"border: 1px solid #000; max-width:700px; max-height:600px;\"/>\r\n\r\n\r\nStep 3\r\n------\r\n\r\nMake any adjustments to the theme to make it accessible to color blind people. For instance I changed my theme for code syntax highlighting from Base16 to ThankfulEyes theme. In app/assets/rouge.css.erb, I changed the theme:\r\n\r\n```ruby\r\n<%= Rouge::Themes::ThankfulEyes.render(:scope => \'.highlight\') %>\r\n```\r\n\r\nFinally, get feedback from color-blind people to double check that your pages are clear for them. Tip by Robert Pankowecki: For maps and diagrams use colors from [Color Brewer](http://colorbrewer2.org/ \'Color Brewer\').\r\n\r\nSummary\r\n==========\r\n----------\r\n\r\nYour web app should have enough contrast between the background and foreground among in addition to the color choices. Use tools to test your site for color blindness and make it accessible. Special thanks to Ron Huppert for providing me feedback on rubyplus.com to make it friendly for color blind people.\r\n','2016-01-01 19:00:39','2016-01-09 04:26:40'),(2921,'3 Tips to Speed Up the Page Loads in Rails App','Objective\r\n==========\r\n----------\r\n\r\nTo find three low hanging fruits and quickly fix performance issues to speed up page load.\r\n\r\nBackground\r\n==========\r\n----------\r\n\r\nThese tips are based on Google\'s [Online PageSpeed Insights] (https://developers.google.com/speed/pagespeed/insights/ \'Online PageSpeed Insights\')\r\n\r\nTip 1\r\n-----\r\n\r\nRemove render-blocking JavaScript by using html5 async tag to the `javascript_include_tag` in the application layout file:\r\n\r\n```ruby\r\n  <%= javascript_include_tag \"application\", \"data-turbolinks-track\" => true, async: true %>\r\n```\r\n  \r\nIn order for this enhancement to work you should not use `document.write`. Read the documentation at [Blocking JS](https://developers.google.com/speed/docs/insights/BlockingJS \'Blocking JS\') for other constraints.\r\n  \r\nTip 2\r\n-----\r\n\r\nLosslessly compressing logo images on the home page could save page load time. Here is the logos of different dimensions and its before and after compression sizes for rubyplus.com.\r\n\r\n```sh\r\nLogo : 127 kb -> 47 kb\r\n300w : 40 kb  -> 19 kb\r\n500w : 60 kb  -> 38 kb\r\n```\r\n\r\nIf you run trimage:\r\n\r\n```sh\r\ntrimage -f logo.png\r\n```\r\n\r\nYou will get the error:\r\n\r\n```sh\r\ntrimage.py: cannot connect to X server \r\n```\r\n\r\nYou need Virtual Framebuffer \'fake\' X server for trimage to work. I am using Moonshine to manage the server. So I added the following directives in the application manifest file to install trimage, fake X server and it\'s dependencies.\r\n\r\n```ruby\r\n# trimage is used manually to compress images to speed up page load.\r\npackage \'trimage\',         :ensure => :installed\r\n\r\n# Virtual Framebuffer \'fake\' X server\r\npackage \'xvfb\',            :ensure => :installed\r\npackage \'x11-xkb-utils\',   :ensure => :installed\r\npackage \'xfonts-100dpi\',   :ensure => :installed\r\npackage \'xfonts-75dpi\',    :ensure => :installed\r\npackage \'xfonts-scalable\', :ensure => :installed\r\npackage \'xfonts-cyrillic\', :ensure => :installed                    \r\npackage \'x11-apps\',        :ensure => :installed                    \r\n```\r\n\r\nIf you are managing your server manually you can run:\r\n\r\n```sh\r\napt-get install xvfb x11-xkb-utils xfonts-100dpi xfonts-75dpi xfonts-scalable xfonts-cyrillic x11-apps\r\n```\r\n\r\nAfter deployment, I compressed the images on the server:\r\n\r\n```sh\r\napp/assets/images$ /usr/bin/xvfb-run -a trimage -f logo_300w.png\r\n/app/assets/images/logo_300w.png not a supported image file and/or not writeable\r\nFile: /releases/20160105195127/app/assets/images/logo_300w.png, Old Size: 38 KB, New Size: 18 KB, Ratio: 51.5%\r\n```\r\n\r\nNotice that I am using the Virtual Framebuffer \'fake\' X server to run the trimage. Then downloaded the compressed images to my laptop using scp. Copied them to my rails app/assets/images folder and deployed the changes using Capistrano.\r\n\r\nTip 3\r\n---- \r\n\r\nCompressing resources with gzip or deflate can reduce the number of bytes sent over the network. How to test if gzip is enabled? Go to [Gift of Speed] (http://www.giftofspeed.com/enable-gzip-compression/ \'Gift of Speed\') and enter your site URL.  You can also check the server if deflate is properly configured.\r\n\r\n```sh\r\nrails@li552-13:~$ apachectl -t -D DUMP_MODULES | grep deflate\r\n/usr/sbin/apachectl: 87: ulimit: error setting limit (Operation not permitted)\r\nSyntax OK\r\n deflate_module (shared)\r\n``` \r\n \r\nIn this case, we see Apache deflate_module in the output, which confirms that gzip is setup on this server. You can also go to the \'Network\' tab in the Chrome inspector and inspect the headers.\r\n\r\n<img src=\"https://4.bp.blogspot.com/-yK-pnmxEfK0/VoyBbF1V3DI/AAAAAAAAA_4/efjPiKkF69A/s1600/Screen%2BShot%2B2016-01-05%2Bat%2B6.10.02%2BPM.png\" alt=\"Ruby Plus\" style=\"border: 1px solid #000; max-width:700px; max-height:600px;\"/>\r\n\r\nYou can see that the Content-Encoding is gzip. So, what files are compressed using gzip? For Apache mod_deflate is used to compress files using gzip. Moonshine creates `/etc/apache2/mods-enabled/deflate.conf` with the following configuration:\r\n\r\n```sh\r\n<IfModule mod_deflate.c>\r\n  # these are known to be safe with MSIE 6\r\n  AddOutputFilterByType DEFLATE text/html text/plain text/xml\r\n\r\n  # everything else may cause problems with MSIE 6\r\n  AddOutputFilterByType DEFLATE text/css\r\n  AddOutputFilterByType DEFLATE application/x-javascript application/javascript application/ecmascript\r\n  AddOutputFilterByType DEFLATE application/rss+xml\r\n</IfModule>\r\n```\r\n\r\nYou can see which files will be compressed using gzip. The images are already compressed so it is not included in this file.\r\n\r\nSummary\r\n==========\r\n----------\r\n\r\nYou have to test pages using javascript to make sure it does not have any issues. I hope these three tips helps you to speed up your Rails apps. It definitely helped to load the home page of rubyplus.com faster.\r\n\r\nReferences\r\n==========\r\n----------\r\n\r\n[Trimage](https://trimage.org/ \'Trimage\')\r\n[Virtual Framebuffer \'fake\' X server](https://packages.ubuntu.com/precise/xvfb \'Virtual Framebuffer \'fake\' X server\')','2016-01-06 02:44:46','2016-01-09 04:25:51'),(2931,'Flexing Your Message Centric Muscles','## Objective\r\n\r\nTo learn that everything is an object in Smalltalk but not in Ruby. \r\n\r\n## Discussion\r\n\r\nIn this article we will explore : How far can we push Ruby to be as message centric as Smalltalk? David Black has a good presentation on YouTube that I have listed in the references section. But the problem with his presentation is that he goes off track. I want to push the limits of Ruby and see how close we can get to Smalltalk. He failed to do so in his presentation.\r\n\r\n## If-Else \r\n\r\nThe conditionals such as if-else statements are not objects in Ruby. \r\n\r\n### Ruby Version\r\n\r\n```ruby\r\ncount = 0\r\n\r\nif (count < 10)\r\n  print \"Count is less than 10\"\r\nelse\r\n  print \"Count is greater than or equal to 10\"\r\nend\r\n```\r\n\r\n### Smalltalk Version\r\n\r\nThe if-else conditional is implemented as sending messages to the Boolean objects in Smalltalk.\r\n\r\n```smalltalk\r\n(count < 10)\r\n   ifTrue: [ Transcript show: \"Count is less than 10\"]\r\n   ifFalse: [ Transcript show: \"Count is greater than or equal to 10\" ]\r\n```\r\n\r\nIn Smalltalk, there is a concept called `cascading`. You can see how the ifTrue and ifFalse messages are chained together.\r\n\r\n### Message Centric Ruby Version\r\n\r\nThis solution is stolen from Sandi Metz presentation Nothing is Something.\r\n\r\n```ruby\r\nclass TrueClass\r\n  def if_true\r\n    yield\r\n    self\r\n  end\r\n  \r\n  def if_false\r\n    self\r\n  end\r\nend\r\n\r\nclass FalseClass\r\n  def if_false\r\n    yield\r\n    self\r\n  end\r\n  \r\n  def if_true\r\n    self\r\n  end\r\nend\r\n\r\n(count < 10).if_true{ print \"Count is less than 10\" }.if_false { print \"Count is greater than or equal to 10\" }\r\n```\r\n\r\n## Seek Roles not Abstraction\r\n\r\nIn her presentation she says \'Abstraction Seeking\'. I would say \"Role Seeking\". Because her example illustrates the different roles. It is too vague to say \'Abstraction Seeking\'. It is much more concrete to say \'Role Seeking\'. Objects like User, Customer are vague. They probably play many roles. You will come up with a better design if you seek to find the roles.\r\n\r\n## Case Statement\r\n\r\nThe case statements are not objects in Ruby.\r\n\r\n### Ruby Version\r\n\r\n```ruby\r\ncharacter = \'\'\r\n\r\ncase character\r\nwhen \"^\"\r\n  puts \'It is a caret\'\r\nwhen \">\"\r\n  puts \'It is a greater than\'\r\nelse\r\n  puts \"You can\'t even use a computer!\"\r\nend\r\n```\r\n\r\n### Smalltalk Version\r\n\r\nThe case statements is implemented as a Dictionary that allows sending messages to objects in Smalltalk.\r\n\r\n```smalltalk\r\nmap := Dictionary new.\r\nmap at: $^ put: [Transcript show: \'It is a caret\'].\r\nmap at: $> put: [Transcript show: \'It is greater than\'].\r\nmap at: $< put: [Transcript show: \'It is less than\']\r\n         :\r\nresult := (map at: char) value.\r\n```\r\n\r\n### Message Centric Ruby Version\r\n\r\n```ruby\r\ncharacter = \'>\'\r\n\r\nhash = Hash.new\r\nhash[\'^\'] = -> { print \'It is a caret\' }\r\nhash[\'>\'] = -> { print \'It is greater than\' }\r\n\r\nresult = hash[character].call\r\n```\r\n\r\n## Loop\r\n\r\nLoops are not objects in Ruby. \r\n\r\n### Ruby Version\r\n\r\n```ruby\r\nloop do\r\n p \'This will print forever\'\r\nend\r\n```\r\n\r\n### Smalltalk Version\r\n\r\nSmalltalk sends a repeat message to a Block object. The structure is :\r\n\r\n```smalltalk\r\n[ code ].repeat\r\n```\r\n\r\nSo, it would be like this:\r\n\r\n```ruby\r\n[Transcript show: \'This will repeat forever\'] repeat\r\n````\r\n\r\nLoops are inherently message centric in Smalltalk. \r\n\r\n### Message Centric Ruby Version\r\n\r\n```ruby\r\nclass Proc\r\n  def repeat\r\n    loop do\r\n      call\r\n    end\r\n  end\r\nend\r\n\r\nforever = -> { p \'This will print forever\' }\r\n\r\nforever.repeat \r\n```\r\n\r\n## While Loop       \r\n      \r\nThe while loops are not objects in Ruby.\r\n\r\n### Ruby\r\n\r\n```ruby \r\nn = 1\r\nwhile (n <= 10) do\r\n  p n\r\n  n += 1\r\nend\r\n```\r\n\r\n### Smalltalk Version\r\n\r\nIn Smalltalk, the while loop is implemented as objects.\r\n\r\n```smalltalk\r\nn := 1.\r\n[n <= 10]\r\n    whileTrue:\r\n       [Transcript show: n.\r\nn := n + 1].\r\n```\r\n\r\nIn Smalltalk Blocks are objects. The square brackets is used for blocks. \r\n\r\n### Message Centric Ruby Version\r\n\r\n```ruby\r\nclass Proc\r\n  def while_true\r\n    while self.call\r\n      yield\r\n    end\r\n  end\r\nend\r\n\r\nn = 1\r\n\r\nmy_proc = -> { n <= 10}\r\n\r\nmy_proc.while_true do\r\n  p n\r\n  n += 1  \r\nend\r\n```\r\n\r\nSince blocks are not objects in Ruby, we need to convert the block to a Proc object.  We can open the Proc class and define while_true method that encapsulates the while looping logic.\r\n\r\n## Summary\r\n\r\nIn this article, we compared the language constructs that are object oriented in Smalltalk with their Ruby equivalent. We made the non OO Ruby language constructs into message centric calls by adding methods to Proc, Hash, TrueClass and FalseClass.\r\n\r\n## References\r\n\r\n1. Smalltalk and Object Orientation by John Hunt\r\n2. Nothing is Something presentation by Sandi Metz\r\n3. [The Well Grounded Nuby] (https://www.youtube.com/watch?v=Xt6c6r4fbBs \'The Well Grounded Nuby\') by David Black.','2016-01-20 06:34:49','2016-01-22 18:13:08'),(2941,'The Art of Uniform Interface','## Context\r\n\r\nAfter reading how the first, second, third and so on methods were added in the Rails doctrine by DHH, I started to look for ways on how I would actually go about doing something better. Obviously the drawback of defining methods like that is that they are not scalable. But, I see his point of not indexing into an array to get data for some common use cases.\r\n\r\n## Challenge\r\n\r\nThe challenge is : How can we come up with a uniform interface that does not result in explosion of method and at the same time achieves ignorance of indexing into an array? Ruby, has values_at method for an array. \r\n\r\n```ruby\r\n> a = [1,2]\r\n => [1, 2] \r\n> a.values_at(1)\r\n => [2] \r\n> a.values_at(0)\r\n => [1] \r\n```\r\n\r\nThis exposes the knowledge of the indexing of an array. It also knows that is an array. Ruby also has values_at method for hash.\r\n \r\n```ruby\r\n h = { \"cat\" => \"feline\", \"dog\" => \"canine\", \"cow\" => \"bovine\" }\r\n h.values_at(\"cow\", \"cat\")  \r\n #=> [\"bovine\", \"feline\"]\r\n ```\r\n\r\nThis exposes the knowledge that is an hash. You need to know the key in the hash to get the corresponding value.\r\n\r\n## Well Defined Interface\r\n\r\nI don\'t care about the type of data structure, just give me the element in the given position.\r\n\r\n```ruby\r\nclass Array\r\n  def element(position)\r\n    self[position - 1]\r\n  end\r\nend\r\n\r\np [4,5,6].element(3)\r\n ````\r\n\r\nYou can just provide the position as the parameter to element method instead of going through the mental mapping of position and index of an array. Similarly, we can define a element method for Hash.\r\n\r\n```ruby\r\nclass Hash\r\n  def element(position)\r\n    a = self.to_a[position-1]\r\n    {a[0] => a[1]}\r\n  end\r\nend\r\n\r\nh = {a: 1, b: 2, c: 3, d: 4}\r\np h.element(2)\r\n```\r\n\r\nThis returns :\r\n\r\n```ruby\r\n{b: 2}\r\n```\r\n\r\nBoth implementation are data structure agnostic. It does not force the developers to map the position of an element and the index in array or knowing the key of a hash.\r\n\r\n## Principle of Least Surprise\r\n\r\nI was surprised when I tried to call element method on Array and Hash and I got errors. Ruby has failed in this case. It only has first and last method defined. \r\n\r\n## Summary\r\n\r\nIn this article, we saw how we can define a uniform interface that hides the data structure and knowledge required to pass in parameters to a method. This solution eliminates parametric coupling.','2016-01-21 04:27:50','2016-01-21 05:06:08'),(2951,'Using Amazon Cloudfront CDN with Rails 4.2.5.1 App','## Objective\r\n\r\nLearn how to setup CDN using Amazon Cloudfront for Rails 4.2.5.1 Apps.\r\n\r\n## Steps\r\n\r\n### Step 1 \r\n\r\nGo to Amazon Cloud Front and setup a CDN distribution. Click Cloud Front, provide the hostname\r\nand accept the default values for other values. It will take about 15 to 30 minutes for the changes to take effect.\r\n\r\n<img src=\"https://3.bp.blogspot.com/-EtjFj3xCR7o/VtOBH19BKQI/AAAAAAAABB4/vpBn4D29UPE/s1600/Screen%2BShot%2B2016-02-28%2Bat%2B3.07.51%2BPM.png\r\n\" alt=\"Amazon Cloudfront CDN\" style=\"border: 1px solid #000; max-width:700px; max-height:600px;\"/>\r\n\r\n### Step 2 \r\n\r\nIn `production.rb` add :\r\n\r\n```ruby\r\n config.action_controller.asset_host = \"amazon-provided-id.cloudfront.net\"\r\n```\r\n\r\nYou can also setup a CNAME like cdn.yourdomain.com to point to amazon-provided-id.cloudfront.net. I am using https for the entire site. Since I did not have wildcard SSL certificate, it did not work. So, I am using `https://amazon-provided-id.cloudfront.net` for now. \r\n\r\n### Step 3 \r\n\r\nAfter deploying your Rails app, view the page source. Verify the CDN. You should now see CDN for static assets. Something like this: \r\n\r\n```\r\nhttps://d1b5oz78c0udqh.cloudfront.net/assets/application-b5f55fdfb705b0fcdb2b9f6d9c28e97d.js\r\nhttps://d1b5oz78c0udqh.cloudfront.net/assets/application-78676f382b46d6507c553c905c652a11.css\r\nhttps://d1b5oz78c0udqh.cloudfront.net/assets/logo_300w-401a078fda85ae7672f3e18f1d8f9cfd.png\r\n```\r\n\r\n## Summary\r\n\r\nIt took me half hour to setup CDN using Amazon Cloudfront for [Ruby Plus](https://www.rubyplus.com \'Ruby Plus\'). You can use [WebPageTest](https://www.webpagetest.org/ \'WebPageTest\') to check the performance of your site before and after using CDN.\r\n\r\n<img src=\"https://3.bp.blogspot.com/-tscaxPUxM_U/VtOBBSsTCQI/AAAAAAAABB0/2s1OH8o-zvw/s1600/Screen%2BShot%2B2016-02-28%2Bat%2B3.19.00%2BPM.png\r\n\" alt=\"Web Page Test\" style=\"border: 1px solid #000; max-width:700px; max-height:600px;\"/>','2016-02-28 23:18:15','2016-02-28 23:37:16'),(2961,'Caching Static and Dynamic Pages in Rails 4.2.5','## Steps\r\n\r\n### Step 1\r\n\r\nIn production.rb:\r\n\r\n```ruby\r\nconfig.action_controller.perform_caching = true\r\n```\r\n\r\n### Step 2\r\n\r\n```ruby\r\nmodule ArticlesHelper\r\n  def cache_key_for_articles\r\n    count          = Article.count\r\n    max_updated_at = Article.maximum(:updated_at).utc.to_s(:number)\r\n    \"articles/all-#{count}-#{max_updated_at}\"\r\n  end\r\nend\r\n```\r\n\r\n### Step 3\r\n\r\n```ruby\r\n<% cache(cache_key_for_articles) do %>\r\n  Article list\r\n<% end %>\r\n```\r\n\r\nIf you have a static page, for instance the home page, you can use:\r\n\r\n```ruby\r\n<% cache do %>\r\n  Static Home Page content\r\n<% end %>\r\n```\r\n\r\n## Summary\r\n\r\nIn this article, we saw how to cache static and dynamic pages using Rails fragment caching.','2016-02-29 07:39:59','2016-02-29 07:40:26'),(2971,'Speed Up Serving Static Assets on Rails 4.2.5','## Background\r\n\r\nI am using Moonshine plugin to manage this site on Linode instance.\r\n\r\n## Steps\r\n\r\n### Step 1\r\n\r\n```ruby\r\nplugger install git://github.com/railsmachine/moonshine_xsendfile.git\r\n```\r\n\r\n### Step 2\r\n\r\nIn application_manifest.rb:\r\n\r\n```ruby\r\nconfigure :xsendfile => {:x_send_file_path => rails_root}\r\nrecipe :xsendfile\r\n```  \r\n\r\n### Step 3\r\n\r\nIn production.rb:\r\n\r\n```ruby\r\nconfig.action_dispatch.x_sendfile_header = \"X-Sendfile\" # for apache\r\n```\r\n\r\nHere is test performance report using [GTmetrix](https://gtmetrix.com \'GTmetrix\').\r\n\r\n<img src=\"https://1.bp.blogspot.com/-fgDcnOx3NeA/VtUjsJsY-yI/AAAAAAAABCg/d2k4LaziTKE/s1600/Screen%2BShot%2B2016-02-29%2Bat%2B9.03.34%2BPM.png\r\n\" alt=\"GTmetrix\" style=\"border: 1px solid #000; max-width:700px; max-height:600px;\"/>\r\n\r\n\r\n\r\n\r\n','2016-03-01 05:06:34','2016-03-01 05:09:38'),(2981,'How to Create Sprite Images using Compass Rails Gem in Rails 4.2.5','## Steps\r\n\r\n### Step 1\r\n\r\nCreate a new rails project.\r\n\r\n### Step 2\r\n\r\nCopy icons to `app/assets/images/icons` folder.\r\n\r\n### Step 3\r\n\r\nCreate a sprites folder in `app/assets/images` folder\r\n\r\n### Step 4\r\n\r\nAdd gem `compass-rails` to Gemfile. Run:\r\n\r\n```\r\nbundle\r\n```\r\n\r\n### Step 5\r\n\r\nRename `application.css` to `application.scss`.\r\n\r\n### Step 6\r\n\r\nCreate your resource.\r\n\r\n```\r\nrails g scaffold article title:string content:text\r\n```\r\n\r\n### Step 7\r\n\r\nAdd, the following to `app/assets/stylesheets/articles.scss` file.\r\n\r\n```\r\n@import \"compass/utilities/sprites\";\r\n@import \"icons/*.png\";\r\n@include all-icons-sprites;\r\n```\r\n\r\nRead the compass gem home page to learn more about these declarations.\r\n\r\n### Step 8\r\n\r\nIn `production.rb`, enable assets and configure the folder where the generated sprite images should be stored.\r\n\r\n```ruby\r\nconfig.assets.enabled = true\r\nconfig.compass.generated_images_dir = “app/assets/images/sprites”\r\n```\r\n\r\nYou can also add it to `development.rb` for testing locally in development environment.\r\n\r\n### Step 9\r\n\r\nRun:\r\n\r\n```\r\nrake assets:precompile\r\n```\r\n\r\n### Step 10	\r\n	\r\nYou will see the generated sprite file in `app/assets/images/sprites` folder. Add `app/assets/images/sprites/*` to `.gitignore` file.	\r\n\r\nSample source code can be downloaded from `https://github.com/bparanj/rcompass`.\r\n\r\n## Summary\r\n\r\nIn this article, you learned how to use compass-rails gem to generate sprite images for Rails 4.2.5 apps. It reduces the number of files to download from a server and therefore improves the performance.\r\n','2016-03-03 05:10:37','2016-03-03 05:15:30'),(2991,'Hello SASS','### Steps\r\n\r\n## Step 1\r\n\r\nInstall the gem.\r\n\r\n```\r\n$ gem install compass\r\n```\r\n\r\n## Step 2\r\n\r\nView the help.\r\n\r\n```\r\n$ compass -h\r\n```\r\n\r\n## Step 3\r\n\r\nCreate a project called hello.\r\n\r\n```\r\n$ compass create hello\r\n```\r\n\r\n## Step 4\r\n\r\nAdd hello.scss file to sass folder.\r\n\r\n```scss\r\n$header-color: #fe3242;\r\n\r\nh1 {\r\n    color: $header-color;\r\n}\r\n```\r\n\r\n## Step 5\r\n\r\nCompile the hello.scss file.\r\n```\r\n$ compass compile ./sass/hello.scss\r\n```\r\n    \r\nThis will create `stylesheets/hello.css` file in stylesheets folder. The contents are:\r\n\r\n```css\r\n/* line 3, ../sass/hello.scss */\r\nh1 {\r\n  color: #fe3242;\r\n}\r\n```  \r\n\r\n## Summary \r\n\r\nIn this article, we created a simple hello sass project and compiled a scss file to create a css file. You can browse the source code at `https://github.com/bparanj/hicompass`. You can learn more from the compass home page.','2016-03-04 05:24:49','2016-03-04 05:24:49'),(3001,'Creating Sprite Files using Compass Gem','## Objective\r\n\r\nTo learn how to generate sprite files using Compass gem and avoid creating them manually.\r\n\r\n## Steps\r\n\r\n### Step 1\r\n\r\nCopy images to `images/icons` directory in the project we created in [Hello SASS](https://rubyplus.com/articles/2991 \'Hello SASS\') article.\r\n\r\n### Step 2\r\n\r\nIn `sass/screen.scss` file, add:\r\n\r\n```\r\n@import \"compass/utilities/sprites\";\r\n@import \"icons/*.png\";\r\n@include all-icons-sprites;\r\n```\r\n\r\n### Step 3\r\n\r\nCompile the scss file:\r\n\r\n```sh\r\n$ compass compile ./sass/screen.scss\r\n```\r\n\r\nThis will create the sprite file, images/icons-s234c7f302b.png.\r\n    \r\n### Step 4\r\n\r\nThe generated code for sprites in screen.css:\r\n\r\n```css\r\n/* line 72, icons/*.png */\r\n.icons-sprite, .icons-delete, .icons-edit, .icons-new, .icons-save {\r\n  background-image: url(\'/images/icons-s234c7f302b.png\');\r\n  background-repeat: no-repeat;\r\n}\r\n\r\n/* line 84, ../../../../.rvm/gems/ruby-2.3.0@compass/gems/compass-core-1.0.3/stylesheets/compass/utilities/sprites/_base.scss */\r\n.icons-delete {\r\n  background-position: 0 0;\r\n}\r\n\r\n/* line 84, ../../../../.rvm/gems/ruby-2.3.0@compass/gems/compass-core-1.0.3/stylesheets/compass/utilities/sprites/_base.scss */\r\n.icons-edit {\r\n  background-position: 0 -32px;\r\n}\r\n\r\n/* line 84, ../../../../.rvm/gems/ruby-2.3.0@compass/gems/compass-core-1.0.3/stylesheets/compass/utilities/sprites/_base.scss */\r\n.icons-new {\r\n  background-position: 0 -64px;\r\n}\r\n\r\n/* line 84, ../../../../.rvm/gems/ruby-2.3.0@compass/gems/compass-core-1.0.3/stylesheets/compass/utilities/sprites/_base.scss */\r\n.icons-save {\r\n  background-position: 0 -96px;\r\n}\r\n```\r\n\r\nYou can download the source code for this article from [rcompass](https://github.com/bparanj/hicompass \'rcompass\').\r\n\r\n## Summary\r\n\r\nIn this article, you learned how easy it is to generate sprite files using Compass gem. This saves you time, since you avoid creating the sprite files manually. Using sprite files reduces the number of connections made to the server and improves the performance.\r\n\r\n## References\r\n\r\n[Tutorial to Compass and Sass](http://milandarjanin.com/bachelor/src/working_with_projects.html \'Tutorial to Compass and Sass\')\r\n[How to automatically generate CSS sprites with Sass and Compass](http://www.codechewing.com/library/automatically-generate-css-sprites-with-sass/ \'How to automatically generate CSS sprites with Sass and Compass\')','2016-03-05 05:13:52','2016-03-05 05:22:58'),(3011,'Dynamic Attribute Based Finders in Rails 4.2','## Objective\r\n\r\nTo learn about dynamic attribute-based finders in Rails 4.2.\r\n\r\n## Steps\r\n### Step 1\r\nCreate a new Rails 4.2.5 project.\r\n\r\n```sh\r\n$ rails new doer\r\n```\r\n\r\n### Step 2\r\n\r\nLet\'s use scaffold to play with some tasks.\r\n\r\n```sh\r\n$ rails g scaffold task name:string complete:boolean\r\n```\r\n\r\n### Step 3\r\n\r\nCreate the table.\r\n\r\n```\r\n$ rake db:migrate\r\n```\r\n\r\n### Step 4\r\n\r\nAdd some records In seeds.rb:\r\n\r\n```ruby\r\nTask.create(name: \'Get rich quick\', complete: false)\r\nTask.create(name: \'Write a book\', complete: true)\r\nTask.create(name: \'Buy a puppy\', complete: false)\r\nTask.create(name: \'Dance in the rain\', complete: true)\r\n```\r\n\r\nPopulate the tasks table.\r\n\r\n```\r\nrake db:seed\r\n```\r\n\r\n### Step 5\r\n\r\nWhat happens when we use `find_all_by_something` ?\r\n\r\n```\r\n$ rails c\r\n tasks = Task.find_all_by_complete(false)\r\n NoMethodError: undefined method `find_all_by_complete\' for #<Class:0x007fe590d96f98>\r\n Did you mean?  find_or_create_by\r\n```\r\n\r\nIt\'s not available in Rails 4.2 anymore. How do we find all incomplete tasks?\r\n\r\n### Step 6\r\n\r\nWe can use `find_by(column: value)`:\r\n\r\n```\r\n$ rails c\r\nLoading development environment (Rails 4.2.5.2)\r\n > task = Task.find_by(complete: false)\r\n  Task Load (0.3ms)  SELECT  \"tasks\".* FROM \"tasks\" WHERE \"tasks\".\"complete\" = ? LIMIT 1  [[\"complete\", \"f\"]]\r\n => #<Task id: 1, name: \"Get rich quick\", complete: false, created_at: \"2016-03-04 21:50:56\", updated_at: \"2016-03-04 21:50:56\"> \r\n ```\r\n\r\nThis returned only one record. We know that there are two incomplete tasks. How can we retrieve all incomplete tasks?\r\n\r\n### Step 7\r\n\r\nWe can use `where`:\r\n\r\n```ruby\r\nincomplete_tasks = Task.where(complete: false)\r\nTask Load (2.1ms)  SELECT \"tasks\".* FROM \"tasks\" WHERE \"tasks\".\"complete\" = ?  [[\"complete\", \"f\"]]\r\n => #<ActiveRecord::Relation [#<Task id: 1, name: \"Get rich quick\", complete: false, created_at: \"2016-03-04 21:50:56\", updated_at: \"2016-03-04 21:50:56\">, #<Task id: 3, name: \"Buy a puppy\", complete: false, created_at: \"2016-03-04 21:50:56\", updated_at: \"2016-03-04 21:50:56\">]> \r\n```\r\n\r\nWe get an `ActiveRecord::Relation` object back. We don\'t have the results from the database.\r\n\r\n```ruby\r\n > incomplete_tasks.class\r\n => Task::ActiveRecord_Relation \r\n```\r\n\r\n### Step 8\r\n\r\nWe can retrieve the records by using `to_a`:\r\n\r\n```ruby\r\n > incomplete_tasks.to_a\r\n => [#<Task id: 1, name: \"Get rich quick\", complete: false, created_at: \"2016-03-04 21:50:56\", updated_at: \"2016-03-04 21:50:56\">, #<Task id: 3, name: \"Buy a puppy\", complete: false, created_at: \"2016-03-04 21:50:56\", updated_at: \"2016-03-04 21:50:56\">] \r\n```\r\n\r\nNow we see all the incomplete tasks. \r\n\r\n### Step 9\r\n\r\nLet\'s get the last incomplete task.\r\n\r\n```ruby\r\n last_incomplete = Task.where(complete: false).order(\'created_at DESC\')\r\n  Task Load (0.2ms)  SELECT \"tasks\".* FROM \"tasks\" WHERE \"tasks\".\"complete\" = ?  ORDER BY created_at DESC  [[\"complete\", \"f\"]]\r\n => #<ActiveRecord::Relation [#<Task id: 3, name: \"Buy a puppy\", complete: false, created_at: \"2016-03-04 21:50:56\", updated_at: \"2016-03-04 21:50:56\">, #<Task id: 1, name: \"Get rich quick\", complete: false, created_at: \"2016-03-04 21:50:56\", updated_at: \"2016-03-04 21:50:56\">]>\r\n```\r\n\r\nThis returns `ActiveRecord::Relation` object. We can force the query to return results:\r\n\r\n```ruby\r\n last_incomplete = Task.where(complete: false).order(\'created_at DESC\').first\r\n  Task Load (0.3ms)  SELECT  \"tasks\".* FROM \"tasks\" WHERE \"tasks\".\"complete\" = ?  ORDER BY created_at DESC LIMIT 1  [[\"complete\", \"f\"]]\r\n => #<Task id: 3, name: \"Buy a puppy\", complete: false, created_at: \"2016-03-04 21:50:56\", updated_at: \"2016-03-04 21:50:56\">\r\n```\r\n\r\n### Step 10\r\n\r\nIf you have lot of data, for sorting it is better to use the id instead of the date column for better performance. The primary key already has index.\r\n\r\n```ruby\r\nlast_incomplete = Task.where(complete: false).order(\'id DESC\').first\r\n```\r\n\r\n### Step 11\r\n\r\nWe can search for name that has a certain string using `LIKE`:\r\n\r\n```ruby\r\ntasks = Task.where(\"name LIKE \'Buy%\'\").to_a\r\nTask Load (0.2ms)  SELECT \"tasks\".* FROM \"tasks\" WHERE (name LIKE \'Buy%\')\r\n  => [#<Task id: 3, name: \"Buy a puppy\", complete: false, created_at: \"2016-03-04 21:50:56\", updated_at: \"2016-03-04 21:50:56\">]\r\n```\r\n\r\nIn the controller, it will be:\r\n\r\n```ruby\r\ntasks = Task.where(\"name LIKE \'#{params[:name]}%\'\").to_a\r\n```  \r\n\r\nYou can download the code for this article from `https://github.com/bparanj/doer`.\r\n\r\n## Summary\r\n\r\nIn this article, you learned how the dynamic attribute-based finders work in Rails 4.2.5. You also saw how to find records matching a certain string for a column.','2016-03-07 02:29:10','2016-03-07 02:33:33'),(3021,'Rails 4.2 ActiveRecord Basics','## Sample Data\r\n\r\nChange the seeds.rb:\r\n\r\n```ruby\r\nwealthy = Project.create(name: \'Wealth Building\')\r\nwealthy.tasks.create(name: \'Get rich quick\', complete: false)\r\nwealthy.tasks.create(name: \'Write a book\', complete: true)\r\n\r\nhappy = Project.create(name: \'Be Happy\')\r\nhappy.tasks.create(name: \'Buy a puppy\', complete: false)\r\nhappy.tasks.create(name: \'Dance in the rain\', complete: true)\r\n```\r\n\r\nRun rake db:seed to populate the database. \r\n\r\n## Define the Relationships\r\n\r\nDefine the `has_many` relationship in the Project.\r\n\r\n```ruby\r\nclass Project < ActiveRecord::Base\r\n  has_many :tasks\r\nend\r\n```\r\n\r\nDefine the `belongs_to` in the task.\r\n\r\n```ruby\r\nclass Task < ActiveRecord::Base\r\n  belongs_to :project\r\nend\r\n```\r\n\r\nNow we can play with our database.\r\n\r\n## Chaining Methods\r\n\r\nWe can find all incomplete tasks ordered by created_at in descending order.\r\n\r\n```ruby\r\n > Task.where(complete: false).order(\'created_at DESC\')\r\n  Task Load (0.2ms)  SELECT \"tasks\".* FROM \"tasks\" WHERE \"tasks\".\"complete\" = ?  ORDER BY created_at DESC  [[\"complete\", \"f\"]]\r\n => #<ActiveRecord::Relation [#<Task id: 3, name: \"Buy a puppy\", complete: false, created_at: \"2016-03-04 23:50:20\", updated_at: \"2016-03-04 23:50:20\", project_id: 2>, #<Task id: 1, name: \"Get rich quick\", complete: false, created_at: \"2016-03-04 23:50:20\", updated_at: \"2016-03-04 23:50:20\", project_id: 1>]> \r\n``` \r\n\r\nIt is better to use `id` column to order for better performance. The primary key is already indexed and it is faster to sort records by using `id`. This becomes important when you are dealing with lot of records. We can use `id` for sorting like this:\r\n\r\n```ruby \r\n > Task.where(complete: false).order(\'id DESC\')\r\n   Task Load (0.2ms)  SELECT \"tasks\".* FROM \"tasks\" WHERE \"tasks\".\"complete\" = ?  ORDER BY id DESC  [[\"complete\", \"f\"]]\r\n  => #<ActiveRecord::Relation [#<Task id: 3, name: \"Buy a puppy\", complete: false, created_at: \"2016-03-04 23:50:20\", updated_at: \"2016-03-04 23:50:20\", project_id: 2>, #<Task id: 1, name: \"Get rich quick\", complete: false, created_at: \"2016-03-04 23:50:20\", updated_at: \"2016-03-04 23:50:20\", project_id: 1>]>\r\n```\r\n\r\nIf you don\'t use the sorting, by default sorting shows the oldest records first.\r\n\r\n```ruby  \r\n  > Task.where(complete: false)\r\n   Task Load (0.2ms)  SELECT \"tasks\".* FROM \"tasks\" WHERE \"tasks\".\"complete\" = ?  [[\"complete\", \"f\"]]\r\n  => #<ActiveRecord::Relation [#<Task id: 1, name: \"Get rich quick\", complete: false, created_at: \"2016-03-04 23:50:20\", updated_at: \"2016-03-04 23:50:20\", project_id: 1>, #<Task id: 3, name: \"Buy a puppy\", complete: false, created_at: \"2016-03-04 23:50:20\", updated_at: \"2016-03-04 23:50:20\", project_id: 2>]>\r\n```  \r\n  \r\n## Using Associations to Find Records\r\n \r\n A project has many tasks. Let\'s find a project first.\r\n \r\n ```ruby\r\n p = Project.find 1\r\n  Project Load (0.1ms)  SELECT  \"projects\".* FROM \"projects\" WHERE \"projects\".\"id\" = ? LIMIT 1  [[\"id\", 1]]\r\n => #<Project id: 1, name: \"Wealth Building\", created_at: \"2016-03-04 23:50:20\", updated_at: \"2016-03-04 23:50:20\"> \r\n```\r\n\r\nWe can now find incomplete tasks for this project sorted by id in descending order.\r\n\r\n ```ruby\r\n p.tasks.where(complete: false).order(\'id DESC\')\r\n  Task Load (0.2ms)  SELECT \"tasks\".* FROM \"tasks\" WHERE \"tasks\".\"project_id\" = ? AND \"tasks\".\"complete\" = ?  ORDER BY id DESC  [[\"project_id\", 1], [\"complete\", \"f\"]]\r\n => #<ActiveRecord::AssociationRelation [#<Task id: 1, name: \"Get rich quick\", complete: false, created_at: \"2016-03-04 23:50:20\", updated_at: \"2016-03-04 23:50:20\", project_id: 1>]>\r\n```\r\n \r\nThis returns `ActiveRelation` object. Can we retrievel all the records?\r\n \r\n```ruby\r\n > p.tasks.where(complete: false).order(\'id DESC\').all\r\n  Task Load (0.1ms)  SELECT \"tasks\".* FROM \"tasks\" WHERE \"tasks\".\"project_id\" = ? AND \"tasks\".\"complete\" = ?  ORDER BY id DESC  [[\"project_id\", 1], [\"complete\", \"f\"]]\r\n => #<ActiveRecord::AssociationRelation [#<Task id: 1, name: \"Get rich quick\", complete: false, created_at: \"2016-03-04 23:50:20\", updated_at: \"2016-03-04 23:50:20\", project_id: 1>]>\r\n``` \r\n\r\nWe still get `ActiveRelation` object. We can use `to_a` method:\r\n \r\n```ruby\r\n> p.tasks.where(complete: false).order(\'id DESC\').to_a\r\n  Task Load (0.1ms)  SELECT \"tasks\".* FROM \"tasks\" WHERE \"tasks\".\"project_id\" = ? AND \"tasks\".\"complete\" = ?  ORDER BY id DESC  [[\"project_id\", 1], [\"complete\", \"f\"]]\r\n => [#<Task id: 1, name: \"Get rich quick\", complete: false, created_at: \"2016-03-04 23:50:20\", updated_at: \"2016-03-04 23:50:20\", project_id: 1>]\r\n```\r\n\r\nNow we have all the incomplete tasks for this project sorted in descending order.\r\n\r\n## Move Finders to Model\r\n \r\n We can move the finders to the model. In Task:\r\n \r\n ```ruby\r\n class Task < ActiveRecord::Base\r\n   belongs_to :project\r\n  \r\n   def self.find_incomplete\r\n      where(complete: false).order(\'id DESC\')\r\n   end\r\n end\r\n``` \r\n \r\nWe can call this method in the tasks controller:\r\n \r\n```ruby\r\ndef index\r\n  @tasks = Task.find_incomplete\r\nend\r\n\r\ndef show\r\n  @project = Project.find(params[:id])\r\n  @tasks = @project.tasks.find_incomplete\r\nend\r\n```\r\n\r\nLet\'s find a project:\r\n\r\n```ruby\r\n p = Project.find 1\r\n  Project Load (0.6ms)  SELECT  \"projects\".* FROM \"projects\" WHERE \"projects\".\"id\" = ? LIMIT 1  [[\"id\", 1]]\r\n => #<Project id: 1, name: \"Wealth Building\", created_at: \"2016-03-04 23:50:20\", updated_at: \"2016-03-04 23:50:20\"> \r\n```\r\n\r\nLet\'s find all the tasks for this project:\r\n\r\n```ruby\r\n > p.tasks\r\n  Task Load (0.2ms)  SELECT \"tasks\".* FROM \"tasks\" WHERE \"tasks\".\"project_id\" = ?  [[\"project_id\", 1]]\r\n => #<ActiveRecord::Associations::CollectionProxy [#<Task id: 1, name: \"Get rich quick\", complete: false, created_at: \"2016-03-04 23:50:20\", updated_at: \"2016-03-04 23:50:20\", project_id: 1>, #<Task id: 2, name: \"Write a book\", complete: true, created_at: \"2016-03-04 23:50:20\", updated_at: \"2016-03-04 23:50:20\", project_id: 1>]> \r\n```\r\n\r\nWe can now use `find_incomplete` method to find only the incomplete tasks:\r\n\r\n```ruby\r\n > p.tasks.find_incomplete\r\n  Task Load (0.2ms)  SELECT \"tasks\".* FROM \"tasks\" WHERE \"tasks\".\"project_id\" = ? AND \"tasks\".\"complete\" = ?  ORDER BY id DESC  [[\"project_id\", 1], [\"complete\", \"f\"]]\r\n => #<ActiveRecord::AssociationRelation [#<Task id: 1, name: \"Get rich quick\", complete: false, created_at: \"2016-03-04 23:50:20\", updated_at: \"2016-03-04 23:50:20\", project_id: 1>]>\r\n```\r\n\r\n## Scopes\r\n\r\nLet\'s define scopes for incomplete tasks and sorted tasks.\r\n\r\n```ruby\r\nclass Task < ActiveRecord::Base\r\n  belongs_to :project\r\n  \r\n  scope :incomplete, -> { where complete: false }\r\n  scope :sorted, -> { order(\'id DESC\') }\r\n\r\n  def self.find_incomplete\r\n     where(complete: false).order(\'id DESC\')\r\n  end\r\nend\r\n```\r\n\r\nWe can now play with this task in the rails console. We can retrieve all incomplete tasks:\r\n\r\n```ruby\r\n > Task.incomplete\r\n  Task Load (0.3ms)  SELECT \"tasks\".* FROM \"tasks\" WHERE \"tasks\".\"complete\" = ?  [[\"complete\", \"f\"]]\r\n => #<ActiveRecord::Relation [#<Task id: 1, name: \"Get rich quick\", complete: false, created_at: \"2016-03-04 23:50:20\", updated_at: \"2016-03-04 23:50:20\", project_id: 1>, #<Task id: 3, name: \"Buy a puppy\", complete: false, created_at: \"2016-03-04 23:50:20\", updated_at: \"2016-03-04 23:50:20\", project_id: 2>]> \r\n```\r\n\r\nWe can sort all tasks:\r\n\r\n```ruby\r\n > Task.sorted\r\n  Task Load (0.1ms)  SELECT \"tasks\".* FROM \"tasks\"  ORDER BY id DESC\r\n => #<ActiveRecord::Relation [#<Task id: 4, name: \"Dance in the rain\", complete: true, created_at: \"2016-03-04 23:50:20\", updated_at: \"2016-03-04 23:50:20\", project_id: 2>, #<Task id: 3, name: \"Buy a puppy\", complete: false, created_at: \"2016-03-04 23:50:20\", updated_at: \"2016-03-04 23:50:20\", project_id: 2>, #<Task id: 2, name: \"Write a book\", complete: true, created_at: \"2016-03-04 23:50:20\", updated_at: \"2016-03-04 23:50:20\", project_id: 1>, #<Task id: 1, name: \"Get rich quick\", complete: false, created_at: \"2016-03-04 23:50:20\", updated_at: \"2016-03-04 23:50:20\", project_id: 1>]> \r\n```\r\n \r\n## Merging of scopes\r\n\r\n Just like where clauses scopes are merged using AND conditions. We can mix and match scope and where conditions and the final sql will have all conditions joined with AND.\r\n\r\n```ruby \r\n > Task.incomplete.sorted\r\n  Task Load (0.2ms)  SELECT \"tasks\".* FROM \"tasks\" WHERE \"tasks\".\"complete\" = ?  ORDER BY id DESC  [[\"complete\", \"f\"]]\r\n => #<ActiveRecord::Relation [#<Task id: 3, name: \"Buy a puppy\", complete: false, created_at: \"2016-03-04 23:50:20\", updated_at: \"2016-03-04 23:50:20\", project_id: 2>, #<Task id: 1, name: \"Get rich quick\", complete: false, created_at: \"2016-03-04 23:50:20\", updated_at: \"2016-03-04 23:50:20\", project_id: 1>]> \r\n```\r\n\r\nYou can download the source code for this article from: `https://github.com/bparanj/doer`.\r\n\r\n## Summary\r\n\r\nIn this article, you learned how to retrieve records using `ActiveRelation` object, use scopes and use merged scopes.','2016-03-07 19:28:42','2016-03-07 20:09:35'),(3031,'Find Through Association','## Steps \r\n### Step 1\r\n\r\nLet\'s create a project resource.\r\n\r\n```\r\nrails g scaffold project name:string\r\n```\r\n\r\n### Step 2 \r\n\r\nDefine the has_many `ActiveRecord` association in the project model.\r\n\r\n```ruby\r\nclass Project < ActiveRecord::Base\r\n  has_many :tasks\r\nend\r\n```\r\n\r\n### Step 3\r\n\r\nDefine the belongs_to `ActiveRecord` association in the task model.\r\n\r\n```ruby\r\nclass Task < ActiveRecord::Base\r\n  belongs_to :project\r\nend\r\n```\r\n\r\n### Step 4\r\n\r\nTask belongs to a project. So add the foreign key `project_id` to the tasks table. Create the migration.\r\n\r\n```\r\nrails g migration add_project_id_to_tasks\r\n```\r\n\r\nAdd the column in the migration file.\r\n\r\n```ruby\r\nclass AddProjectIdToTasks < ActiveRecord::Migration\r\n  def change\r\n    add_column :tasks, :project_id, :integer\r\n  end\r\nend\r\n```\r\n\r\n### Step 5\r\n\r\nMigrate the database.\r\n\r\n```\r\nrake db:migrate\r\n```\r\n\r\n### Step 6\r\n\r\nIn seeds.rb, add:\r\n\r\n```ruby\r\nwealthy = Project.create(name: \'Wealth Building\')\r\nwealthy.tasks.create(name: \'Get rich quick\', complete: false)\r\nwealthy.tasks.create(name: \'Write a book\', complete: true)\r\n\r\nhappy = Project.create(name: \'Be Happy\')\r\nhappy.tasks.create(name: \'Buy a puppy\', complete: false)\r\nhappy.tasks.create(name: \'Dance in the rain\', complete: true)\r\n```\r\n\r\n### Step 7\r\n\r\nRun:\r\n\r\n```\r\nrake db:seed\r\n```\r\n\r\nto populate the data.\r\n\r\n### Step 8 \r\n\r\nLet\'s now play in the rails console.\r\n\r\n```ruby\r\n > Project.count\r\n   (0.1ms)  SELECT COUNT(*) FROM \"projects\"\r\n => 2 \r\n```\r\n\r\nThere are two projects.\r\n\r\n```ruby \r\n > Task.count\r\n   (0.1ms)  SELECT COUNT(*) FROM \"tasks\"\r\n => 4 \r\n```\r\n\r\nThere are 4 tasks. Let\'s find the incomplete tasks for the first project.\r\n\r\n```ruby  \r\n x = Task.where(project_id: 1).where(complete: false)\r\n  Task Load (0.3ms)  SELECT \"tasks\".* FROM \"tasks\" WHERE \"tasks\".\"project_id\" = ? AND \"tasks\".\"complete\" = ?  [[\"project_id\", 1], [\"complete\", \"f\"]]\r\n => #<ActiveRecord::Relation [#<Task id: 1, name: \"Get rich quick\", complete: false, created_at: \"2016-03-04 23:50:20\", updated_at: \"2016-03-04 23:50:20\", project_id: 1>]> \r\n```\r\n\r\nWe get `ActiveRecord::Relation` object as the result. We can find the first project.\r\n\r\n```ruby \r\n  > p = Project.find 1\r\n   Project Load (0.2ms)  SELECT  \"projects\".* FROM \"projects\" WHERE \"projects\".\"id\" = ? LIMIT 1  [[\"id\", 1]]\r\n  => #<Project id: 1, name: \"Wealth Building\", created_at: \"2016-03-04 23:50:20\", updated_at: \"2016-03-04 23:50:20\"> \r\n```\r\n\r\nNow we can use the association to make the query.\r\n\r\n```ruby \r\n >   p.tasks.where(complete: false).to_a\r\n  Task Load (0.1ms)  SELECT \"tasks\".* FROM \"tasks\" WHERE \"tasks\".\"project_id\" = ? AND \"tasks\".\"complete\" = ?  [[\"project_id\", 1], [\"complete\", \"f\"]]\r\n => [#<Task id: 1, name: \"Get rich quick\", complete: false, created_at: \"2016-03-04 23:50:20\", updated_at: \"2016-03-04 23:50:20\", project_id: 1>] \r\n``` \r\n\r\nTo force the database query and get the results we use `to_a`. There is one task that belongs to first project that is incomplete. If we don\'t use `to_a` method:\r\n\r\n```ruby\r\n  > p.tasks.where(complete: false)\r\n   Task Load (0.1ms)  SELECT \"tasks\".* FROM \"tasks\" WHERE \"tasks\".\"project_id\" = ? AND \"tasks\".\"complete\" = ?  [[\"project_id\", 1], [\"complete\", \"f\"]]\r\n  => #<ActiveRecord::AssociationRelation [#<Task id: 1, name: \"Get rich quick\", complete: false, created_at: \"2016-03-04 23:50:20\", updated_at: \"2016-03-04 23:50:20\", project_id: 1>]> \r\n```\r\n\r\nWe get `ActiveRecord::AssociationRelation` object as the result. In Rails 4.2, we no longer have `find_all_by_some_column(value)` available.\r\n\r\n```ruby \r\n > p.tasks.find_all_by_complete(false)\r\n NoMethodError:   Task Load (0.2ms)  SELECT \"tasks\".* FROM \"tasks\" WHERE \"tasks\".\"project_id\" = ?  [[\"project_id\", 1]]\r\n undefined method `find_all_by_complete\' for #<Task::ActiveRecord_Associations_CollectionProxy:0x007fe597001fe8>\r\n Did you mean?  find_or_create_by\r\n``` \r\n\r\n## Summary\r\n\r\nIn this article, you learned how to find records through the ActiveRecord association.\r\n','2016-03-07 20:29:21','2016-03-07 20:32:19'),(3041,'Dependency Inversion Principle','## Objective\r\n\r\nTo learn about Dependency Inversion Principle by examples.\r\n\r\n## Steps\r\n### Step 1\r\n\r\nLet\'s write a program to :\r\n\r\n1. Read from keyboard.\r\n2. Write to a terminal.\r\n\r\n```ruby\r\ndef copy\r\n message = gets\r\n puts message  \r\nend\r\n\r\ncopy\r\n```\r\n\r\nWe can run this:\r\n\r\n```\r\n$ ruby copy.rb\r\nHello\r\nHello\r\n```\r\n\r\n### Step 2\r\n\r\nWe now want to accommodate changes to our program that can:\r\n\r\n1. Read from a tape reader\r\n2. Write to a terminal\r\n\r\nHere is the modified program:\r\n\r\n```ruby\r\ndef read_tape\r\n  p \'Input from tape reader\'  \r\nend\r\n\r\ndef copy(tape_reader = false)\r\n  if tape_reader\r\n    message = read_tape\r\n  else\r\n    message = gets\r\n  end\r\n puts message  \r\nend\r\n\r\ncopy(true)\r\n```\r\n\r\nWe can run it:\r\n\r\n```\r\n$ ruby copy.rb\r\nInput from tape reader\r\nInput from tape reader\r\n```\r\n\r\n### Step 3\r\n\r\nWe now need to accommodate changes to our program that can:\r\n\r\n1. Read from tape reader as before\r\n2. Write to paper tape punch\r\n\r\nHere is the modified program:\r\n\r\n```ruby\r\ndef read_tape\r\n  p \'Input from tape reader\'  \r\nend\r\n\r\ndef write_to_paper_tape_punch(output)\r\n  p \'Output to paper tape punch\'  \r\nend\r\n\r\ndef copy(tape_reader = false, paper_tape_punch = false)\r\n  if tape_reader\r\n    message = read_tape\r\n  else\r\n    message = gets\r\n  end\r\n  if paper_tape_punch\r\n    write_to_paper_tape_punch(message)\r\n  else\r\n     puts message    \r\n  end\r\nend\r\n\r\ncopy(true, true)\r\n```\r\n\r\nThe solution is becoming messy with lot of conditionals. When we add more types of input and output coding down this path will lead to very difficult to maintain codebase. \r\n\r\n## Applying Good Design Principles\r\n\r\nWe will apply the following three basic principles:\r\n\r\n-    Separate things that change from things that stays the same. Encapsulate what varies behind a well-defined interface.\r\n-    Program to interfaces, not implementations. This exploits polymorphism.\r\n-    Depend on abstractions. Do not depend on concrete classes.\r\n\r\nThe input device and output device can change. We can encapsulate them behind the interfaces named **read** and **write**. The code must use the newly defined **read** and **write** interfaces. This results in the code depending on abstractions.\r\n\r\n```ruby\r\nclass Copier\r\n  def initialize(reader, writer)\r\n    @reader, @writer = reader, writer\r\n  end\r\n  \r\n  def copy\r\n    message = @reader.read\r\n    @writer.write(message)\r\n  end\r\nend\r\n\r\nclass KeyboardReader\r\n  def read\r\n    gets\r\n  end\r\nend\r\n\r\nclass PrinterWriter\r\n  def write(output)\r\n    p \"Writing #{output} to printer\"\r\n  end\r\nend\r\n```\r\n\r\nCopier class now depends on stable interface **read** and **write**. The implementation of KeyboardReader and PrinterWriter is now hidden behind the well defined **read** and **write** interface. We can use this new design to copy from any input source to any output source without modifying the Copier class.\r\n\r\n```ruby\r\nreader = KeyboardReader.new\r\nwriter = PrinterWriter.new\r\n\r\ncopier = Copier.new(reader, writer)\r\ncopier.copy\r\n```\r\n\r\nWe can run this program.\r\n\r\n```\r\n$ ruby copy.rb\r\nThis is a test\r\n\"Writing This is a test\\n to printer\"\r\n```\r\n\r\n## Dependency Inversion Principle\r\n\r\nIt states:\r\n\r\n- Details should depend on abstractions.\r\n- Abstractions should not depend on details.\r\n- High level modules should not depend upon low level modules. Both should depend upon abstractions.\r\n\r\nCompare the dependency of:\r\n\r\nCopy \r\nRead Keyboard WriterPrinter\r\n\r\nvs\r\n\r\nCopy\r\n\r\nReader Writer\r\nKeyboardReader PrinterWriter\r\n\r\nThe interface in KeyboardReader and PrinterWriter is implicit in Ruby. We conform to the read and write interface instead of explicitly saying we implement those interfaces in the code. The copier class is reusable with different input and output devices.\r\n\r\n## Code Breaker Game Example\r\n\r\nLet\'s look at the code example for Codebreaker game from **The Rspec Book**. The solution in the book does not apply the DIP. \r\n\r\n### Before\r\n\r\n```ruby\r\nmodule Codebreaker\r\n  class Game\r\n    def initialize(output)\r\n      @output = output\r\n    end\r\n\r\n    def start(secret)\r\n      @secret = secret\r\n      @output.puts \'Welcome to Codebreaker!\'\r\n      @output.puts \'Enter guess:\'\r\n    end\r\n  end\r\nend\r\n\r\ng = Codebreaker::Game.new($stdout)\r\ng.start(\'sekret\')\r\n```\r\n\r\nThis is a good example that shows using BDD or TDD does not make the design emerge magically. You must apply good design principles consciously and deliberately. Let\'s look at the solution after applying the DIP. \r\n\r\n### After\r\n\r\n```ruby\r\nmodule Codebreaker\r\n  class Game\r\n    def initialize(writer)\r\n      @writer = writer\r\n    end\r\n\r\n    def start(secret)\r\n      @secret = secret\r\n      @writer.write \'Welcome to Codebreaker!\'\r\n      @writer.write \'Enter guess:\'\r\n    end\r\n  end\r\nend\r\n\r\nclass StandardConsole\r\n  def write(message)\r\n    $stdout.puts(message)\r\n  end  \r\nend\r\n\r\nwriter = StandardConsole.new\r\ng = Codebreaker::Game.new(writer)\r\ng.start(\'sekret\')\r\n``` \r\n\r\nIt\'s surprising to find coding solution from a published book that has gone through technical review come up short in design.\r\n\r\n## Summary\r\n\r\nIn this article, we applied the three basic principles of good design:\r\n\r\n1. Separate things that is likely to vary\r\n2. Hide them behind a well defined interface\r\n3. Write your program to use the stable interfaces instead of depending on concrete details.\r\n\r\nto come up with a flexible design that is easy to maintain and extend.\r\n','2016-03-08 04:36:17','2016-03-09 05:05:28'),(3051,'Chaining ActiveRecord::Relation Methods in Rails 5','## Objective\r\n\r\nTo learn the alternative to `with_scope` that is no longer available in Rails 5.\r\n\r\n## Steps\r\n\r\n### Step 1\r\n\r\nThe task model has a `find_incomplete` class method that finds all the incomplete tasks ordered by most recent first.\r\n\r\n```ruby\r\nclass Task < ApplicationRecord\r\n  belongs_to :project\r\n  \r\n  def self.find_incomplete\r\n    where(complete: false).order(\'created_at DESC\')\r\n  end\r\nend\r\n```\r\n\r\n### Step 2\r\n\r\nIn the rails console, we can call it.\r\n\r\n```ruby\r\nTask.find_incomplete\r\n  Task Load (0.2ms)  SELECT \"tasks\".* FROM \"tasks\" WHERE \"tasks\".\"complete\" = ? ORDER BY created_at DESC  [[\"complete\", false]]\r\n => #<ActiveRecord::Relation [#<Task id: 3, name: \"Buy a puppy\", complete: false, created_at: \"2016-03-10 00:48:39\", updated_at: \"2016-03-10 00:48:39\">, #<Task id: 1, name: \"Get rich quick\", complete: false, created_at: \"2016-03-10 00:48:39\", updated_at: \"2016-03-10 00:48:39\">]> \r\n```\r\n\r\nThis returns an `ActiveRecord::Relation` object.\r\n\r\n### Step 3\r\n \r\nCan we use `with_scope` to limit the number of results in the query?\r\n\r\n```ruby \r\ndef self.find_incomplete(options = {})\r\n  with_scope find: options do\r\n    where(complete: false).order(\'created_at DESC\')\r\n  end\r\nend\r\n```\r\n\r\nNo, we cannot, it gives an error:\r\n\r\n``` \r\nNoMethodError: undefined method `with_scope\' for Task (call \'Task.connection\' to establish a connection):Class\r\nDid you mean?  with_options\r\n```\r\n\r\nThe `with_scope` was removed from Rails 4. Last version that had this method was Rails 3.1.\r\n \r\n### Step 4\r\n\r\nWe can chain the `ActiveRecord::Relation` methods to limit the result set.\r\n\r\n```ruby \r\nclass Task < ApplicationRecord\r\n  belongs_to :project\r\n  \r\n  def self.find_incomplete(limit)\r\n    where(complete: false).order(\'created_at DESC\').limit(limit)\r\n  end\r\nend\r\n```\r\n\r\n### Step 5\r\n\r\nWe can now limit the result set.\r\n \r\n```ruby\r\n > Task.find_incomplete 1\r\n   Task Load (0.2ms)  SELECT  \"tasks\".* FROM \"tasks\" WHERE \"tasks\".\"complete\" = ? ORDER BY created_at DESC LIMIT ?  [[\"complete\", false], [\"LIMIT\", 1]]\r\n  => #<ActiveRecord::Relation [#<Task id: 3, name: \"Buy a puppy\", complete: false, created_at: \"2016-03-10 00:48:39\", updated_at: \"2016-03-10 00:48:39\">]> \r\n```\r\n\r\nYou can use also use keyword arguments to make the interface more friendly:\r\n\r\n```ruby \r\nclass Task < ApplicationRecord\r\n  belongs_to :project\r\n  \r\n  def self.find_incomplete(limit: 1)\r\n    where(complete: false).order(\'created_at DESC\').limit(limit)\r\n  end\r\nend\r\n```\r\n\r\nYou can use the keyword arguments like this:\r\n\r\n```ruby\r\n > Task.find_incomplete(limit: 2)\r\n  Task Load (0.4ms)  SELECT  \"tasks\".* FROM \"tasks\" WHERE \"tasks\".\"complete\" = ? ORDER BY created_at DESC LIMIT ?  [[\"complete\", false], [\"LIMIT\", 2]]\r\n => #<ActiveRecord::Relation [#<Task id: 7, name: \"Buy a puppy\", complete: false, created_at: \"2016-03-10 01:28:27\", updated_at: \"2016-03-10 01:28:27\", project_id: 4>, #<Task id: 5, name: \"Get rich quick\", complete: false, created_at: \"2016-03-10 01:28:27\", updated_at: \"2016-03-10 01:28:27\", project_id: 3>]>\r\n```\r\n \r\n### Step 6\r\n\r\nLet\'s create a project resource.\r\n\r\n```ruby \r\nrails g scaffold project name:string\r\n```\r\n\r\n### Step 7\r\n\r\nCreate sample data in seeds.rb.\r\n \r\n```ruby \r\nwealthy = Project.create(name: \'Wealth Building\')\r\nwealthy.tasks.create(name: \'Get rich quick\', complete: false)\r\nwealthy.tasks.create(name: \'Write a book\', complete: true)\r\n\r\nhappy = Project.create(name: \'Be Happy\')\r\nhappy.tasks.create(name: \'Buy a puppy\', complete: false)\r\nhappy.tasks.create(name: \'Dance in the rain\', complete: true)\r\n```\r\n\r\n### Step 8\r\n\r\nDefine the `has_many` declaration in the project model.\r\n \r\n```ruby \r\nclass Project < ApplicationRecord\r\n  has_many :tasks\r\nend\r\n```\r\n\r\n### Step 9\r\n\r\nCreate the migration to add the `project_id` foreign key to the tasks table.\r\n\r\n```\r\nrails g migration add_project_id_to_tasks project_id:integer\r\n```\r\n  \r\n### Step 10\r\n \r\nCreate the table and populate the database.\r\n  \r\n```  \r\nrails db:migrate\r\nrails db:seed\r\n```  \r\n\r\n### Step 11\r\n\r\nWe can now use the `find_incomplete` that limits the result set through the `has_many` association.\r\n\r\n```ruby  \r\n> p = Project.find 1\r\n    Project Load (0.2ms)  SELECT  \"projects\".* FROM \"projects\" WHERE \"projects\".\"id\" = ? LIMIT ?  [[\"id\", 1], [\"LIMIT\", 1]]\r\n   => #<Project id: 1, name: \"Wealth Building\", created_at: \"2016-03-10 01:26:12\", updated_at: \"2016-03-10 01:26:12\"> \r\n   > tasks = p.tasks.find_incomplete(1)\r\n    Task Load (0.1ms)  SELECT  \"tasks\".* FROM \"tasks\" WHERE \"tasks\".\"project_id\" = ? AND \"tasks\".\"complete\" = ? ORDER BY created_at DESC LIMIT ?  [[\"project_id\", 1], [\"complete\", false], [\"LIMIT\", 1]]\r\n   => #<ActiveRecord::AssociationRelation []>\r\n```  \r\n\r\n## Summary\r\n\r\nIn this article, you learned how to chain `ActiveRecord::Relation` methods to limit result set.','2016-03-10 05:35:15','2016-03-10 05:52:59'),(3061,'Shortcut Blocks with Symbol to_proc in Rails 5','## Objective\r\n\r\nTo learn how to use `Symbol#to_proc` shortcut with ActiveRecord in Rails 5.\r\n\r\n## Steps\r\n\r\n### Step 1\r\n\r\nLet\'s load all the projects.\r\n\r\n```ruby\r\n > projects = Project.all\r\n  Project Load (1.3ms)  SELECT \"projects\".* FROM \"projects\"\r\n => #<ActiveRecord::Relation [#<Project id: 1, name: \"Wealth Building\", created_at: \"2016-03-10 01:26:12\", updated_at: \"2016-03-10 01:26:12\">, #<Project id: 2, name: \"Wealth Building\", created_at: \"2016-03-10 01:26:36\", updated_at: \"2016-03-10 01:26:36\">, #<Project id: 3, name: \"Wealth Building\", created_at: \"2016-03-10 01:28:27\", updated_at: \"2016-03-10 01:28:27\">, #<Project id: 4, name: \"Be Happy\", created_at: \"2016-03-10 01:28:27\", updated_at: \"2016-03-10 01:28:27\">]> \r\n > names = projects.collect {|p| p.name}\r\n => [\"Wealth Building\", \"Wealth Building\", \"Wealth Building\", \"Be Happy\"] \r\n```\r\n\r\n### Step 2\r\n\r\nWe have 4 projects and 8 tasks.\r\n\r\n```ruby\r\n > Project.count\r\n   (0.1ms)  SELECT COUNT(*) FROM \"projects\"\r\n => 4 \r\n > Task.count\r\n   (0.1ms)  SELECT COUNT(*) FROM \"tasks\"\r\n => 8 \r\n```\r\n\r\n### Step 3\r\n\r\nWe can use `Symbol#to_proc` method to get the names of all projects.\r\n\r\n```ruby \r\n > projects.collect(&:name)\r\n => [\"Wealth Building\", \"Wealth Building\", \"Wealth Building\", \"Be Happy\"] \r\n```\r\n\r\n### Step 4\r\n\r\nWe can check if all projects are valid.\r\n\r\n```ruby\r\n > projects.all?(&:valid?)\r\n => true \r\n```\r\n\r\n### Step 5\r\n\r\nWe can check if any of the project is valid.\r\n \r\n```ruby \r\n > projects.any?(&:valid?)\r\n => true \r\n```\r\n\r\n### Step 6\r\n\r\nWe can save all the projects using the `Symbol#to_proc` shortcut.\r\n \r\n```ruby \r\n > projects.each(&:save!)\r\n   (0.1ms)  begin transaction\r\n   (0.1ms)  commit transaction\r\n   (0.0ms)  begin transaction\r\n   (0.0ms)  commit transaction\r\n   (0.0ms)  begin transaction\r\n   (0.0ms)  commit transaction\r\n   (0.0ms)  begin transaction\r\n   (0.0ms)  commit transaction\r\n => [#<Project id: 1, name: \"Wealth Building\", created_at: \"2016-03-10 01:26:12\", updated_at: \"2016-03-10 01:26:12\">, #<Project id: 2, name: \"Wealth Building\", created_at: \"2016-03-10 01:26:36\", updated_at: \"2016-03-10 01:26:36\">, #<Project id: 3, name: \"Wealth Building\", created_at: \"2016-03-10 01:28:27\", updated_at: \"2016-03-10 01:28:27\">, #<Project id: 4, name: \"Be Happy\", created_at: \"2016-03-10 01:28:27\", updated_at: \"2016-03-10 01:28:27\">] \r\n```\r\n\r\n### Step 7\r\n\r\nWe can list all the names of the projects using the ampersand shortcut:\r\n\r\n```ruby\r\n> all_names = Project.all.collect(&:name)\r\n  Project Load (0.2ms)  SELECT \"projects\".* FROM \"projects\"\r\n => [\"Wealth Building\", \"Wealth Building\", \"Wealth Building\", \"Be Happy\"] \r\n```\r\n\r\n### Step 8\r\n\r\nWe can use the ampersand shortcut in the project model.\r\n\r\n```ruby\r\nclass Project < ApplicationRecord\r\n  has_many :tasks\r\n  \r\n  def self.all_names\r\n    all.collect(&:name)\r\n  end\r\nend\r\n```\r\n\r\n## Summary\r\n\r\nIn this article, you learned how to use the `Symbol#to_proc` shortcut operator ampersand.','2016-03-10 05:55:06','2016-03-10 05:55:59'),(3071,'Layouts in Rails 5','## Objective\r\n\r\nTo learn about layouts in Rails 5 and how to customize it.\r\n\r\n## Steps\r\n\r\n### Step 1\r\n\r\nThe application wide layout is in `app/views/layouts/application.html.erb`:\r\n\r\n```ruby\r\n<!DOCTYPE html>\r\n<html>\r\n  <head>\r\n    <title>Blog5</title>\r\n    <%= csrf_meta_tags %>\r\n    <%= action_cable_meta_tag %>\r\n\r\n    <%= stylesheet_link_tag    \'application\', media: \'all\', \'data-turbolinks-track\' => \'reload\' %>\r\n    <%= javascript_include_tag \'application\', \'data-turbolinks-track\' => \'reload\' %>\r\n  </head>\r\n\r\n  <body>\r\n    <%= yield %>\r\n  </body>\r\n</html>\r\n```\r\n\r\n### Step 2\r\n\r\nThe projects index page lists all the projects. In `app/views/projects/index.html.erb`:\r\n\r\n```ruby\r\n<h1>Projects</h1>\r\n\r\n<table>\r\n  <thead>\r\n    <tr>\r\n      <th>Name</th>\r\n      <th colspan=\"3\"></th>\r\n    </tr>\r\n  </thead>\r\n\r\n  <tbody>\r\n    <% @projects.each do |project| %>\r\n      <tr>\r\n        <td><%= project.name %></td>\r\n      </tr>\r\n    <% end %>\r\n  </tbody>\r\n</table>\r\n```\r\n\r\n### Step 3\r\n\r\nYou can view page source to see the application layout provided title and other html tags.\r\n\r\n```ruby\r\n<!DOCTYPE html>\r\n<html>\r\n  <head>\r\n    <title>Blog5</title>\r\n  ...\r\n  </head>\r\n\r\n  <body>\r\n\r\n<h1>Projects</h1>\r\n\r\n<table>\r\n  <thead>\r\n    <tr>\r\n      <th>Name</th>\r\n      <th colspan=\"3\"></th>\r\n    </tr>\r\n  </thead>\r\n\r\n  <tbody>\r\n      <tr>\r\n        <td>Wealth Building</td>\r\n      </tr>\r\n      <tr>\r\n        <td>Be Happy</td>\r\n      </tr>\r\n  </tbody>\r\n</table>\r\n\r\n  </body>\r\n</html>\r\n```\r\n\r\n### Step 4\r\n\r\nWe can create a admin layout in `app/views/layouts/admin.html.erb`:\r\n\r\n```ruby\r\n<h1>Admin layout</h1>\r\n\r\n<%= yield %>\r\n```\r\n\r\nThis can be used in the projects controller with the `layout` method.\r\n\r\n```ruby\r\nclass ProjectsController < ApplicationController\r\n  layout \'admin\'\r\n  ...\r\nend\r\n```\r\n\r\nReload the projects index page to see admin layout displayed in the view.\r\n\r\n### Step 5\r\n\r\nCreate a controller specific layout in `app/views/layouts/projects.html.erb`:\r\n\r\n```ruby\r\n<h1>Projects layout</h1>\r\n\r\n<%= yield %>\r\n```\r\n\r\nProjects controller will use projects layout by default. Reload the projects index page to see the projects layout in action.\r\n\r\n### Step 6\r\n\r\nLet\'s now look at how to use dynamic layouts. We can use the `layout` method in the projects controller:\r\n\r\n```ruby\r\nlayout :user_layout \r\n```\r\n\r\nand define `user_layout` method to dynamically change the layout based on some condition.\r\n\r\n```ruby\r\nprivate\r\n\r\ndef user_layout\r\n  if admin?\r\n    \'admin\'\r\n  else\r\n    \'application\'\r\n  end\r\nend\r\n\r\ndef admin?\r\n  false\r\nend\r\n```\r\n\r\nThe original railscast defines these methods with `protected` access. This is not necessary. We can make it `private`.\r\n\r\n### Step 7\r\n\r\nWe can restrict the layout to a single action in a controller by using the `render` method.\r\n\r\n```ruby\r\ndef index\r\n  @projects = Project.all\r\n    \r\n  render layout: \'admin\'\r\nend\r\n```\r\n\r\nYou can download the source code for this article from https://github.com/bparanj/blog5.\r\n\r\n## Summary\r\n\r\nIn this article, you learned that application layout will be used by default if no other layout is specified. We can over-ride the layout per controller basis. We can also define dynamic layout based on custom logic.','2016-03-11 05:25:17','2016-03-11 05:28:26'),(3081,'Layouts and Content For Tag in Rails 5','## Objective\r\n\r\nTo learn how to use `content_for` tag with layouts in Rails 5.\r\n\r\n## Steps \r\n### Step 1\r\n\r\nIn Rails 5, the application layout `app/views/layouts/application.html.erb` file looks like this:\r\n\r\n```ruby\r\n<!DOCTYPE html>\r\n<html>\r\n  <head>\r\n    <title>Todo List</title>\r\n    <%= csrf_meta_tags %>\r\n    <%= action_cable_meta_tag %>\r\n\r\n    <%= stylesheet_link_tag    \'application\', media: \'all\', \'data-turbolinks-track\' => \'reload\' %>\r\n    <%= javascript_include_tag \'application\', \'data-turbolinks-track\' => \'reload\' %>\r\n  </head>\r\n\r\n  <body>\r\n	 <div id=\'container\'>\r\n		 <h1>Todo List</h1>\r\n	 	    <%= yield %>\r\n	 </div>\r\n  </body>\r\n</html>\r\n```\r\n\r\n### Step 2\r\n\r\nIn `app/views/projects/index.html.erb`, we can list the projects to be displayed in the projects index page:\r\n\r\n```ruby\r\n<h1>Projects</h1>\r\n<table>\r\n  <thead>\r\n    <tr>\r\n      <th>Name</th>\r\n      <th colspan=\"3\"></th>\r\n    </tr>\r\n  </thead>\r\n\r\n  <tbody>\r\n    <% @projects.each do |project| %>\r\n      <tr>\r\n        <td><%= project.name %></td>\r\n      </tr>\r\n    <% end %>\r\n  </tbody>\r\n</table>\r\n```\r\n\r\n### Step 3\r\n\r\nAdd :\r\n\r\n```ruby\r\n<% content_for :head do %>\r\n This is the content for head\r\n<% end %>\r\n```\r\n\r\nto the top of `app/views/projects/index.html.erb`:\r\n\r\n### Step 4\r\n\r\nAdd the `yield :head` in `app/views/layouts/application.html.erb`:\r\n\r\n```ruby\r\n<head>\r\n  <title>Todo List</title>\r\n	....\r\n	<%= yield :head %>\r\n</head>\r\n```\r\n\r\n### Step 5\r\n\r\nReload the projects index page. You will see the content for the head section.\r\n\r\n### Step 6\r\n\r\nLet\'s add a footer section in the layout file:\r\n\r\n```ruby\r\n<!DOCTYPE html>\r\n<html>\r\n  <head>\r\n    <title>Todo List</title>\r\n    <%= csrf_meta_tags %>\r\n    <%= action_cable_meta_tag %>\r\n\r\n    <%= stylesheet_link_tag    \'application\', media: \'all\', \'data-turbolinks-track\' => \'reload\' %>\r\n    <%= javascript_include_tag \'application\', \'data-turbolinks-track\' => \'reload\' %>\r\n	<%= yield :head %>\r\n  </head>\r\n\r\n  <body>\r\n	 <div id=\'container\'>\r\n		 <h1>Todo List</h1>\r\n	 	    <%= yield %>\r\n	 </div>\r\n  </body>\r\n  \r\n  <%= yield :footer %>\r\n  \r\n</html>\r\n```\r\n\r\n### Step 7\r\n\r\nLet\'s provide the content for the footer section in `app/views/projects/index.html.erb`:\r\n\r\n```ruby\r\n<% content_for :footer do %>\r\n  This is the footer\r\n<% end %>\r\n```\r\n\r\n### Step 8\r\n\r\nFor the page to load faster move the javascript tag just before the body tag closes. This allows the browser to load the DOM elements without getting blocked by loading javascript. This will work if you are not depending on javascript to load any html elements.\r\n\r\n```ruby\r\n<!DOCTYPE html>\r\n<html>\r\n  <head>\r\n    <title>Todo List</title>\r\n    <%= csrf_meta_tags %>\r\n    <%= action_cable_meta_tag %>\r\n\r\n    <%= stylesheet_link_tag    \'application\', media: \'all\', \'data-turbolinks-track\' => \'reload\' %>\r\n    \r\n	<%= yield :head %>\r\n  </head>\r\n\r\n  <body>\r\n	 <div id=\'container\'>\r\n		 <h1>Todo List</h1>\r\n	 	    <%= yield %>\r\n	 </div>\r\n	 <-----	 THIS IS THE NEW LOCATION OF JAVASCRIPT INCLUDE TAG ----->\r\n	 <%= javascript_include_tag \'application\', \'data-turbolinks-track\' => \'reload\' %>\r\n  </body>\r\n  \r\n  <%= yield :footer %>\r\n  \r\n</html>\r\n```\r\n\r\n## Summary\r\n\r\nIn this article, you learned how to use content_for tag to customize layouts. It is similar to tiles in Java.','2016-03-12 07:52:09','2016-03-12 08:04:29'),(3091,'Filtering Sensitive Parameters from Log Files in Rails 5','## Objective\r\n\r\nTo learn how to avoid sensitive information from getting written to log files in Rails 5.\r\n\r\n## Steps\r\n\r\n### Step 1\r\n\r\nLet\'s add password to the users table.\r\n\r\n```\r\nrails g migration add_password_to_users password:string\r\n```\r\n\r\nThis creates the migration file:\r\n\r\n```ruby\r\nclass AddPasswordToUsers < ActiveRecord::Migration[5.0]\r\n  def change\r\n    add_column :users, :password, :string\r\n  end\r\nend\r\n```\r\n\r\nMigrate the database:\r\n\r\n```\r\nrails db:migrate\r\n```\r\n \r\n### Step 2\r\n\r\nCreate the form to catpure the name, password and password confirmation in `app/views/users/new.html.erb`:\r\n\r\n```ruby\r\n<%= form_for(@user) do |f| %>\r\n  <div class=\"field\">\r\n    <%= f.label :name %>\r\n    <%= f.text_field :first_name %>\r\n  </div>\r\n\r\n  <div class=\"field\">\r\n    <%= f.label :password %>\r\n    <%= f.password_field :password %>\r\n  </div>\r\n\r\n  <div class=\"field\">\r\n    <%= f.label :password_confirmation %>\r\n    <%= f.password_field :password_confirmation %>\r\n  </div>\r\n\r\n  <div class=\"actions\">\r\n    <%= f.submit %>\r\n  </div>\r\n<% end %>\r\n```\r\n\r\n### Step 3\r\n\r\nDefine the routes for user registration in routes.rb.\r\n\r\n```\r\nresources :users, only: [:index, :show, :new, :create]\r\n```\r\n  \r\n### Step 4\r\n \r\nBrowse to `http://localhost:3000/users/new`. Fill out and submit the form.\r\n\r\n### Step 5\r\n\r\nYou will see the parameters sent to the server and the generated SQL query in the `log/development.log` file:\r\n\r\n```\r\nStarted POST \"/users\" for ::1 at 2016-03-11 11:25:56 -0800\r\nProcessing by UsersController#create as HTML\r\n  Parameters: {\"utf8\"=>\"✓\", \"authenticity_token\"=>\"mxQJeccoEACaEUpJ/6O5JRN2CWbZ6vEOx+2b105w+ggijku9S+LloCGIey1TtyCFy1eV6yDky10KBW71+LxyrQ==\", \"user\"=>{\"first_name\"=>\"Juggy Head\", \"password\"=>\"[FILTERED]\", \"password_confirmation\"=>\"[FILTERED]\"}, \"commit\"=>\"Create user\"}\r\nUnpermitted parameter: password_confirmation\r\n   (0.1ms)  begin transaction\r\n  SQL (0.8ms)  INSERT INTO \"users\" (\"first_name\", \"created_at\", \"updated_at\", \"password\") VALUES (?, ?, ?, ?)  [[\"first_name\", \"Juggy Head\"], [\"created_at\", 2016-03-11 19:25:56 UTC], [\"updated_at\", 2016-03-11 19:25:56 UTC], [\"password\", \"123456\"]]\r\n   (0.5ms)  commit transaction\r\nNo template found for UsersController#create, rendering head :no_content\r\nCompleted 204 No Content in 15ms (ActiveRecord: 2.2ms)\r\n```\r\n\r\nYou can see that the password and password confirmation values are filtered in the log file.\r\n\r\n### Step 6\r\n \r\nRails automatically creates `filter_parameter_logging.rb` in `config/initializers` folder:\r\n\r\n```ruby \r\n# Be sure to restart your server when you modify this file.\r\n\r\n# Configure sensitive parameters which will be filtered from the log file.\r\nRails.application.config.filter_parameters += [:password]\r\n```\r\n\r\nNo need to add `:password_confirmation` to this list. Rails automatically filters out `password_confirmation`. You can add other sensitive fields to this:\r\n\r\n```ruby\r\nRails.application.config.filter_parameters += [:password, :credit_card]\r\n```\r\n\r\n## Summary\r\n\r\nIn this article, you learned how to filter sensitive parameters from getting logged in the log files in Rails 5.','2016-03-12 08:55:23','2016-03-12 08:56:44'),(3101,'Refactoring User Name in Rails 5 App','## Objective\r\n\r\nTo learn how to refactor logic in the view.\r\n\r\n## Steps\r\n### Step 1\r\n\r\nCreate a user model that has `first_name`, `middle_initial` and `last_name` fields.\r\n\r\n```ruby\r\nrails g model user first_name:string middle_initial:string last_name:string\r\n```\r\n\r\n### Step 2\r\n\r\nCreate a users controller with index and show actions.\r\n\r\n```ruby\r\nrails g controller users index show\r\n```\r\n\r\n### Step 3\r\n\r\nCreate sample data to populate the database. In seeds.rb:\r\n\r\n```ruby\r\nUser.create(first_name: \'Bugs\', last_name: \'Bunny\')\r\nUser.create(first_name: \'Daffy\', last_name: \'Duck\')\r\nUser.create(first_name: \'Yosemite\', middle_initial: \'Funny\', last_name: \'Sam\')\r\nUser.create(first_name: \'David\', middle_initial: \'Avacodo\', last_name: \'Wolfe\')\r\n```\r\n\r\nNuke the database.\r\n\r\n```\r\nrake db:drop \r\n```\r\n\r\nRecreate the tables.\r\n\r\n```\r\nrake db:migrate\r\n```\r\n\r\nPopulate the users table.\r\n\r\n```\r\nrake db:seed \r\n```\r\n\r\n### Step 4\r\n\r\nDefine the users resource in routes.rb:\r\n\r\n```ruby\r\nresources :users, only: [:index, :show]\r\n```\r\n\r\n### Step 5\r\n\r\nThe users controller looks like this:\r\n\r\n```ruby\r\nclass UsersController < ApplicationController\r\n  def index\r\n    @users = User.all\r\n  end\r\n\r\n  def show\r\n  end\r\nend\r\n```\r\n  \r\n### Step 6\r\n\r\nDisplay list of users in `app/views/users/index.html.erb`:\r\n\r\n```ruby\r\n<h1>Users</h1>\r\n<ul>\r\n<% for user in @users %>\r\n<li>\r\n  <a href=\"<%= user_path(user) %>\">\r\n    <%= user.first_name %>\r\n    <%= \"#{user.middle_initial}.\" unless user.middle_initial.nil? %>\r\n    <%= user.last_name %>\r\n  </a>\r\n</li>\r\n<% end %>\r\n</ul>\r\n```\r\n\r\nClicking a user showes their profile. Some users have middle initial.\r\n\r\n### Step 7\r\n\r\nHere is the users controller, show action:\r\n\r\n```ruby\r\ndef show\r\n  @user = User.find(params[:id])\r\nend\r\n```\r\n\r\n### Before Refactor\r\n\r\nThe profile page in `app/views/users/show.html.erb` looks like this:\r\n\r\n```ruby\r\n<h1>Profile</h1>\r\n<p>\r\n  Name:\r\n  <%= @user.first_name %>\r\n  <%= \"#{@user.middle_initial}.\" unless @user.middle_initial.nil? %>\r\n  <%= @user.last_name %>\r\n</p>\r\n<%= link_to \'Users List\', users_path %>\r\n```\r\n\r\n### Step 8\r\n\r\nLet\'s move the logic from the view to the model.\r\n\r\n```ruby\r\nclass User < ActiveRecord::Base\r\n  def full_name\r\n    name = first_name + \' \'\r\n    name += \"#{middle_initial}. \" unless middle_initial.nil?\r\n    name += last_name\r\n    name\r\n  end\r\nend\r\n```\r\n\r\n### Step 9\r\n\r\nWe can now use it in the list view:\r\n\r\n```ruby\r\n<a href=\"<%= user_path(user) %>\">\r\n  <%= user.full_name %>\r\n</a>\r\n```\r\n\r\n### Step 10\r\n\r\nWe can simplify the view by using `link_to` helper in index page:\r\n\r\n```ruby\r\n<%= link_to user.full_name, user_path(user) %>\r\n```\r\n\r\n### After Refactor\r\n\r\nThe list view looks like this:\r\n\r\n```ruby\r\n<h1>Users</h1>\r\n<ul>\r\n<% for user in @users %>\r\n<li>\r\n	<%= link_to user.full_name, user %>\r\n</li>\r\n<% end %>\r\n</ul>\r\n```\r\n\r\nThe profile page looks like this:\r\n\r\n```ruby\r\n<h1>Profile</h1>\r\n<p>\r\n  Name:\r\n  <%= @user.full_name %>\r\n</p>\r\n<%= link_to \'Users List\', users_path %>\r\n```\r\n\r\n### Tip 1\r\n\r\nFor better performance, avoid using `+=` to concatenate strings in favor of `<<` method.\r\n\r\n```ruby\r\nclass User < ApplicationRecord\r\n  def full_name\r\n    name = first_name + \' \'\r\n    name << \"#{middle_initial}. \" unless middle_initial.nil?\r\n    name << last_name\r\n  end\r\nend\r\n```\r\n\r\nRead [Ruby Performance Tricks](http://greyblake.com/blog/2012/09/02/ruby-perfomance-tricks/ \'Ruby Performance Tricks\') for more details.\r\n\r\n### Tip 2\r\n\r\nThe `full_name` method is focused on massaging the data for display in view. This is better implemented as a view helper. We will cover this topic in an upcoming article.\r\n\r\n## Summary\r\n\r\nIn this article, you learned how to refactor logic in the view and move them into the model.','2016-03-12 18:36:19','2016-03-12 18:40:59'),(3111,'Model Tests in Rails 5','## Objective\r\n\r\nTo learn how to write model tests in Rails 5.\r\n\r\n## Steps \r\n### Step 1\r\n\r\nChange the `test/models/user_test.rb` as follows:\r\n\r\n```ruby\r\nrequire \'test_helper\'\r\n\r\nclass UserTest < ActiveSupport::TestCase\r\n  test \"test full name without middle initial\" do\r\n    assert true\r\n  end\r\nend\r\n```\r\n\r\n### Step 2\r\n\r\nRun the test:\r\n\r\n```\r\nrails test:models\r\nRun options: --seed 61892\r\n\r\n# Running:\r\n\r\n.\r\n\r\nFinished in 0.024655s, 40.5594 runs/s, 40.5594 assertions/s.\r\n\r\n1 runs, 1 assertions, 0 failures, 0 errors, 0 skips\r\n```\r\n\r\n### Step 3\r\n\r\nLet\'s now write a real test.\r\n\r\n```ruby\r\nrequire \'test_helper\'\r\n\r\nclass UserTest < ActiveSupport::TestCase\r\n  test \"test full name without middle initial\" do\r\n    user = User.new(first_name: \'Bugs\', last_name: \'Bunny\')\r\n    assert_equal \'Bugs Bunny\', user.full_name\r\n  end\r\nend\r\n```\r\n\r\nRun the tests:\r\n\r\n```\r\nrake test test/models/user_test.rb \r\n\r\nRun options: --seed 40163\r\n\r\n# Running:\r\n\r\n...........\r\n\r\nFinished in 0.428411s, 25.6763 runs/s, 37.3473 assertions/s.\r\n\r\n11 runs, 16 assertions, 0 failures, 0 errors, 0 skips\r\n```\r\n\r\n### Step 4\r\n\r\nLet\'s write the second test:\r\n\r\n```ruby\r\ntest \"full name with middle initial\" do\r\n  user = User.new(first_name: \'Bugs\', middle_initial: \'C\', last_name: \'Bunny\')\r\n  assert_equal \'Bugs C. Bunny\', user.full_name    \r\nend\r\n```\r\n\r\nRun the tests:\r\n\r\n```\r\nrake test test/models/user_test.rb \r\nRun options: --seed 33381\r\n\r\n# Running:\r\n\r\n............\r\n\r\nFinished in 0.482059s, 24.8932 runs/s, 35.2654 assertions/s.\r\n\r\n12 runs, 17 assertions, 0 failures, 0 errors, 0 skips\r\n```\r\n\r\n## Performance Tip\r\n\r\nDon\'t use `join` method to concatenate strings. For better performance use `<<`. To learn more use the search term \'+, join, << performance ruby\'.\r\n\r\n### Step 5\r\n\r\nLet\'s write the third test.\r\n\r\n```ruby\r\ntest \"full name with blank middle initial\" do\r\n  user = User.new(first_name: \'Bugs\', middle_initial: \'\', last_name: \'Bunny\')\r\n  assert_equal \'Bugs Bunny\', user.full_name        \r\nend\r\n```\r\n\r\nRun the tests:\r\n\r\n```\r\nrake test test/models/user_test.rb \r\nRun options: --seed 30166\r\n\r\n# Running:\r\n\r\n..........F\r\n\r\nFailure:\r\nUserTest#test_full_name_with_blank_middle_initial [/Users/bparanj/projects/blog5/test/models/user_test.rb:16]:\r\nExpected: \"Bugs Bunny\"\r\n  Actual: \"Bugs . Bunny\"\r\n\r\nbin/rails test test/models/user_test.rb:14\r\n\r\n..\r\n\r\nFinished in 0.347134s, 37.4495 runs/s, 51.8531 assertions/s.\r\n\r\n13 runs, 18 assertions, 1 failures, 0 errors, 0 skips\r\n```\r\n\r\n### Step 6\r\n\r\nUse `present?` method to simplify the logic and pass the test.\r\n\r\n```ruby \r\nclass User < ApplicationRecord\r\n  def full_name\r\n    name = first_name + \' \'\r\n    name << \"#{middle_initial}. \" if middle_initial.present?\r\n    name << last_name\r\n  end\r\nend\r\n``` \r\n\r\nThis implementation is more readable. Run the tests: \r\n \r\n``` \r\nrake test test/models/user_test.rb \r\n Run options: --seed 27913\r\n\r\n # Running:\r\n\r\n .............\r\n\r\n Finished in 0.342862s, 37.9161 runs/s, 52.4992 assertions/s.\r\n\r\n 13 runs, 18 assertions, 0 failures, 0 errors, 0 skips\r\n``` \r\n  \r\n### Step 8\r\n  \r\nLet\'s refactor the tests.\r\n\r\n```ruby\r\nrequire \'test_helper\'\r\n\r\nclass UserTest < ActiveSupport::TestCase\r\n  test \"full name without middle initial\" do\r\n    user = sample_user(middle: nil)\r\n    assert_equal \'Bugs Bunny\', user.full_name\r\n  end\r\n  \r\n  test \"full name with middle initial\" do\r\n    user = sample_user\r\n    assert_equal \'Bugs C. Bunny\', user.full_name\r\n  end\r\n\r\n  test \"full name with blank middle initial\" do\r\n    user = sample_user(middle: \'\')\r\n    assert_equal \'Bugs Bunny\', user.full_name\r\n  end\r\n  \r\n  def sample_user(first: \'Bugs\', middle: \'C\', last: \'Bunny\')\r\n    User.new(first_name: first, middle_initial: middle, last_name: last)\r\n  end\r\nend\r\n```\r\n\r\nThe reason for not defining full_name like railscast is because the method has only one purpose, to create user objects. It is clear from the data we pass to the helper method the attribute we are over-riding by using key arguments.  \r\n \r\n\r\n## Summary\r\n\r\nIn this article, you learned how to write model tests in Rails 5.\r\n','2016-03-12 19:01:27','2016-03-12 19:01:27'),(3121,'Upgrading Redis to 3.0.7 using Moonshine Redis Plugin','## Objective\r\n\r\nTo learn how to upgrade redis from 2.8.9 to 3.0.7 using Moonshine Redis plugin\r\n\r\n## Steps\r\n\r\n### Step 1\r\n\r\nUninstall the redis 2.8.9 manually on the server. Ideally I wish the plugin took care of removing the old version. But it does not install the newer version if an older version is already installed on the server.\r\n\r\n```\r\nsudo service redis-server stop\r\nsudo rm /usr/local/bin/redis-*\r\nsudo rm -r /etc/redis/\r\nsudo rm /var/log/redis_*\r\nsudo rm -r /var/lib/redis/\r\nsudo rm /etc/init.d/redis_*\r\nsudo rm /var/run/redis_*\r\n```\r\n\r\n### Step 2\r\n\r\nThe `tcl` package is a pre-requisite for redis installation. In application_manifest.rb, add:\r\n\r\n```ruby\r\npackage \'tcl8.5\', :ensure => :installed\r\n```\r\n\r\n### Step 3\r\n\r\nChange redis version in `moonshine.yml`:\r\n\r\n```\r\n:redis:\r\n  :version: 3.0.7\r\n```\r\n\r\n### Step 4\r\n\r\nUpdate the redis version in `application_manifest.rb` and make sure redis recipe is included:\r\n\r\n```ruby\r\nconfigure(:redis => { :version => \'3.0.7\' }\r\nrecipe :redis\r\n```\r\n\r\n### Step 5\r\n\r\nCheck in the changes to git. Deploy using Capistrano.\r\n\r\n```\r\n** [out :: rp] Notice: /Exec[shutdown redis]/returns: Could not connect to Redis at 127.0.0.1:6379: Connection refused\r\n** [out :: rp] Error: /Exec[shutdown redis]: Failed to call refresh: redis-cli shutdown returned 1 instead of one of [0]\r\n** [out :: rp] Error: /Exec[shutdown redis]: redis-cli shutdown returned 1 instead of one of [0]\r\n** [out :: rp] Notice: /Service[redis-server]/ensure: ensure changed \'stopped\' to \'running\'\r\n```\r\n\r\nYou may see some error messages. It\'s ok. Because it happens when you dick around the server like we did in step 1.\r\n\r\n### Step 6\r\n\r\nSSH into the box and verify the new version of redis.\r\n\r\n```\r\nredis-cli\r\n127.0.0.1:6379> INFO\r\n# Server\r\nredis_version:3.0.7\r\n```\r\n\r\nIt will be better if the availability end point provides the version of redis in the JSON.\r\n\r\n## Summary\r\n\r\nIn this article, you learned how to automate upgrade of Redis as much as we can  on Ubuntu using Moonshine Redis Plugin.\r\n\r\n## Reference\r\n\r\n[Moonshine Redis Plugin](https://github.com/railsmachine/moonshine_redis \'Moonshine Redis Plugin\')\r\n[How to uninstall redis server on Ubuntu](http://grainier.net/how-to-uninstall-redis-server-from-ubuntu/ \'How to uninstall redis server on Ubuntu\')','2016-03-13 03:50:19','2016-03-13 19:38:19'),(3131,'Dangers of Model in Rails 5 Session ','\r\n## Steps\r\n### Step 1\r\n\r\nThe users controller stores the user object in the session.\r\n\r\n```ruby\r\nclass UsersController < ApplicationController\r\n  def index\r\n    session[:user] = User.first\r\n    \r\n    redirect_to session[:user]\r\n  end\r\n\r\n  def show\r\n    @user = session[:user]\r\n  end\r\n  \r\n  def update\r\n    @user = session[:user]\r\n    @user.first_name = \'Junk\'\r\n    \r\n    redirect_to session[:user]\r\n  end\r\nend\r\n```\r\n\r\n### Step 2\r\n\r\nDefine the routes for the users resource in routes.rb.\r\n\r\n```ruby\r\nRails.application.routes.draw do\r\n  resources :users, only: [:index, :show, :update]  \r\nend\r\n```\r\n\r\n### Step 3\r\n\r\nLet\'s inspect the user object in `app/views/users/show.html.erb`.\r\n\r\n```ruby\r\n<%= debug(@user) %>\r\n\r\n<%= link_to \'Update\', user_path(@user), method: :patch %>\r\n```\r\n\r\n### Step 4\r\n\r\nBrowse to `http://localhost:3000/users/1`, you will see:\r\n\r\n```ruby\r\n--- !ruby/hash:ActiveSupport::HashWithIndifferentAccess\r\nid: 1\r\nfirst_name: Bugs\r\nmiddle_initial: \r\nlast_name: Bunny\r\ncreated_at: \'2016-03-10T23:52:10.256Z\'\r\nupdated_at: \'2016-03-10T23:52:10.256Z\'\r\npassword: \r\n```\r\n\r\nand get the error:\r\n\r\n```\r\nundefined method `first_name=\' for #<ActiveSupport::HashWithIndifferentAccess:0x0377b8>\r\n```\r\n\r\nIn Rails 5, it is not `!ruby/object:User` anymore, it is `HashWithIndifferentAccess`. So, it\'s not possible anymore to change it.\r\n\r\n### Step  5\r\n\r\nChange the users controller to store only the user\'s id in the session as follows:\r\n\r\n```ruby\r\nclass UsersController < ApplicationController\r\n  def index\r\n    session[:user_id] = User.first.id\r\n    \r\n    redirect_to user_path(session[:user_id])\r\n  end\r\n\r\n  def show\r\n    @user = User.find(session[:user_id])\r\n  end\r\n  \r\n  def update\r\n    @user = User.find(session[:user_id])\r\n    @user.first_name = \'\'\r\n    logger.info @user.valid?.to_s\r\n          \r\n    redirect_to @user\r\n  end\r\nend\r\n```\r\n\r\n### Step 6\r\n\r\nBrowse to `http://localhost:3000/users`. You will now see:\r\n\r\n```ruby\r\n--- !ruby/object:User\r\nraw_attributes:\r\n  id: 1\r\n  first_name: Bugs\r\n  middle_initial: \r\n  last_name: Bunny\r\n  created_at: \'2016-03-10 23:52:10.256312\'\r\n  updated_at: \'2016-03-10 23:52:10.256312\'\r\n  password: \r\nattributes: !ruby/object:ActiveRecord::AttributeSet\r\n  attributes: !ruby/object:ActiveRecord::LazyAttributeHash\r\n    types:\r\n      id: &3 !ruby/object:ActiveModel::Type::Integer\r\n        precision: \r\n        scale: \r\n        limit: \r\n        range: !ruby/range\r\n          begin: -2147483648\r\n          end: 2147483648\r\n          excl: true\r\n      first_name: &1 !ruby/object:ActiveModel::Type::String\r\n        precision: \r\n        scale: \r\n        limit: \r\n      middle_initial: *1\r\n      last_name: *1\r\n      created_at: &4 !ruby/marshalable:ActiveRecord::AttributeMethods::TimeZoneConversion::TimeZoneConverter\r\n        :__v2__: []\r\n        []: &2 !ruby/object:ActiveRecord::Type::DateTime\r\n          precision: \r\n          scale: \r\n          limit: \r\n      updated_at: &5 !ruby/marshalable:ActiveRecord::AttributeMethods::TimeZoneConversion::TimeZoneConverter\r\n        :__v2__: []\r\n        []: *2\r\n      password: *1\r\n    values:\r\n      id: 1\r\n      first_name: Bugs\r\n      middle_initial: \r\n      last_name: Bunny\r\n      created_at: \'2016-03-10 23:52:10.256312\'\r\n      updated_at: \'2016-03-10 23:52:10.256312\'\r\n      password: \r\n    additional_types: {}\r\n    materialized: true\r\n    delegate_hash:\r\n      id: !ruby/object:ActiveRecord::Attribute::FromDatabase\r\n        name: id\r\n        value_before_type_cast: 1\r\n        type: *3\r\n        original_attribute: \r\n      first_name: !ruby/object:ActiveRecord::Attribute::FromDatabase\r\n        name: first_name\r\n        value_before_type_cast: Bugs\r\n        type: *1\r\n        original_attribute: \r\n      middle_initial: !ruby/object:ActiveRecord::Attribute::FromDatabase\r\n        name: middle_initial\r\n        value_before_type_cast: \r\n        type: *1\r\n        original_attribute: \r\n      last_name: !ruby/object:ActiveRecord::Attribute::FromDatabase\r\n        name: last_name\r\n        value_before_type_cast: Bunny\r\n        type: *1\r\n        original_attribute: \r\n      created_at: !ruby/object:ActiveRecord::Attribute::FromDatabase\r\n        name: created_at\r\n        value_before_type_cast: \'2016-03-10 23:52:10.256312\'\r\n        type: *4\r\n        original_attribute: \r\n      updated_at: !ruby/object:ActiveRecord::Attribute::FromDatabase\r\n        name: updated_at\r\n        value_before_type_cast: \'2016-03-10 23:52:10.256312\'\r\n        type: *5\r\n        original_attribute: \r\n      password: !ruby/object:ActiveRecord::Attribute::FromDatabase\r\n        name: password\r\n        value_before_type_cast: \r\n        type: *1\r\n        original_attribute: \r\nnew_record: false\r\nactive_record_yaml_version: 1\r\n```\r\n\r\n### Step 7\r\n\r\nClick Update button. This does not change the `first_name` in Rails 5. The displayed user will always be in sync with the database values.\r\n\r\n## Summary\r\n\r\nIn this article, you learned that you cannot store objects in the session. We can store the id of the objects in the session.','2016-03-13 19:14:23','2016-03-13 19:14:23'),(3141,'Managing Redis Kernel Parameter using Moonshine Sysctl Plugin','## Background\r\n\r\nI manage my Rails 4.x App on Linode using Moonshine. Moonshine Sysctl Plugin automates managing the kernel parameter setting for redis.\r\n\r\n## What is sysctl in Linux?\r\n\r\n`sysctl` is used to configure kernel parameters at runtime\r\n\r\n## Why do we need to use sysctl?\r\n\r\nFrom [Redis FAQ](http://redis.io/topics/faq \'Redis FAQ\') : Setting overcommit_memory to 1 says Linux to relax and perform the fork in a more optimistic allocation fashion, and this is indeed what you want for Redis.\r\n\r\n## Install Moonshine Sysctl Plugin\r\n\r\nIn the Rails project directory, run:\r\n\r\n```\r\n$ plugger install  git://github.com/railsmachine/moonshine_sysctl.git\r\n```\r\n\r\nHere is the output:\r\n\r\n```\r\nDEPRECATION WARNING: `#silence_stderr` is deprecated and will be removed in the next release. (called from load at /Users/zepho/.rvm/gems/ruby-2.3.0@lafon/bin/plugger:23)\r\nInitialized empty Git repository in /Users/zepho/projects/lafon/vendor/plugins/moonshine_sysctl/.git/\r\nremote: Counting objects: 13, done.\r\nremote: Compressing objects: 100% (10/10), done.\r\nremote: Total 13 (delta 0), reused 10 (delta 0), pack-reused 0\r\nUnpacking objects: 100% (13/13), done.\r\nFrom git://github.com/railsmachine/moonshine_sysctl\r\n * branch            HEAD       -> FETCH_HEAD\r\n``` \r\n\r\n## Configure Moonshine\r\n \r\nIn `application_manifest.rb`, add:\r\n\r\n```ruby\r\nrecipe :sysctl\r\n```\r\n\r\nIn `moonshine.yml`, add:\r\n\r\n```\r\n:sysctl:\r\n  vm.overcommit_memory: 1\r\n```\r\n\r\nDeploy your Rails 4.x app.\r\n\r\n## Check Sysctl Values\r\n\r\nSSH into the box and run:\r\n\r\n```\r\n$ sysctl vm.overcommit_memory\r\nvm.overcommit_memory = 1\r\n```\r\n\r\nYou can see the vm.overcommit_memory value is set to 1.\r\n\r\n## Summary\r\n\r\nIn this article, you learned how to set the vm.overcommit_memory value using sysctl Moonshine plugin so that Redis can function well.','2016-03-13 21:43:05','2016-03-13 21:43:55'),(3151,'Social Share Button Gem for Rails Apps','## Objective\r\n\r\nInstall social share button for your Rails app in just 5 minutes.\r\n\r\n## Steps\r\n\r\n### Step 1\r\n\r\nAdd the gem to the Gemfile.\r\n\r\n```ruby\r\ngem \'social-share-button\'\r\n```\r\n\r\n### Step 2\r\n\r\nInstall the gem and generate the config files.\r\n\r\n```\r\n$ bundle install\r\n$ rails generate social_share_button:install\r\n```\r\n\r\n### Step 3\r\n\r\nAdd the require statement for javascript file in application.js:\r\n\r\n```\r\n//= require social-share-button\r\n```\r\n\r\n### Step 4\r\n\r\nAdd the import statement for the CSS in application.scss file:\r\n\r\n```\r\n@import \"social-share-button\";\r\n```\r\n\r\n### Step 5\r\n\r\nAdd the share button helper to article show page:\r\n\r\n```\r\n<%= social_share_button_tag(@article.title) %>\r\n```\r\n\r\nYou will now see the social media share buttons as seen on this page.\r\n\r\n## Summary\r\n\r\nIn this article, you learned how to use the social-share-button gem to add social share buttons to your Rails app.\r\n\r\n## Reference\r\n\r\n[Social Share Button Gem Home Page](https://github.com/huacnlee/social-share-button \'Social Share Button Gem Home Page\')','2016-03-14 01:31:41','2016-03-14 01:31:41'),(3161,'Performing Calculations on Models in Rails 5','In this article, we will continue working on the `https://github.com/bparanj/blog5` project. Let\'s delete the existing database so that we can populate it with new data to play with.\r\n\r\n```\r\nrake db:drop\r\n```\r\n\r\nAdd priority field to the tasks table.\r\n\r\n```\r\nrails g migration add_priority_to_tasks priority:integer\r\n```\r\n\r\nCreate sample data in seeds.rb:\r\n\r\n```\r\nwealthy = Project.create(name: \'Wealth Building\')\r\nwealthy.tasks.create(name: \'Get rich quick\', complete: false, priority: 4)\r\nwealthy.tasks.create(name: \'Write a book\', complete: true, priority: 5)\r\n\r\nhappy = Project.create(name: \'Be Happy\')\r\nhappy.tasks.create(name: \'Buy a puppy\', complete: false, priority: 9)\r\nhappy.tasks.create(name: \'Dance in the rain\', complete: true, priority: 7)\r\n```\r\n\r\nLet\'s create the tables and populate them.\r\n\r\n```\r\nrake db:migrate\r\nrake db:seed\r\n```\r\n\r\nWe can find the priority of the first task like this:\r\n\r\n```\r\n> Task.first.priority\r\n  Task Load (0.2ms)  SELECT  \"tasks\".* FROM \"tasks\" ORDER BY \"tasks\".\"id\" ASC LIMIT ?  [[\"LIMIT\", 1]]\r\n => 4 \r\n```\r\n\r\nWhat if we want the sum of the priority of all of the tasks?\r\n\r\n```\r\n> Task.sum(:priority)\r\n   (0.2ms)  SELECT SUM(\"tasks\".\"priority\") FROM \"tasks\"\r\n => 25 \r\n```\r\n\r\nWe cannot pass any conditions in Rails 5. You will get error:\r\n\r\n```\r\n> Task.sum(:priority, conditions: \'complete=0\')\r\nArgumentError: wrong number of arguments (given 2, expected 0..1)\r\n	from /Users/bparanj/.rvm/gems/ruby-2.3.0@rails5/gems/activerecord-5.0.0.beta3/lib/active_record/relation/calculations.rb:74:in `sum\'\r\n```\r\n\r\nThe alternative is to chain the where with sum like this:\r\n\r\n```\r\n> Task.where(complete: false).sum(:priority)\r\n   (0.1ms)  SELECT SUM(\"tasks\".\"priority\") FROM \"tasks\" WHERE \"tasks\".\"complete\" = ?  [[\"complete\", false]]\r\n => 13 \r\n```\r\n\r\nThere are other methods such as maximum, minimum and average.\r\n\r\n``` \r\n> Task.maximum(:priority)\r\n   (0.1ms)  SELECT MAX(\"tasks\".\"priority\") FROM \"tasks\"\r\n => 9 \r\n> Task.minimum(:priority)\r\n   (0.1ms)  SELECT MIN(\"tasks\".\"priority\") FROM \"tasks\"\r\n => 4 \r\n> Task.average(:priority)\r\n   (0.2ms)  SELECT AVG(\"tasks\".\"priority\") FROM \"tasks\"\r\n => #<BigDecimal:7ffc38bda3f8,\'0.625E1\',18(36)> \r\n> Task.average(:priority).to_s\r\n   (0.1ms)  SELECT AVG(\"tasks\".\"priority\") FROM \"tasks\"\r\n => \"6.25\" \r\n```\r\n\r\nUsing the methods through associations.\r\n\r\nWe have a project model which has many tasks. We can access these methods for the tasks in a specific project. \r\n\r\n```\r\n> p = Project.first\r\n  Project Load (0.1ms)  SELECT  \"projects\".* FROM \"projects\" ORDER BY \"projects\".\"id\" ASC LIMIT ?  [[\"LIMIT\", 1]]\r\n => #<Project id: 1, name: \"Wealth Building\", created_at: \"2016-03-11 23:40:42\", updated_at: \"2016-03-11 23:40:42\"> \r\n> p.tasks.sum(:priority)\r\n   (0.1ms)  SELECT SUM(\"tasks\".\"priority\") FROM \"tasks\" WHERE \"tasks\".\"project_id\" = ?  [[\"project_id\", 1]]\r\n => 9 \r\n> p.tasks.where(complete: false).sum(:priority)\r\n    (0.2ms)  SELECT SUM(\"tasks\".\"priority\") FROM \"tasks\" WHERE \"tasks\".\"project_id\" = ? AND \"tasks\".\"complete\" = ?  [[\"project_id\", 1], [\"complete\", false]]\r\n  => 4 \r\n``` \r\n\r\n## Summary \r\n\r\nIn this article, you learned how to perform calculations on models by using sum, maximum, minimum and average.','2016-03-14 06:10:16','2016-03-14 06:10:16'),(3171,'Rails 5 ActiveRecord where, find_by, or, not and Eager Loading','## The Where Clause\r\n\r\nFind all incomplete tasks with priority 3.\r\n\r\n```ruby\r\n > Task.where(complete: false).where(priority: 3).all\r\n  Task Load (0.3ms)  SELECT \"tasks\".* FROM \"tasks\" WHERE \"tasks\".\"complete\" = ? AND \"tasks\".\"priority\" = ?  [[\"complete\", false], [\"priority\", 3]]\r\n => #<ActiveRecord::Relation []> \r\n```\r\n \r\nNo results. Find all incomplete tasks with priority 9.\r\n\r\n```ruby\r\n > Task.where(complete: false).where(priority: 9)\r\n  Task Load (0.1ms)  SELECT \"tasks\".* FROM \"tasks\" WHERE \"tasks\".\"complete\" = ? AND \"tasks\".\"priority\" = ?  [[\"complete\", false], [\"priority\", 9]]\r\n => #<ActiveRecord::Relation [#<Task id: 3, name: \"Buy a puppy\", complete: false, created_at: \"2016-03-11 23:40:43\", updated_at: \"2016-03-11 23:40:43\", project_id: 2, priority: 9>]> \r\n```\r\n\r\nThis gives us one record.  Searching for null values generates SQL with \'IS NULL\'.\r\n\r\n```ruby \r\n > Task.where(complete: false).where(priority: nil)\r\n  Task Load (0.2ms)  SELECT \"tasks\".* FROM \"tasks\" WHERE \"tasks\".\"complete\" = ? AND \"tasks\".\"priority\" IS NULL  [[\"complete\", false]]\r\n => #<ActiveRecord::Relation []> \r\n```\r\n \r\nThis syntax is correct. We can search for priority in an array like this:\r\n \r\n```ruby\r\n > Task.where(complete: false).where(priority: [4,9])\r\n  Task Load (0.2ms)  SELECT \"tasks\".* FROM \"tasks\" WHERE \"tasks\".\"complete\" = ? AND \"tasks\".\"priority\" IN (4, 9)  [[\"complete\", false]]\r\n => #<ActiveRecord::Relation [#<Task id: 1, name: \"Get rich quick\", complete: false, created_at: \"2016-03-11 23:40:43\", updated_at: \"2016-03-11 23:40:43\", project_id: 1, priority: 4>, #<Task id: 3, name: \"Buy a puppy\", complete: false, created_at: \"2016-03-11 23:40:43\", updated_at: \"2016-03-11 23:40:43\", project_id: 2, priority: 9>]> \r\n``` \r\n\r\nThis returns two records, one with priority 4 and the other with priority 9. This generates SQL with IN(4,9). We can also use a range for the priority like this:\r\n \r\n```ruby \r\n > Task.where(complete: false).where(priority: 4..9)\r\n  Task Load (0.2ms)  SELECT \"tasks\".* FROM \"tasks\" WHERE \"tasks\".\"complete\" = ? AND (\"tasks\".\"priority\" BETWEEN ? AND ?)  [[\"complete\", false], [\"priority\", 4], [\"priority\", 9]]\r\n => #<ActiveRecord::Relation [#<Task id: 1, name: \"Get rich quick\", complete: false, created_at: \"2016-03-11 23:40:43\", updated_at: \"2016-03-11 23:40:43\", project_id: 1, priority: 4>, #<Task id: 3, name: \"Buy a puppy\", complete: false, created_at: \"2016-03-11 23:40:43\", updated_at: \"2016-03-11 23:40:43\", project_id: 2, priority: 9>]> \r\n```\r\n\r\nThis returns all the tasks within that range. It uses the SQL BETWEEN clause. Use of the range retrieves all records within that range. Here is an example:\r\n\r\n```ruby\r\n > Task.where(priority: 4..9)\r\n  Task Load (0.2ms)  SELECT \"tasks\".* FROM \"tasks\" WHERE (\"tasks\".\"priority\" BETWEEN ? AND ?)  [[\"priority\", 4], [\"priority\", 9]]\r\n => #<ActiveRecord::Relation [#<Task id: 1, name: \"Get rich quick\", complete: false, created_at: \"2016-03-11 23:40:43\", updated_at: \"2016-03-11 23:40:43\", project_id: 1, priority: 4>, #<Task id: 2, name: \"Write a book\", complete: true, created_at: \"2016-03-11 23:40:43\", updated_at: \"2016-03-11 23:40:43\", project_id: 1, priority: 5>, #<Task id: 3, name: \"Buy a puppy\", complete: false, created_at: \"2016-03-11 23:40:43\", updated_at: \"2016-03-11 23:40:43\", project_id: 2, priority: 9>, #<Task id: 4, name: \"Dance in the rain\", complete: true, created_at: \"2016-03-11 23:40:43\", updated_at: \"2016-03-11 23:40:43\", project_id: 2, priority: 7>]> \r\n```\r\n\r\nThis returns all tasks that has priority within the given range 4 through 9. In this case, tasks with priority 4, 5, 7 and 9.  We can find all tasks with id 1 and 4 like this:\r\n\r\n```ruby \r\n Task.where(id: [1,4])\r\n   Task Load (0.2ms)  SELECT \"tasks\".* FROM \"tasks\" WHERE \"tasks\".\"id\" IN (1, 4)\r\n  => #<ActiveRecord::Relation [#<Task id: 1, name: \"Get rich quick\", complete: false, created_at: \"2016-03-11 23:40:43\", updated_at: \"2016-03-11 23:40:43\", project_id: 1, priority: 4>, #<Task id: 4, name: \"Dance in the rain\", complete: true, created_at: \"2016-03-11 23:40:43\", updated_at: \"2016-03-11 23:40:43\", project_id: 2, priority: 7>]> \r\n``` \r\n\r\nThis returns two tasks, one with id 1 and the other with id 4.\r\n\r\n## The find_by\r\n\r\nYou cannot use `find_by_column` with a range in Rails 5.\r\n\r\n```ruby\r\nTask.find_by_priority(2..10)\r\n  Task Load (0.1ms)  SELECT  \"tasks\".* FROM \"tasks\" WHERE \"tasks\".\"priority\" = ? LIMIT ?  [[\"priority\", nil], [\"LIMIT\", 1]]\r\n => nil \r\n```\r\n \r\nThis generates wrong SQL query. However, you can call `find_by_column` with single value for that column like this:\r\n\r\n```ruby\r\n > Task.find_by_priority(9)\r\n  Task Load (0.1ms)  SELECT  \"tasks\".* FROM \"tasks\" WHERE \"tasks\".\"priority\" = ? LIMIT ?  [[\"priority\", 9], [\"LIMIT\", 1]]\r\n => #<Task id: 3, name: \"Buy a puppy\", complete: false, created_at: \"2016-03-11 23:40:43\", updated_at: \"2016-03-11 23:40:43\", project_id: 2, priority: 9>\r\n```\r\n \r\nThis works. It returns one record. Note the limit 1 in the generated SQL query. You can also use `find_by(column: value)` like this:\r\n\r\n```ruby \r\n > Task.find_by(priority: 9)\r\n   Task Load (0.1ms)  SELECT  \"tasks\".* FROM \"tasks\" WHERE \"tasks\".\"priority\" = ? LIMIT ?  [[\"priority\", 9], [\"LIMIT\", 1]]\r\n  => #<Task id: 3, name: \"Buy a puppy\", complete: false, created_at: \"2016-03-11 23:40:43\", updated_at: \"2016-03-11 23:40:43\", project_id: 2, priority: 9> \r\n```\r\n \r\nThis also works. It returns one record. Again, note the limit 1 in the generated SQL query. \r\n\r\n```ruby \r\n > Task.find_by(priority: [2..10])\r\n  Task Load (0.2ms)  SELECT  \"tasks\".* FROM \"tasks\" WHERE (\"tasks\".\"priority\" BETWEEN 2 AND 10) LIMIT ?  [[\"LIMIT\", 1]]\r\n => #<Task id: 1, name: \"Get rich quick\", complete: false, created_at: \"2016-03-11 23:40:43\", updated_at: \"2016-03-11 23:40:43\", project_id: 1, \r\n priority: 4> \r\n```\r\n \r\nFinds only one record. The generated SQL query has limit 1. You can load all the tasks like this:\r\n\r\n```ruby \r\n> Task.all.to_a\r\n  Task Load (0.1ms)  SELECT \"tasks\".* FROM \"tasks\"\r\n => [#<Task id: 1, name: \"Get rich quick\", complete: false, created_at: \"2016-03-11 23:40:43\", updated_at: \"2016-03-11 23:40:43\", project_id: 1, priority: 4>, #<Task id: 2, name: \"Write a book\", complete: true, created_at: \"2016-03-11 23:40:43\", updated_at: \"2016-03-11 23:40:43\", project_id: 1, priority: 5>, #<Task id: 3, name: \"Buy a puppy\", complete: false, created_at: \"2016-03-11 23:40:43\", updated_at: \"2016-03-11 23:40:43\", project_id: 2, priority: 9>, #<Task id: 4, name: \"Dance in the rain\", complete: true, created_at: \"2016-03-11 23:40:43\", updated_at: \"2016-03-11 23:40:43\", project_id: 2, priority: 7>] \r\n```\r\n\r\n## Eager loading\r\n\r\nA project has many tasks. We can load all the tasks that belongs to a project by using `includes` like this:\r\n\r\n```ruby\r\n > Project.all.includes(:tasks)\r\n  Project Load (2.0ms)  SELECT \"projects\".* FROM \"projects\"\r\n  Task Load (0.2ms)  SELECT \"tasks\".* FROM \"tasks\" WHERE \"tasks\".\"project_id\" IN (1, 2)\r\n => #<ActiveRecord::Relation [#<Project id: 1, name: \"Wealth Building\", created_at: \"2016-03-11 23:40:42\", updated_at: \"2016-03-11 23:40:42\">, #<Project id: 2, name: \"Be Happy\", created_at: \"2016-03-11 23:40:43\", updated_at: \"2016-03-11 23:40:43\">]> \r\n```\r\n\r\nYou see two queries, one for retrieving the projects and another for retrieving the tasks. This avoids the N+1 query problem. You cannot go in the other direction. You will get an error:\r\n\r\n```ruby\r\n > Task.all.includes(:projects)\r\n  Task Load (0.1ms)  SELECT \"tasks\".* FROM \"tasks\"\r\nActiveRecord::AssociationNotFoundError: Association named \'projects\' was not found on Task; perhaps you misspelled it?\r\n```\r\n\r\n## Using Not Condition\r\n\r\nLet\'s find task with priority NOT in 9 by using `not`. You can chain `not` with `where` clause like this:\r\n\r\n```ruby\r\n> Task.where.not(priority: 9)\r\n  Task Load (0.2ms)  SELECT \"tasks\".* FROM \"tasks\" WHERE (\"tasks\".\"priority\" != ?)  [[\"priority\", 9]]\r\n => #<ActiveRecord::Relation [#<Task id: 1, name: \"Get rich quick\", complete: false, created_at: \"2016-03-11 23:40:43\", updated_at: \"2016-03-11 23:40:43\", project_id: 1, priority: 4>, #<Task id: 2, name: \"Write a book\", complete: true, created_at: \"2016-03-11 23:40:43\", updated_at: \"2016-03-11 23:40:43\", project_id: 1, priority: 5>, #<Task id: 4, name: \"Dance in the rain\", complete: true, created_at: \"2016-03-11 23:40:43\", updated_at: \"2016-03-11 23:40:43\", project_id: 2, priority: 7>]> \r\n```\r\n\r\nThe generated SQL query has `!=` for the `not`. This returns tasks with priority 4, 5 and 7.  The not can also take an array of values like this:\r\n\r\n```ruby\r\n> Task.where.not(priority: [4,9])\r\n  Task Load (0.2ms)  SELECT \"tasks\".* FROM \"tasks\" WHERE (\"tasks\".\"priority\" NOT IN (4, 9))\r\n => #<ActiveRecord::Relation [#<Task id: 2, name: \"Write a book\", complete: true, created_at: \"2016-03-11 23:40:43\", updated_at: \"2016-03-11 23:40:43\", project_id: 1, priority: 5>, #<Task id: 4, name: \"Dance in the rain\", complete: true, created_at: \"2016-03-11 23:40:43\", updated_at: \"2016-03-11 23:40:43\", project_id: 2, priority: 7>]> \r\n```\r\n\r\nThe generated SQL query has priority NOT in (4,9). This returns two records with priority 5 and 7.\r\n\r\n## Using OR Condition\r\n\r\nYou can chain `or` condition with `where` like this:\r\n\r\n```ruby\r\n> Task.where(project_id: 1).or(Task.where(priority: 9))\r\n  Task Load (0.2ms)  SELECT \"tasks\".* FROM \"tasks\" WHERE (\"tasks\".\"project_id\" = ? OR \"tasks\".\"priority\" = ?)  [[\"project_id\", 1], [\"priority\", 9]]\r\n => #<ActiveRecord::Relation [#<Task id: 1, name: \"Get rich quick\", complete: false, created_at: \"2016-03-11 23:40:43\", updated_at: \"2016-03-11 23:40:43\", project_id: 1, priority: 4>, #<Task id: 2, name: \"Write a book\", complete: true, created_at: \"2016-03-11 23:40:43\", updated_at: \"2016-03-11 23:40:43\", project_id: 1, priority: 5>, #<Task id: 3, name: \"Buy a puppy\", complete: false, created_at: \"2016-03-11 23:40:43\", updated_at: \"2016-03-11 23:40:43\", project_id: 2, priority: 9>]> \r\n``` \r\n\r\nThe generated SQL has OR condition. This returns tasks that belongs to project_id 1 or that has priority 9. The first two tasks belongs to project with id 1 and the third task belongs to project with id 2 but it has priority 9. \r\n\r\n## Rails 4 and 5\r\n\r\nThe `find_all_by_column(value)` is not available in Rails 4.x and 5 anymore.\r\n\r\n```ruby\r\nTask.find_all_by_complete(false)\r\nNoMethodError: undefined method `find_all_by_complete\' for #<Class:0x007ff3eafc2b60>\r\nDid you mean?  find_or_create_by\r\n```\r\n\r\nThis gives an error.\r\n  \r\n## Summary\r\n\r\nIn this article, you learned how to use the where clause to chain conditions, or condition, not condition, find_by and eager loading. ','2016-03-15 06:01:44','2016-03-15 06:48:00'),(3181,'Virtual Attributes in Rails 5','## Objective\r\n\r\nTo learn how to use virtual attributes to map the fields in the view to the fields in a table in Rails 5.\r\n\r\n## Steps\r\n### Step 1\r\n\r\nYou can list all the columns of the users table like this in the rails console:\r\n\r\n```ruby\r\n> User.new.attributes\r\n => {\"id\"=>nil, \"first_name\"=>nil, \"middle_initial\"=>nil, \"last_name\"=>nil, \"created_at\"=>nil, \"updated_at\"=>nil, \"password\"=>nil} \r\n```\r\n\r\nWe can get the columns of the users table by listing the keys of this hash.\r\n\r\n```ruby\r\n > User.new.attributes.keys\r\n => [\"id\", \"first_name\", \"middle_initial\", \"last_name\", \"created_at\", \"updated_at\", \"password\"] \r\n```\r\n \r\n### Step 2\r\n\r\nDefine the routes for the users resource in `routes.rb` file.\r\n\r\n```ruby\r\nRails.application.routes.draw do  \r\n  resources :users\r\nend\r\n```\r\n\r\n### Step 3\r\n\r\nCreate the form for a new user registration in `app/views/users/new.html.erb`:\r\n\r\n```ruby\r\n<%= form_for(@user) do |f| %>\r\n  <div class=\"field\">\r\n    <%= f.label :first_name %>\r\n    <%= f.text_field :first_name %>\r\n  </div>\r\n\r\n  <div class=\"field\">\r\n    <%= f.label :last_name %>\r\n    <%= f.text_field :last_name %>\r\n  </div>\r\n\r\n  <div class=\"field\">\r\n    <%= f.label :password %>\r\n    <%= f.password_field :password %>\r\n  </div>\r\n\r\n  <div class=\"actions\">\r\n    <%= f.submit %>\r\n  </div>\r\n<% end %>\r\n```\r\n\r\nThis form collects the `first_name`, `last_name` and the password of the user.\r\n\r\n### Step 4\r\n\r\nYou can see the columns defined in the users table in `schema.rb`:\r\n\r\n```ruby\r\ncreate_table \"users\", force: :cascade do |t|\r\n  t.string   \"first_name\"\r\n  t.string   \"middle_initial\"\r\n  t.string   \"last_name\"\r\n  t.datetime \"created_at\",     null: false\r\n  t.datetime \"updated_at\",     null: false\r\n  t.string   \"password\"\r\nend\r\n```\r\n \r\nThe fields in the view is stored in the corresponding column in the users table. There is a one-to-one mapping between the fields in the view and the fields in the table.\r\n\r\n### Step 5\r\n\r\nLet\'s change the form to collect the full_name from the user:\r\n\r\n```ruby\r\n<%= form_for(@user) do |f| %>\r\n  <div class=\"field\">\r\n    <%= f.label :full_name %>\r\n    <%= f.text_field :full_name %>\r\n  </div>\r\n\r\n  <div class=\"field\">\r\n    <%= f.label :password %>\r\n    <%= f.password_field :password %>\r\n  </div>\r\n\r\n  <div class=\"actions\">\r\n    <%= f.submit %>\r\n  </div>\r\n<% end %>\r\n```\r\n\r\nHow can me map the `full_name` field in the view to the `first_name` and `last_name` columns in the database?\r\n\r\n### Step 6\r\n\r\nBrowse to `http://localhost:3000/users/new`. You will get the error:\r\n\r\n```\r\nundefined method `full_name\' for #<User:0x007f89a0>\r\n```\r\n\r\n### Step 7\r\n\r\nDefine the full_name setter in the user model.\r\n\r\n```ruby\r\ndef full_name=(name)\r\n  split = name.split(\' \', 2)\r\n  self.first_name = split.first\r\n  self.last_name = split.last\r\nend\r\n```\r\n\r\n### Step 8\r\n\r\nBrowse to `http://localhost:3000/users/new`. You still get the error:\r\n\r\n```\r\nundefined method `full_name\' for #<User:0x007bc0de8>\r\nDid you mean?  full_name=\r\n```\r\n\r\n### Step 9\r\n\r\nDefine the full_name getter in the user model:\r\n\r\n```ruby\r\ndef full_name\r\n  [first_name, last_name].join(\' \')\r\nend\r\n```\r\n\r\n### Step 10\r\n\r\nFill out the registration form and submit. In the development.log file, you can see the data submitted to the server.\r\n\r\n```sh\r\nStarted POST \"/users\" for ::1 at 2016-03-11 17:41:55 -0800\r\nProcessing by UsersController#create as HTML\r\n  Parameters: {\"utf8\"=>\"✓\", \"authenticity_token\"=>\"Vf1Zb/3ZtA0XMKbiRCWQ==\", \"user\"=>{\"full_name\"=>\" Pluto Dog\", \"password\"=>\"[FILTERED]\"}, \"commit\"=>\"Create user\"}\r\nNo template found for UsersController#create, rendering head :no_content\r\nCompleted 204 No Content in 2ms (ActiveRecord: 0.0ms)\r\n```\r\n\r\nThe user\'s `full_name` and password is sent to the server.\r\n\r\n### Step 11\r\n\r\nThe users controller that implements index, new and create actions looks like this:\r\n\r\n```ruby\r\nclass UsersController < ApplicationController\r\n  def index\r\n    @users = User.all\r\n  end\r\n\r\n  def new\r\n    @user = User.new\r\n  end\r\n\r\n  def create\r\n    User.create(params.require(:user).permit(:full_name, :password))\r\n    \r\n    redirect_to users_path\r\n  end\r\nend\r\n```\r\n\r\n### Step 12\r\n\r\nWhen you register, you can see the data sent to the server and the insert sql command in the development.log file.\r\n\r\n```sh\r\nStarted POST \"/users\" for ::1 at 2016-03-11 17:44:18 -0800\r\nProcessing by UsersController#create as HTML\r\n  Parameters: {\"utf8\"=>\"✓\", \"authenticity_token\"=>\"8ymtPpmDp/N05CMfFU2KA==\", \"user\"=>{\"full_name\"=>\" Pluto Dog\", \"password\"=>\"[FILTERED]\"}, \"commit\"=>\"Create user\"}\r\n   (0.0ms)  begin transaction\r\n  SQL (0.5ms)  INSERT INTO \"users\" (\"first_name\", \"last_name\", \"created_at\", \"updated_at\", \"password\") VALUES (?, ?, ?, ?, ?)  [[\"first_name\", \"Pluto\"], [\"last_name\", \"Dog\"], [\"created_at\", 2016-03-12 01:44:18 UTC], [\"updated_at\", 2016-03-12 01:44:18 UTC], [\"password\", \"123456\"]]\r\n   (0.4ms)  commit transaction\r\nRedirected to http://localhost:3000/users\r\nCompleted 302 Found in 10ms (ActiveRecord: 1.6ms)\r\n```\r\n\r\nAfter creating the user we are redirected to the users index page.\r\n\r\n```sh\r\nStarted GET \"/users\" for ::1 at 2016-03-11 17:44:18 -0800\r\nProcessing by UsersController#index as HTML\r\n  User Load (0.1ms)  SELECT \"users\".* FROM \"users\"\r\n  Rendered users/index.html.erb within layouts/application (1.4ms)\r\nCompleted 200 OK in 24ms (Views: 21.6ms | ActiveRecord: 0.1ms)\r\n```\r\n\r\n### Step 13\r\n\r\nWe can verify the new user record in the rails console:\r\n\r\n```ruby\r\n> User.last\r\n  User Load (0.2ms)  SELECT  \"users\".* FROM \"users\" ORDER BY \"users\".\"id\" DESC LIMIT ?  [[\"LIMIT\", 1]]\r\n => #<User id: 1, first_name: \"Pluto\", middle_initial: nil, last_name: \"Dog\", created_at: \"2016-03-12 01:44:18\", updated_at: \"2016-03-12 01:44:18\", password: \"123456\"> \r\n ```\r\n\r\n## Summary\r\n\r\nIn this article, you learned about virtual attributes and how you can use it in Rails 5 app to map fields in the view to the fields in the database. ','2016-03-15 06:52:50','2016-03-15 06:55:21'),(3191,'Has Many Through Checkboxes in Rails 3.x, 4.x and 5','## Steps\r\n### Step 1\r\n\r\nLet\'s generate the category model with name attribute.\r\n\r\n```sh\r\nrails g model category name:string\r\n```\r\n\r\n### Step 2\r\n\r\nCreate product model and products controller.\r\n\r\n```sh\r\n$ rails g scaffold product name:string price:decimal\r\n```\r\n\r\nThe products table has name and price fields.\r\n\r\n### Step 3\r\n\r\nDefine the habtm association in product and category models.\r\n\r\n```ruby\r\nclass Product < ApplicationRecord\r\n  has_and_belongs_to_many :categories\r\nend\r\n```\r\n\r\n```ruby\r\nclass Category < ApplicationRecord\r\n  has_and_belongs_to_many :products\r\nend\r\n```\r\n\r\n### Step 4\r\n\r\nChange the migration file:\r\n\r\n```ruby \r\nclass CreateProducts < ActiveRecord::Migration[5.0]\r\n  def change\r\n    create_table :products do |t|\r\n      t.string :name\r\n      t.decimal :price, :precision => 8, :scale => 2\r\n\r\n      t.timestamps\r\n    end\r\n  end\r\nend\r\n```\r\n\r\nWe specify the precision and scale for the price field. Note: The join table categories_products does not have id column.\r\n\r\n### Step 5\r\n\r\nCreate the join table:\r\n\r\n```sh\r\nrails g migration create_categories_products category_id:integer product_id:integer\r\n```\r\n\r\nThe generated migration file looks like this:\r\n\r\n```ruby\r\nclass CreateAtegoriesProductsTable < ActiveRecord::Migration[5.0]\r\n  def change\r\n    create_table :categories_products do |t|\r\n      t.integer :category_id\r\n      t.integer :product_id\r\n    end\r\n  end\r\nend\r\n```\r\n\r\n### Step 6\r\n\r\nCreate the tables and populate the database.\r\n\r\n```sh\r\nrake db:migrate\r\nrake db:seed\r\n```\r\n\r\nWe can check the number of categories in the database in the rails console.\r\n\r\n```ruby\r\nrails c\r\nLoading development environment (Rails 5.0.0.beta3)\r\n > Category.count\r\n   (0.1ms)  SELECT COUNT(*) FROM \"categories\"\r\n => 4 \r\n```\r\n\r\n### Step 7\r\n\r\nTo remove existing data and recreate all tables.\r\n\r\n```sh\r\n$ rake db:drop db:create db:migrate\r\n```\r\n\r\n### Step 8\r\n\r\nCreate sample data to play with in seeds.rb:\r\n\r\n```ruby\r\np = Product.new(name: \'rug\', price: 100)\r\nProduct.create(name: \'bowl\', price: 20.95)\r\nProduct.create(name: \'pillow\', price: 90)\r\nProduct.create(name: \'light\', price: 10.95)\r\n\r\nc = Category.create(name: \'Clothes\')\r\nCategory.create(name: \'Furniture\')\r\nCategory.create(name: \'Groceries\')\r\nCategory.create(name: \'Electronics\')\r\n\r\np.categories << c\r\np.save!\r\n```\r\n\r\nPopulate the tables.\r\n\r\n```sh\r\nrake db:seed\r\n```\r\n\r\n### Step 9\r\n\r\nThere are 4 products and 4 categories in the database.\r\n\r\n```sh\r\n$ rails c\r\nLoading development environment (Rails 5.0.0.beta3)\r\n > Product.count\r\n   (0.1ms)  SELECT COUNT(*) FROM \"products\"\r\n => 4 \r\n > Category.count\r\n   (0.1ms)  SELECT COUNT(*) FROM \"categories\"\r\n => 4 \r\n```\r\n\r\nThe last product has one category associated to it.\r\n\r\n```ruby \r\n > p = Product.last\r\n  Product Load (0.1ms)  SELECT  \"products\".* FROM \"products\" ORDER BY \"products\".\"id\" DESC LIMIT ?  [[\"LIMIT\", 1]]\r\n => #<Product id: 4, name: \"rug\", price: #<BigDecimal:7fb9b23006d8,\'0.1E3\',9(18)>, created_at: \"2016-03-14 20:29:30\", updated_at: \"2016-03-14 20:29:30\"> \r\n > p.categories.to_a\r\n  Category Load (0.1ms)  SELECT \"categories\".* FROM \"categories\" INNER JOIN \"categories_products\" ON \"categories\".\"id\" = \"categories_products\".\"category_id\" WHERE \"categories_products\".\"product_id\" = ?  [[\"product_id\", 4]]\r\n => [#<Category id: 1, name: \"Clothes\", created_at: \"2016-03-14 20:29:30\", updated_at: \"2016-03-14 20:29:30\">] \r\n```\r\n \r\n### Step 10\r\n\r\nIn `products/index.html.erb` list all products on index page with edit and destroy links. Browse to `http://localhost:3000/products`.\r\n\r\n```ruby\r\n<h1>Products</h1>\r\n\r\n<table>\r\n  <thead>\r\n    <tr>\r\n      <th>Name</th>\r\n      <th>Price</th>\r\n      <th colspan=\"3\"></th>\r\n    </tr>\r\n  </thead>\r\n\r\n  <tbody>\r\n    <% @products.each do |product| %>\r\n      <tr>\r\n        <td><%= product.name %></td>\r\n        <td><%= product.price %></td>\r\n        <td><%= link_to \'Show\', product %></td>\r\n        <td><%= link_to \'Edit\', edit_product_path(product) %></td>\r\n        <td><%= link_to \'Destroy\', product, method: :delete, data: { confirm: \'Are you sure?\' } %></td>\r\n      </tr>\r\n    <% end %>\r\n  </tbody>\r\n</table>\r\n\r\n<br>\r\n\r\n<%= link_to \'New Product\', new_product_path %>\r\n```\r\n\r\n### Step 11\r\n\r\nClicking on product name takes to product show page. Product show page has Edit and Back links. The `app/views/products/show.html.erb` looks like this:\r\n\r\n```ruby\r\n<p>\r\n  <strong>Name:</strong>\r\n  <%= @product.name %>\r\n</p>\r\n\r\n<p>\r\n  <strong>Price:</strong>\r\n  <%= @product.price %>\r\n</p>\r\n\r\n<p>\r\n	In Categories: <%= @product.categories.map(&:name).join(\',\') %>\r\n</p>\r\n\r\n<%= link_to \'Edit\', edit_product_path(@product) %> |\r\n<%= link_to \'Back\', products_path %>\r\n```\r\n\r\n### Step 12\r\n\r\nThe \r\n\r\n```html\r\nIn Categories:\r\n```\r\n\r\nvalue on the product show page is blank. \r\n\r\n### Step 13\r\n\r\nAdd to product edit form partial:\r\n\r\n```ruby\r\n<% for category in Category.all %>\r\n<div>\r\n  <%= check_box_tag \"product[category_ids][]\", category.id, @product.categories.include?(category) %>\r\n  <%= category.name %>\r\n</div>\r\n<% end %>\r\n```\r\n\r\n### Step 14\r\n\r\nYou need to allow the form fields by adding this method:\r\n\r\n```ruby\r\ndef product_params\r\n  params.require(:product).permit(:name, :price, :category_ids)\r\nend\r\n```\r\n\r\nBrowse to `app/views/products/edit/1` and check two categories and click update. You can see the error:\r\n\r\n```\r\nUnpermitted parameter: category_ids \r\n```\r\n\r\nin the development log file:\r\n\r\n```sh\r\nStarted PATCH \"/products/4\" for ::1 at 2016-03-14 13:41:24 -0700\r\nProcessing by ProductsController#update as HTML\r\n  Parameters: {\"utf8\"=>\"✓\", \"authenticity_token\"=>\"Nt7G/2pyg==\", \"product\"=>{\"name\"=>\"rug\", \"price\"=>\"100.0\", \"category_ids\"=>[\"1\", \"2\"]}, \"commit\"=>\"Update product\", \"id\"=>\"4\"}\r\n  Product Load (0.1ms)  SELECT  \"products\".* FROM \"products\" WHERE \"products\".\"id\" = ? LIMIT ?  [[\"id\", 4], [\"LIMIT\", 1]]\r\nUnpermitted parameter: category_ids\r\n   (0.1ms)  begin transaction\r\n   (0.0ms)  commit transaction\r\nRedirected to http://localhost:3000/products/4\r\nCompleted 302 Found in 4ms (ActiveRecord: 0.3ms)\r\n```\r\n\r\nTo fix the error, change `product_params`:\r\n\r\n```ruby\r\ndef product_params\r\n  params.require(:product).permit!\r\nend\r\n```\r\n\r\nThis will display product show page with value for `In Categories` label populated.\r\n\r\n### Step 15\r\n\r\nIn the development log file you can see the selected checkboxes are saved in the database as category records. The parameters sent to the server shows the array of category_ids with values 1, 3 and 4.\r\n\r\n```sh\r\nStarted PATCH \"/products/4\" for ::1 at 2016-03-14 14:59:07 -0700\r\nProcessing by ProductsController#update as HTML\r\n  Parameters: {\"utf8\"=>\"✓\", \"authenticity_token\"=>\"UeAoAI9NvAweB/phyRlIe8w==\", \"product\"=>{\"name\"=>\"rug\", \"price\"=>\"100.0\", \"category_ids\"=>[\"1\", \"3\", \"4\"]}, \"commit\"=>\"Update product\", \"id\"=>\"4\"}\r\n  Product Load (0.1ms)  SELECT  \"products\".* FROM \"products\" WHERE \"products\".\"id\" = ? LIMIT ?  [[\"id\", 4], [\"LIMIT\", 1]]\r\n   (0.0ms)  begin transaction\r\n  Category Load (0.2ms)  SELECT \"categories\".* FROM \"categories\" WHERE \"categories\".\"id\" IN (1, 3, 4)\r\n  Category Load (0.1ms)  SELECT \"categories\".* FROM \"categories\" INNER JOIN \"categories_products\" ON \"categories\".\"id\" = \"categories_products\".\"category_id\" WHERE \"categories_products\".\"product_id\" = ?  [[\"product_id\", 4]]\r\n  SQL (0.5ms)  INSERT INTO \"categories_products\" (\"category_id\", \"product_id\") VALUES (?, ?)  [[\"category_id\", 3], [\"product_id\", 4]]\r\n   (0.4ms)  commit transaction\r\nRedirected to http://localhost:3000/products/4\r\nCompleted 302 Found in 16ms (ActiveRecord: 1.3ms)\r\n```\r\n\r\nAfter the update, the user is redirected to the product show page.\r\n\r\n```sh\r\nStarted GET \"/products/4\" for ::1 at 2016-03-14 14:59:07 -0700\r\nProcessing by ProductsController#show as HTML\r\n  Parameters: {\"id\"=>\"4\"}\r\n  Product Load (0.1ms)  SELECT  \"products\".* FROM \"products\" WHERE \"products\".\"id\" = ? LIMIT ?  [[\"id\", 4], [\"LIMIT\", 1]]\r\n  Category Load (0.1ms)  SELECT \"categories\".* FROM \"categories\" INNER JOIN \"categories_products\" ON \"categories\".\"id\" = \"categories_products\".\"category_id\" WHERE \"categories_products\".\"product_id\" = ?  [[\"product_id\", 4]]\r\n  Rendered products/show.html.erb within layouts/application (2.5ms)\r\nCompleted 200 OK in 38ms (Views: 35.5ms | ActiveRecord: 0.2ms)\r\n```\r\n\r\n### Step 16\r\n\r\nLet experiment in the rails console to learn how this works. We can get the first product.\r\n\r\n```sh\r\n$ rails c\r\nLoading development environment (Rails 5.0.0.beta3)\r\n > p = Product.first\r\n  Product Load (0.2ms)  SELECT  \"products\".* FROM \"products\" ORDER BY \"products\".\"id\" ASC LIMIT ?  [[\"LIMIT\", 1]]\r\n => #<Product id: 1, name: \"bowl\", price: #<BigDecimal:7ff78af69468,\'0.2095E2\',18(27)>, created_at: \"2016-03-14 20:29:30\", updated_at: \"2016-03-14 20:29:30\"> \r\n```\r\n\r\nThe category_ids is empty for this product.\r\n\r\n```sh\r\n > p.category_ids\r\n   (0.1ms)  SELECT \"categories\".id FROM \"categories\" INNER JOIN \"categories_products\" ON \"categories\".\"id\" = \"categories_products\".\"category_id\" WHERE \"categories_products\".\"product_id\" = ?  [[\"product_id\", 1]]\r\n => [] \r\n```\r\n\r\nThe last product we saved has three categories associated to it. Here is the last product.\r\n\r\n```sh\r\n > p = Product.last\r\n  Product Load (0.2ms)  SELECT  \"products\".* FROM \"products\" ORDER BY \"products\".\"id\" DESC LIMIT ?  [[\"LIMIT\", 1]]\r\n => #<Product id: 4, name: \"rug\", price: #<BigDecimal:7ff78ac7d790,\'0.1E3\',9(18)>, created_at: \"2016-03-14 20:29:30\", updated_at: \"2016-03-14 20:29:30\"> \r\n```\r\n\r\nHere is the list of category_ids for this product.\r\n\r\n```sh \r\n > p.category_ids\r\n   (0.2ms)  SELECT \"categories\".id FROM \"categories\" INNER JOIN \"categories_products\" ON \"categories\".\"id\" = \"categories_products\".\"category_id\" WHERE \"categories_products\".\"product_id\" = ?  [[\"product_id\", 4]]\r\n => [1, 4, 3] \r\n```\r\n\r\nLet\'s change it.\r\n\r\n```sh \r\n > p.category_ids = [2,3]\r\n  Category Load (0.3ms)  SELECT \"categories\".* FROM \"categories\" WHERE \"categories\".\"id\" IN (2, 3)\r\n  Category Load (0.2ms)  SELECT \"categories\".* FROM \"categories\" INNER JOIN \"categories_products\" ON \"categories\".\"id\" = \"categories_products\".\"category_id\" WHERE \"categories_products\".\"product_id\" = ?  [[\"product_id\", 4]]\r\n   (0.0ms)  begin transaction\r\n  SQL (0.3ms)  DELETE FROM \"categories_products\" WHERE \"categories_products\".\"product_id\" = ? AND \"categories_products\".\"category_id\" IN (1, 4)  [[\"product_id\", 4]]\r\n  SQL (0.1ms)  INSERT INTO \"categories_products\" (\"category_id\", \"product_id\") VALUES (?, ?)  [[\"category_id\", 2], [\"product_id\", 4]]\r\n   (0.5ms)  commit transaction\r\n => [2, 3] \r\n```\r\n\r\nNotice that we don\'t need to call save explicitly. The category_ids method is provided by habm association. It saves the categories for this product.\r\n\r\n### Step 17\r\n\r\nUncheck all the boxes and update. Does it remove categories associated with that product? No. You can see in the development.log file that there is no category records created.\r\n\r\n```sh\r\nStarted PATCH \"/products/4\" for ::1 at 2016-03-14 15:23:24 -0700\r\nProcessing by ProductsController#update as HTML\r\n  Parameters: {\"utf8\"=>\"✓\", \"authenticity_token\"=>\"iRTf7sobiLnrSs3HNfW60pSePwkKXY9gCHsFxFp2f2Np+oI7VbQvTvOJOVmM8HOX3b1FAdbaYVyoVRAq0lVJpw==\", \"product\"=>{\"name\"=>\"rug\", \"price\"=>\"100.0\"}, \"commit\"=>\"Update product\", \"id\"=>\"4\"}\r\n  Product Load (0.3ms)  SELECT  \"products\".* FROM \"products\" WHERE \"products\".\"id\" = ? LIMIT ?  [[\"id\", 4], [\"LIMIT\", 1]]\r\n   (0.0ms)  begin transaction\r\n   (0.4ms)  commit transaction\r\nRedirected to http://localhost:3000/products/4\r\nCompleted 302 Found in 4ms (ActiveRecord: 0.7ms)\r\n```\r\n\r\n### Step 18\r\n\r\nAdd:\r\n\r\n```ruby\r\nparams[:product][:category_ids] ||=[]\r\n```\r\n\r\nto the update method in products controller like this:\r\n\r\n```ruby\r\ndef update\r\n  params[:product][:category_ids] ||=[]\r\n  respond_to do |format|\r\n    if @product.update_attributes(product_params)\r\n      format.html { redirect_to @product, notice: \'Product was successfully updated.\' }\r\n      format.json { render :show, status: :ok, location: @product }\r\n    else\r\n      format.html { render :edit }\r\n      format.json { render json: @product.errors, status: :unprocessable_entity }\r\n    end\r\n  end\r\nend\r\n```\r\n\r\nNow it will delete when we unselect the check boxes.  If you view the source, you will see:\r\n\r\n```html\r\n<input type=\"checkbox\" name=\"product[category_ids][]\" id=\"product_category_ids_\" value=\"1\" />\r\n```\r\n\r\nThe id of the checkbox is messed up. You can use `dom_id` helper to fix it like this:\r\n\r\n```ruby\r\n<%= check_box_tag \"product[category_ids][]\", category.id, @product.categories.include?(category), {:id => dom_id(category, dom_id(@product)) } %>\r\n```\r\n\r\nThis will generate checkbox with id like this:\r\n\r\n```html\r\n<input type=\"checkbox\" name=\"product[category_ids][]\" id=\"product_2_category_1\" value=\"1\" />\r\n```\r\n\r\n### Step 19\r\n\r\nYou can make the check boxes for multiple selection like this:\r\n\r\n```ruby\r\n<div>\r\n<%= select_tag \"product[category_ids][]\", options_from_collection_for_select(Category.all, \"id\", \"name\"), :multiple => true %>\r\n</div>\r\n```\r\n\r\nLet\'s add validation to the product model.\r\n\r\n```ruby\r\nclass Product < ApplicationRecord\r\n  has_and_belongs_to_many :categories\r\n  \r\n  validates_presence_of :name\r\nend\r\n```\r\n\r\nMake the product name blank and update product. Fail saves and the transaction is rolled back. This is correct behavior. You can see in the development.log file that records was inserted into the join table and then it gets rolled back.\r\n\r\n```sh\r\nStarted PATCH \"/products/4\" for ::1 at 2016-03-14 16:48:20 -0700\r\nProcessing by ProductsController#update as HTML\r\n  Parameters: {\"utf8\"=>\"✓\", \"authenticity_token\"=>\"zZkOscnXAalDBKU6jprRh+UOEpvMlO0otMFq8dj2Q0773subQUxlGtvXUQWPSz0mtrUdoL+AY0Th6U3ogPajkQ==\", \"product\"=>{\"name\"=>\"\", \"price\"=>\"100.0\", \"category_ids\"=>[\"1\", \"2\", \"3\", \"4\"]}, \"commit\"=>\"Update product\", \"id\"=>\"4\"}\r\n  Product Load (0.2ms)  SELECT  \"products\".* FROM \"products\" WHERE \"products\".\"id\" = ? LIMIT ?  [[\"id\", 4], [\"LIMIT\", 1]]\r\n   (0.1ms)  begin transaction\r\n  Category Load (0.2ms)  SELECT \"categories\".* FROM \"categories\" WHERE \"categories\".\"id\" IN (1, 2, 3, 4)\r\n  Category Load (0.1ms)  SELECT \"categories\".* FROM \"categories\" INNER JOIN \"categories_products\" ON \"categories\".\"id\" = \"categories_products\".\"category_id\" WHERE \"categories_products\".\"product_id\" = ?  [[\"product_id\", 4]]\r\n  SQL (1.1ms)  INSERT INTO \"categories_products\" (\"category_id\", \"product_id\") VALUES (?, ?)  [[\"category_id\", 1], [\"product_id\", 4]]\r\n  SQL (0.0ms)  INSERT INTO \"categories_products\" (\"category_id\", \"product_id\") VALUES (?, ?)  [[\"category_id\", 2], [\"product_id\", 4]]\r\n   (0.5ms)  rollback transaction\r\n  Category Load (0.1ms)  SELECT \"categories\".* FROM \"categories\"\r\n  Rendered products/_form.html.erb (3.4ms)\r\n  Rendered products/edit.html.erb within layouts/application (4.8ms)\r\nCompleted 200 OK in 49ms (Views: 35.3ms | ActiveRecord: 2.2ms)\r\n```\r\n\r\nInstead of using `permit!`, we can allow `category_ids` like this:\r\n\r\n```ruby\r\ndef product_params\r\n  params.require(:product).permit(:name, :price, {category_ids: []})\r\nend\r\n```\r\n\r\n## Rails 5 Clean Up \r\n\r\nRails 4.x and 5 provide you with `collection_check_boxes` which simplifies things a bit.\r\n\r\n```ruby\r\n<div class=\"field\">\r\n  <%= f.collection_check_boxes(:category_ids, Category.all, :id, :name, checked: product.categories.map(&:id)) do |b| %>	\r\n  	<%= b.check_box %> <%= b.label %>\r\n  <% end %>\r\n</div>\r\n```\r\n\r\nIn this case, you don\'t need `params[:product][:category_ids] ||=[]` line to handle the empty check box selection. So the update and product_params method looks like this:\r\n\r\n```ruby\r\ndef update\r\n  respond_to do |format|\r\n    if @product.update_attributes(product_params)\r\n      format.html { redirect_to @product, notice: \'Product was successfully updated.\' }\r\n      format.json { render :show, status: :ok, location: @product }\r\n    else\r\n      format.html { render :edit }\r\n      format.json { render json: @product.errors, status: :unprocessable_entity }\r\n    end\r\n  end\r\nend\r\n\r\ndef product_params\r\n  params.require(:product).permit(:name, :price, {category_ids: []})\r\nend\r\n```\r\n\r\nThere is a minor UI display issue with `collection_check_boxes`. The check box and the label are on different rows. This requires CSS fix to display the check box and the label on the same row.\r\n\r\n## Summary\r\n\r\nIn Rails 3.x apps you had to write quite a bit of code to get the checkboxes working for habtm association. In Rails 4.x and 5, it\'s a bit simpler to use checkboxes with habtm association.\r\n\r\n','2016-03-16 06:00:46','2016-03-16 06:10:27'),(3201,'Looping Through Flash in Rails 5','## Steps \r\n### Step 1\r\n\r\nIn `app/views/layouts/application.html.erb` layout file add:\r\n\r\n```ruby\r\n<% flash.each do |key, msg| %>\r\n	<%= content_tag :div, msg, id: key %>\r\n<% end %>\r\n```\r\n\r\nThe layout file now looks like this:\r\n\r\n```ruby\r\n<!DOCTYPE html>\r\n<html>\r\n  <head>\r\n    <title>Todo List</title>\r\n    <%= csrf_meta_tags %>\r\n    <%= action_cable_meta_tag %>\r\n\r\n    <%= stylesheet_link_tag    \'application\', media: \'all\', \'data-turbolinks-track\' => \'reload\' %>\r\n    <%= javascript_include_tag \'application\', \'data-turbolinks-track\' => \'reload\' %>\r\n  </head>\r\n\r\n  <% flash.each do |key, msg| %>\r\n  	<%= content_tag :div, msg, id: key %>\r\n  <% end %>\r\n\r\n  <body>\r\n	 <div id=\'container\'>\r\n		 <h1></h1>\r\n	 	    <%= yield %>\r\n	 </div>\r\n  </body>\r\n    \r\n</html>\r\n```\r\n\r\n### Step 2\r\n\r\nRemove from notice section in the `app/views/products/show.html.erb`:\r\n\r\n```ruby\r\n<p id=\"notice\"><%= notice %></p>\r\n```\r\n\r\n### Step 3\r\n\r\nEdit the product. You will see the flash notice rendered on the product show page.','2016-03-17 15:28:24','2016-03-17 15:28:24'),(3211,'Eager Loading in Rails 5','## Steps \r\n\r\n### Step 1\r\n\r\nList of tasks displayed on the index page. In `app/views/tasks/index.html.erb` we display the task name and the project it belongs to:\r\n \r\n```rhtml\r\n<% @tasks.each do |task| %>\r\n  <td><%= task.name %> in <%= task.project.name %></td> \r\n<% end %>\r\n```\r\n\r\n### Step 2\r\n\r\nThe models have the associations where a task belongs to a project.\r\n\r\n```ruby\r\nclass Task < ApplicationRecord\r\n  belongs_to :project  \r\nend\r\n```\r\n\r\n### Step 3\r\n\r\nIn the tasks controller index action we retrieve all the tasks.\r\n\r\n```ruby\r\ndef index\r\n  @tasks = Task.all\r\nend\r\n```\r\n\r\n### Step 4\r\n\r\nCreate sample data in `seeds.rb`:\r\n\r\n```ruby\r\nwealthy = Project.create(name: \'Wealth Building\')\r\nwealthy.tasks.create(name: \'Get rich quick\', complete: false, priority: 4)\r\nwealthy.tasks.create(name: \'Write a book\', complete: true, priority: 5)\r\n\r\nhappy = Project.create(name: \'Be Happy\')\r\nhappy.tasks.create(name: \'Buy a puppy\', complete: false, priority: 9)\r\nhappy.tasks.create(name: \'Dance in the rain\', complete: true, priority: 7)\r\nhappy.tasks.create(name: \'Dance in the snow\', complete: true, priority: 6)\r\nhappy.tasks.create(name: \'Walk on water\', complete: true, priority: 7)\r\nhappy.tasks.create(name: \'Just Blog It\', complete: true, priority: 5)\r\nhappy.tasks.create(name: \'Play tennis\', complete: true, priority: 4)\r\nhappy.tasks.create(name: \'Make fun of Donald Trump\', complete: true, priority: 3)\r\nhappy.tasks.create(name: \'Walk on moon\', complete: true, priority: 2)\r\n```\r\n\r\nRe-populate the database.\r\n\r\n```\r\nrails db:drop db:migrate db:seed\r\n```\r\n\r\n### Step 5\r\n\r\nIn the rails console, we can see that we have 10 tasks and 2 projects.\r\n\r\n```\r\nrails c\r\n > Task.count\r\n   (0.1ms)  SELECT COUNT(*) FROM \"tasks\"\r\n => 10 \r\n > Project.count\r\n   (0.1ms)  SELECT COUNT(*) FROM \"projects\"\r\n => 2 \r\n```\r\n\r\n### Step 6\r\n\r\nIn the development log file we can see the N+1 query problem.\r\n\r\n```sh\r\nStarted GET \"/tasks\" for ::1 at 2016-03-16 22:10:59 -0700\r\n  ActiveRecord::SchemaMigration Load SELECT \"schema_migrations\".* FROM \"schema_migrations\"\r\nProcessing by TasksController#index as HTML\r\nTask Load   SELECT \"tasks\".* FROM \"tasks\"\r\nProject Load  SELECT  \"projects\".* FROM \"projects\" WHERE \"projects\".\"id\" = ? LIMIT ? [[\"id\", 1], [\"LIMIT\", 1]]\r\nCACHE  SELECT  \"projects\".* FROM \"projects\" WHERE \"projects\".\"id\" = ? LIMIT ? [[\"id\", 1], [\"LIMIT\", 1]]\r\nProject Load SELECT  \"projects\".* FROM \"projects\" WHERE \"projects\".\"id\" = ? LIMIT ? [[\"id\", 2], [\"LIMIT\", 1]]\r\nCACHE  SELECT  \"projects\".* FROM \"projects\" WHERE \"projects\".\"id\" = ? LIMIT ? [[\"id\", 2], [\"LIMIT\", 1]]\r\nCACHE  SELECT  \"projects\".* FROM \"projects\" WHERE \"projects\".\"id\" = ? LIMIT ? [[\"id\", 2], [\"LIMIT\", 1]]\r\nCACHE  SELECT  \"projects\".* FROM \"projects\" WHERE \"projects\".\"id\" = ? LIMIT ? [[\"id\", 2], [\"LIMIT\", 1]]\r\nCACHE  SELECT  \"projects\".* FROM \"projects\" WHERE \"projects\".\"id\" = ? LIMIT ? [[\"id\", 2], [\"LIMIT\", 1]]\r\nCACHE  SELECT  \"projects\".* FROM \"projects\" WHERE \"projects\".\"id\" = ? LIMIT ? [[\"id\", 2], [\"LIMIT\", 1]]\r\nCACHE  SELECT  \"projects\".* FROM \"projects\" WHERE \"projects\".\"id\" = ? LIMIT ? [[\"id\", 2], [\"LIMIT\", 1]]\r\nCACHE SELECT  \"projects\".* FROM \"projects\" WHERE \"projects\".\"id\" = ? LIMIT ? [[\"id\", 2], [\"LIMIT\", 1]]\r\nRendered tasks/index.html.erb within layouts/application (34.0ms)\r\nCompleted 200 OK in 354ms (Views: 341.1ms | ActiveRecord: 1.4ms)\r\n```\r\n\r\nFrom the log file, we see three SQL queries:\r\n\r\n```sh\r\nSELECT \"tasks\".* FROM \"tasks\"\r\nSELECT  \"projects\".* FROM \"projects\" WHERE \"projects\".\"id\" = ? LIMIT ?  [[\"id\", 1], [\"LIMIT\", 1]]\r\nSELECT  \"projects\".* FROM \"projects\" WHERE \"projects\".\"id\" = ? LIMIT ?  [[\"id\", 2], [\"LIMIT\", 1]]\r\n```\r\n\r\nThe 2 queries are for the project association and 1 for retrieving all tasks. It is 2 + 1, therefore can be generalized as N+1 Query.\r\n\r\n### Step 7\r\n\r\nWe can reduce the number of calls to the database by using **Eager Loading** in the index action of the tasks controller.\r\n\r\n```ruby\r\n@tasks = Task.all.includes(:project)\r\n```\r\n\r\nThe general form of eager loading is:\r\n\r\n```ruby\r\nincludes(:association_name)\r\n```\r\n\r\nIn this case, the association is a `belongs_to` project association.\r\n\r\n### Step 8\r\n\r\nWe see only two SQL queries in the development log.\r\n\r\n```sh\r\nStarted GET \"/tasks\" for ::1 at 2016-03-16 22:14:15 -0700\r\nProcessing by TasksController#index as HTML\r\n  Task Load (0.3ms)  SELECT \"tasks\".* FROM \"tasks\"\r\n  Project Load (0.1ms)  SELECT \"projects\".* FROM \"projects\" WHERE \"projects\".\"id\" IN (1, 2)\r\n  Rendered tasks/index.html.erb within layouts/application (26.3ms)\r\nCompleted 200 OK in 68ms (Views: 62.0ms | ActiveRecord: 1.3ms)\r\n```\r\n\r\nWe now only have two queries:\r\n\r\n```sh\r\nSELECT \"tasks\".* FROM \"tasks\"\r\nSELECT \"projects\".* FROM \"projects\" WHERE \"projects\".\"id\" IN (1, 2)\r\n```\r\n\r\nWe can retrieve as many projects as we want and still incur only two database calls. This is because the SQL query IN can take any number of primary keys for the project. You can also see the time 58 ms vs 354 ms in log file. The performance has improved almost 7 fold!\r\n\r\n**Note:** If you had a has many association, for instance, task has many comments. You can still use eager loading:\r\n\r\n```ruby\r\ninclude: [:project, :comments]\r\n```\r\n\r\nIf the comment belongs to a user, we can use eager loading like this:\r\n\r\n```ruby\r\ninclude: [:project, {comments: :user}]\r\n```\r\n\r\n## Summary\r\n\r\nIn this article, you learned how to use eager loading in Rails 5. We can use eager loading even if we have other associations in the model we are retrieving from the database.','2016-03-18 03:36:51','2016-03-18 03:43:25'),(3221,'Counter Cache Column in Rails 5','## Steps\r\n### Step 1\r\n\r\nThe project model has many tasks. \r\n\r\n```ruby\r\nclass Project < ApplicationRecord\r\n  has_many :tasks  \r\nend\r\n```\r\n\r\nThe index action in projects controller retrieves all projects.\r\n\r\n```ruby\r\ndef index\r\n  @projects = Project.all\r\nend\r\n```\r\n\r\n### Step 2\r\n\r\nThe `projects/index.html.erb` view lists all the project names and the number of tasks for that project. \r\n\r\n```rhtml\r\n<% @projects.each do |project| %>\r\n  <tr>\r\n    <td><%= project.name %></td>\r\n	<td><%= pluralize(project.tasks.size, \'task\') %></td>\r\n  </tr>\r\n<% end %>\r\n```\r\n\r\nThe pluralize view helper will pluralize the string \'task\' if the project tasks size is > 1.\r\n\r\n### Step 3\r\n\r\nBrowse to `http://localhost:3000/projects`. \r\n\r\n```sh\r\nStarted GET \"/projects\" for ::1 at 2016-03-16 23:47:08 -0700\r\n  ActiveRecord::SchemaMigration Load (0.2ms)  SELECT \"schema_migrations\".* FROM \"schema_migrations\"\r\nProcessing by ProjectsController#index as HTML\r\n  Project Load (0.1ms)  SELECT \"projects\".* FROM \"projects\"\r\n   (0.2ms)  SELECT COUNT(*) FROM \"tasks\" WHERE \"tasks\".\"project_id\" = ?  [[\"project_id\", 1]]\r\n   (0.1ms)  SELECT COUNT(*) FROM \"tasks\" WHERE \"tasks\".\"project_id\" = ?  [[\"project_id\", 2]]\r\n   (0.1ms)  SELECT COUNT(*) FROM \"tasks\" WHERE \"tasks\".\"project_id\" = ?  [[\"project_id\", 3]]\r\n  Rendered projects/index.html.erb within layouts/application (25.4ms)\r\nCompleted 200 OK in 202ms (Views: 190.5ms | ActiveRecord: 1.3ms)\r\n```\r\n\r\nYou can see three + 1 SQL queries in the development log file. One for projects and three for tasks.\r\n\r\n### Step 4\r\n\r\nWe want to reduce `count(*)` to one query. Eager loading is one way. It retrieves more columns than just the count. This uses more bandwidth and time. Create the migration to `add_tasks_count` column to the projects table.\r\n\r\n```sh\r\nrails g migration add_tasks_count\r\n```\r\n\r\nModify the migration file like this:\r\n\r\n```ruby\r\nclass AddTasksCount < ActiveRecord::Migration[5.0]\r\n  def change\r\n    add_column :projects, :tasks_count, :integer, default: 0\r\n  end\r\nend\r\n```\r\n\r\nA new project created will have 0 tasks by default. Migrate the database.\r\n\r\n```sh\r\nrails db:migrate\r\n```\r\n\r\n### Step 5\r\n\r\nCreate a rake task `counter_cache.rake` in lib/tasks:\r\n\r\n\r\n```ruby\r\ndesc \'Counter cache for project has many tasks\'\r\n\r\ntask task_counter: :environment do\r\n  Project.reset_column_information\r\n  Project.pluck(:id).find_each do |p|\r\n    Project.reset_counters p.id, :tasks\r\n  end\r\nend\r\n```\r\n\r\nI have created a rake task for back filling task count for the existing projects in the database. The `reset_counters` method avoids the readonly error if you use `update_attribute`. This will update the old projects to have the right task count. From the Rails Guides:\r\n\r\n> The `reset_column_information` method resets all the cached information about columns, which will cause them to be reloaded on the next request. The most common usage pattern for this method is probably in a migration, when just after creating a table you want to populate it with some default values.\r\n\r\n### Step 6\r\n\r\nRun `task_counter` rake task. \r\n\r\n```sh\r\nrake task_counter\r\n```\r\n\r\nWe can check whether the tasks_count has been populated or not in rails console.\r\n\r\n```sh\r\n> p = Project.first\r\n  Project Load (0.2ms)  SELECT  \"projects\".* FROM \"projects\" ORDER BY \"projects\".\"id\" ASC LIMIT ?  [[\"LIMIT\", 1]]\r\n => #<Project id: 1, name: \"Wealth Building\", created_at: \"2016-03-16 19:07:26\", updated_at: \"2016-03-16 20:55:29\", tasks_count: 2> \r\n> Project.last\r\n  Project Load (0.2ms)  SELECT  \"projects\".* FROM \"projects\" ORDER BY \"projects\".\"id\" DESC LIMIT ?  [[\"LIMIT\", 1]]\r\n => #<Project id: 3, name: \"Cooking\", created_at: \"2016-03-16 20:06:26\", updated_at: \"2016-03-16 20:06:26\", tasks_count: 0> \r\n```\r\n \r\nThe first project has 2 tasks and the last project has 0 tasks.\r\n\r\n### Step 7\r\n\r\nIn schema.rb, you can see the `tasks_count` column for projects table.\r\n\r\n```ruby\r\ncreate_table \"projects\", force: :cascade do |t|\r\n  t.string   \"name\"\r\n  t.datetime \"created_at\",              null: false\r\n  t.datetime \"updated_at\",              null: false\r\n  t.integer  \"tasks_count\", default: 0\r\nend\r\n```\r\n\r\n### Step 8\r\n\r\nChange the `projects/index.html.erb` to use the `tasks_count` field:\r\n\r\n```sh\r\n<td><%= pluralize(project.tasks_count, \'task\') %></td>\r\n```\r\n		\r\n### Step 9\r\n\r\nReload project index page and view the log for SQL queries.\r\n\r\n```sh\r\nStarted GET \"/projects\" for ::1 at 2016-03-16 24:00:00 -0700\r\nProcessing by ProjectsController#index as HTML\r\n  Project Load (0.1ms)  SELECT \"projects\".* FROM \"projects\"\r\n  Rendered projects/index.html.erb within layouts/application (1.6ms)\r\nCompleted 200 OK in 48ms (Views: 45.6ms | ActiveRecord: 0.1ms)\r\n```\r\n\r\nYou see that there is only one query now instead of 3+1 queries before using the counter cache.\r\n\r\n### Step 10\r\n\r\nLet\'s add a new task to the last project in the rails console.\r\n\r\n```sh\r\n > Project.last\r\n  Project Load (0.2ms)  SELECT  \"projects\".* FROM \"projects\" ORDER BY \"projects\".\"id\" DESC LIMIT ?  [[\"LIMIT\", 1]]\r\n => #<Project id: 3, name: \"Cooking\", created_at: \"2016-03-16 20:06:26\", updated_at: \"2016-03-16 20:06:26\", tasks_count: 0> \r\n > p.tasks.create(name: \'Add counter cache\')\r\n   (0.1ms)  begin transaction\r\n  SQL (0.7ms)  INSERT INTO \"tasks\" (\"name\", \"created_at\", \"updated_at\", \"project_id\") VALUES (?, ?, ?, ?)  [[\"name\", \"Add counter cache\"], [\"created_at\", 2016-03-16 21:09:25 UTC], [\"updated_at\", 2016-03-16 21:09:25 UTC], [\"project_id\", 1]]\r\n   (0.7ms)  commit transaction\r\n => #<Task id: 11, name: \"Add counter cache\", complete: nil, created_at: \"2016-03-16 21:09:25\", updated_at: \"2016-03-16 21:09:25\", project_id: 1, priority: nil> \r\n```\r\n\r\nReload the page. The Cooking project still has 0 tasks. Let\'s fix this problem.\r\n\r\n### Step 11\r\n\r\nAdd counter cache to the Task model.\r\n\r\n```ruby\r\nbelongs_to :project, counter_cache: true\r\n```\r\n\r\nThis will update tasks_count in projects table when the task is deleted or created.\r\n\r\n### Step 12\r\n\r\nIn the console, retrieve the first project and delete a task that belongs to that project.\r\n\r\n```sh\r\n> f = Project.first\r\n  Project Load (0.1ms)  SELECT  \"projects\".* FROM \"projects\" ORDER BY \"projects\".\"id\" ASC LIMIT ?  [[\"LIMIT\", 1]]\r\n => #<Project id: 1, name: \"Wealth Building\", created_at: \"2016-03-16 19:07:26\", updated_at: \"2016-03-16 20:55:29\", tasks_count: 2> \r\n  f.tasks.map(&:id)\r\n  Task Load (0.1ms)  SELECT \"tasks\".* FROM \"tasks\" WHERE \"tasks\".\"project_id\" = ?  [[\"project_id\", 1]]\r\n=> [1, 2, 11] \r\n > f.name\r\n => \"Wealth Building\" \r\n> Task.destroy(1)\r\n  Task Load (0.1ms)  SELECT  \"tasks\".* FROM \"tasks\" WHERE \"tasks\".\"id\" = ? LIMIT ?  [[\"id\", 1], [\"LIMIT\", 1]]\r\n   (0.0ms)  begin transaction\r\n  SQL (0.6ms)  DELETE FROM \"tasks\" WHERE \"tasks\".\"id\" = ?  [[\"id\", 1]]\r\n   (0.5ms)  commit transaction\r\n => #<Task id: 1, name: \"Get rich quick\", complete: false, created_at: \"2016-03-16 19:07:26\", updated_at: \"2016-03-16 19:07:26\", project_id: 1, priority: 4> \r\n``` \r\n\r\nReload the project index page `http://localhost:3000/projects`. You will now see the number of tasks decremented for `Wealth Building` project.\r\n\r\n## Correction\r\n\r\nIn step 5, you will get:\r\n\r\n```ruby\r\nNoMethodError: undefined method `find_each\' for []:Array\r\n```\r\n\r\nYou have two options. You can either use the batch method `find_each` if you want to process projects in batches of 1000 as shown below:\r\n\r\n```ruby\r\n> Project.find_each do |x|\r\n      p x\r\n    end\r\n  Project Load (0.1ms)  SELECT  \"projects\".* FROM \"projects\" ORDER BY \"projects\".\"id\" ASC LIMIT ?  [[\"LIMIT\", 1000]]\r\n```\r\n\r\nOr, you can use `each` method if you want to get only specific column from the projects table and you don\'t have too many projects in your database.\r\n\r\n```ruby\r\n> Project.pluck(:id).each do |x|\r\n      p x\r\n    end\r\n   (0.2ms)  SELECT \"projects\".\"id\" FROM \"projects\"\r\n```\r\n\r\nYou can read the docs for [batch processing in Rails 5](http://api.rubyonrails.org/classes/ActiveRecord/Batches.html \'batch processing in Rails 5\'). Thanks to Roman Storm for this correction.\r\n\r\n## Making Error Message Meaningful\r\n\r\nIf you forget to define the `counter_cache: true` in the model, you will get this error:\r\n\r\n```\r\n~/videos/rcac $rake task_counter\r\nrake aborted!\r\nNoMethodError: undefined method `counter_cache_column\' for nil:NilClass\r\n/Users/bparanj/.rvm/gems/ruby-2.3.1@r5/gems/activerecord-5.0.1/lib/active_record/counter_cache.rb:38:in `block in reset_counters\'\r\n/Users/bparanj/.rvm/gems/ruby-2.3.1@r5/gems/activerecord-5.0.1/lib/active_record/counter_cache.rb:22:in `each\'\r\n/Users/bparanj/.rvm/gems/ruby-2.3.1@r5/gems/activerecord-5.0.1/lib/active_record/counter_cache.rb:22:in `reset_counters\'\r\n/Users/bparanj/videos/rcac/lib/tasks/counter_cache.rake:6:in `block (2 levels) in <top (required)>\'\r\n/Users/bparanj/.rvm/gems/ruby-2.3.1@r5/gems/activerecord-5.0.1/lib/active_record/relation/batches.rb:59:in `block (2 levels) in find_each\'\r\n/Users/bparanj/.rvm/gems/ruby-2.3.1@r5/gems/activerecord-5.0.1/lib/active_record/relation/batches.rb:59:in `each\'\r\n/Users/bparanj/.rvm/gems/ruby-2.3.1@r5/gems/activerecord-5.0.1/lib/active_record/relation/batches.rb:59:in `block in find_each\'\r\n/Users/bparanj/.rvm/gems/ruby-2.3.1@r5/gems/activerecord-5.0.1/lib/active_record/relation/batches.rb:121:in `block in find_in_batches\'\r\n/Users/bparanj/.rvm/gems/ruby-2.3.1@r5/gems/activerecord-5.0.1/lib/active_record/relation/batches.rb:214:in `block in in_batches\'\r\n/Users/bparanj/.rvm/gems/ruby-2.3.1@r5/gems/activerecord-5.0.1/lib/active_record/relation/batches.rb:198:in `loop\'\r\n/Users/bparanj/.rvm/gems/ruby-2.3.1@r5/gems/activerecord-5.0.1/lib/active_record/relation/batches.rb:198:in `in_batches\'\r\n/Users/bparanj/.rvm/gems/ruby-2.3.1@r5/gems/activerecord-5.0.1/lib/active_record/relation/batches.rb:120:in `find_in_batches\'\r\n/Users/bparanj/.rvm/gems/ruby-2.3.1@r5/gems/activerecord-5.0.1/lib/active_record/relation/batches.rb:58:in `find_each\'\r\n/Users/bparanj/.rvm/gems/ruby-2.3.1@r5/gems/activerecord-5.0.1/lib/active_record/querying.rb:9:in `find_each\'\r\n/Users/bparanj/videos/rcac/lib/tasks/counter_cache.rake:5:in `block in <top (required)>\'\r\n/Users/bparanj/.rvm/gems/ruby-2.3.1@r5/gems/rake-12.0.0/exe/rake:27:in `<top (required)>\'\r\nTasks: TOP => task_counter\r\n(See full trace by running task with --trace)\r\n```\r\n\r\nwhen you run the rake task. If you open the file `/Users/user-name/.rvm/gems/ruby-2.3.1@r5/gems/activerecord-5.0.1/lib/active_record/counter_cache.rb` and look at line 38:\r\n\r\n```ruby\r\n      def reset_counters(id, *counters)\r\n        object = find(id)\r\n        counters.each do |counter_association|\r\n          has_many_association = _reflect_on_association(counter_association)\r\n          unless has_many_association\r\n            has_many = reflect_on_all_associations(:has_many)\r\n            has_many_association = has_many.find { |association| association.counter_cache_column && association.counter_cache_column.to_sym == counter_association.to_sym }\r\n            counter_association = has_many_association.plural_name if has_many_association\r\n          end\r\n          raise ArgumentError, \"\'#{self.name}\' has no association called \'#{counter_association}\'\" unless has_many_association\r\n\r\n          if has_many_association.is_a? ActiveRecord::Reflection::ThroughReflection\r\n            has_many_association = has_many_association.through_reflection\r\n          end\r\n\r\n          foreign_key  = has_many_association.foreign_key.to_s\r\n          child_class  = has_many_association.klass\r\n          reflection   = child_class._reflections.values.find { |e| e.belongs_to? && e.foreign_key.to_s == foreign_key && e.options[:counter_cache].present? }\r\n          counter_name = reflection.counter_cache_column\r\n\r\n          unscoped.where(primary_key => object.id).update_all(\r\n            counter_name => object.send(counter_association).count(:all)\r\n          )\r\n        end\r\n        return true\r\n      end\r\n```\r\n\r\nJust before the line 38:\r\n\r\n```ruby\r\ncounter_name = reflection.counter_cache_column\r\n```\r\n\r\nwe need to raise an exception with a helpful error message like this:\r\n\r\n\r\n```ruby\r\nraise ArgumentError, \"\'counter_cache: true declaration is missing in the model\" if reflection.nil?\r\n```\r\n\r\nThis is an opportunity to contribute to Rails. Go ahead and submit a pull request with a test case for this problem.\r\n\r\n## Summary\r\n\r\nIn this article, you learned how to use counter cache in Rails 5 apps.\r\n\r\n## References\r\n\r\n[Select vs Pluck](http://gavinmiller.io/2013/getting-to-know-pluck-and-select/ \'Select vs Pluck\')','2016-03-19 02:47:01','2017-02-09 07:22:46'),(3231,'How To Get A List Of All Currently Registered MIME Types With Rails','## Objective\r\n\r\nTo learn how to find answers to your own questions by browsing the Rails source code.\r\n\r\n## Steps\r\n## Step 1\r\n\r\nGo to the [Rails](https://github.com/rails/rails \'Rails\') repository.\r\n\r\n## Step 2\r\n\r\nSearch for Mime in the `This Repository` search field. Or browse to `https://github.com/rails/rails/search?utf8=%E2%9C%93&q=Mime`.\r\n\r\n## Step 3\r\n\r\nThe second search result is `actionpack/lib/action_dispatch/http/mime_types.rb`. You can see all the registered Mime types in this file.  \r\n\r\n```ruby\r\n# Build list of Mime types for HTTP responses\r\n# http://www.iana.org/assignments/media-types/\r\n\r\nMime::Type.register \"text/html\", :html, %w( application/xhtml+xml ), %w( xhtml )\r\nMime::Type.register \"text/plain\", :text, [], %w(txt)\r\nMime::Type.register \"text/javascript\", :js, %w( application/javascript application/x-javascript )\r\nMime::Type.register \"text/css\", :css\r\nMime::Type.register \"text/calendar\", :ics\r\nMime::Type.register \"text/csv\", :csv\r\nMime::Type.register \"text/vcard\", :vcf\r\n\r\nMime::Type.register \"image/png\", :png, [], %w(png)\r\nMime::Type.register \"image/jpeg\", :jpeg, [], %w(jpg jpeg jpe pjpeg)\r\nMime::Type.register \"image/gif\", :gif, [], %w(gif)\r\nMime::Type.register \"image/bmp\", :bmp, [], %w(bmp)\r\nMime::Type.register \"image/tiff\", :tiff, [], %w(tif tiff)\r\nMime::Type.register \"image/svg+xml\", :svg\r\n\r\nMime::Type.register \"video/mpeg\", :mpeg, [], %w(mpg mpeg mpe)\r\n\r\nMime::Type.register \"application/xml\", :xml, %w( text/xml application/x-xml )\r\nMime::Type.register \"application/rss+xml\", :rss\r\nMime::Type.register \"application/atom+xml\", :atom\r\nMime::Type.register \"application/x-yaml\", :yaml, %w( text/yaml )\r\n\r\nMime::Type.register \"multipart/form-data\", :multipart_form\r\nMime::Type.register \"application/x-www-form-urlencoded\", :url_encoded_form\r\n\r\n# http://www.ietf.org/rfc/rfc4627.txt\r\n# http://www.json.org/JSONRequest.html\r\nMime::Type.register \"application/json\", :json, %w( text/x-json application/jsonrequest )\r\n\r\nMime::Type.register \"application/pdf\", :pdf, [], %w(pdf)\r\nMime::Type.register \"application/zip\", :zip, [], %w(zip)\r\nMime::Type.register \"application/gzip\", :gzip, %w(application/x-gzip), %w(gz)\r\n```\r\n\r\n## Step 4\r\n\r\nThe first result is `actionpack/test/dispatch/mime_type_test.rb`. It uses `Mime::LOOKUP`. We can experiment in the rails console.\r\n\r\n```ruby\r\n$ rails c\r\nMime::LOOKUP\r\n => {\"text/html\"=>#<Mime::Type:0x007fc4b3477500 @synonyms=[\"application/xhtml+xml\"], @symbol=:html, @string=\"text/html\", @hash=-1486337550136291455>, \"application/xhtml+xml\"=>#<Mime::Type:0x007fc4b3477500 @synonyms=[\"application/xhtml+xml\"], @symbol=:html, @string=\"text/html\", @hash=-1486337550136291455>, \"text/plain\"=>#<Mime::Type:0x007fc4b3476da8 @synonyms=[], @symbol=:text, @string=\"text/plain\", @hash=1399664015805064671>, \"text/javascript\"=>#<Mime::Type:0x007fc4b3476948 ... } \r\n > Mime::LOOKUP.keys\r\n => [\"text/html\", \"application/xhtml+xml\", \"text/plain\", \"text/javascript\", \"application/javascript\", \"application/x-javascript\", \"text/css\", \"text/calendar\", \"text/csv\", \"text/vcard\", \"image/png\", \"image/jpeg\", \"image/gif\", \"image/bmp\", \"image/tiff\", \"image/svg+xml\", \"video/mpeg\", \"application/xml\", \"text/xml\", \"application/x-xml\", \"application/rss+xml\", \"application/atom+xml\", \"application/x-yaml\", \"text/yaml\", \"multipart/form-data\", \"application/x-www-form-urlencoded\", \"application/json\", \"text/x-json\", \"application/jsonrequest\", \"application/pdf\", \"application/zip\", \"application/gzip\", \"application/x-gzip\", \"application/vnd.web-console.v2\"] \r\n```\r\n\r\nWe also see that the test does a lookup. We can do the same in the rails console.\r\n\r\n```ruby\r\n > Mime::Type.lookup(\'text/html\')\r\n => #<Mime::Type:0x007feb45bfc2b8 @synonyms=[\"application/xhtml+xml\"], @symbol=:html, @string=\"text/html\", @hash=-2916850394213078872> \r\n```\r\n\r\n## Summary\r\n\r\nIn this article, you learned how to find answer to your questions by browsing the Rails source code.','2016-03-19 03:00:39','2016-03-19 03:00:39'),(3241,'SQL Inner Join, Order By and Group By','Let\'s play in the database console.\r\n\r\n```sh\r\nrails dbconsole\r\n```\r\n\r\nList all the tables.\r\n\r\n```sh\r\n> .tables\r\nar_internal_metadata  products              tasks               \r\ncategories            projects              users               \r\ncategories_products   schema_migrations   \r\n```\r\n\r\nTurn on the headers so that we can see the headers for each column in the result.\r\n\r\n```sh\r\n> .headers on\r\n```\r\n\r\nLet\'s list all the tasks in the database.\r\n\r\n```\r\nsqlite> select * from tasks;\r\nid          name            complete    created_at                  updated_at                  project_id  priority  \r\n----------  --------------  ----------  --------------------------  --------------------------  ----------  ----------\r\n1           Get rich quick  f           2016-03-16 19:07:26.558227  2016-03-16 19:07:26.558227  1           4         \r\n2           Write a book    t           2016-03-16 19:07:26.560890  2016-03-16 19:07:26.560890  1           5         \r\n3           Buy a puppy     f           2016-03-16 19:07:26.564746  2016-03-16 19:07:26.564746  2           9         \r\n4           Dance in the r  t           2016-03-16 19:07:26.566557  2016-03-16 19:07:26.566557  2           7         \r\n5           Dance in the s  t           2016-03-16 19:07:26.568377  2016-03-16 19:07:26.568377  2           6         \r\n6           Walk on water   t           2016-03-16 19:07:26.570329  2016-03-16 19:07:26.570329  2           7         \r\n7           Just Blog It    t           2016-03-16 19:07:26.572176  2016-03-16 19:07:26.572176  2           5         \r\n8           Play tennis     t           2016-03-16 19:07:26.573898  2016-03-16 19:07:26.573898  2           4         \r\n9           Make fun of Do  t           2016-03-16 19:07:26.575743  2016-03-16 19:07:26.575743  2           3         \r\n10          Walk on moon    t           2016-03-16 19:07:26.577819  2016-03-16 19:07:26.577819  2           2 \r\n```\r\n\r\nHow can we get the count of tasks for each project?\r\n\r\n```sh\r\nsqlite> select project_id, count(*) as TaskCount from tasks group by project_id;\r\nproject_id  TaskCount \r\n----------  ----------\r\n1           2         \r\n2           8    \r\n```\r\n\r\nThe above SQL query used the `group by` to get the job done. We can also use `join` to accomplish the same as follows:\r\n\r\n```sh\r\nselect projects.*, COUNT(tasks.project_id) as total_tasks\r\n   ...> from projects\r\n   ...> join tasks on tasks.project_id = projects.id\r\n   ...> group by projects.id;\r\nid          name             created_at                  updated_at                  total_tasks\r\n----------  ---------------  --------------------------  --------------------------  -----------\r\n1           Wealth Building  2016-03-16 19:07:26.505001  2016-03-16 19:07:26.505001  2          \r\n2           Be Happy         2016-03-16 19:07:26.562468  2016-03-16 19:07:26.562468  8 \r\n```\r\n\r\nWhat\'s the point of using both `group by` and the `join`? We can use `left join` if we want tasks with 0 count.\r\n\r\n```sh\r\nsqlite> select projects.*, COUNT(tasks.project_id) as total_tasks\r\n   ...> from projects\r\n   ...> left join tasks on tasks.project_id = projects.id\r\n   ...> group by projects.id\r\n   ...> order by count(tasks.project_id);\r\nid          name        created_at                  updated_at                  total_tasks\r\n----------  ----------  --------------------------  --------------------------  -----------\r\n3           Cooking     2016-03-16 20:06:26.951760  2016-03-16 20:06:26.951760  0          \r\n1           Wealth Bui  2016-03-16 19:07:26.505001  2016-03-16 19:07:26.505001  2          \r\n2           Be Happy    2016-03-16 19:07:26.562468  2016-03-16 19:07:26.562468  8  \r\n```\r\n\r\nIf we don\'t use the `order by` we will get the results that is ordered by `id` not by total tasks.\r\n\r\n```sh\r\nsqlite> select projects.*, COUNT(tasks.project_id) as total_tasks\r\n   ...>  from projects\r\n   ...>  left join tasks on tasks.project_id = projects.id\r\n   ...>  group by projects.id;\r\nid          name             created_at                  updated_at                  total_tasks\r\n----------  ---------------  --------------------------  --------------------------  -----------\r\n1           Wealth Building  2016-03-16 19:07:26.505001  2016-03-16 19:07:26.505001  2          \r\n2           Be Happy         2016-03-16 19:07:26.562468  2016-03-16 19:07:26.562468  8          \r\n3           Cooking          2016-03-16 20:06:26.951760  2016-03-16 20:06:26.951760  0 \r\n```\r\n\r\n## Summary\r\n\r\nIn this article, you learned how to use `order by`, `group by`, `join` and `inner join`.','2016-03-19 03:45:59','2016-03-19 03:47:04'),(3251,'How to use ActiveRecord to Execute SQL Query','Establish the database connection for the current environment with connection values specified in the `database.yml`.\r\n\r\n```ruby\r\n$ rails c\r\nLoading development environment (Rails 4.2.6)\r\n > p = ActiveRecord::Base.establish_connection\r\n => #<ActiveRecord::ConnectionAdapters::ConnectionPool:0x00720 @mon_owner=nil, @mon_count=0, @mon_mutex=#<Thread::Mutex:0x007a8>, @spec=#<ActiveRecord::ConnectionAdapters::ConnectionSpecification:0x007fc8 @config={:adapter=>\"mysql2\", :encoding=>\"utf8\", :reconnect=>false, :database=>\"lafon_development\", :pool=>5...> \r\n```\r\n\r\nThe `establish_connection` method returns a connection pool object.\r\n\r\n```ruby \r\n > p.class\r\n => ActiveRecord::ConnectionAdapters::ConnectionPool \r\n```\r\n\r\nWe can get a connection from the pool by calling `connection` on the pool object.\r\n\r\n```ruby \r\n > c = p.connection\r\n => #<ActiveRecord::ConnectionAdapters::Mysql2Adapter:0x00c88 @transaction_manager=#<ActiveRecord::ConnectionAdapters::TransactionManager:0x00220 @stack=[], @connection=#<ActiveRecord::ConnectionAdapters::Mysql2Adapter:0x00e8 ...>>, @query_cache={}, @query_cache_enabled=false, ... > \r\n```\r\n\r\nNow, we can execute SQL query using that connection.\r\n\r\n```ruby\r\n > results = c.execute(\'select count(*) from articles;\')\r\n   (0.8ms)  select count(*) from articles;\r\n => #<Mysql2::Result:0x00780 @query_options={:as=>:array, :async=>false, :cast_booleans=>false, :symbolize_keys=>false, :database_timezone=>:utc, :application_timezone=>nil, :cache_rows=>true, :connect_flags=>2147525125, :cast=>true, :default_file=>nil, :default_group=>nil, :adapter=>\"mysql2\", :encoding=>\"utf8\", :reconnect=>false, :database=>\"lafon_development\", :pool=>5, :username=>\"root\", :password=>secret, :host=>\"localhost\", :port=>3306, :flags=>2}> \r\n```\r\n\r\nThis returns a `Mysql2::Result` class.\r\n\r\n```ruby\r\n > results.class\r\n => Mysql2::Result \r\n```\r\n\r\nWe can iterate through the results list to print it. \r\n\r\n```ruby\r\n > results.each do |result|\r\n >     p result\r\n >   end\r\n[305]\r\n => [[305]] \r\n```\r\n\r\nWhat if we want to retrieve rows? It will be similar to what we did to get the number of articles in the database.\r\n\r\n```ruby \r\n > rows = c.execute(\'select id, title from articles limit 4;\')\r\n    (0.4ms)  select id, title from articles limit 4;\r\n  => #<Mysql2::Result:0x0032 @query_options={:as=>:array, :async=>false, :cast_booleans=>false, :symbolize_keys=>false, :database_timezone=>:utc, :application_timezone=>nil, :cache_rows=>true, :connect_flags=>2147525125, :cast=>true, :default_file=>nil, :default_group=>nil, :adapter=>\"mysql2\", :encoding=>\"utf8\", :reconnect=>false, :database=>\"lafon_development\", :pool=>5, :username=>\"root\", :password=>humpdaddy, :host=>\"localhost\", :port=>3306, :flags=>2}> \r\n  > rows.each do |row|\r\n  >     p row\r\n  >   end\r\n [41, \"Articles by Category\"]\r\n [51, \"TDD Basics : Writing your First Test\"]\r\n [81, \"TDD Basics : Test First Programming\"]\r\n [91, \"TDD Basics : Canonical Test Structure\"]\r\n  => [[41, \"Articles by Category\"], [51, \"TDD Basics : Writing your First Test\"], [81, \"TDD Basics : Test First Programming\"], [91, \"TDD Basics : Canonical Test Structure\"]]\r\n```\r\n\r\n## Summary\r\n\r\nIn this article, you learned how you can send query to the database using ActiveRecord methods. This comes in handy in situations where you need to fire one-off queries to check the data.','2016-03-19 06:15:56','2016-03-19 06:17:31'),(3261,'Using Rails Foonotes in Rails 5 Apps','## Steps\r\n### Step 1\r\n\r\nAdd rails-footnotes gem to Gemfile.\r\n\r\n```ruby\r\ngroup :development do\r\n  gem \'web-console\', \'~> 3.0\'\r\n  gem \'listen\', \'~> 3.0.5\'\r\n  gem \'rails-footnotes\', \'~> 4.0\'\r\nend\r\n```\r\n\r\nRun bundle install.\r\n\r\n### Step 2\r\n\r\nGenerate the initializer by running the generator.\r\n\r\n```sh\r\n$rails generate rails_footnotes:install\r\ncreate  config/initializers/rails_footnotes.rb\r\n```\r\n\r\nThis will generate the rails_footnotes initializer. The gem is enabled only in development environment. \r\n\r\n```ruby\r\ndefined?(Footnotes) && Footnotes.setup do |f|\r\n  # Whether or not to enable footnotes\r\n  f.enabled = Rails.env.development?\r\n  # You can also use a lambda / proc to conditionally toggle footnotes\r\n  # Example :\r\n  # f.enabled = -> { User.current.admin? }\r\n  # Beware of thread-safety though, Footnotes.enabled is NOT thread safe\r\n  # and should not be modified anywhere else.\r\n\r\n  # Only toggle some notes :\r\n  # f.notes = [:session, :cookies, :params, :filters, :routes, :env, :queries, :log]\r\n\r\n  # Change the prefix :\r\n  # f.prefix = \'mvim://open?url=file://%s&line=%d&column=%d\'\r\n\r\n  # Disable style :\r\n  # f.no_style = true\r\n\r\n  # Lock notes to top right :\r\n  # f.lock_top_right = true\r\n\r\n  # Change font size :\r\n  # f.font_size = \'11px\'\r\n\r\n  # Allow to open multiple notes :\r\n  # f.multiple_notes = true\r\nend\r\n```\r\n\r\nYou can customize this if you like.\r\n\r\n### Step 3\r\n\r\nNow you can click on the controller to view the controller in your editor. You can do the same to View, Partials, Stylesheets and Javascripts links. The other links show the assigns, session, cookies, params, filters, routes, env and queries.  You can view the screenshots [here](http://bparanj.blogspot.com/2016/03/rails-footnotes-gem_19.html \'Rails Footnotes Gem\')\r\n\r\n## Summary\r\n\r\nIn this article, you learned how to use Rails Footnotes gem to speed up your development workflow.\r\n\r\n## References\r\n\r\n[Rails Footnotes Gem](https://github.com/josevalim/rails-footnotes \'Rails Footnotes Gem\')','2016-03-19 22:25:08','2016-03-19 22:27:06'),(3271,'SQL Injection in Rails 5 Apps','## Security Mantra\r\n\r\nDo not trust user input. Don\'t trust params or cookies.\r\n\r\n## Steps\r\n\r\n### Step 1\r\n\r\nThe tasks index page in the `app/views/tasks/index.html.erb` lists all tasks.\r\n\r\n```rhtml\r\n<%= form_tag(tasks_path, method: :get) do %>\r\n	<%= text_field_tag :term %>\r\n	<%= submit_tag \'Search\' %>\r\n<% end %>\r\n<h1>Tasks</h1>\r\n<table>\r\n  <thead>\r\n    <tr>\r\n      <th>Name</th>\r\n      <th>Complete</th>\r\n      <th colspan=\"3\"></th>\r\n    </tr>\r\n  </thead>\r\n  <tbody>\r\n    <% @tasks.each do |task| %>\r\n      <tr>\r\n        <td><%= task.name %> in <%= task.project.name %></td>\r\n        <td><%= task.complete %></td>\r\n        <td><%= link_to \'Show\', task %></td>\r\n        <td><%= link_to \'Edit\', edit_task_path(task) %></td>\r\n        <td><%= link_to \'Destroy\', task, method: :delete, data: { confirm: \'Are you sure?\' } %></td>\r\n      </tr>\r\n    <% end %>\r\n  </tbody>\r\n</table>\r\n<%= link_to \'New Task\', new_task_path %>\r\n```\r\n\r\nIt has a search field that allows searching for tasks. The `form_tag` uses POST by default, so we over-ride it to GET. Because we need to display the projects index page as the search results page.\r\n\r\n### Step 2\r\n\r\nPopulate the database with some seed data. In seeds.rb:\r\n\r\n```ruby\r\nwealthy = Project.create(name: \'Wealth Building\')\r\nwealthy.tasks.create(name: \'Get rich quick\', complete: false, priority: 4)\r\nwealthy.tasks.create(name: \'Write a book\', complete: true, priority: 5)\r\n\r\nhappy = Project.create(name: \'Be Happy\')\r\nhappy.tasks.create(name: \'Buy a puppy\', complete: false, priority: 9)\r\nhappy.tasks.create(name: \'Dance in the rain\', complete: true, priority: 7)\r\nhappy.tasks.create(name: \'Dance in the snow\', complete: true, priority: 6)\r\nhappy.tasks.create(name: \'Walk on water\', complete: true, priority: 7)\r\nhappy.tasks.create(name: \'Just Blog It\', complete: true, priority: 5)\r\nhappy.tasks.create(name: \'Play tennis\', complete: true, priority: 4)\r\nhappy.tasks.create(name: \'Make fun of Donald Trump\', complete: true, priority: 3)\r\nhappy.tasks.create(name: \'Walk on moon\', complete: true, priority: 2)\r\n```\r\n\r\nRun\r\n\r\n```sh\r\nrake db:seed\r\n```\r\n\r\n### Step 3\r\n\r\nLet\'s search for \"Dance\". It displays all the tasks that begin with the search term \'Dance\'. The index method is like this:\r\n\r\n```ruby\r\ndef index\r\n  @tasks = Task.where(\"name LIKE \'%#{params[:term]}%\'\")\r\nend\r\n```\r\n\r\nYou can see the generated SQL query in the development.log file:\r\n\r\n```sh\r\nStarted GET \"/tasks?utf8=%E2%9C%93&term=Dance&commit=Search\" for ::1 at 2016-03-16 17:08:40 -0700\r\nProcessing by TasksController#index as HTML\r\n  Parameters: {\"utf8\"=>\"✓\", \"term\"=>\"Dance\", \"commit\"=>\"Search\"}\r\n  Task Load (0.3ms)  SELECT \"tasks\".* FROM \"tasks\" WHERE (name LIKE \'%Dance%\')\r\n  Project Load (0.1ms)  SELECT  \"projects\".* FROM \"projects\" WHERE \"projects\".\"id\" = ? LIMIT ?  [[\"id\", 2], [\"LIMIT\", 1]]\r\n  CACHE (0.0ms)  SELECT  \"projects\".* FROM \"projects\" WHERE \"projects\".\"id\" = ? LIMIT ?  [[\"id\", 2], [\"LIMIT\", 1]]\r\n  Rendered tasks/index.html.erb within layouts/application (14.6ms)\r\nCompleted 200 OK in 46ms (Views: 38.5ms | ActiveRecord: 1.6ms)\r\n```\r\n\r\nThe database calls takes user input to form the database query. This is susceptible to SQL injection.\r\n\r\n### Step 4\r\n\r\nIf you have a quote in the search term: `Dance \' delete table`. The browser throws the `ActiveRecord::StatementInvalid` error.\r\n\r\n```sh\r\nStarted GET \"/tasks?utf8=%E2%9C%93&term=Dance+%27delete+table&commit=Search\" for ::1 at 2016-03-16 17:09:46 -0700\r\nProcessing by TasksController#index as HTML\r\n  Parameters: {\"utf8\"=>\"✓\", \"term\"=>\"Dance \'delete table\", \"commit\"=>\"Search\"}\r\n  Task Load (0.4ms)  SELECT \"tasks\".* FROM \"tasks\" WHERE (name LIKE \'%Dance \'delete table%\')\r\n  Rendered tasks/index.html.erb within layouts/application (2.9ms)\r\nCompleted 500 Internal Server Error in 7ms (ActiveRecord: 0.4ms)\r\n  \r\nActionView::Template::Error (SQLite3::SQLException: near \"delete\": syntax error: SELECT \"tasks\".* FROM \"tasks\" WHERE (name LIKE \'%Dance \'delete table%\')):\r\n```\r\n\r\n### Step 5\r\n\r\nUse question mark character ? to bind user input in params[:term]. Rails will escape the user input for us. Change the tasks index method:\r\n\r\n```ruby\r\ndef index\r\n  @tasks = Task.where(\"name LIKE ?\", \"%#{params[:term]}%\")  \r\nend\r\n```\r\n\r\nIn order to allow search and list all tasks on the same page, we need a conditional in the index action.\r\n\r\n```ruby\r\ndef index\r\n  if params[:term]\r\n    q = \"%#{params[:term]}%\"\r\n    @tasks = Task.where(\"name LIKE ?\", q )\r\n  else\r\n    @tasks = Task.all\r\n  end\r\nend\r\n```\r\n\r\n### Step 6\r\n\r\nIf you have single quote in the search term: `Dance \' delete table`. The search term does not have the single quote anymore in the generated SQL. It has been replaced with a blank string. You can see that in the log file\r\n\r\n```sh\r\nStarted GET \"/tasks?utf8=%E2%9C%93&term=Dance+%27delete+table&commit=Search\" for ::1 at 2016-03-16 17:41:23 -0700\r\nProcessing by TasksController#index as HTML\r\n  Parameters: {\"utf8\"=>\"✓\", \"term\"=>\"Dance \'delete table\", \"commit\"=>\"Search\"}\r\n  Task Load (0.1ms)  SELECT \"tasks\".* FROM \"tasks\" WHERE (name LIKE \'%Dance \'\'delete table%\')\r\n  Rendered tasks/index.html.erb within layouts/application (1.4ms)\r\nCompleted 200 OK in 32ms (Views: 30.4ms | ActiveRecord: 0.1ms)\r\n```\r\n\r\nWe are using SQLite. So the quote is escaped by using two single quotes.\r\n\r\n## Summary\r\n\r\nIn this article, you learned how to avoid SQL injection in Rails 5 apps. ','2016-03-19 22:33:33','2016-03-19 22:33:33'),(3281,'Mass Assignment in Rails 5','## Steps\r\n### Step 1\r\n\r\nThe new user registration page in `app/views/users/new.html.erb` has full name and password fields. \r\n\r\n```rhtml\r\n<%= form_for(@user) do |f| %>\r\n  <div class=\"field\">\r\n    <%= f.label :full_name %>\r\n    <%= f.text_field :full_name %>\r\n  </div>\r\n  <div class=\"field\">\r\n    <%= f.label :password %>\r\n    <%= f.password_field :password %>\r\n  </div>\r\n  <div class=\"actions\">\r\n    <%= f.submit %>\r\n  </div>\r\n<% end %>\r\n```\r\n\r\n### Step 2\r\n\r\nIf you use `params[:user]` when creating the user record like this:\r\n\r\n```ruby\r\ndef create\r\n  User.create(params[:user])\r\n  \r\n  redirect_to users_path\r\nend\r\n```\r\n\r\nYou will get the error:\r\n\r\n```sh\r\nActiveModel::ForbiddenAttributesError\r\n```\r\n\r\n### Step 3\r\n\r\nAdd `allowed_params` method to users controller.\r\n\r\n```ruby\r\ndef allowed_params\r\n  params.require(:user).permit(:full_name, :password)\r\nend  \r\n```\r\n\r\nThis method only allows the `full_name` and `password` fields in the user model. Use this method in the users controller.\r\n\r\n```ruby\r\ndef create\r\n  User.create(allowed_params)\r\n  \r\n  redirect_to users_path\r\nend\r\n```\r\n\r\nWe will now be able to register a new user. Note: The `attr_protected` was deprecated in Rails 2.3.8. Rails 4.0 has removed `attr_accessible` and `attr_protected` feature in favor of Strong Parameters.\r\n\r\n## Summary\r\n\r\nIn this article, you learned how to use strong parameters that protects the Rails 5 web apps from mass assignment problems.','2016-03-19 22:40:24','2016-03-19 22:40:24'),(3291,'Cross Site Scripting in Rails 5','## Steps\r\n### Step 1\r\n\r\nAdd  `has_many :comments` to Task model.\r\n\r\n```ruby\r\nclass Task < ApplicationRecord\r\n  belongs_to :project\r\n  has_many :comments  \r\nend\r\n```\r\n\r\nThe comment belongs to a task.\r\n\r\n```ruby\r\nclass Comment < ApplicationRecord\r\n  belongs_to :task\r\nend\r\n```\r\n\r\n### Step 2\r\n\r\nGenerate the comment model with content field for text area.\r\n\r\n```sh\r\nrails g model comment content:text \r\n```\r\n\r\n### Step 3\r\n\r\nAdd the foreign key `t.integer :task_id` to the generated migration file.\r\n\r\n```ruby\r\nclass CreateComments < ActiveRecord::Migration[5.0]\r\n  def change\r\n    create_table :comments do |t|\r\n      t.text :content\r\n      t.integer :task_id\r\n      \r\n      t.timestamps\r\n    end\r\n  end\r\nend\r\n```\r\n\r\nMigrate the database.\r\n\r\n```sh\r\nrails db:migrate\r\n```\r\n\r\nNote: You should always define a database index for all foreign keys. I am skipping it here.\r\n\r\n### Step 4\r\n\r\nThe comment model has content column for displaying text area. Add comments section to the task show page.\r\n\r\n```rhtml\r\n<h2>Comments</h2>\r\n<% for comment in @comments %>\r\n<p><%= comment.content %></p>\r\n<% end %>\r\n```\r\n\r\nAdd the form to comment on a task displayed on the show page.\r\n\r\n```rhtml\r\n<%= form_for(Comment.new, url: task_comments_path(@task)) do |f| %>\r\n<p> <%= f.text_area :content, rows: 7 %> </p>\r\n<p> <%= submit_tag \'Add Comment\' %> </p>\r\n<% end %>\r\n```\r\n\r\nThe `app/views/tasks/show.html.erb` looks like this:\r\n\r\n```rhtml\r\n<p>\r\n  <strong>Name:</strong>\r\n  <%= @task.name %>\r\n</p>\r\n<p>\r\n  <strong>Complete:</strong>\r\n  <%= @task.complete %>\r\n</p>\r\n\r\n<h2>Comments</h2>\r\n<% for comment in @comments %>\r\n<p><%= comment.content %></p>\r\n<% end %>\r\n\r\n<%= form_for(Comment.new, url: task_comments_path(@task)) do |f| %>\r\n<p> <%= f.text_area :content, rows: 7 %> </p>\r\n<p> <%= submit_tag \'Add Comment\' %> </p>\r\n<% end %>\r\n\r\n<%= link_to \'Edit\', edit_task_path(@task) %> |\r\n<%= link_to \'Back\', tasks_path %>\r\n```\r\n\r\nTask show page now displays all comments and has a text area for adding a form.\r\n\r\n### Step 5\r\n\r\nGenerate the commments controller with create action.\r\n\r\n```sh\r\nrails g controller comments create\r\n```\r\n\r\nThe comments controller create action looks like this:\r\n\r\n```ruby\r\nclass CommentsController < ApplicationController\r\n  def create\r\n    task = Task.find(params[:task_id])\r\n    task.comments.create(params.require(:comment).permit(:content))\r\n    \r\n    redirect_to task\r\n  end\r\nend\r\n```\r\n\r\nWe create comment for the task model by using the `has_many :comments` association. Rails automatically populates the `task_id` foreign key in the new comment record. This is also secure way of creating a nested model.\r\n\r\n### Step 6\r\n\r\nTasks controller show method looks like this:\r\n\r\n```ruby\r\ndef show\r\n  task = Task.find(params[:id])\r\n  @comments = task.comments\r\nend\r\n```\r\n\r\n### Step 7\r\n\r\n\r\nDefine the nested routes for comments in routes.rb.\r\n\r\n```ruby\r\nresources :tasks do\r\n  resources :comments, only: [:create]\r\nend\r\n```\r\n\r\nYou can now add comments.\r\n\r\n### Step 8\r\n\r\nIn the task show page, add:\r\n\r\n```html\r\nTesting <script> alert(\'test\') </script>\r\n```\r\n\r\nto the comments form. This is now automatically sanitized by Rails 5. There is no need to use the h view helper anymore.\r\n\r\n### Step 9\r\n\r\nWe can escape the user input in the rails console.\r\n\r\n```sh\r\n > CGI::escapeHTML(\"<script> alert(document.cookie) </script>\")\r\n => \"&lt;script&gt; alert(document.cookie) &lt;/script&gt;\" \r\n```\r\n\r\nWe see the escaped output.\r\n\r\n## Summary\r\n\r\nIn this article, you learned how Cross Site Scripting is handled in Rails 5.','2016-03-20 00:10:22','2016-03-20 00:13:36'),(3301,'In Groups Of in Rails 5','## Steps\r\n### Step 1\r\n\r\nList all the tasks in tasks index page.\r\n\r\n```rhtml\r\n<h1>Tasks</h1>\r\n<table>\r\n  <thead>\r\n    <tr> <th></th> </tr>\r\n  </thead>\r\n  <tbody>\r\n    <% @tasks.each do |task| %>\r\n      <tr>\r\n        <td>\r\n          <%= task.name %> in <%= task.project.name %>\r\n        </td>\r\n      </tr>\r\n    <% end %>\r\n  </tbody>\r\n</table>\r\n```\r\n\r\n### Step 2\r\n\r\nWe want to list 4 tasks in each row. Let\'s define rows and columns in view. Add `in_groups_of` method in `tasks/index.html.erb`:\r\n\r\n```rhtml\r\n<% @tasks.in_groups_of(4) do |row| %>\r\n  <tr>\r\n	<% for task in row %>\r\n        <td><%= task.name %></td>\r\n	<% end %>  \r\n  </tr>\r\n<% end %>\r\n```\r\n\r\nWe get the error:\r\n\r\n```sh\r\nundefined method `name\' for nil:NilClass\r\n```\r\n\r\n### Step 3\r\n\r\nWe can fix this problem by not filling the array with nil values if they are not evenly divisible. Pass the false flag as the second argument to the `in_groups_of` method.\r\n\r\n```rhtml\r\n<h1>Tasks</h1>\r\n<table>\r\n  <thead>\r\n    <tr>\r\n      <th></th>\r\n    </tr>\r\n  </thead>\r\n  <tbody>\r\n    <% @tasks.in_groups_of(4, false) do |row| %>\r\n	  <tr>\r\n		<% for task in row %>\r\n	        <td><%= task.name %></td>\r\n		<% end %>  \r\n	  </tr>\r\n    <% end %>\r\n  </tbody>\r\n</table>\r\n```\r\n\r\nReload the page. You will now see the tasks displayed in groups of 4.\r\n\r\n## Summary\r\n\r\nIn this article, you learned how to use `in_groups_of` to display tasks in a four column per row format.\r\n','2016-03-20 00:23:10','2016-12-23 00:23:42'),(3311,'Group By Month in Rails 5','## Steps\r\n### Step 1\r\n\r\nTask has `due_date`. Let\'s add this field to the task.\r\n\r\n```sh\r\nrails g migration add_due_date_to_tasks due_date:date\r\n```\r\n\r\nThe generated migration file looks like this:\r\n\r\n```ruby\r\nclass AddDueDateToTasks < ActiveRecord::Migration[5.0]\r\n  def change\r\n    add_column :tasks, :due_date, :date\r\n  end\r\nend\r\n```\r\n\r\n### Step 2\r\n\r\nCreate sample data in seeds.rb.\r\n\r\n```ruby\r\nwealthy = Project.create(name: \'Wealth Building\')\r\nwealthy.tasks.create(name: \'Get rich quick\', complete: false, priority: 4, due_date: 2.months.ago)\r\nwealthy.tasks.create(name: \'Write a book\', complete: true, priority: 5, due_date: 1.month.ago)\r\n\r\nhappy = Project.create(name: \'Be Happy\')\r\nhappy.tasks.create(name: \'Buy a puppy\', complete: false, priority: 9, due_date: 1.month.ago)\r\nhappy.tasks.create(name: \'Dance in the rain\', complete: true, priority: 7, due_date: 2.months.ago)\r\nhappy.tasks.create(name: \'Dance in the snow\', complete: true, priority: 6, due_date: 2.months.ago)\r\nhappy.tasks.create(name: \'Walk on water\', complete: true, priority: 7, due_date: 2.months.from_now)\r\nhappy.tasks.create(name: \'Just Blog It\', complete: true, priority: 5, due_date: 1.month.from_now)\r\nhappy.tasks.create(name: \'Play tennis\', complete: true, priority: 4, due_date: 2.days.ago)\r\nhappy.tasks.create(name: \'Make fun of Donald Trump\', complete: true, priority: 3, due_date: 2.days.ago)\r\nhappy.tasks.create(name: \'Walk on moon\', complete: true, priority: 2, due_date: 2.days.ago)\r\n```\r\n\r\nLet\'s clear all the old data and recreate the tables and populate the database with new data.\r\n\r\n```\r\nrails db:drop\r\nrails db:migrate\r\nrails db:seed\r\n```\r\n\r\n### Step 3\r\n\r\nInitialize `task_months` in tasks controller:\r\n\r\n```ruby\r\n@task_months = @tasks.group_by {|t| t.due_at.beginning_of_month }\r\n```\r\n\r\nThe index action now looks like this:\r\n\r\n```ruby\r\ndef index\r\n  @tasks = Task.all.to_a\r\n  @task_months = @tasks.group_by {|t| t.due_at.beginning_of_month }\r\nend\r\n```\r\n\r\n### Step 4\r\n\r\nThe `tasks/index.html.erb` looks like this:\r\n\r\n```rhtml\r\n<h1>Tasks</h1>\r\n<table>\r\n  <thead>\r\n    <tr>\r\n      <th></th>\r\n    </tr>\r\n  </thead>\r\n  <tbody>\r\n	  <% @task_months.each do |month, tasks| %>\r\n	    <%= month.strftime(\'%B\') %>\r\n	  <tr>\r\n	    <% for task in tasks %>\r\n	  	<div class=\'task\'>\r\n	  		<strong> task.name </strong>\r\n	  		due on <%= task.due_date.to_date.to_s(:long) %>\r\n	  	</div>\r\n	    <% end %>\r\n	   </tr>	\r\n	  <% end %>	  \r\n  </tbody>\r\n</table>\r\n```\r\n\r\nThe `to_s(:long)` is Rails method used to format the date.\r\n\r\n### Step 5\r\n\r\nReload the tasks index page to view the tasks. The hash does not preserve the order, so the months are jumbled up.\r\n\r\n```sh\r\nTasks\r\n\r\nJanuary\r\ntask.name due on January 17, 2016\r\ntask.name due on January 17, 2016\r\ntask.name due on January 17, 2016\r\nFebruary\r\ntask.name due on February 17, 2016\r\ntask.name due on February 17, 2016\r\nMay\r\ntask.name due on May 17, 2016\r\nApril\r\ntask.name due on April 17, 2016\r\nMarch\r\ntask.name due on March 15, 2016\r\ntask.name due on March 15, 2016\r\ntask.name due on March 15, 2016\r\n```\r\n\r\n### Step 6\r\n\r\nWe can fix the sorting problem by using the Rails 5 `order` method to sort the tasks:\r\n\r\n```ruby\r\ndef index\r\n  @tasks = Task.order(:due_date)\r\n  @task_months = @tasks.group_by {|t| t.due_date.beginning_of_month }\r\nend\r\n```\r\n\r\nChange the `tasks/index.html.erb` to look like this:\r\n\r\n```rhtml\r\n<tbody>\r\n  <% @task_months.each do |month, tasks| %>\r\n    <%= month.strftime(\'%B\') %>\r\n  <tr>\r\n    <% for task in tasks %>\r\n  	<div class=\'task\'>\r\n  		<strong> task.name </strong>\r\n  		due on <%= task.due_date.to_date.to_s(:long) %>\r\n  	</div>\r\n    <% end %>\r\n   </tr>		 \r\n  <% end %>	  \r\n</tbody>\r\n```\r\n\r\n### Step 7\r\n\r\nAfter sorting, tasks are displayed like this:\r\n\r\n```sh\r\nTasks\r\n\r\nJanuary\r\ntask.name due on January 17, 2016\r\ntask.name due on January 17, 2016\r\ntask.name due on January 17, 2016\r\nFebruary\r\ntask.name due on February 17, 2016\r\ntask.name due on February 17, 2016\r\nMarch\r\ntask.name due on March 15, 2016\r\ntask.name due on March 15, 2016\r\ntask.name due on March 15, 2016\r\nApril\r\ntask.name due on April 17, 2016\r\nMay\r\ntask.name due on May 17, 2016\r\n```\r\n\r\n## Summary\r\n\r\nIn this article, you learned how to sort tasks by month by using group_by and order in Rails 5.\r\n','2016-03-20 00:37:19','2016-03-20 00:39:06'),(3321,'Pretty Page Title in Rails 5','Problem : The title does not change when you view different pages on the site.\r\n\r\n## Steps\r\n\r\n### Step 1\r\n\r\nAdd the following code to application layout file.\r\n\r\n```rhtml\r\n<title> MyComm Site - <%= content_for?(:title) ? yield(:title) : \'The Biggest Online Store on Earth\' %> </title>\r\n```\r\n\r\n### Step 2\r\n\r\nIn `products/new.html.erb` use the title view helper to display the title:\r\n\r\n```rhtml\r\n<% title \"New Product\" %>\r\n```\r\n\r\n### Step 3\r\n\r\nThe title view helper is defined in the `application_helper.rb`:\r\n\r\n```ruby\r\nmodule ApplicationHelper\r\n  def title(page_title)\r\n    content_for(:title) { page_title }\r\n  end\r\nend\r\n```\r\n\r\nThe view that does not call the title helper will now have the default title `MyComm Site : The Biggest Online Store on Earth`.\r\n\r\n## Summary\r\n\r\nIn this article, you learned how to use custom view helper to customize the title an any page of your Rails 5 web app.','2016-03-20 00:51:23','2016-03-20 00:51:23'),(3331,'Customizing Time Format in Rails 5 Apps','## Steps\r\n### Step 1\r\n\r\nIn `products/index.html.erb`:\r\n\r\n```ruby\r\n<%= task.due_date %>\r\n```\r\n\r\nGives the following ugly output.\r\n\r\n```sh\r\ntask.name due on 2016-01-17\r\n```\r\n\r\nThe `due_date.to_s(:long)` output is shown below.\r\n\r\n```sh\r\ntask.name due on January 17, 2016\r\n```\r\n\r\nThe output for `:short` format is shown below.\r\n\r\n```sh\r\ntask.name due on 17 Jan\r\n```\r\n\r\nThe output for `:db` format is shown below.\r\n\r\n```sh\r\ntask.name due on 2016-01-17\r\n```\r\n\r\n### Step 2\r\n\r\nWe can customize the time format like this:\r\n\r\n```ruby\r\ndue_date.strftime(\"due on %B %d at %I:%M %p\")\r\n```\r\n\r\nThis will lead to duplication if we need to call from different views. Let\'s see how we can define our own time format that will allow us to do our application specific format `due_date.to_s(:due_time)`\r\n\r\n### Step 3\r\n\r\nCreate `config/initializers/custom_time_formats.rb` file with time format customization:\r\n\r\n```ruby\r\nTime::DATE_FORMATS[:due_time] = \"due on %B %d at %I:%M %p\"\r\n```\r\n\r\n### Step 4\r\n\r\nRestart server and reload tasks index page. In order to display the date as well as the time, we need to use datetime column not date. Modify the migration for adding the `due_date`.\r\n\r\n```ruby\r\nclass AddDueDateToTasks < ActiveRecord::Migration[5.0]\r\n  def change\r\n    add_column :tasks, :due_date, :datetime\r\n  end\r\nend\r\n```\r\n\r\nLet\'s populate the database with new data that has values for `due_date` column in tasks table.\r\n\r\n```sh\r\nrails db:drop\r\nrails db:migrate\r\nrails db:seed\r\n```\r\n\r\nThe seeds.rb is same as before, since we are using ActiveSupport methods, it does not require any changes. The `tasks/index.html.erb` looks like this:\r\n\r\n```rhtml\r\n<tbody>\r\n  <% @task_months.each do |month, tasks| %>\r\n    <%= month.strftime(\'%B\') %>\r\n  <tr>\r\n    <% for task in tasks %>\r\n  	<div class=\'task\'>\r\n  		<strong>  <%= task.name %> </strong>\r\n  		<%= task.due_date.to_s(:due_time) %>\r\n  	</div>\r\n    <% end %>\r\n   </tr>		 \r\n  <% end %>	  \r\n</tbody>\r\n```\r\n\r\nReload the tasks index page:\r\n\r\n```\r\nGet rich quick due on January 17 at 11:23 PM\r\nBuy a puppy  due on January 17 at 11:23 PM\r\nDance in the rain due on January 17 at 11:23 PM\r\n```\r\n\r\n## Summary\r\n\r\nIn this article, you learned how to customize time format in Rails 5 web apps.\r\n\r\n## References\r\n\r\n[For a Good Strf Time](http://www.foragoodstrftime.com/ \'For a Good Strf Time\')','2016-03-20 01:00:59','2016-03-20 01:02:20'),(3341,'Time in Text Field in Rails 5','## Steps\r\n### Step 1\r\n\r\nThe tasks index page displays a list of tasks with due date and Edit task link in `tasks/index.html.erb`.\r\n\r\n```rhtml\r\n<tbody>\r\n  <% @task_months.each do |month, tasks| %>\r\n    <%= month.strftime(\'%B\') %>\r\n  <tr>\r\n    <% for task in tasks %>\r\n  	<div class=\'task\'>\r\n  		<strong> task.name </strong>\r\n  		<%= task.due_date.to_s(:due_time) %>\r\n  	</div>\r\n  	<%= link_to \'Edit\', edit_task_path(task) %>\r\n    <% end %>\r\n   </tr>		 \r\n  <% end %>	  \r\n</tbody>\r\n```\r\n\r\n### Step 2 \r\n\r\nClick Edit link to edit task. The due date field has datetime drop down boxes in `tasks/_form.html.erb`:\r\n\r\n```rhtml\r\n<%= form_for(task) do |f| %>\r\n  <div class=\"field\">\r\n    <%= f.label :name %>\r\n    <%= f.text_field :name %>\r\n  </div>\r\n  <div class=\"field\">\r\n    <%= f.label :due_date %>\r\n    <%= f.datetime_select :due_date %>\r\n  </div>\r\n  <div class=\"actions\">\r\n    <%= f.submit %>\r\n  </div>\r\n<% end %>\r\n```\r\n\r\n### Step 3\r\n\r\nIn the form partial, change the `datetime_select` to text field.\r\n\r\n```rhtml\r\n<%= f.text_field :due_date_string %>\r\n```\r\n\r\n### Step 4\r\n\r\nAdd `due_date_string` setter and getter methods to the Task model.\r\n\r\n```ruby\r\nclass Task < ApplicationRecord\r\n  belongs_to :project\r\n  has_many :comments\r\n\r\n  def due_date_string\r\n    due_date.to_s(:db)\r\n  end\r\n  \r\n  def due_date_string=(due_date_s)\r\n    self.due_date = Time.parse(due_date_s)\r\n  end\r\nend\r\n```\r\n\r\n### Step 5\r\n \r\nIn tasks controller change the `task_params` method:\r\n \r\n```ruby\r\ndef task_params\r\n  params.require(:task).permit(:name, :complete, :due_date_string)\r\nend\r\n```\r\n \r\n### Step 6\r\n \r\nReload task edit page `http://localhost:3000/tasks/3/edit`. Change the date and update the task. It will work.\r\n \r\n### Step 7\r\n \r\nIllegal input throws the following exception: \r\n \r\n```sh\r\nargument out of range\r\n```\r\n\r\nLet\'s now fix the invalid input problem.\r\n\r\n### Step  8\r\n\r\nChange the view to use `due_date` defined in the task model.\r\n\r\n```rhtml\r\n<%= form_for(task) do |f| %>\r\n  <div class=\"field\">\r\n   <%= f.label :name %>\r\n   <%= f.text_field :name %>\r\n  </div>\r\n  <div class=\"field\">\r\n   <%= f.label :due_date %>\r\n   <%= f.text_field :due_date %>\r\n  </div>\r\n  <div class=\"actions\">\r\n   <%= f.submit %>\r\n  </div>\r\n<% end %>\r\n```\r\n \r\n### Step 9\r\n \r\nChange the `task_params` method as follows:\r\n\r\n```ruby\r\ndef task_params\r\n  params.require(:task).permit(:name, :complete, :due_date)\r\nend\r\n```\r\n\r\n### Step 10\r\n \r\nRemove setter and getter in the task model:\r\n \r\n```ruby \r\ndef due_date_string\r\n  due_date.to_s(:db)\r\nend\r\n \r\ndef due_date_string=(due_date_s)\r\n  self.due_date = Time.parse(due_date_s)\r\nend\r\n```\r\n\r\nI love solutions with less code. \r\n\r\n### Step 11\r\n \r\nCreate a custom validator called `datetime_validator.rb` in the models directory.\r\n \r\n```ruby\r\nclass DatetimeValidator < ActiveModel::Validator\r\n  def validate(record)\r\n    Time.parse(record.due_date.to_s)\r\n  rescue ArgumentError\r\n    record.errors[:due_date] << \"Invalid datetime format\"\r\n  end\r\nend\r\n```\r\n\r\n### Step 12\r\n\r\nUse our newly defined custom validator in the task model.\r\n\r\n```ruby \r\nclass Task < ApplicationRecord\r\n  belongs_to :project\r\n  has_many :comments\r\n\r\n  validates_with DatetimeValidator  \r\nend\r\n```\r\n\r\nEdit date with junk as the due_date. You will now see validation error. The user entered old value is also retained.\r\n\r\n## Summary\r\n\r\nIn this article, you learned how to use custom validators using ActiveModel validator and validate dates in text field.','2016-03-20 01:22:27','2016-03-20 01:22:27'),(3351,'Date Validation Gems in Rails 5 ','## Steps\r\n### Step 1\r\n\r\nAdd the `validates_timeliness` gem to Gemfile.\r\n\r\n```ruby\r\ngem \'validates_timeliness\', \'~> 4.0\'\r\n```\r\n\r\nRun bundle install.\r\n\r\n### Step 2\r\n\r\nGenerate the `validates_timeliness` initializer files.\r\n\r\n```sh\r\nrails generate validates_timeliness:install\r\n```\r\n\r\nIt creates the following files.\r\n\r\n```sh\r\nconfig/initializers/validates_timeliness.rb\r\nconfig/locales/validates_timeliness.en.yml\r\n```	  \r\n\r\n### Step 3\r\n\r\nAdd the validation provided by the `validates_timeliness` gem to the task model.\r\n\r\n```ruby\r\nvalidates_datetime :due_date\r\n```\r\n\r\nThe task model looks like this:\r\n\r\n```ruby\r\nclass Task < ApplicationRecord\r\n  belongs_to :project, counter_cache: true\r\n  has_many :comments\r\n\r\n  validates_datetime :due_date  \r\nend\r\n```\r\n\r\n### Step 4\r\n\r\nChange the update action in the tasks controller:\r\n\r\n```ruby\r\ndef update\r\n  respond_to do |format|\r\n    if @task.update(task_params)\r\n      format.html { redirect_to @task, notice: \'Task was successfully updated.\' }\r\n      format.json { render :show, status: :ok, location: @task }\r\n    else\r\n      format.html { render :edit }\r\n      format.json { render json: @task.errors, status: :unprocessable_entity }\r\n    end\r\n  end\r\nend\r\n```\r\n\r\nThis works for any value except junk string value for the date. Let\'s fix this problem.\r\n\r\n### Step 5\r\n\r\nAdd the `date_validator` gem to the Gemfile.\r\n\r\n```ruby\r\ngem \'date_validator\'\r\n```\r\n\r\nRun bundle install.\r\n\r\n### Step 6\r\n\r\nRemove the old validation for `due_date` and add the following validation that uses the new gem.\r\n\r\n```ruby\r\nvalidates :due_date, date: true\r\n```\r\n\r\n### Step 7\r\n\r\nEdit task. Junk text is now validated.\r\n\r\n## Summary\r\n\r\nIn this article, you learned how to use date_validator gem to validate the date field in Rails 5 apps.\r\n\r\n## Reference\r\n\r\n[date_validator gem] (https://github.com/codegram/date_validator \'date_validator gem\')','2016-03-20 01:35:22','2016-03-20 01:35:22'),(3361,'Named Routes in Rails 5','## Steps\r\n### Step 1\r\n\r\nDefine the route for home page in routes.rb.\r\n\r\n```ruby\r\nroot \'projects#index\'\r\n```\r\n\r\n### Step 2\r\n\r\nThe tasks index page displays all the projects on the home page.\r\n\r\n```rhtml\r\n<h1>Projects</h1>\r\n<table>\r\n  <thead>\r\n    <tr>\r\n      <th>Name</th>\r\n	  <th>Count</th>\r\n      <th colspan=\"3\"></th>\r\n    </tr>\r\n  </thead>\r\n  <tbody>\r\n    <% @projects.each do |project| %>\r\n      <tr>\r\n        <td><%= project.name %></td>\r\n		<td><%= pluralize(project.tasks.length, \'task\') %></td>\r\n      </tr>\r\n    <% end %>\r\n  </tbody>\r\n</table>\r\n<%= link_to \'New Project\', new_project_path %>\r\n```\r\n\r\n### Step 3\r\n\r\nThe projects controller, index action looks like this:\r\n\r\n```ruby\r\ndef index\r\n  @projects = Project.all\r\nend\r\n```\r\n\r\n### Step 4\r\n\r\nBrowse to `http://localhost:3000` to view all projects.\r\n\r\n### Step 5\r\n\r\nAdd:\r\n\r\n```rhtml\r\n<%= projects_url %> <br>\r\n<%= projects_path %> <br>\r\n```\r\n\r\nto the project index page. This will generate:\r\n\r\n```\r\nhttp://localhost:3000/projects \r\n/projects\r\n```\r\n\r\nThe URL with the domain is the absolute URL and the other is the relative URL.\r\n\r\n### Step 6\r\n\r\nDefine a named route for listing tasks in the archive page in routes.rb.\r\n\r\n```ruby\r\nget \'/tasks/:year/:month\' => \"tasks#archive\", as: :task_archive\r\n```\r\n\r\n### Step 7\r\n\r\nView the new route.\r\n\r\n```\r\n$rake routes\r\ntask_archive GET    /tasks/:year/:month(.:format)      tasks#archive\r\n```\r\n\r\n### Step 8\r\n\r\nUse the named route in the projects index page. Add the following:\r\n\r\n```rhtml\r\n<%= task_archive_path(2007, 5) %>\r\n<%= task_archive_path(year: 2007, month: 5) %>\r\n```\r\n\r\nto the projects index page. To view the generated URL, reload the projects index page. You will see:\r\n\r\n```\r\n/tasks/2007/5\r\n/tasks/2007/5\r\n```\r\n\r\nin the browser.\r\n\r\n### Step 9\r\n\r\nDefine project resource in routes.rb:\r\n\r\n```ruby\r\nresources :projects\r\n```\r\n\r\n### Step 10\r\n\r\nAdd the links to the `projects/index.html.erb`:\r\n\r\n```rhtml\r\n<% @projects.each do |project| %>\r\n  <tr>\r\n    <td> <%= link_to project.name, project %> </td>\r\n	<td> <%= link_to \'Edit\', edit_project_path(project) %> </td>\r\n	<td> <%= link_to \'Destroy\', project, method: :delete %> </td>\r\n	<td><%= pluralize(project.tasks.length, \'task\') %></td>\r\n  </tr>\r\n<% end %>\r\n```\r\n\r\nNow you can edit and delete projects.\r\n\r\n## Summary\r\n\r\nIn this article, you learned how to use named routes in Rails 5.\r\n\r\n## Reference\r\n\r\n[Named Routes](http://api.rubyonrails.org/classes/ActionDispatch/Routing.html \'Named Routes\')','2016-03-20 01:47:05','2016-03-20 01:47:05'),(3371,'Custom REST Actions in Rails 5','## Steps\r\n### Step 1\r\n\r\nThere are 7 standard actions provided by resources declaration in the routes.rb.\r\n\r\n```ruby\r\nresources :tasks\r\n```\r\n\r\n### Step 2\r\n\r\nThe index page displays all the tasks. For completed tasks, define a completed method:\r\n\r\n```ruby\r\ndef completed\r\n  @tasks = Task.where(complete: false)  \r\nend\r\n```\r\n\r\nThis finds all the completed tasks.\r\n\r\n### Step 3\r\n\r\nGo to complete view in the browser `http://localhost:3000/completed`. It will not work. Delete this:\r\n\r\n```ruby\r\nbefore_action :set_task, only: [:show, :edit, :update, :destroy]\r\n```\r\n\r\nTry again. The error is:\r\n\r\n```sh\r\nActiveRecord::RecordNotFound in TasksController#show\r\nCouldn\'t find Task with \'id\'=completed\r\n```\r\n\r\n### Step 4\r\n\r\nChange the routes.rb to allow complete action for task resource.\r\n\r\n```ruby\r\nget \'completed\', to: \'tasks#completed\', as: :completed_tasks\r\n```\r\n\r\n### Step 5\r\n\r\n```sh\r\n$ rake routes | grep tasks\r\n```\r\n\r\nThe installed routes are:\r\n\r\n```sh\r\n          tasks GET    /tasks(.:format)             tasks#index\r\n                POST   /tasks(.:format)             tasks#create\r\n       new_task GET    /tasks/new(.:format)         tasks#new\r\n      edit_task GET    /tasks/:id/edit(.:format)    tasks#edit\r\n           task GET    /tasks/:id(.:format)         tasks#show\r\n                PATCH  /tasks/:id(.:format)         tasks#update\r\n                PUT    /tasks/:id(.:format)         tasks#update\r\n                DELETE /tasks/:id(.:format)         tasks#destroy\r\ncompleted_tasks GET    /completed(.:format)         tasks#completed\r\n```\r\n\r\n### Step 6\r\n\r\nGo to completed view in the browser by browsing to `http://localhost:3000/completed`. In the log file, you can see that nothing was rendered.\r\n\r\n```sh\r\nStarted GET \"/completed\" for ::1 at 2016-03-23 17:47:54 -0700\r\nProcessing by TasksController#completed as HTML\r\nNo template found for TasksController#completed, rendering head :no_content\r\n  Task Load (0.1ms)  SELECT \"tasks\".* FROM \"tasks\" WHERE \"tasks\".\"complete\" = ?  [[\"complete\", true]]\r\nCompleted 204 No Content in 20ms (ActiveRecord: 0.1ms)\r\n```\r\n\r\n### Step 7\r\n\r\nDefine `completed.html.erb`:\r\n\r\n```rhtml\r\n<h1>Completed Tasks</h1>\r\n\r\n<table>\r\n  <thead>\r\n    <tr>\r\n      <th></th>\r\n    </tr>\r\n  </thead>\r\n\r\n  <tbody>\r\n	<tr>\r\n	  <% for task in @tasks %>\r\n		<div class=\'task\'>\r\n			<strong> <%= task.name %> </strong>\r\n		</div>\r\n		<%= link_to \'Edit\', edit_task_path(task) %>\r\n	  <% end %>\r\n	 </tr>		 \r\n  </tbody>\r\n</table>\r\n```\r\n\r\n### Step 8\r\n\r\nAdd a link to completed tasks in the index page.\r\n\r\n```rhtml\r\n<%= link_to \"Completed Tasks\", completed_tasks_path %>\r\n```\r\n\r\n### Step 9\r\n\r\nImplement the complete action:\r\n\r\n```ruby\r\ndef complete\r\n  @task = Task.find(params[:id])  \r\n  @task.update_attribute(:complete, true)\r\n  flash[:notice] = \'marked task as complete\'\r\n  \r\n  redirect_to completed_tasks_path\r\nend\r\n```\r\n\r\n### Step 10\r\n\r\nDefine the routes for marking a task as complete.\r\n\r\n```ruby\r\nput \'complete/:id\', to: \'tasks#complete\', as: :complete_task\r\n```\r\n\r\n### Step 11\r\n\r\nAdd the link to mark a task as complete in index page:\r\n\r\n```rhtml\r\n<%= link_to \'Mark as Complete\', complete_task_path(task), method: :put %>\r\n```\r\n\r\n### Step 12\r\n\r\nBrowse to `http://localhost:3000/tasks`. Click on \'Mark as Complete\' to mark a task as complete. It shows up in completed tasks page\r\n\r\n## Summary\r\n\r\nIn this article, you learned how to use custom REST actions in Rails 5.','2016-03-26 04:05:03','2016-03-26 04:09:30'),(3381,'Simple Search Form in Rails 5','## Steps\r\n### Step 1\r\n\r\nThe `tasks/index.html.erb` displays all the tasks.\r\n\r\n```rhtml\r\n<h1>Tasks</h1>\r\n<table>\r\n  <thead>\r\n    <tr>\r\n      <th></th>\r\n    </tr>\r\n  </thead>\r\n\r\n  <tbody>\r\n	<tr>\r\n	  <% for task in @tasks %>\r\n		<div class=\'task\'>\r\n			<strong> <%= task.name %> </strong>\r\n		</div>\r\n		<%= link_to \'Edit\', edit_task_path(task) %>\r\n	  <% end %>\r\n	 </tr>		 \r\n  </tbody>\r\n</table>\r\n```\r\n\r\nBrowse to `http://localhost:3000/tasks` to view all the tasks.\r\n\r\n### Step 2\r\n\r\nAdd the search form to on the tasks index page.\r\n\r\n```rhtml\r\n<%= form_tag(tasks_path) do %>\r\n  <%= text_field_tag :term %>\r\n  <%= submit_tag \'Search\' %>\r\n<% end %>\r\n```\r\n\r\nSearch for something and click Search. You will get the error:\r\n\r\n```sh\r\nActionController::ParameterMissing in TasksController#create\r\n```\r\n\r\n### Step 3\r\n\r\nChange the `task_params` method in tasks controller to permit the term field in the search form:\r\n\r\n```ruby\r\ndef task_params\r\n  params.require(:task).permit(:name, :complete, :due_date, :term)\r\nend\r\n```\r\n\r\n### Step 4\r\n\r\nSearch again. The form tag generates the form html tag that uses POST by default. So search will not work. View source to see the generated html. \r\n\r\n```rhtml\r\n<form action=\"/tasks\" accept-charset=\"UTF-8\" method=\"post\">\r\n  <input name=\"utf8\" type=\"hidden\" value=\"&#x2713;\" />\r\n  <input type=\"hidden\" name=\"authenticity_token\" value=\"pRsj8YjL\" />\r\n  <input type=\"text\" name=\"term\" id=\"term\" />\r\n  <input type=\"submit\" name=\"commit\" value=\"Search\" data-disable-with=\"Search\" />\r\n</form>\r\n```\r\n\r\n### Step 5\r\n\r\nChange the HTTP verb in the `form_tag` to GET:\r\n\r\n```ruby\r\nmethod: :get\r\n```\r\n\r\nThe search form now looks like this:\r\n\r\n```rhtml\r\n<%= form_tag(tasks_path, method: :get) do %>\r\n  <%= text_field_tag :term %>\r\n  <%= submit_tag \'Search\' %>\r\n<% end %>\r\n```\r\n\r\n### Step 6\r\n\r\nReload the tasks index page in the browser. View page source.\r\n\r\n```rhtml\r\n<form action=\"/tasks\" accept-charset=\"UTF-8\" method=\"get\"><input name=\"utf8\" type=\"hidden\" value=\"&#x2713;\" />\r\n  <input type=\"text\" name=\"term\" id=\"term\" />\r\n  <input type=\"submit\" name=\"commit\" value=\"Search\" data-disable-with=\"Search\" />\r\n</form>\r\n```\r\n\r\nYou now see the http method is GET.\r\n\r\n### Step 7\r\n\r\nThe tasks controller index action does the search for the tasks.\r\n\r\n```ruby\r\ndef index\r\n  @tasks = if params[:term]\r\n    Task.where(\'name LIKE ?\', \"%#{params[:term]}%\")\r\n  else\r\n    Task.all\r\n  end\r\nend\r\n```\r\n\r\nSearch for something.\r\n\r\n### Step 8\r\n\r\nIt works. But the search term is not retained in the search form. To retain the search term in the search text field, change the search form `text_field_tag` to include the value for the term field:\r\n\r\n```rhtml\r\n<%= form_tag(tasks_path, method: :get) do %>\r\n  <%= text_field_tag :term, params[:term] %>\r\n  <%= submit_tag \'Search\' %>\r\n<% end %>\r\n```\r\n\r\n### Step 9\r\n\r\nWhen we search, we see:\r\n\r\n```\r\ncommit=Search\r\n```\r\n\r\nin the URL.\r\n\r\n\r\nTo eliminate it, set the name of the `submit_tag` to nil in the search form.\r\n\r\n```rhtml\r\n<%= form_tag(tasks_path, method: :get) do %>\r\n  <%= text_field_tag :term, params[:term] %>\r\n  <%= submit_tag \'Search\', name: nil %>\r\n<% end %>\r\n```\r\n\r\nI know it\'s clunky. But it works.\r\n\r\n### Step 10\r\n\r\nLet\'s refactor the tasks controller index action:\r\n\r\n```ruby\r\ndef index\r\n  @tasks = Task.search(params[:term])\r\nend\r\n```\r\n\r\nMove the database query logic to the task model:\r\n\r\n```ruby\r\ndef self.search(term)\r\n  if term\r\n    where(\'name LIKE ?\', \"%#{term}%\")\r\n  else\r\n    all\r\n  end\r\nend\r\n```\r\n\r\n### Step 11\r\n\r\nIf you would like to order by most recent tasks, change the search method in task model.\r\n\r\n```ruby\r\ndef self.search(term)\r\n  if term\r\n    where(\'name LIKE ?\', \"%#{term}%\").order(\'id DESC\')\r\n  else\r\n    order(\'id DESC\') \r\n  end\r\nend\r\n```\r\n\r\nWe use id descending in the order method to improve performance. The primary key is indexed and the search will be faster. Especially if you have lot of data.\r\n\r\n## Summary\r\n\r\nIn this article, you learned how to use a simple search form to search the database for records that has the given string in one of the columns of a table.','2016-03-26 17:58:39','2016-03-26 17:58:39'),(3391,'Multi Button Form in Rails 5','## Steps\r\n### Step 1\r\n\r\nAdd description field to projects table.\r\n\r\n```sh\r\n$ rails g migration add_description_to_projects description:text\r\n```\r\n\r\nMigrate the database.\r\n\r\n```sh\r\nrails db:migrate\r\n```\r\n\r\n### Step 2\r\n\r\nAdd the text area for the project description in the form partial.\r\n\r\n```rhtml\r\n<div class=\"field\">\r\n  <%= f.label :description %>\r\n  <%= f.text_area :description %>\r\n</div>\r\n```\r\n\r\n### Step 3\r\n\r\nThe new project page has preview button.\r\n\r\n```rhtml\r\n<div class=\"actions\">\r\n  <%= f.submit button_name %>\r\n  <%= f.submit \'Preview\', name:  \'preview_button\'  %>\r\n</div>\r\n```\r\n\r\nWe pass the value for `button_name` in the `new.html.erb`:\r\n\r\n```rhtml\r\n<%= render \'form\', project: @project, button_name: \'Create\'  %>\r\n```\r\n\r\n### Step 4\r\n\r\nYou can see the commit key has \'Preview\' when you click on Preview button.\r\n\r\n```sh\r\nStarted POST \"/projects\" for ::1 at 2016-03-25 19:55:12 -0700\r\nProcessing by ProjectsController#create as HTML\r\n  Parameters: {\"utf8\"=>\"✓\", \"authenticity_token\"=>\"AwUw\", \"project\"=>{\"name\"=>\"\", \"description\"=>\"\"}, \"commit\"=>\"Preview\"}\r\nUnpermitted parameter: description\r\n   (0.1ms)  begin transaction\r\n  SQL (0.4ms)  INSERT INTO \"projects\" (\"name\", \"created_at\", \"updated_at\") VALUES (?, ?, ?)  [[\"name\", \"\"], [\"created_at\", 2016-03-25 19:55:12 UTC], [\"updated_at\", 2016-03-25 19:55:12 UTC]]\r\n   (0.6ms)  commit transaction\r\nRedirected to http://localhost:3000/projects/5\r\nCompleted 302 Found in 27ms (ActiveRecord: 1.1ms)\r\n```\r\n\r\nLet\'s change the name of the Preview button to `preview_button`. This will allow us to distinguish the Preview button from Create button in our controller.\r\n\r\n### Step 5\r\n\r\nWe can add the preview to the create a new project page.\r\n\r\n```rhtml\r\n<%= form_for(project) do |f| %>\r\n\r\n	<% if params[:preview_button] %>\r\n	  <%= project.description %>\r\n	<% end %>\r\n\r\n  <div class=\"field\">\r\n    <%= f.label :name %>\r\n    <%= f.text_field :name %>\r\n  </div>\r\n  <div class=\"field\">\r\n    <%= f.label :description %>\r\n    <%= f.text_area :description %>\r\n  </div>\r\n  <div class=\"actions\">\r\n    <%= f.submit button_name %>\r\n	<%= f.submit \'Preview\', name:  \'preview_button\'  %>\r\n  </div>\r\n<% end %>\r\n```\r\n\r\n### Step 6\r\n\r\nWe can handle the preview feature in the projects controller create action.\r\n\r\n```ruby\r\ndef create\r\n  @project = Project.new(params[:project])\r\n  if params[:preview_button] || !@project.save\r\n    render :action => \'new\'\r\n  else\r\n    flash[:notice] = \"Successfully created project.\"\r\n    redirect_to project_path(@project)\r\n  end\r\nend\r\n```\r\n\r\n### Step 7\r\n\r\nWe must now allow the project description field.\r\n\r\n```ruby\r\ndef project_params\r\n  params.require(:project).permit(:name, :description)\r\nend\r\n```\r\n\r\n### Step 8\r\n\r\nFill out the new project form and click Preview to see the preview. **Note**: The last version of rails that had textilize was 2.3.8. It is not available in Rails 5 anymore. \r\n\r\n## Summary\r\n\r\nIn this article, you learned how to use multiple buttons in a Rails 5 app.','2016-03-26 18:22:12','2016-03-26 18:22:12'),(3401,'Customize Field Error in Rails 5','## Steps\r\n### Step 1\r\n\r\nAdd project name validation to project model.\r\n\r\n```ruby\r\nvalidates :name, presence: true\r\n```\r\n\r\n### Step 2\r\n\r\nSubmit an empty project form. You will see the error with the name field highlighted in red. You can see the rails generated the div tags with `field_with_errors` class to highlight the text field.\r\n\r\n```html\r\n<div id=\"error_explanation\">\r\n  <h2>1 error prohibited this project from being saved:</h2>\r\n  <ul>\r\n  <li>Name can&#39;t be blank</li>\r\n  </ul>\r\n</div>\r\n\r\n<div class=\"field\">\r\n  <div class=\"field_with_errors\"><label for=\"project_name\">Name</label></div>\r\n  <div class=\"field_with_errors\"><input type=\"text\" value=\"\" name=\"project[name]\" id=\"project_name\" /></div>\r\n</div>\r\n```\r\n\r\n### Step 3\r\n\r\nCreate `config/initializers/customize_error.rb` file.\r\n\r\n```ruby\r\nActionView::Base.field_error_proc = Proc.new do |html_tag, instance_tag|\r\n  html_tag\r\nend\r\n```\r\n\r\n### Step 4\r\n\r\nRestart the server. Submit an empty form. Now the name text field is not highlighted in red. Here is the generated html.\r\n\r\n```html\r\n<div id=\"error_explanation\">\r\n  <h2>1 error prohibited this project from being saved:</h2>\r\n\r\n   <ul>\r\n     <li>Name can&#39;t be blank</li>\r\n   </ul>\r\n</div>\r\n\r\n<div class=\"field\">\r\n  <label for=\"project_name\">Name</label>\r\n  <input type=\"text\" value=\"\" name=\"project[name]\" id=\"project_name\" />\r\n</div>\r\n```\r\n  \r\n### Step 5\r\n\r\nYou can customize the `customize_error.rb` as much as you want. You can use the following stolen helper from SO if you have Twitter Bootstrap integrated in your Rails app.\r\n\r\n```ruby\r\nActionView::Base.field_error_proc = Proc.new do |html_tag, instance|\r\n  html = %(<div class=\"field_with_errors\">#{html_tag}</div>).html_safe\r\n\r\n  form_fields = [\r\n    \'textarea\',\r\n    \'input\',\r\n    \'select\'\r\n  ]\r\n\r\n  elements = Nokogiri::HTML::DocumentFragment.parse(html_tag).css \"label, \" + form_fields.join(\', \')\r\n\r\n  elements.each do |e|\r\n    if e.node_name.eql? \'label\'\r\n      html = %(<div class=\"control-group error\">#{e}</div>).html_safe\r\n    elsif form_fields.include? e.node_name\r\n      if instance.error_message.kind_of?(Array)\r\n        html = %(<div class=\"control-group error\">#{html_tag}<span class=\"help-inline\">&nbsp;#{instance.error_message.uniq.join(\', \')}</span></div>).html_safe\r\n      else\r\n        html = %(<div class=\"control-group error\">#{html_tag}<span class=\"help-inline\">&nbsp;#{instance.error_message}</span></div>).html_safe\r\n      end\r\n    end\r\n  end\r\n  html\r\nend\r\n```\r\n\r\n## Summary\r\n\r\nIn this article, you learned how to customize error display of html fields in Rails 5.','2016-03-26 18:25:53','2016-03-26 18:25:53'),(3411,'Tag View Helpers in Rails 5','Let\'s play in the IRB console to learn about content_tag and tag view helpers in Rails 5.\r\n\r\n### Single Tag\r\n\r\n```ruby\r\n > helper.content_tag(:p, \'Hello World!\')\r\n => \"<p>Hello World!</p>\" \r\n```\r\n\r\n### Nested Tag with One Class\r\n\r\n```ruby\r\n > helper.content_tag(:div, helper.content_tag(:p, \'Hello world!\'), class: \'strong\')\r\n => \"<div class=\\\"strong\\\"><p>Hello world!</p></div>\" \r\n```\r\n\r\n### Nested Tags with Multiple Classes\r\n\r\n```ruby\r\n > helper.content_tag(:div, \'Hello world!\', class: [\'strong\', \'highlight\'])\r\n => \"<div class=\\\"strong highlight\\\">Hello world!</div>\" \r\n```\r\n\r\n### Multiple Selection\r\n\r\n```ruby\r\n > helper.content_tag(\'select\', \'options\', multiple: true)\r\n => \"<select multiple=\\\"multiple\\\">options</select>\" \r\n```\r\n\r\n### Difference Between Blank and nil Class\r\n\r\n```ruby\r\n > helper.content_tag(:div, \'Hello world!\', class: \'\')\r\n => \"<div class=\\\"\\\">Hello world!</div>\" \r\n\r\n > helper.content_tag(:div, \'Hello world!\', class: nil)\r\n => \"<div>Hello world!</div>\" \r\n```\r\n\r\n### Empty Html Elements Using Tag Helper\r\n\r\n```ruby\r\n > helper.tag(\'br\')\r\n => \"<br />\" \r\n\r\n > helper.tag(\'img\')\r\n => \"<img />\" \r\n\r\n > helper.tag(\'input\')\r\n => \"<input />\" \r\n```\r\n\r\n### Using collect in Nested content_tag\r\n\r\n```ruby\r\n > array = %w(a b c)\r\n => [\"a\", \"b\", \"c\"] \r\n\r\n helper.content_tag :div do\r\n     array.collect {|letter| helper.content_tag(:scan, letter) }\r\n   end\r\n => \"<div></div>\" \r\n```\r\n\r\nThis does not work as expected. Expected output:\r\n\r\n```ruby\r\n<div>\r\n  <scan>a</scan>\r\n  <scan>b</scan>\r\n  <scan>c</scan>\r\n</div>\r\n```\r\n\r\nWe can make it work like this:\r\n\r\n```ruby\r\nhelper.content_tag :div do\r\n  array.collect do |item|\r\n    helper.content_tag(:scan, item)\r\n  end.join.html_safe\r\nend\r\n => \"<div><scan>a</scan><scan>b</scan><scan>c</scan></div>\" \r\n```\r\n\r\nWe can add a class to the div tag like this:\r\n\r\n```ruby\r\n => \"<div><scan>a</scan><scan>b</scan><scan>c</scan></div>\" \r\nhelper.content_tag(:div, class: \'active\') do\r\n  array.collect do |item|\r\n    helper.content_tag(:li, item)\r\n  end.join.html_safe\r\nend\r\n=> \"<div class=\\\"active\\\"><li>a</li><li>b</li><li>c</li></div>\" \r\n```  \r\n\r\nYou can also use reduce instead of collect.\r\n\r\n```ruby\r\nhelper.content_tag(:div, nil, class: \'some-class\') do\r\n array.reduce(\'\') do |c, x|\r\n   c << helper.content_tag(:li, x)\r\n end.html_safe\r\nend\r\n=> \"<div class=\\\"some-class\\\"><li>a</li><li>b</li><li>c</li></div>\" \r\n```\r\n\r\n### Using each with content_tag\r\n\r\nTo use each we have to use concat in combination with content_tag like this:\r\n\r\n```ruby\r\nhelper.content_tag(:ul, class: \'a class\') do\r\n  array.each do |item|\r\n    helper.concat(helper.content_tag(:li, item))\r\n  end\r\nend\r\n => \"<ul class=\\\"a class\\\"><li>a</li><li>b</li><li>c</li></ul>\" \r\n```\r\n\r\nConditional in content_tag\r\n\r\n```ruby\r\n active_item = true\r\n > helper.content_tag(:div, \'Hello World\', class: (\'active\' if active_item))\r\n => \"<div class=\\\"active\\\">Hello World</div>\" \r\n```\r\n\r\nAppending to Form the Result\r\n\r\n```ruby\r\n > content = helper.content_tag(:tr, \'first item\')\r\n => \"<tr>first item</tr>\" \r\n > content << helper.content_tag(:tr, \'second item\')\r\n => \"<tr>first item</tr><tr>second item</tr>\" \r\n```\r\n\r\n## Summary\r\n\r\nIn this article, you learned how to use tag and content_tag view helpers in Rails 5.','2016-03-26 18:29:35','2016-03-26 18:29:35'),(3421,'Rails 5 : Blocks in View ','## Steps\r\n\r\n### Step 1\r\n\r\nWe want the task show page edit link to be displayed only for an admin. We want `admin_area` helper that takes a block like this:\r\n\r\n```rhtml\r\n<% admin_area do %>\r\n  <%= link_to \'Edit\', edit_task_path(@task) %> |\r\n<% end %>\r\n```\r\n\r\nHere is the entire `tasks/show.html.erb` file:\r\n\r\n```rhtml\r\n<p>\r\n  <strong>Name:</strong>\r\n  <%= @task.name %>\r\n</p>\r\n<p>\r\n  <strong>Complete:</strong>\r\n  <%= @task.complete %>\r\n</p>\r\n<p>\r\n	<%= @task.due_date %>\r\n</p>\r\n<% admin_area do %>\r\n  <%= link_to \'Edit\', edit_task_path(@task) %> |\r\n<% end %>\r\n<%= link_to \'Back\', tasks_path %>\r\n```\r\n\r\n### Step 2\r\n\r\nDefine `admin_area` helper in `application_helper.rb`:\r\n\r\n```ruby\r\ndef admin_area(&block)\r\n  content_tag(:div, block.call, class: \'admin\')\r\nend\r\n```\r\n\r\nWe need to generate a div tag that has admin class.\r\n\r\n### Step 3\r\n\r\nAdd show link to tasks index page.\r\n\r\n```rhtml\r\n<%= link_to \'Show\', task %>\r\n```\r\n\r\nHere is the entire task index page.\r\n\r\n```rhtml\r\n<h1>Tasks</h1>\r\n<table>\r\n  <thead>\r\n    <tr>\r\n      <th></th>\r\n    </tr>\r\n  </thead>\r\n  <tbody>\r\n	<tr>\r\n	  <% for task in @tasks %>\r\n		<div class=\'task\'>\r\n			<strong> <%= task.name %> </strong>\r\n		</div>\r\n		<%= link_to \'Edit\', edit_task_path(task) %>\r\n		<%= link_to \'Show\', task %>\r\n	  <% end %>\r\n	 </tr>		 \r\n  </tbody>\r\n</table>\r\n```\r\n\r\n### Step 4\r\n\r\nClick on \'Show\' link in the tasks index page. There is nothing that hides the Edit link. View page source. The generated html for the edit link does not have the div tag.\r\n\r\n```rhtml\r\n<a href=\"/tasks/10/edit\">Edit</a> |\r\n<a href=\"/tasks\">Back</a>\r\n```\r\n\r\n### Step 5\r\n\r\nChange the view helper implementation:\r\n\r\n```ruby\r\ndef admin_area(&block)\r\n  content_tag(:div, block.call, class: \'admin\')\r\n  nil\r\nend\r\n```\r\n\r\n### Step 6\r\n\r\nReload the task show page. View page source. The generated html is the same.\r\n\r\n### Step 7\r\n\r\nFrom Rails docs:\r\n\r\n> The preferred method of outputting text in your views is to use the <%= “text” %> eRuby syntax. The regular puts and print methods do not operate as expected in an eRuby code block. If you absolutely must output text within a non-output code block (i.e., <% %>), you can use the concat method.\r\n\r\nChange the implementation of `application_helper`.\r\n\r\n```ruby\r\ndef admin_area(&block)\r\n  concat(\'foo\', block.binding)\r\n  yield\r\n  concat(\'bar\', block.binding)\r\nend\r\n```\r\n\r\n### Step 8\r\n\r\nReload the task show page. We get the error:\r\n\r\n```\r\nwrong number of arguments (given 2, expected 1)\r\n```\r\n\r\nRails 5 has simplified the interface. Change the helper to:\r\n\r\n```ruby\r\ndef admin_area(&block)\r\n  concat(\'foo\')\r\n  yield\r\n  concat(\'bar\')\r\nend\r\n```\r\n\r\n### Step 9\r\n\r\nReload the task show page. The browser displays:\r\n\r\n```\r\nfoo  <a href=\"/tasks/10/edit\">Edit</a> |\r\nbar\r\n```\r\n\r\nView page source. You can see the foo and bar displayed before and after the edit link.\r\n\r\n### Step 10\r\n\r\nChange the helper to wrap the edit link with the div tag with admin class.\r\n\r\n```ruby\r\ndef admin_area(&block)\r\n  concat(\'<div class=\"admin\">\')\r\n  yield\r\n  concat(\'</div>\')\r\nend\r\n```\r\n\r\n### Step 11\r\n\r\nReload the task show page. The browser displays:\r\n\r\n```html\r\n<div class=\"admin\"> Edit | </div> Back\r\n```\r\n\r\nWe don\'t want to display the html string on the browser, we want the html be rendered by the browser.\r\n\r\n### Step 12\r\n\r\nUse `html_safe` to force the string to be rendered on the browser:\r\n\r\n```ruby\r\ndef admin_area(&block)\r\n  concat(\'<div class=\"admin\">\'.html_safe)\r\n  yield\r\n  concat(\'</div>\'.html_safe)\r\nend\r\n```\r\n\r\nView page source:\r\n\r\n```html\r\n<div class=\"admin\">  <a href=\"/tasks/10/edit\">Edit</a> |\r\n</div>\r\n```\r\n\r\nNow you can see the html in the page source.\r\n\r\n### Step 13\r\n\r\nAdd:\r\n\r\n```\r\n.admin {\r\n	background: yellow;\r\n}\r\n```\r\n\r\nto `stylesheets/tasks.scss`. The edit link will now be highlighted in yellow because of admin class.\r\n\r\n## Summary\r\n\r\nIn this article, you learned how to use blocks in view to simplify login the view by using your own view helpers.','2016-03-29 03:55:31','2016-03-29 03:57:35'),(3431,'Rails 5 Validation Basics','Let\'s create a new user and check if it is valid.\r\n\r\n```ruby\r\n > user = User.new\r\n => #<User id: nil, first_name: nil, middle_initial: nil, last_name: nil, created_at: nil, updated_at: nil, password: nil> \r\n > user.valid?\r\n => false \r\n```\r\n\r\nThe user model has a validation for `first_name`. \r\n\r\n```ruby\r\nclass User < ApplicationRecord\r\n  validates_presence_of :first_name\r\n  \r\n  def full_name\r\n    [first_name, last_name].join(\' \')\r\n  end\r\n  \r\n  def full_name=(name)\r\n    split = name.split(\' \', 2)\r\n    self.first_name = split.first\r\n    self.last_name = split.last\r\n  end\r\nend\r\n```\r\n\r\nWhat are the errors? We can check for errors like this:\r\n\r\n```ruby\r\n > user.errors\r\n => #<ActiveModel::Errors:0x007fe10 @base=#<User id: nil, first_name: nil, middle_initial: nil, last_name: nil, created_at: nil, updated_at: nil, password: nil>, @messages={:first_name=>[\"can\'t be blank\"]}, @details={:first_name=>[{:error=>:blank}]}> \r\n```\r\n\r\nWe can retrieve the human readable error message like this:\r\n\r\n```ruby \r\n > user.errors.full_messages\r\n => [\"First name can\'t be blank\"] \r\n``` \r\n\r\nLet\'s create a valid user object by providing the `first_name`.\r\n\r\n```ruby\r\n > b = User.new(first_name: \'bugs\')\r\n => #<User id: nil, first_name: \"bugs\", middle_initial: nil, last_name: nil, created_at: nil, updated_at: nil, password: nil> \r\n```\r\n\r\nWe can verify that it is valid.\r\n\r\n```ruby\r\n > b.valid?\r\n => true \r\n```\r\n\r\nFrom Rails Guides:\r\n> Active Record uses the `new_record?` instance method to determine whether an object is already in the database or not.\r\n\r\n```ruby\r\n > user.new_record?\r\n => true \r\n```\r\n\r\nHow does Active Record know whether an object is saved in the database or not?\r\n\r\n```ruby\r\n > user.id\r\n => nil\r\n```\r\n\r\nIf the primary key is nil then it knows that the object has not been saved in the database yet. What happens when we use create method?\r\n\r\n```ruby \r\n > daffy = User.create(first_name: \'daffy\')\r\n   (0.1ms)  begin transaction\r\n  SQL (1.3ms)  INSERT INTO \"users\" (\"first_name\", \"created_at\", \"updated_at\") VALUES (?, ?, ?)  [[\"first_name\", \"daffy\"], [\"created_at\", 2016-03-28 20:10:42 UTC], [\"updated_at\", 2016-03-28 20:10:42 UTC]]\r\n   (0.5ms)  commit transaction\r\n```\r\n\r\nActive Record inserts the object into the database. We can check if the object that has been saved in the database is a new record or not.\r\n\r\n```ruby\r\n > daffy.new_record?\r\n => false \r\n```\r\n\r\nActive Record knows that it is not a new record because the primary key value has been populated.\r\n\r\n```ruby\r\n > daffy.id\r\n => 1 \r\n```\r\n\r\nWhat happens when we change an attribute of an existing record and save it?\r\n\r\n```ruby\r\n > daffy.first_name = \'duffy\'\r\n => \"duffy\" \r\n > daffy.save\r\n   (0.1ms)  begin transaction\r\n  SQL (0.9ms)  UPDATE \"users\" SET \"first_name\" = ?, \"updated_at\" = ? WHERE \"users\".\"id\" = ?  [[\"first_name\", \"duffy\"], [\"updated_at\", 2016-03-28 20:12:58 UTC], [\"id\", 1]]\r\n   (0.5ms)  commit transaction\r\n => true \r\n```\r\n\r\nIn that cases, Active Record updates the existing record. You can bypass the validation by passing false for validate key.\r\n\r\n```ruby\r\n > junk = User.new\r\n => #<User id: nil, first_name: nil, middle_initial: nil, last_name: nil, created_at: nil, updated_at: nil, password: nil> \r\n > junk.save(validate: false)\r\n   (0.1ms)  begin transaction\r\n  SQL (0.8ms)  INSERT INTO \"users\" (\"created_at\", \"updated_at\") VALUES (?, ?)  [[\"created_at\", 2016-03-28 20:20:18 UTC], [\"updated_at\", 2016-03-28 20:20:18 UTC]]\r\n   (0.4ms)  commit transaction\r\n => true \r\n```\r\n\r\nThis is generally not a good idea. The user we just created is not a valid user.\r\n\r\n```ruby\r\n > junk\r\n => #<User id: 2, first_name: nil, middle_initial: nil, last_name: nil, created_at: \"2016-03-28 18:20:18\", updated_at: \"2016-03-28 20:20:18\", password: nil> \r\n > junk.valid?\r\n => false \r\n```\r\n\r\nActive Record gives another method `invalid?`.\r\n\r\n```ruby\r\n > junk.invalid?\r\n => true \r\n```\r\n\r\nWe can get list of all error messages as a hash like this:\r\n\r\n```ruby\r\n > t = User.new\r\n => #<User id: nil, first_name: nil, middle_initial: nil, last_name: nil, created_at: nil, updated_at: nil, password: nil> \r\n > t.errors.messages\r\n => {:first_name=>[\"can\'t be blank\"]} \r\n```\r\n\r\nWe can get a specific error message for a field like this:\r\n\r\n```ruby\r\n > t.errors[:first_name]\r\n => [\"can\'t be blank\"] \r\n```\r\n\r\nWe can check if a specific field has any error like this:\r\n\r\n```ruby\r\n > t.errors[:first_name].any?\r\n => true \r\n```\r\n\r\nWe can also use the details method to get a list of errors for a given field.\r\n\r\n```ruby\r\n > t.errors.details[:first_name]\r\n => [{:error=>:blank}] \r\n```\r\n\r\n## Summary\r\n\r\nIn this article, you learned the basics of Active Record validation in Rails 5.','2016-03-29 04:25:34','2016-03-29 04:25:34'),(3441,'Catch All Route in Rails 5','## Steps\r\n### Step 1\r\n\r\nCreate a few products using the scaffold generated code. Let\'s say television, pillow and table.\r\n\r\n### Step 2\r\n\r\nGenerate a controller to handle unknown routes.\r\n\r\n```sh\r\nrails g controller catch_all index\r\n```\r\n \r\n### Step 3\r\n\r\nLet\'s inspect the params sent to the server in the browser.\r\n\r\n```ruby\r\nclass CatchAllController < ApplicationController\r\n  def index\r\n    render text: params.inspect\r\n  end\r\nend\r\n```\r\n\r\n### Step 4\r\n\r\nDefine the catch all route in the routes.rb.\r\n\r\n```ruby\r\nget \'*path\', to: \'catch_all#index\'\r\n```\r\n\r\n### Step 5\r\n\r\nBrowse to `http://localhost:3000/tele`. In the browser, you will see:\r\n\r\n```\r\n\"catch_all\", \"action\"=>\"index\", \"path\"=>\"tele\"} permitted: false>\r\n```\r\n\r\nBrowse to `http://localhost:3000/tele/mundo`. In the browser, you will see:\r\n\r\n```\r\n\"catch_all\", \"action\"=>\"index\", \"path\"=>\"tele/mundo\"} permitted: false>\r\n```\r\n\r\n### Step 7\r\n\r\nBrowse to `http://localhost:3000/tele/mundo?l=10`. In the browser, you will see:\r\n\r\n```\r\n{\"l\"=>\"10\", \"path\"=>\"tele/mundo\"}\r\n```\r\n\r\nThe query parameter is separate from the path key.\r\n\r\n### Step 8\r\n\r\nThe `request.request_uri` is no longer available in Rails 5. Rails 3.0.9 is the last version that had this method. We can use `request.url` instead:\r\n\r\n```ruby\r\nrender text: request.url\r\n```\r\n\r\n### Step 9\r\n\r\nReload the page: `http://localhost:3000/tele/mundo/manga`. Browser output is: \r\n\r\n```\r\nhttp://localhost:3000/tele/mundo/manga.\r\n```\r\n\r\nBrowse to `http://localhost:3000/tele/mundo/manga?q=test`. Browser output is:\r\n\r\n```\r\nhttp://localhost:3000/tele/mundo/manga?q=test\r\n```\r\n\r\n### Step 10\r\n\r\nLet\'s find the product that begins with the string in the first part of the URL.\r\n\r\n```ruby\r\nclass CatchAllController < ApplicationController\r\n  def index\r\n    product = Product.where(\'name LIKE ?\', \"#{params[:path].first}%\").first\r\n    \r\n    redirect_to product_path(product)\r\n  end\r\nend\r\n```\r\n\r\nType `http://localhost:3000/tele` in the browser. You will go to the television product show page.\r\n\r\n## Summary\r\n\r\nIn this article, you learned how to use catch all route in Rails 5. This is helpful if you want to handle legacy routes in your app and redirect them to new URL. This way the bookmarks of the users will still work.','2016-03-29 04:44:54','2016-03-29 04:44:54'),(3451,'Has Many Through and Has and Belongs to Many in Rails 5','## Has and Belongs to Many Association\r\n\r\nYou can watch this tutorial as a screencast [Has Many Through and Has and Belongs to Many in Rails 5](https://itunes.apple.com/us/podcast/rails-screencast/id1142573687 \'Has Many Through and Has and Belongs to Many in Rails 5\').\r\n\r\n### Step 1\r\n\r\nCreate a category model with name attribute.\r\n\r\n```\r\nrails g model category name\r\n```\r\n\r\nIn Rails 5, if you don\'t provide the column type, it defaults to string. As you can see it in the generated migration file:\r\n\r\n```ruby\r\nclass CreateCategories < ActiveRecord::Migration[5.0]\r\n  def change\r\n    create_table :categories do |t|\r\n      t.string :name\r\n\r\n      t.timestamps\r\n    end\r\n  end\r\nend\r\n```\r\n\r\n### Step 2\r\n\r\nCreate a product model with name attribute.\r\n\r\n```ruby\r\nrails g model product name\r\n```\r\n\r\nHere is the generated Migration file for products.\r\n\r\n```ruby\r\nclass CreateProducts < ActiveRecord::Migration[5.0]\r\n  def change\r\n    create_table :products do |t|\r\n      t.string :name\r\n\r\n      t.timestamps\r\n    end\r\n  end\r\nend\r\n```\r\n\r\nRails 5 creates the attribute with string as the default type. \r\n\r\n### Step 3\r\n\r\nFor the `has_and_belongs_to_many` association, let\'s create a join table.\r\n\r\n```\r\nrails g migration CreateJoinTableCategoryProduct category product\r\n```\r\n\r\nIf you use `CreateJoinTableTableName1TableName2` model1 model2 for migration, Rails 5 migration generator will automatically create the migration file with the appropriate join table with index like this:\r\n\r\n```ruby\r\nclass CreateJoinTableCategoryProduct < ActiveRecord::Migration[5.0]\r\n  def change\r\n    create_join_table :categories, :products do |t|\r\n      t.index [:category_id, :product_id]\r\n    end\r\n  end\r\nend\r\n```\r\n\r\n### Step 4\r\n\r\nMigrate the database:\r\n\r\n```\r\nrails db:migrate\r\n```\r\n\r\nIn schema.rb, you can see the index and the `categories_products` join table:\r\n\r\n```ruby\r\nActiveRecord::Schema.define(version: 20160329172233) do\r\n  create_table \"categories\", force: :cascade do |t|\r\n    t.string   \"name\"\r\n    t.datetime \"created_at\", null: false\r\n    t.datetime \"updated_at\", null: false\r\n  end\r\n\r\n  create_table \"categories_products\", id: false, force: :cascade do |t|\r\n    t.integer \"category_id\", null: false\r\n    t.integer \"product_id\",  null: false\r\n  end\r\n\r\n  add_index \"categories_products\", [\"category_id\", \"product_id\"], name: \"index_categories_products_on_category_id_and_product_id\"\r\n\r\n  create_table \"products\", force: :cascade do |t|\r\n    t.string   \"name\"\r\n    t.datetime \"created_at\", null: false\r\n    t.datetime \"updated_at\", null: false\r\n  end\r\nend\r\n```\r\n\r\nYou can also see the index defined for the `categories_products` table.\r\n\r\n### Step 5\r\n\r\nDeclare the `has_and_belongs_to_many` in the product model.\r\n\r\n```ruby\r\nclass Product < ApplicationRecord\r\n  has_and_belongs_to_many :categories\r\nend\r\n```\r\n\r\nDeclare the `has_and_belongs_to_many` in the category model.\r\n\r\n```ruby\r\nclass Category < ApplicationRecord\r\n  has_and_belongs_to_many :products\r\nend\r\n```\r\n\r\n## Has Many Through\r\n### Step 1\r\n\r\nCreate a categorization join model.\r\n\r\n```\r\nrails g model categorization product_id:integer category_id:integer position:integer\r\n```\r\n\r\nThe migration file looks like this:\r\n\r\n```ruby\r\nclass CreateCategorizations < ActiveRecord::Migration[5.0]\r\n  def change\r\n    create_table :categorizations do |t|\r\n      t.integer :product_id\r\n      t.integer :category_id\r\n      t.integer :position\r\n\r\n      t.timestamps\r\n    end\r\n    \r\n    add_index :categorizations, [:product_id, :category_id]\r\n  end\r\nend\r\n```\r\n\r\nTo find the abstraction, think about a concept that ends in tion, ship or ment.\r\n\r\n### Step 2\r\n\r\nMigrate the database:\r\n\r\n```\r\nrails db:migrate\r\n```\r\n\r\n### Step 3\r\n\r\nYou can see the structure of the tables in the schema.rb.\r\n\r\n```ruby\r\nActiveRecord::Schema.define(version: 20160329173814) do\r\n\r\n  create_table \"categories\", force: :cascade do |t|\r\n    t.string   \"name\"\r\n    t.datetime \"created_at\", null: false\r\n    t.datetime \"updated_at\", null: false\r\n  end\r\n\r\n  create_table \"categories_products\", id: false, force: :cascade do |t|\r\n    t.integer \"category_id\", null: false\r\n    t.integer \"product_id\",  null: false\r\n  end\r\n\r\n  add_index \"categories_products\", [\"category_id\", \"product_id\"], name: \"index_categories_products_on_category_id_and_product_id\"\r\n\r\n  create_table \"categorizations\", force: :cascade do |t|\r\n    t.integer  \"product_id\"\r\n    t.integer  \"category_id\"\r\n    t.integer  \"position\"\r\n    t.datetime \"created_at\",  null: false\r\n    t.datetime \"updated_at\",  null: false\r\n  end\r\n\r\n  add_index \"categorizations\", [\"product_id\", \"category_id\"], name: \"index_categorizations_on_product_id_and_category_id\"\r\n\r\n  create_table \"products\", force: :cascade do |t|\r\n    t.string   \"name\"\r\n    t.datetime \"created_at\", null: false\r\n    t.datetime \"updated_at\", null: false\r\n  end\r\nend\r\n```\r\n\r\nWe have categorizations table with an index defined for all the foreign keys it it.\r\n\r\n### Step 4\r\n\r\nDeclare the `belongs_to` association in the Categorization model.\r\n\r\n```ruby\r\nclass Categorization < ApplicationRecord\r\n  belongs_to :product\r\n  belongs_to :category\r\nend\r\n```\r\n\r\nDeclare the `has_many_through` declarations in the product and category models.\r\n\r\n```ruby\r\nclass Product < ApplicationRecord\r\n  has_many :categorizations\r\n  has_many :categories, through: :categorizations\r\nend\r\n```\r\n\r\n```ruby\r\nclass Category < ApplicationRecord\r\n  has_many :categorizations\r\n  has_many :products, through: :categorizations\r\nend\r\n```\r\n\r\n## Summary\r\n\r\nIn this article, you learned how to use `has_and_belongs_to_many` and `has_many` through associations in Rails 5.','2016-03-30 02:43:57','2016-10-29 17:12:31'),(3461,'Console Tricks in Rails 5','You can print the yaml representation of an object using the `y` method.\r\n\r\n```\r\n$ rails c\r\np Loading development environment (Rails 5.0.0.beta3)\r\n > p = Product.first\r\n  Product Load (0.3ms)  SELECT  \"products\".* FROM \"products\" ORDER BY \"products\".\"id\" ASC LIMIT ?  [[\"LIMIT\", 1]]\r\n => #<Product id: 1, name: \"Television\", price: #<BigDecimal:7fb81444ba50,\'0.99E2\',9(18)>, created_at: \"2016-03-28 21:58:42\", updated_at: \"2016-03-28 21:58:42\"> \r\n > y p\r\n--- !ruby/object:Product\r\nraw_attributes:\r\n  id: 1\r\n  name: Television\r\n  price: 99\r\n  created_at: \'2016-03-28 21:58:42.799649\'\r\n  updated_at: \'2016-03-28 21:58:42.799649\'\r\nattributes: !ruby/object:ActiveRecord::AttributeSet\r\n  attributes: !ruby/object:ActiveRecord::LazyAttributeHash\r\n    types:\r\n      id: &2 !ruby/object:ActiveModel::Type::Integer\r\n        precision: \r\n        scale: \r\n        limit: \r\n        range: !ruby/range\r\n          begin: -2147483648\r\n          end: 2147483648\r\n          excl: true\r\n      name: &3 !ruby/object:ActiveModel::Type::String\r\n        precision: \r\n        scale: \r\n        limit: \r\n      price: &4 !ruby/object:ActiveModel::Type::Decimal\r\n        precision: 8\r\n        scale: 2\r\n        limit: \r\n      created_at: &5 !ruby/marshalable:ActiveRecord::AttributeMethods::TimeZoneConversion::TimeZoneConverter\r\n        :__v2__: []\r\n        []: &1 !ruby/object:ActiveRecord::Type::DateTime\r\n          precision: \r\n          scale: \r\n          limit: \r\n      updated_at: &7 !ruby/marshalable:ActiveRecord::AttributeMethods::TimeZoneConversion::TimeZoneConverter\r\n        :__v2__: []\r\n        []: *1\r\n    values:\r\n      id: 1\r\n      name: Television\r\n      price: 99\r\n      created_at: \'2016-03-28 21:58:42.799649\'\r\n      updated_at: \'2016-03-28 21:58:42.799649\'\r\n    additional_types: {}\r\n    materialized: true\r\n    delegate_hash:\r\n      id: !ruby/object:ActiveRecord::Attribute::FromDatabase\r\n        name: id\r\n        value_before_type_cast: 1\r\n        type: *2\r\n        original_attribute: \r\n        value: 1\r\n      name: !ruby/object:ActiveRecord::Attribute::FromDatabase\r\n        name: name\r\n        value_before_type_cast: Television\r\n        type: *3\r\n        original_attribute: \r\n        value: Television\r\n      price: !ruby/object:ActiveRecord::Attribute::FromDatabase\r\n        name: price\r\n        value_before_type_cast: 99\r\n        type: *4\r\n        original_attribute: \r\n        value: !ruby/object:BigDecimal 18:0.99E2\r\n      created_at: !ruby/object:ActiveRecord::Attribute::FromDatabase\r\n        name: created_at\r\n        value_before_type_cast: \'2016-03-28 21:58:42.799649\'\r\n        type: *5\r\n        original_attribute: \r\n        value: !ruby/object:ActiveSupport::TimeWithZone\r\n          utc: &6 2016-03-28 21:58:42.799649000 Z\r\n          zone: &8 !ruby/object:ActiveSupport::TimeZone\r\n            name: Etc/UTC\r\n          time: *6\r\n      updated_at: !ruby/object:ActiveRecord::Attribute::FromDatabase\r\n        name: updated_at\r\n        value_before_type_cast: \'2016-03-28 21:58:42.799649\'\r\n        type: *7\r\n        original_attribute: \r\n        value: !ruby/object:ActiveSupport::TimeWithZone\r\n          utc: &9 2016-03-28 21:58:42.799649000 Z\r\n          zone: *8\r\n          time: *9\r\nnew_record: false\r\nactive_record_yaml_version: 1\r\n => nil \r\n```\r\n\r\nYou can use pretty print `pp` to give a better output.\r\n\r\n```\r\n > require \'pp\'\r\n => false \r\n > pp p\r\n#<Product:0x007f70\r\n id: 1,\r\n name: \"Television\",\r\n price: #<BigDecimal:7fb50,\'0.99E2\',9(18)>,\r\n created_at: Mon, 28 Mar 2016 21:58:42 UTC +00:00,\r\n updated_at: Mon, 28 Mar 2016 21:58:42 UTC +00:00>\r\n => #<Product id: 1, name: \"Television\", price: #<BigDecimal:7fb81450,\'0.99E2\',9(18)>, created_at: \"2016-03-28 21:58:42\", updated_at: \"2016-03-28 21:58:42\"> \r\n```\r\n\r\nThis is much more readable than the yaml method. The `pp` is already required by Rails 5, that is the reason you see the result false. \r\n\r\nYou can autocomplete strings by typing the first few characters and hitting the tab a few times.\r\n\r\n```\r\n > Acti\r\n\r\nActionCable       ActionController  ActionDispatch    ActionMailer      ActionPack        ActionView        ActiveJob         ActiveModel       ActiveRecord      ActiveSupport   \r\n```\r\n\r\nHere we see all classes that begins with Acti. You can also check what methods are available on an object by hitting tabs a few times.\r\n\r\n```  \r\n > \'foo\'.to_\r\n\'foo\'.to_blob             \'foo\'.to_date             \'foo\'.to_f                \'foo\'.to_json_raw         \'foo\'.to_query            \'foo\'.to_str              \'foo\'.to_yaml\r\n\'foo\'.to_c                \'foo\'.to_datetime         \'foo\'.to_i                \'foo\'.to_json_raw_object  \'foo\'.to_r                \'foo\'.to_sym              \'foo\'.to_yaml_properties\r\n```\r\n\r\nWhat are the classes that begin with Pro?\r\n\r\n```\r\n > Pro\r\nProc     Process  Product  \r\n```\r\n\r\nWhat are the methods that are available in our product object?\r\n\r\n```\r\n > p.new_record?\r\np.new_record?\r\n > p.new_record?\r\n => false \r\n```\r\n\r\nWhat are the methods that begin with the letter n for the product object?\r\n\r\n```\r\n > p.n\r\np.name                        p.name_before_type_cast       p.name_changed?               p.name_was                    p.nested_attributes_options?  p.no_touching?\r\np.name=                       p.name_came_from_user?        p.name_previous_change        p.name_will_change!           p.new_record?                 \r\np.name?                       p.name_change                 p.name_previously_changed?    p.nested_attributes_options   p.nil?  \r\n```\r\n\r\nWe have access to the app instance in the rails console.\r\n\r\n```                      \r\n > app.class\r\n => ActionDispatch::Integration::Session \r\n```\r\n\r\nWe can send a GET request for the home page.\r\n\r\n```\r\n > app.get \'/\'\r\nStarted GET \"/\" for 127.0.0.1 at 2016-03-29 20:56:34 -0700\r\n  ActiveRecord::SchemaMigration Load (0.3ms)  SELECT \"schema_migrations\".* FROM \"schema_migrations\"\r\nProcessing by ProjectsController#index as HTML\r\n  Project Load (0.4ms)  SELECT \"projects\".* FROM \"projects\"\r\n  Task Load (0.3ms)  SELECT \"tasks\".* FROM \"tasks\" WHERE \"tasks\".\"project_id\" = ?  [[\"project_id\", 1]]\r\n  Task Load (0.1ms)  SELECT \"tasks\".* FROM \"tasks\" WHERE \"tasks\".\"project_id\" = ?  [[\"project_id\", 4]]\r\n  Task Load (0.1ms)  SELECT \"tasks\".* FROM \"tasks\" WHERE \"tasks\".\"project_id\" = ?  [[\"project_id\", 6]]\r\n  Rendered projects/index.html.erb within layouts/application (85.1ms)\r\nCompleted 200 OK in 450ms (Views: 353.3ms | ActiveRecord: 1.6ms)\r\n => 200 \r\n```\r\n\r\nWe see projects and the associated tasks loaded from the database. The http status code is 200. We can check the flash.\r\n\r\n```\r\n > app.flash\r\n => #<ActionDispatch::Flash::FlashHash:0x007f18 @discard=#<Set: {}>, @flashes={}, @now=nil> \r\n```\r\n\r\nHowever, in Rails 5, you cannot access the variables that you make available in the controller for the view.\r\n\r\n```\r\n > app.assigns[:tasks]\r\nNoMethodError: assigns has been extracted to a gem. To continue using it,\r\n        add `gem \'rails-controller-testing\'` to your Gemfile.\r\n```\r\n\r\nYou can view the cookies.\r\n\r\n```\r\n > app.cookies\r\n => #<Rack::Test::CookieJar:0x007fb8 @default_host=\"www.example.com\", @cookies=[#<Rack::Test::Cookie:0x007fb @default_host=\"www.example.com\", @name_value_raw=\"_blog5_session=UGZoa0hWMVFtallIVm1Fb\", @name=\"_blog5_session\", @value=\"DJIT5aee561c9e4f5c771d7406\", @options={\"path\"=>\"/\", \"HttpOnly\"=>nil, \"domain\"=>\"www.example.com\"}>]> \r\n```\r\n\r\nYou can access the view helpers by using the helper object.\r\n\r\n```\r\n > helper.text_field_tag :card\r\n => \"<input type=\\\"text\\\" name=\\\"card\\\" id=\\\"card\\\" />\" \r\n > helper.pluralize(5, \'item\')\r\n => \"5 items\" \r\n```\r\n\r\nWe can check the available methods in the app object by hitting tabs a few times.\r\n\r\n```\r\n > app.methods\r\n => [:main_app, :_main_app, :_routes, :root_path, :rails_mailers_path, :products_path, :new_product_path, ...] \r\n```\r\n\r\nWhat are the available methods in the `_routes` ?\r\n\r\n```\r\n > app._routes\r\n => #<ActionDispatch::Routing::RouteSet:0x007fb8135ce360> \r\n > app._routes.methods\r\n => [:empty?, :inspect, :call, :prepend, :append, :request_class, :set, :formatter=, ...] \r\n > app.methods.grep(/_path$/).sort\r\n => [:complete_task_path, :completed_tasks_path, :edit_polymorphic_path, :edit_product_path, ...] \r\n```\r\n\r\nThe underscore is a special global variable that has the value of the last executed command.\r\n\r\n```\r\n > _.class\r\n => Array \r\n```\r\n\r\nIt is an array in this case. Can we inspect it?\r\n\r\n```\r\n > _\r\n => Array \r\n > y _\r\n--- !ruby/class \'Array\'\r\n => nil \r\n```\r\n\r\nHere is a better example to illustrate the usefulness of underscore global variable.\r\n\r\n```\r\n > app._routes.methods\r\n => [:empty?, :inspect, :call, :prepend, :append, :request_class, :set, :formatter=, ...] \r\n > y _\r\n---\r\n- :empty?\r\n- :inspect\r\n- :call\r\n- :prepend\r\n- :append\r\n- :request_class\r\n- :set\r\n...\r\n```\r\n\r\nIf you change something in the file, you can reload the changes in the rails console by using the reload! method.\r\n\r\n```\r\n> reload!\r\nReloading...\r\n => true \r\n```\r\n \r\nAfter requesting the home page, we can check the path like this:\r\n\r\n``` \r\n > app.get \'/\'\r\nStarted GET \"/\" for 127.0.0.1 at 2016-03-29 11:15:30 -0700\r\n  ActiveRecord::SchemaMigration Load (0.2ms)  SELECT \"schema_migrations\".* FROM \"schema_migrations\"\r\nProcessing by ProjectsController#index as HTML\r\n  Project Load (0.3ms)  SELECT \"projects\".* FROM \"projects\"\r\n  Task Load (0.3ms)  SELECT \"tasks\".* FROM \"tasks\" WHERE \"tasks\".\"project_id\" = ?  [[\"project_id\", 1]]\r\n  Task Load (0.1ms)  SELECT \"tasks\".* FROM \"tasks\" WHERE \"tasks\".\"project_id\" = ?  [[\"project_id\", 4]]\r\n  Task Load (0.1ms)  SELECT \"tasks\".* FROM \"tasks\" WHERE \"tasks\".\"project_id\" = ?  [[\"project_id\", 6]]\r\n  Rendered projects/index.html.erb within layouts/application (51.9ms)\r\nCompleted 200 OK in 337ms (Views: 281.0ms | ActiveRecord: 1.7ms)\r\n => 200 \r\n > app.path\r\n => \"/\" \r\n```\r\n\r\nWe can reset the path and request a different page like this:\r\n\r\n```\r\n > app.reset!\r\n => nil \r\n > app.get \'/projects\'\r\nStarted GET \"/projects\" for 127.0.0.1 at 2016-03-29 11:20:23 -0700\r\nProcessing by ProjectsController#index as HTML\r\n  Project Load (0.5ms)  SELECT \"projects\".* FROM \"projects\"\r\n  Task Load (0.3ms)  SELECT \"tasks\".* FROM \"tasks\" WHERE \"tasks\".\"project_id\" = ?  [[\"project_id\", 1]]\r\n  Task Load (0.1ms)  SELECT \"tasks\".* FROM \"tasks\" WHERE \"tasks\".\"project_id\" = ?  [[\"project_id\", 4]]\r\n  Task Load (0.1ms)  SELECT \"tasks\".* FROM \"tasks\" WHERE \"tasks\".\"project_id\" = ?  [[\"project_id\", 6]]\r\n  Rendered projects/index.html.erb within layouts/application (39.6ms)\r\nCompleted 200 OK in 120ms (Views: 78.1ms | ActiveRecord: 2.1ms)\r\n```\r\n\r\nYou can get into a specific object context by providing irb the class name like this:\r\n\r\n```\r\n > irb Task\r\n > self\r\n => Task(id: integer, name: string, complete: boolean, created_at: datetime, updated_at: datetime, project_id: integer, priority: integer, due_date: datetime) \r\n```\r\n\r\nNow we are in the Task class context, we can call the methods without the receiver.\r\n\r\n```\r\n > all\r\n  Task Load (0.2ms)  SELECT \"tasks\".* FROM \"tasks\"\r\n => #<ActiveRecord::Relation [#<Task id: 1, name: \"Get rich quick\", complete: true, created_at: \"2016-03-18 21:37:57\", updated_at: \"2016-03-24 01:12:25\", project_id: 1, priority: 4, due_date: \"2016-01-18 21:37:57\">, #<Task id: 2, name: \"Write a book\", complete: true, created_at: ...]> \r\n > quit\r\n  => #<IRB::Irb: @context=#<IRB::Context:0x007ff0f08>, @signal_status=:IN_EVAL, @scanner=#<RubyLex:0x007b420>> \r\n```\r\n\r\nYou can get out of the Task class context by calling the exit. We can get into a specific task object like this:\r\n\r\n```\r\n > irb Task.first\r\n  Task Load (0.3ms)  SELECT  \"tasks\".* FROM \"tasks\" ORDER BY \"tasks\".\"id\" ASC LIMIT ?  [[\"LIMIT\", 1]]\r\n > name\r\n => \"Get rich quick\" \r\n```\r\n\r\nHere we are printing the name of the task object. We can get out of the task object by typing quit.\r\n\r\n```\r\n > quit\r\n => #<IRB::Irb: @context=#<IRB::Context:0x007ff0008>, @signal_status=:IN_EVAL, @scanner=#<RubyLex:0x007b420>> \r\n```\r\n\r\nWe can switch to the app context and check the host like this:\r\n\r\n```\r\n > irb app\r\n > host\r\n => \"www.example.com\" \r\n```\r\n\r\nYou can customize your IRB by creating an .irbrc in your home folder. Let\'s open the Object class and define a method.\r\n\r\n```ruby\r\nclass Object\r\n  def foo\r\n    \'bar\'\r\n  end\r\nend\r\n```\r\n\r\nNow you can access the foo method in the rails console like this:\r\n\r\n```\r\nrails c\r\nLoading development environment (Rails 5.0.0.beta3)\r\n > foo\r\n => \"bar\" \r\n```\r\n\r\n## Summary\r\n\r\nIn this article, you learned some console tricks.','2016-03-30 03:17:44','2016-03-30 03:17:44'),(3471,'Will Paginate in Rails 5','## Steps\r\n\r\nYou can download the source code for this article from [wpag](https://github.com/bparanj/wpag).\r\n\r\n### Step 1\r\n\r\nAdd the gem to the Gemfile.\r\n\r\n```ruby\r\ngem \'will_paginate\', \'>= 3.1\'\r\n```\r\n\r\nRun:\r\n\r\n```\r\nbundle\r\n```\r\n\r\n### Step 2\r\n\r\n```ruby\r\ndef index\r\n  @tasks = Task.search(params[:term], params[:page])\r\nend\r\n```\r\n\r\n### Step 3\r\n\r\nAdd the will_paginate view helper to the tasks index page.\r\n\r\n```rhtml\r\n<%= will_paginate @tasks %>\r\n```\r\n\r\n### Step 4\r\n\r\nYou can play in the Rails console to see how the `will_paginate` works:\r\n\r\n```ruby\r\n > t = Task.paginate(page: 1, per_page: 5)\r\n  Task Load (1.6ms)  SELECT  \"tasks\".* FROM \"tasks\" LIMIT ? OFFSET ?  [[\"LIMIT\", 5], [\"OFFSET\", 0]]\r\n => #<ActiveRecord::Relation [#<Task id: 1, name: \"Get rich quick\", complete: true, created_at: \"2016-03-18 21:37:57\", updated_at: \"2016-03-24 01:12:25\", project_id: 1, priority: 4, due_date: \"2016-01-18 21:37:57\">, #<Task id: 2, name: \"Write a book\", complete: true, created_at: \"2016-03-18 21:37:57\", updated_at: \"2016-03-18 21:37:57\", project_id: 1, priority: 5, due_date: \"2016-02-18 21:37:57\">, #<Task id: 3, name: \"Buy a puppy\", complete: false, created_at: \"2016-03-18 21:37:57\", updated_at: \"2016-03-18 21:37:57\", project_id: 2, priority: 9, due_date: \"2016-02-18 21:37:57\">, #<Task id: 4, name: \"Dance in the rain\", complete: true, created_at: \"2016-03-18 21:37:57\", updated_at: \"2016-03-18 22:20:05\", project_id: 2, priority: 7, due_date: \"2016-01-22 21:37:57\">, #<Task id: 5, name: \"Dance in the snow\", complete: true, created_at: \"2016-03-18 21:37:57\", updated_at: \"2016-03-18 21:37:57\", project_id: 2, priority: 6, due_date: \"2016-01-18 21:37:57\">]> \r\n > t.class\r\n => Task::ActiveRecord_Relation \r\n```\r\n\r\nWe can call the paginate method with current page and per page values. It returns ActiveRelation object. We can get all the records by calling `to_a` on ActiveRelation object.\r\n\r\n```ruby\r\n > results = t.to_a\r\n   (0.2ms)  SELECT COUNT(*) FROM \"tasks\"\r\n => [#<Task id: 1, name: \"Get rich quick\", complete: true, created_at: \"2016-03-18 21:37:57\", updated_at: \"2016-03-24 01:12:25\", project_id: 1, priority: 4, due_date: \"2016-01-18 21:37:57\">, #<Task id: 2, name: \"Write a book\", complete: true, created_at: \"2016-03-18 21:37:57\", updated_at: \"2016-03-18 21:37:57\", project_id: 1, priority: 5, due_date: \"2016-02-18 21:37:57\">, #<Task id: 3, name: \"Buy a puppy\", complete: false, created_at: \"2016-03-18 21:37:57\", updated_at: \"2016-03-18 21:37:57\", project_id: 2, priority: 9, due_date: \"2016-02-18 21:37:57\">, #<Task id: 4, name: \"Dance in the rain\", complete: true, created_at: \"2016-03-18 21:37:57\", updated_at: \"2016-03-18 22:20:05\", project_id: 2, priority: 7, due_date: \"2016-01-22 21:37:57\">, #<Task id: 5, name: \"Dance in the snow\", complete: true, created_at: \"2016-03-18 21:37:57\", updated_at: \"2016-03-18 21:37:57\", project_id: 2, priority: 6, due_date: \"2016-01-18 21:37:57\">] \r\n > results.size\r\n => 5 \r\n```\r\n\r\nThere are 10 tasks.\r\n\r\n```ruby\r\n > Task.count\r\n   (0.1ms)  SELECT COUNT(*) FROM \"tasks\"\r\n => 10 \r\n```\r\n\r\nWe can use the page method provided by `will_paginate` to paginate the tasks.\r\n\r\n```ruby\r\n > t1 = Task.page(1).order(\'id DESC\')\r\n  Task Load (0.4ms)  SELECT  \"tasks\".* FROM \"tasks\" ORDER BY id DESC LIMIT ? OFFSET ?  [[\"LIMIT\", 30], [\"OFFSET\", 0]]\r\n => #<ActiveRecord::Relation [#<Task id: 10, name: \"Walk on moon\", complete: true, created_at: \"2016-03-18 21:37:57\", updated_at: \"2016-03-18 21:37:57\", project_id: 2, priority: 2, due_date: \"2016-03-16 21:37:57\">, #<Task id: 9, name: \"Make fun of Donald Trump\", complete: true, created_at: \"2016-03-18 21:37:57\", updated_at: \"2016-03-18 21:37:57\", project_id: 2, priority: 3, due_date: \"2016-03-16 ...\">]> \r\n > t1.class\r\n => Task::ActiveRecord_Relation \r\n > t1r = t1.to_a\r\n => [#<Task id: 10, name: \"Walk on moon\", complete: true, created_at: \"2016-03-18 21:37:57\", updated_at: \"2016-03-18 21:37:57\", project_id: 2, priority: 2, due_date: \"2016-03-16 21:37:57\">, #<Task id: 9, name: \"Make fun of Donald Trump\", complete: true, created_at: \"2016-03-18 21:37:57\", updated_at: \"2016-03-18 21:37:57\", project_id: 2, priority: 3, due_date: \"2016-03-16 21:37:57\">, #<Task id: 8, name: \"Play tennis\", complete: true, created_at: \"2016-03-18 21:37:57\", updated_at: \"2016-03-18 21:37:57\", project_id: 2, priority: 4,...>] \r\n > t1r.size\r\n => 10 \r\n```\r\n \r\n### Step 5\r\n\r\nLet\'s use the page method provided by the `will_paginate` gem in the task model.\r\n\r\n```ruby\r\ndef self.search(term, current_page)\r\n  if term\r\n    page(current_page).where(\'name LIKE ?\', \"%#{term}%\").order(\'id DESC\')\r\n  else\r\n    page(current_page).order(\'id DESC\') \r\n  end\r\nend\r\n```\r\n\r\nThis gives 10 tasks per page. So no pagination links are displayed on the browser. Because we only have 10 tasks.\r\n\r\n### Step 6\r\n\r\nLet\'s use the paginate method provided by `will_paginate` gem in the task model.\r\n\r\n```ruby\r\ndef self.search(term, page)\r\n  if term\r\n    where(\'name LIKE ?\', \"%#{term}%\").paginate(page: page, per_page: 5).order(\'id DESC\')\r\n  else\r\n    paginate(page: page, per_page: 5).order(\'id DESC\') \r\n  end\r\nend\r\n```\r\n\r\nThe pagination now works for index and search results.\r\n\r\n### Step 7\r\n\r\nThe tasks index page looks like this:\r\n\r\n```rhtml\r\n<h1>Tasks</h1>\r\n<%= form_tag(tasks_path, method: :get) do %>\r\n   <%= text_field_tag :term, params[:term] %>\r\n   <%= submit_tag \'Search\', name: nil %>\r\n<% end %>\r\n<table>\r\n  <thead>\r\n    <tr><th></th></tr>\r\n  </thead>\r\n  <tbody>\r\n	<tr>\r\n	  <% for task in @tasks %>\r\n		<div class=\'task\'>\r\n			<strong> <%= task.name %> </strong>\r\n		</div>\r\n		<%= link_to \'Edit\', edit_task_path(task) %>\r\n		<%= link_to \'Show\', task %>\r\n	  <% end %>\r\n	 </tr>		 \r\n  </tbody>\r\n</table>\r\n\r\n<%= will_paginate @tasks %>\r\n```\r\n\r\n## Step 8\r\n\r\nYou can customize the pagination look and feel. Copy the following CSS from will_paginate wiki to application.css.\r\n\r\n```css\r\n.digg_pagination {\r\n  background: white;\r\n  cursor: default;\r\n  /* self-clearing method: */ }\r\n  .digg_pagination a, .digg_pagination span, .digg_pagination em {\r\n    padding: 0.2em 0.5em;\r\n    display: block;\r\n    float: left;\r\n    margin-right: 1px; }\r\n  .digg_pagination .disabled {\r\n    color: #999999;\r\n    border: 1px solid #dddddd; }\r\n  .digg_pagination .current {\r\n    font-style: normal;\r\n    font-weight: bold;\r\n    background: #2e6ab1;\r\n    color: white;\r\n    border: 1px solid #2e6ab1; }\r\n  .digg_pagination a {\r\n    text-decoration: none;\r\n    color: #105cb6;\r\n    border: 1px solid #9aafe5; }\r\n    .digg_pagination a:hover, .digg_pagination a:focus {\r\n      color: #000033;\r\n      border-color: #000033; }\r\n  .digg_pagination .page_info {\r\n    background: #2e6ab1;\r\n    color: white;\r\n    padding: 0.4em 0.6em;\r\n    width: 22em;\r\n    margin-bottom: 0.3em;\r\n    text-align: center; }\r\n    .digg_pagination .page_info b {\r\n      color: #000033;\r\n      background: #6aa6ed;\r\n      padding: 0.1em 0.25em; }\r\n  .digg_pagination:after {\r\n    content: \".\";\r\n    display: block;\r\n    height: 0;\r\n    clear: both;\r\n    visibility: hidden; }\r\n  * html .digg_pagination {\r\n    height: 1%; }\r\n  *:first-child + html .digg_pagination {\r\n    overflow: hidden; }\r\n\r\n.apple_pagination {\r\n  background: #f1f1f1;\r\n  border: 1px solid #e5e5e5;\r\n  text-align: center;\r\n  padding: 1em;\r\n  cursor: default; }\r\n  .apple_pagination a, .apple_pagination span {\r\n    padding: 0.2em 0.3em; }\r\n  .apple_pagination .disabled {\r\n    color: #aaaaaa; }\r\n  .apple_pagination .current {\r\n    font-style: normal;\r\n    font-weight: bold;\r\n    background-color: #bebebe;\r\n    display: inline-block;\r\n    width: 1.4em;\r\n    height: 1.4em;\r\n    line-height: 1.5;\r\n    -moz-border-radius: 1em;\r\n    -webkit-border-radius: 1em;\r\n    border-radius: 1em;\r\n    text-shadow: rgba(255, 255, 255, 0.8) 1px 1px 1px; }\r\n  .apple_pagination a {\r\n    text-decoration: none;\r\n    color: black; }\r\n    .apple_pagination a:hover, .apple_pagination a:focus {\r\n      text-decoration: underline; }\r\n\r\n.flickr_pagination {\r\n  text-align: center;\r\n  padding: 0.3em;\r\n  cursor: default; }\r\n  .flickr_pagination a, .flickr_pagination span, .flickr_pagination em {\r\n    padding: 0.2em 0.5em; }\r\n  .flickr_pagination .disabled {\r\n    color: #aaaaaa; }\r\n  .flickr_pagination .current {\r\n    font-style: normal;\r\n    font-weight: bold;\r\n    color: #ff0084; }\r\n  .flickr_pagination a {\r\n    border: 1px solid #dddddd;\r\n    color: #0063dc;\r\n    text-decoration: none; }\r\n    .flickr_pagination a:hover, .flickr_pagination a:focus {\r\n      border-color: #003366;\r\n      background: #0063dc;\r\n      color: white; }\r\n  .flickr_pagination .page_info {\r\n    color: #aaaaaa;\r\n    padding-top: 0.8em; }\r\n  .flickr_pagination .previous_page, .flickr_pagination .next_page {\r\n    border-width: 2px; }\r\n  .flickr_pagination .previous_page {\r\n    margin-right: 1em; }\r\n  .flickr_pagination .next_page {\r\n    margin-left: 1em; }\r\n```\r\n\r\nChange the tasks index page as follows:\r\n\r\n```rhtml\r\n<div class=\"apple_pagination\">\r\n  <div class=\"page_info\">\r\n    <%= page_entries_info @tasks %>\r\n  </div>\r\n  <%= will_paginate @tasks, :container => false %>\r\n</div>\r\n```\r\n\r\nYou can change the look and feel of the pagination by changing the class to the classes defined in the application.css for flickr, apple or digg. \r\n\r\n## Summary\r\n\r\nIn this article, you learned how to use `will_paginate` gem to paginate ActiveRecord objects in Rails 5. You also learned how to customize the look and feel of the pagination.','2016-03-30 03:32:12','2017-02-01 06:36:10'),(3481,'Pagination using Kaminari in Rails 5','## Steps\r\n\r\n### Step 1\r\n\r\nAdd the Kaminari gem to the Gemfile:\r\n\r\n```ruby\r\ngem \'kaminari\', :git => \"git://github.com/amatsuda/kaminari.git\", :branch => \'master\'\r\n```\r\n\r\nRun bundle:\r\n\r\n```\r\nbundle\r\n```\r\n\r\n### Step 2\r\n\r\nAdd the number of tasks to be displayed per page in task model:\r\n\r\n```ruby\r\npaginates_per  5\r\n```\r\n\r\n### Step 3\r\n\r\nThe search method now needs to use Kaminari gem provided page method like this:\r\n\r\n```ruby  \r\ndef self.search(term, page)\r\n  if term\r\n    where(\'name LIKE ?\', \"%#{term}%\").order(\'id DESC\').page(current_page)\r\n  else\r\n    # note: default is all, just sorted\r\n    order(\'id DESC\').page(current_page) \r\n  end\r\nend\r\n```\r\n\r\n### Step 4\r\n\r\nAdd the paginate view helper in `tasks/index.html.erb`:\r\n\r\n```rhtml\r\n<%= paginate @tasks %>\r\n```\r\n\r\n### Step 5 \r\n\r\nYou can customize the number of links that is displayed.\r\n\r\n```rhtml\r\n<%= paginate @tasks, :left => 1, :right => 3 %>\r\n```\r\n\r\n### Step 6\r\n\r\nAnother option to customize the pagination:\r\n\r\n```rhtml\r\n<%= paginate @tasks, :outer_window => 3 %>\r\n```\r\n\r\n### Step 7\r\n\r\nYou can use custom themes. Let\'s install google theme.\r\n\r\n```\r\nrails g kaminari:views google\r\n```\r\n\r\nThe pagination now has Google look and feel. There are other themes available such as bootstrap, github etc, checkout the Kaminari home page for more details.\r\n\r\n## Summary\r\n\r\nIn this article, you learned how to paginate using Kaminari Gem in Rails 5.','2016-03-30 03:40:47','2016-03-30 03:41:37'),(3491,'Update Through Checkboxes in Rails 5','## Steps\r\n\r\n### Step 1\r\n\r\nThe tasks index page displays a list of incomplete tasks and complete tasks. The `tasks/index.html.erb` looks like this:\r\n\r\n```rhtml\r\n<h1>Incomplete Tasks</h1>\r\n<ul>\r\n<% for task in @incomplete_tasks %>\r\n  <li>\r\n	<%= task.name %>\r\n  </li>\r\n<% end %>\r\n</ul>\r\n\r\n<h1>Complete Tasks</h1>\r\n<ul>\r\n<% for task in @complete_tasks %>\r\n  <li> \r\n	  <%= task.name %> \r\n  </li> \r\n<% end %>\r\n</ul>\r\n```\r\n\r\n### Step 2\r\n\r\nThe task model has the incomplete and complete class methods.\r\n\r\n```ruby\r\ndef self.incomplete\r\n  where(complete: false).order(\'id DESC\')\r\nend\r\n\r\ndef self.complete\r\n  where(complete: true).order(\'id DESC\')\r\nend  \r\n```\r\n\r\n### Step 3\r\n\r\nThe tasks controller index action looks like this:\r\n\r\n```ruby\r\ndef index\r\n  @incomplete_tasks = Task.incomplete\r\n  @complete_tasks = Task.complete\r\nend\r\n```\r\n\r\n### Step 4\r\n\r\nDefine the routes for completing a task.\r\n\r\n```ruby\r\nput \'complete_task\', to: \'tasks#complete\', as: :complete_tasks  \r\n```\r\n\r\n### Step 5\r\n\r\nDiplay a checkbox next to the task for marking a task as completed.\r\n\r\n```rhtml\r\n<h1>Incomplete Tasks</h1>\r\n<%= form_tag(complete_tasks_path, method: :put)  do %> \r\n  <% for task in @incomplete_tasks %> \r\n	<ul>\r\n	  <li>\r\n		<%= check_box_tag \'task_id\', task.id %>  \r\n		<%= task.name %>   \r\n	  </li>\r\n	</ul>\r\n  <% end %>\r\n  <%= submit_tag \'Mark as Complete\' %>\r\n<% end %>\r\n\r\n<h1>Complete Tasks</h1>\r\n<ul>\r\n<% for task in @complete_tasks %>\r\n  <li> \r\n	  <%= task.name %> \r\n  </li> \r\n<% end %>\r\n</ul>\r\n```\r\n\r\n### Step 6\r\n\r\nWhen you select multiple tasks and submit, you see in the log file that there is only one task_id that is sent to the server.\r\n\r\n```\r\nStarted PUT \"/complete_task\" for ::1 at 2016-03-29 20:14:18 -0700\r\nProcessing by TasksController#complete as HTML\r\nParameters: {\"authenticity_token\"=>\"RSkjkmC\", \"task_id\"=>\"18\", \"commit\"=>\"Mark as Complete\"}\r\nRedirected to http://localhost:3000/tasks\r\nCompleted 302 Found in 19ms (ActiveRecord: 0.0ms)\r\n```\r\n\r\n### Step 7\r\n\r\nView the page source. You see that the name of all the checkboxes is the same (task_id).\r\n\r\n```html\r\n<ul>\r\n  <li>\r\n	<input type=\"checkbox\" name=\"task_id\" id=\"task_id\" value=\"19\" />  \r\n	june puppy mama   \r\n  </li>\r\n</ul>\r\n<ul>\r\n  <li>\r\n	<input type=\"checkbox\" name=\"task_id\" id=\"task_id\" value=\"18\" />  \r\n	june puppy dog   \r\n  </li>\r\n</ul>\r\n<ul>\r\n  <li>\r\n	<input type=\"checkbox\" name=\"task_id\" id=\"task_id\" value=\"17\" />  \r\n	june puppy sis   \r\n  </li>\r\n</ul>\r\n```\r\n\r\nThis is the reason why all the id of the selected tasks is not sent to the server.\r\n\r\n### Step 8\r\n\r\nChange the name of the checkbox tag to `task_id[]`.\r\n\r\n```rhtml\r\n<%= check_box_tag \'task_id[]\', task.id %>  \r\n```\r\n\r\n### Step 9\r\n\r\nView the page source, you will see that all the checkboxes now have the name `task_id[]`.\r\n\r\n```html\r\n<ul>\r\n  <li>\r\n	<input type=\"checkbox\" name=\"task_id[]\" id=\"task_id_\" value=\"19\" />  \r\n	june puppy mama   \r\n  </li>\r\n</ul>\r\n<ul>\r\n  <li>\r\n	<input type=\"checkbox\" name=\"task_id[]\" id=\"task_id_\" value=\"18\" />  \r\n	june puppy dog   \r\n  </li>\r\n</ul>\r\n<ul>\r\n```\r\n	\r\n### Step 10\r\n\r\nSelect multiple tasks and submit the form. You can now see an array of task ids sent to the server in the log file.\r\n\r\n```\r\nStarted PUT \"/complete_task\" for ::1 at 2016-03-29 20:46:26 -0700\r\nProcessing by TasksController#complete as HTML\r\n  Parameters: {\"authenticity_token\"=>\"khNu5iLd\", \"task_id\"=>[\"19\", \"18\"], \"commit\"=>\"Mark as Complete\"}\r\nRedirected to http://localhost:3000/tasks\r\nCompleted 302 Found in 20ms (ActiveRecord: 0.0ms)\r\n```\r\n\r\n### Step 11\r\n\r\nWe can now implement the complete task in the tasks controller.\r\n\r\n```ruby\r\ndef complete\r\n  Task.where(id: params[:task_id]).update_all(complete: true)\r\n  \r\n  redirect_to tasks_path  \r\nend\r\n```\r\n\r\n### Step 12\r\n\r\nYou can see the generated SQL query that updates all the tasks and marks them as complete.\r\n\r\n```\r\nStarted PUT \"/complete_task\" for ::1 at 2016-03-29 20:01:29 -0700\r\nProcessing by TasksController#complete as HTML\r\n  Parameters: { \"authenticity_token\"=>\"3qn\", \"task_id\"=>[\"13\", \"11\"], \"commit\"=>\"Mark as Complete\"}\r\n  SQL (1.0ms)  UPDATE \"tasks\" SET \"complete\" = \'t\' WHERE \"tasks\".\"id\" IN (13, 11)\r\nRedirected to http://localhost:3000/tasks\r\nCompleted 302 Found in 21ms (ActiveRecord: 1.0ms)\r\n```\r\n\r\n## Summary\r\n\r\nIn this article, you learned how to use check boxes to select multiple items and save them in the database in Rails 5.','2016-03-30 03:46:13','2016-03-30 03:46:13'),(3501,'Create Model Through Text Field in Rails 5','## Steps\r\n### Step 1\r\n\r\nCreate a new Rails 5 project.\r\n\r\n```\r\nrails new shopi\r\n```\r\n\r\n### Step 2\r\n\r\nGenerate the product model with name, price and `category_id` fields.\r\n\r\n```\r\nrails g model product name price:decimal category:references\r\n```\r\n\r\nThe generated migration file looks like this:\r\n\r\n```ruby\r\nclass CreateProducts < ActiveRecord::Migration[5.0]\r\n  def change\r\n    create_table :products do |t|\r\n      t.string :name\r\n      t.decimal :price\r\n      t.references :category, foreign_key: true\r\n\r\n      t.timestamps\r\n    end\r\n  end\r\nend\r\n```\r\n\r\nRails 5 automatically creates the index for `category_id` foreign key. You can see it in the schema.rb file:\r\n\r\n```\r\nadd_index \"products\", [\"category_id\"], name: \"index_products_on_category_id\"\r\n```\r\n\r\n### Step 3\r\n\r\nCreate a category model with name field.\r\n\r\n```\r\nrails g model category name\r\n```\r\n\r\nThe generated migration file looks like this:\r\n\r\n```ruby\r\nclass CreateCategories < ActiveRecord::Migration[5.0]\r\n  def change\r\n    create_table :categories do |t|\r\n      t.string :name\r\n\r\n      t.timestamps\r\n    end\r\n  end\r\nend\r\n```\r\n\r\nMigrate the database.\r\n\r\n```\r\nrails db:migrate\r\n```\r\n\r\n### Step 4\r\n\r\nCreate a products controller with index and new actions.\r\n\r\n```\r\nrails g controller products index new\r\n```\r\n\r\n### Step 5\r\n\r\nDefine the product resource in routes.rb.\r\n\r\n```ruby\r\nresources :products\r\n```\r\n  \r\n### Step 6\r\n\r\nDeclare the `belongs_to` association in the product model.\r\n\r\n```ruby\r\nclass Product < ApplicationRecord\r\n  belongs_to :category\r\nend\r\n```\r\n\r\n### Step 7\r\n\r\nThe `products/_form.html.erb` looks like this:\r\n\r\n```rhtml\r\n<%= form_for(product) do |f| %>\r\n  <% if product.errors.any? %>\r\n    <div id=\"error_explanation\">\r\n      <h2><%= pluralize(product.errors.count, \"error\") %> prohibited this product from being saved:</h2>\r\n      <ul>\r\n      <% product.errors.full_messages.each do |message| %>\r\n        <li><%= message %></li>\r\n      <% end %>\r\n      </ul>\r\n    </div>\r\n  <% end %>\r\n  <div class=\"field\">\r\n    <%= f.label :name %>\r\n    <%= f.text_field :name %>\r\n  </div>\r\n  <div class=\"field\">\r\n    <%= f.label :price %>\r\n    <%= f.text_field :price %>\r\n  </div>\r\n  <p>\r\n    <label for=\"product_category_id\">Category:</label><br />\r\n    <%= f.collection_select :category_id, Category.all, :id, :name, :prompt => \"Select a Category\" %>\r\n    or create one:\r\n    <%= f.text_field :new_category_name %>\r\n  </p>\r\n  <div class=\"actions\">\r\n    <%= f.submit %>\r\n  </div>\r\n<% end %>\r\n```\r\n\r\n### Step 8\r\n\r\nThe `index.html.erb` looks like this:\r\n\r\n```rhtml\r\n<h1>Products</h1>\r\n<table>\r\n  <thead>\r\n    <tr>\r\n      <th>Name</th>\r\n      <th>Price</th>\r\n      <th colspan=\"3\"></th>\r\n    </tr>\r\n  </thead>\r\n  <tbody>\r\n    <% @products.each do |product| %>\r\n      <tr>\r\n        <td><%= product.name %></td>\r\n        <td><%= product.price %></td>\r\n        <td><%= link_to \'Show\', product %></td>\r\n        <td><%= link_to \'Edit\', edit_product_path(product) %></td>\r\n        <td><%= link_to \'Destroy\', product, method: :delete, data: { confirm: \'Are you sure?\' } %></td>\r\n      </tr>\r\n    <% end %>\r\n  </tbody>\r\n</table>\r\n<%= link_to \'New Product\', new_product_path %>\r\n```\r\n\r\n### Step 9\r\n\r\nThe `new.html.erb` looks like this:\r\n\r\n```rhtml\r\n<h1>New Product</h1>\r\n<%= render \'form\', product: @product %>\r\n<%= link_to \'Back\', products_path %>\r\n```\r\n\r\n### Step 10\r\n\r\nThe products controller index action retrieves all the products in the database.\r\n\r\n```ruby\r\ndef index\r\n  @products = Product.all\r\nend\r\n```\r\n\r\n### Step 11\r\n\r\nLet\'s create some sample data in seeds.rb:\r\n\r\n```ruby\r\nclothes = Category.create(name: \'Clothes\')\r\nfurniture = Category.create(name: \'Furniture\')\r\ngroceries = Category.create(name: \'Groceries\')\r\nelectronics = Category.create(name: \'Electronics\')\r\n\r\nrug = Product.new(name: \'rug\', price: 100)\r\nrug.category = clothes\r\nrug.save\r\nbowl = Product.new(name: \'bowl\', price: 20.95)\r\nbowl.category = furniture\r\nbowl.save\r\npillow = Product.new(name: \'pillow\', price: 90)\r\npillow.category = clothes\r\npillow.save\r\nlight = Product.new(name: \'light\', price: 10.95)\r\nlight.category = electronics\r\nlight.save\r\n```\r\n\r\nPopulate the database.\r\n\r\n```\r\nrails db:seed\r\n```\r\n\r\n### Step 12\r\n\r\nCreate the product object in products controller new action.\r\n\r\n```ruby\r\ndef new\r\n  @product = Product.new\r\nend\r\n```\r\n\r\n### Step 13\r\n\r\nBrowse to products index page. Click new product. You will get the error:\r\n\r\n```\r\nundefined method `new_category_name\' for #<Product:0x007f9f4a113730>\r\n```\r\n\r\n### Step 14\r\n\r\nThe product form partial has a text field for `new_category_name`. We need to define a virtual attribute in the product model.\r\n\r\n```ruby\r\nattr_accessor :new_category_name\r\n```\r\n\r\n### Step 15\r\n\r\nImplement the products controller create action.\r\n\r\n```ruby\r\ndef create\r\n  @product = Product.new(product_params)\r\n\r\n  if @product.save\r\n    redirect_to @product, notice: \'Product was successfully created.\'\r\n  else\r\n    render :new\r\n  end\r\nend\r\n```\r\n  \r\n### Step 16\r\n\r\nWe also need to permit the `category_id` to be submitted to the server.\r\n\r\n```ruby\r\ndef product_params\r\n  params.require(:product).permit(:name, :price, :category_id)\r\nend\r\n```\r\n\r\n### Step 17\r\n\r\nThe products show page looks like this:\r\n\r\n```rhtml\r\n<p>\r\n  <strong>Name:</strong>\r\n  <%= @product.name %>\r\n</p>\r\n<p>\r\n  <strong>Price:</strong>\r\n  <%= @product.price %>\r\n</p>\r\n<%= link_to \'Edit\', edit_product_path(@product) %> |\r\n<%= link_to \'Back\', products_path %>\r\n```\r\n\r\n### Step 18\r\n\r\nCreate a product with the existing category in the dropdown. It will work.\r\n\r\n### Step 19\r\n\r\nEnter a value for new category text field and click Create. You will get the error:\r\n\r\n```\r\nCategory must exist\r\n```\r\n\r\n### Step 20\r\n\r\nRails 5 has changed the default value for `belongs_to` category to true. We can change it to false like this:\r\n\r\n```ruby\r\nbelongs_to :category, required: false\r\n```\r\n\r\n### Step 21\r\n\r\nDefine a `before_save` call back that will create the category before the product is saved in the database.\r\n\r\n```ruby\r\nclass Product < ApplicationRecord\r\n  belongs_to :category, required: false\r\n  attr_accessor :new_category_name\r\n  before_save :create_category_from_name\r\n  \r\n  def create_category_from_name\r\n    create_category(name: new_category_name) unless new_category_name.blank?\r\n  end\r\nend\r\n```\r\n\r\nWe don\'t want to create a new category if the user selects a category from the dropdown menu. So we have conditional to check the text field for new category is not blank. Where did the `create_category` come from?\r\n\r\n### Step 22\r\n\r\nYou can check the available methods that begins with creat in the rails console.\r\n\r\n```\r\n > product = Product.last\r\n > product.category.methods.grep(/creat/)\r\n => [:created_at, :created_at=, :created_at_before_type_cast, :created_at_came_from_user?, :created_at?, :created_at_changed?, :created_at_change, :created_at_will_change!, :created_at_was, :created_at_previously_changed?, :created_at_previous_change, :restore_created_at!, :_create_callbacks, :_run_create_callbacks, :_create_callbacks?, :create_or_update, :arel_attributes_with_values_for_create] \r\n```\r\n\r\nWe don\'t see `create_category` in this list. The `create_category` is available due to the `belongs_to` association. Since it is implemented using meta-programming, it is hidden and we cannot see it.\r\n\r\n### Step 23\r\n\r\nWe need to allow `new_category_name` to be submitted to the server.\r\n\r\n```ruby\r\ndef product_params\r\n  params.require(:product).permit(:name, :price, :category_id, :new_category_name)\r\nend\r\n```\r\n\r\n### Step 24\r\n\r\nYou can now create a new product with a new category entry in the text field.\r\n\r\n### Step 25\r\n\r\nThe product show page can now display the product category.\r\n\r\n```rhtml\r\n<p>\r\n  <strong>Name:</strong>\r\n  <%= @product.name %>\r\n</p>\r\n<p>\r\n  <strong>Price:</strong>\r\n  <%= @product.price %>\r\n</p>\r\n<p>\r\n	In Category: <%= @product.category.name %>\r\n</p>\r\n<%= link_to \'Edit\', edit_product_path(@product) %> |\r\n<%= link_to \'Back\', products_path %>\r\n```\r\n\r\n## Summary\r\n\r\nIn this article, you learned how to create model through text field in Rails 5.\r\n\r\n## Reference\r\n\r\n[belongs_to should default to required: true](https://github.com/rails/rails/issues/18233 \'belongs_to should default to required: true\')','2016-03-31 03:04:15','2016-03-31 03:04:15'),(3511,'Using rails_best_practices gem in Rails 5','## Steps\r\n### Step 1\r\n\r\nIn Gemfile development group, add the `rails_best_practices` gem:\r\n\r\n```ruby\r\ngroup :development do\r\n  gem \'sqlite3\'\r\n  gem \'quiet_assets\'\r\n  gem \'thin\'\r\n  gem \'rails_best_practices\'\r\nend\r\n```\r\n\r\n### Step 2\r\n\r\n```\r\nrails_best_practices .\r\n```\r\n\r\n### Step 3\r\n\r\nAdd index to an existing column.\r\n\r\n```ruby\r\nclass AddIndexToPayments < ActiveRecord::Migration\r\n  def change\r\n    add_index :payments, :customer_id\r\n    add_index :payments, :product_id\r\n  end\r\nend\r\n```\r\n\r\n**Tip**: Do not follow the `rails_best_practices` suggestion that says : Remove unused variable for form_for(@article). The reason is that when you use form partial to render a blank form and the form to edit, we need to instantiate an empty form for creating new record and load the existing record for editing. So, eventhough the variable is not used Rails uses the fact whether it is in database or not to distinguish between new and edit.\r\n\r\nWhat happens to the old data after creating an index on a foreign column in MySQL ? Anyone?','2016-03-31 04:18:24','2016-03-31 04:19:43'),(3521,'How to Benchmark Your Code using benchmark-ips Gem','In this article, you will see how easy it is to start benchmarking your code. The Ruby version used is 2.3.0. First, install the benchmark-ips gem.\r\n\r\n```\r\ngem install benchmark-ips\r\n```\r\n\r\nThe advantage of using this gem is that you don\'t need to guess the iteration number to benchmark your code. The gem automatically figures out the iteration number to use.\r\n\r\n## Dynamically Sending a Message to an Object\r\n\r\nLet\'s compare sending message to an object using `send` vs using implicit send to execute code.\r\n\r\n```ruby\r\nrequire \'benchmark/ips\'\r\n \r\nBenchmark.ips do |x|\r\n  x.report(\'addition\') { 1 + 2 }\r\n  x.report(\'addition with send\') { 1.send(:+, 2) }\r\n  x.compare!\r\nend\r\n```\r\n\r\nRun the benchmark.\r\n\r\n```\r\n$ ruby add.rb\r\n```\r\n\r\nHere is the performance results.\r\n\r\n```\r\nWarming up --------------------------------------\r\n            addition   171.062k i/100ms\r\n  addition with send   159.831k i/100ms\r\nCalculating -------------------------------------\r\n            addition     12.818M (± 2.5%) i/s -     64.148M\r\n  addition with send      8.173M (± 2.1%) i/s -     40.917M\r\n\r\nComparison:\r\n            addition: 12817978.9 i/s\r\n  addition with send:  8173109.1 i/s - 1.57x slower\r\n```\r\n\r\nYou can see using `send` is 1.57 times slower.\r\n\r\n## String Concatenation\r\n\r\nLet\'s compare concatenating string using +=, << and concat.\r\n\r\n```ruby\r\nrequire \'benchmark/ips\'\r\n \r\nBenchmark.ips do |x|\r\n  x.report(\'concat with +=\') do\r\n    s = \'bat\'\r\n	s += \'mat\'\r\n  end\r\n  x.report(\'concat with <<\') do\r\n    s = \'bat\'\r\n    s << \'mat\'\r\n  end\r\n  x.report(\'concat with concat\') do\r\n    s = \'bat\'\r\n    s.concat(\'mat\')\r\n  end\r\n  \r\n  x.compare!\r\nend\r\n```\r\n\r\nRun the benchmark.\r\n\r\n```\r\nruby concat.rb\r\n```\r\n\r\nHere is the performance results.\r\n\r\n```\r\nruby concat.rb\r\nWarming up --------------------------------------\r\n      concat with +=   143.335k i/100ms\r\n      concat with <<   147.118k i/100ms\r\n  concat with concat   142.974k i/100ms\r\nCalculating -------------------------------------\r\n      concat with +=      5.502M (± 1.6%) i/s -     27.520M\r\n      concat with <<      5.678M (± 1.1%) i/s -     28.394M\r\n  concat with concat      5.283M (± 2.8%) i/s -     26.450M\r\n\r\nComparison:\r\n      concat with <<:  5678462.1 i/s\r\n      concat with +=:  5502116.5 i/s - 1.03x slower\r\n  concat with concat:  5283407.1 i/s - 1.07x slower\r\n```\r\n\r\nYou can see << has the best performance. The += is 1.03 times slower than <<. The concat method is 1.07x times slower than <<. So we should prefer << over += or concat. Remember that anything that creates lot of objects will be slower. In this case, += creates new object everytime it concatenates a string to an existing object.\r\n\r\n## Parallel Assignment\r\n\r\nLet\'s now compare parallel assignment with sequential assignment.\r\n\r\n```ruby\r\nrequire \'benchmark/ips\'\r\n \r\nBenchmark.ips do |x|\r\n  x.report(\'parallel\') do\r\n    a, b = 10, 20\r\n  end\r\n  \r\n  x.report(\'sequential\') do\r\n    a = 10\r\n	b = 20\r\n  end\r\n  \r\n  x.compare!\r\nend\r\n```\r\n\r\nRun the benchmark.\r\n\r\n```\r\n$ ruby assignment.rb \r\n```\r\n\r\nHere is the performance results.\r\n\r\n```\r\nWarming up --------------------------------------\r\n            parallel   163.915k i/100ms\r\n          sequential   172.552k i/100ms\r\nCalculating -------------------------------------\r\n            parallel      9.089M (± 3.5%) i/s -     45.404M\r\n          sequential     12.342M (± 3.4%) i/s -     61.774M\r\n\r\nComparison:\r\n          sequential: 12341542.5 i/s\r\n            parallel:  9088599.9 i/s - 1.36x slower\r\n```\r\n\r\nThe parallel assignment is 1.36 times slower.\r\n\r\n## Summary\r\n\r\nIn this article, you learned how to use benchmark-ips gem to benchmark your code. It is a lot easier to interpret the results when you use benchmark-ips gem. \r\n\r\n## Reference\r\n\r\n[benchmark-ips](https://github.com/evanphx/benchmark-ips \'benchmark-ips\')','2016-04-01 02:57:22','2016-04-01 02:57:22'),(3531,'Handling Exceptions in Rails 5','## Steps\r\n### Step 1\r\n\r\nBrowsing to a non-existing task `http://localhost:3000/tasks/100` throws a stack trace when ActiveRecord::RecordNotFound exception is raised. This is the behavior in development environment.\r\n\r\n### Step 2\r\n\r\nIn development.rb, you can see:\r\n\r\n```ruby\r\n# Show full error reports.\r\nconfig.consider_all_requests_local = true\r\n```\r\n\r\nThis flag is the reason why the stack trace is shown in the browser.\r\n\r\n### Step 3\r\n\r\nStart the Rails app in production mode.\r\n\r\n```\r\nRAILS_ENV=production rails s\r\n```\r\n\r\nHit the URL with task id that does not exist in the database: `http://localhost:3001/tasks/100`. You will see an error page in the browser:\r\n\r\n```\r\nAn unhandled lowlevel error occurred. The application logs may have details.\r\n```\r\n\r\nIn the log file:\r\n\r\n```\r\nRack app error: #<RuntimeError: Missing `secret_key_base` for \'production\' environment, set this value in `config/secrets.yml`>\r\n```\r\n\r\nNote that there is no stack trace shown in the browser in production mode.\r\n\r\n### Step 4\r\n\r\n```\r\nexport SECRET_KEY_BASE=\'secret\'\r\n```\r\n\r\nGo to task show page for a task id that does not exist. You will see an error in the browser:\r\n\r\n```\r\nWe\'re sorry, but something went wrong.\r\nIf you are the application owner check the logs for more information.\r\n```\r\n\r\nThe user does not see any stack trace for any errors that occurs in production.\r\n\r\n### Step 5\r\n\r\nWe can render 404 by customizing the exception handling. Add the following code to application controller.\r\n\r\n```ruby\r\nrescue_from ActiveRecord::RecordNotFound, with: :not_found_error\r\n\r\nprotected\r\n\r\ndef not_found_error\r\n  render plain: \'404 Not Found\', status: :not_found\r\nend\r\n```\r\n\r\n### Step 6\r\n\r\nBy default, 500.html is displayed in production and `404 Not Found` in development. If you change the implementation for `not_found_error` to following:\r\n\r\n```ruby\r\nrender file: \'public/401\', status: :not_found\r\n```\r\n	\r\nIt does not work in development.\r\n\r\n### Step 7\r\n\r\nLet\'s change the implementation of `not_found_error` to:\r\n\r\n```ruby\r\nrender nothing: true, status: :unauthorized\r\n```\r\n\r\nThis results in deprecation warning.\r\n\r\n```\r\nDEPRECATION WARNING: `:nothing` option is deprecated and will be removed in Rails 5.1. Use `head` method to respond with empty response body. (called from not_found_error at /Users/bparanj/projects/blog5/app/controllers/application_controller.rb:11)\r\n  Rendered text template (0.0ms)\r\nCompleted 401 Unauthorized in 11ms (Views: 1.9ms | ActiveRecord: 0.8ms)\r\n```\r\n\r\nThe `render nothing: true` has been deprecated in Rails 5. The alternative is to use:\r\n\r\n```ruby\r\nhead :unauthorized\r\n```\r\n\r\nIf you access a non-existent task, you will get unauthorized status code in the log file.\r\n\r\n```\r\nStarted GET \"/tasks/100\" for ::1 at 2016-03-30 21:01:12 -0700\r\nProcessing by TasksController#show as HTML\r\n  Parameters: {\"id\"=>\"100\"}\r\n  Task Load (0.1ms)  SELECT  \"tasks\".* FROM \"tasks\" WHERE \"tasks\".\"id\" = ? LIMIT ?  [[\"id\", 100], [\"LIMIT\", 1]]\r\nCompleted 401 Unauthorized in 8ms (ActiveRecord: 0.7ms)\r\n```\r\n\r\nThe render file call:\r\n\r\n```ruby\r\nrender file: \'public/401.html\', status: :not_found\r\n```\r\n\r\ndoes not work. **Note**:\r\n\r\n\r\n```ruby\r\nconsider_all_requests_local = true\r\n```\r\n\r\nmeans the stack trace will be displayed on the browser.\r\n\r\n**Note**:\r\n\r\nThe last version of Rails that had `rescue_action_in_public` is 2.3.8. It is no longer available in Rails 5.\r\n\r\n## Summary\r\n\r\nIn this article, you learned how to handle exceptions by defining your own exception handlers in Rails 5.','2016-04-01 03:01:50','2016-04-01 03:01:50'),(3541,'Rails 5 ActiveRecord Troubleshooting and Learning Tool','In this article, you will learn how to quickly create test cases to reproduce problems. This is very useful when you want to isolate problems due to gem versions. This can save you lot of time when you run into issues after upgrading Rails. We will use the Rails bug report template as the base for creating our test case template. Instead of running the tests we will fire up an IRB console to experiment with the code. This script can also be used to teach and learn Rails. The script is based on [How to Contribute to Rails Guides](http://guides.rubyonrails.org/contributing_to_ruby_on_rails.html \'How to Contribute to Rails Guides\'). Here is the ActiveRecord bug template stolen from the Rails Guides:\r\n\r\n```ruby\r\nbegin\r\n  require \'bundler/inline\'\r\nrescue LoadError => e\r\n  $stderr.puts \'Bundler version 1.10 or later is required. Please update your Bundler\'\r\n  raise e\r\nend\r\n\r\ngemfile(true) do\r\n  source \'https://rubygems.org\'\r\n  # Activate the gem you are reporting the issue against.\r\n  gem \'activerecord\', \'5.0.0.beta3\'\r\n  gem \'sqlite3\'\r\nend\r\n\r\nrequire \'active_record\'\r\nrequire \'minitest/autorun\'\r\nrequire \'logger\'\r\n\r\n# Ensure backward compatibility with Minitest 4\r\nMinitest::Test = MiniTest::Unit::TestCase unless defined?(Minitest::Test)\r\n\r\n# This connection will do for database-independent bug reports.\r\nActiveRecord::Base.establish_connection(adapter: \'sqlite3\', database: \':memory:\')\r\nActiveRecord::Base.logger = Logger.new(STDOUT)\r\n\r\nActiveRecord::Schema.define do\r\n  create_table :posts, force: true do |t|\r\n  end\r\n\r\n  create_table :comments, force: true do |t|\r\n    t.integer :post_id\r\n  end\r\nend\r\n\r\nclass Post < ActiveRecord::Base\r\n  has_many :comments\r\nend\r\n\r\nclass Comment < ActiveRecord::Base\r\n  belongs_to :post\r\nend\r\n\r\nclass BugTest < Minitest::Test\r\n  def test_association_stuff\r\n    post = Post.create!\r\n    post.comments << Comment.create!\r\n\r\n    assert_equal 1, post.comments.count\r\n    assert_equal 1, Comment.count\r\n    assert_equal post.id, Comment.first.post.id\r\n  end\r\nend\r\n```\r\n\r\nRun the script.\r\n\r\n```\r\nruby ar_template.rb\r\n```\r\n\r\nHere is the output:\r\n\r\n```\r\nResolving dependencies...\r\nUsing concurrent-ruby 1.0.1\r\nUsing i18n 0.7.0\r\nUsing minitest 5.8.4\r\nUsing thread_safe 0.3.5\r\nUsing arel 7.0.0\r\nUsing sqlite3 1.3.11\r\nUsing bundler 1.11.2\r\nUsing tzinfo 1.2.2\r\nUsing activesupport 5.0.0.beta3\r\nUsing activemodel 5.0.0.beta3\r\nUsing activerecord 5.0.0.beta3\r\n-- create_table(:posts, {:force=>true})\r\nD, [2016-03-31T21:24:06 #38315] DEBUG - :  (1.0ms)  CREATE TABLE \"posts\" (\"id\" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL) \r\n   -> 0.0446s\r\n-- create_table(:comments, {:force=>true})\r\nD, [2016-03-31T21:24:06 #38315] DEBUG - :  (0.1ms)  CREATE TABLE \"comments\" (\"id\" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, \"post_id\" integer) \r\n   -> 0.0006s\r\nD, [2016-03-31T21:24:06 #38315] DEBUG - :  (0.1ms)  CREATE TABLE \"ar_internal_metadata\" (\"key\" varchar PRIMARY KEY, \"value\" varchar, \"created_at\" datetime NOT NULL, \"updated_at\" datetime NOT NULL) \r\nD, [2016-03-31T21:24:06 #38315] DEBUG - :  ActiveRecord::InternalMetadata Load (0.2ms)  SELECT  \"ar_internal_metadata\".* FROM \"ar_internal_metadata\" ORDER BY \"ar_internal_metadata\".\"key\" ASC LIMIT ?  [[\"LIMIT\", 1]]\r\nD, [2016-03-31T21:24:06 #38315] DEBUG - :  (0.0ms)  begin transaction\r\nD, [2016-03-31T21:24:06 #38315] DEBUG - :  SQL (0.1ms)  INSERT INTO \"ar_internal_metadata\" (\"key\", \"value\", \"created_at\", \"updated_at\") VALUES (?, ?, ?, ?)  [[\"key\", \"environment\"], [\"value\", \"default_env\"], [\"created_at\", 2016-03-31 21:24:06 UTC], [\"updated_at\", 2016-03-31 21:24:06 UTC]]\r\nD, [2016-03-31T21:24:06 #38315] DEBUG - :  (0.0ms)  commit transaction\r\nRun options: --seed 14885\r\n\r\n# Running:\r\n\r\nD, [2016-03-31T21:24:06 #38315] DEBUG - :  (0.0ms)  begin transaction\r\nD, [2016-03-31T21:24:06 #38315] DEBUG - : SQL (0.1ms)  INSERT INTO \"posts\" DEFAULT VALUES\r\nD, [2016-03-31T21:24:06 #38315] DEBUG - :  (0.0ms)  commit transaction\r\nD, [2016-03-31T21:24:06 #38315] DEBUG - :  (0.0ms)  begin transaction\r\nD, [2016-03-31T21:24:06 #38315] DEBUG - : SQL (0.0ms)  INSERT INTO \"comments\" DEFAULT VALUES\r\nD, [2016-03-31T21:24:06 #38315] DEBUG - :  (0.0ms)  commit transaction\r\nD, [2016-03-31T21:24:06 #38315] DEBUG - :  (0.0ms)  begin transaction\r\nD, [2016-03-31T21:24:06 #38315] DEBUG - : SQL (0.1ms)  UPDATE \"comments\" SET \"post_id\" = ? WHERE \"comments\".\"id\" = ?  [[\"post_id\", 1], [\"id\", 1]]\r\nD, [2016-03-31T21:24:06 #38315] DEBUG - :  (0.0ms)  commit transaction\r\nD, [2016-03-31T21:24:06 #38315] DEBUG - :  (0.1ms)  SELECT COUNT(*) FROM \"comments\" WHERE \"comments\".\"post_id\" = ?  [[\"post_id\", 1]]\r\nD, [2016-03-31T21:24:06 #38315] DEBUG - :  (0.0ms)  SELECT COUNT(*) FROM \"comments\"\r\nD, [2016-03-31T21:24:06 #38315] DEBUG - : Comment Load (0.1ms)  SELECT  \"comments\".* FROM \"comments\" ORDER BY \"comments\".\"id\" ASC LIMIT ?  [[\"LIMIT\", 1]]\r\nD, [2016-03-31T21:24:06 #38315] DEBUG - : Post Load (0.1ms)  SELECT  \"posts\".* FROM \"posts\" WHERE \"posts\".\"id\" = ? LIMIT ?  [[\"id\", 1], [\"LIMIT\", 1]]\r\n.\r\n\r\nFinished in 0.045340s, 22.0555 runs/s, 66.1664 assertions/s.\r\n\r\n1 runs, 3 assertions, 0 failures, 0 errors, 0 skips\r\n```\r\n\r\nInstead of running a test, let\'s drop into an IRB console to experiment with the ActiveRecord API. Remove the BugTest class and add:\r\n\r\n```ruby\r\nIRB.start\r\n```\r\n\r\nto the end of the script. Run the script.\r\n\r\n```\r\n$ ruby ar_template.rb\r\n```\r\n\r\nYou can see the following output in the terminal.\r\n\r\n```\r\nResolving dependencies...\r\nUsing concurrent-ruby 1.0.1\r\nUsing i18n 0.7.0\r\nUsing minitest 5.8.4\r\nUsing thread_safe 0.3.5\r\nUsing arel 7.0.0\r\nUsing sqlite3 1.3.11\r\nUsing bundler 1.11.2\r\nUsing tzinfo 1.2.2\r\nUsing activesupport 5.0.0.beta3\r\nUsing activemodel 5.0.0.beta3\r\nUsing activerecord 5.0.0.beta3\r\n-- create_table(:posts, {:force=>true})\r\nD, [2016-03-31T21:27:09 #38616] DEBUG -:  (0.3ms)  CREATE TABLE \"posts\" (\"id\" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL) \r\n   -> 0.0194s\r\n-- create_table(:comments, {:force=>true})\r\nD, [2016-03-31T21:27:09 #38616] DEBUG - :  (0.1ms)  CREATE TABLE \"comments\" (\"id\" INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, \"post_id\" integer) \r\n   -> 0.0005s\r\nD, [2016-03-31T21:27:09 #38616] DEBUG - :  (0.1ms)  CREATE TABLE \"ar_internal_metadata\" (\"key\" varchar PRIMARY KEY, \"value\" varchar, \"created_at\" datetime NOT NULL, \"updated_at\" datetime NOT NULL) \r\nD, [2016-03-31T21:27:09 #38616] DEBUG - :  ActiveRecord::InternalMetadata Load (0.1ms)  SELECT  \"ar_internal_metadata\".* FROM \"ar_internal_metadata\" ORDER BY \"ar_internal_metadata\".\"key\" ASC LIMIT ?  [[\"LIMIT\", 1]]\r\nD, [2016-03-31T21:27:09 #38616] DEBUG - :  (0.0ms)  begin transaction\r\nD, [2016-03-31T21:27:09 #38616] DEBUG - :  SQL (0.1ms)  INSERT INTO \"ar_internal_metadata\" (\"key\", \"value\", \"created_at\", \"updated_at\") VALUES (?, ?, ?, ?)  [[\"key\", \"environment\"], [\"value\", \"default_env\"], [\"created_at\", 2016-03-31 21:27:09 UTC], [\"updated_at\", 2016-03-31 18:27:09 UTC]]\r\nD, [2016-03-31T21:27:09 #38616] DEBUG - :  (0.0ms)  commit transaction\r\n```\r\n\r\nWe are now dropped in a IRB console. We can experiment as much as we want here. Let\'s create a post.\r\n\r\n```\r\n > post = Post.create!\r\n```\r\n\r\nYou can see the generated SQL for inserting a post record.\r\n\r\n``` \r\nD, [2016-03-31T21:27:18 #38616] DEBUG - :  (0.0ms)  begin transaction\r\nD, [2016-03-31T21:27:18 #38616] DEBUG - :  SQL (0.1ms)  INSERT INTO \"posts\" DEFAULT VALUES\r\nD, [2016-03-31T21:27:18 #38616] DEBUG - :  (0.0ms)  commit transaction\r\n => #<Post id: 1> \r\n```\r\n\r\nLet\'s associate a new comment to this post.\r\n\r\n```\r\n > post.comments << Comment.create!\r\n```\r\n\r\nWe see an insert and update in the terminal output.\r\n\r\n```\r\nD, [2016-03-31T21:27:35 #38616] DEBUG - : (0.0ms)  begin transaction\r\nD, [2016-03-31T21:27:35 #38616] DEBUG - : SQL (0.0ms)  INSERT INTO \"comments\" DEFAULT VALUES\r\nD, [2016-03-31T21:27:35 #38616] DEBUG - : (0.0ms)  commit transaction\r\nD, [2016-03-31T21:27:35 #38616] DEBUG - : (0.0ms)  begin transaction\r\nD, [2016-03-31T21:27:35 #38616] DEBUG - : SQL (0.1ms)  UPDATE \"comments\" SET \"post_id\" = ? WHERE \"comments\".\"id\" = ?  [[\"post_id\", 1], [\"id\", 1]]\r\nD, [2016-03-31T21:27:35 #38616] DEBUG - : (0.0ms)  commit transaction\r\nD, [2016-03-31T21:27:35 #38616] DEBUG - : Comment Load (0.1ms)  SELECT \"comments\".* FROM \"comments\" WHERE \"comments\".\"post_id\" = ?  [[\"post_id\", 1]]\r\n => #<ActiveRecord::Associations::CollectionProxy [#<Comment id: 1, post_id: 1>]> \r\n```\r\n\r\nWe can count the comments for the post we created.\r\n\r\n```\r\n > post.comments.count\r\n```\r\n\r\nWe see the SQL query to get the count.\r\n\r\n```\r\nD, [2016-03-31T21:27:45 #38616] DEBUG - :  (0.1ms)  SELECT COUNT(*) FROM \"comments\" WHERE \"comments\".\"post_id\" = ?  [[\"post_id\", 1]]\r\n => 1\r\n```\r\n\r\nWe can count the comment.\r\n\r\n```\r\n > Comment.count\r\n```\r\n\r\nThe corresponding SQL is shown in the output.\r\n\r\n``` \r\nD, [2016-03-31T21:27:51 #38616] DEBUG - :  (0.1ms)  SELECT COUNT(*) FROM \"comments\"\r\n => 1 \r\n```\r\n\r\nWe can navigate the comment `belongs_to` post and check the id is the same as the id of the post.\r\n\r\n```\r\n > Comment.first.post.id\r\nD, [2016-03-31T21:27:59 #38616] DEBUG - : Comment Load (0.1ms)  SELECT  \"comments\".* FROM \"comments\" ORDER BY \"comments\".\"id\" ASC LIMIT ?  [[\"LIMIT\", 1]]\r\nD, [2016-03-31T21:27:59 #38616] DEBUG - : Post Load (0.1ms)  SELECT  \"posts\".* FROM \"posts\" WHERE \"posts\".\"id\" = ? LIMIT ?  [[\"id\", 1], [\"LIMIT\", 1]]\r\n => 1 \r\n > post.id\r\n => 1 \r\n```\r\n\r\nHere is the full script to run for learning or trouble shooting purposes.\r\n\r\n```ruby\r\nrequire \'irb\'\r\n\r\nbegin\r\n  require \'bundler/inline\'\r\nrescue LoadError => e\r\n  $stderr.puts \'Bundler version 1.10 or later is required. Please update your Bundler\'\r\n  raise e\r\nend\r\n\r\ngemfile(true) do\r\n  source \'https://rubygems.org\'\r\n  # Activate the gem you want to play with.\r\n  gem \'activerecord\', \'5.0.0.beta3\'\r\n  gem \'sqlite3\'\r\nend\r\n\r\nrequire \'active_record\'\r\nrequire \'logger\'\r\n\r\n# This connection will do for database-independent katas.\r\nActiveRecord::Base.establish_connection(adapter: \'sqlite3\', database: \':memory:\')\r\nActiveRecord::Base.logger = Logger.new(STDOUT)\r\n\r\nActiveRecord::Schema.define do\r\n  create_table :articles, force: true do |t|\r\n  end\r\n\r\n  create_table :comments, force: true do |t|\r\n    t.integer :article_id\r\n  end\r\nend\r\n\r\nclass Article < ActiveRecord::Base\r\n  has_many :comments\r\nend\r\n\r\nclass Comment < ActiveRecord::Base\r\n  belongs_to :article\r\nend\r\n\r\nIRB.start\r\n```\r\n\r\n## ActionController Bug Template\r\n\r\n```ruby\r\nbegin\r\n  require \'bundler/inline\'\r\nrescue LoadError => e\r\n  $stderr.puts \'Bundler version 1.10 or later is required. Please update your Bundler\'\r\n  raise e\r\nend\r\n\r\ngemfile(true) do\r\n  source \'https://rubygems.org\'\r\n  # Activate the gem you are reporting the issue against.\r\n  gem \'rails\', \'5.0.0.beta3\'\r\nend\r\n\r\nrequire \'rack/test\'\r\nrequire \'action_controller/railtie\'\r\n\r\nclass TestApp < Rails::Application\r\n  config.root = File.dirname(__FILE__)\r\n  config.session_store :cookie_store, key: \'cookie_store_key\'\r\n  secrets.secret_token    = \'secret_token\'\r\n  secrets.secret_key_base = \'secret_key_base\'\r\n\r\n  config.logger = Logger.new($stdout)\r\n  Rails.logger  = config.logger\r\n\r\n  routes.draw do\r\n    get \'/\' => \'test#index\'\r\n  end\r\nend\r\n\r\nclass TestController < ActionController::Base\r\n  include Rails.application.routes.url_helpers\r\n\r\n  def index\r\n    render plain: \'Home\'\r\n  end\r\nend\r\n\r\nrequire \'minitest/autorun\'\r\n\r\n# Ensure backward compatibility with Minitest 4\r\nMinitest::Test = MiniTest::Unit::TestCase unless defined?(Minitest::Test)\r\n\r\nclass BugTest < Minitest::Test\r\n  include Rack::Test::Methods\r\n\r\n  def test_returns_success\r\n    get \'/\'\r\n    assert last_response.ok?\r\n  end\r\n\r\n  private\r\n    def app\r\n      Rails.application\r\n    end\r\nend\r\n```\r\n\r\nRun the script.\r\n\r\n```\r\n$ ruby ac_template.rb\r\nResolving dependencies...\r\nUsing rake 11.1.2\r\nUsing concurrent-ruby 1.0.1\r\nUsing i18n 0.7.0\r\nUsing minitest 5.8.4\r\nUsing thread_safe 0.3.5\r\nUsing builder 3.2.2\r\nUsing erubis 2.7.0\r\nUsing mini_portile2 2.0.0\r\nUsing json 1.8.3\r\nUsing nio4r 1.2.1\r\nUsing websocket-extensions 0.1.2\r\nUsing mime-types-data 3.2016.0221\r\nUsing arel 7.0.0\r\nUsing bundler 1.11.2\r\nUsing method_source 0.8.2\r\nUsing thor 0.19.1\r\nUsing tzinfo 1.2.2\r\nUsing nokogiri 1.6.7.2\r\nUsing rack 2.0.0.alpha\r\nUsing websocket-driver 0.6.3\r\nUsing mime-types 3.0\r\nUsing activesupport 5.0.0.beta3\r\nUsing loofah 2.0.3\r\nUsing rack-test 0.6.3\r\nUsing sprockets 3.5.2\r\nUsing mail 2.6.4\r\nUsing rails-deprecated_sanitizer 1.0.3\r\nUsing globalid 0.3.6\r\nUsing activemodel 5.0.0.beta3\r\nUsing rails-html-sanitizer 1.0.3\r\nUsing rails-dom-testing 1.0.7\r\nUsing activejob 5.0.0.beta3\r\nUsing activerecord 5.0.0.beta3\r\nUsing actionview 5.0.0.beta3\r\nUsing actionpack 5.0.0.beta3\r\nUsing actioncable 5.0.0.beta3\r\nUsing actionmailer 5.0.0.beta3\r\nUsing railties 5.0.0.beta3\r\nUsing sprockets-rails 3.0.4\r\nUsing rails 5.0.0.beta3\r\nRun options: --seed 18277\r\n\r\n# Running:\r\n\r\nI, [2016-03-31T21:40:16 #47936]  INFO -- : Started GET \"/\" for 127.0.0.1 at 2016-03-31 21:40:16 -0700\r\n.\r\n\r\nFinished in 0.178257s, 5.6099 runs/s, 5.6099 assertions/s.\r\n\r\n1 runs, 1 assertions, 0 failures, 0 errors, 0 skips\r\n```\r\n\r\nI have not yet figured out how to customize the ActionController bug template that we can play with in the IRB. Let me know if you know how.\r\n\r\n## Summary\r\n\r\nIn this article, you learned how easy it is to customize the Rails 5 bug report template and use it as a learning or teaching tool. It is also a useful tool for isolating problems due to Rails upgrade.','2016-04-01 03:06:32','2016-04-01 03:09:44'),(3551,'Effective Use of Inheritance','If inheritance is used in a proper way, it can reduce the code duplication and enhance code reuse. The following conditions must be satisfied for proper use of inheritance:\r\n\r\nInheritance should be used only when a derived class is a specialized kind of base class. Since the base class places constraints on the behavior of the derived classes, if the derived class cannot operate within the constraints then inheritance cannot be used.\r\n\r\nApply Liskov Substitution Principle (LSP). We must be able to substitute the subclasses wherever we can use base classes and the user should not find any difference. The means that all the methods defined in the base class should have the same meaning when they are used in any of the derived classes.\r\n\r\nConsider a base class of Toy and derived classes of SpiderManToy, SuperManToy and BatManToy. We should be able to invoke any of the methods derived from Toy on any of Toy\'s subtypes without knowing about any specific subtype of Toy. Following LSP allows us to manage complexity since we can ignore the details and focus on the generic attributes of an object.\r\n \r\nIf a developer has to know the details of the subclass in order to use it then we have increased the complexity instead of reducing it. For example, if a developer has to think as: \"If I call the getAccountBalance() method on RegularCustomer it returns the amount of cash that the customer has on hand but if I call getAccountBalance() on DefaultCustomer I have to make the result negative because the customer does not have any cash on hand and has accumulated charges in teh account that is owed to the bank\". LSP states that DefaultCustomer should not inherit from Customer base class because the semantics of the getBalance() method in DefaultCustomer is different from the semantics of the getBalance() method in Customer.\r\n\r\nInherit only what you need. A derived class can inherit interfaces only or implementation and interface.\r\nLet us consider the scenario of inheriting interface only. A Java class implementing an interface is an example of interface only inheritance. It is called as sub typing. Whenever the LSP principle is satisfied by a class, it is said to be a sub-type. This can also be accomplished by extending an abstract class with no default implementation for any methods. The intention might be to inherit only the attributes and not the implementation.\r\n \r\nIn interface and implementation inheritance, the derived class inherits the interface and a default implementation (could be allowed to override)\r\n \r\nIf you want to use the implementation of a class but do not want to inherit the interface then use containment (by delegation) rather than inheritance. The class that uses delegation could be a wrapper around the object which does the actual work.\r\n \r\nInheritance when properly used minimizes the code duplication as well as complexity.\r\n \r\n## Inheritance Vs Delegation\r\n \r\nDelegation can be used as an alternative to inheritance. It is the ability of an object to fulfill a responsibility by issuing a message to another object in response to the receipt of a message. It can be implemented with an association or aggregation to another object. An operation on the first object invokes an operation on the second object to accomplish its work.\r\n \r\nApart from the above inheritance test, we can use the following design guidelines to decide when to use inheritance over delegation. \r\n\r\n| Data        | Behavior           | Design Guideline  |\r\n| ------------- |:-------------:| -----:|\r\n| Yes     | No | Create a common object that the classes can contain (delegation) |\r\n| No     | Yes      |   Inherit the classes from a common base class that implements the common behavior |\r\n| Yes | Yes      |    Inherit from a common base class that defines the common data and methods |','2016-04-01 03:16:37','2016-04-01 03:16:37'),(3561,'Encapsulation of Attributes and Visibility of Operations','All attributes should be hidden inside a class. As always, there are exceptions to any rule, in this case it is very rare for an attribute to be declared public. The only way for clients to access the attributes within a class is via methods. If clients access the attribute very often then we should re-consider the decision to declare the attribute within the class. \r\n\r\n- Why does someone need it? \r\n- Is it possible to perform the required operation on the data by the class owning it and provide the service to the clients? \r\n\r\nIf this is possible then we also need to ensure that the operation logically is related to the abstraction that the class represents. Otherwise, move the data to another class and define a new method that operates on it. This increases the cohesion of the class, which is desirable.\r\n \r\n## Encapsulation\r\n \r\nEncapsulation is achieved by means of information hiding. Information hiding means hiding of all the implementation details of a class from other classes. Data is hidden from the clients and and it can only be accessed through a well defined interface. The interface is well defined in the sense that the interface defined is stable and hides the design decisions that are likely to change. As long as the method does not change its signature and fulfills its contract, the implementation of internal details can change without affecting classes using the method. By doing this we hide the internal data representation as well as the internal complexities of an implementation.\r\n\r\nIt is closely related to abstraction because encapsulation is the process of hiding the details of an object that do not contribute to its essential characteristics. \r\n\r\nThe goal is to eliminate the changes propagating to other classes when changes are made to the class. This isolates the changes to just one class avoiding global changes which makes maintenance easier. \r\n\r\nEncapsulation prevents accidental updates. Allowing direct access to internal data of a class permits any class to change it. Encapsulating the data by allowing access only through methods allows rules to be applied to attempts to change data and prevents accidental updates to invalid or unexpected values. To prevent this, we could return read-only copy of the internal data when a collection class is accessed. The client is not aware whether it is getting a copy or the actual data. This decision is hidden from the client. \r\n\r\nIt allows re-use of abstraction without depending on the implementation. Hiding the internal implementation of a class allows an abstraction to be implemented in different ways without affecting the classes that use that abstraction. Classes only depend on the abstraction that has published a stable interface and is not wired to a specific class that implements the abstraction. In other words we program to the interface not the implementation.\r\n\r\nEncapsulation also provides opportunities to find simpler and elegant design. This makes code easier to understand. It permits team members to work independently on state and functionality and allows classes to be understood in isolation.\r\n\r\nSince encapsulation hides variable that are internal to an algorithm, allowing access to variable only through public methods, the Project Manager can use encapsulation to deal with the complexities during the early stages of the project and avoid a maintenance nightmare during later stages of the product life cycle. The Project Manager can make sure that stable interfaces are defined between the different layers of the system in the beginning of the project. This will avoid problems integrating the different layers and enforces consistency in the interaction between layers.\r\n\r\nPeople disagree on the distinction between encapsulation and information hiding. Arguing that encapsulation means bundling of the data and methods together into the same class. This may not necessarily hide the data from external view. From the exam perspective, keep this in mind and use the elimination process to answer any ambiguous questions on encapsulation. \r\n\r\n## Visibility\r\n \r\nOne of the primary task during class design is making decisions about which methods should be made public and which must be made private. This is called as visibility. For example, a class might implement 10 methods and expose only 4 of them, the remaining 6 methods are used internally by the class.\r\n\r\nVisibility concept differs with languages. So let us briefly discuss some of the visibility concepts that are applicable to Java.\r\n\r\nPublic elements are visible to any class; private elements are visible only to the owning class and protected elements are visible only to the subclasses.\r\n \r\n## Encapsulation of Attributes\r\n \r\nA class might use several attributes that cannot be accessed. In this case, the attribute is declared private to the class and no accessor method is provided for other classes to access. During design make the visibility of the attribute as strict as possible i.e., private.\r\n \r\nAlways avoid making an attribute public. An attribute which is declared public violates the encapsulation principle. For example, a Book class with a public int edition declared within the class will make clients free to modify it even without the Book class knowing that it has been changed. However, a Book class that exposes:\r\n\r\n```java \r\npublic int getEdition() {...};\r\npublic void setEdition(int edition) {...};\r\n```\r\n\r\nhas good encapsulation. The clients do not know whether the implementation uses integer to store the edition or Book is storing the edition as string and converting it to integer. For instance, due to performance / space trade off decisions, it could be implemented differently.\r\n \r\nThis leads us to the rules:\r\n\r\n- Do not change the state of an object without going through its public interface.\r\n- Classes should depend only on the public interfaces of other classes. \r\n\r\n## Semantic Violation of Encapsulation\r\n \r\nIt is easy to avoid syntactic violation of encapsulation by declaring the internal methods and data private. Some examples of semantic violation of encapsulation are:\r\n\r\nFailure to call `database.connect()` before calling `author.retrieve(database)` because you know that the author.retrieve() method will establish a new connection to the database in the absence of a database connection.\r\n\r\nNot calling `done()` method in class A because you now that `performLastOperation()` method in class A has already called it.\r\nUsing class B\'s `MAXIMUM_POINTS` constant instead of class `A.MAXIMUM_POINTS` because you know they have the same value.\r\nIgnoring to call class A\'s init() method because you know that class A\'s `executeFirstOperation()` method automatically calls it.\r\n\r\nAll of the examples above makes the client code dependent on the private implementation of a class. One of the main theme of the Design Patterns [GoF] book is that developers should program to an interface. This means we should avoid looking at the implementation of a class to program. When the code is dependent on the implementation, encapsulation is broken and this makes the client code brittle since it has to change whenever modifications to the implementation are made.\r\n \r\n## Inheritance and Encapsulation\r\n \r\nAn element that is coupled to another has a dependency on that other element. If the other element changes, the dependent element may also need to change. A well-designed superclass is not coupled to its subclasses, but a subclass is inextricably tied to its superclass. \r\n\r\nIf a super class declares attributes that are visible only to its sub-classes, (in Java we use `protected` keyword) it results in coupling between them. So, from a strict point of view, Inheritance violates encapsulation. Do not allow the subclasses to access the protected attributes directly. This will avoid maintenance nightmare when the attributes are changed in the super class. At the other extreme you can declare the attributes as private in the superclass, this means the subclasses will not inherit the attributes.  When the derived class needs access to the private attribute declared in the base class provide a protected method that can be used by the sub classes for that purpose.  Changes to the superclass, visible outside that class, are automatically inherited by the subclass without having to change the code of the subclass.\r\n\r\nAll design decisions require human judgement that solves the problem at hand. You have to weigh the advantages vs. disadvantages for your specific situation before deciding either to follow this rule or not. In this case, some of the things that you may look at are : \r\n\r\n- How many sub-classes are we likely to extend from this super-class? \r\n- How many attributes require visibility in the sub-classes? \r\n\r\nAnswering these questions will help you to make the trade-offs between different designs. You could also start with the simplest design that will work for your current requirements and refactor the design in each iteration. \r\n\r\nIf you are using inheritance and the derived class needs access to the private attribute declared in the base class then provide a protected method that can be used by the sub classes for that purpose.\r\n\r\n## Arguments and Encapsulation\r\n \r\nA properly encapsulated class prevents its clients from knowing the implementation details. All the public methods defined in a class is called as the interface of a class.\r\n \r\nThe interface of a class should hide as much implementation details as possible. Therefore, the number of arguments in the interface must be minimal. Because more the number of arguments, the more the clients know about how the class is implementing the functionality behind the signature of the method.\r\n \r\n## Visibility of Operations\r\n \r\nAt the class level this means minimizing the number of methods that are public and available for clients to use. This raises the level of abstraction of the services provided by the class to the correct level. Do not clutter the public interface of a class with methods that users of that class are either not able to use or are not interested in using. Implement a minimal public interface that all classes understand. You can minimize the public interface by following the rule: \r\n\r\n> Do not put implementation details such as common-code private functions into the public interface of a class.\r\n \r\nLet us look at an example for information hiding. Consider a website dedicated to independent publishers. The system needs to allow profile to be created for the authors. One of the data provided by the author is their age. The system stores the age attribute in a class called Author. After a year elapses the profile still shows the same age and the author has not aged at all! By the way this is how Yahoo Profile is implemented.\r\n \r\nThe management now realizes that it is a mistake and wants to provide an operation to calculate age of a given author. The problem is that code has author.age in several different places (direct access to the public age attribute). Now the code has to be modified to `author.getAge()` and recompiled after the `getAge()` is implemented. This may not be a critical issue in this system but if it was a retirement fund account which  allows withdrawal of money only after a certain age is reached by the member then it is definitely a critical issue. This leads to the rule: \r\n\r\n> All data should be hidden (private) within its class.\r\n \r\nInformation hiding is useful for not only attributes and operations but also for class design and sub system design. Let us look at different type of information hiding example for an attribute. In MyTicketCo system the maximum number of tickets that can be purchased is 50. Therefore do not use 50 in the code, instead define a constant `MAXIMUM_TICKETS` to hide the information in one place. This makes it easy to change since it is found in only one place. This leads to the rule: \r\n\r\n> Always use named constants instead of using literals.\r\n \r\n## Encapsulation at System Level\r\n \r\nIn subsystem design we minimize the number of classes exposed to the clients to provide a minimal interface. If this is not possible we use a Facade [GoF].\r\n \r\n## Coupling and its Relation to Encapsulation\r\n \r\nCoupling is a quality metric used to describe amount of interconnection between classes as well as between methods. It is basically a measure of amount of encapsulation. Coupling is applicable to both classes and methods. A loosely coupled system is considered good. It has classes and methods that are independent. Users of a class must be dependent on its public interface, but a class should not be dependent on its clients, as this increases coupling.\r\n \r\nLower the number of connections, the better is the coupling. So a method that takes one parameter is better than a method that takes four parameters. A class with five well defined methods is better than a class that exports 10 public methods (assumes that both are representing the same abstraction).\r\n \r\nThe amount of knowledge required to use a method must be kept to a minimum. Suppose we have a method that does a search for all the books published by a particular author given a last name and a first name. The name of this method is listBooksbyAuthor(). Let us say that in another module we have an Author object that contains the last name and the first name, among other attributes, and that module passes the object to listBooksbyAuthor(). There is only one connection between the interacting modules due to dependency on Author object. It looks like a loosely coupled system. Let us now consider a situation where we need to use a listBooksbyAuthor() method from another module that does not have an Author object but that does have the last name and first name. The method listBooksbyAuthor() in this situation becomes very difficult to use without knowing how the method is implemented. The third module has to know about Author class in order to use the listBooksbyAuthor() method (know is emphasized to indicate the need for an association). Another solution is to change signature of the method listBooksbyAuthor(), so that it takes last name and first name instead of Author.\r\n\r\nThis solution is a good fix. It is now easier to use this method by other modules. The solution has eliminated the dependency on Author object and is more loosely coupled. To summarize the more loosely coupled a module is, the more easily other modules can call a module.\r\n \r\nThe worst type of coupling is the semantic coupling. In this type of coupling a module makes use of semantic knowledge of another module\'s implementation. Examples for this type of coupling is given below:\r\n \r\n**Example 1** \r\n\r\nA module passes a control flag to another module that tells the called module what to do. in this case the calling module makes assumptions about the implementation of the called module.\r\n \r\n**Example 2** \r\n\r\nA module uses global data that has been modified by another module. Assumption is made that modification has been done at the right time.\r\n \r\n**Example 3** \r\n\r\nA module knows from the documentation that it has to explicitly call initialize() operation before invoking an operation foo(). But it deliberately fails to call initialize since it knows that foo() will call initialize anyways.\r\n \r\n**Example 4** \r\n\r\nBefore passing an object as an argument, a module initializes only the attributes that are used by methods that operate on them. It knows what attributes are used by what methods and what methods will actually be required by the called module.\r\n \r\n**Example 5** \r\n\r\nA module passes a BaseObject to another module. The called module knows that it was actually DerivedObject that has been passed to it, so it happily does a downcast of BaseObject to DerivedObject and invokes methods that are specific to DerivedObject.\r\n \r\nThis type of coupling can result in code breaking in the module violating the encapsulation and information hiding principles whenever changes are made in the module that passes the BaseObject.\r\n \r\n## Guidelines for Encapsulation\r\n \r\n### Guideline 1 ###\r\n\r\nAvoid making assumptions about the clients.\r\n \r\nInterface of a class is a contract between the developer of the class and the clients that use the class. There should be no assumption about how the clients will or will not use the class. **Example**: Comments shown below makes it obvious that the class is aware of its clients.\r\n \r\n/* initialize salary to 1 because PayRoll class will throw a NullPointerException if it is initialized to 0. */\r\n \r\n### Guideline 2 ###\r\n\r\nPrefer programmatic interfaces over a semantic interface\r\n \r\nEach interface has two parts, a programmatic and a semantic part. Anything that can be enforced by the compiler is called programmatic part. An example is - data type of a parameter passed to a method. The semantic part refers to the assumptions about how the interface will be used. This cannot be enforced by the compiler. An example is \"method A must be called before method B\".\r\n \r\nConvert semantic interface elements to programmatic interface elements by using techniques such as Assertion (DBC). If this is not possible the final option is to document the semantic interface in comments within the code and use tools to extract these comments to make it part of the API documentation. For example Javadoc can be use for this purpose. Keep in mind that the number of interfaces depending on documentation should be minimal. \r\n\r\n## Summary\r\n\r\nIn this article, you learned how to main encapsulation of attributes and visibility of operations effectively.\r\n','2016-04-01 03:24:17','2016-04-01 03:30:46'),(3571,'Inheritance','## Introduction\r\n\r\nWe have to understand dynamic binding and static binding before we can discuss inheritance.\r\n\r\n## Dynamic Binding\r\n \r\nDynamic binding is a mechanism where a variable is associated with an object during run-time (when the system is executing). The system gains the capability to dynamically decide which method to use by checking the object type. For instance, consider the Piano and Drum classes that have a play() method. The system is knowledgeable to select the right method by using dynamic binding and polymorphism. This is also known as late binding. In layman’s terms, it is not possible for an individual to determine which method will be executed by looking at the code. This basically appears as method over-riding (same method with different implementations in the sub-classes) in the code.\r\n \r\n## Static Binding\r\n \r\nStatic binding is a mechanism where a variable is associated with an object at compile-time. The system has the ability to select the right method by checking the declaration of an object. This is also known as early binding. This basically appears as method over-loading (same method name with different arguments) in the code. Therefore, it is possible for an individual to determine which method will be executed at run-time by simply reading the code.\r\n \r\n## Polymorphism\r\n \r\nPolymorphism is the state of being able to assume different forms. So when you have methods with the same name but with different method signature, you have the compile time polymorphism. Another type of polymorphism is run-time polymorphism. It is a powerful mechanism in which a variable can refer to different objects, which implement the method(s) in their own way. For instance, consider a MusicalInstrument base class that defines an abstract method called play() and subclasses Piano and Drum object. An instance variable called muscialInstrument used in the client code can hold a Piano or Drum object at different times. Regardless of the type of object the variable is associated with at any given time, we can send a play() message.\r\n \r\nPolymorphism in combination with dynamic binding eliminates type specific code such as the switch statement, if-else etc. This makes maintenance of the code easier and improves the quality of the code.\r\nUp-casting refers to assigning an object to a variable declared as a super-type of that object. This is desirable as it allows alternative behavior based on the runtime type of the object. This is preferable to using conditional statements to test the type of the object to determine its behavior, since each new variation that arises will require changes to the logic. If a new variation on an operation is required, a new subtype is created to encapsulate that variation and the existing code does not need to change. So, new subclasses with varying behavior can be added to the inheritance hierarchy.\r\n\r\nDown-casting refers to assigning an object to a variable declared as a sub-type of that object. Down-casting is simply called as casting. We cast from a base class to a more specific class. It asserts that the variable is a more specific extended object. e.g. Drum d = (Drum) aMusicalInstrument. Polymorphism makes down-casting unnecessary, since the behavior is determined by the object\'s runtime type, not by the type of the variable that references it.\r\n\r\n## Exploiting Polymorphism\r\n\r\nInheritance should be used only to model a generalization / specialization hierarchy. Inheritance checklist:\r\n\r\n- Does the relationship model is a special kind of and not is a role played by a ?\r\n- The object should never need to transmute to become an object of some other class.\r\n- The class should extend rather than override or nullify the behavior of the superclass (Liskov Substitution Principle – the subclass should be substitutable for the superclass).\r\n- Do not subclass what is merely a utility class.\r\n- If two or more classes share only common data (no common behavior), do not include them in an inheritance hierarchy.  Instead, move the common data into a class that will be contained by each sharing class.\r\n- If two or more classes share common data and behavior (i.e., methods) then those classes should each inherit from a common base class that captures those data and methods.\r\n- If two or more classes share only a common interface (i.e., messages not data) then they should inherit from a common base class only if they will be used polymorphically.\r\n\r\nExplicit testing of the type of an object is usually a symptom of bad design. The designer should instead exploit polymorphism. Derived classes must have knowledge of their base class by definition, but base classes should not know anything about their derived classes. All abstract classes must be base classes and vice-versa. Factor the commonality of data, behavior and / or interface as high as possible in the inheritance hierarchy.\r\n\r\nHers is a list of valid reasons to partition a class into a subclass:\r\n\r\n- The subclass has additional attributes of interest.\r\n- The subclass has additional associations of interest.\r\n- The subclass concept is operated on, handled, reacted to, or manipulated differently than the superclass or other subclasses in ways that are of interest.\r\n- The subclass concept represents an animate thing (for example, animal, robot) that behaves differently that the super class or other subclasses in ways that are of interest.\r\n\r\n## Inheritance Design Guidelines\r\n\r\n- If you think you need to create new classes at runtime, take a step back and realize that what you are trying to create are objects.\r\n- It should be illegal for a derived class to override a base class method with a no operation method as this violates the Liskov’s Substitution Principle.\r\n- Do not confuse optional containment with need for inheritance. Modeling optional containment with inheritance will lead to proliferation of classes.\r\n\r\n## Summary\r\n\r\nIn this article, you learned how to recognize and exploit polymorphism.\r\n','2016-04-01 03:34:21','2016-04-01 03:35:21'),(3581,'Rendering Collections in Rails 5','## Steps\r\n### Step 1\r\n\r\nThe tasks controller index action retrieves all the tasks.\r\n\r\n```ruby\r\ndef index\r\n  @tasks = Task.all\r\nend\r\n```\r\n\r\n### Step 2\r\n\r\nThe task view `index.html.erb` loops through all the tasks and displays them.\r\n\r\n```rhtml\r\n<h1> Tasks</h1>\r\n<ul>\r\n<% for task in @tasks %>\r\n  <li> \r\n	  <%= task.name %> \r\n  </li> \r\n<% end %>\r\n</ul>\r\n```\r\n\r\n### Step 3\r\n\r\nCreate a task partial `_task.html.erb`.\r\n\r\n```rhtml\r\n<li> \r\n	<%= task.name %> \r\n</li> \r\n```\r\n\r\n### Step 4\r\n\r\nLet\'s render collection using the partial we created in the previous step. Change `index.html.erb`.\r\n\r\n```rhtml\r\n<h1> Tasks</h1>\r\n\r\n<ul>\r\n<%= render partial: \'task\', collection: @tasks %>	\r\n</ul>\r\n```\r\n\r\n### Step 5\r\n\r\nYou can simplify this even further.\r\n\r\n```rhtml\r\n<h1> Tasks</h1>\r\n\r\n<ul>\r\n<%= render @tasks %>	\r\n</ul>\r\n```\r\n\r\nThis works, because, the name of partial is the same as the objects in the collection. If there are no tasks, the render will return nil so you can provide a default value.\r\n\r\n```rhtml\r\n<h1> Tasks</h1>\r\n\r\n<ul>\r\n<%= render @tasks || \'There are no tasks.\' %>	\r\n</ul>\r\n```\r\n\r\n### Step 6\r\n\r\nYou can have a different name for the items you want to render in the partial by using the `as:` option.\r\n\r\n```rhtml\r\n<h1> Tasks</h1>\r\n\r\n<ul>\r\n<%= render partial: \'task\', collection: @tasks, as: :todo %>	\r\n</ul>\r\n```\r\n\r\nIn the task partial, you can now use todo instead of task.\r\n\r\n```rhtml\r\n<li> \r\n  <%= todo.name %> \r\n</li> \r\n```\r\n\r\n### Step 7\r\n\r\nYou can pass a local variable by using the locals. Change the task index page.\r\n\r\n```rhtml\r\n<h1> Tasks</h1>\r\n\r\n<ul>\r\n<%= render partial: \'task\', collection: @tasks, as: :todo, locals: {title: \'My Honey Do List\'} %>	\r\n</ul>\r\n```\r\n\r\nYou can now access the title local variable in the task partial.\r\n\r\n```rhtml\r\n<li> \r\n  <%= todo.name %> <%= title %>\r\n</li> \r\n```\r\n\r\nThis will render:\r\n\r\n```\r\nGet rich quick My Honey Do List\r\nWrite a book My Honey Do List\r\nBuy a puppy My Honey Do List\r\nDance in the rain My Honey Do List\r\n```\r\n\r\nin the tasks index page.\r\n\r\n## Summary\r\n\r\nIn this article, you learned how to render a partial with collection instead of looping through them in the view.','2016-04-02 02:54:39','2016-04-02 02:54:39'),(3591,'Build Header-Only Responses in Rails 5','In the tasks controller index action use the head method to indicate a resource has been created.\r\n\r\n```ruby\r\nhead :created\r\n```\r\n\r\nHit the tasks index action using curl.\r\n\r\n```\r\n$curl -i http://localhost:3000/tasks\r\n```\r\n\r\nThe output shows that the resource is created with the http status code 201.\r\n\r\n```\r\nHTTP/1.1 201 Created\r\nX-Frame-Options: SAMEORIGIN\r\nX-XSS-Protection: 1; mode=block\r\nX-Content-Type-Options: nosniff\r\nContent-Type: text/html\r\nETag: W/\"7cbafb0bf60694009a67e72cae4ee7ae\"\r\nCache-Control: max-age=0, private, must-revalidate\r\nX-Request-Id: a492c444-a44b-4316-942f-29f5b84b8062\r\nX-Runtime: 0.040294\r\nTransfer-Encoding: chunked\r\n```\r\n\r\nChange the tasks controller index action to use head method with bad request.\r\n\r\n```ruby\r\nhead :bad_request\r\n```\r\n\r\nHit the tasks index action using curl.\r\n\r\n```\r\n$ curl -i http://localhost:3000/tasks\r\n```\r\n\r\nThe output shows that the client request was a bad request with http status code 400. The http status codes that are in 400-4xx range is used to indicate client side issues.\r\n\r\n```\r\nHTTP/1.1 400 Bad Request\r\nX-Frame-Options: SAMEORIGIN\r\nX-XSS-Protection: 1; mode=block\r\nX-Content-Type-Options: nosniff\r\nContent-Type: text/html\r\nCache-Control: no-cache\r\nX-Request-Id: e54f08dd-ff63-4d9b-a466-eee075da320c\r\nX-Runtime: 0.018747\r\nTransfer-Encoding: chunked\r\n```\r\n\r\nChange the tasks controller index action to use head method to render text, \'OK\'.\r\n\r\n```ruby\r\nrender plain: \'OK\'\r\n```\r\n\r\nHit the tasks index action using curl.\r\n\r\n```\r\n$ curl -i http://localhost:3000/tasks\r\n```\r\n\r\nThe output shows that the client received OK with http status code 200.\r\n\r\n```\r\nHTTP/1.1 200 OK\r\nX-Frame-Options: SAMEORIGIN\r\nX-XSS-Protection: 1; mode=block\r\nX-Content-Type-Options: nosniff\r\nContent-Type: text/plain; charset=utf-8\r\nETag: W/\"e0aa021e21dddbd6d8cecec71e9cf564\"\r\nCache-Control: max-age=0, private, must-revalidate\r\nX-Request-Id: f6a9432f-9be4-4d08-ba0c-3e0b508bda98\r\nX-Runtime: 0.031623\r\nTransfer-Encoding: chunked\r\n\r\nOK\r\n```\r\n\r\nChange the tasks controller index action to use head method to render nothing.\r\n\r\n```ruby\r\nrender nothing: true\r\n```\r\n\r\nHit the tasks index action using curl.\r\n\r\n```\r\n$ curl -i http://localhost:3000/tasks\r\n```\r\n\r\nThe output shows that the status code was 200. The client did not receive any text in the response.\r\n\r\n```\r\nHTTP/1.1 200 OK\r\nX-Frame-Options: SAMEORIGIN\r\nX-XSS-Protection: 1; mode=block\r\nX-Content-Type-Options: nosniff\r\nContent-Type: text/plain; charset=utf-8\r\nCache-Control: no-cache\r\nX-Request-Id: 66ea4b7d-5509-4deb-a056-4e20e602718c\r\nX-Runtime: 0.039058\r\nTransfer-Encoding: chunked\r\n```\r\n\r\nChange the tasks controller index action to use head method with http status code 200 (we are using the symbol).\r\n\r\n```ruby\r\nhead :ok\r\n```\r\n\r\nHit the tasks index action using curl.\r\n\r\n```\r\n$ curl -i http://localhost:3000/tasks\r\n```\r\n\r\nYou can see the output shows that the client received the http status code 200.\r\n\r\n```	\r\nHTTP/1.1 200 OK\r\nX-Frame-Options: SAMEORIGIN\r\nX-XSS-Protection: 1; mode=block\r\nX-Content-Type-Options: nosniff\r\nContent-Type: text/html\r\nETag: W/\"cc82873b693baa4b140aa904245d2342\"\r\nCache-Control: max-age=0, private, must-revalidate\r\nX-Request-Id: 3077b3fb-fa93-493a-a202-4e938654d1ec\r\nX-Runtime: 0.062023\r\nTransfer-Encoding: chunked\r\n```\r\n\r\nYou can use anything in this [status table](http://guides.rubyonrails.org/layouts_and_rendering.html#the-status-option \'http status code\') with the head method.','2016-04-02 19:57:46','2016-04-02 19:57:46'),(3601,'Throttling Network to Test Rails 5 Apps','It is a good idea to test your Rails 5 app with different network speeds such as 2G, 3G, 4G, WiFi, DSL etc. In Chrome, go to `Network` tab and click on the drop down where the default value is No throttling.\r\n\r\n<img src=\"https://2.bp.blogspot.com/-Oa6vyslq0V8/VwAg-oaeHVI/AAAAAAAABFs/THlw8raE_1M6dWr07POVmrah5lI3-K9cQ/s1600/Screen%2BShot%2B2016-04-02%2Bat%2B12.43.26%2BPM.png\" alt=\"Network Throttle\" style=\"border: 1px solid #000; max-width:700px; max-height:600px;\"/> \r\n\r\n\r\nYou can now select different network speed to test your web app.\r\n\r\n<img src=\"https://1.bp.blogspot.com/-uC_-uWt8ymo/VwAgKoDhowI/AAAAAAAABFk/bPdjq8nHpOYaKuRSzWx59QCuZhf6m-XpA/s1600/Screen%2BShot%2B2016-04-02%2Bat%2B12.33.07%2BPM.png\" alt=\"Network Throttle\" style=\"border: 1px solid #000; max-width:700px; max-height:600px;\"/> \r\n\r\nIf you have offline feature, you can test that also using this tip. This is useful to make sure that you are loading only the resources that is required for a given page. You will also be able to discover problems that happens only in slow network connections, for instance missing image spinners.\r\n\r\n## Summary\r\n\r\nIn this article, you learned how to throttle the network to test Rails 5 apps using Chrome developer tool.','2016-04-02 20:15:19','2016-04-02 20:15:19'),(3611,'How to Find Out Where a Method is Defined in Rails 5','## View Helpers\r\n\r\nWhat are the available view helpers? We can call methods on the helper object available in rails console.\r\n\r\n```\r\n > helper.methods\r\n => [:title, :admin_area, :alert, :cookies, :view_cache_dependencies, :protect_against_forgery?, :form_authenticity_token, :notice, :fragment_cache_key, :config, :config=, :locale, :locale=, :logger, :default_formats, :default_formats=, :logger=, :streaming_completion_on_exception, ...] \r\n```\r\n\r\nThe result shows that we have Rails 5 specific helpers as well as the helpers that we defined in our project such as title, `admin_area` etc.\r\n\r\nWhere are the view helper methods such as `truncate`, `link_to` and `number_to_currency` defined in Rails 5? We can use the `method` method to answer that question.\r\n\r\n```\r\n > helper.method(:truncate)\r\n => #<Method: ActionView::Base(ActionView::Helpers::TextHelper)#truncate> \r\n > helper.method(:link_to)\r\n => #<Method: ActionView::Base(ActionView::Helpers::UrlHelper)#link_to> \r\n > helper.method(:number_to_currency)\r\n => #<Method: ActionView::Base(ActionView::Helpers::NumberHelper)#number_to_currency> \r\n```\r\n\r\n## Class Methods\r\n\r\nHow to find out where a class method in our application is defined? We can use the `singleton_method` that takes the name of the class method as the argument in combination with `source_location` method.\r\n\r\n```\r\n > Task.singleton_method(:incomplete).source_location\r\n => [\"/Users/bparanj/projects/blog5/app/models/task.rb\", 9] \r\n```\r\n\r\nThis technique will work even for code that you did not write such as gems that application uses.\r\n\r\n## Controller Helpers\r\n\r\nWhat helpers are available in our controllers?\r\n\r\n``` \r\n > ApplicationController.helpers.methods\r\n => [:title, :admin_area, :alert, :cookies, :view_cache_dependencies, :protect_against_forgery?, :form_authenticity_token, :notice, :fragment_cache_key, :config, :config=, :locale, :locale=, :logger, :default_formats, :default_formats=, :logger=, :streaming_completion_on_exception, :debug_missing_translation, :debug_missing_translation=, :assets_manifest, :assets_prefix, :assets_prefix=, :digest_assets, ...] \r\n```\r\n\r\n## Summary\r\n\r\nIn this article, you learned about the view helpers, controller helpers and how to find their location in the code.','2016-04-02 20:18:47','2016-04-02 20:18:47'),(3621,'View Helpers in Rails 5','## Javascript\r\n\r\nJavascript include tag view helpers.\r\n\r\n```\r\n > helper.javascript_include_tag \'main\'\r\n => \"<script src=\\\"/javascripts/main.js\\\"></script>\" \r\n > helper.javascript_include_tag \'main\', \'columns\'\r\n => \"<script src=\\\"/javascripts/main.js\\\"></script>\\n<script src=\\\"/javascripts/columns.js\\\"></script>\" \r\n > helper.javascript_include_tag \'http://example.com/main.js\'\r\n => \"<script src=\\\"http://example.com/main.js\\\"></script>\" \r\n > helper.javascript_include_tag \'main\', \'/photos/columns\'\r\n => \"<script src=\\\"/javascripts/main.js\\\"></script>\\n<script src=\\\"/photos/columns.js\\\"></script>\" \r\n```\r\n\r\n## RSS Auto Discovery\r\n\r\nRSS autodiscovery is a technique that makes it possible for browsers and other software to automatically find a site\'s RSS feed. You will see the RSS feed icon in the browser bar.\r\n\r\n``` \r\n > helper.auto_discovery_link_tag(:rss, \'http://feeds.soundcloud.com/users/soundcloud:users:133973744/sounds.rss\', {title: \'RubyPlus Podcast RSS Feed\'})\r\n => \"<link rel=\\\"alternate\\\" type=\\\"application/rss+xml\\\" title=\\\"RubyPlus Podcast RSS Feed\\\" href=\\\"http://feeds.soundcloud.com/users/soundcloud:users:133973744/sounds.rss\\\" />\" \r\n```\r\n\r\nYou can install RSS Feed Reader Chrome plugin to verify that auto discovery link tag is working.\r\n\r\n## Stylesheets\r\n\r\nYou can specify stylesheets using `stylesheet_link_tag`.\r\n\r\n```\r\n > helper.stylesheet_link_tag \'main\'\r\n => \"<link rel=\\\"stylesheet\\\" media=\\\"screen\\\" href=\\\"/stylesheets/main.css\\\" />\" \r\n```\r\n\r\nMultiple stylesheets can be specified.\r\n\r\n```\r\n > helper.stylesheet_link_tag \'main\', \'columns\'\r\n => \"<link rel=\\\"stylesheet\\\" media=\\\"screen\\\" href=\\\"/stylesheets/main.css\\\" />\\n<link rel=\\\"stylesheet\\\" media=\\\"screen\\\" href=\\\"/stylesheets/columns.css\\\" />\" \r\n > helper.stylesheet_link_tag \'main\', \'photos/columns\'\r\n => \"<link rel=\\\"stylesheet\\\" media=\\\"screen\\\" href=\\\"/stylesheets/main.css\\\" />\\n<link rel=\\\"stylesheet\\\" media=\\\"screen\\\" href=\\\"/stylesheets/photos/columns.css\\\" />\" \r\n```\r\n\r\nYou can point to an URL for the stylesheet.\r\n\r\n```\r\n > helper.stylesheet_link_tag \'http://example.com/main.css\'\r\n => \"<link rel=\\\"stylesheet\\\" media=\\\"screen\\\" href=\\\"http://example.com/main.css\\\" />\" \r\n```\r\n\r\nYou can specify stylesheet to be used for printing.\r\n\r\n```\r\n > helper.stylesheet_link_tag \'main_print\',media: \'print\' \r\n => \"<link rel=\\\"stylesheet\\\" media=\\\"print\\\" href=\\\"/stylesheets/main_print.css\\\" />\" \r\n```\r\n\r\n## Images\r\n\r\nYou must specify the extension of the image. It will work in development but will break in production.\r\n\r\n```\r\n > helper.image_tag \'header.png\'\r\n => \"<img src=\\\"/images/header.png\\\" alt=\\\"Header\\\" />\" \r\n```\r\n\r\nThe images in app/assets/images/icons/delete.gif can be specified like this:\r\n \r\n```\r\n > helper.image_tag \'icons/delete.gif\'\r\n => \"<img src=\\\"/images/icons/delete.gif\\\" alt=\\\"Delete\\\" />\" \r\n```\r\n\r\nYou can specify the height.\r\n\r\n```\r\n > helper.image_tag \'icons/delete.gif\', {height: 45}\r\n => \"<img height=\\\"45\\\" src=\\\"/images/icons/delete.gif\\\" alt=\\\"Delete\\\" />\" \r\n```\r\n\r\nYou can specify the alt tag that displays a string when the image cannot be displayed.\r\n\r\n```\r\n > helper.image_tag \'home.gif\', alt: \'Home\'\r\n => \"<img alt=\\\"Home\\\" src=\\\"/images/home.gif\\\" />\" \r\n```\r\n\r\nYou can specify the size as a dimension.\r\n\r\n```\r\n > helper.image_tag \'home.gif\', size: \'50x20\'\r\n => \"<img src=\\\"/images/home.gif\\\" alt=\\\"Home\\\" width=\\\"50\\\" height=\\\"20\\\" />\" \r\n```\r\n\r\nYou can specify the class.\r\n\r\n```\r\n > helper.image_tag \'home.gif\', alt: \'Go Home\', id: \'HomeImage\', class: \'nav_bar\'\r\n => \"<img alt=\\\"Go Home\\\" id=\\\"HomeImage\\\" class=\\\"nav_bar\\\" src=\\\"/images/home.gif\\\" />\"  \r\n```\r\n\r\nThe tags for audio and video must have the extension.\r\n\r\n``` \r\n > helper.video_tag \'movie.ogg\'\r\n => \"<video src=\\\"/videos/movie.ogg\\\"></video>\" \r\n > helper.video_tag [\'trailer.ogg\', \'movie.ogg\']\r\n => \"<video><source src=\\\"/videos/trailer.ogg\\\" /><source src=\\\"/videos/movie.ogg\\\" /></video>\" \r\n > helper.audio_tag \'music.mp3\'\r\n => \"<audio src=\\\"/audios/music.mp3\\\"></audio>\" \r\n > helper.audio_tag \'music/first_song.mp3\'\r\n => \"<audio src=\\\"/audios/music/first_song.mp3\\\"></audio>\"\r\n```\r\n\r\n## Summary\r\n\r\nIn this article, you learned how to use the view helpers in Rails 5 apps.\r\n\r\n## Reference\r\n\r\n[RSS Board](http://www.rssboard.org/rss-autodiscovery \'RSS Board\')','2016-04-03 20:35:42','2016-04-03 20:37:10'),(3631,'Debugging using ByeBug Gem in Rails 5','## Steps\r\n### Step 1\r\n\r\nByebug is included in Rails 5 project by default. It supports MRI 2.3.0. When you create a new project, you see the gem is already included in the Gemfile.\r\n\r\n```ruby\r\ngroup :development, :test do\r\n  # Call \'byebug\' anywhere in the code to stop execution and get a debugger console\r\n  gem \'byebug\'\r\nend\r\n```\r\n\r\n### Step 2\r\n\r\nAdd byebug to the code anywhere. Let\'s say tasks controller index action.\r\n\r\n```ruby\r\ndef index\r\n  @tasks = Task.all\r\n  byebug\r\nend\r\n```\r\n\r\n### Step 3\r\n\r\nStart the rails server.\r\n\r\n```\r\nrails s\r\n```\r\n\r\nBrowse to `http://localhost:3000/tasks`.\r\n\r\n```\r\n[3, 12] in /Users/bparanj/projects/blog5/app/controllers/tasks_controller.rb\r\n    3:   # GET /tasks\r\n    4:   # GET /tasks.json\r\n    5:   def index\r\n    6:     @tasks = Task.all\r\n    7:     byebug\r\n=>  8:   end\r\n    9: \r\n   10:   # GET /tasks/1\r\n   11:   # GET /tasks/1.json\r\n   12:   def show\r\n```\r\n\r\nThe debugger drops you into the rails console.\r\n\r\n### Step 4\r\n\r\nType help to see available byebug commands.\r\n\r\n```\r\n(byebug) help\r\n\r\n  break      -- Sets breakpoints in the source code\r\n  catch      -- Handles exception catchpoints\r\n  condition  -- Sets conditions on breakpoints\r\n  continue   -- Runs until program ends, hits a breakpoint or reaches a line\r\n  debug      -- Spawns a subdebugger\r\n  delete     -- Deletes breakpoints\r\n  disable    -- Disables breakpoints or displays\r\n  display    -- Evaluates expressions every time the debugger stops\r\n  down       -- Moves to a lower frame in the stack trace\r\n  edit       -- Edits source files\r\n  enable     -- Enables breakpoints or displays\r\n  finish     -- Runs the program until frame returns\r\n  frame      -- Moves to a frame in the call stack\r\n  help       -- Helps you using byebug\r\n  history    -- Shows byebug\'s history of commands\r\n  info       -- Shows several informations about the program being debugged\r\n  interrupt  -- Interrupts the program\r\n  irb        -- Starts an IRB session\r\n  kill       -- Sends a signal to the current process\r\n  list       -- Lists lines of source code\r\n  method     -- Shows methods of an object, class or module\r\n  next       -- Runs one or more lines of code\r\n  pry        -- Starts a Pry session\r\n  quit       -- Exits byebug\r\n  restart    -- Restarts the debugged program\r\n  save       -- Saves current byebug session to a file\r\n  set        -- Modifies byebug settings\r\n  show       -- Shows byebug settings\r\n  source     -- Restores a previously saved byebug session\r\n  step       -- Steps into blocks or methods one or more times\r\n  thread     -- Commands to manipulate threads\r\n  tracevar   -- Enables tracing of a global variable\r\n  undisplay  -- Stops displaying all or some expressions when program stops\r\n  untracevar -- Stops tracing a global variable\r\n  up         -- Moves to a higher frame in the stack trace\r\n  var        -- Shows variables and its values\r\n  where      -- Displays the backtrace\r\n```\r\n\r\n### Step 5\r\n\r\nThe display command evaluates expressions every time the debugger stops.\r\n\r\n```\r\n(byebug) info display\r\nThere are no auto-display expressions now.\r\n```\r\n\r\nDoing a info on line gives you the line number of the current break point.\r\n\r\n```\r\n(byebug) info line\r\nLine 8 of \"/Users/bparanj/projects/blog5/app/controllers/tasks_controller.rb\"\r\n```\r\n\r\n### Step 6\r\n\r\nYou can inspect variable by printing them.\r\n\r\n```\r\n p @tasks\r\n  Task Load (2.5ms)  SELECT \"tasks\".* FROM \"tasks\"\r\n#<ActiveRecord::Relation [#<Task id: 1, name: \"Get rich quick\", complete: true, created_at: \"2016-03-18 21:37:57\", updated_at: \"2016-03-24 01:12:25\", project_id: 1, priority: 4, due_date: \"2016-01-18 21:37:57\">, #<Task id: 2, name: \"Write a book\", complete: true, created_at: \"2016-03-18 21:37:57\", updated_at: \"2016-03-18 21:37:57\", project_id: 1, p...\r\n```\r\n\r\n### Step 7\r\n\r\nThe step command steps into blocks or methods one or more times.\r\n\r\n```\r\n(byebug) step\r\n\r\n[1, 10] in /Users/bparanj/.rvm/gems/ruby-2.3.0@rails5/gems/actionpack-5.0.0.beta3/lib/action_controller/metal/basic_implicit_render.rb\r\n    1: module ActionController\r\n    2:   module BasicImplicitRender\r\n    3:     def send_action(method, *args)\r\n=>  4:       super.tap { default_render unless performed? }\r\n    5:     end\r\n    6: \r\n    7:     def default_render(*args)\r\n    8:       head :no_content\r\n    9:     end\r\n   10:   end\r\n```\r\n\r\nIn this case, we step into the Rails source code.\r\n\r\n### Step 8\r\n\r\nThe eval command is one way to print the values of variables.\r\n\r\n```\r\n(byebug) eval performed?\r\nfalse\r\n```\r\n\r\n### Step 9\r\n\r\nThe continue command runs until program ends, hits a breakpoint or reaches a line.\r\n\r\n```\r\n(byebug) continue\r\n  Rendered collection of tasks/_task.html.erb [19 times] (0.6ms)\r\n  Rendered tasks/index.html.erb within layouts/application (2.3ms)\r\nCompleted 200 OK in 1860538ms (Views: 48.7ms | ActiveRecord: 2.5ms)\r\n```\r\n\r\nThe tasks index action completes the execution and you see the list of tasks in the browser.\r\n\r\n### Step 10\r\n\r\nMove the byebug before retrieving all the tasks.\r\n\r\n```ruby\r\ndef index\r\n  byebug\r\n  @tasks = Task.all\r\nend\r\n```\r\n\r\n### Step 11\r\n\r\nThe up command moves to a higher frame.\r\n\r\n```ruby\r\n(byebug) up\r\n\r\n[2, 11] in /Users/bparanj/projects/blog5/app/controllers/tasks_controller.rb\r\n    2:   \r\n    3:   # GET /tasks\r\n    4:   # GET /tasks.json\r\n    5:   def index\r\n    6:     byebug\r\n=>  7:     @tasks = Task.all\r\n    8:   end\r\n    9: \r\n   10:   # GET /tasks/1\r\n   11:   # GET /tasks/1.json\r\n```\r\n\r\nThis is the step-out function if you have used any GUI debugger.\r\n\r\n### Step 12\r\n\r\nLet\'s inspect the `task_params`.\r\n\r\n```\r\n[23, 32] in /Users/bparanj/projects/blog5/app/controllers/tasks_controller.rb\r\n   23: \r\n   24:   # POST /tasks\r\n   25:   # POST /tasks.json\r\n   26:   def create\r\n   27:         byebug\r\n=> 28:     @task = Task.new(task_params)\r\n   29: \r\n   30:     respond_to do |format|\r\n   31:       if @task.save\r\n   32:         format.html { redirect_to @task, notice: \'Task was successfully created.\' }\r\n(byebug) \r\n(byebug) task_params\r\n<ActionController::Parameters {\"name\"=>\"Ruby Debug\", \"due_date\"=>\"2016-01-18 21:37:57 UTC\"} permitted: true>\r\n```\r\n\r\n### Step 13\r\n\r\nThe next command runs one or more lines of code. Type n for the next command.\r\n\r\n```\r\n(byebug) n\r\n\r\n[25, 34] in /Users/bparanj/projects/blog5/app/controllers/tasks_controller.rb\r\n   25:   # POST /tasks.json\r\n   26:   def create\r\n   27:         byebug\r\n   28:     @task = Task.new(task_params)\r\n   29: \r\n=> 30:     respond_to do |format|\r\n   31:       if @task.save\r\n   32:         format.html { redirect_to @task, notice: \'Task was successfully created.\' }\r\n   33:         format.json { render :show, status: :created, location: @task }\r\n   34:       else\r\n(byebug) @task\r\n#<Task id: nil, name: \"Ruby Debug\", complete: nil, created_at: nil, updated_at: nil, project_id: nil, priority: nil, due_date: \"2016-01-18 21:37:57\">\r\n```\r\n\r\nWe go to the next line.\r\n\r\n### Step 14\r\n\r\nTo quit the debugging session, type quit.\r\n\r\n```\r\n quit\r\nReally quit? (y/n) y\r\n```\r\n\r\n## Summary\r\n\r\nIn this article, you learned the basics of using byebug gem to debug your Rails 5 apps.\r\n\r\n## Reference\r\n\r\n[ByeBug](https://github.com/deivid-rodriguez/byebug \'ByeBug\')','2016-04-06 04:41:54','2016-04-06 04:41:54'),(3641,'Model Name in URL in Rails 5','## Steps\r\n### Step 1\r\n\r\nOverride `to_param` in product model.\r\n\r\n```ruby\r\ndef to_param\r\n  \"#{id}-#{permalink}\"\r\nend\r\n\r\nprivate\r\n\r\ndef permalink\r\n  name.gsub(/[^a-z1-9]+/i, \'-\')\r\nend\r\n```\r\n\r\nWe replace any non-alphanumeric character with a hyphen.\r\n\r\n### Step 2\r\n\r\nLet\'s create some sample data to play with our app in seeds.rb.\r\n\r\n```ruby\r\np = Product.new(name: \'rug\', price: 100)\r\nProduct.create(name: \'big bowl\', price: 20.95)\r\nProduct.create(name: \'pillow\', price: 90)\r\nProduct.create(name: \'light\', price: 10.95)\r\n\r\nc = Category.create(name: \'Clothes\')\r\nCategory.create(name: \'Furniture\')\r\nCategory.create(name: \'Groceries\')\r\nCategory.create(name: \'Electronics\')\r\n\r\np.categories << c\r\np.save!\r\n```\r\n\r\nRun rake db:seed.\r\n\r\n### Step 3\r\n\r\nBrowse to `http://localhost:3000/products` and click on show for any product. You will now see product name in the URL. From a Railscast fan:\r\n\r\n> Note that you DON\'T want to use underscore as the separator between the id and the permalink, if you rely on `String#to_i`. If you use \"_\" and the permalink part begins with a number, you could get e.g. `123_456blah`, and `123_456blah.to_i` is 123456, not the expected 123. This is because `_` can be used in Ruby to make numbers more readable. \r\n\r\nThis means you also need to make sure there is no underscore character in the product name field for any products.\r\n\r\n## Summary\r\n\r\nIn this article, you learned how easy it is to make the URL search engine friendly in Rails 5.','2016-04-06 04:46:24','2016-12-23 00:42:42'),(3651,'Custom View Helpers in Rails 5','## Steps\r\n### Step 1\r\n\r\nThere is no need to declare:\r\n\r\n```ruby\r\nhelper :all\r\n```\r\n\r\nin the application controller in Rails 5. Search for `helper :all` exact match on github: `https://github.com/rails/rails/search?utf8=%E2%9C%93&q=%22helper+%3Aall%22&type=Code`. You can see that in `actionpack/lib/action_controller/railties/helpers.rb`.\r\n\r\n```ruby\r\nif klass.superclass == ActionController::Base && ActionController::Base.include_all_helpers\r\n  klass.helper :all\r\nend\r\n```\r\n\r\n`helper :all` is included if the `include_all_helpers` flag is set to true.\r\n\r\n### Step 2\r\n\r\nWe can create custom helpers in helpers directory without any declaration in the controllers to use it. Create a `jigolo_helper.rb` in helpers directory.\r\n\r\n```ruby\r\nmodule JigoloHelper\r\n  def jiggle\r\n    \'I can jiggle\'\r\n  end\r\nend\r\n```\r\n\r\nNow you can call this helper in any views. For instance, add this to the task index page.\r\n\r\n```rhtml\r\n<%= jiggle %>\r\n```\r\n\r\nThe task index page will now display:\r\n\r\n```\r\nI can jiggle\r\n```\r\n\r\nSince Rails 3.1 `include_all_helpers` configuration is available to customize how helpers are included. According to the docs:\r\n\r\n> Added `config.action_controller.include_all_helpers`. By default `helper :all` is done in `ActionController::Base`, which includes all the helpers by default. Setting `include_all_helpers` to `false` will result in including only `application_helper` and the helper corresponding to controller (like `foo_helper` for `foo_controller`).\r\n\r\n> `config.action_controller.include_all_helpers` configures whether all view helpers are available everywhere or are scoped to the corresponding controller. If set to `false`, `UsersHelper` methods are only available for views rendered as part of `UsersController`. If `true`, `UsersHelper` methods are available everywhere. The default is `true`.\r\n\r\nThe default is nil and not true. The configuring document is wrong.\r\n\r\n### Step 3\r\n\r\nAdd:\r\n\r\n```ruby\r\nconfig.action_controller.include_all_helpers = false\r\n```\r\n\r\nto application.rb. It will look something like this:\r\n\r\n```ruby\r\nmodule Blog\r\n  class Application < Rails::Application\r\n    config.action_controller.include_all_helpers = false\r\n  end\r\nend\r\n```\r\n\r\nRestart the server and go to the tasks index page. You will get the error:\r\n\r\n```\r\nActionView::Template::Error (undefined local variable or method `jiggle\' for #<#<Class:0x00878>):\r\n    1: <h1> Tasks</h1>\r\n    2: \r\n    3: <%= jiggle %>\r\n```\r\n\r\nIf you change the value to true or delete that entire configuration line,  it will work.\r\n	\r\n## Summary\r\n\r\nIn this article, you learned how to use custom helpers in Rails 5.','2016-04-06 04:58:01','2016-12-23 00:43:47'),(3661,'Integrating Google reCAPTCHA with Rails 5 App','## Introduction\r\n\r\nWhy not Akismet? The pricing is not reasonable. If it had Amazon like low pay as you go pricing based on usage, I might consider it. In this article, we will see how to  integrate Google reCAPTCHA feature to your Rails 5 app.\r\n\r\n## Steps\r\n### Step 1\r\n\r\n[Register](https://www.google.com/recaptcha/admin#list \'Register\') your site. You will get a site key and a secret key. Site key looks like this:\r\n\r\n```\r\n6Lc6BAAAAAAAAChqRbQZcn_yyyyyyyyyyyyyyyyy\r\n```\r\n\r\nThis can be viewed in the html. The secret key is used for server side integration and it must be kept secret. For production, I added the public key and private key to the ~/.profile.\r\n\r\n```\r\nexport RECAPTCHA_PUBLIC_KEY=\'6Lc6BAAAAAAAAChqRbQZcn_yyyyyyyyyyyyyyyyy\'\r\nexport RECAPTCHA_PRIVATE_KEY=\'6Lc6BAAAAAAAAKN3DRm6VA_xxxxxxxxxxxxxxxxx\'\r\n```\r\n\r\nNote that there should be no space anywhere except the export and the variable name. Otherwise you will get:\r\n\r\n```\r\nNo public key specified error.\r\n```\r\n\r\n### Step 2\r\n\r\nAdd the recaptcha gem to Gemfile.\r\n\r\n```ruby\r\ngem \"recaptcha\", require: \"recaptcha/rails\"\r\n```\r\n\r\nRun bundle install.\r\n\r\n### Step 3\r\n\r\nAdd the recaptcha view helper:\r\n\r\n```rhtml\r\n<%= recaptcha_tags %>\r\n```\r\n\r\nto the form. In our case, we will add it to the feedback form. To see this in action go to [RubyPlus Contact Page](https://www.rubyplus.com/contact \'RubyPlus Contact Page\'). If you load your form, you will see the CAPTCHA.\r\n\r\n<img src=\"https://2.bp.blogspot.com/-yaT_YCsm82o/VwSjbdX7VOI/AAAAAAAABGc/bSGEoPTEJJIZk__tXe5GiB0pyYjyv-JQQ/s1600/Screen%2BShot%2B2016-04-05%2Bat%2B10.48.36%2BPM.png\" alt=\"Ruby Plus\" style=\"border: 1px solid #000; max-width:700px; max-height:600px;\"/> \r\n\r\n\r\n### Step 4\r\n\r\nIn the controller, you can now verify if the user passed the robot test:\r\n\r\n```ruby\r\nif verify_recaptcha\r\n  # send feedback email \r\nend\r\n```\r\n\r\n### Step 5\r\n\r\nYou have to style the failure message when reCAPTCHA fails. For Twitter Bootstrap, here is the helper:\r\n\r\n```ruby\r\ndef bootstrap_class_for(flash_type)\r\n  map = {\r\n         \"success\"         => \"alert-success\",\r\n         \"error\"           => \"alert-danger\",\r\n         \"alert\"           => \"alert-warning\",\r\n         \"notice\"          => \"alert-info\",\r\n         \"recaptcha_error\" => \"alert-danger\"\r\n        }\r\n  map.fetch(flash_type)\r\nend\r\n```\r\n\r\n## Other Uses for reCAPTCHA\r\n\r\nYou can add reCAPTCHA to your user registration page. You can also prevent automated scripts from downloading any files repeatedly. This will prevent wasting bandwidth and can save you money on Amazon S3.\r\n\r\n## Summary\r\n\r\nIn this article, you learned how to integrate Google reCAPTCHA with Rails 5 app using recaptcha gem to prevent abuse of your web app.\r\n\r\n## References\r\n\r\n[reCAPTCHA DOCS](https://developers.google.com/recaptcha/docs/verify#api-request \'reCAPTCHA\')\r\n[recaptcha gem](https://github.com/ambethia/recaptcha \'recaptcha\')','2016-04-06 06:03:47','2016-04-10 07:27:40'),(3671,'Inheritance and Class Methods','Let\'s define a setter class method in a class.\r\n\r\n```ruby\r\nclass A\r\n  def self.foo=(value)\r\n    p value\r\n  end\r\nend\r\n```\r\n\r\nLet\'s define a subclass B that extends from A.\r\n\r\n```ruby\r\nclass B < A\r\n  foo = true\r\nend\r\n```\r\n\r\nIt tries to call the setter with true as the value. When you run this, it prints nothing. Why did not print the value true?\r\n\r\n```ruby\r\nclass B < A\r\n  foo = true\r\n\r\n  p local_variables\r\nend\r\n```\r\n\r\nIf you print the local variables inside the subclass, it prints [:foo]. Ruby thinks you have defined a local variable foo instead of calling the class method defined in the super class. We can fix it by explicitly using the self keyword to make it clear we mean the class method foo setter.\r\n\r\n```ruby\r\nclass B < A\r\n  self.foo = true\r\nend\r\n```\r\n\r\nIt now prints true. What is the point of all these toy examples? Can we see a realistic example?\r\n\r\n## ActiveResource\r\n\r\nIf you subclass ActiveResource::Base and do something like this:\r\n\r\n```ruby\r\nclass MyActiveResoureClient < ActiveResource::Base\r\n  include_root_in_json = true\r\nend\r\n```\r\n\r\nThis will not work. The reason is the same as the toy example we saw earlier. Where is the `include_root_in_json` method defined? Searching the github for `https://github.com/rails/activeresource/search?utf8=%E2%9C%93&q=include_root_in_json%3D&type=Code` does not tell us where this method is defined. Let\'s dig further into this in the rails console:\r\n\r\n```\r\nActiveResource::Base.singleton_methods.grep(:include_root_in_json=)\r\n=> [:include_root_in_json=]\r\n```\r\n\r\nThe setter is `include_root_in_json=` is a class method defined in `ActiveResource::Base`. Let\'s get the line number where we can find this method.\r\n\r\n```\r\n[4] pry(main)> ActiveResource::Base.method(:include_root_in_json=)\r\n=> #<Method: ActiveResource::Base.include_root_in_json=>\r\n[5] pry(main)> ActiveResource::Base.method(:include_root_in_json=).source_location\r\n=> [\"/Users/bparanj/.rvm/gems/ruby-2.3.0@blog/gems/activesupport-4.2.6/lib/active_support/core_ext/class/attribute.rb\", 83]\r\n```\r\n\r\nI had to use this method because, searching for `include_root_in_json=` in the github does not show where it is defined. The reason is that meta-programming is used to define this method. Here is the code where this is defined:\r\n\r\n```ruby\r\ndefine_singleton_method(\"#{name}=\") do |val|\r\n  singleton_class.class_eval do\r\n    remove_possible_method(name)\r\n    define_method(name) { val }\r\n  end\r\n\r\n  if singleton_class?\r\n    class_eval do\r\n      remove_possible_method(name)\r\n      define_method(name) do\r\n        if instance_variable_defined? ivar\r\n          instance_variable_get ivar\r\n        else\r\n          singleton_class.send name\r\n        end\r\n      end\r\n    end\r\n  end\r\n  val\r\nend\r\n```\r\n\r\nThis is found inside the `class_attribute(*attrs)` method. ActiveResource opens the Ruby Class class to define this method. From the docs:\r\n\r\n>Declare a class-level attribute whose value is inheritable by subclasses.\r\nSubclasses can change their own value and it will not impact parent class.\r\n\r\n```ruby\r\nclass Base\r\n  class_attribute :setting\r\nend\r\n\r\nclass Subclass < Base\r\nend\r\n\r\nBase.setting = true\r\nSubclass.setting            # => true\r\nSubclass.setting = false\r\nSubclass.setting            # => false\r\nBase.setting                # => true\r\n```\r\n\r\nWhy do we need the class-level attribute that can be inherited by subclasses? The answer deserves to be explained in another article.\r\n\r\n## Summary\r\n\r\nIn this article, you learned how to call the class method setters defined in the superclass from a subclass. You also learned how you can find out answers to your questions by using Ruby\'s introspection abilities','2016-04-06 08:00:28','2016-04-06 08:00:28'),(3681,'Complex Forms in Rails 5','In this article, you will learn how to create a project and a few tasks for the project at the same time. You can watch this tutorial as a screencast [Complex Forms in Rails 5](https://itunes.apple.com/us/podcast/rails-screencast/id1142573687 \'Complex Forms in Rails 5\').\r\n\r\n## Steps\r\n### Step 1\r\n\r\nCreate a new Rails 5 project and projects controller with index, new and create actions.\r\n\r\n```\r\nrails new todoist\r\nrails g controller projects index new create\r\n```\r\n\r\nDefine the project resource in routes.rb.\r\n\r\n```ruby\r\nRails.application.routes.draw do\r\n  resources :projects\r\nend\r\n```\r\n\r\n### Step 2\r\n\r\nThe projects controller looks familiar:\r\n\r\n```ruby\r\nclass ProjectsController < ApplicationController\r\n  def index\r\n    @projects = Project.all\r\n  end\r\n\r\n  def new\r\n    @project = Project.new\r\n  end\r\n\r\n  def create\r\n    @project = Project.new(allowed_params)\r\n    if @project.save\r\n      flash[:notice] = \'Successfully created project.\'\r\n      \r\n      redirect_to projects_path\r\n    else\r\n      render :new\r\n    end\r\n  end\r\n  \r\n  private\r\n  \r\n  def allowed_params\r\n    params.require(:project).permit(:name)\r\n  end\r\nend\r\n```\r\n\r\n### Step 3\r\n\r\nGenerate a project model with name attribute.\r\n\r\n```\r\nrails g model project name\r\n```\r\n\r\n### Step 4\r\n\r\nDeclare the `has_many` tasks relationship in the project model.\r\n\r\n```ruby\r\nclass Project < ApplicationRecord\r\n  has_many :tasks\r\nend\r\n```\r\n\r\nDeclare the `belongs_to` relationship in the task model.\r\n\r\n```ruby\r\nclass Task < ApplicationRecord\r\n  belongs_to :project\r\nend\r\n```\r\n\r\n### Step 5\r\n\r\nThe form to create a new project looks like this:\r\n\r\n```rhtml\r\n<h1>New Project</h1>\r\n<%= form_for @project do |f| %>\r\n  <p> \r\n    Name: <%= f.text_field :name %>\r\n  </p>\r\n  <p>\r\n	<%= f.submit \'Create Project\' %>\r\n  </p>\r\n<% end %>\r\n```\r\n\r\n### Step 6\r\n\r\nGenerate task model with name attribute and `project_id` foreign key.\r\n\r\n```\r\nrails g model task name project_id:integer\r\n```\r\n\r\n### Step 7\r\n\r\nThe projects index page lists all the projects.\r\n\r\n```rhtml\r\n<h1>Projects</h1>\r\n\r\n<% for project in @projects %>\r\n<%= project.name %>\r\n<% end %>\r\n```\r\n\r\nYou can now create a project.\r\n\r\n### Step 8\r\n\r\nAdd:\r\n\r\n```ruby\r\naccepts_nested_attributes_for :tasks\r\n```\r\n\r\nto the project model.\r\n\r\n```ruby\r\nclass Project < ApplicationRecord\r\n  has_many :tasks\r\n  \r\n  accepts_nested_attributes_for :tasks\r\nend\r\n```\r\n\r\nWhen you create a project with some tasks, you will get the error:\r\n\r\n```\r\nerror : must exist accepts_nested_attributes_for\r\n```\r\n\r\n### Step 9\r\n\r\nAdd the `inverse_of` to the task model.\r\n\r\n```ruby\r\nclass Task < ApplicationRecord\r\n  belongs_to :project, inverse_of: :tasks\r\nend\r\n```\r\n\r\nAdd the `inverse_of` to the project model.\r\n\r\n```ruby\r\nclass Project < ApplicationRecord\r\n  has_many :tasks, inverse_of: :project\r\n  \r\n  accepts_nested_attributes_for :tasks\r\nend\r\n```\r\n\r\nRead the Rails API to learn about `inverse_of`. \r\n\r\n### Step 10\r\n\r\nYou can now create a project with many tasks. The log file shows that the records were inserted for projects and the tasks.\r\n\r\n```\r\nStarted POST \"/projects\" for ::1 at 2016-04-06 21:02:26 -0700\r\nProcessing by ProjectsController#create as HTML\r\n  Parameters: {\"utf8\"=>\"✓\", \"authenticity_token\"=>\"FjkO/a1o3=\", \"project\"=>{\"name\"=>\"Sqare\", \"tasks_attributes\"=>{\"0\"=>{\"name\"=>\"10\"}, \"1\"=>{\"name\"=>\"20\"}, \"2\"=>{\"name\"=>\"30\"}}}, \"commit\"=>\"Create Project\"}\r\n   (0.1ms)  begin transaction\r\n  SQL (0.4ms)  INSERT INTO \"projects\" (\"name\", \"created_at\", \"updated_at\") VALUES (?, ?, ?)  [[\"name\", \"Sqare\"], [\"created_at\", 2016-04-06 23:02:26 UTC], [\"updated_at\", 2016-04-06 23:02:26 UTC]]\r\n  SQL (0.1ms)  INSERT INTO \"tasks\" (\"name\", \"project_id\", \"created_at\", \"updated_at\") VALUES (?, ?, ?, ?)  [[\"name\", \"10\"], [\"project_id\", 6], [\"created_at\", 2016-04-06 23:02:26 UTC], [\"updated_at\", 2016-04-06 23:02:26 UTC]]\r\n  SQL (0.0ms)  INSERT INTO \"tasks\" (\"name\", \"project_id\", \"created_at\", \"updated_at\") VALUES (?, ?, ?, ?)  [[\"name\", \"20\"], [\"project_id\", 6], [\"created_at\", 2016-04-06 23:02:26 UTC], [\"updated_at\", 2016-04-06 23:02:26 UTC]]\r\n  SQL (0.0ms)  INSERT INTO \"tasks\" (\"name\", \"project_id\", \"created_at\", \"updated_at\") VALUES (?, ?, ?, ?)  [[\"name\", \"30\"], [\"project_id\", 6], [\"created_at\", 2016-04-06 23:02:26 UTC], [\"updated_at\", 2016-04-06 23:02:26 UTC]]\r\n   (0.4ms)  commit transaction\r\nRedirected to http://localhost:3000/projects\r\nCompleted 302 Found in 11ms (ActiveRecord: 1.1ms)\r\n```\r\n\r\n### Step 11\r\n\r\nThe form will save tasks with empty value for the task name. Let\'s fix that now. Add:\r\n\r\n```ruby\r\nreject_if\r\n```\r\n\r\nto the project model.\r\n\r\n```ruby\r\nclass Project < ApplicationRecord\r\n  has_many :tasks, inverse_of: :project\r\n  \r\n  accepts_nested_attributes_for :tasks, reject_if: proc { |attributes| attributes[:name].blank? }\r\nend\r\n```\r\n\r\n### Step 12\r\n\r\nDisplay all tasks for a given project in the project index page.\r\n\r\n```rhtml\r\n<h1>Projects</h1>\r\n\r\n<% for project in @projects %>\r\n  <%= project.name %>\r\n  <% for task in project.tasks %>\r\n    <%= task.name %>\r\n  <% end %>\r\n<% end %>\r\n```\r\n\r\nWhen you edit an existing project with tasks, it will not work.\r\n\r\n### Step 13\r\n\r\nYou must allow id and `_destroy` to delete tasks.\r\n\r\n```ruby\r\nparams.require(:project).permit(:name, tasks_attributes: [:id, :name, :_destroy])\r\n```\r\n\r\nThe projects update action looks like this:\r\n\r\n```ruby\r\ndef update\r\n  @project = Project.find(params[:id])  \r\n  if @project.update_attributes(allowed_params)\r\n    redirect_to @project, notice: \'Successfully updated project\'\r\n  else\r\n    render :edit\r\n  end\r\nend\r\n```\r\n\r\n### Step 14\r\n\r\nWe should also add:\r\n\r\n```ruby\r\nallow_destroy: true\r\n```\r\n\r\nto the project model. It now looks like this:\r\n\r\n```ruby\r\nclass Project < ApplicationRecord\r\n  has_many :tasks, inverse_of: :project, dependent: :destroy\r\n  \r\n  accepts_nested_attributes_for :tasks, reject_if: proc { |attributes| attributes[:name].blank? }, allow_destroy: true\r\nend\r\n```\r\n\r\n### Step 15\r\n\r\nThe project show looks like this:\r\n\r\n```rhtml\r\n<%= @project.name %>\r\n<% for task in @project.tasks %>\r\n<%= task.name %>\r\n<% end %>\r\n```\r\n\r\nThe new project page looks like this:\r\n\r\n```rhtml\r\n<h1>New Project</h1>\r\n<%= form_for @project do |f| %>\r\n  <p>\r\n	Name: <%= f.text_field :name %>\r\n  </p>\r\n  <%= f.fields_for :tasks do |task_form| %>\r\n  	<p>\r\n  		Task: <%= task_form.text_field :name %>\r\n  	</p>\r\n  <% end %>\r\n  <p>\r\n	<%= f.submit \'Create Project\' %>\r\n  </p>\r\n<% end %>\r\n```\r\n\r\n### Step 16\r\n\r\nThe project edit page looks like this:\r\n\r\n```rhtml\r\n<h1>Edit Project</h1>\r\n<%= form_for @project do |f| %>\r\n  <p>\r\n	Name: <%= f.text_field :name %>\r\n  </p>\r\n  <%= f.fields_for :tasks do |task_form| %>\r\n  	<p>\r\n  	  Task: <%= task_form.text_field :name %>\r\n	  <%= task_form.check_box :_destroy %>\r\n	  <%= task_form.label :_destroy, \"Remove Task\" %>\r\n  	</p>\r\n  <% end %>\r\n  <p>\r\n	<%= f.submit \'Update Project\' %>\r\n  </p>\r\n<% end %>\r\n```\r\n\r\nYou will now be able to delete tasks for a given project by going to the project edit page.\r\n\r\n## Summary\r\n\r\nIn this article, you learned how to save form fields that is persisted in different tables by using `fields_for` and `nested_attributes_for` in Rails 5 apps.\r\n\r\n## Resources\r\n\r\n[Cocoon](https://github.com/nathanvda/cocoon \'Cocoon\')\r\n[Covert Coffeescript to Javascript](http://js2.coffee/ \'Covert Coffeescript to Javascript\')','2016-04-07 04:49:07','2016-10-29 17:11:02'),(3691,'Dynamic Select Menus in Rails 5','## Steps\r\n### Step 1\r\n\r\nGenerate the people controller and person, country and state models.\r\n\r\n```\r\nrails g controller people new\r\nrails g model state name country_id:integer\r\nrails g model country name \r\nrails g model person name country_id:integer state_id:integer\r\n```\r\n\r\n### Step 2\r\n\r\nThe people controller new action initializes the person variable.\r\n\r\n```ruby\r\ndef new\r\n  @person = Person.new\r\nend\r\n```\r\n\r\n### Step 3\r\n\r\nThe form to create a new person `views/people/new.html.erb` looks like this:\r\n\r\n```rhtml\r\n<h1>New Person</h1>\r\n<%= form_for @person do |f| %>\r\n  <div class=\"field\">\r\n    <%= f.label :name %><br />\r\n    <%= f.text_field :name %>\r\n  </div>\r\n  <div class=\"field\">\r\n    <%= f.label :country_id %><br />\r\n    <%= f.collection_select :country_id, Country.order(:name), :id, :name, include_blank: true %>\r\n  </div>\r\n  <div class=\"field\">\r\n    <%= f.label :state_id, \"State or Province\" %><br />\r\n    <%= f.collection_select :state_id, State.order(:name), :id, :name, include_blank: true %>\r\n  </div>\r\n  <div class=\"actions\"><%= f.submit %></div>\r\n<% end %>\r\n```\r\n\r\n### Step 4\r\n\r\nCopy the countries.csv and states.csv to the root of your project. Populate the countries and states tables from csv files in seeds.rb\r\n\r\n```ruby\r\nrequire \'csv\'\r\n\r\nputs \"Importing countries...\"\r\nCSV.foreach(Rails.root.join(\"countries.csv\"), headers: true) do |row|\r\n  Country.create! do |country|\r\n    country.id = row[0]\r\n    country.name = row[1]\r\n  end\r\nend\r\n\r\nputs \"Importing states...\"\r\nCSV.foreach(Rails.root.join(\"states.csv\"), headers: true) do |row|\r\n  State.create! do |state|\r\n    state.name = row[0]\r\n    state.country_id = row[2]\r\n  end\r\nend\r\n```\r\n \r\nRun the seed script.\r\n\r\n```\r\nrails db:seed\r\n```\r\n\r\n### Step 5\r\n\r\nDefine the routes.\r\n\r\n```ruby\r\nRails.application.routes.draw do\r\n  root to: \'people#new\'\r\n  \r\n  resources :people\r\nend\r\n```\r\n\r\n### Step 6\r\n\r\nDeclare the associations for the models.\r\n\r\n```ruby\r\nclass State < ApplicationRecord\r\n  belongs_to :country\r\n  has_many :people\r\nend\r\n```\r\n\r\n```ruby\r\nclass Person < ApplicationRecord\r\n  belongs_to :country\r\n  belongs_to :state\r\nend\r\n```\r\n\r\n```ruby\r\nclass Country < ApplicationRecord\r\n  has_many :states\r\n  has_many :people\r\nend\r\n```\r\n\r\n### Step 7\r\n\r\nGo to the home page, you will now see the country and state dropdown.\r\n\r\n### Step 8\r\n\r\nLet\'s group the states by country.\r\n\r\n```rhtml\r\n<h1>New Person</h1>\r\n<%= form_for @person do |f| %>\r\n  <div class=\"field\">\r\n    <%= f.label :name %><br />\r\n    <%= f.text_field :name %>\r\n  </div>\r\n  <div class=\"field\">\r\n    <%= f.label :country_id %><br />\r\n    <%= f.collection_select :country_id, Country.order(:name), :id, :name, include_blank: true %>\r\n  </div>\r\n  <div class=\"field\">\r\n    <%= f.label :state_id, \"State or Province\" %><br />\r\n    <%= f.grouped_collection_select :state_id, Country.order(:name), :states, :name, :id, :name, include_blank: true %>\r\n  </div>\r\n  <div class=\"actions\"><%= f.submit %></div>\r\n<% end %>\r\n```\r\n\r\n### Step 9\r\n\r\nCreate people.js in app/assets/javascripts directory.\r\n\r\n```javascript\r\njQuery(function() {\r\n  var states;\r\n  states = $(\'#person_state_id\').html();\r\n  console.log(states);\r\n  return $(\'#person_country_id\').change(function() {\r\n    var country, options;\r\n    country = $(\'#person_country_id :selected\').text();\r\n    options = $(states).filter(\"optgroup[label=\" + country + \"]\").html();\r\n    console.log(options);\r\n    if (options) {\r\n      return $(\'#person_state_id\').html(options);\r\n    } else {\r\n      return $(\'#person_state_id\').empty();\r\n    }\r\n  });\r\n});\r\n```\r\n\r\n### Step 10\r\n\r\nDelete the people.js.coffee. Reload the page. You will see the drop down boxes in the javascript console. Selecting a country will now populate the states only for that country in the state dropdown.\r\n\r\n### Step 11\r\n\r\nEscape any special characters in the drop down values to avoid problems.\r\n\r\n```\r\njQuery(function() {\r\n  var states;\r\n  $(\'#person_state_id\').parent().hide();\r\n  states = $(\'#person_state_id\').html();\r\n  console.log(states);\r\n  return $(\'#person_country_id\').change(function() {\r\n    var country, escaped_country, options;\r\n    country = $(\'#person_country_id :selected\').text();\r\n    escaped_country = country.replace(/([ #;&,.+*~\\\':\"!^$[\\]()=>|\\/@])/g, \'\\\\$1\');\r\n    options = $(states).filter(\"optgroup[label=\" + escaped_country + \"]\").html();\r\n    console.log(options);\r\n    if (options) {\r\n      $(\'#person_state_id\').html(options);\r\n      return $(\'#person_state_id\').parent().show();\r\n    } else {\r\n      $(\'#person_state_id\').empty();\r\n      return $(\'#person_state_id\').parent().hide();\r\n    }\r\n  });\r\n});\r\n```\r\n\r\n**Note**: If you use:\r\n\r\n```rhtml\r\n<%= f.collection_select :country_id, Country.order(:name), :id, :name, include_blank: true  %>\r\n<%= f.collection_select :state_id, State.order(:name), :states, :name, :id, :name, include_blank: true %>\r\n```\r\n\r\nYou will get the error: \r\n\r\n```\r\nundefined method `merge\' for :name:Symbol.\r\n```\r\n\r\nYou can download the source code from `https://github.com/bparanj/drops`.\r\n\r\n## Summary\r\n\r\nIn this article, you learned how to populate dropdown values based on selection of another dropdown in Rails 5.\r\n','2016-04-08 03:33:34','2016-04-08 03:35:18'),(3701,'Auto-Complete Association in Rails 5','## Steps\r\n### Step 1\r\n\r\nGenerate a new Rails 5 project and products controller.\r\n\r\n```\r\nrails new auto\r\nrails g controller products\r\n```\r\n\r\n### Step 2\r\n\r\nThe products controller looks like this:\r\n\r\n```ruby\r\nclass ProductsController < ApplicationController\r\n  def index\r\n    @products = Product.all\r\n  end\r\n\r\n  def show\r\n    @product = Product.find(params[:id])\r\n  end\r\n\r\n  def new\r\n    @product = Product.new\r\n  end\r\n\r\n  def create\r\n    @product = Product.new(allowed_params)\r\n    if @product.save\r\n      redirect_to products_url, notice: \"Successfully created product.\"\r\n    else\r\n      render :new\r\n    end\r\n  end\r\n\r\n  def edit\r\n    @product = Product.find(params[:id])\r\n  end\r\n\r\n  def update\r\n    @product = Product.find(params[:id])\r\n    if @product.update_attributes(allowed_params)\r\n      redirect_to products_url, notice: \"Successfully created product.\"\r\n    else\r\n      render :edit\r\n    end\r\n  end\r\n\r\n  def destroy\r\n    @product = Product.find(params[:id])\r\n    @product.destroy\r\n    redirect_to products_url, notice: \"Successfully destroyed product.\"\r\n  end\r\n  \r\n  private\r\n  def allowed_params\r\n    params.require(:product).permit!\r\n  end\r\nend\r\n```\r\n\r\n### Step 3\r\n\r\nGenerate the category model and product model.\r\n\r\n```\r\nrails g model category name\r\nrails g model product name price:decimal category_id:integer\r\nrails g model product name price:decimal category:references\r\n```\r\n\r\nYou can see Rails 5 added a foreign key for `category_id`.\r\n\r\n```ruby\r\nclass CreateProducts < ActiveRecord::Migration[5.0]\r\n  def change\r\n    create_table :products do |t|\r\n      t.string :name\r\n      t.decimal :price\r\n      t.references :category, foreign_key: true\r\n\r\n      t.timestamps\r\n    end\r\n  end\r\nend\r\n```\r\n\r\nRun the migration.\r\n\r\n```\r\nrails db:migrate\r\n```\r\n\r\nYou can see the generated tables in schema.rb. It shows the index for the `category_id` foreign key.\r\n\r\n```ruby\r\nActiveRecord::Schema.define(version: 20160408204755) do\r\n  create_table \"categories\", force: :cascade do |t|\r\n    t.string   \"name\"\r\n    t.datetime \"created_at\", null: false\r\n    t.datetime \"updated_at\", null: false\r\n  end\r\n\r\n  create_table \"products\", force: :cascade do |t|\r\n    t.string   \"name\"\r\n    t.decimal  \"price\"\r\n    t.integer  \"category_id\"\r\n    t.datetime \"created_at\",  null: false\r\n    t.datetime \"updated_at\",  null: false\r\n  end\r\n\r\n  add_index \"products\", [\"category_id\"], name: \"index_products_on_category_id\"\r\nend\r\n```\r\n\r\n### Step 4\r\n\r\nLet\'s add some records to play with in the seeds.rb:\r\n\r\n```ruby\r\nCategory.create!(name: \"Beverages\")\r\nCategory.create!(name: \"Books\")\r\nCategory.create!(name: \"Breads\")\r\nCategory.create!(name: \"Canned Foods\")\r\nCategory.create!(name: \"Clothes\")\r\nCategory.create!(name: \"Computers\")\r\nCategory.create!(name: \"Dry Foods\")\r\nCategory.create!(name: \"Frozen Foods\")\r\nCategory.create!(name: \"Furniture\")\r\nCategory.create!(name: \"Headphones\")\r\nCategory.create!(name: \"Magazines\")\r\nCategory.create!(name: \"Music\")\r\nCategory.create!(name: \"Other Electronics\")\r\nCategory.create!(name: \"Pastas\")\r\nCategory.create!(name: \"Portable Devices\")\r\nCategory.create!(name: \"Produce\")\r\nCategory.create!(name: \"Snacks\")\r\nCategory.create!(name: \"Software\")\r\nCategory.create!(name: \"Televisions\")\r\nCategory.create!(name: \"Toys\")\r\nCategory.create!(name: \"Video Games\")\r\nCategory.create!(name: \"Video Players\")\r\nCategory.create!(name: \"Videos\")\r\n\r\nProduct.create!(name: \"Tasty Baklava\", price: 3.99, category: Category.find_by(name: \"Dry Foods\"))\r\nProduct.create!(name: \"Flux Capacitor\", price: 19.55, category: Category.find_by(name: \"Other Electronics\"))\r\nProduct.create!(name: \"Technodrome\", price: 12.49, category: Category.find_by(name: \"Toys\"))\r\nProduct.create!(name: \"TextMate 2\", price: 74.99, category: Category.find_by(name: \"Software\"))\r\n```\r\n\r\nPopulate the database:\r\n\r\n```\r\nrails db:seed\r\n```\r\n\r\n### Step 5\r\n\r\nHere is the new.html.erb:\r\n\r\n```rhtml\r\n<h1>New Product</h1>\r\n\r\n<%= render \'form\' %>\r\n```\r\n\r\nHere is the `_form.html.erb`:\r\n\r\n```rhtml\r\n<%= form_for(@product) do |f| %>\r\n  <div class=\"field\">\r\n    <%= f.label :name %><br />\r\n    <%= f.text_field :name %>\r\n  </div>\r\n  <div class=\"field\">\r\n    <%= f.label :price %><br />\r\n    <%= f.text_field :price %>\r\n  </div>\r\n  <div class=\"field\">\r\n    <%= f.label :category_id %><br />\r\n    <%= f.collection_select :category_id, Category.order(:name), :id, :name, include_blank: true %>\r\n  </div>\r\n  <div class=\"actions\">\r\n    <%= f.submit %>\r\n  </div>\r\n<% end %>\r\n```\r\n\r\n### Step 6\r\n\r\nIn app/assets/stylesheets/application.css, add the following css:\r\n\r\n```css\r\n/*\r\n * This is a manifest file that\'ll be compiled into application.css, which will include all the files\r\n * listed below.\r\n *\r\n * Any CSS and SCSS file within this directory, lib/assets/stylesheets, vendor/assets/stylesheets,\r\n * or any plugin\'s vendor/assets/stylesheets directory can be referenced here using a relative path.\r\n *\r\n * You\'re free to add application-wide styles to this file and they\'ll appear at the bottom of the\r\n * compiled file so the styles you add here take precedence over styles defined in any other CSS/SCSS\r\n * files in this directory. Styles in this file should be added after the last require_* statement.\r\n * It is generally better to create a new file per style scope.\r\n *\r\n *= require_tree .\r\n *= require_self\r\n */\r\n\r\nbody {\r\n  background-color: #4B7399;\r\n  font-family: Verdana, Helvetica, Arial;\r\n  font-size: 14px;\r\n}\r\n\r\na img {\r\n  border: none;\r\n}\r\n\r\na {\r\n  color: #0000FF;\r\n}\r\n\r\n.clear {\r\n  clear: both;\r\n  height: 0;\r\n  overflow: hidden;\r\n}\r\n\r\n#container {\r\n  width: 75%;\r\n  margin: 0 auto;\r\n  background-color: #FFF;\r\n  padding: 20px 40px;\r\n  border: solid 1px black;\r\n  margin-top: 20px;\r\n}\r\n\r\n#flash_notice, #flash_error, #flash_alert {\r\n  padding: 5px 8px;\r\n  margin: 10px 0;\r\n}\r\n\r\n#flash_notice {\r\n  background-color: #CFC;\r\n  border: solid 1px #6C6;\r\n}\r\n\r\n#flash_error, #flash_alert {\r\n  background-color: #FCC;\r\n  border: solid 1px #C66;\r\n}\r\n\r\n.fieldWithErrors {\r\n  display: inline;\r\n}\r\n\r\n.error_messages {\r\n  width: 400px;\r\n  border: 2px solid #CF0000;\r\n  padding: 0px;\r\n  padding-bottom: 12px;\r\n  margin-bottom: 20px;\r\n  background-color: #f0f0f0;\r\n  font-size: 12px;\r\n}\r\n\r\n.error_messages h2 {\r\n  text-align: left;\r\n  font-weight: bold;\r\n  padding: 5px 10px;\r\n  font-size: 12px;\r\n  margin: 0;\r\n  background-color: #c00;\r\n  color: #fff;\r\n}\r\n\r\n.error_messages p {\r\n  margin: 8px 10px;\r\n}\r\n\r\n.error_messages ul {\r\n  margin: 0;\r\n}\r\n\r\nform .field, form .actions {\r\n  margin: 12px 0;\r\n}\r\n\r\n.product h2 {\r\n  font-size: 16px;\r\n  margin-bottom: 2px;\r\n}\r\n```\r\n\r\n### Step 7\r\n\r\nThe index.html.erb looks like this:\r\n\r\n```rhtml\r\n<h1>Products</h1>\r\n<div id=\"products\">\r\n<% @products.each do |product| %>\r\n  <div class=\"product\">\r\n    <h2><%= link_to product.name, product %></h2>\r\n    <div class=\"details\">\r\n      <%= number_to_currency(product.price) %>\r\n      <% if product.category %>\r\n        | Category: <%= product.category.name %>\r\n      <% end %>\r\n      | <%= link_to \"Edit\", edit_product_path(product) %>\r\n    </div>\r\n  </div>\r\n<% end %>\r\n</div>\r\n\r\n<p><%= link_to \"New Product\", new_product_path %></p>\r\n```\r\n\r\nThe application layout file looks like this:\r\n\r\n```rhtml\r\n<!DOCTYPE html>\r\n<html>\r\n  <head>\r\n    <title>Auto</title>\r\n    <%= csrf_meta_tags %>\r\n    <%= action_cable_meta_tag %>\r\n\r\n    <%= stylesheet_link_tag    \'application\', media: \'all\', \'data-turbolinks-track\' => \'reload\' %>\r\n    <%= javascript_include_tag \'application\', \'data-turbolinks-track\' => \'reload\' %>\r\n  </head>\r\n  <body>\r\n    <div id=\"container\">\r\n      <% flash.each do |name, msg| %>\r\n        <%= content_tag :div, msg, :id => \"flash_#{name}\" %>\r\n      <% end %>\r\n      <%= yield %>\r\n    </div>\r\n  </body>\r\n</html>\r\n```\r\n\r\nYou can now see the list of products.\r\n\r\n### Step 8\r\n\r\nHere is the show.html.erb\r\n\r\n```rhtml\r\n<p>\r\n  <b>Name:</b>\r\n  <%= @product.name %>\r\n</p>\r\n<p>\r\n  <b>Price:</b>\r\n  <%= @product.price %>\r\n</p>\r\n<p>\r\n  <b>Category:</b>\r\n  <%= @product.category && @product.category.name %>\r\n</p>\r\n<%= link_to \'Edit\', edit_product_path(@product) %> |\r\n<%= link_to \'Back\', products_path %>\r\n```\r\n\r\nHere is the edit.html.erb.\r\n\r\n```rhtml\r\n<h1>Editing product</h1>\r\n<%= render \'form\' %>\r\n```\r\n\r\n### Step 9\r\n\r\nChange the dropdown to a text field in product form partial:\r\n\r\n```rhtml\r\n<%= f.collection_select :category_id, Category.order(:name), :id, :name, include_blank: true %>\r\n```\r\n\r\nto \r\n\r\n```rhtml\r\n<%= f.text_field :category_name %>\r\n```\r\n\r\n### Step 10\r\n\r\nReload the new product page. You will get the error:\r\n\r\n```\r\nundefined method `category_name\' for #<Product:0x007fbd8f81b588>\r\nDid you mean?  category\r\n               category_id\r\n               category_id_change\r\n               category=\r\n               category_id=\r\n               category_id?\r\n```\r\n\r\n### Step 11\r\n\r\nAdd\r\n\r\n```ruby\r\ndef category_name\r\n  category.try(:name)\r\nend\r\n\r\ndef category_name=(name)\r\n  self.category = Category.find_by(name: name) if name.present?\r\nend\r\n```\r\n\r\nto product model.\r\n\r\n### Step 12\r\n\r\nReload the new product page. Create a new product by filling out the product name, price and the category in the text field. You will see the product is created. \r\n\r\n### Step 13\r\n\r\nLet\'s allow user to create a new category if the category does not exist when they create a new product. Change the `category_name` setter:\r\n\r\n```ruby\r\ndef category_name=(name)\r\n  self.category = Category.find_or_create_by(name: name) if name.present?\r\nend\r\n```\r\n\r\n### Step 14\r\n\r\nEdit an existing product and change the name to something that does not exist in the database. Update the product. We can now add a new category.\r\n\r\n### Step 15\r\n\r\nIn application.js, add:\r\n\r\n```\r\n//= require jquery-ui\r\n```\r\n\r\nIt will look like this:\r\n\r\n```\r\n//= require jquery\r\n//= require jquery-ui	\r\n//= require jquery_ujs\r\n//= require turbolinks\r\n//= require_tree .\r\n```\r\n\r\n### Step 16\r\n\r\nReload the new product page. You will get the error:\r\n\r\n```\r\nCouldn\'t find file \'jquery-ui\'\r\n```\r\n\r\nAdd \r\n\r\n```ruby\r\ngem \'jquery-ui-rails\'\r\n```\r\n\r\nto Gemfile and bundle.\r\n\r\n### Step 17\r\n\r\nAdd:\r\n\r\n```javascript\r\njQuery(function() {\r\n  return $(\'#product_category_name\').autocomplete({\r\n    source: [\'apple\', \'apricot\', \'avocado\']\r\n  });\r\n});\r\n```\r\n\r\nto products.js. Delete products.coffee.\r\n\r\n### Step 18\r\n\r\nReload the new product page and enter \'a\' for the category name, you see the drop down values for the autocomplete. It looks ugly. Let\'s fix that. Change the products.scss:\r\n\r\n```css\r\n// Place all the styles related to the products controller here.\r\n// They will automatically be included in application.css.\r\n// You can use Sass (SCSS) here: http://sass-lang.com/\r\nul.ui-autocomplete {\r\n  position: absolute;\r\n  list-style: none;\r\n  margin: 0;\r\n  padding: 0;\r\n  border: solid 1px #999;\r\n  cursor: default;\r\n  li {\r\n    background-color: #FFF;\r\n    border-top: solid 1px #DDD;\r\n    margin: 0;\r\n    padding: 0;\r\n    a {\r\n      color: #000;\r\n      display: block;\r\n      padding: 3px;\r\n    }\r\n    a.ui-state-hover, a.ui-state-active {\r\n      background-color: #FFFCB2;\r\n    }\r\n  }\r\n}\r\n```\r\n\r\n### Step 19\r\n\r\nReload the new product page. You can see the styling for the auto dropdown box. Change product form:\r\n\r\n```rhtml\r\n<%= f.text_field :category_name, data: { autocomplete_source: Category.order(:name).map(&:name)} %>\r\n```\r\n\r\nto provide the data source.\r\n\r\n### Step 20\r\n\r\nGo to the new product page and view page source.\r\n\r\n```\r\n <input data-autocomplete-source=\"[&quot;Beverages&quot;,&quot;Board Games&quot;,&quot;Books&quot;,&quot;Breads&quot;,&quot;Canned Foods&quot;,&quot;Clothes&quot;,&quot;Computers&quot;,&quot;Dry Foods&quot;,&quot;Frozen Foods&quot;,&quot;Furniture&quot;,&quot;Headphones&quot;,&quot;Magazines&quot;,&quot;Music&quot;,&quot;Other Electronics&quot;,&quot;Pastas&quot;,&quot;Portable Devices&quot;,&quot;Produce&quot;,&quot;Snacks&quot;,&quot;Software&quot;,&quot;Televisions&quot;,&quot;Toys&quot;,&quot;Video Games&quot;,&quot;Video Players&quot;,&quot;Videos&quot;]\" type=\"text\" name=\"product[category_name]\" id=\"product_category_name\" />\r\n```\r\n\r\nYou can see the values for auto complete is escaped.\r\n\r\n### Step 21\r\n\r\nProvide the backend for the autocomplete datasource in the products.js.\r\n\r\n```javascript\r\njQuery(function() {\r\n  return $(\'#product_category_name\').autocomplete({\r\n    source: $(\'#product_category_name\').data(\'autocomplete-source\')\r\n  });\r\n});\r\n```\r\n\r\nReload the new product form and enter `b`. You will see 5 values in the autocomplete dropdown box.\r\n\r\n### Step 22\r\n\r\nLet\'s remove the hard-coded autocomplete source and provide a data source as an URL. Create a categories controller.\r\n\r\n```\r\nrails g controller categories\r\n```\r\n\r\nDefine the category resource in routes.rb.\r\n\r\n```ruby\r\nresources :categories\r\n```\r\n\r\nCategories controller looks like this:\r\n\r\n```ruby\r\nclass CategoriesController < ApplicationController\r\n  def index\r\n    @categories = Category.order(:name).where(\"name like ?\", \"%#{params[:term]}%\")\r\n    render json: @categories.map(&:name)\r\n  end\r\nend\r\n```\r\n\r\n### Step 23\r\n\r\nChange the product form:\r\n\r\n```rhtml\r\n<%= f.text_field :category_name, data: { autocomplete_source: categories_path} %>\r\n```\r\n\r\nReload the new product page and enter `b` for the category name. The auto-complete still works. You can download the source code for this article from `https://github.com/bparanj/auto`. We are not using the name term anywhere in our code, how does the `params[:term]` contain the search term? See the log file when the auto-completion function is triggered:\r\n```\r\nStarted GET \"/categories?term=b\" for 127.0.0.1 at 2016-12-02 16:02:29 -0800\r\n  ActiveRecord::SchemaMigration Load (0.6ms)  SELECT \"schema_migrations\".* FROM \"schema_migrations\"\r\nProcessing by CategoriesController#index as JSON\r\n  Parameters: {\"term\"=>\"b\"}\r\n  Category Load (1.2ms)  SELECT \"categories\".* FROM \"categories\" WHERE (name like \'%b%\') ORDER BY \"categories\".\"name\" ASC\r\nCompleted 200 OK in 24ms (Views: 0.4ms | ActiveRecord: 1.9ms)\r\n```\r\n\r\nYou see the query parameter named term that has a value `b`. This is done by the jQuery UI plugin. \r\n\r\n## Summary\r\n\r\nIn this article, you learned how to implement auto-complete of text field using jquery plugin in Rails 5.\r\n\r\n## Resources\r\n\r\n[jQuery AutoComplete](https://jqueryui.com/autocomplete/ \'jQuery AutoComplete\')\r\n[jQuery UI Rails Gem](https://github.com/joliss/jquery-ui-rails \'jQuery UI Rails Gem\')','2016-04-09 05:54:21','2016-12-03 00:05:48'),(3711,'Tracking Attribute Changes in Rails 5','Let\'s load the first product in the rails console.\r\n\r\n```\r\n$ rails c\r\nLoading development environment (Rails 5.0.0.beta3)\r\n> p = Product.first\r\n  Product Load (0.4ms)  SELECT  \"products\".* FROM \"products\" ORDER BY \"products\".\"id\" ASC LIMIT ?  [[\"LIMIT\", 1]]\r\n => #<Product id: 1, name: \"Big Bowl\", price: #<BigDecimal:7f8b33d6dbf0,\'0.2095E2\',18(27)>, created_at: \"2016-04-05 22:57:35\", updated_at: \"2016-04-05 22:58:47\">\r\n```\r\n\r\nWe have not made any changes to this product, so if we check:\r\n\r\n``` \r\n> p.changed?\r\n => false\r\n```\r\n\r\nThe result is false. Let\'s change the product name.\r\n\r\n```\r\n> p.name = \'Scissors\'\r\n => \"Scissors\"\r\n> p.changed?\r\n => true\r\n```\r\n\r\nWe now get true as the result if we check the product was changed or not. We can check if the product name attribute was changed.\r\n\r\n```\r\n> p.name_changed?\r\n => true\r\n```\r\n\r\nWe can get the previous name using `attribute_was`.\r\n\r\n```\r\n> p.name_was\r\n => \"Big Bowl\"\r\n```\r\n\r\nWe can list the old name and the new name for the product.\r\n\r\n```\r\n> p.name_change\r\n => [\"Big Bowl\", \"Scissors\"]\r\n```\r\n\r\nWe can query for the name of the attribute that changed.\r\n\r\n```\r\n> p.changed\r\n => [\"name\"]\r\n```\r\n\r\nIn this case, it is product name. We can get the old name and new name as a hash.\r\n\r\n```\r\n> p.changes\r\n => {\"name\"=>[\"Big Bowl\", \"Scissors\"]}\r\n```\r\n\r\nLet\'s save the product with the new name.\r\n\r\n```\r\n> p.save\r\n   (0.1ms)  begin transaction\r\n  SQL (2.6ms)  UPDATE \"products\" SET \"name\" = ?, \"updated_at\" = ? WHERE \"products\".\"id\" = ?  [[\"name\", \"Scissors\"], [\"updated_at\", 2016-04-12 23:14:44 UTC], [\"id\", 1]]\r\n   (0.6ms)  commit transaction\r\n => true\r\n```\r\n\r\nThe generated SQL shows only the name and `updated_at` columns are updated. We no longer need to enable partial updates in Rails 5. After saving the product record, if we check again: \r\n\r\n```\r\n> p.changed?\r\n => false\r\n```\r\n\r\nWe get false because we have not made any changes to the product after you saved it in the database. We can list all the attributes of a product.\r\n\r\n```\r\n> p.attributes\r\n => {\"id\"=>1, \"name\"=>\"Scissors\", \"price\"=>#<BigDecimal:7f8b34b7d8d0,\'0.2095E2\',18(27)>, \"created_at\"=>Tue, 05 Apr 2016 00:57:35 UTC +00:00, \"updated_at\"=>Tue, 12 Apr 2016 23:14:44 UTC +00:00}\r\n```\r\n\r\nIn older version of Rails you had to enable partial update. In Rails 5, it will give you an error:\r\n\r\n```\r\n> ActiveRecord::Base.partial_updates\r\nNoMethodError: undefined method `partial_updates\' for ActiveRecord::Base:Class\r\nDid you mean?  partial_writes\r\n```\r\n\r\n`ActiveRecord::Base.partial_updates` was deprecated and removed in Rails 4.1. Gotcha is fixed in Rails 5. If we change it:\r\n\r\n```\r\n> p.name\r\n => \"Scissors\"\r\n> p.name = \'Scissors\'\r\n => \"Scissors\"\r\n> p.changed?\r\n => false\r\n```\r\n\r\nWe will get the false as the result. If we bypass the Rails generated setters to change the attribute:\r\n\r\n```\r\n> p.name.upcase!\r\n => \"SCISSORS\"\r\n> p.name_changed?\r\n => true\r\n```\r\n\r\nRails 5 knows that it has been changed. This was a gotcha in older version of Rails. Let\'s save the changes:\r\n\r\n```\r\n> p.save\r\n   (0.1ms)  begin transaction\r\n  SQL (2.7ms)  UPDATE \"products\" SET \"name\" = ?, \"updated_at\" = ? WHERE \"products\".\"id\" = ?  [[\"name\", \"SCISSORS\"], [\"updated_at\", 2016-04-12 23:20:46 UTC], [\"id\", 1]]\r\n   (0.5ms)  commit transaction\r\n => true\r\n```\r\n\r\nYou can see only the name and `updated_at` gets updated in the database. After saving:\r\n\r\n```\r\n> p.changes\r\n => {}\r\n```\r\n\r\nThere are no changes for this product.\r\n\r\n## Summary\r\n\r\nIn this article, you learned how to track attribute changes in Rails 5. There is no need to enable partial update in Rails 5. Rails 5 updates only the columns that are changed.','2016-04-13 04:59:44','2016-04-13 04:59:44'),(3721,'Advanced Search Form in Rails 5','## Scope\r\n\r\nThis article will only focus on the changes that is required to get the railscasts episode 111 Advanced Search Form working with Rails 5. \r\n\r\n## Rails 5 Changes\r\n\r\nCreate a new rails project, model and controllers.\r\n\r\n```\r\nrails new searchly\r\nrails g model product name category:references price:decimal released_at:date\r\nrails g model category name\r\nrails g model search keywords category:references min_price:decimal max_price:decimal\r\nrails g controller products index\r\nrails g controller searches\r\n```\r\n\r\nMigrate and populate the database. \r\n\r\n```\r\nrails db:migrate\r\nrails db:seed\r\n```\r\n\r\nThe syntax in Rails 5 for ActiveRecord has been changed for:\r\n\r\n```ruby\r\nCategory.find_or_create_by_name(\'Toys\')\r\n```\r\n\r\nNew syntax:\r\n\r\n```ruby\r\nCategory.find_or_create_by(name: \'Toys\')\r\n```\r\n\r\nSo the seeds.rb has:\r\n\r\n```ruby\r\nProduct.create!(category: Category.find_or_create_by(name: \"Toys & Games\"), name: \"Settlers of Catan\", price: 34.99, released_at: \"2011-07-15\")\r\n```\r\n\r\nThe searches controller has a private method that allows all the search attributes to be submitted.\r\n\r\n```ruby\r\ndef allowed_params\r\n  params.require(:search).permit!\r\nend\r\n```\r\n\r\nYou don\'t need `||=` in products method in search model because of Rails SQL caching.\r\n\r\n```ruby\r\ndef products\r\n  @products = find_products\r\nend\r\n```\r\n\r\nCreating the search model using the command shown in the beginning generates the foreign key automatically.\r\n\r\n```ruby\r\nclass CreateSearches < ActiveRecord::Migration[5.0]\r\n  def change\r\n    create_table :searches do |t|\r\n      t.string :keywords\r\n      t.references :category, foreign_key: true\r\n      t.decimal :min_price\r\n      t.decimal :max_price\r\n\r\n      t.timestamps\r\n    end\r\n  end\r\nend\r\n```\r\n\r\nAs you can see in the schema.rb:\r\n\r\n```ruby\r\nActiveRecord::Schema.define(version: 20160413001116) do\r\n  create_table \"categories\", force: :cascade do |t|\r\n    t.string   \"name\"\r\n    t.datetime \"created_at\", null: false\r\n    t.datetime \"updated_at\", null: false\r\n  end\r\n\r\n  create_table \"products\", force: :cascade do |t|\r\n    t.string   \"name\"\r\n    t.integer  \"category_id\"\r\n    t.decimal  \"price\"\r\n    t.date     \"released_at\"\r\n    t.datetime \"created_at\",  null: false\r\n    t.datetime \"updated_at\",  null: false\r\n  end\r\n  add_index \"products\", [\"category_id\"], name: \"index_products_on_category_id\"\r\n\r\n  create_table \"searches\", force: :cascade do |t|\r\n    t.string   \"keywords\"\r\n    t.integer  \"category_id\"\r\n    t.decimal  \"min_price\"\r\n    t.decimal  \"max_price\"\r\n    t.datetime \"created_at\",  null: false\r\n    t.datetime \"updated_at\",  null: false\r\n  end\r\n  add_index \"searches\", [\"category_id\"], name: \"index_searches_on_category_id\"\r\nend\r\n```\r\n\r\nYou can download the code for this project from `https://github.com/bparanj/searchly`.\r\n\r\n## Summary\r\n\r\nIn this article, you learned how to implement an advanced search form in Rails 5.','2016-04-13 05:08:12','2016-04-13 05:12:00'),(3731,'Endless Page in Rails 5','Create a new Rails 5 project, product model and products controller.\r\n\r\n```\r\nrails new eles\r\nrails g model product name price:decimal released_at:datetime\r\nrails g controller products index new show edit\r\n```\r\n\r\nMigrate and populate the database.\r\n\r\n```\r\nrails db:migrate\r\nrails db:seed\r\n```\r\n\r\nCopy the sample data in seeds.rb from the source [code repo](https://github.com/bparanj/eles \'eles\') for this article. Follow the [will_paginate](https://rubyplus.com/articles/3471 \'will_paginate\') tutorial to use `will_paginate` gem with Rails 5. Let\'s experiment in the rails console.\r\n\r\n```\r\n> Product.count\r\n   (0.1ms)  SELECT COUNT(*) FROM \"products\"\r\n => 34\r\n```\r\n\r\nWe have 34 products. Let\'s play with the `will_paginate` api.\r\n\r\n``` \r\n> products = Product.order(:name).page(1).per_page(10)\r\n  Product Load (0.5ms)  SELECT  \"products\".* FROM \"products\" ORDER BY \"products\".\"name\" ASC LIMIT ? OFFSET ?  [[\"LIMIT\", 10], [\"OFFSET\", 0]]\r\n => #<ActiveRecord::Relation [#<Product id: 27, name: \"1000 Piece Jigsaw Puzzle\", price: #<BigDecimal:7fbd7ab1dde0,\'0.1499E2\',18(36)>, released_at: \"2011-09-17 00:00:00\", created_at: \"2016-04-13 18:47:26\", updated_at: \"2016-04-13 18:47:26\">, #<Product id: 22, name: \"7 Wonders\", price: #<BigDecimal:7fbd7ab1c8f0,\'0.2875E2\',18(36)>, released_at: \"2011-09-03 00:00:00\", created_at: \"2016-04-13 18:47:26\", updated_at: \"2016-04-13 18:47:26\">, #<Product id: 18, name: \"Acoustic Guitar\", price: #<BigDecimal:7fbd7bd3b6d0,\'0.1025E4\',9(27)>, released_at: \"2011-08-23 00:00:00\", created_at: \"2016-04-13 18:47:26\", updated_at: \"2016-04-13 18:47:26\">, #<Product id: 20, name: \"Agricola\", price: #<BigDecimal:7fbd7bd3a230,\'0.4599E2\',18(36)>, released_at: \"2011-08-28 00:00:00\", created_at: \"2016-04-13 18:47:26\", updated_at: \"2016-04-13 18:47:26\">, #<Product id: 24, name: \"Answer to Everything\", price: #<BigDecimal:7fbd7bd38ca0,\'0.42E2\',9(27)>, released_at: \"2011-09-08 00:00:00\", created_at: \"2016-04-13 18:47:26\", updated_at: \"2016-04-13 18:47:26\">, #<Product id: 4, name: \"Black Leather Couch\", price: #<BigDecimal:7fbd7c3e3668,\'0.39999E3\',18(36)>, released_at: \"2011-07-27 00:00:00\", created_at: \"2016-04-13 18:47:26\", updated_at: \"2016-04-13 18:47:26\">, #<Product id: 29, name: \"Bowling Ball\", price: #<BigDecimal:7fbd7c3e22e0,\'0.127E3\',9(27)>, released_at: \"2011-09-23 00:00:00\", created_at: \"2016-04-13 18:47:26\", updated_at: \"2016-04-13 18:47:26\">, #<Product id: 25, name: \"Box Kite\", price: #<BigDecimal:7fbd7c3e0ee0,\'0.63E2\',9(27)>, released_at: \"2011-09-10 00:00:00\", created_at: \"2016-04-13 18:47:26\", updated_at: \"2016-04-13 18:47:26\">, #<Product id: 34, name: \"CanCan Music Record\", price: #<BigDecimal:7fbd7c3d3ee8,\'0.299E1\',18(36)>, released_at: \"2011-10-04 00:00:00\", created_at: \"2016-04-13 18:47:26\", updated_at: \"2016-04-13 18:47:26\">, #<Product id: 16, name: \"Chocolate Pie\", price: #<BigDecimal:7fbd7c3d2520,\'0.314E1\',18(36)>, released_at: \"2011-03-14 00:00:00\", created_at: \"2016-04-13 18:47:26\", updated_at: \"2016-04-13 18:47:26\">]>\r\n```\r\n\r\nYou can see the we have 10 results. The parameter to page method specifies the current page number. Go to the products index page. You will be able to scroll down to see more products displayed till all the products are displayed on the screen. \r\n\r\n## Test Graceful Degradation \r\n\r\nInstall Toggle Javascript Chrome Plugin to turn off javascript and test that the app degrades gracefully and the pagination works instead of endless scroll. You can download the source code for this article from [ales](https://github.com/bparanj/eles \'eles\').\r\n\r\n## Summary\r\n\r\nIn this article, we saw how to get endless scroll to work in Rails 5 app.','2016-04-14 03:44:56','2016-04-14 03:44:56'),(3741,'Semi Static Pages in Rails 5','In this article, I will highlight the Rails 5 related changes required to get the railscasts episode on Semi Static Pages working. Create a new Rails 5 project.\r\n\r\n```\r\nrails new static\r\n```\r\n\r\nCopy the seeds.rb from the source [code repo](https://github.com/bparanj/static \'code repo\') to your project. Create the product and page models.\r\n\r\n```\r\nrails g model product name price:decimal released_on:date\r\nrails g model page name permalink content:text \r\n```\r\n\r\nChange the generated migration file to define an index for permalink column.\r\n\r\n```ruby\r\nadd_index :pages, :permalink\r\n```\r\n\r\nGenerate a pages controller with all the 7 RESTful actions.\r\n\r\n```\r\nrails g controller pages index show new edit create update destroy\r\n```\r\n\r\nCopy the views for pages controller, `_form.html.erb`, edit.html.erb, index.html.erb, new.html.erb and show.html.erb. Generate a info controller with about, privacy and license actions.\r\n\r\n```\r\nrails g controller info about privacy license\r\n```\r\n\r\nThe info/about.html.erb has static content. Migrate and populate the database.\r\n\r\n```\r\nrails db:migrate\r\nrails db:seed\r\n```\r\n\r\nGenerate the products controller with index and show actions.\r\n\r\n```\r\nrails g controller products index show\r\n```\r\n\r\nWe also need to change the ActiveRecord syntax in pages controller.\r\n\r\n```ruby\r\nPage.find_by!(permalink: params[:id])\r\n```\r\n\r\nYou can browse the solution 1 by checking out the hash 9268502de02d62c7acf3962c3a649194be289ed9 and solution 2 by checking out the hash d020a3ca61dc12e00502fd6c622c14b14c7191fb.\r\n\r\n## Summary\r\n\r\nIn this article, you learned how to implement semi static pages in Rails 5.','2016-04-14 03:55:19','2016-04-14 03:56:03'),(3751,'ActiveRecord Query Interface in Rails 5','We can count the number of products.\r\n\r\n```ruby\r\nProduct.count\r\n   (0.3ms)  SELECT COUNT(*) FROM \"products\"\r\n => 4\r\n```\r\n\r\nIf you provide an id of a product that does not exist in the database, you will get ActiveRecord::RecordNotFound exception.\r\n\r\n```ruby \r\nproduct = Product.find 100\r\n  Product Load (0.4ms)  SELECT  \"products\".* FROM \"products\" WHERE \"products\".\"id\" = ? LIMIT ?  [[\"id\", 100], [\"LIMIT\", 1]]\r\nActiveRecord::RecordNotFound: Couldn\'t find Product with \'id\'=100\r\n```\r\n\r\nIf the product exists, the find method returns that record.\r\n\r\n```ruby\r\nproduct = Product.find 1\r\n  Product Load (0.1ms)  SELECT  \"products\".* FROM \"products\" WHERE \"products\".\"id\" = ? LIMIT ?  [[\"id\", 1], [\"LIMIT\", 1]]\r\n => #<Product id: 1, name: \"SCISSORS\", price: #<BigDecimal:7fcc31c8,\'0.2095E2\',18(27)>, created_at: \"2016-04-05 00:57:35\", updated_at: \"2016-04-12 23:20:46\">\r\n```\r\n\r\nThe take method returns one product from the database. You can see that this generates SQL query where limit is used.\r\n\r\n```ruby \r\nfirst = Product.take\r\n  Product Load (0.2ms)  SELECT  \"products\".* FROM \"products\" LIMIT ?  [[\"LIMIT\", 1]]\r\n => #<Product id: 1, name: \"SCISSORS\", price: #<BigDecimal:7fcc3888,\'0.2095E2\',18(27)>, created_at: \"2016-04-05 00:57:35\", updated_at: \"2016-04-12 23:20:46\">\r\n```\r\n\r\nYou can also specify the number of records you want to take.\r\n\r\n```ruby \r\nproducts = Product.take 2\r\n  Product Load (0.3ms)  SELECT  \"products\".* FROM \"products\" LIMIT ?  [[\"LIMIT\", 2]]\r\n => [#<Product id: 1, name: \"SCISSORS\", price: #<BigDecimal:7fcc380,\'0.2095E2\',18(27)>, created_at: \"2016-04-05 00:57:35\", updated_at: \"2016-04-12 23:20:46\">, #<Product id: 2, name: \"pillow\", price: #<BigDecimal:7fc17b0,\'0.9E2\',9(18)>, created_at: \"2016-04-05 00:57:35\", updated_at: \"2016-04-05 00:57:35\">]\r\n```\r\n\r\nYou can retrieve the first product in the products table.\r\n\r\n```ruby \r\np = Product.first\r\n  Product Load (0.3ms)  SELECT  \"products\".* FROM \"products\" ORDER BY \"products\".\"id\" ASC LIMIT ?  [[\"LIMIT\", 1]]\r\n => #<Product id: 1, name: \"SCISSORS\", price: #<BigDecimal:7fcc778,\'0.2095E2\',18(27)>, created_at: \"2016-04-05 00:57:35\", updated_at: \"2016-04-12 23:20:46\">\r\n```\r\n\r\nYou can also retrieve the first three products in the products table.\r\n\r\n```ruby\r\nproducts = Product.first 3\r\n  Product Load (0.1ms)  SELECT  \"products\".* FROM \"products\" ORDER BY \"products\".\"id\" ASC LIMIT ?  [[\"LIMIT\", 3]]\r\n => [#<Product id: 1, name: \"SCISSORS\", price: #<BigDecimal:7fcc380f0,\'0.2095E2\',18(27)>, created_at: \"2016-04-05 00:57:35\", updated_at: \"2016-04-12 23:20:46\">, #<Product id: 2, name: \"pillow\", price: #<BigDecimal:7fc07b8,\'0.9E2\',9(18)>, created_at: \"2016-04-05 00:57:35\", updated_at: \"2016-04-05 00:57:35\">, #<Product id: 3, name: \"light\", price: #<BigDecimal:7fcc88,\'0.1095E2\',18(27)>, created_at: \"2016-04-05 00:57:35\", updated_at: \"2016-04-05 00:57:35\">]\r\n```\r\n\r\nYou can retrieve the last product from the products table.\r\n\r\n```ruby \r\nProduct.last\r\n  Product Load (0.2ms)  SELECT  \"products\".* FROM \"products\" ORDER BY \"products\".\"id\" DESC LIMIT ?  [[\"LIMIT\", 1]]\r\n => #<Product id: 4, name: \"rug\", price: #<BigDecimal:7fcc38,\'0.1E3\',9(18)>, created_at: \"2016-04-05 00:57:35\", updated_at: \"2016-04-05 00:57:35\">\r\n```\r\n\r\nYou can also retrieve the last three products in the products table.\r\n\r\n```ruby\r\nProduct.last 3\r\n  Product Load (0.1ms)  SELECT  \"products\".* FROM \"products\" ORDER BY \"products\".\"id\" DESC LIMIT ?  [[\"LIMIT\", 3]]\r\n => [#<Product id: 2, name: \"pillow\", price: #<BigDecimal:7fcc380,\'0.9E2\',9(18)>, created_at: \"2016-04-05 00:57:35\", updated_at: \"2016-04-05 00:57:35\">, #<Product id: 3, name: \"light\", price: #<BigDecimal:7fbbf0,\'0.1095E2\',18(27)>, created_at: \"2016-04-05 00:57:35\", updated_at: \"2016-04-05 00:57:35\">, #<Product id: 4, name: \"rug\", price: #<BigDecimal:7fc710,\'0.1E3\',9(18)>, created_at: \"2016-04-05 00:57:35\", updated_at: \"2016-04-05 00:57:35\">]\r\n```\r\n\r\nThe `find_by` method returns one product that matches the column value specified.\r\n\r\n```ruby\r\nProduct.find_by(name: \'pillow\')\r\n  Product Load (0.2ms)  SELECT  \"products\".* FROM \"products\" WHERE \"products\".\"name\" = ? LIMIT ?  [[\"name\", \"pillow\"], [\"LIMIT\", 1]]\r\n => #<Product id: 2, name: \"pillow\", price: #<BigDecimal:7fcc380,\'0.9E2\',9(18)>, created_at: \"2016-04-05 00:57:35\", updated_at: \"2016-04-05 00:57:35\">\r\n```\r\n\r\nThe `find_by` method returns nil where there is no record that satisfies the criteria.\r\n\r\n```ruby\r\nProduct.find_by(name: \'spoon\')\r\n  Product Load (0.1ms)  SELECT  \"products\".* FROM \"products\" WHERE \"products\".\"name\" = ? LIMIT ?  [[\"name\", \"spoon\"], [\"LIMIT\", 1]]\r\n => nil\r\n```\r\n\r\nIf we use `where` to search for pillow, we get ActiveRecord::Relation as the result, whereas the `find_by` returns the product.\r\n\r\n```ruby \r\nProduct.where(name: \'pillow\')\r\n  Product Load (0.2ms)  SELECT \"products\".* FROM \"products\" WHERE \"products\".\"name\" = ?  [[\"name\", \"pillow\"]]\r\n => #<ActiveRecord::Relation [#<Product id: 2, name: \"pillow\", price: #<BigDecimal:7fcc568,\'0.9E2\',9(18)>, created_at: \"2016-04-05 00:57:35\", updated_at: \"2016-04-05 00:57:35\">]>\r\n```\r\n\r\nWe can check the class.\r\n\r\n```ruby\r\n> p.class\r\n => Product::ActiveRecord_Relation\r\n```\r\n\r\nWhen you chain the `take` method with `where`, we get a product instance as the result.\r\n\r\n```ruby \r\n> Product.where(name: \'pillow\').take.class\r\n  Product Load (0.1ms)  SELECT  \"products\".* FROM \"products\" WHERE \"products\".\"name\" = ? LIMIT ?  [[\"name\", \"pillow\"], [\"LIMIT\", 1]]\r\n => Product(id: integer, name: string, price: decimal, created_at: datetime, updated_at: datetime)\r\n```\r\n\r\nThe bang version of `find_by` method will throw ActiveRecord::RecordNotFound exception when the record is not found.\r\n\r\n```ruby\r\nProduct.find_by!(name: \'spoon\')\r\n  Product Load (0.1ms)  SELECT  \"products\".* FROM \"products\" WHERE \"products\".\"name\" = ? LIMIT ?  [[\"name\", \"spoon\"], [\"LIMIT\", 1]]\r\nActiveRecord::RecordNotFound: Couldn\'t find Product\r\n```\r\n\r\nThe take also has a bang version that throws an exception when a record is not found.\r\n\r\n```ruby\r\nProduct.where(name: \'spoon\').take!\r\n  Product Load (0.1ms)  SELECT  \"products\".* FROM \"products\" WHERE \"products\".\"name\" = ? LIMIT ?  [[\"name\", \"spoon\"], [\"LIMIT\", 1]]\r\nActiveRecord::RecordNotFound: Couldn\'t find Product with [WHERE \"products\".\"name\" = ?]\r\n```\r\n\r\nWe can retrieve all products ordered by `created_at` field.\r\n\r\n```ruby\r\nProduct.order(:created_at)\r\n  Product Load (0.3ms)  SELECT \"products\".* FROM \"products\" ORDER BY \"products\".\"created_at\" ASC\r\n => #<ActiveRecord::Relation [#<Product id: 1, name: \"SCISSORS\", price: #<BigDecimal:7fcc3826,\'0.2095E2\',18(27)>, created_at: \"2016-04-05 00:57:35\", updated_at: \"2016-04-12 23:20:46\">, #<Product id: 2, name: \"pillow\", price: #<BigDecimal:7fcc388,\'0.9E2\',9(18)>, created_at: \"2016-04-05 00:57:35\", updated_at: \"2016-04-05 00:57:35\">, #<Product id: 3, name: \"light\", price: #<BigDecimal:7fcc3826,\'0.1095E2\',18(27)>, created_at: \"2016-04-05 00:57:35\", updated_at: \"2016-04-05 00:57:35\">, #<Product id: 4, name: \"rug\", price: #<BigDecimal:78980,\'0.1E3\',9(18)>, created_at: \"2016-04-05 00:57:35\", updated_at: \"2016-04-05 00:57:35\">]>\r\n```\r\n\r\nWe can provide a string instead of symbol for the column.\r\n\r\n```ruby \r\n> Product.order(\'created_at\')\r\n  Product Load (0.2ms)  SELECT \"products\".* FROM \"products\" ORDER BY created_at\r\n => #<ActiveRecord::Relation [#<Product id: 1, name: \"SCISSORS\", price: #<BigDecimal:7fc10,\'0.2095E2\',18(27)>, created_at: \"2016-04-05 00:57:35\", updated_at: \"2016-04-12 23:20:46\">, #<Product id: 2, name: \"pillow\", price: #<BigDecimal:7fcc382,\'0.9E2\',9(18)>, created_at: \"2016-04-05 00:57:35\", updated_at: \"2016-04-05 00:57:35\">, #<Product id: 3, name: \"light\", price: #<BigDecimal:7fcc348,\'0.1095E2\',18(27)>, created_at: \"2016-04-05 00:57:35\", updated_at: \"2016-04-05 00:57:35\">, #<Product id: 4, name: \"rug\", price: #<BigDecimal:7fcc00,\'0.1E3\',9(18)>, created_at: \"2016-04-05 00:57:35\", updated_at: \"2016-04-05 00:57:35\">]>\r\n```\r\n\r\nThe order method can also take a hash that can specify the order. We can list all products by descending `created_at` column.\r\n\r\n```ruby \r\n> Product.order(created_at: :desc)\r\n  Product Load (0.2ms)  SELECT \"products\".* FROM \"products\" ORDER BY \"products\".\"created_at\" DESC\r\n => #<ActiveRecord::Relation [#<Product id: 4, name: \"rug\", price: #<BigDecimal:7fcc348,\'0.1E3\',9(18)>, created_at: \"2016-04-05 00:57:35\", updated_at: \"2016-04-05 00:57:35\">, #<Product id: 3, name: \"light\", price: #<BigDecimal:7fcc38,\'0.1095E2\',18(27)>, created_at: \"2016-04-05 00:57:35\", updated_at: \"2016-04-05 00:57:35\">, #<Product id: 2, name: \"pillow\", price: #<BigDecimal:7f2bb0,\'0.9E2\',9(18)>, created_at: \"2016-04-05 00:57:35\", updated_at: \"2016-04-05 00:57:35\">, #<Product id: 1, name: \"SCISSORS\", price: #<BigDecimal:7fccb0,\'0.2095E2\',18(27)>, created_at: \"2016-04-05 00:57:35\", updated_at: \"2016-04-12 23:20:46\">]>\r\n```\r\n\r\nYou can get all the products and retrieve only the specified columns id and name by using the select method. \r\n\r\n```ruby\r\n> Product.select(\'id, name\')\r\n  Product Load (0.1ms)  SELECT id, name FROM \"products\"\r\n => #<ActiveRecord::Relation [#<Product id: 1, name: \"SCISSORS\">, #<Product id: 2, name: \"pillow\">, #<Product id: 3, name: \"light\">, #<Product id: 4, name: \"rug\">]>\r\n```\r\n\r\nYou can select records that has unique values for a given column by using distinct.\r\n\r\n```ruby\r\nProduct.select(:name).distinct\r\n  Product Load (0.3ms)  SELECT DISTINCT \"products\".\"name\" FROM \"products\"\r\n => #<ActiveRecord::Relation [#<Product id: nil, name: \"SCISSORS\">, #<Product id: nil, name: \"pillow\">, #<Product id: nil, name: \"light\">, #<Product id: nil, name: \"rug\">]>\r\n```\r\n\r\nWe can retrieve two records by using limit. This generates the same SQL as the take we saw earlier.\r\n\r\n```ruby\r\n> Product.limit(2)\r\n  Product Load (0.2ms)  SELECT  \"products\".* FROM \"products\" LIMIT ?  [[\"LIMIT\", 2]]\r\n => #<ActiveRecord::Relation [#<Product id: 1, name: \"SCISSORS\", price: #<BigDecimal:7fcc30,\'0.2095E2\',18(27)>, created_at: \"2016-04-05 00:57:35\", updated_at: \"2016-04-12 23:20:46\">, #<Product id: 2, name: \"pillow\", price: #<BigDecimal:7fcc30,\'0.9E2\',9(18)>, created_at: \"2016-04-05 00:57:35\", updated_at: \"2016-04-05 00:57:35\">]>\r\n```\r\n\r\nYou can provide an offset to retrieve records by using the offset.\r\n\r\n```ruby \r\n> Product.limit(2).offset(1)\r\n  Product Load (0.2ms)  SELECT  \"products\".* FROM \"products\" LIMIT ? OFFSET ?  [[\"LIMIT\", 2], [\"OFFSET\", 1]]\r\n => #<ActiveRecord::Relation [#<Product id: 2, name: \"pillow\", price: #<BigDecimal:7fcc32f8,\'0.9E2\',9(18)>, created_at: \"2016-04-05 00:57:35\", updated_at: \"2016-04-05 00:57:35\">, #<Product id: 3, name: \"light\", price: #<BigDecimal:7f5b80,\'0.1095E2\',18(27)>, created_at: \"2016-04-05 00:57:35\", updated_at: \"2016-04-05 00:57:35\">]>\r\n```\r\n\r\nYou can get an empty ActiveRecord::Relation by using none.\r\n\r\n```ruby\r\n> Product.none\r\n => #<ActiveRecord::Relation []>\r\n```\r\n\r\nYou can retrieve a record for read only purpose by using readonly.\r\n\r\n```ruby\r\np = Product.readonly.first\r\n  Product Load (0.2ms)  SELECT  \"products\".* FROM \"products\" ORDER BY \"products\".\"id\" ASC LIMIT ?  [[\"LIMIT\", 1]]\r\n => #<Product id: 1, name: \"SCISSORS\", price: #<BigDecimal:7fcc370,\'0.2095E2\',18(27)>, created_at: \"2016-04-05 00:57:35\", updated_at: \"2016-04-12 23:20:46\">\r\n```\r\n\r\nThis product\'s name is SCISSORS.\r\n\r\n```ruby\r\np.name\r\n => \"SCISSORS\"\r\n```\r\n\r\nIf we change the value of the name and save it, we get ActiveRecord::ReadOnlyRecord exception.\r\n\r\n```ruby\r\np.name = \'scissors\'\r\n => \"scissors\"\r\np.save\r\n   (0.1ms)  begin transaction\r\n   (0.1ms)  rollback transaction\r\nActiveRecord::ReadOnlyRecord: Product is marked as readonly\r\n```\r\n\r\n## Summary\r\n\r\nIn this article, you learned some of the ActiveRecord query interface in Rails 5.','2016-04-15 05:11:14','2016-05-05 06:16:52'),(3761,'Liquid Template in Rails 5','Add the gem to the Gemfile. \r\n\r\n```ruby\r\ngem \'liquid\'\r\n```\r\n\r\nRun bundle. We will be using the liquid version 3.0.6. Let\'s experiment with the liquid gem in the rails console. We can parse text with the name place holder like this: \r\n\r\n```\r\n> template = Liquid::Template.parse(\"Hi {{name}}\")\r\n => #<Liquid::Template:0x007f97a @resource_limits={}, @options={}, @profiling=nil, @line_numbers=nil, @root=#<Liquid::Document:0x007ffa8 @tag_name=nil, @markup=nil, @options={:locale=>#<Liquid::I18n:0x007f97 @path=\"/Users/bparanj/.rvm/gems/ruby-2.3.0@rails5/gems/liquid-3.0.6/lib/liquid/locales/en.yml\">}, @blank=false, @nodelist=[\"Hi \", #<Liquid::Variable:0x007d8 @markup=\"name\", @name=#<Liquid::VariableLookup:0x007f97a59f9ec8 @name=\"name\", @lookups=[], @command_flags=0>, @options={:locale=>#<Liquid::I18n:0x007f088 @path=\"/Users/bparanj/.rvm/gems/ruby-2.3.0@rails5/gems/liquid-3.0.6/lib/liquid/locales/en.yml\">}, @filters=[]>]>, @warnings=nil>\r\n```\r\n\r\nand render using the liquid template as follows:\r\n \r\n``` \r\n> template.render(\'name\' => \'Bugs\')\r\n => \"Hi Bugs\"\r\n```\r\n\r\nThis binds the name placeholder in the previous step to the value provided in the above step. Let\'s now look at filters feature in liquid. Add RedCloth gem to the Gemfile.\r\n\r\n```ruby\r\ngem \'RedCloth\'\r\n```\r\n\r\nRun bundle. We will be using RedCloth gem version 4.2.9. Let\'s define textilize method that will apply textilize syntax to a given text.\r\n\r\n```ruby\r\n> module TextFilter\r\n    def textilize(input)\r\n      RedCloth.new(input).to_html\r\n    end\r\n  end\r\n => :textilize\r\n```\r\n\r\nWe can now use the pipe, | to use the filter feature of liquid.\r\n\r\n```\r\n> template = Liquid::Template.parse(\" {{ \'*hi*\' | textilize }}\")\r\n => #<Liquid::Template:0x007ff86cb42ed8 @resource_limits={}, @options={}, @profiling=nil, @line_numbers=nil, @root=#<Liquid::Document:0x007ff86cb42cd0 @tag_name=nil, @markup=nil, @options={:locale=>#<Liquid::I18n:0x007ff86bb04508 @path=\"/Users/bparanj/.rvm/gems/ruby-2.3.0@rails5/gems/liquid-3.0.6/lib/liquid/locales/en.yml\">}, @blank=false, @nodelist=[\" \", #<Liquid::Variable:0x007ff86cb42ac8 @markup=\" \'*hi*\' | textilize \", @name=\"*hi*\", @options={:locale=>#<Liquid::I18n:0x007ff86bb04508 @path=\"/Users/bparanj/.rvm/gems/ruby-2.3.0@rails5/gems/liquid-3.0.6/lib/liquid/locales/en.yml\">}, @filters=[[\"textilize\", []]]>]>, @warnings=nil>\r\n```\r\n\r\nThis creates a template for the given string passed through the textilize filter. We can now use the TextFilter module that implements the textilize function. \r\n \r\n``` \r\n> template.render({}, filters: [TextFilter])\r\n => \" <p><strong>hi</strong></p>\"\r\n```\r\n\r\nThis converts the textilize syntax to the corresponding html. In this case, a strong paragraph containing the string \'hi\'. We have learned enough about the liquid API to integrate it with a Rails 5 app. Change the pages controller edit action in the static  app we created in the previous article. \r\n\r\n```ruby\r\ndef edit\r\n  @page = Page.find(params[:id])\r\nend\r\n```\r\n\r\nCreate category model with name attribute.\r\n\r\n```\r\nrails g model category name\r\n```\r\n\r\nGenerate the migration for adding the `category_id` foreign key to the products table.\r\n\r\n```\r\nrails g migration add_category_id_to_products category_id:integer\r\n```\r\n\r\nDeclare the associations in the product and category models.\r\n\r\n```ruby\r\nclass Product < ApplicationRecord\r\n  belongs_to :category\r\nend\r\n```\r\n\r\n```ruby\r\nclass Category < ApplicationRecord\r\n  has_many :products\r\nend\r\n```\r\n\r\nOpen the products migration file and change `released_on` to `released_at`. Nuke the database and create it from scratch.\r\n\r\n```\r\nrails db:drop\r\nrails db:migrate\r\n```\r\n\r\nCopy the seeds.rb file to your project. Populate the database.\r\n\r\n```\r\nrails db:seed\r\n```\r\n\r\nLet\'s experiment in the rails console. Retrieve the first category in the database.\r\n\r\n```\r\n> c = Category.first\r\n  Category Load (0.2ms)  SELECT  \"categories\".* FROM \"categories\" ORDER BY \"categories\".\"id\" ASC LIMIT ?  [[\"LIMIT\", 1]]\r\n => #<Category id: 1, name: \"Toys & Games\", created_at: \"2016-04-14 20:29:58\", updated_at: \"2016-04-14 20:29:58\">\r\n```\r\n\r\nWe can now use the category name in the template.\r\n\r\n```\r\n> template = Liquid::Template.parse(\"Hi {{category.name}}\")\r\n => #<Liquid::Template:0x007ff86d1fac80 @resource_limits={}, @options={}, @profiling=nil, @line_numbers=nil, @root=#<Liquid::Document:0x007ff86d1fa730 @tag_name=nil, @markup=nil, @options={:locale=>#<Liquid::I18n:0x007ff86bb04508 @path=\"/Users/bparanj/.rvm/gems/ruby-2.3.0@rails5/gems/liquid-3.0.6/lib/liquid/locales/en.yml\">}, @blank=false, @nodelist=[\"Hi \", #<Liquid::Variable:0x007ff86d1fa2f8 @markup=\"category.name\", @name=#<Liquid::VariableLookup:0x007ff86d1f9ad8 @name=\"category\", @lookups=[\"name\"], @command_flags=0>, @options={:locale=>#<Liquid::I18n:0x007ff86bb04508 @path=\"/Users/bparanj/.rvm/gems/ruby-2.3.0@rails5/gems/liquid-3.0.6/lib/liquid/locales/en.yml\">}, @filters=[]>]>, @warnings=nil>\r\n```\r\n\r\nWe can bind the category we found earlier to the template.\r\n\r\n``` \r\n> template.render(\'category\' => c)\r\n => \"Hi Toys & Games\"\r\n```\r\n\r\nIt works. Change the pages controller show action.\r\n\r\n```ruby\r\ndef show\r\n  @page = Page.find_by!(permalink: params[:id])\r\nrescue\r\n  # This is a hack. Do not use exception handling to handle application logic. \r\n  @page = Page.find(params[:id])\r\nend\r\n```\r\n\r\nSince we want to focus on liquid, we are committing a sin in the rescue clause. Define `liquid_methods` in the page model.\r\n\r\n```ruby\r\nclass Page < ApplicationRecord\r\n  liquid_methods :products\r\n  \r\n  def products\r\n    Product.all\r\n  end\r\nend\r\n```\r\n\r\nDefine `liquid_methods` for the product model.\r\n\r\n```ruby\r\nclass Product < ApplicationRecord\r\n  belongs_to :category\r\n  liquid_methods :name, :price, :category\r\nend\r\n```\r\n\r\nWe can define a helper that wraps the given content with the liquid template and use RedCloth to convert the liquid syntax to html.\r\n\r\n```ruby\r\nmodule ApplicationHelper\r\n  def liquidize(content, arguments)\r\n    RedCloth.new(Liquid::Template.parse(content).render(arguments, :filters => [LiquidFilter])).to_html\r\n  end\r\nend\r\n```\r\n\r\nTo format the product price, we can use the `number_to_currency` Rails view helper. Define LiquidFilter in lib folder.\r\n\r\n```ruby\r\nmodule LiquidFilter\r\n  include ActionView::Helpers::NumberHelper\r\n  \r\n  def currency(price)\r\n    number_to_currency(price)\r\n  end\r\nend\r\n```\r\n\r\nIn application.rb, add the lib folder to the `autoload_paths`.\r\n\r\n```ruby\r\nmodule Static\r\n  class Application < Rails::Application\r\n    config.autoload_paths << Rails.root.join(\'lib\')\r\n  end\r\nend\r\n```\r\n\r\nRestart the server. Go to the home page and click on the \'About Us\' link. You will get the error.\r\n\r\n```\r\nLiquid error: undefined method `to_liquid&#8217;\r\n```\r\n\r\nThis happens because ActiveRecord::Relation object does not have the `to_liquid` method, the `to_liquid` method is available in ActiveRecord object. So, change the products method in the page model.\r\n\r\n```ruby\r\nclass Page < ApplicationRecord\r\n  liquid_methods :products\r\n  \r\n  def products\r\n    Product.all.to_a\r\n  end\r\nend\r\n```\r\n\r\nNow the products method will return a collection of ActiveRecord objects. If you click the \'About Us\' link, you will see html tags on the browser instead of styled page. We need to use `html_safe` to render the content on the browser. Change the application helper.\r\n\r\n```ruby\r\nmodule ApplicationHelper\r\n  def liquidize(content, arguments)\r\n    squid = Liquid::Template.parse(content).render(arguments, :filters => [LiquidFilter])\r\n    (RedCloth.new(squid).to_html).html_safe\r\n  end\r\nend\r\n```\r\n\r\nGo to the home page and click on the \'About Us\' link. If you see something like this in the browser:\r\n\r\n```\r\nSettlers of Catan Product::LiquidDropClass\r\nCategory: Toys & Games\r\n```\r\n\r\nMake sure there is no space between the product and .price. Instead of:\r\n\r\n```\r\nproduct .price\r\n```\r\n\r\nit should be:\r\n\r\n```\r\nproduct.price\r\n```\r\n\r\nIn the products show page, we can now use the liquidize view helper.\r\n\r\n```rhtml\r\n<%= liquidize @page.content, \'page\' => @page %>\r\n```\r\n\r\nIf you don\'t use the pipe symbol for the product.price, you will not see the price attribute formatted. Make sure it looks like this:\r\n\r\n```\r\n*{{ product.name }}* {{ product.price | currency}}\r\n```\r\n\r\nYou need the pipe followed by the helper name. You can download the source code for this article using the hash be28d7fff75aef263128c2e7e64205309f64044c from `https://github.com/bparanj/static`.\r\n\r\n\r\n## Refactored Solution\r\n\r\nWhile looking for a solution for the error [Liquid error: undefined method `to_liquid`](https://github.com/Shopify/liquid/issues/470 \'Liquid error: undefined method `to_liquid`\'), I came across the suggestion:\r\n\r\n \r\n> Don\'t expose your objects to Liquid directly, encapsulate them in Liquid::Drop subclasses and whitelist only the attributes that you intend to be used within the template.\r\n\r\nDefine a `to_liquid` method in category model.\r\n\r\n```ruby\r\nclass Category < ApplicationRecord\r\n  has_many :products\r\n  \r\n  def to_liquid\r\n    CategoryLiquidDrop.new(self)\r\n  end\r\nend\r\n```\r\n\r\nIt delegates the implementation of liquid related functionality to CategoryLiquidDrop class. Create CategoryLiquidDrop class in the lib folder with the contents:\r\n\r\n```ruby\r\nclass CategoryLiquidDrop < Liquid::Drop\r\n  def initialize(category)\r\n    @category = category\r\n  end\r\n  \r\n  def name\r\n    @category.name\r\n  end\r\nend\r\n```\r\n\r\nIt will work. You can download the refactored version of the source from `https://github.com/bparanj/static` using the hash a18866dfe5330ed8c54e6d4098adb3d305b2100e.\r\n\r\n## Summary\r\n\r\nIn this article, you learned how to use liquid gem with Rails 5 apps to allow users to enter dynamic content that can be evaluated on the server safely. The users of the liquid template must be technically savvy.\r\n\r\n## References\r\n\r\n[Liquid Template in Ruby Done Right] (http://ruby-journal.com/liquid-template-in-ruby-done-right/ \'Liquid Template in Ruby Done Right\')\r\n','2016-04-15 05:22:25','2016-04-15 05:22:25'),(3771,'Tableless Model in Rails 5','In this article, I will go over the changes that is required to make the original railscast on Non ActiveRecord Model to work with Rails 5. Create a new Rails 5 project, controllers and the models.\r\n\r\n```\r\nrails new tles\r\nrails g controller letters index show\r\nrails g controller products index show new create edit update destroy\r\nrails g controller categories index show new create edit update destroy\r\nrails g model category name\r\nrails g model product name price:decimal description:text category:references\r\n```\r\n\r\nDefine the routes.\r\n\r\n```ruby\r\nRails.application.routes.draw do\r\n  resources :products, :categories\r\n  get \'letters/:id\' => \'letters#show\', as: :letters\r\n  get \'alphabets\'     => \'letters#index\'\r\n  root \'products#index\'\r\nend\r\n```\r\n\r\nAdd the following script to seeds.rb.\r\n\r\n```ruby\r\n[\'Electronics\', \'Office Supplies\', \'Toys\', \'Clothing\', \'Groceries\'].each do |name|\r\n  Category.create!(name: name)\r\nend\r\ncategories = Category.all\r\nwords = File.readlines(\"/usr/share/dict/words\")\r\nlorem = \"Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.\"\r\n350.times do\r\n  Product.create!(name: words.sample.titleize, \r\n                  category: categories.sample, \r\n                  description: lorem, \r\n                  price: [4.99, 9.99, 14.99, 19.99, 29.99].sample)\r\nend\r\n```\r\n\r\nMigrate and populate the database.\r\n\r\n```\r\nrails db:migrate\r\nrails db:seed\r\n```\r\n\r\nThe tableless model letter is shown below:\r\n\r\n```ruby\r\nclass Letter\r\n  extend ActiveModel::Naming\r\n  attr_reader :char\r\n  \r\n  def initialize(char)\r\n    @char = char\r\n  end\r\n  def self.all\r\n    (\'A\'..\'Z\').map { |c| new(c) }\r\n  end\r\n  def self.find(param)\r\n    all.detect { |l| l.char == param } \r\n  end\r\n  # This method is not required because we are not using letter resource\r\n  # def to_param\r\n  #   @char.downcase\r\n  # end\r\n  def products\r\n    Product.where(\"name LIKE ?\", @char + \'%\').order(\"name\")\r\n  end\r\n  def to_model\r\n    # You will get to_model error, if you don\'t have this dummy method\r\n  end\r\n  # You need this otherwise you get an error\r\n  def persisted?\r\n    false\r\n  end\r\nend\r\n```\r\n\r\nYou can download the code for this article from `https://github.com/bparanj/tles` with hash 9062df5bf4a0ecb552fc43b6f315875252600d39.\r\n\r\n## Summary\r\n\r\nIn this article, you learned how to use a tableless model in a Rails 5 app.','2016-04-16 06:10:33','2016-04-16 06:10:33'),(3781,'String Interpolation vs to_s Performance in MRI Ruby 2.3.0','Let\'s use benchmark-ips gem to compare the performance of string interpolation vs `to_s` method.\r\n\r\n```ruby\r\nrequire \'benchmark/ips\'\r\n\r\nBenchmark.ips do |x|\r\n  x.report(\"to_s\") { (1+2).to_s }\r\n  x.report(\"String interpolation\") { \"#{1+2}\"}\r\n  # Compare the iterations per second of the various reports!\r\n  x.compare!\r\nend\r\n```\r\n\r\nRun the benchmark.\r\n\r\n```\r\nruby tos.rb\r\n```\r\n\r\nWe see that the string interpolation is 1.72x times slower.\r\n\r\n```\r\nWarming up --------------------------------------\r\n                to_s   151.852k i/100ms\r\nString interpolation   130.251k i/100ms\r\nCalculating -------------------------------------\r\n                to_s      7.028M (± 5.0%) i/s -     35.078M\r\nString interpolation      4.094M (± 3.8%) i/s -     20.449M\r\n\r\nComparison:\r\n                to_s:  7028500.0 i/s\r\nString interpolation:  4094177.4 i/s - 1.72x slower\r\n```\r\n\r\n## Summary\r\n\r\nIn this article, you learned that string interpolation is much slower than `to_s` method.','2016-04-21 07:29:34','2016-04-21 07:29:34'),(3791,'Helpers Outside Views in Rails 5','In this article, we will the changes required to get the original railscast on using helpers outside views working in Rails 5. Here is the create action in products controller:\r\n\r\n```ruby\r\n  def create\r\n    @product = Product.new(allowed_params)\r\n    if @product.save\r\n      flash[:notice] = \"Successfully created product #{view_context.link_to(\'product\', @product)}.\"\r\n      redirect_to @product\r\n    else\r\n      render :new\r\n    end\r\n  end\r\n```\r\n\r\nUse `html_safe` in the application.html.erb.\r\n\r\n```rhtml\r\n<%- flash.each do |name, msg| -%>\r\n  <%= content_tag :div, msg.html_safe, :id => \"flash_#{name}\" %>\r\n<%- end -%>\r\n```\r\n\r\nYou will now see the link to the product in the flash message. You can download the source code from `https://github.com/bparanj/sto.re`.','2016-04-21 07:34:47','2016-04-21 07:35:14'),(3801,'Going Back in Rails 5','In this article, we will see the changes required to get the original railscasts Going Back to work on Rails 5. Create the models.\r\n \r\n```\r\nrails g model product name category:references price:decimal description:text\r\nrails g model category name\r\nrails g model cart token\r\nrails g model cart_item product:references cart:references quantity:integer\r\n```\r\n\r\nChange the migration for `create_cart_times`:\r\n\r\n```ruby\r\nt.integer :quantity, default: 1 \r\n```\r\n\r\nSince we make the quantity default to one, we can delete the following private method:\r\n\r\n```ruby\r\nprivate\r\n\r\ndef default_quantity_to_one\r\n  self.quantity ||= 1\r\nend\r\n```\r\n\r\nin `cart_item` model. Generate the controllers.\r\n\r\n```\r\nrails g controller cart_items create\r\nrails g controller carts show\r\nrails g controller categories\r\nrails g controller products\r\n```\r\n\r\nYou can download the source code for this article from `https://github.com/bparanj/sto.re`. **Note**: Remember to delete `session[:last_product_page]` once the checkout is complete.  ','2016-04-21 07:41:01','2016-04-21 07:41:34'),(3811,'Populating a Database in Rails 5','In this article, we will the changes required to get the railscast episode on Populating a Database to work with Rails 5. Create the models.\r\n\r\n```\r\nrails g model category name\r\nrails g model person name company phone country state city zip street email\r\nrails g model product name price:decimal category:references description:text \r\n```\r\n\r\nMigrate the database. Add the faker and populator gems to Gemfile.\r\n\r\n```ruby\r\ngem \'faker\'\r\ngem \'populator\'\r\n```\r\n\r\nRun bundle. Here is the seeds.rb:\r\n\r\n```ruby    \r\n[Category, Product, Person].each(&:delete_all)\r\n\r\nCategory.populate 20 do |category|\r\n  category.name = Populator.words(1..3).titleize\r\n  Product.populate 10..20 do |product|\r\n    product.category_id = category.id\r\n    product.name = Populator.words(1..5).titleize\r\n    product.description = Populator.sentences(1..2)\r\n    product.price = [4.99, 19.95, 100]\r\n    product.created_at = 2.years.ago..Time.now\r\n  end\r\nend\r\n\r\nPerson.populate 100 do |person|\r\n  person.name    = Faker::Name.name\r\n  person.company = Faker::Company.name\r\n  person.email   = Faker::Internet.email\r\n  person.phone   = Faker::PhoneNumber.phone_number\r\n  person.street  = Faker::Address.street_address\r\n  person.city    = Faker::Address.city\r\n  person.state   = Faker::Address.state_abbr\r\n  person.zip     = Faker::Address.zip_code\r\nend\r\n```\r\n\r\nPopulate the database.\r\n\r\n```\r\nrails db:seed\r\n```\r\n\r\nGenerate the controllers.\r\n\r\n```\r\nrails g controller categories index show new create edit update destroy\r\nrails g controller products index show new create edit update destroy\r\nrails g controller people index\r\n```\r\n\r\nForm tag should have:\r\n\r\n```\r\n<%= instead of <%.\r\n```\r\n\r\nControllers should use strong parameters. Here is the routes.\r\n\r\n```ruby\r\nRails.application.routes.draw do\r\n  resources :categories, :products, :people\r\n  \r\n  root \'products#index\'\r\nend\r\n```\r\n\r\nYou can download the source code for this article from `https://github.com/bparanj/meg`.\r\n\r\n## Reference\r\n\r\n[Faker Gem](https://github.com/stympy/faker \'Faker Gem\')','2016-04-21 07:49:03','2016-04-24 01:06:51'),(3821,'File Uploads using Paperclip in Rails 5','In this article, we will get the paperclip to work with Rails 5. Install imagemagick, for Mac download the [installer](http://cactuslab.com/imagemagick/ \'ImageMagick installer\'). Create controllers for categories and products.\r\n\r\n```\r\nrails g controller categories\r\nrails g controller products\r\n```\r\n\r\nCreate category and product models.\r\n\r\n```\r\nrails g model category name\r\nrails g model product name price:decimal category:references description:text\r\n```\r\n\r\nDeclare the associations. Category has many products and product belongs to category. Copy the script to populate sample data to seeds.rb. Migrate the database and populate the database.\r\n\r\n```\r\nrails db:migrate\r\nrails db:seed\r\n```\r\n\r\nAdd paperclip gem to the Gemfile.\r\n\r\n```ruby\r\ngem \"paperclip\", \"~> 5.0.0.beta1\"\r\n```\r\n\r\nRun bundle.Use the paperclip in the product model.\r\n\r\n```ruby\r\nhas_attached_file :photo\r\n```\r\n\r\nRun the migration generator for paperclip related fields in the product model.  \r\n\r\n```\r\nrails g paperclip product photo\r\n```\r\n\r\nThis generates the following migration file.\r\n\r\n```ruby\r\nclass AddAttachmentPhotoToProducts < ActiveRecord::Migration\r\n  def self.up\r\n    change_table :products do |t|\r\n      t.attachment :photo\r\n    end\r\n  end\r\n\r\n  def self.down\r\n    remove_attachment :products, :photo\r\n  end\r\nend\r\n```\r\n\r\nMigrate the database. Look at the schema.rb to see the new columns for the products table.\r\n\r\n```ruby\r\nt.string   \"photo_file_name\"\r\nt.string   \"photo_content_type\"\r\nt.integer  \"photo_file_size\"\r\nt.datetime \"photo_updated_at\"\r\n```\r\n\r\nAdd the multipart to the product form partial.\r\n\r\n```rhtml\r\n<%= form_for @product, html: { multipart: true } do |f| %>\r\n...\r\n  <p>\r\n  	<%= f.file_field :photo %>\r\n  </p>\r\n  <p><%= f.submit \"Submit\" %></p>\r\n<% end %>\r\n```\r\n\r\nYou will get the error:\r\n\r\n```\r\nPaperclip::Errors::MissingRequiredValidatorError \r\n```\r\n\r\nTo fix this, add validation to product model:\r\n\r\n```ruby\r\nvalidates_attachment_content_type :photo, :content_type => [\"image/jpg\", \"image/jpeg\", \"image/png\", \"image/gif\"]\r\n```\r\n\r\nIf you get the error:\r\n\r\n```\r\nCould not run the `identify` command. Please install ImageMagick.\r\n```\r\n\r\nOpen a new terminal if you are using the terminal that was started before you installed ImageMagick. Now, you can upload a new image for a product in the edit form. Add:\r\n\r\n```rhtml\r\n<%= image_tag @product.photo.url %>\r\n```\r\n\r\nto product show page. You can now view the image in the product show page. You can change the size of the image by passing in :thumb or :medium.\r\n\r\n```rhtml\r\n<%= image_tag @product.photo.url(:thumb) %>\r\n```\r\n\r\nReload to see the thumbnail size image.\r\n\r\n```rhtml\r\n<%= image_tag @product.photo.url(:medium) %>\r\n```\r\n\r\nThe thumb and medium size works because it is declared in `has_attached_file` in the product model. You can copy the views for category, layout and products for the code repository for this article. Product form partial looks like this:\r\n\r\n```rhtml\r\n<%= form_for @product, :html => { :multipart => true } do |f| %>\r\n  same as before\r\n  <p>\r\n    <%= f.file_field :photo %>\r\n  </p>\r\n  <p><%= f.submit \"Submit\" %></p>\r\n<% end %>\r\n```\r\n\r\nThe product show page looks like this:\r\n\r\n```rhtml\r\n<%= image_tag @product.photo.url(:small) %>\r\n```\r\n\r\nFor more customization options, read the docs at `https://github.com/thoughtbot/paperclip`. You can download the source code for this article from `https://github.com/bparanj/pcl.ip`.\r\n\r\n## Summary\r\n\r\nIn this article, you learned how to use paperclip with Rails 5 apps.','2016-04-23 03:27:35','2016-04-23 18:19:23');
INSERT INTO `articles` VALUES (3831,'How to Quickly Revert Changes in Git','Sometimes you experiment with a new feature and you decide not to use a certain library or an approach. You need to revert back to the previous working version. I was working with flip.js jQuery plugin and decided not to use it. The git status shows the files that were modified.\r\n\r\n```\r\n$git status\r\nOn branch master\r\nYour branch is up-to-date with \'origin/master\'.\r\nChanges not staged for commit:\r\n  (use \"git add <file>...\" to update what will be committed)\r\n  (use \"git checkout -- <file>...\" to discard changes in working directory)\r\n\r\n	modified:   app/assets/javascripts/application.js\r\n	modified:   app/assets/stylesheets/application.scss\r\n	modified:   app/controllers/welcome_controller.rb\r\n	modified:   config/routes.rb\r\n```\r\n\r\nYou can list only the modified files like this:\r\n\r\n```\r\n$git ls-files -m\r\napp/assets/javascripts/application.js\r\napp/assets/stylesheets/application.scss\r\napp/controllers/welcome_controller.rb\r\nconfig/routes.rb\r\n\r\nno changes added to commit (use \"git add\" and/or \"git commit -a\")\r\n```\r\n\r\nYou can now combine `xargs` with this output to revert your changes.\r\n\r\n```\r\n$git ls-files -m | xargs git checkout\r\n$git status\r\nOn branch master\r\nYour branch is up-to-date with \'origin/master\'.\r\nnothing to commit, working directory clean\r\n```','2016-04-23 19:10:47','2016-04-23 19:10:47'),(3841,'How to Play with Rails ActiveModel in IRB','Install the gem.\r\n\r\n```\r\ngem install activemodel\r\n```\r\n\r\nCreate a contact class and mixin ActiveModel.\r\n\r\n```ruby\r\nrequire \'active_model\'\r\n\r\nclass Contact\r\n  include ActiveModel::Model\r\n  \r\n  attr_accessor :name\r\n  \r\n  validates :name, presence: true\r\nend\r\n```\r\n\r\nWe gave defined a name attribute with a validation for it. We can now experiment in the IRB console:\r\n\r\n``` \r\n $ irb\r\n load \'./contact.rb\'\r\n c = Contact.new\r\n c.valid?\r\n # => false\r\n```\r\n\r\nWe need a name for a valid contact object.\r\n\r\n```\r\n bugs = Contact.new(name: \'Bugs Bunny\')\r\n bugs.valid?\r\n => true \r\n```\r\n\r\nThe invalid contact has no name.\r\n\r\n```\r\n c.name\r\n => nil \r\n```\r\n\r\nThe valid contact has a name.\r\n\r\n```\r\n    bugs.name\r\n => \"Bugs Bunny\" \r\n``` \r\n \r\nIf you don\'t provide:\r\n\r\n```ruby\r\n attr_accessor :name\r\n```\r\n \r\nyou will get:\r\n\r\n``` \r\n NoMethodError: undefined method `name=\' for #<Contact:0x004a70>\r\n``` \r\n\r\nwhen you instantiate the object.\r\n\r\n```ruby\r\nbugs = Contact.new(name: \'Bugs Bunny\')\r\n```\r\n\r\n## References\r\n\r\n[Active Model Rails 4](http://blog.remarkablelabs.com/2012/12/activemodel-model-rails-4-countdown-to-2013 \'\')\r\n[Document Structure Resource Collection Representations](http://jsonapi.org/format/#document-structure-resource-collection-representations \'Document Structure Resource Collection Representations\')','2016-04-24 02:52:25','2016-04-24 02:52:25'),(3851,'Thinking Sphinx in Rails 5','## Installation\r\n\r\nTo compile from Source, download [Sphinx](http://sphinxsearch.com/downloads/sphinx-2.2.10-release.tar.gz \'Sphinx\'). Extract the compressed file. Go to the extracted directory and run:\r\n\r\n```\r\n./configure \r\nmake\r\nsudo make install\r\n```\r\n\r\nYou can check the version of Sphinx by running:\r\n\r\n```\r\n$ searchd --help\r\nSphinx 2.2.10-id64-release (2c212e0)\r\nCopyright (c) 2001-2015, Andrew Aksyonoff\r\nCopyright (c) 2008-2015, Sphinx Technologies Inc (http://sphinxsearch.com)\r\n```\r\n\r\n## Rails 5 App Before Sphinx\r\n\r\nCreate the project called tnx.\r\n\r\n```\r\nrails new tnx\r\n```\r\n\r\nCreate the author, article and comment models.\r\n\r\n```\r\nrails g model author first_name last_name\r\nrails g model article name content:text author:references published_at:datetime \r\nrails g model comment name content:text article:references\r\n```\r\n\r\nMigrate the database.\r\n\r\n```\r\nrails db:migrate\r\n```\r\n\r\nLook at the schema.rb. Rails 5 uses InnoDB engine for MySQL. It uses btree algorithm for the indexes.\r\n\r\n```ruby\r\nActiveRecord::Schema.define(version: 20160424025639) do\r\n  create_table \"articles\", force: :cascade, options: \"ENGINE=InnoDB DEFAULT CHARSET=utf8\" do |t|\r\n    t.string   \"name\"\r\n    t.text     \"content\",      limit: 65535\r\n    t.integer  \"author_id\"\r\n    t.datetime \"published_at\"\r\n    t.datetime \"created_at\",                 null: false\r\n    t.datetime \"updated_at\",                 null: false\r\n  end\r\n\r\n  add_index \"articles\", [\"author_id\"], name: \"index_articles_on_author_id\", using: :btree\r\n\r\n  create_table \"authors\", force: :cascade, options: \"ENGINE=InnoDB DEFAULT CHARSET=utf8\" do |t|\r\n    t.string   \"first_name\"\r\n    t.string   \"last_name\"\r\n    t.datetime \"created_at\", null: false\r\n    t.datetime \"updated_at\", null: false\r\n  end\r\n\r\n  create_table \"comments\", force: :cascade, options: \"ENGINE=InnoDB DEFAULT CHARSET=utf8\" do |t|\r\n    t.string   \"name\"\r\n    t.text     \"content\",    limit: 65535\r\n    t.integer  \"article_id\"\r\n    t.datetime \"created_at\",               null: false\r\n    t.datetime \"updated_at\",               null: false\r\n  end\r\n\r\n  add_index \"comments\", [\"article_id\"], name: \"index_comments_on_article_id\", using: :btree\r\n\r\n  add_foreign_key \"articles\", \"authors\"\r\n  add_foreign_key \"comments\", \"articles\"\r\nend\r\n```\r\n\r\nDeclare the associations in the models.\r\n\r\n```ruby\r\nclass Comment < ApplicationRecord\r\n  belongs_to :article\r\nend\r\n```\r\n\r\n```ruby\r\nclass Article < ActiveRecord::Base\r\n  belongs_to :author\r\n  has_many :comments\r\nend\r\n```\r\n\r\nCopy the seeds.rb from first commit of `https://github.com/bparanj/sph.ix` to your project. Run:\r\n\r\n```\r\nrails db:seed\r\n```\r\n\r\n## Rails 5 App with Sphinx\r\n\r\nAdd the following gems to the Gemfile.\r\n\r\n```\r\ngem \'thinking-sphinx\', \'~> 3.1.4\'\r\ngem \'mysql2\', :require => \'thinking_sphinx\'\r\n```\r\n\r\nRun bundle. The mysql2 gem is required, otherwise you will get the error:\r\n\r\n```\r\nrails d/Users/zepho/.rvm/gems/ruby-2.3.0@rails5/gems/thinking-sphinx-3.1.4/lib/thinking_sphinx.rb:6:in `require\': cannot load such file -- mysql2 (LoadError)\r\n```\r\n\r\nGenerate the Sphinx configuration file and process all indices.\r\n\r\n```\r\nrake ts:index\r\nGenerating configuration to /Users/zepho/temp/tnx/config/development.sphinx.conf\r\nSphinx 2.2.10-id64-release (2c212e0)\r\nCopyright (c) 2001-2015, Andrew Aksyonoff\r\nCopyright (c) 2008-2015, Sphinx Technologies Inc (http://sphinxsearch.com)\r\n\r\nusing config file \'/Users/zepho/tnx/config/development.sphinx.conf\'...\r\nFATAL: no indexes found in config file \'/Users/zepho/tnx/config/development.sphinx.conf\'\r\n```\r\n\r\nLet\'s fix this error. Create app/indices/article_index.rb.\r\n\r\n\r\n```ruby\r\nThinkingSphinx::Index.define :article, :with => :active_record do\r\n  # fields\r\n  indexes name, :sortable => true\r\n  indexes content\r\n  indexes [author.first_name, author.last_name], as: :author_name\r\n\r\n  # attributes\r\n  has author_id, published_at\r\nend\r\n```\r\n\r\nRun the rake task again.\r\n\r\n```\r\n$ rake ts:index\r\nGenerating configuration to /Users/zepho/temp/tnx/config/development.sphinx.conf\r\nSphinx 2.2.10-id64-release (2c212e0)\r\nCopyright (c) 2001-2015, Andrew Aksyonoff\r\nCopyright (c) 2008-2015, Sphinx Technologies Inc (http://sphinxsearch.com)\r\n\r\nusing config file \'/Users/zepho/temp/tnx/config/development.sphinx.conf\'...\r\nindexing index \'article_core\'...\r\ncollected 3 docs, 0.0 MB\r\nsorted 0.0 Mhits, 100.0% done\r\ntotal 3 docs, 1476 bytes\r\ntotal 0.165 sec, 8905 bytes/sec, 18.10 docs/sec\r\nskipping non-plain index \'article\'...\r\ntotal 9 reads, 0.016 sec, 0.4 kb/call avg, 1.8 msec/call avg\r\ntotal 12 writes, 0.000 sec, 0.5 kb/call avg, 0.0 msec/call avg\r\n```\r\n\r\nYou can now search using Thinking Sphinx. Let\'s experiment with Thinking Sphinx in rails console.\r\n\r\n```\r\n > Article.search \'fictional\'\r\n  Sphinx Query (31.4ms)  SELECT * FROM `article_core` WHERE MATCH(\'fictional\') AND `sphinx_deleted` = 0 LIMIT 0, 20\r\n  Sphinx  Found 3 results\r\n  Article Load (0.4ms)  SELECT `articles`.* FROM `articles` WHERE `articles`.`id` IN (1, 2, 3)\r\n => [#<Article id: 1, name: \"Batman\", content: \"Batman is a fictional character created by the art...\", author_id: 2, published_at: \"2016-04-10 03:01:03\", created_at: \"2016-04-24 03:01:03\", updated_at: \"2016-04-24 03:01:03\">, #<Article id: 2, name: \"Superman\", content: \"Superman is a fictional comic book superhero appea...\", author_id: 1, published_at: \"2016-04-03 03:01:03\", created_at: \"2016-04-24 03:01:03\", updated_at: \"2016-04-24 03:01:03\">, #<Article id: 3, name: \"Krypton\", content: \"Krypton is a fictional planet in the DC Comics uni...\", author_id: 1, published_at: \"2016-03-20 03:01:03\", created_at: \"2016-04-24 03:01:03\", updated_at: \"2016-04-24 03:01:03\">] \r\n```\r\n\r\nHere we search for the term `fictional` that is in the content field of the articles table. You can use conditions to filter the results.\r\n\r\n```\r\n Article.search conditions: {name: \'Batman\'}\r\n  Sphinx Query (1.3ms)  SELECT * FROM `article_core` WHERE MATCH(\'@name Batman\') AND `sphinx_deleted` = 0 LIMIT 0, 20\r\n  Sphinx  Found 1 results\r\n  Article Load (0.4ms)  SELECT `articles`.* FROM `articles` WHERE `articles`.`id` = 1\r\n => [#<Article id: 1, name: \"Batman\", content: \"Batman is a fictional character created by the art...\", author_id: 2, published_at: \"2016-04-10 03:01:03\", created_at: \"2016-04-24 03:01:03\", updated_at: \"2016-04-24 03:01:03\">] \r\n```\r\n\r\nFor more options read the [quick start guide](http://freelancing-gods.com/thinking-sphinx/quickstart.html \'Thinking Sphnix\'). Add the search form to the articles index page. Remove the spring related gems from Gemfile.\r\n\r\n```\r\ngem \'spring\'\r\ngem \'spring-watcher-listen\', \'~> 2.0.0\'\r\n```\r\n\r\nIt causes headache. Search for the term \'Batman\'. It will work. You can use the order clause.\r\n\r\n```\r\nArticle.search(\'Superman\', order: :name)\r\n  Sphinx Query (1.2ms)  SELECT * FROM `article_core` WHERE MATCH(\'Superman\') AND `sphinx_deleted` = 0 ORDER BY `name` ASC LIMIT 0, 20\r\n  Sphinx  Found 2 results\r\n  Article Load (0.5ms)  SELECT `articles`.* FROM `articles` WHERE `articles`.`id` IN (3, 2)\r\n => [#<Article id: 3, name: \"Krypton\", content: \"Krypton is a fictional planet in the DC Comics uni...\", author_id: 1, published_at: \"2016-03-20 03:01:03\", created_at: \"2016-04-24 03:01:03\", updated_at: \"2016-04-24 03:01:03\">, #<Article id: 2, name: \"Superman\", content: \"Superman is a fictional comic book superhero appea...\", author_id: 1, published_at: \"2016-04-03 03:01:03\", created_at: \"2016-04-24 03:01:03\", updated_at: \"2016-04-24 03:01:03\">] \r\n```\r\n \r\nYou can also use page and `per_page` options if you are using pagination for the search results.\r\n\r\n``` \r\n> Article.search(\'Superman\', page: 1, per_page: 20)\r\n  Sphinx Query (0.8ms)  SELECT * FROM `article_core` WHERE MATCH(\'Superman\') AND `sphinx_deleted` = 0 LIMIT 0, 20\r\n  Sphinx  Found 2 results\r\n  Article Load (0.5ms)  SELECT `articles`.* FROM `articles` WHERE `articles`.`id` IN (2, 3)\r\n => [#<Article id: 2, name: \"Superman\", content: \"Superman is a fictional comic book superhero appea...\", author_id: 1, published_at: \"2016-04-03 03:01:03\", created_at: \"2016-04-24 03:01:03\", updated_at: \"2016-04-24 03:01:03\">, #<Article id: 3, name: \"Krypton\", content: \"Krypton is a fictional planet in the DC Comics uni...\", author_id: 1, published_at: \"2016-03-20 03:01:03\", created_at: \"2016-04-24 03:01:03\", updated_at: \"2016-04-24 03:01:03\">] \r\n```\r\n\r\nYou can provide conditions with the column name and it\'s value.\r\n\r\n``` \r\n> Article.search(\'comics\', conditions: { name: \'Batman\'})\r\n  Sphinx Query (0.9ms)  SELECT * FROM `article_core` WHERE MATCH(\'comics @name Batman\') AND `sphinx_deleted` = 0 LIMIT 0, 20\r\n  Sphinx  Found 1 results\r\n  Article Load (0.5ms)  SELECT `articles`.* FROM `articles` WHERE `articles`.`id` = 1\r\n => [#<Article id: 1, name: \"Batman\", content: \"Batman is a fictional character created by the art...\", author_id: 2, published_at: \"2016-04-10 03:01:03\", created_at: \"2016-04-24 03:01:03\", updated_at: \"2016-04-24 03:01:03\">] \r\n```\r\n\r\nYou can provide a range for the datetime field.\r\n\r\n```\r\n> Article.search(\'Batman\', with: { published_at: 3.weeks.ago..Time.zone.now })\r\n  Sphinx Query (0.8ms)  SELECT * FROM `article_core` WHERE MATCH(\'Batman\') AND `published_at` BETWEEN 1459656037 AND 1461470437 AND `sphinx_deleted` = 0 LIMIT 0, 20\r\n  Sphinx  Found 1 results\r\n  Article Load (0.5ms)  SELECT `articles`.* FROM `articles` WHERE `articles`.`id` = 1\r\n => [#<Article id: 1, name: \"Batman\", content: \"Batman is a fictional character created by the art...\", author_id: 2, published_at: \"2016-04-10 03:01:03\", created_at: \"2016-04-24 03:01:03\", updated_at: \"2016-04-24 03:01:03\">] \r\n```\r\n\r\nYou can also provide weights to specify which columns are important.\r\n\r\n```\r\n> Article.search(\'Batman\', field_weights: { name: 20, content: 10, author_name: 5  })\r\n  Sphinx Query (0.8ms)  SELECT * FROM `article_core` WHERE MATCH(\'Batman\') AND `sphinx_deleted` = 0 LIMIT 0, 20 OPTION field_weights=(name=20, content=10, author_name=5)\r\n  Sphinx  Found 1 results\r\n  Article Load (0.5ms)  SELECT `articles`.* FROM `articles` WHERE `articles`.`id` = 1\r\n => [#<Article id: 1, name: \"Batman\", content: \"Batman is a fictional character created by the art...\", author_id: 2, published_at: \"2016-04-10 03:01:03\", created_at: \"2016-04-24 03:01:03\", updated_at: \"2016-04-24 03:01:03\">] \r\n```\r\n \r\nSearch for: Batman | Krypton. You will get the resulting of `or` of the two search terms.\r\n\r\n## Summary\r\n\r\nIn this article, we used Thinking Sphinx to search in Rails 5 apps.','2016-04-24 06:26:32','2016-04-24 06:26:32'),(3861,'Rails 5 Extras','In this article, we will discuss how to get the railscast episode 140 to work with Rails 5. You can use `find_by` with a given value for a table column.\r\n \r\n```\r\n> Product.find_by(price: 3)\r\n  Product Load (0.2ms)  SELECT  \"products\".* FROM \"products\" WHERE \"products\".\"price\" = ? LIMIT ?  [[\"price\", 3], [\"LIMIT\", 1]]\r\n => nil\r\n```\r\n\r\nThis returns nil when a record is not found. The bang equivalent throws an exception.\r\n\r\n``` \r\n> Product.find_by!(price: 3)\r\n  Product Load (0.1ms)  SELECT  \"products\".* FROM \"products\" WHERE \"products\".\"price\" = ? LIMIT ?  [[\"price\", 3], [\"LIMIT\", 1]]\r\nActiveRecord::RecordNotFound: Couldn\'t find Product\r\n```\r\n\r\nRails 5 does not have `find_last_by` method.\r\n\r\n```\r\n> Product.find_last_by(price: 4.99)\r\nNoMethodError: undefined method `find_last_by\' for Product (call \'Product.connection\' to establish a connection):Class\r\nDid you mean?  find_by\r\n```\r\n\r\nYou can join products table with categories and specify the value for a given column that you are querying like this:\r\n\r\n```\r\n Product.joins(:category).where(categories: { :name => \'Clothing\' }) \r\n  Product Load (0.2ms)  SELECT \"products\".* FROM \"products\" INNER JOIN \"categories\" ON \"categories\".\"id\" = \"products\".\"category_id\" WHERE \"categories\".\"name\" = ?  [[\"name\", \"Clothing\"]]\r\n => #<ActiveRecord::Relation [#<Product id: 20, name: \"Zymosis\\n\", price: #<BigDecimal:7fa1dbd82e88,\'0.2999E2\',18(36)>, category_id: 4, description: \"Lorem ipsum dolor sit amet, consectetur adipisicin...\", created_at: \"2016-04-26 18:13:05\", updated_at: \"2016-04-26 18:13:05\">, #<Product id: 21, name: \"Zymosimeter\\n\", price: #<BigDecimal:7fa1dbd81c18,\'0.2999E2\',18(36)>, category_id: 4, description: \"Lorem ipsum dolor sit amet, consectetur adipisicin...\", created_at: \"2016-04-26 18:13:05\", updated_at: \"2016-04-26 18:13:05\">]>\r\n``` \r\n\r\nRails 5 will give an error if you use the old way of querying.\r\n\r\n```\r\n> Product.all(:joins => :category, :conditions => { :categories => { :name => \'Clothing\' } })\r\nArgumentError: wrong number of arguments (given 1, expected 0)\r\n```\r\n\r\nRails 5 Refactor of Helper.\r\n\r\n```ruby\r\ndef admin_area\r\n  if admin?\r\n    content_tag(:div, class: \"admin\") do\r\n      yield\r\n    end\r\n  end\r\nend\r\n```\r\n\r\nYou can test this in the rails console by doing `helper.admin_area`. You can hardcode admin? method to return true to test the helper.\r\n\r\n## Summary\r\n\r\nIn this article, you learned how to use some of the Rails 5 ActiveRecord API and `content_tag` helper.','2016-04-27 04:35:29','2016-04-27 04:35:29'),(3871,'Sortable Lists in Rails 5','In this article, you will learn how to get the railscast episode 147 on sortable lists to work with Rails 5.\r\n\r\nAdd:\r\n\r\n```\r\n//= require jquery-ui\r\n```\r\n\r\nto application.js.\r\n\r\nThe `content_tag_for` was available in Rails 3 and 4. It has been removed from Rails 5. You can install `record_tag_helper` to use that tag in Rails 5.\r\n\r\n```ruby\r\ngem \'record_tag_helper\', \'~> 1.0\'\r\n```\r\n\r\nRun bundle. Reload the faq page. You will get the error:\r\n\r\n```\r\ncouldn\'t find file \'jquery-ui\' with type \'application/javascript\'\r\n```\r\n\r\nAdd jquery-ui-rails gem to the Gemfile.\r\n\r\n```ruby\r\ngem \'jquery-ui-rails\'\r\n```\r\n\r\nRun bundle. This still will not work. I installed `jquery-turbolinks` gem to workaround turbolinks conflict with drag and drop functionality. This also failed. I had to remove turbolinks from Rails 5 to get it working.\r\n\r\n- Remove turbolinks gem. \r\n- Remove the turbolins related code in application layout. \r\n- Remove the turbo links require statement in application.js.\r\n\r\nNow the drag and drop will work. You can download the code from [Sortable Lists in Rails 5 without Turbolinks](https://github.com/bparanj/faq.app \'Sortable Lists in Rails 5\'). You don\'t need `acts_as_list gem` to fix the problem where a new faq has null value for the position. When a new faq is created, add a `before_create` action that populates the position attribute to the existing highest position value + 1.','2016-04-28 04:22:40','2016-04-28 04:22:40'),(3881,'Rails 5 ActiveRecord and Partials','In this article, we will see how to get railscast episode 152 to work with Rails 5. \r\n\r\n## Find in Batches\r\n\r\nWe have 30 products in the database.\r\n\r\n```ruby\r\nProduct.count\r\n   (0.4ms)  SELECT COUNT(*) FROM \"products\"\r\n=> 30\r\n```\r\n\r\nWe have 5 categories in the database.\r\n\r\n```ruby\r\nCategory.count\r\n   (0.4ms)  SELECT COUNT(*) FROM \"categories\"\r\n=> 5\r\n```\r\n\r\nWe can find products in batches of 10 by using `find_in_batches`.\r\n\r\n```ruby\r\nProduct.find_in_batches(batch_size: 10) do |batch|\r\n  puts \"Products.batch: #{batch.size}\"\r\nend\r\n```\r\n\r\nThis generates query that retrieves the 30 products in batches of 10.\r\n\r\n```\r\n  Product Load (1.0ms)  SELECT  \"products\".* FROM \"products\" ORDER BY \"products\".\"id\" ASC LIMIT ?  [[\"LIMIT\", 10]]\r\nProducts.batch: 10\r\n  Product Load (0.2ms)  SELECT  \"products\".* FROM \"products\" WHERE (\"products\".\"id\" > 10) ORDER BY \"products\".\"id\" ASC LIMIT ?  [[\"LIMIT\", 10]]\r\nProducts.batch: 10\r\n  Product Load (0.3ms)  SELECT  \"products\".* FROM \"products\" WHERE (\"products\".\"id\" > 20) ORDER BY \"products\".\"id\" ASC LIMIT ?  [[\"LIMIT\", 10]]\r\nProducts.batch: 10\r\n  Product Load (0.1ms)  SELECT  \"products\".* FROM \"products\" WHERE (\"products\".\"id\" > 30) ORDER BY \"products\".\"id\" ASC LIMIT ?  [[\"LIMIT\", 10]]\r\n```\r\n\r\nThe fourth query did not return any result, so the loop terminates. We cannot use `each` method to retrieve products in batches.\r\n\r\n```ruby\r\nProduct.each(batch_size: 10) do |product|\r\n  puts product.name\r\nend\r\n```\r\n\r\nYou will get the error.\r\n\r\n```	\r\nNoMethodError: undefined method `each\' for #<Class:0x007fcb>\r\n```\r\n\r\nIn Rails 5, you can use `find_each` instead to retrieve products in batches.\r\n\r\n```ruby\r\nProduct.find_each(batch_size: 10) do |product|\r\n  puts product.name\r\nend\r\n```\r\n\r\nThis prints the product names in batches of ten.\r\n\r\n```	\r\nProduct Load (0.5ms)  SELECT  \"products\".* FROM \"products\" ORDER BY \"products\".\"id\" ASC LIMIT ?  [[\"LIMIT\", 10]]\r\nPupilize\r\nPhototherapy\r\nUnenjoyingly\r\nAnagyrine\r\nTwigful\r\nGibbosity\r\nPrewar\r\nCurrentness\r\nDamenization\r\nPropagability\r\n  Product Load (0.4ms)  SELECT  \"products\".* FROM \"products\" WHERE (\"products\".\"id\" > 10) ORDER BY \"products\".\"id\" ASC LIMIT ?  [[\"LIMIT\", 10]]\r\nOmnitonic\r\nAutohemic\r\nUnvaleted\r\nInterfault\r\nMenyie\r\nBosthoon\r\nChainon\r\nBirefractive\r\nTaylor\r\nProdigalize\r\n  Product Load (0.1ms)  SELECT  \"products\".* FROM \"products\" WHERE (\"products\".\"id\" > 20) ORDER BY \"products\".\"id\" ASC LIMIT ?  [[\"LIMIT\", 10]]\r\nLucban\r\nStealage\r\nChorus\r\nVidendum\r\nBlighting\r\nUbuntu Phone\r\nUbuntu Tablet\r\nSnow Ball\r\nPillow\r\nHummus\r\n  Product Load (0.3ms)  SELECT  \"products\".* FROM \"products\" WHERE (\"products\".\"id\" > 30) ORDER BY \"products\".\"id\" ASC LIMIT ?  [[\"LIMIT\", 10]]\r\n```\r\n\r\n# Default Scope\r\n\r\nYou can define a `default_scope` for product model.\r\n\r\n```ruby\r\ndefault_scope -> { where(price: 4.99) } \r\n```\r\n\r\nRun reload to pick up the product model changes in the rails console.\r\n\r\n```\r\n> reload!\r\nReloading...\r\n => true\r\n```\r\n\r\nIf we count the products:\r\n\r\n```ruby \r\nProduct.count\r\n   (0.9ms)  SELECT COUNT(*) FROM \"products\" WHERE \"products\".\"price\" = ?  [[\"price\", 4.99]]\r\n => 4\r\n```\r\n\r\nWe get only 4, because the `default_scope` only retrieves products with price 4.99. We can use the order in the `default_scope`.\r\n\r\n```ruby\r\ndefault_scope { order(\'price ASC\') } \r\n```\r\n\r\nNotice that in this case, the literal proc constructor -> is not used. Eww! the ugly ActiveRecord API is pushing the complexity onto the web developers. Reload the changes.\r\n\r\n```\r\n> reload!\r\nReloading...\r\n => true\r\n```\r\n\r\nIf we now count the products:\r\n\r\n```ruby \r\nProduct.count\r\n   (0.3ms)  SELECT COUNT(*) FROM \"products\"\r\n => 30\r\n```\r\n\r\nWe get total number of products in the database. \r\n\r\n## Try\r\n\r\nWe can retrieve a product that has a given price and print its name.\r\n\r\n```ruby \r\nProduct.find_by(price: 4.99).name\r\n  Product Load (2.3ms)  SELECT  \"products\".* FROM \"products\" WHERE \"products\".\"price\" = ? ORDER BY price ASC LIMIT ?  [[\"price\", 4.99], [\"LIMIT\", 1]]\r\n => \"Pupilize\\n\"\r\n```\r\n\r\nIf you query for product that does not have the given price:\r\n\r\n```ruby \r\nProduct.find_by(price: 4.95).name\r\n  Product Load (2.1ms)  SELECT  \"products\".* FROM \"products\" WHERE \"products\".\"price\" = ? ORDER BY price ASC LIMIT ?  [[\"price\", 4.95], [\"LIMIT\", 1]]\r\n```\r\n\r\nYou will get the error:\r\n\r\n```\r\nNoMethodError: undefined method `name\' for nil:NilClass\r\n```\r\n\r\nWe can use try method. \r\n\r\n```ruby\r\nProduct.find_by(price: 4.95).try(:name)\r\n  Product Load (0.2ms)  SELECT  \"products\".* FROM \"products\" WHERE \"products\".\"price\" = ? ORDER BY price ASC LIMIT ?  [[\"price\", 4.95], [\"LIMIT\", 1]]\r\n => nil\r\n```\r\n\r\nThis returns nil instead of throwing an exception.\r\n\r\n## Removing Iteration in the Views\r\n \r\nIn Rails 1.x, if you had a loop in products/index.html.erb:\r\n\r\n```rhtml\r\n<% for product in @products %>\r\n  <div class=\"product\">\r\n    <h3>\r\n      <%= link_to h(product.name), product %>\r\n      <%= number_to_currency(product.price) %>\r\n    </h3>\r\n    Category: <%=h product.category.name %>\r\n    <%= form_for product.cart_items.build do |f| %>\r\n      <%= f.hidden_field :product_id %>\r\n      <%= f.submit \"Add to Cart\" %>\r\n    <% end %>\r\n  </div>\r\n<% end %>\r\n```\r\n\r\nto display all products. Since 2.x, you can eliminate the loop. Create a products/index.html.erb:\r\n\r\n```rhtml\r\n<%= render @products %>\r\n```\r\n\r\nThe render takes a collection. Create a product partial `_product.html.erb` to display the product show page:\r\n\r\n```rhtml\r\n<div class=\"product\">\r\n<h3>\r\n  <%= link_to h(product.name), product %>\r\n  <%= number_to_currency(product.price) %>\r\n</h3>\r\nCategory: <%=h product.category.name %>\r\n<%= form_for product.cart_items.build do |f| %>\r\n  <%= f.hidden_field :product_id %>\r\n  <%= f.submit \"Add to Cart\" %>\r\n<% end %>\r\n</div>\r\n```\r\n\r\nYou can download the source code for this article from [store](https://github.com/bparanj/sto.re \'store rails5\') using the hash: 35b0eb8a7ebdbd01eff35cb2b54bef3cb98fdb4c.\r\n\r\n## Summary\r\n\r\nIn this article, we saw how to get railscast episode 152 example to work with Rails 5.\r\n','2016-05-01 00:49:50','2016-05-01 00:54:28'),(3891,'PDFs with Prawn in Rails 5','Generate the `order` and `line_item` models.\r\n\r\n```\r\nrails g model order order_number\r\nrails g model line_item name unit_price:decimal quantity:integer order:references\r\n```\r\n\r\nCopy the seeds.rb:\r\n\r\n```ruby\r\norder = Order.create!(order_number: \"24601\")\r\norder.line_items.create!(name: \"Settlers of Catan\", unit_price: 29.95, quantity: 1)\r\norder.line_items.create!(name: \"Technodrome\", unit_price: 24.99, quantity: 2)\r\norder.line_items.create!(name: \"RailsCasts Pro Subscription\", unit_price: 9.00, quantity: 1)\r\norder.line_items.create!(name: \"Flux Capacitor\", unit_price: 1955.00, quantity: 1)\r\norder.line_items.create!(name: \"TextMate 2\", unit_price: 75.00, quantity: 3)\r\n```\r\n\r\nGenerate the orders controller.\r\n\r\n```ruby\r\nclass OrdersController < ApplicationController\r\n  def index\r\n    @orders = Order.all\r\n  end\r\n\r\n  def show\r\n    @order = Order.find(params[:id])\r\n  end\r\nend\r\n```\r\n\r\nHere is the order model.\r\n\r\n```ruby\r\nclass Order < ApplicationRecord\r\n  has_many :line_items\r\n\r\n  def total_price\r\n    # convert to array so it doesn\'t try to do sum on database directly\r\n    line_items.to_a.sum(&:full_price)\r\n  end\r\nend\r\n```\r\n\r\nHere is the LineItem model.\r\n\r\n```ruby\r\nclass LineItem < ApplicationRecord\r\n  belongs_to :order\r\n  \r\n  def full_price\r\n    unit_price * quantity\r\n  end\r\nend\r\n```\r\n\r\nCreate the tables, populate the database and start the rails server.\r\n\r\n```\r\nrails db:migrate\r\nrails db:seed\r\nrails s\r\n```\r\n\r\nHere is the routes.rb.\r\n\r\n```ruby\r\nRails.application.routes.draw do\r\n  root \'orders#index\'\r\n  \r\n  resources :orders\r\nend\r\n```\r\n\r\nHere is the orders/index.html.erb.\r\n\r\n```rhtml\r\n<h1>Orders</h1>\r\n<ul>\r\n<% @orders.each do |order| %>\r\n  <li><%= link_to \"Order \\##{order.order_number}\", order %></li>\r\n<% end %>\r\n</ul>\r\n```\r\n\r\nThis will display the link to all orders in our database. Let\'s add prawn gem to Gemfile.\r\n\r\n```ruby\r\ngem \'prawn\'\r\n```\r\n\r\nRun bundle. The Prawn version used in this article is 2.1.1. The `/actionpack/lib/action_dispatch/http/mime_types.rb` has already registered PDF as one of the MIME types. So we don\'t have to do anything. Change the show action in the orders controller:\r\n\r\n```ruby\r\ndef show\r\n  @order = Order.find(params[:id])\r\n  respond_to do |format|\r\n    pdf = Prawn::Document.new\r\n    pdf.text \'Hello World\'\r\n    \r\n    send_data pdf.render\r\n  end\r\nend\r\n```\r\n\r\nYou will get the error:\r\n\r\n```\r\nActionController::UnknownFormat\r\n```\r\n\r\nInstall the responders gem by adding it to the Gemfile and running bundle install.\r\n\r\n```ruby\r\ngem \'responders\'\r\n```\r\n\r\nThe show actions will look like this:\r\n\r\n```ruby\r\ndef show\r\n  @order = Order.find(params[:id])\r\n  respond_to do |format|\r\n    format.html\r\n    format.pdf do\r\n      pdf = Prawn::Document.new\r\n      pdf.text \'Hello World\'\r\n    \r\n      send_data pdf.render        \r\n    end\r\n  end\r\nend\r\n```\r\n\r\nBrowse to `http://localhost:3000/orders/1` to the order displayed as a table on the browser. The `http://localhost:3000/orders/1.pdf` will download a PDF file with \'Hello World\'. Change the `send_data` method to provide the file name and inline display of the pdf.\r\n\r\n```ruby\r\nsend_data pdf.render, \r\n          filename: \"order_#{@order.order_number}\",\r\n          type: \'application/pdf\',\r\n          disposition: \'inline\'\r\n```\r\n\r\nIt will now display the PDF file in the browser. You have to restart the server to make it display on the browser. Add a link to pdf document to the end of orders/show.html.erb:\r\n\r\n```rhtml\r\n<p>\r\n  <%= link_to \"Printable Receipt (PDF)\", order_path(@order, format: \'pdf\') %>\r\n</p>\r\n```\r\n\r\nCreate `order_pdf.rb` in app/pdfs directory.\r\n\r\n```ruby\r\nclass OrderPdf < Prawn::Document\r\n  def initialize\r\n    super\r\n    text \'Order goes here\'\r\n  end\r\nend\r\n```\r\n\r\nChange the action to use this class for generating pdf.\r\n\r\n```ruby\r\nformat.pdf do\r\n  pdf = OrderPdf.new\r\n  send_data pdf.render, \r\n            filename: \"order_#{@order.order_number}\",\r\n            type: \'application/pdf\',\r\n            disposition: \'inline\'\r\nend\r\n```\r\n\r\nRestart the server to see \'Order goes here\'. Change the OrderPdf to display the order number.\r\n\r\n```ruby\r\nclass OrderPdf < Prawn::Document\r\n  def initialize(order)\r\n    super(top_margin: 70)\r\n    @order = order\r\n    text \"Order \\##{@order.order_number}\"\r\n  end\r\nend\r\n```\r\n\r\nPass the order object in the action.\r\n\r\n```ruby\r\nformat.pdf do\r\n  pdf = OrderPdf.new(@order)\r\n  send_data pdf.render, \r\n            filename: \"order_#{@order.order_number}\",\r\n            type: \'application/pdf\',\r\n            disposition: \'inline\'\r\nend\r\n```\r\n\r\nRestart the server to see the order number in the pdf.\r\n\r\n```ruby\r\nclass OrderPdf < Prawn::Document\r\n  def initialize(order)\r\n    super(top_margin: 70)\r\n    @order = order\r\n    order_number\r\n  end\r\n  \r\n  def order_number\r\n    text \"Order \\##{@order.order_number}\", size: 30, style: :bold\r\n  end\r\nend\r\n```\r\n\r\nRestart the server to see the order number in bold. Change the `line_items` method to use the table.\r\n\r\n```ruby\r\ndef line_items\r\n  move_down 20\r\n  table line_item_rows do\r\n    row(0).font_style = :bold\r\n    columns(1..3).align = :right\r\n    self.row_colors = [\'DDDDDD\', \'FFFFFF\']\r\n    self.header = true\r\n  end\r\nend\r\n```\r\n\r\nWe now get alternate row colors.  The table method has been removed from the prawn gem and you will get the error:\r\n\r\n```\r\nundefined method `table\' for #<OrderPdf:0x007fdd0>\r\n```\r\n\r\nif you try to render table. Add the `prawn-table` gem to Gemfile and run bundle.\r\n\r\n```\r\ngem \'prawn-table\'\r\n```\r\n\r\nHere is the final version of the pdf formatter.\r\n\r\n```ruby\r\nclass OrderPdf < Prawn::Document\r\n  def initialize(order, view)\r\n    super(top_margin: 70)\r\n    @order = order\r\n    @view = view\r\n    order_number\r\n    line_items\r\n    total_price\r\n  end\r\n  \r\n  def order_number\r\n    text \"Order \\##{@order.order_number}\", size: 30, style: :bold\r\n  end\r\n  \r\n  def line_items\r\n    move_down 20\r\n    table line_item_rows do\r\n      row(0).font_style = :bold\r\n      columns(1..3).align = :right\r\n      self.row_colors = [\'DDDDDD\', \'FFFFFF\']\r\n      self.header = true\r\n    end\r\n  end\r\n  \r\n  def line_item_rows\r\n    [[\"Product\", \"Qty\", \"Unit Price\", \"Full Price\"]] +\r\n    @order.line_items.map do |item|\r\n      [item.name, item.quantity, price(item.unit_price), price(item.full_price)]\r\n    end\r\n  end\r\n  \r\n  def total_price\r\n    move_down 15\r\n    text \"Total Price: #{price(@order.total_price)}\", size: 16, style: :bold\r\n  end\r\n  \r\n  private\r\n  \r\n  def price(n)\r\n    @view.number_to_currency(n)\r\n  end\r\nend\r\n```\r\n\r\nRestart the server. Now you can see the table. The final code shows how to display the total price and all the prices formatted using `number_to_currency` helper. **Tip**: Instead of restarting the server every time you make a change to PDF generation, you can develop the PDF generation separately that saves the PDF as a file. Look at the examples directory of prawn gem for more details. The source code for this article can be downloaded from [pra.on](https://github.com/bparanj/pra.on \'Prawn in Rails 5\')\r\n\r\n## Summary\r\n\r\nIn this article, you learned how to use Prawn 2.1.1 with Rails 5 to display an order in a table.','2016-05-01 05:29:36','2016-05-03 05:44:36'),(3901,'Polymorphic Association in Rails 5','You can download the source code for this article from [polym.or](https://github.com/bparanj/polym.or \'polymorphic association in Rails 5\'). This article uses Ruby 2.3.1p112 (2016-04-26 revision 54768) [x86_64-darwin11.0] and Rails 5.0.0.beta4. You can watch this tutorial as a screencast [Polymorphic Association in Rails 5](https://itunes.apple.com/us/podcast/rails-screencast/id1142573687 \'Polymorphic Association in Rails 5\').\r\n\r\n## Starter Rails 5 App\r\n\r\nCreate a new Rails 5 project and the article, event and photo models.\r\n\r\n```\r\nrails new polym.or\r\nrails g model article name content:text\r\nrails g model event name starts_at:datetime ends_at:datetime description:text\r\nrails g model photos name filename \r\n```\r\n\r\nCreate the controllers.\r\n\r\n```\r\nrails g controller articles\r\nrails g controller events\r\nrails g controller photos\r\n```\r\n\r\nThe controllers have the standard RESTful actions. Copy the images to app/assets/images folder. Create and populate the tables.\r\n\r\n```\r\nrails db:migrate\r\nrails db:seed\r\n```\r\n\r\nDefine the resources in routes.rb\r\n\r\n```ruby\r\nRails.application.routes.draw do\r\n  resources :photos\r\n  resources :events\r\n  resources :articles\r\n  \r\n  root to: \'articles#index\'\r\nend\r\n```\r\n\r\nStart the server, you will be able to see all the articles in the home page. You can click on the links to photos and events in the navigation.\r\n\r\n## Polymorphic Association\r\n\r\nCreate a comments model.\r\n\r\n```\r\nrails g model comment content:text commentable_id:integer commentable_type\r\n```\r\n\r\nThe generated migration file looks like this:\r\n\r\n```ruby\r\nclass CreateComments < ActiveRecord::Migration[5.0]\r\n  def change\r\n    create_table :comments do |t|\r\n      t.text :content\r\n      t.integer :commentable_id\r\n      t.string :commentable_type\r\n\r\n      t.timestamps\r\n    end\r\n  end\r\nend\r\n```\r\n\r\nAdd index to this file.\r\n\r\n```ruby\r\nclass CreateComments < ActiveRecord::Migration[5.0]\r\n  def change\r\n    create_table :comments do |t|\r\n      t.text :content\r\n      t.integer :commentable_id\r\n      t.string :commentable_type\r\n\r\n      t.timestamps\r\n    end\r\n    add_index :comments, [:commentable_id, :commentable_type]\r\n  end\r\nend\r\n```\r\n\r\nYou can simplify the migration by using:\r\n\r\n```ruby\r\nt.belongs_to :commentable, polymorphic: true\r\n```\r\n\r\nThe migration file now looks like this:\r\n\r\n```ruby\r\nclass CreateComments < ActiveRecord::Migration[5.0]\r\n  def change\r\n    create_table :comments do |t|\r\n      t.text :content\r\n      t.belongs_to :commentable, polymorphic: true\r\n\r\n      t.timestamps\r\n    end\r\n    add_index :comments, [:commentable_id, :commentable_type]\r\n  end\r\nend\r\n```\r\n\r\nRun the migration. Add the polymorphic association to the comment model.\r\n\r\n```ruby\r\nbelongs_to :commentable, polymorphic: true	  \r\n```\r\n	  \r\nAdd \r\n\r\n```ruby\r\nhas_many :comments, as: :commentable\r\n```\r\n\r\nto article, event and photo models. Let\'s experiment in the rails console. We can create a comment for an article.\r\n\r\n```ruby\r\n> a = Article.first\r\n  Article Load (0.2ms)  SELECT  \"articles\".* FROM \"articles\" ORDER BY \"articles\".\"id\" ASC LIMIT ?  [[\"LIMIT\", 1]]\r\n => #<Article id: 1, name: \"Batman\", content: \"Batman is a fictional character created by the art...\", created_at: \"2016-05-01 17:25:05\", updated_at: \"2016-05-01 17:25:05\"> \r\n > c = a.comments.create!(content: \'Hello World\')\r\n   (0.1ms)  begin transaction\r\n  Article Load (0.1ms)  SELECT  \"articles\".* FROM \"articles\" WHERE \"articles\".\"id\" = ? LIMIT ?  [[\"id\", 1], [\"LIMIT\", 1]]\r\n  SQL (0.5ms)  INSERT INTO \"comments\" (\"content\", \"commentable_type\", \"commentable_id\", \"created_at\", \"updated_at\") VALUES (?, ?, ?, ?, ?)  [[\"content\", \"Hello World\"], [\"commentable_type\", \"Article\"], [\"commentable_id\", 1], [\"created_at\", 2016-05-01 17:36:09 UTC], [\"updated_at\", 2016-05-01 17:36:09 UTC]]\r\n   (56.1ms)  commit transaction\r\n => #<Comment id: 1, content: \"Hello World\", commentable_type: \"Article\", commentable_id: 1, created_at: \"2016-05-01 17:36:09\", updated_at: \"2016-05-01 17:36:09\"> \r\n```\r\n\r\nWe can use the polymorphic association to retrieve the article model.\r\n\r\n```ruby \r\n > c.commentable\r\n => #<Article id: 1, name: \"Batman\", content: \"Batman is a fictional character created by the art...\", created_at: \"2016-05-01 17:25:05\", updated_at: \"2016-05-01 17:25:05\"> \r\n``` \r\n\r\nLet\'s create comments controller to list and create new comments.\r\n\r\n```\r\nrails g controller comments index new\r\n```\r\n\r\nDefine the nested resources in routes.rb.\r\n\r\n```ruby\r\nRails.application.routes.draw do\r\n  resources :photos do\r\n    resources :comments\r\n  end\r\n\r\n  resources :events do\r\n    resources :comments\r\n  end\r\n\r\n  resources :articles do\r\n    resources :comments\r\n  end\r\n  \r\n  root to: \'articles#index\'\r\nend\r\n```\r\n\r\nWe can list all the comments for a given article in the index action.\r\n\r\n```ruby\r\nclass CommentsController < ApplicationController\r\n  def index\r\n    @commentable = Article.find(params[:article_id])\r\n    @comments = @commentable.comments\r\n  end\r\n\r\n  def new\r\n  end\r\nend\r\n```\r\n\r\nCopy the views for the comments and comments.scss. Go to `http://localhost:3000/articles/1/comments` to see the comment for the first article we created in the rails console. If you go to `http://localhost:3000/photos/1/comments`, you will get an exception because it is not implemented yet. Generalize the comments controller to handle any of the model involved in the polymorphic association:\r\n\r\n```ruby\r\nclass CommentsController < ApplicationController\r\n  before_action :load_commentable\r\n  \r\n  def index\r\n    @comments = @commentable.comments\r\n  end\r\n\r\n  def new\r\n  end\r\n  \r\n  private\r\n  \r\n  def load_commentable\r\n    resource, id = request.path.split(\'/\')[1,2]\r\n    @commentable = resource.singularize.classify.constantize.find(id)\r\n  end\r\nend\r\n```\r\n\r\nYou can now go to `http://localhost:3000/photos/1/comments` to see empty list for the photo comments. To create a comment, implement new and create action:\r\n\r\n```ruby\r\ndef new\r\n  @comment = @commentable.comments.new\r\nend\r\n\r\ndef create\r\n  @comment = @commentable.comments.new(allowed_params)  \r\n  if @comment.save\r\n    redirect_to [@commentable, :comments], notice: \'Comment created\'\r\n  else\r\n    render :new\r\n  end\r\nend\r\n```\r\n\r\nThe comments/new.html.erb looks like this:\r\n\r\n```rhtml\r\n<h1>New Comment</h1>\r\n\r\n<%= render \'form\' %>\r\n```\r\n\r\n\r\nThe `comments/_form.html.erb` looks like this:\r\n\r\n```rhtml\r\n<%= form_for [@commentable, @comment] do |f| %>\r\n  <% if @comment.errors.any? %>\r\n    <div class=\"error_messages\">\r\n      <h2>Please correct the following errors.</h2>\r\n      <ul>\r\n      <% @comment.errors.full_messages.each do |msg| %>\r\n        <li><%= msg %></li>\r\n      <% end %>\r\n      </ul>\r\n    </div>\r\n  <% end %>\r\n\r\n  <div class=\"field\">\r\n    <%= f.text_area :content, rows: 8 %>\r\n  </div>\r\n  <div class=\"actions\">\r\n    <%= f.submit %>\r\n  </div>\r\n<% end %>\r\n```\r\n\r\nGo to `http://localhost:3000/photos/1/comments/new`. New comment form is displayed. You can now create a comment. Add the comments section and form for the comment to the bottom of the article, photo or event.\r\n\r\n```rhtml\r\n<h2>Comments</h2>\r\n\r\n<%= render \"comments/comments\" %>\r\n<%= render \"comments/form\" %>\r\n```\r\n\r\nChange the articles show action to initialize the variables required in the view:\r\n\r\n```ruby\r\ndef show\r\n  @article = Article.find(params[:id])\r\n  @commentable = @article\r\n  @comments = @commentable.comments\r\n  @comment = Comment.new\r\nend\r\n```\r\n\r\nChange the redirect in the comments controller create action from:\r\n\r\n```ruby\r\nredirect_to [@commentable, :comments], notice: \'Comment created\'\r\n```\r\n\r\nto\r\n\r\n```ruby\r\nredirect_to @commentable, notice: \"Comment created.\"\r\n```\r\n\r\nNow, the user will be redirected to the show page of the article, photo or event when a new comment is created. In the Rails console, we can retrieve comments that belong to different models to see how they differ.\r\n\r\n```sh\r\n > x = Comment.first\r\n  Comment Load (0.2ms)  SELECT  \"comments\".* FROM \"comments\" ORDER BY \"comments\".\"id\" ASC LIMIT ?  [[\"LIMIT\", 1]]\r\n => #<Comment id: 1, content: \"Hello World\", commentable_type: \"Article\", commentable_id: 1, created_at: \"2016-10-19 18:26:58\", updated_at: \"2016-10-19 18:26:58\"> \r\n > y = Comment.second\r\n  Comment Load (0.5ms)  SELECT  \"comments\".* FROM \"comments\" ORDER BY \"comments\".\"id\" ASC LIMIT ? OFFSET ?  [[\"LIMIT\", 1], [\"OFFSET\", 1]]\r\n => #<Comment id: 2, content: \"This is a great photo.\", commentable_type: \"Photo\", commentable_id: 1, created_at: \"2016-10-19 18:53:46\", updated_at: \"2016-10-19 18:53:46\"> \r\n```\r\n\r\nAs you can see in the output, the commentable type specifies whether the comment is for a photo or article. You can also see the `commentable_id` is the same for both records, we can uniquely identify to which model a comment belongs to by combining the `commentable_type` and `commentable_id` column values.\r\n\r\n## Summary\r\n\r\nIn this article, you learned how to implement polymorphic relationship in Rails 5.','2016-05-01 18:50:10','2016-10-29 17:07:13'),(3911,'Factories in Rails 5','Create a user model.\r\n\r\n```\r\nrails g model user username email password_digest admin:boolean\r\n```\r\n\r\nThis creates the following migration file.\r\n\r\n```ruby\r\nclass CreateUsers < ActiveRecord::Migration[5.0]\r\n  def change\r\n    create_table :users do |t|\r\n      t.string :username\r\n      t.string :email\r\n      t.string :password_digest\r\n      t.boolean :admin\r\n\r\n      t.timestamps\r\n    end\r\n  end\r\nend\r\n```\r\n\r\nCreate an article model.\r\n\r\n```\r\nrails g model article name content:text user:references\r\n```\r\n\r\nThis generates the following migration file.\r\n\r\n```ruby\r\nclass CreateArticles < ActiveRecord::Migration[5.0]\r\n  def change\r\n    create_table :articles do |t|\r\n      t.string :name\r\n      t.text :content\r\n      t.references :user, foreign_key: true\r\n\r\n      t.timestamps\r\n    end\r\n  end\r\nend\r\n```\r\n\r\nThis generates the index automatically when you run the migration. You can see it in the schema.rb:\r\n\r\n```ruby\r\nActiveRecord::Schema.define(version: 20160501200819) do\r\n\r\n  create_table \"articles\", force: :cascade do |t|\r\n    t.string   \"name\"\r\n    t.text     \"content\"\r\n    t.integer  \"user_id\"\r\n    t.datetime \"created_at\", null: false\r\n    t.datetime \"updated_at\", null: false\r\n    t.index [\"user_id\"], name: \"index_articles_on_user_id\"\r\n  end\r\n\r\n  create_table \"users\", force: :cascade do |t|\r\n    t.string   \"username\"\r\n    t.string   \"email\"\r\n    t.string   \"password_digest\"\r\n    t.boolean  \"admin\"\r\n    t.datetime \"created_at\",      null: false\r\n    t.datetime \"updated_at\",      null: false\r\n  end\r\n\r\nend\r\n```\r\n\r\nAdd the rspec-rails gem to the Gemfile.\r\n\r\n```ruby\r\ngroup :development, :test do\r\n  gem \'rspec-rails\'\r\nend\r\n\r\n```\r\n\r\nRun bundle. Run the rspec:install generator.\r\n\r\n```\r\nrails generate rspec:install\r\n```\r\n\r\nThis generates rspec configuration files. Create `user_spec.rb` in spec/models folder.\r\n\r\n```ruby\r\nrequire \'rails_helper\'\r\n\r\ndescribe User do\r\n  it \"authenticates with matching username and password\" do\r\n    user = create(:user, username: \"batman\", password: \"secret\")\r\n    User.authenticate(\"batman\", \"secret\").should eq(user)\r\n  end\r\n\r\n  it \"does not authenticate with incorrect password\" do\r\n    create(:user, username: \"batman\", password: \"secret\")\r\n    User.authenticate(\"batman\", \"incorrect\").should be_nil\r\n  end\r\n\r\n  it \"can manage articles he owns\" do\r\n    article = build(:article)\r\n    user = article.user\r\n    user.can_manage_article?(article).should be_true\r\n    user.can_manage_article?(Article.new).should be_false\r\n  end\r\n\r\n  it \"can manage any articles as admin\" do\r\n    build(:admin).can_manage_article?(Article.new).should be_true\r\n    build(:user).can_manage_article?(Article.new).should be_false\r\n  end\r\nend\r\n```\r\n  \r\nRun the migration for test environment. \r\n\r\n```\r\nbin/rails db:migrate RAILS_ENV=test\r\n```\r\n\r\nAdd `factory_girl_rails` gem to the Gemfile.\r\n\r\n```ruby\r\ngroup :test do\r\n  gem \'factory_girl_rails\'\r\nend\r\n```\r\n\r\nin test group. Run bundle. Create `spec/support/factory_girl.rb`:\r\n\r\n```ruby\r\nRSpec.configure do |config|\r\n  config.include FactoryGirl::Syntax::Methods\r\nend\r\n```\r\n\r\nAdd require statement in spec_helper.rb:\r\n\r\n```ruby\r\nrequire \'support/factory_girl\'\r\n```\r\n\r\nAdd bcrypt gem to Gemfile.\r\n\r\n```\r\ngem \'bcrypt\'\r\n```\r\n\r\nRun bundle. In factories.rb in spec folder:\r\n\r\n```ruby\r\nFactoryGirl.define do\r\n  factory :user do\r\n    sequence(:username) { |n| \"foo#{n}\" }\r\n    password \"foobar\"\r\n    email { \"#{username}@example.com\" }\r\n    admin false\r\n    \r\n    factory :admin do\r\n      admin true\r\n    end\r\n  end\r\n  \r\n  factory :article do\r\n    name \"Foo\"\r\n    user\r\n  end\r\nend\r\n```\r\n  \r\nRun rspec. You will get the error:\r\n\r\n```\r\nThe provided regular expression is using multiline anchors (^ or $), which may present a security risk. Did you mean to use \\A and \\z, or forgot to add the :multiline => true option? (ArgumentError)\r\n```\r\n\r\nReplace ^ and $ with \\A and \\z in user model.\r\n\r\n```ruby\r\nvalidates_format_of :username, with: /\\A[-\\w\\._@]+\\z/i, allow_blank: true, message: \"should only contain letters, numbers, or .-_@\"\r\nvalidates_format_of :email, with: /\\A[-a-z0-9_+\\.]+\\@([-a-z0-9]+\\.)+[a-z0-9]{2,4}\\z/i\r\n```\r\n\r\nYou will now get a deprecation warning.\r\n\r\n```\r\nDEPRECATION WARNING: use_transactional_fixtures= is deprecated and will be removed from Rails 5.1 (use use_transactional_tests= instead) (called from <top (required)> at /Users/zepho/temp/fact.ory/spec/models/user_spec.rb:3)\r\n```\r\n\r\nChange rails_helper.rb:\r\n\r\n```ruby\r\nconfig.use_transactional_fixtures= true \r\n```\r\n\r\nto\r\n\r\n```ruby\r\nconfig.use_transactional_tests = true\r\n```\r\n\r\nYou will now get the error:\r\n\r\n```\r\nundefined method `use_transactional_tests=\' for #<RSpec::Core::Configuration:0x007fddbba40650> (NoMethodError)\r\nDid you mean?  use_transactional_fixtures=\r\n```\r\n\r\nProbably fixed in rspec 3.5.0.pre.\r\n\r\n## Summary \r\n\r\nIn this article, you learned how to use `factory_girl` 4.7, RSpec 3.1.x with Rails 5.','2016-05-01 20:57:29','2016-05-01 20:58:37'),(3921,'Authentication using Authlogic 3.4.6 with Rails 4.2.6','In this article, we will see how to get railscast episode 160 to work with Rails 4.2.6 and Authlogic 3.4.6. Add authlogic gem to Gemfile.\r\n\r\n```ruby\r\ngem \'authlogic\'\r\n```\r\n\r\nRun bundle. Generate user model.\r\n\r\n```\r\nrails g model user\r\n```\r\n\r\nChange the users migration.\r\n\r\n```ruby\r\nclass CreateUsers < ActiveRecord::Migration\r\n  def change\r\n    create_table :users do |t|\r\n      t.string :username\r\n      t.string :email\r\n      t.string :crypted_password\r\n      t.string :password_salt\r\n      t.string :persistence_token\r\n           \r\n      t.timestamps null: false\r\n    end\r\n  end\r\nend\r\n```\r\n\r\nRun the migration.\r\n\r\n```\r\nrake db:migrate\r\n```\r\n\r\nAdd authlogic declaration `acts_as_authentic` to user model.\r\n\r\n```ruby\r\nclass User < ActiveRecord::Base\r\n  acts_as_authentic\r\nend\r\n```\r\n\r\nGenerate the users controller with new and edit actions.\r\n\r\n```\r\nrails g controller users new edit\r\n```\r\n\r\nDeclare users resource in routes.rb.\r\n\r\n```ruby\r\nresources :users\r\n```\r\n\r\nAdd the register link application/layout file:\r\n\r\n```rhtml\r\n<div id=\"user_nav\">\r\n  <%= link_to \"Register\", new_user_path %>\r\n</div>\r\n```\r\n\r\nAdd CSS to position navigation bar in application.scss:\r\n\r\n```css\r\ndiv#user_nav { float: right; font-size: 0.9em; }\r\n```\r\n\r\nAdd the following to users/new.html.erb and users/edit.html.erb:\r\n\r\n```rhtml\r\n<%= render \'form\' %>\r\n```\r\n\r\nThe users `_form` partial is:\r\n\r\n```rhtml\r\n<%= form_for @user do |f| %>\r\n  <p>\r\n    <%= f.label :username %><br />\r\n    <%= f.text_field :username %>\r\n  </p>\r\n  <p>\r\n    <%= f.label :email %><br />\r\n    <%= f.text_field :email %>\r\n  </p>\r\n  <p>\r\n    <%= f.label :password %><br />\r\n    <%= f.password_field :password %>\r\n  </p>\r\n  <p>\r\n    <%= f.label :password_confirmation %><br />\r\n    <%= f.password_field :password_confirmation %>\r\n  </p>\r\n  <p><%= f.submit \"Submit\" %></p>\r\n<% end %>\r\n```\r\n\r\nCreate `user_session.rb` in models directory.\r\n\r\n```ruby\r\nclass UserSession < Authlogic::Session::Base\r\nend\r\n```\r\n\r\nCreate the `user_sessions` controller.\r\n\r\n```\r\nrails g controller user_sessions new\r\n```\r\n\r\nImplement the `user_sessions` controller new, create and destroy actions.\r\n\r\n```ruby\r\nclass UserSessionsController < ApplicationController\r\n  def new\r\n    @user_session = UserSession.new\r\n  end\r\n  \r\n  def create\r\n    session_params = params.require(:user_session).permit!\r\n    @user_session = UserSession.new(session_params)\r\n    if @user_session.save\r\n      redirect_to root_url, notice: \'Successfully logged in.\'\r\n    else\r\n      render :new\r\n    end\r\n  end\r\n  \r\n  def destroy\r\n    @user_session = UserSession.find\r\n    @user_session.destroy\r\n    \r\n    redirect_to root_url, notice: \'Successfully logged in.\'\r\n  end\r\nend\r\n```\r\n\r\nThe `user_sessions/new.html.erb` is:\r\n\r\n```rhtml\r\n<%= form_for @user_session do |form| %>\r\n<div class=\"formList\">\r\n  <p>\r\n    <%= form.label :username, \"Username\" %>\r\n    <%= form.text_field :username %>\r\n  </p>\r\n  <p>\r\n    <%= form.label :password, \"Password\" %>\r\n    <%= form.password_field :password %>\r\n  </p>\r\n  <p>\r\n    <%= form.submit \"Submit\" %>\r\n  </p>\r\n</div>\r\n<% end %>\r\n```\r\n\r\nYou will now be able to signup, login and logout. You can download the source code for this article from [al4](https://github.com/bparanj/al4.git \'Authlogic 3.4.6 with Rails 4.2.6\').','2016-05-05 06:36:32','2016-05-05 06:37:31'),(3931,'Rails 5 ActiveJob Basics with Sidekiq','You can watch this tutorial as a screencast [Rails 5 ActiveJob Basics with Sidekiq](https://itunes.apple.com/us/podcast/rails-screencast/id1142573687 \'Rails 5 ActiveJob Basics with Sidekiq\'). Create a new background job.\r\n\r\n```\r\nrails g job newsletter\r\n```\r\n\r\nThe generated job looks like this:\r\n\r\n```ruby \r\nclass NewsletterJob < ApplicationJob\r\n  queue_as :default\r\n\r\n  def perform(*args)\r\n    \r\n  end\r\nend\r\n```\r\n\r\nWe can implement the perform method:\r\n\r\n```ruby\r\nputs \"I am busy mailing newsletter.\"\r\n```\r\n\r\nLet\'s invoke the background job in rails console.\r\n\r\n```ruby \r\nNewsletterJob.perform_later(\'some mailing text\')\r\n Enqueued NewsletterJob (Job ID: 98d0efc9) to Async(default) with arguments: \"some mailing text\"\r\n Performing NewsletterJob from Async(default) with arguments: \"some mailing text\"\r\n  => #<NewsletterJob:0x007f84 @arguments=[\"some mailing text\"], @job_id=\"98d0efc9\", @queue_name=\"default\", @priority=nil, @provider_job_id=\"81e91bd\">\r\n > I am busy mailing newsletter.\r\n Performed NewsletterJob from Async(default) in 6.93ms\r\n``` \r\n\r\nWe can use almost any background job processing library. Let\'s use sidekiq. Add the gem to Gemfile.\r\n\r\n```ruby \r\ngem \'sidekiq\'\r\n```\r\n\r\nRun bundle. In application.rb, specify the `queue_adapter`:\r\n\r\n```ruby\r\nconfig.active_job.queue_adapter = :sidekiq\r\n```\r\n\r\nGenerate a welcome mailer.\r\n\r\n``` \r\nrails g mailer welcome\r\n```\r\n\r\nWe can now use sidekiq to process sending welcome email.\r\n\r\n```ruby \r\nWelcomeMailer.welcome_email(\'Bugs\').deliver_later\r\n Enqueued ActionMailer::DeliveryJob (Job ID: b6d0484b) to Sidekiq(mailers) with arguments: \"WelcomeMailer\", \"welcome_email\", \"deliver_now\", \"Bugs\"\r\n  => #<ActionMailer::DeliveryJob:0x007fc0 @arguments=[\"WelcomeMailer\", \"welcome_email\", \"deliver_now\", \"Bugs\"], @job_id=\"b6d04d738\", @queue_name=\"mailers\", @priority=nil, @provider_job_id=\"6233205f5ae\">\r\n```\r\n \r\nThe argument to `welcome_email` must be serializable. Pass in integer, strings etc, otherwise you get the error:\r\n\r\n```\r\nActiveJob::SerializationError: Unsupported argument type: User\r\n```\r\n\r\n[Rails Screencast episode #14](https://itunes.apple.com/us/podcast/rails-screencast/id1142573687 \'Rails Screecast\') shows how to view the enqued jobs using Sidekiq admin Rack app and how to use Sidekiq to process the jobs in the background. \r\n\r\n## Summary\r\n\r\nIn this article, you learned how to use ActiveJob in Rails 5 to process jobs in the background using sidekiq.','2016-05-05 06:41:49','2016-10-29 17:15:46'),(3941,'Fragment Caching in Rails 5','In development.rb, turn on caching in development environment:\r\n\r\n```ruby\r\nconfig.action_controller.perform_caching = true\r\n```\r\n\r\nEncose the article show page with cache block.\r\n\r\n```rhtml\r\n<% cache @article do %>\r\n  <h1><%= @article.title %></h1>\r\n    <p class=\"author\"><em>from <%=h @article.author %></em></p>\r\n  \r\n    <%=simple_format @article.content %>\r\n  \r\n    <p><%= link_to \"Edit\", edit_article_path(@article) %> | <%= link_to \"Back to Articles\", articles_path %></p>\r\n  \r\n    <% unless @article.comments.empty? %>\r\n      <h2><%= pluralize(@article.comments.size, \'comment\') %></h2>\r\n  \r\n      <div id=\"comments\">\r\n      <% for comment in @article.comments %>\r\n        <div class=\"comment\">\r\n          <strong><%= link_to_unless comment.url.blank?, h(comment.author), h(comment.url) %></strong>\r\n          <em>on <%= comment.created_at.strftime(\'%b %d, %Y at %H:%M\') %></em>\r\n          <%=simple_format comment.content %>\r\n        </div>\r\n      <% end %>\r\n      </div>\r\n    <% end %>\r\n<% end %>\r\n\r\n<h3>Add your comment:</h3>\r\n<%= render :partial => \'comments/form\' %>\r\n```\r\n\r\nThe first time load of the article show page takes 286 ms.\r\n\r\n```\r\nStarted GET \"/articles/1\" for ::1 at 2016-05-05 16:48:26 -0700\r\n  ActiveRecord::SchemaMigration Load (0.1ms)  SELECT \"schema_migrations\".* FROM \"schema_migrations\"\r\nProcessing by ArticlesController#show as HTML\r\n  Parameters: {\"id\"=>\"1\"}\r\n  Article Load (0.1ms)  SELECT  \"articles\".* FROM \"articles\" WHERE \"articles\".\"id\" = ? LIMIT ?  [[\"id\", 1], [\"LIMIT\", 1]]\r\n  Rendering articles/show.html.erb within layouts/application\r\nRead fragment views/articles/1-20160505234454273613/1aa0a9a64322982c2c37d104042d43fc (0.1ms)\r\n  Comment Exists (0.2ms)  SELECT  1 AS one FROM \"comments\" WHERE \"comments\".\"article_id\" = ? LIMIT ?  [[\"article_id\", 1], [\"LIMIT\", 1]]\r\n   (0.1ms)  SELECT COUNT(*) FROM \"comments\" WHERE \"comments\".\"article_id\" = ?  [[\"article_id\", 1]]\r\n  Comment Load (0.2ms)  SELECT \"comments\".* FROM \"comments\" WHERE \"comments\".\"article_id\" = ?  [[\"article_id\", 1]]\r\nWrite fragment views/articles/1-20160505234454273613/1aa0a9a64322982c2c37d104042d43fc (0.1ms)\r\n  Rendered comments/_form.html.erb (15.4ms)\r\n  Rendered articles/show.html.erb within layouts/application (52.4ms)\r\nCompleted 200 OK in 286ms (Views: 249.3ms | ActiveRecord: 1.3ms)\r\n```\r\n\r\nSecond time loading of that page takes only 30 ms. You can see it in development.log file.\r\n\r\n```\r\nStarted GET \"/articles/1\" for ::1 at 2016-05-05 16:48:56 -0700\r\nProcessing by ArticlesController#show as HTML\r\n  Parameters: {\"id\"=>\"1\"}\r\n  Article Load (0.3ms)  SELECT  \"articles\".* FROM \"articles\" WHERE \"articles\".\"id\" = ? LIMIT ?  [[\"id\", 1], [\"LIMIT\", 1]]\r\n  Rendering articles/show.html.erb within layouts/application\r\nRead fragment views/articles/1-20160505234454273613/1aa0a9a64322982c2c37d104042d43fc (0.0ms)\r\n  Comment Exists (0.1ms)  SELECT  1 AS one FROM \"comments\" WHERE \"comments\".\"article_id\" = ? LIMIT ?  [[\"article_id\", 1], [\"LIMIT\", 1]]\r\n   (0.1ms)  SELECT COUNT(*) FROM \"comments\" WHERE \"comments\".\"article_id\" = ?  [[\"article_id\", 1]]\r\n  Comment Load (0.1ms)  SELECT \"comments\".* FROM \"comments\" WHERE \"comments\".\"article_id\" = ?  [[\"article_id\", 1]]\r\nWrite fragment views/articles/1-20160505234454273613/1aa0a9a64322982c2c37d104042d43fc (0.0ms)\r\n  Rendered comments/_form.html.erb (1.3ms)\r\n  Rendered articles/show.html.erb within layouts/application (10.2ms)\r\nCompleted 200 OK in 30ms (Views: 27.2ms | ActiveRecord: 0.6ms)\r\n```\r\n\r\nRails generates the cache key for a given article and knows the corresponding view. We can experiment in the rails console to see the `cache_key` for an article.\r\n\r\n```ruby\r\na = Article.first\r\n  Article Load (0.1ms)  SELECT  \"articles\".* FROM \"articles\" ORDER BY \"articles\".\"id\" ASC LIMIT ?  [[\"LIMIT\", 1]]\r\n => #<Article id: 1, title: \"Fragment Caching\", author: \"Cinco\", content: \"Life would be perfect if we could get away with ca...\", created_at: \"2016-05-05 23:44:54\", updated_at: \"2016-05-05 23:44:54\">\r\n> a.cache_key\r\n => \"articles/1-20160505234454273613\"\r\n``` \r\n\r\nLet\'s edit title for an article. Here is the update to the article record.\r\n\r\n```\r\nStarted PATCH \"/articles/1\" for ::1 at 2016-05-05 16:53:07 -0700\r\nProcessing by ArticlesController#update as HTML\r\n  Parameters: {\"utf8\"=>\"✓\", \"authenticity_token\"=>\"+1JDCPyQ5E0\", \"article\"=>{\"title\"=>\"Fragment Caching in Rails 5\", \"content\"=>\"Life would be perfect if we could get away with caching the entire contents of a page.\", \"author\"=>\"Cinco\"}, \"commit\"=>\"Submit\", \"id\"=>\"1\"}\r\n  Article Load (0.2ms)  SELECT  \"articles\".* FROM \"articles\" WHERE \"articles\".\"id\" = ? LIMIT ?  [[\"id\", 1], [\"LIMIT\", 1]]\r\n   (0.0ms)  begin transaction\r\n  SQL (0.3ms)  UPDATE \"articles\" SET \"title\" = ?, \"updated_at\" = ? WHERE \"articles\".\"id\" = ?  [[\"title\", \"Fragment Caching in Rails 5\"], [\"updated_at\", 2016-05-05 23:53:07 UTC], [\"id\", 1]]\r\n   (0.5ms)  commit transaction\r\nRedirected to http://localhost:3000/articles/1\r\nCompleted 302 Found in 28ms (ActiveRecord: 1.0ms)\r\n```\r\n\r\nIf you now go to the article show page, you can see the updated title of the article. It takes only 38 ms to render the article show page. This time there is a new fragment that is written to the file system. The fragment name ends in ca6be0. The older fragment had a name that ends in 42d43fc.\r\n\r\n```\r\nStarted GET \"/articles/1\" for ::1 at 2016-05-05 16:53:07 -0700\r\nProcessing by ArticlesController#show as HTML\r\n  Parameters: {\"id\"=>\"1\"}\r\n  Article Load (0.1ms)  SELECT  \"articles\".* FROM \"articles\" WHERE \"articles\".\"id\" = ? LIMIT ?  [[\"id\", 1], [\"LIMIT\", 1]]\r\n  Rendering articles/show.html.erb within layouts/application\r\nRead fragment views/articles/1-20160505235307610571/88bf095aecea45718f42d81891ca6be0 (0.0ms)\r\n  Comment Exists (0.1ms)  SELECT  1 AS one FROM \"comments\" WHERE \"comments\".\"article_id\" = ? LIMIT ?  [[\"article_id\", 1], [\"LIMIT\", 1]]\r\n   (0.1ms)  SELECT COUNT(*) FROM \"comments\" WHERE \"comments\".\"article_id\" = ?  [[\"article_id\", 1]]\r\n  Comment Load (0.1ms)  SELECT \"comments\".* FROM \"comments\" WHERE \"comments\".\"article_id\" = ?  [[\"article_id\", 1]]\r\nWrite fragment views/articles/1-20160505235307610571/88bf095aecea45718f42d81891ca6be0 (0.0ms)\r\n  Rendered comments/_form.html.erb (1.7ms)\r\n  Rendered articles/show.html.erb within layouts/application (10.9ms)\r\nCompleted 200 OK in 38ms (Views: 35.0ms | ActiveRecord: 0.4ms)\r\n```\r\n\r\nSo, the cache gets invalidated automatically. The view displays the article title with new name. Add a new comment. The log shows the new article getting saved to the database.\r\n\r\n```\r\nStarted POST \"/comments\" for ::1 at 2016-05-05 16:56:11 -0700\r\nProcessing by CommentsController#create as HTML\r\n  Parameters: {\"utf8\"=>\"✓\", \"authenticity_token\"=>\"6cPhR31qw\", \"comment\"=>{\"article_id\"=>\"1\", \"author\"=>\"Daffy\", \"url\"=>\"\", \"content\"=>\"I don\'t agree.\"}, \"commit\"=>\"Submit\"}\r\n   (0.2ms)  begin transaction\r\n  Article Load (0.1ms)  SELECT  \"articles\".* FROM \"articles\" WHERE \"articles\".\"id\" = ? LIMIT ?  [[\"id\", 1], [\"LIMIT\", 1]]\r\n  SQL (0.3ms)  INSERT INTO \"comments\" (\"author\", \"url\", \"content\", \"article_id\", \"created_at\", \"updated_at\") VALUES (?, ?, ?, ?, ?, ?)  [[\"author\", \"Daffy\"], [\"url\", \"\"], [\"content\", \"I don\'t agree.\"], [\"article_id\", 1], [\"created_at\", 2016-05-05 23:56:11 UTC], [\"updated_at\", 2016-05-05 23:56:11 UTC]]\r\n   (0.5ms)  commit transaction\r\nRedirected to http://localhost:3000/articles/1\r\nCompleted 302 Found in 6ms (ActiveRecord: 1.1ms)\r\n```\r\n\r\nIf you go to the article show page, the new comment is displayed.\r\n\r\n```\r\nStarted GET \"/articles/1\" for ::1 at 2016-05-05 16:56:11 -0700\r\nProcessing by ArticlesController#show as HTML\r\n  Parameters: {\"id\"=>\"1\"}\r\n  Article Load (0.3ms)  SELECT  \"articles\".* FROM \"articles\" WHERE \"articles\".\"id\" = ? LIMIT ?  [[\"id\", 1], [\"LIMIT\", 1]]\r\n  Rendering articles/show.html.erb within layouts/application\r\nRead fragment views/articles/1-20160505235458699422/88bf095aecea45718f42d81891ca6be0 (0.0ms)\r\n  Comment Exists (0.1ms)  SELECT  1 AS one FROM \"comments\" WHERE \"comments\".\"article_id\" = ? LIMIT ?  [[\"article_id\", 1], [\"LIMIT\", 1]]\r\n   (0.1ms)  SELECT COUNT(*) FROM \"comments\" WHERE \"comments\".\"article_id\" = ?  [[\"article_id\", 1]]\r\n  Comment Load (0.1ms)  SELECT \"comments\".* FROM \"comments\" WHERE \"comments\".\"article_id\" = ?  [[\"article_id\", 1]]\r\nWrite fragment views/articles/1-20160505235458699422/88bf095aecea45718f42d81891ca6be0 (0.0ms)\r\n  Rendered comments/_form.html.erb (1.8ms)\r\n  Rendered articles/show.html.erb within layouts/application (12.7ms)\r\nCompleted 200 OK in 39ms (Views: 36.0ms | ActiveRecord: 0.6ms)\r\n```\r\n\r\nThere is no need to add:\r\n\r\n```ruby\r\ntouch: true \r\n```\r\n\r\nto \r\n\r\n```ruby\r\nbelongs_to :article\r\n```\r\n\r\nin comment model.\r\n\r\n## Summary\r\n\r\nIn this article, you learned how to use fragment caching in Rails 5.','2016-05-08 05:19:34','2016-05-08 05:19:57'),(3951,'Cropping Images using jCrop jQuery plugin in Rails 5','Add the rmagick and carrierwave gems to the Gemfile.\r\n\r\n```ruby\r\ngem \'rmagick\'\r\ngem \'carrierwave\'\r\n```\r\n\r\nOn Mac, you can install the pre-requisite imagemagick using brew.\r\n\r\n```\r\nbrew install imagemagick\r\n```\r\n\r\nGenerate an uploader using carrierwave generator.\r\n\r\n```\r\nrails generate uploader Avatar\r\n```\r\n\r\nGenerate a model that has name and avatar string fields.\r\n\r\n```\r\nrails g model user name avatar.\r\n```\r\n\r\nSetup the carrierwave uploader in the user model.\r\n\r\n```ruby\r\nclass User < ApplicationRecord\r\n  mount_uploader :avatar, AvatarUploader\r\nend\r\n```\r\n\r\nGenerate a users controller with the standard restful actions.\r\n\r\n```\r\nrails g controller users\r\n```\r\n\r\nRun the migration.\r\n\r\n```\r\nrails db:migrate\r\n```\r\n\r\nDefine the resource in routes.rb.\r\n\r\n```ruby\r\nRails.application.routes.draw do\r\n  resources :users\r\n  root to: \'users#index\'\r\nend\r\n```\r\n\r\nStart the server.\r\n\r\n```\r\nrails s\r\n```\r\n\r\nCreate an user with an image. You will get the error:\r\n\r\n```\r\nVersion thumb doesn\'t exist!\r\n```\r\n\r\nAdd:\r\n\r\n```ruby\r\nversion :thumb do\r\n  resize_to_fill(100, 100)\r\nend\r\n```\r\n\r\nto `uploaders/avatar_uploader.rb`. Try again, you will get the error:\r\n\r\n```\r\nundefined method `resize_to_fill\' for Class\r\n```\r\n\r\nUncomment:\r\n\r\n```ruby\r\ninclude CarrierWave::RMagick\r\n```\r\n  \r\nin `avatar_uploader.rb`. Add the large version of the image and crop methods to the avatar_uploader.rb.\r\n\r\n```ruby\r\nversion :large do\r\n  resize_to_limit(600, 600)\r\nend\r\n\r\ndef crop\r\n  if model.crop_x.present?\r\n    resize_to_limit(600, 600)\r\n    manipulate! do |img|\r\n      x = model.crop_x.to_i\r\n      y = model.crop_y.to_i\r\n      w = model.crop_w.to_i\r\n      h = model.crop_h.to_i\r\n      img.crop!(x, y, w, h)\r\n    end\r\n  end\r\nend\r\n```\r\n\r\nChange the update create action in the users controller to handle the cropping functionality.\r\n\r\n```ruby\r\ndef update\r\n  @user = User.find(params[:id])\r\n  if @user.update_attributes(allowed_params)\r\n    if params[:user][:avatar].present?\r\n      render :crop\r\n    else\r\n      redirect_to @user, notice: \"Successfully updated user.\"\r\n    end\r\n  else\r\n    render :new\r\n  end\r\nend\r\n\r\ndef create\r\n  @user = User.new(allowed_params)\r\n  if @user.save\r\n    if params[:user][:avatar].present?\r\n      render :crop\r\n    else\r\n      redirect_to @user, notice: \"Successfully created user.\"\r\n    end\r\n  else\r\n    render :new\r\n  end\r\nend\r\n```\r\n\r\nAdd crop.html.erb to app/views/users folder.\r\n\r\n```\r\n<h1>Crop Avatar</h1>\r\n<%= image_tag @user.avatar_url(:large), id: \"cropbox\" %>\r\n<h4>Preview</h4>\r\n<div style=\"width:100px; height:100px; overflow:hidden\">\r\n  <%= image_tag @user.avatar.url(:large), :id => \"preview\" %>\r\n</div>\r\n<%= form_for @user do |f| %>\r\n  <% %w[x y w h].each do |attribute| %>\r\n    <%= f.hidden_field \"crop_#{attribute}\" %>\r\n  <% end %>\r\n  <div class=\"actions\">\r\n    <%= f.submit \"Crop\" %>\r\n  </div>\r\n<% end %>\r\n```\r\n\r\nIf you try now, you will get an error. Change the user model:\r\n\r\n```ruby\r\n  attr_accessor :crop_x, :crop_y, :crop_w, :crop_h\r\n  after_update :crop_avatar\r\n  \r\n  def crop_avatar\r\n    avatar.recreate_versions! if crop_x.present?\r\n  end\r\n```\r\n\r\nDownload the jcrop jquery plugin from the [jcrop](http://deepliquid.com/content/Jcrop.html \'jcrop\') website. Copy jquery.Jcrop.css to vendor/assets/stylesheets and jquery.Jcrop.js to vendor/assets/javascripts directory. In application.js, add:\r\n\r\n```javascript\r\n//= require jquery.Jcrop\r\n```\r\n\r\nIn application.css, add:\r\n\r\n```\r\n*= require jquery.Jcrop\r\n```\r\n\r\nAdd the cropping functionality to users.coffee.\r\n\r\n```javascript\r\njQuery ->\r\n  new AvatarCropper()\r\n\r\nclass AvatarCropper\r\n  constructor: ->\r\n    $(\'#cropbox\').Jcrop\r\n      aspectRatio: 1\r\n      setSelect: [0, 0, 600, 600]\r\n      onSelect: @update\r\n      onChange: @update\r\n  \r\n  update: (coords) =>\r\n    $(\'#user_crop_x\').val(coords.x)\r\n    $(\'#user_crop_y\').val(coords.y)\r\n    $(\'#user_crop_w\').val(coords.w)\r\n    $(\'#user_crop_h\').val(coords.h)\r\n    @updatePreview(coords)\r\n\r\n  updatePreview: (coords) =>\r\n  	$(\'#preview\').css\r\n  		width: Math.round(100/coords.w * $(\'#cropbox\').width()) + \'px\'\r\n  		height: Math.round(100/coords.h * $(\'#cropbox\').height()) + \'px\'\r\n  		marginLeft: \'-\' + Math.round(100/coords.w * coords.x) + \'px\'\r\n  		marginTop: \'-\' + Math.round(100/coords.h * coords.y) + \'px\'\r\n```\r\n\r\nIt will work now. However, the thumb nail will display the area that was not cropped. To fix it, add `process :crop` to `version :thumb` method in avatar_uploader.rb.\r\n\r\n```ruby\r\nversion :thumb do\r\n  process :crop\r\n  resize_to_fill(100, 100)\r\nend\r\n```\r\n\r\nYou can download the source code for this article from [cropper](https://github.com/bparanj/cropper \'cropper\').\r\n\r\n## Summary\r\n\r\nIn this article, you learned how to add image cropping functionality to a Rails 5 app using jCrop jQuery plugin.','2016-05-10 04:40:49','2016-05-10 04:40:49'),(3961,'Full Text Search using ElasticSearch in Rails 5','Elasticsearch is useful for full text searching. We will implement search functionality for a blog that can search articles with any given term in their title or content.\r\n\r\n## Setup a Rails 5 Project\r\n\r\nCreate a new Rails 5 project, controller and model for article resource.\r\n\r\n```\r\nrails new proj5\r\nrails g controller articles\r\nrails g model article title content:text\r\n```\r\n\r\n## Install ElasticSearch\r\n\r\nOn Mac, you can install it using brew.\r\n\r\n```\r\nbrew install elasticsearch\r\n```\r\n\r\n## Start ElasticSearch\r\n\r\nI had to use sudo to start the server.\r\n\r\n```\r\n$ which elasticsearch\r\n/usr/local/bin/elasticsearch\r\n$ sudo /usr/local/bin/elasticsearch\r\n```\r\n\r\nWithout sudo I got the error.\r\n\r\n```\r\n$ /usr/local/bin/elasticsearch\r\n$ log4j:ERROR setFile(null,true) call failed.\r\njava.io.FileNotFoundException: /usr/local/var/log/elasticsearch/elasticsearch_zepho.log (No such file or directory)\r\n	at java.io.FileOutputStream.openAppend(Native Method)\r\n	at java.io.FileOutputStream.<init>(FileOutputStream.java:192)\r\nlog4j:ERROR Either File or DatePattern options are not set for appender [file].\r\n```\r\n\r\n## Validate ElasticSearch Installation\r\n\r\nHit the ElasticServer using curl command.\r\n\r\n```\r\ncurl \'http://localhost:9200/?pretty\'\r\n```\r\n\r\nYou will see the json response from the server.\r\n\r\n```json\r\n{\r\n  \"ok\" : true,\r\n  \"status\" : 200,\r\n  \"name\" : \"Ajaxis\",\r\n  \"version\" : {\r\n    \"number\" : \"0.90.0\",\r\n    \"snapshot_build\" : false\r\n  },\r\n  \"tagline\" : \"You Know, for Search\"\r\n}\r\n```\r\n\r\n## Add ElasticSearch Gems\r\n\r\nIn Gemfile, add:\r\n\r\n```ruby\r\ngem \'elasticsearch-model\'\r\ngem \'elasticsearch-rails\'\r\n```\r\n\r\nand run bundle.\r\n\r\n## Run the Rails 5 App\r\n\r\nCreate a search controller with index action.\r\n\r\n```\r\nrails g controller search\r\n```\r\n\r\nThe index action will handle the search query if the params has value for the search term.\r\n\r\n```ruby\r\ndef index\r\n  if params[:q].nil?\r\n    @articles = Article.all\r\n  else\r\n    @articles = Article.search(params[:q])\r\n  end\r\nend\r\n```\r\n\r\nDefine the resources in the routes.rb.\r\n\r\n```ruby\r\nRails.application.routes.draw do\r\n  resources :articles\r\n  \r\n  get \'search\', to: \'search#index\'\r\nend\r\n```\r\n\r\nNote: When you search, if you get the error:\r\n\r\n```\r\narticles does not exist to be imported into. Use create_index! or the :force option to create it.\r\n```\r\n\r\nAdd the force parameter to fix this problem.\r\n\r\n```ruby\r\nclass Article < ApplicationRecord\r\n  include Elasticsearch::Model\r\nend\r\n\r\n# for auto sync model with elastic search\r\nArticle.import force: true\r\n```\r\n\r\nTwo things must be done so that a new record gets indexed by ElasticSearch.\r\n\r\n```ruby\r\ninclude Elasticsearch::Model::Callbacks\r\n```\r\n	\r\nin your model. After a new record is saved you must call `index_document` method:\r\n\r\n```ruby\r\narticle.__elasticsearch__.index_document\r\n```\r\n\r\nThe include statement also handles the re-indexing of the elasticsearch when an existing record is updated or deleted. To change the default size 10 of search results in ElasticSearch, pass the value for size parameter:\r\n\r\n```ruby\r\n@articles = Article.search(params[:term], size: 1000).records\r\n```  \r\n\r\nYou can download the [code](https://github.com/bparanj/elastic \'elasticsearch\') to run it locally. \r\n\r\n## Summary\r\n\r\nIn this article, you learned how to use ElasticSearch to implement full text search feature in Rails 5 apps.','2016-05-12 23:49:21','2016-05-13 01:39:38'),(3971,'How to style search form using Twitter Bootstrap 3.3.6 in Rails 4.2.6 Apps','<img src=\"https://4.bp.blogspot.com/-WZouynT0D7I/VzV67sw5CoI/AAAAAAAABH8/LTrUNEe4BRgIwm35iIhq64fR0nnfU1N-ACLcB/s1600/Screen%2BShot%2B2016-05-12%2Bat%2B11.56.45%2BPM.png\" style=\"border: 1px solid #000; max-width:600px; max-height:600px;\">\r\n\r\nTo style the search form as shown in the screenshot, you can style the form as follows:\r\n\r\n```rhtml\r\n<%= form_tag(search_path, method: :get, role: \'form\') do %>\r\n  <div class=\'row\'>\r\n	<div class=\"form-group col-xs-6 col-md-4\">\r\n      <%= text_field_tag :term, nil, placeholder: \'Type your search term here\', class: \'form-control\' %> \r\n	  <br>\r\n	  <%= submit_tag \"Search\", class: \"btn btn-primary\" %>\r\n  	  <%= submit_tag \"Reset\", class: \"btn btn-default\", type: \'reset\', value: \'Reset\' %>\r\n    </div>\r\n  </div>\r\n<% end %>\r\n```\r\n\r\nThe reset button will clear out the text if the user changes mind for the search term.','2016-05-13 07:07:42','2016-05-13 07:07:42'),(3981,'Integrating Twitter Bootstrap 4 with Rails 5','In this article, we will develop a movie database webapp using Twitter Bootstrap 4 and Rails 5. I upgraded the Movie Review app developed by Mackenzie Child using Twitter Bootstrap 3.2 and Rails 4.1 to the current versions of Twitter Bootstrap and Rails. You may also be interested in [How to integrate Twitter Bootstrap 3.2 with Rails 4.2](https://rubyplus.com/articles/1371-Integrating-Twitter-Bootstrap-3-3-with-Rails-4-2 \'How to integrate Twitter Bootstrap 3.2 with Rails 4.2\'). You can watch this tutorial as a screencast [Integrating Twitter Bootstrap 4 with Rails 5](https://itunes.apple.com/us/podcast/rails-screencast/id1142573687 \'Integrating Twitter Bootstrap 4 with Rails 5\').\r\n\r\n## Setup Movies Rails 5 App\r\n\r\nTo install Rails 5 RC1, run:\r\n\r\n```\r\ngem install rails --pre\r\n```\r\n\r\nGenerate a new Rails 5 project and generate a movie scaffold.\r\n\r\n```\r\nrails g scaffold movie title duration director rating description:text\r\n```\r\n\r\nMigrate the database.\r\n\r\n```\r\nrails db:migrate\r\n```\r\n\r\nInstall imagemagick. On Mac:\r\n\r\n```\r\nbrew install imagemagick\r\nWarning: imagemagick-6.9.2-4 already installed\r\n```\r\n\r\nAdd paperclip gem to Gemfile.\r\n\r\n```ruby\r\ngem \"paperclip\", \"~> 5.0.0.beta1\"\r\n```\r\n\r\nRun bundle. Add the paperclip methods to the movie model:\r\n\r\n```ruby\r\nhas_attached_file :poster, styles: { medium: \"400x600#\" }\r\nvalidates_attachment_content_type :poster, content_type: /\\Aimage\\/.*\\Z/\r\n```\r\n\r\nYou can upload a poster for a movie. Use the paperclip generator to create the file upload fields for movies table.\r\n\r\n```\r\nrails g paperclip movie poster\r\n```\r\n\r\nThe generated migration will add:\r\n\r\n```ruby\r\nt.string   \"poster_file_name\"\r\nt.string   \"poster_content_type\"\r\nt.integer  \"poster_file_size\"\r\nt.datetime \"poster_updated_at\"\r\n```\r\n\r\nto the movies table. Migrate the database.\r\n\r\n```\r\nrails db:migrate\r\n```\r\n\r\nChange the scaffold generated movie form partial to add `multipart` and file upload field:\r\n\r\n```rhtml\r\n<%= form_for(movie, html: { multipart: true }) do |f| %>\r\n  ... same as before\r\n  <div class=\"field\">\r\n    <%= f.label :image %>\r\n    <%= f.file_field :image %>\r\n  </div>\r\n  ... same as before\r\n```\r\n\r\nChange the `movie_params` method to allow the poster to be uploaded.\r\n\r\n```ruby\r\ndef movie_params\r\n  params.require(:movie).permit(:title, :duration, :director, :rating, :description, :poster)\r\nend\r\n```\r\n\r\nPoster will not show up. You need to use the same name you used in the movie model. Change the view:\r\n\r\n```rhtml\r\n  <div class=\"field\">\r\n    <%= f.label :poster %>\r\n    <%= f.file_field :poster %>\r\n  </div>\r\n```\r\n\r\nDisplay the movie poster in the movie show page.\r\n\r\n```rhtml\r\n<%= image_tag @movie.poster.url(:medium) %>\r\n```\r\n\r\nNow you can see the uploaded movie poster. Add:\r\n\r\n```\r\n/public/system/movies/posters\r\n```\r\n\r\nto .gitignore. We don\'t want to upload images to git.\r\n\r\n## Integrate Twitter Bootstrap 4 with Rails 5\r\n\r\nAdd bootstrap gem to Gemfile.\r\n\r\n```ruby\r\ngem \'bootstrap\', \'~> 4.0.0.alpha3\'\r\n```\r\n\r\nRun bundle. Add:\r\n\r\n```\r\n@import \"bootstrap\";\r\n```\r\n\r\nto application.css. Rename application.css to application.scss. Remove:\r\n\r\n```\r\n*= require_tree .\r\n*= require_self\r\n```\r\n\r\nfrom application.scss. Use `@import` to import sass files. Add:\r\n\r\n```\r\n//= require bootstrap\r\n```\r\n\r\nto application.js. It will now look like this:\r\n\r\n```\r\n//= require jquery\r\n//= require bootstrap\r\n//= require jquery_ujs\r\n//= require turbolinks\r\n//= require_tree .\r\n```\r\n\r\nNote: If you use bootstrap-sprockets, you will get the error:\r\n\r\n```\r\nFile to import not found or unreadable: bootstrap-sprockets\r\n```\r\n\r\nOnly for Twitter Bootstrap 3, bootstrap-sprockets is used. Create a header partial in app/views/layout folder, `_header.html.erb`.\r\n\r\n```rhtml\r\n<nav class=\"navbar navbar-dark bg-inverse\">\r\n  <%= link_to \"Movie Reviews\", root_path, class: \"navbar-brand\" %>\r\n  <ul class=\"nav navbar-nav\">\r\n\r\n    <li class=\"nav-item active\">\r\n      <a class=\"nav-link\" href=\"movies/new\">New Movie <span class=\"sr-only\">(current)</span></a>\r\n    </li>\r\n    <li class=\"nav-item\">\r\n      <a class=\"nav-link\" href=\"#\">About</a>\r\n    </li>\r\n  </ul>\r\n  <form class=\"form-inline pull-xs-right\">\r\n    <input class=\"form-control\" type=\"text\" placeholder=\"Search\">\r\n    <button class=\"btn btn-success-outline\" type=\"submit\">Search</button>\r\n  </form>\r\n</nav>\r\n```\r\n\r\nDefine the resources in the routes.rb.\r\n\r\n```ruby\r\nRails.application.routes.draw do\r\n  resources :movies do\r\n  	collection do\r\n  		get \'search\'\r\n  	end\r\n  end\r\n  root \'movies#index\'\r\nend\r\n```\r\n\r\nThe layout file displays the header partial for the navigation and displays the content in a container.\r\n\r\n```rhtml\r\n<!DOCTYPE html>\r\n<html>\r\n  <head>\r\n    <title>Film Buff</title>\r\n    <%= csrf_meta_tags %>\r\n\r\n    <%= stylesheet_link_tag    \'application\', media: \'all\', \'data-turbolinks-track\': \'reload\' %>\r\n    <%= javascript_include_tag \'application\', \'data-turbolinks-track\': \'reload\' %>\r\n  </head>\r\n\r\n  <body>\r\n	<%= render \'layouts/header\' %>\r\n	<div class=\"container\">\r\n		<% flash.each do |name, msg| %>\r\n			<%= content_tag(:div, msg, class: \"alert alert-info\") %>\r\n		<% end %>\r\n		<%= yield %>\r\n	</div>\r\n  </body>\r\n</html>\r\n```\r\n\r\nChange the movies index page.\r\n\r\n```rhtml\r\n<div class=\"row\">\r\n  <% @movies.each do |movie| %>\r\n    <div class=\"col-sm-6 col-md-3\">\r\n      <div class=\"thumbnail\">\r\n        <%= link_to (image_tag movie.poster.url(:medium), class: \'image\'), movie %>\r\n      </div>\r\n    </div>\r\n  <% end %>\r\n</div>\r\n```\r\n\r\nYou can now attach a movie poster when you create a movie. You can see all the movies in the home page. We now have the following issues:\r\n\r\n1. The top portion of the movie poster is hidden behind the navigation.\r\n2. The movie posters on the home page overlap.\r\n\r\nTo fix the overlap problem, change the css class used for the image.\r\n\r\n```rhtml\r\n<div class=\"row\">\r\n  <% @movies.each do |movie| %>\r\n    <div class=\"col-sm-6 col-md-5\">\r\n      <div class=\"thumbnail\">\r\n        <%= link_to (image_tag movie.poster.url(:medium), class: \'image\'), movie %>\r\n      </div>\r\n	  <hr/>\r\n    </div>\r\n  <% end %>\r\n</div>\r\n```\r\n\r\nRefer the Twitter Bootstrap Grid System in the resources section of this article to learn more. To fix the navigation bar hiding the poster, add `navbar-fixed-top` to the header partial. It now looks like this:\r\n\r\n```rhtml\r\n<nav class=\"navbar navbar-dark bg-inverse navbar-fixed-top\">\r\n  <%= link_to \"Movie Reviews\", root_path, class: \"navbar-brand\" %>\r\n  <ul class=\"nav navbar-nav\">\r\n\r\n    <li class=\"nav-item active\">\r\n      <a class=\"nav-link\" href=\"movies/new\">New Movie <span class=\"sr-only\">(current)</span></a>\r\n    </li>\r\n    <li class=\"nav-item\">\r\n      <a class=\"nav-link\" href=\"#\">About</a>\r\n    </li>\r\n  </ul>\r\n  <form class=\"form-inline pull-xs-right\">\r\n    <input class=\"form-control\" type=\"text\" placeholder=\"Search\">\r\n    <button class=\"btn btn-success-outline\" type=\"submit\">Search</button>\r\n  </form>\r\n</nav>\r\n```\r\n\r\nWe now have a simple movies database that can show all the movies in a nice grid and if you click on the movie poster, it will show the details of the movie. We have the following in our to do list.\r\n\r\n1. The forms are not styled using Twitter Bootstrap 4. \r\n2. The active class is hard coded in the header partial for showing the current active tab. \r\n\r\nIn order to select the current tab as the active tab, we need to make it dynamic by using a Rails helper. We will tackle these two issues in the next part of this series.\r\n\r\n## Twitter Bootstrap Upgrade Tip\r\n\r\nYou can convert a given Twitter Bootstrap 3.x class to 4.x by using [Bootply](http://upgrade-bootstrap.bootply.com/ \'Bootply\'). However, be careful, sometimes they old classes are not required at all. \r\n\r\n## Summary\r\n\r\nIn this article, you learned how to integrate Twitter Bootstrap 4 with Rails 5 apps. \r\n\r\n## References\r\n\r\n- [Twitter Bootstrap 4 Docs](http://getbootstrap.com/components/#navbar-fixed-top \'Twitter Bootstrap 4 Docs\') \r\n- [Twitter Bootstrap 3 with Rails 4](https://github.com/mackenziechild/movie_review \'Twitter Bootstrap 3 with Rails 4\') by Mackenzie Child\r\n- [Twitter Bootstrap Grid System](http://www.quackit.com/bootstrap/bootstrap_4/tutorial/bootstrap_grid_system.cfm \'Twitter Bootstrap Grid System\')','2016-05-14 17:10:30','2016-12-23 01:05:36'),(3991,'Twitter Bootstrap 4 Forms and Navigation in Rails 5','We will continue to work on the Movies database Rails 5 app we developed in [Integrating Twitter Bootstrap 4 with Rails 5](https://rubyplus.com/articles/3981-Integrating-Twitter-Bootstrap-4-with-Rails-5 \'Integrating Twitter Bootstrap 4 with Rails 5\'). In this article, you will learn how to style the forms and highlight the navigation tabs using Twitter Bootstrap 4.\r\n\r\nGenerate a welcome controller with about action.\r\n\r\n```\r\nrails g controller welcome about\r\n```\r\n\r\nAdd some text to the about.html.erb. Define the routes for the about page.\r\n\r\n```ruby\r\nget \'welcome/about\', to: \'welcome#about\', as: :about\r\n```\r\n\r\nChange the static links in the header partial.\r\n\r\n```rhtml\r\n<li class=\"nav-item <%= active_class(\'movies\', \'new\') %>\">\r\n  <%= link_to \'/movies/new\', class: \"nav-link\" do %>\r\n	New Movie\r\n	<span class=\"sr-only\"> <%= active_span(\'movies\', \'new\') %> </span>\r\n  <% end %>	  \r\n</li>	\r\n\r\n<li class=\"nav-item <%= active_class(\'welcome\', \'about\') %>\">\r\n  <%= link_to about_path, class: \'nav-link\' do %>\r\n	About\r\n	<span class=\"sr-only\"> <%= active_span(\'welcome\', \'about\') %> </span>\r\n  <% end %>\r\n</li>\r\n```\r\n\r\nAdd helper methods to highlight the navigation tab in `application_helper.rb` file.\r\n\r\n```ruby\r\nmodule ApplicationHelper\r\n  def active_class(controller_name, action_name)    \r\n    \"active\" if current_page?(controller: controller_name, action: action_name)\r\n  end\r\n  \r\n  def active_span(controller_name, action_name)\r\n    \"(current)\" if current_page?(controller: controller_name, action: action_name)\r\n  end\r\nend\r\n```\r\n\r\nYou will now be able to see the tab highlighted when you click on \'New Movies\' or \'About\' page. Let\'s add a border and a box shadow around the page. In application.scss:\r\n\r\n```css\r\n#wrapper {\r\n  border: 1px #e4e4e4 solid;\r\n  padding: 20px;\r\n  border-radius: 4px;\r\n  box-shadow: 0 0 6px #ccc;\r\n  background-color: #fff;\r\n}\r\n```\r\n\r\nIn the layout file use the wrapper.\r\n\r\n```rhtml\r\n<div id= \'wrapper\' class=\"container\">\r\n  <% flash.each do |name, msg| %>\r\n	<%= content_tag(:div, msg, class: \"alert alert-info\") %>\r\n  <% end %>\r\n  \r\n  <%= yield %>\r\n</div>\r\n```\r\n\r\nYou will now see a nice shadow around all the pages in the webapp. You can download the source code for this project from [FilmBuff](https://github.com/bparanj/fbuf \'Film Buff\')\r\n\r\n**Note**: I don\'t know if the drop shadow effect is applicable for tablets and smart phones. Please [let me know](https://www.rubyplus.com/contact \'RubyPlus\') if you have any suggestions.\r\n\r\n## Summary\r\n\r\nIn this article, you learned how to style the form and highlight navigation tab using Twitter Bootstrap 4. We also added a box shadow effect for the pages.\r\n\r\n## Reference\r\n\r\n\r\n[Create a border and a box shadow around the page](http://www.joomla-css.nl/en/create-your-own-joomla-3-template/modify-the-base-template/create-a-border-and-a-box-shadow \'Create a border and a box shadow around the page\')','2016-05-15 19:39:17','2016-05-15 19:39:17'),(4001,'Implementing Search Feature using Searchkick, Twitter Bootstrap 4 and Rails 5','## Install Elasticsearch\r\n\r\nOn Mac:\r\n\r\n```\r\nbrew install elasticsearch\r\nelasticsearch: Java 1.7+ is required to install this formula.\r\nYou can install with Homebrew Cask:\r\n  brew install Caskroom/cask/java\r\n  You can download from:\r\n    http://www.oracle.com/technetwork/java/javase/downloads/index.html\r\n  Error: An unsatisfied requirement failed this build.\r\n```\r\n\r\nJava is a pre-requisite. You can install it by:\r\n\r\n```\r\n$ brew install Caskroom/cask/java\r\n==> Tapping caskroom/cask\r\nCloning into \'/usr/local/Library/Taps/caskroom/homebrew-cask\'...\r\n```\r\n\r\n## Validate ElasticSearch Installation\r\n\r\nUse curl command in the terminal to hit the ElasticSearch server.\r\n\r\n```\r\ncurl -XGET \'localhost:9200\' \r\n```\r\n\r\nYou will get a JSON response.\r\n\r\n```json\r\n{\r\n  \"status\" : 200,\r\n  \"name\" : \"Yukio\",\r\n  \"cluster_name\" : \"elasticsearch_bparanj\",\r\n  \"version\" : {\r\n    \"number\" : \"1.7.3\",\r\n    \"build_hash\" : \"05d4530971ef0ea46d0f4fa6ee64dbc8df659682\",\r\n    \"build_timestamp\" : \"2015-10-15T09:14:17Z\",\r\n    \"build_snapshot\" : false,\r\n    \"lucene_version\" : \"4.10.4\"\r\n  },\r\n  \"tagline\" : \"You Know, for Search\"\r\n}\r\n```\r\n\r\nYou can also verify the ElasticSearch server version.\r\n\r\n## Start the ElasticSearch Server\r\n\r\nYou many need to run the following command as sudo.\r\n\r\n```\r\n$elasticsearch\r\n```\r\n\r\nAdd the searchkick method to the movie model.\r\n\r\n```ruby\r\nclass Movie < ApplicationRecord\r\n  searchkick\r\nend\r\n```\r\n\r\nReindex the movie model.\r\n\r\n```\r\nrake searchkick:reindex CLASS=Movie\r\n```\r\n\r\nIf you don\'t reindex after you install searchkick, you will get the error:\r\n\r\n```\r\nSearchkick::MissingIndexError in SearchController#index\r\nIndex missing - run Article.reindex\r\n```\r\n\r\nYou can add:\r\n\r\n```ruby\r\nself.reindex  \r\n```\r\n\r\nto the Article model instead of running the rake task. This way, you don\'t have to run the rake task on production server. Add the search action to the movies controller.\r\n\r\n```ruby\r\ndef search\r\n  @movies = if params[:term].present?\r\n    Movie.search(params[:term])\r\n  else\r\n    Movie.all\r\n  end\r\nend\r\n```\r\n\r\nAdd the search form to the header partial.\r\n\r\n```rhtml\r\n  <%= form_tag(search_movies_path, method: :get, class: \"form-inline pull-xs-right\", role: \'search\') do %>\r\n    <%= text_field_tag :term, params[:term], class: \'form-control\' %>\r\n	<%= submit_tag \'Search\', name: nil, class: \"btn btn-success-outline\" %>\r\n  <% end %>\r\n```\r\n\r\nCreate search.html.erb.\r\n\r\n```\r\n<div class=\"row\">\r\n  <%= render @movies %>\r\n</div>\r\n```\r\n\r\nCreate a movie partial.\r\n\r\n```rhtml\r\n<div class=\"col-sm-6 col-md-5\">\r\n  <div class=\"thumbnail\">\r\n    <%= link_to (image_tag movie.poster.url(:medium), class: \'image\'), movie %>\r\n  </div>\r\n  <hr/>\r\n</div>\r\n```\r\n\r\nReload the browser. If you get an error:\r\n\r\n```\r\nundefined local variable or method `searchkick\' for #<Class:0x007f2cc8>\r\n```\r\n\r\nRestart the server. You can now search any movie, the cool thing is that even if you make a spelling mistake, searchkick is smart enough to find the movie. For better performance, add:\r\n\r\n```ruby\r\ngem \'typhoeus\'\r\n```\r\n\r\nto Gemfile. Run bundle and create an initializer with:\r\n\r\n```ruby\r\nrequire \"typhoeus/adapters/faraday\"\r\nEthon.logger = Logger.new(\"/dev/null\")\r\n```\r\n\r\nYou can download the source for this article from [Film Buff](https://github.com/bparanj/fbuf \'Film Buff\')\r\n\r\n## Summary\r\n\r\nIn this article, you learned how to implement search functionality using searchkick, Twitter Bootstrap 4 and Rails 5.','2016-05-17 05:33:17','2016-05-17 05:36:46'),(4011,'Using Star Rating jQuery Plugin Raty with Twitter Bootstrap 4 in Rails 5 Apps','## Introduction\r\n\r\nWe will continue working on the Movie database app we developed in the previous article. Style the movie show page.\r\n\r\n## Libraries Used\r\n\r\n- Twitter Bootstrap 4 for CSS Framework\r\n- JQuery Raty Plugin for Star Rating\r\n\r\n## Style Page using Twitter Bootstrap 4\r\n\r\n```rhtml\r\n<p id=\"notice\"><%= notice %></p>\r\n<div class=\"panel panel-default\">\r\n  <div class=\"panel-body\">\r\n    <div class=\"row\">\r\n      <div class=\"col-md-4\">\r\n        <%= image_tag @movie.poster.url(:medium) %>\r\n\r\n        <div class=\"table-responsive\">\r\n          <table class=\"table\">\r\n            <tbody>\r\n              <tr>\r\n                <td><strong>Title:</strong></td>\r\n                <td><%= @movie.title %></td>\r\n              </tr>\r\n              <tr>\r\n                <td><strong>Description:</strong></td>\r\n                <td><%= @movie.description %></td>\r\n              </tr>\r\n              <tr>\r\n                <td><strong>Movie length:</strong></td>\r\n                <td><%= @movie.duration %></td>\r\n              </tr>\r\n              <tr>\r\n                <td><strong>Director:</strong></td>\r\n                <td><%= @movie.director %></td>\r\n              </tr>\r\n              <tr>\r\n                <td><strong>Rating:</strong></td>\r\n                <td><%= @movie.rating %></td>\r\n              </tr>\r\n            </tbody>\r\n          </table>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  </div>\r\n</div>\r\n<div class=\"form-group row\">\r\n  <div class=\"col-sm-10\">\r\n    <%= link_to \'Edit\', edit_movie_path(@movie), class: \'btn btn-primary\' %>\r\n	  <%= link_to \"Back\", movies_path, class: \"btn btn-secondary\" %>\r\n  </div>\r\n</div>\r\n```\r\n\r\nAdd a call to action in the home page by modifying movies/index.html.erb:\r\n\r\n```rhtml\r\n<div class=\'jumbotron\'>\r\n  <h1> Your Favorite Movies Reviewed</h1>\r\n  <p>\r\n	Have you ever been to a movie and realized that it was so bad that you kick yourself for not reading the reviews? Kick yourself, no more. \r\n  </p>\r\n  <p>\r\n	<%= link_to \'Signup To Write a Review\', root_path, class: \'btn btn-primary btn-lg\' %>\r\n  </p>\r\n</div>\r\n```\r\n\r\n## Review a Movie\r\n\r\nCreate a review resource.\r\n\r\n```\r\nrails g scaffold review rating:integer comment:text\r\n```\r\n\r\nMigrate the database.\r\n\r\n```\r\nrails db:migrate\r\n```\r\n\r\nStyle the new review page.\r\n\r\n```rhtml\r\n<%= form_for(review) do |f| %>\r\n  <% if review.errors.any? %>\r\n    <div id=\"error_explanation\">\r\n      <h2><%= pluralize(review.errors.count, \"error\") %> prohibited this review from being saved:</h2>\r\n      <ul>\r\n      <% review.errors.full_messages.each do |message| %>\r\n        <li><%= message %></li>\r\n      <% end %>\r\n      </ul>\r\n    </div>\r\n  <% end %>\r\n  <div class=\"form-group row\">\r\n    <%= f.label :rating, class: \'col-sm-2 form-control-label\' %>\r\n	<div class=\"col-sm-6\">\r\n      <%= f.number_field :rating %>\r\n	</div>\r\n  </div>\r\n  <div class=\"form-group row\">\r\n    <%= f.label :comment, class: \'col-sm-2 form-control-label\' %>\r\n	<div class=\"col-sm-6\">\r\n      <%= f.text_area :comment, class: \'form-control\' %>\r\n	<div>\r\n  </div>\r\n  <br/>\r\n  <div class=\"form-group row\">\r\n    <div class=\"col-sm-10\">\r\n      <%= f.submit \'Submit\', class: \'btn btn-primary\' %>\r\n	  <%= link_to \"Back\", movies_path, class: \"btn btn-secondary\" %>\r\n    </div>\r\n  </div>\r\n<% end %>\r\n```\r\n\r\nNest the reviews resource in routes.rb.\r\n\r\n```ruby\r\nresources :movies do\r\n  collection do\r\n    get \'search\'\r\n  end\r\n  resources :reviews\r\nend\r\n```\r\n\r\nIn movies show page add a link to write a review.\r\n\r\n```rhtml\r\n<%= link_to \'Write a Review\', new_movie_review_path(@movie) %>\r\n```\r\n\r\nChange the movie form partial to use nested routes for the review url.\r\n\r\n```rhtml\r\n<%= form_for([@movie, review]) do |f| %>\r\n```\r\n\r\nFind the parent in the reviews new action.\r\n\r\n```ruby\r\ndef new\r\n  @movie = Movie.find(params[:movie_id])\r\n  @review = Review.new\r\nend\r\n```\r\n\r\nNow the new review form will render. Change the movie show page to add a link to write a review and display any existing reviews.\r\n\r\n```rhtml\r\n<div class=\"col-md-7 col-md-offset-1\">\r\n  <h1 class=\"review_title\"><%= @movie.title %></h1>\r\n  <% if @reviews.blank? %>\r\n    <h3>No reviews just yet, would you like to add the first!</h3>\r\n    <%= link_to \"Write Review\", new_movie_review_path(@movie), class: \"btn btn-primary\" %>\r\n  <% else %>\r\n    <% @reviews.each do |review| %>\r\n      <div class=\"reviews\">\r\n        <div class=\"star-rating\" data-score= <%= review.rating %> ></div>\r\n        <p><%= review.comment %></p>\r\n      </div>\r\n    <% end %>\r\n  <% end %>\r\n</div>\r\n```\r\n\r\nDeclare the associations in the review and movie models.\r\n\r\n```ruby\r\nclass Review < ApplicationRecord\r\n  belongs_to :movie\r\nend\r\n```\r\n\r\n```ruby\r\nclass Movie < ApplicationRecord\r\n  has_many :reviews\r\nend\r\n```\r\n\r\nAdd the `movie_id` foreign key to reviews table.\r\n\r\n```\r\nrails g migration add_movie_id_to_reviews\r\n```\r\n\r\nChange the generated migration file.\r\n\r\n```ruby\r\nclass AddMovieIdToReviews < ActiveRecord::Migration[5.0]\r\n  def change\r\n    add_column :reviews, :movie_id, :integer\r\n  end\r\nend\r\n```\r\n\r\nMigrate the database.\r\n\r\n```\r\nrails db:migrate\r\n```\r\n\r\nYou can now rate the movie when writing a review using a number field. We will now see how to replace the number field with stars using Raty jQuery plugin.\r\n\r\n## Setup jQuery Raty Plugin\r\n\r\nYou can see a demo of jQuery raty plugin at [raty demo](http://www.htmldrive.net/items/demo/153/jQuery-Raty-A-Star-Rating-Plugin \'raty demo\'). Download the jquery raty plugin zip file from [jquery raty](https://github.com/wbotelhos/raty \'jquery raty\') home page. Copy the jquery.raty.js to vendor/assets/javascripts folder. Copy the star images to app/assets/images folder. Add the raty jQuery library in application.js.\r\n\r\n```\r\n//= require jquery.raty\r\n```\r\n\r\nafter \r\n\r\n```\r\n//= require jquery\r\n```\r\n\r\nAdd the following javascript to the bottom of movie show page.\r\n\r\n```javascript\r\n<script>\r\n    $(\'.star-rating\').raty({\r\n      path: \'/assets/\',\r\n      readOnly: true,\r\n      score: function() {\r\n            return $(this).attr(\'data-score\');\r\n    }\r\n  });\r\n</script>\r\n```\r\n\r\nReload the movie show page. You will now see the rating displayed in star format. Let\'s now make the movie review page use rating star when reviewing a movie. Change the rating from number field to star rating in the rating review form partial.\r\n\r\n```rhtml\r\n<div class=\"form-group row\">\r\n  <%= f.label :rating, class: \'col-sm-2 form-control-label\' %>\r\n  <div class=\"col-sm-6\" id=\'star-rating\'></div>\r\n</div>\r\n```\r\n\r\nAdd the javascript that will submit the user selected star rating to the server at the end of the movie form partial.\r\n\r\n```javascript\r\n<script>\r\n$(\'#star-rating\').raty({\r\n	path: \'/assets\',\r\n	scoreName: \'review[rating]\'\r\n});\r\n</script>\r\n```\r\n\r\n## Display Average Rating\r\n\r\nLet\'s now display average rating in the movie show page.\r\n\r\n```rhtml\r\n<div class=\'star-rating\' data-score=<%= @avg_rating %>></div>\r\n<em><%= \"#{@reviews.size} reviews\" %></em>\r\n```\r\n\r\nCalculate average rating in the movie show action.\r\n\r\n```ruby\r\ndef show\r\n  @reviews = @movie.reviews.to_a\r\n  @avg_rating = if @reviews.blank?\r\n    0\r\n  else\r\n    @movie.reviews.average(:rating).round(2)\r\n  end\r\nend\r\n```\r\n\r\nYou will now see the average rating for a movie under the movie poster. You can download the code for this article from [FilmBuff](https://github.com/bparanj/fbuf \'Film Buff\')\r\n\r\n## Summary\r\n\r\nIn this article, you learned how to use jQuery Raty, star rating plugin with Twitter Bootstrap 4 in Rails 5 app.','2016-05-18 04:56:17','2016-07-16 06:10:02'),(4021,'ActiveModelSerializer Basics in Rails 5','In this article, we will build a simple Rails 5 JSON API only app using `active_model_serializers` gem. Create a new Rails API only app.\r\n\r\n```\r\nrails new rapi --api\r\n```\r\n\r\nIf you list middelware.\r\n\r\n```\r\nrake middleware\r\n```\r\n\r\nYou will see:\r\n\r\n```\r\nuse Rack::Sendfile\r\nuse ActionDispatch::Static\r\nuse ActionDispatch::Executor\r\nuse ActiveSupport::Cache::Strategy::LocalCache::Middleware\r\nuse Rack::Runtime\r\nuse ActionDispatch::RequestId\r\nuse Rails::Rack::Logger\r\nuse ActionDispatch::ShowExceptions\r\nuse ActionDispatch::DebugExceptions\r\nuse ActionDispatch::RemoteIp\r\nuse ActionDispatch::Reloader\r\nuse ActionDispatch::Callbacks\r\nuse ActiveRecord::Migration::CheckPending\r\nuse Rack::Head\r\nuse Rack::ConditionalGet\r\nuse Rack::ETag\r\nuse ActionView::Digestor::PerRequestDigestCacheExpiry\r\nrun Rapi::Application.routes\r\n```\r\n\r\nThe API does not have the middelware that is included in Rails web app such as:\r\n\r\n```\r\nuse Rack::MethodOverride\r\nuse WebConsole::Middleware\r\nuse ActionDispatch::Cookies\r\nuse ActionDispatch::Session::CookieStore\r\nuse ActionDispatch::Flash\r\n```\r\n\r\nIn application_controller.rb:\r\n\r\n```ruby\r\nclass ApplicationController < ActionController::API\r\nend\r\n```\r\n\r\nyou can see it extends from ActionController::API class. Create an article scaffold.\r\n\r\n```\r\nrails g scaffold article title content \r\n```\r\n\r\nAdd `active_model_serializers` gem to Gemfile.\r\n\r\n```ruby\r\ngem \'active_model_serializers\'\r\n```\r\n\r\nand run bundle. Create a serializer for article model.\r\n\r\n``` \r\nrails g serializer article\r\n```\r\n\r\nBy default the generator only includes the id field. We can add other fields in the ArticleSerializer.\r\n\r\n```ruby\r\nclass ArticleSerializer < ActiveModel::Serializer\r\n  attributes :id, :title, :content\r\nend\r\n```\r\n\r\nRun the migration.\r\n\r\n```\r\nrails db:migrate\r\n```\r\n\r\nAdd sample data in seeds.rb:\r\n\r\n```ruby\r\nArticle.create! title: \"Superman\", content: \"Superman is a fictional comic book superhero appearing in publications by DC Comics, widely considered to be an American cultural icon...\"\r\n Article.create! title: \"Krypton\", content: \"Krypton is a fictional planet in the DC Comics universe...\"\r\n Article.create! title: \"Batman & Robin\", content: \"Batman is a fictional character created by the artist Bob Kane and writer Bill Finger...)\"\r\n```\r\n\r\nSeed the database.\r\n\r\n```\r\nrails db:seed\r\n```\r\n\r\nStart the server.\r\n\r\n``` \r\nrails s\r\n```\r\n\r\nHit the articles index endpoint using curl.\r\n\r\n``` \r\ncurl http://localhost:3000/articles\r\n```\r\n\r\nYou will see the json output.\r\n\r\n```json  \r\n [{\"id\":1,\"title\":\"Superman\",\"content\":\"Superman is a fictional comic book superhero appearing in publications by DC Comics, widely considered to be an American cultural icon...\"},{\"id\":2,\"title\":\"Krypton\",\"content\":\"Krypton is a fictional planet in the DC Comics universe, and the native world of the super-heroes Superman ...\"},{\"id\":3,\"title\":\"Batman \\u0026 Robin\",\"content\":\"Batman is a fictional character created ...\"}]\r\n```\r\n\r\nThe generated scaffold has index action that renders the list of all articles in json format.\r\n\r\n```ruby \r\ndef index\r\n  @articles = Article.all\r\n  render json: @articles\r\nend\r\n```\r\n\r\nYou can download the source code for this article from [rapi](https://github.com/bparanj/rapi \'rapi\').\r\n\r\n## References\r\n \r\n- [Building the Perfect Rails 5 API only App](http://sourcey.com/building-the-prefect-rails-5-api-only-app/ \'Building the Perfect Rails 5 API only App\') \r\n- [Building a JSON API with Rails 5](https://blog.codeship.com/building-a-json-api-with-rails-5/ \'Building a JSON API with Rails 5\')','2016-05-18 07:09:27','2016-05-18 07:09:27'),(4031,'Autocomplete using Typeahead and Searchkick in Rails 5','## Libraries Used\r\n\r\n- Searchkick Gem for Search\r\n- ElasticSearch for Full Text Search\r\n- Typeahead Javascript Library for Autocomplete\r\n\r\n## Setup SearchKick\r\n\r\nCreate a new Rails 5 project and add searchkick gem to Gemfile.\r\n\r\n```\r\ngem \'searchkick\'\r\n```\r\n\r\nRun bundle. Create an article resource.\r\n\r\n```\r\nrails g scaffold article title content:text\r\n```\r\n\r\nAdd searchkick to the article model.\r\n\r\n```ruby\r\nclass Article < ApplicationRecord\r\n  searchkick\r\nend\r\n```\r\n\r\n## Setup Database\r\n\r\nAdd sample data to seeds.rb.\r\n\r\n```ruby\r\nArticle.destroy_all\r\ndata = [{ title: \'Star Wars\', content: \'Wonderful adventure in the space\' }, \r\n        { title: \'Lord of the Rings\', content: \'Lord that became a ring\' },\r\n        { title: \'Man of the Rings\', content: \'Lord that became a ring\' },\r\n        { title: \'Woman of the Rings\', content: \'Lord that became a ring\' },\r\n        { title: \'Dog of the Rings\', content: \'Lord that became a ring\' },\r\n        { title: \'Daddy of the Rings\', content: \'Lord that became a ring\' },\r\n        { title: \'Mommy of the Rings\', content: \'Lord that became a ring\' },\r\n        { title: \'Duck of the Rings\', content: \'Lord that became a ring\' },\r\n        { title: \'Drug Lord of the Rings\', content: \'Lord that became a ring\' },\r\n        { title: \'Native of the Rings\', content: \'Lord that became a ring\' },\r\n        { title: \'Naysayer of the Rings\', content: \'Lord that became a ring\' },\r\n        { title: \'Tab Wars\', content: \'Lord that became a ring\' },\r\n        { title: \'Drug Wars\', content: \'Lord that became a ring\' },\r\n        { title: \'Cheese Wars\', content: \'Lord that became a ring\' },\r\n        { title: \'Dog Wars\', content: \'Lord that became a ring\' },\r\n        { title: \'Dummy Wars\', content: \'Lord that became a ring\' },\r\n        { title: \'Dummy of the Rings\', content: \'Lord that became a ring\' }\r\n        ]\r\nArticle.create(data)\r\n```\r\n\r\nMigrate and populate the database.\r\n\r\n```\r\nrails db:migrate\r\nrails db:seed\r\n```\r\n\r\n## Test Connectivity to ElasticSearch\r\n\r\nIndex the articles data in elasticsearch.\r\n\r\n```\r\nrake searchkick:reindex CLASS=Article\r\n```\r\n\r\nWe can now play in the rails console to verify search functionality.\r\n\r\n```\r\n$ rails c\r\n> results = Article.search(\'War\')\r\n  Article Search (11.7ms)  curl http://localhost:9200/articles_development/_search?pretty -d \'{\"query\":{\"dis_max\":{\"queries\":[{\"match\":{\"_all\":{\"query\":\"War\",\"boost\":10,\"operator\":\"and\",\"analyzer\":\"searchkick_search\"}}},{\"match\":{\"_all\":{\"query\":\"War\",\"boost\":10,\"operator\":\"and\",\"analyzer\":\"searchkick_search2\"}}},{\"match\":{\"_all\":{\"query\":\"War\",\"boost\":1,\"operator\":\"and\",\"analyzer\":\"searchkick_search\",\"fuzziness\":1,\"prefix_length\":0,\"max_expansions\":3,\"fuzzy_transpositions\":true}}},{\"match\":{\"_all\":{\"query\":\"War\",\"boost\":1,\"operator\":\"and\",\"analyzer\":\"searchkick_search2\",\"fuzziness\":1,\"prefix_length\":0,\"max_expansions\":3,\"fuzzy_transpositions\":true}}}]}},\"size\":1000,\"from\":0,\"fields\":[]}\'\r\n => #<Searchkick::Results:0x007fcf42475dd8 @klass=Article (call \'Article.connection\' to establish a connection), @response={\"took\"=>9, \"timed_out\"=>false, \"_shards\"=>{\"total\"=>5, \"successful\"=>5, \"failed\"=>0}, \"hits\"=>{\"total\"=>6, \"max_score\"=>0.37037593, \"hits\"=>[{\"_index\"=>\"articles_development_20160518103333170\", \"_type\"=>\"article\", \"_id\"=>\"16\", \"_score\"=>0.37037593}, {\"_index\"=>\"articles_development_20160518103333170\", \"_type\"=>\"article\", \"_id\"=>\"15\", \"_score\"=>0.37037593}, {\"_index\"=>\"articles_development_20160518103333170\", \"_type\"=>\"article\", \"_id\"=>\"12\", \"_score\"=>0.3074455}, {\"_index\"=>\"articles_development_20160518103333170\", \"_type\"=>\"article\", \"_id\"=>\"14\", \"_score\"=>0.3074455}, {\"_index\"=>\"articles_development_20160518103333170\", \"_type\"=>\"article\", \"_id\"=>\"1\", \"_score\"=>0.21875}, {\"_index\"=>\"articles_development_20160518103333170\", \"_type\"=>\"article\", \"_id\"=>\"13\", \"_score\"=>0.21875}]}}, @options={:page=>1, :per_page=>1000, :padding=>0, :load=>true, :includes=>nil, :json=>false, :match_suffix=>\"analyzed\", :highlighted_fields=>[]}>\r\n```\r\n\r\nWe are able to connect to the elasticsearch server using searchkick library and retrieve the search results.\r\n\r\n```ruby\r\n> results.class\r\n => Searchkick::Results\r\n```\r\n\r\nThe result is Searchkick::Results object. We have 6 records in the results.\r\n\r\n```ruby\r\n> results.size\r\n  Article Load (0.4ms)  SELECT \"articles\".* FROM \"articles\" WHERE \"articles\".\"id\" IN (16, 15, 12, 14, 1, 13)\r\n => 6\r\n```\r\n\r\n## Integrate Typeahead with Rails 5 App\r\n\r\nAdd the search form to the articles index page.\r\n\r\n```rhtml\r\n<%= form_tag articles_path, method: :get do %>\r\n  <%= text_field_tag :query, params[:query], class: \'form-control\' %>\r\n  <%= submit_tag \'Search\' %>\r\n<% end %>\r\n```\r\n\r\nYou can now search in the articles index page without autocompletion. Let\'s implement the autocomplete feature. Download typeahead.js version 0.11.1 and move it to vendor/assets/javascripts directory. Include typeahead.js in the application.js.\r\n\r\n```\r\n//= require typeahead\r\n```\r\n\r\nAdd the endpoint for the autocomplete suggestions in articles controller.\r\n\r\n```ruby\r\ndef autocomplete\r\n  render json: Article.search(params[:query], autocomplete: true, limit: 10).map(&:title)\r\nend\r\n```\r\n\r\nDeclare the route for autocomplete.\r\n\r\n```ruby\r\nRails.application.routes.draw do\r\n  resources :articles do\r\n    get :autocomplete\r\n  end\r\nend\r\n```\r\n\r\nAdd id and autocomplete attributes to the search text field in articles index page.\r\n\r\n```rhtml\r\n<%= text_field_tag :query, params[:query], class: \'form-control\', id: \"article_search\" %>\r\n```\r\n\r\nAdd the following javascript to articles.js.\r\n\r\n```javascript\r\nvar ready;\r\nready = function() {\r\n    var engine = new Bloodhound({\r\n        datumTokenizer: function(d) {\r\n            console.log(d);\r\n            return Bloodhound.tokenizers.whitespace(d.title);\r\n        },\r\n        queryTokenizer: Bloodhound.tokenizers.whitespace,\r\n        remote: {\r\n            url: \'../articles/autocomplete?query=%QUERY\',\r\n			wildcard: \'%QUERY\'\r\n        }\r\n    });\r\n \r\n    var promise = engine.initialize();\r\n \r\n    promise\r\n        .done(function() { console.log(\'success!\'); })\r\n        .fail(function() { console.log(\'err!\'); });\r\n \r\n    $(\'.typeahead\').typeahead(null, {\r\n        name: \'engine\',\r\n        displayKey: \'title\',\r\n        source: engine.ttAdapter()\r\n    });\r\n}\r\n \r\n$(document).ready(ready);\r\n$(document).on(\'page:load\', ready);\r\n``` \r\n\r\nIf you don\'t provide the wildcard, you will get the error:\r\n\r\n```\r\nGET http://localhost:3000/search/autocomplete?query=%QUERY 400 (Bad Request)\r\n```\r\n\r\nin the browser inspect window and in the log file:\r\n\r\n```\r\nHTTP parse error, malformed request puma\r\n```\r\n\r\n## Isolating Problems\r\n\r\nYou can use curl to isolate the problem to either front-end or back-end.\r\n\r\n```\r\ncurl http://localhost:3000/articles?query=\'dog\'\r\n```\r\n\r\nIn the log file, we see:\r\n\r\n```\r\nArticle Search (19.4ms)  curl http://localhost:9200/articles_development/_search?pretty -d \'{\"query\":{\"dis_max\":{\"queries\":[{\"match\":{\"_all\":{\"query\":\"dog\",\"boost\":10,\"operator\":\"and\",\"analyzer\":\"searchkick_search\"}}},{\"match\":{\"_all\":{\"query\":\"dog\",\"boost\":10,\"operator\":\"and\",\"analyzer\":\"searchkick_search2\"}}},{\"match\":{\"_all\":{\"query\":\"dog\",\"boost\":1,\"operator\":\"and\",\"analyzer\":\"searchkick_search\",\"fuzziness\":1,\"prefix_length\":0,\"max_expansions\":3,\"fuzzy_transpositions\":true}}},{\"match\":{\"_all\":{\"query\":\"dog\",\"boost\":1,\"operator\":\"and\",\"analyzer\":\"searchkick_search2\",\"fuzziness\":1,\"prefix_length\":0,\"max_expansions\":3,\"fuzzy_transpositions\":true}}}]}},\"size\":1000,\"from\":0,\"fields\":[]}\'\r\n  Rendering articles/index.html.erb within layouts/application\r\n```\r\n\r\nIn the terminal output:\r\n\r\n```html\r\n<!DOCTYPE html>\r\n<html>\r\n  <head>\r\n    <title>Autoc</title>\r\n    <meta name=\"csrf-param\" content=\"authenticity_token\" />\r\n<meta name=\"csrf-token\" content=\"O9rx6qf0ik6a2omrGp9Q4ZC/qDeITrQ+MUQKilWV+sitUtQgEmcQu5sbme/f3x1WPmlAVZXvUaccmA37n5/qLw==\" />\r\n    <link rel=\"stylesheet\" media=\"all\" href=\"/assets/articles.self-e3b0c44298fc1c149afbf4c8996fb92427ae41e4649b934ca495991b7852b855.css?body=1\" data-turbolinks-track=\"reload\" />\r\n<link rel=\"stylesheet\" media=\"all\" href=\"/assets/scaffolds.self-c8da12f732bc71ad84951b487f45ea012ee16be9a1df0d0de3b4bfa12f17deb4.css?body=1\" data-turbolinks-track=\"reload\" />\r\n<link rel=\"stylesheet\" media=\"all\" href=\"/assets/application.self-af04b226fd7202dfc532ce7aedb95a0128277937e90d3b3a3d35e1cce9e16886.css?body=1\" data-turbolinks-track=\"reload\" />\r\n    <script src=\"/assets/jquery.self-660adc51e0224b731d29f575a6f1ec167ba08ad06ed5deca4f1e8654c135bf4c.js?body=1\" data-turbolinks-track=\"reload\"></script>\r\n<script src=\"/assets/jquery_ujs.self-e87806d0cf4489aeb1bb7288016024e8de67fd18db693fe026fe3907581e53cd.js?body=1\" data-turbolinks-track=\"reload\"></script>\r\n<script src=\"/assets/typeahead.self-7d0ec0be4d31a26122c3f2780527cd624a8bcbd7350f5f5d6cb23a5a51f516ef.js?body=1\" data-turbolinks-track=\"reload\"></script>\r\n<script src=\"/assets/turbolinks.self-979a09514ef27c84df025c07108a05438ba97cfec71073dcb800a4d327044e02.js?body=1\" data-turbolinks-track=\"reload\"></script>\r\n<script src=\"/assets/articles.self-ca74ce155498e7f07e39291ec69ec2f10ec2ffff27a15d2539eff6e3a4dfbf02.js?body=1\" data-turbolinks-track=\"reload\"></script>\r\n<script src=\"/assets/action_cable.self-97a1acc11db2782c1b61ce874bff887f64e903d3cb2b533eff50fb799c873c70.js?body=1\" data-turbolinks-track=\"reload\"></script>\r\n<script src=\"/assets/cable.self-6e0514260c1aa76eaf252412ce74e63f68819fd19bf740595f592c5ba4c36537.js?body=1\" data-turbolinks-track=\"reload\"></script>\r\n<script src=\"/assets/application.self-afe802b04eaf1de2ea762489c83c08aa4c4ff3ff13c21566e43cb710683f5abc.js?body=1\" data-turbolinks-track=\"reload\"></script>\r\n  </head>\r\n  <body>\r\n    <p id=\"notice\"></p>\r\n<form action=\"/articles\" accept-charset=\"UTF-8\" method=\"get\"><input name=\"utf8\" type=\"hidden\" value=\"&#x2713;\" />\r\n  <input type=\"text\" name=\"query\" id=\"article_search\" value=\"dog\" class=\"form-control\" />\r\n  <input type=\"submit\" name=\"commit\" value=\"Search\" data-disable-with=\"Search\" />\r\n</form>\r\n<h1>Articles</h1>\r\n<table>\r\n  <thead>\r\n    <tr>\r\n      <th>Title</th>\r\n      <th>Content</th>\r\n      <th colspan=\"3\"></th>\r\n    </tr>\r\n  </thead>\r\n  <tbody>\r\n      <tr>\r\n        <td>Dog Wars</td>\r\n        <td>Lord that became a ring</td>\r\n        <td><a href=\"/articles/15\">Show</a></td>\r\n        <td><a href=\"/articles/15/edit\">Edit</a></td>\r\n        <td><a data-confirm=\"Are you sure?\" rel=\"nofollow\" data-method=\"delete\" href=\"/articles/15\">Destroy</a></td>\r\n      </tr>\r\n      <tr>\r\n        <td>Dog of the Rings</td>\r\n        <td>Lord that became a ring</td>\r\n        <td><a href=\"/articles/5\">Show</a></td>\r\n        <td><a href=\"/articles/5/edit\">Edit</a></td>\r\n        <td><a data-confirm=\"Are you sure?\" rel=\"nofollow\" data-method=\"delete\" href=\"/articles/5\">Destroy</a></td>\r\n      </tr>\r\n  </tbody>\r\n</table>\r\n<a href=\"/articles/new\">New Article</a>\r\n  </body>\r\n</html>\r\n```\r\n\r\nThis is without autocomplete. If you search for something, you will get the error:\r\n\r\n```\r\nActiveRecord::RecordNotFound (Couldn\'t find Article with \'id\'=autocomplete):\r\n```\r\n\r\nThis is because we did not define the routes within the collection block in routes.rb. Check the output of rake routes:\r\n\r\n```\r\narticle_autocomplete GET    /articles/:article_id/autocomplete(.:format) articles#autocomplete\r\n```\r\n\r\nThe route is not correct. Let\'s fix it in routes.rb.\r\n\r\n```ruby\r\nRails.application.routes.draw do\r\n  resources :articles do\r\n    collection do\r\n      get :autocomplete\r\n    end\r\n  end\r\nend\r\n```\r\n\r\n## Implement Autocomplete \r\n\r\nIn article model configure autocomplete.\r\n\r\n```ruby\r\nsearchkick autocomplete: [\'title\']\r\n```\r\n\r\nImplement the autocomplete action in the articles controller.\r\n\r\n```ruby\r\ndef autocomplete\r\n  render json: Article.search(params[:query], autocomplete: false, limit: 10).map do |book|\r\n    { title: book.title, value: book.id }\r\n  end\r\nend\r\n```\r\n\r\nYou need to add the typeahead class to the search form.\r\n\r\n```rhtml\r\n<%= text_field_tag :query, params[:query], class: \'form-control typeahead\' %>\r\n```\r\n\r\nYou will now be able to see the autocomplete in action as you type the search term. \r\n\r\n## Style Autocomplete Dropdown\r\n\r\nLet\'s now style the dropdown box in the autocomplete list. Create typeahead.scss and add:\r\n\r\n```css\r\n.tt-query {\r\n  -webkit-box-shadow: inset 0 1px 1px rgba(0, 0, 0, 0.075);\r\n     -moz-box-shadow: inset 0 1px 1px rgba(0, 0, 0, 0.075);\r\n          box-shadow: inset 0 1px 1px rgba(0, 0, 0, 0.075);\r\n}\r\n\r\n.tt-hint {\r\n  color: #999\r\n}\r\n\r\n.tt-menu {    /* used to be tt-dropdown-menu in older versions */\r\n  width: 422px;\r\n  margin-top: 4px;\r\n  padding: 4px 0;\r\n  background-color: #fff;\r\n  border: 1px solid #ccc;\r\n  border: 1px solid rgba(0, 0, 0, 0.2);\r\n  -webkit-border-radius: 4px;\r\n     -moz-border-radius: 4px;\r\n          border-radius: 4px;\r\n  -webkit-box-shadow: 0 5px 10px rgba(0,0,0,.2);\r\n     -moz-box-shadow: 0 5px 10px rgba(0,0,0,.2);\r\n          box-shadow: 0 5px 10px rgba(0,0,0,.2);\r\n}\r\n\r\n.tt-suggestion {\r\n  padding: 3px 20px;\r\n  line-height: 24px;\r\n}\r\n\r\n.tt-suggestion.tt-cursor,.tt-suggestion:hover {\r\n  color: #fff;\r\n  background-color: #0097cf;\r\n\r\n}\r\n\r\n.tt-suggestion p {\r\n  margin: 0;\r\n}\r\n```\r\n\r\nHandle the search in the articles index action:\r\n\r\n```ruby\r\ndef index\r\n  @articles = if params[:query].present?\r\n    Article.search(params[:query])\r\n  else\r\n    Article.all\r\n  end\r\nend\r\n```\r\n\r\nYou will now see a nice looking drop-down for the autocomplete values. You can download the source code for this article from [autocomplete](https://github.com/bparanj/thead \'autocomplete\'). If you want to use Twitter Bootstrap style, checkout the second link in the references section of this article.\r\n\r\n## Things that Can Go Wrong\r\n\r\nIf you rename the headlines.coffee to headlines.js, remember to remove the comments generated by Rails. You will get error in the Chrome Inspect tool. The headlines javascript will display `success!` in the javascript console if javascript has no issues.\r\n\r\nIf you don\'t see any autocompletion results as you type, make sure you reindex the records using the rake task as shown in this article. \r\n\r\n## Searchkick Syntax Change\r\n\r\nThe latest version of searchckick version breaks the autocomplete functionality because autocomplete key has been removed. The error is `unknown keywords autocomplete:`. If you read the test for autocomplete: https://github.com/ankane/searchkick/blob/master/test/autocomplete_test.rb, you can see `match: :text_start`. The test helper: https://github.com/ankane/searchkick/blob/7b06dbe4cdec37ff1349ccf01bf8cb3295971007/test/test_helper.rb uses `text_start: [:name]`. To fix this issue, declaration for searchkick in the model should look like this:\r\n\r\n```ruby\r\nclass Movie < ActiveRecord::Base\r\n  searchkick word_start: [:title, :director]\r\nend\r\n```\r\n\r\nReindex and search with:\r\n\r\n```ruby\r\nMovie.search \"jurassic pa\", match: :word_start\r\n```\r\n\r\nThese can be found in the readme of the gem under Autocomplete heading.\r\n\r\n## Summary\r\n\r\nIn this article, you learned how to use Typeahead javascript library to implement autocomplete for search feature using ElasticSearch and SearcKick in Rails 5 apps.\r\n\r\n## References\r\n\r\n- [Add Search Functionality in Rails 4 App using ElasticSearch and Typeahead](https://sharvy.net/2015/01/12/add-robust-search-functionality-in-your-rails-4-app-using-elasticsearch-and-typeahead-js/ \'Add Search Functionality in Rails 4 App using ElasticSearch and Typeahead\')\r\n- [Twitter Bootstrap Style Dropdown](https://github.com/bassjobsen/typeahead.js-bootstrap-css/blob/master/typeaheadjs.css \'Twitter Bootstrap Style Dropdown\')','2016-05-19 04:49:47','2017-01-27 09:29:15'),(4041,'How to build a Pinterest Clone in Rails 5','## Libraries Used\r\n\r\n- Devise for Authentication\r\n- Paperclip for File Uploading\r\n- Masonry Rails for Transition Effects\r\n- Twitter Bootstrap 4 for CSS Framework\r\n- Acts as Votable for Voting\r\n\r\n## Starter Rails 5 App\r\n\r\nCreate a new Rails 5 project and pin resource.\r\n\r\n```\r\nrails g scaffold pin title description:text\r\n```\r\n\r\nMigrate the database.\r\n\r\n```\r\nrails db:migrate\r\n```\r\n\r\nStart the server.\r\n\r\n```\r\nrails s\r\n```\r\n\r\nCreate some records using the UI. \r\n\r\n## Authenticate using Devise\r\n\r\nAdd:\r\n\r\n```ruby\r\ngem \'devise\', github: \'plataformatec/devise\'\r\n```\r\n\r\nRun bundle. Generate the devise related files.\r\n\r\n```\r\nrails generate devise:install\r\n```\r\n\r\nDefine the home page in routes.rb.\r\n\r\n```ruby\r\nroot to: \"pins#index\"\r\n```\r\n\r\nCreate the user model.\r\n\r\n```\r\nrails generate devise user\r\n```\r\n\r\nAdd the `user_id` foreign_key to pins table.\r\n\r\n```\r\nrails g migration add_user_id_to_pins user_id:integer\r\n```\r\n\r\nMigrate the database.\r\n\r\n```\r\nrails db:migrate\r\n```\r\n\r\nAdd the navigation links:\r\n\r\n```rhtml\r\n<% if user_signed_in? %>\r\n  <li><%= link_to \"New Pin\", new_pin_path %></li>\r\n	<li><%= link_to \"Account\", edit_user_registration_path %></li>\r\n  <li><%= link_to \"Sign Out\", destroy_user_session_path, method: :delete %></li>\r\n<% else %>\r\n  <li><%= link_to \"Sign Up\", new_user_registration_path %></li>\r\n	<li><%= link_to \"Sign In\", new_user_session_path %></li>\r\n<% end %>	  \r\n```\r\n\r\nto layout. You will now be able to signup, signin and logout.\r\n\r\n## File Uploading using Paperclip\r\n\r\n```ruby\r\ngem \"paperclip\", \"~> 5.0.0.beta1\"\r\n```\r\n\r\nRun bundle. Add:\r\n\r\n```ruby\r\nhas_attached_file :image, :styles => { :medium => \"300x300>\" }\r\nvalidates_attachment_content_type :image, :content_type => /\\Aimage\\/.*\\Z/\r\n```\r\n\r\nto pin.rb. Generate the fields required to upload image by running the paperclip generator.\r\n\r\n```\r\nrails g paperclip pin image\r\n```\r\n\r\nModify the pins table by running the migration.\r\n\r\n```\r\nrails db:migrate\r\n```\r\n\r\nAdd:\r\n\r\n```rthml\r\nhtml: { multipart: true }\r\n```\r\n\r\nto pin form partial. Add file upload field to pin form partial.\r\n\r\n```rhtml\r\n<div class=\'field\'>\r\n  <%= f.label :image %>	\r\n  <%= f.file_field :image %>\r\n</div>\r\n```\r\n\r\nYou will get the error:\r\n\r\n```\r\nUser must exist\r\n```\r\n\r\nif you try to create a pin without a user associated. Change the pins controller new action:\r\n\r\n```ruby\r\ndef new\r\n  @pin = current_user.pins.build\r\nend\r\n```\r\n\r\nImage will not be uploaded. To fix the problem, add image field to the permitted fields in `pin_params` pins controller method:\r\n\r\n```ruby\r\ndef pin_params\r\n  params.require(:pin).permit(:title, :description, :image)\r\nend\r\n```\r\n\r\nYou can now upload and view the image.\r\n\r\n\r\n## Transition Effects using Masonry Rails Gem\r\n\r\nAdd masonry-rails gem to Gemfile.\r\n\r\n```ruby\r\ngem \'masonry-rails\'\r\n```\r\n\r\nRun bundle. In application.scss:\r\n\r\n```\r\n*= require \'masonry/transitions\'\r\n```\r\n\r\nIt will look like this:\r\n\r\n``` \r\n*= require \'masonry/transitions\'\r\n*= require_tree .\r\n*= require_self\r\n*/\r\n```\r\n \r\nStyle the pin index page to enable transition effect provided by masonry-rails gem.\r\n\r\n```rhtml\r\n<div class=\"transitions-enabled\" id=\"pins\">\r\n  <% @pins.each do |pin| %>\r\n    <div class=\"box panel panel-default\">\r\n      <%= link_to (image_tag pin.image.url), pin %>\r\n      <h2>\r\n        <%= link_to pin.title, pin %>\r\n      </h2>\r\n      <p class=\"user\">\r\n        Submitted by\r\n        <%= pin.user.email %>\r\n      </p>\r\n    </div>	\r\n  <% end %>	\r\n</div>	\r\n<%= link_to \'New Pin\', new_pin_path %>\r\n```\r\n \r\nAdd CSS to application.scss:\r\n\r\n```css \r\n body {\r\n 	background: #E9E9E9;\r\n }\r\n\r\n h1, h2, h3, h4, h5, h6 {\r\n 	font-weight: 100;\r\n }\r\n\r\n nav {\r\n 	box-shadow: 0 1px 2px 0 rgba(0, 0, 0, 0.22);\r\n 	.navbar-brand {\r\n 		a {\r\n 			color: #BD1E23;\r\n 			font-weight: bold;\r\n 			&:hover {\r\n 				text-decoration: none;\r\n 			}\r\n 		}\r\n 	}\r\n }\r\n\r\n #pins {\r\n   margin: 0 auto;\r\n   width: 100%;\r\n   .box {\r\n 	  margin: 10px;\r\n 	  width: 350px;\r\n 	  box-shadow: 0 1px 2px 0 rgba(0, 0, 0, 0.22);\r\n 	  border-radius: 7px;\r\n 	  text-align: center;\r\n 	  img {\r\n 	  	max-width: 100%;\r\n 	  	height: auto;\r\n 	  }\r\n 	  h2 {\r\n 	  	font-size: 22px;\r\n 	  	margin: 0;\r\n 	  	padding: 25px 10px;\r\n 	  	a {\r\n 				color: #474747;\r\n 	  	}\r\n 	  }\r\n 	  .user {\r\n 	  	font-size: 12px;\r\n 	  	border-top: 1px solid #EAEAEA;\r\n 			padding: 15px;\r\n 			margin: 0;\r\n 	  }\r\n 	}\r\n }\r\n\r\n #edit_page {\r\n 	.current_image {\r\n 		img {\r\n 			display: block;\r\n 			margin: 20px 0;\r\n 		}\r\n 	}\r\n }\r\n\r\n #pin_show {\r\n 	.panel-heading {\r\n 		padding: 0;\r\n 	}\r\n 	.pin_image {\r\n 		img {\r\n 			max-width: 100%;\r\n 			width: 100%;\r\n 			display: block;\r\n 			margin: 0 auto;\r\n 		}\r\n 	}\r\n 	.panel-body {\r\n 		padding: 35px;\r\n 		h1 {\r\n 			margin: 0 0 10px 0;\r\n 		}\r\n 		.description {\r\n 			color: #868686;\r\n 			line-height: 1.75;\r\n 			margin: 0;\r\n 		}\r\n 	}\r\n 	.panel-footer {\r\n 		padding: 20px 35px;\r\n 		p {\r\n 			margin: 0;\r\n 		}\r\n 		.user {\r\n 			padding-top: 8px;\r\n 		}\r\n 	}\r\n }\r\n\r\n textarea {\r\n 	min-height: 250px;\r\n }\r\n```\r\n \r\nReload the page. You will now see styled grids for the pins.\r\n \r\n## Integrate Twitter Bootstrap 4\r\n\r\nAdd bootstrap gem to Gemfile.\r\n\r\n```ruby\r\ngem \'bootstrap\', \'~> 4.0.0.alpha3\'\r\n```\r\n\r\nRun bundle. Require bootstrap in application.scss:\r\n \r\n```\r\n/*\r\n * This is a manifest file that\'ll be compiled into application.css, which will include all the files\r\n * listed below.\r\n *\r\n * Any CSS and SCSS file within this directory, lib/assets/stylesheets, vendor/assets/stylesheets,\r\n * or any plugin\'s vendor/assets/stylesheets directory can be referenced here using a relative path.\r\n *\r\n * You\'re free to add application-wide styles to this file and they\'ll appear at the bottom of the\r\n * compiled file so the styles you add here take precedence over styles defined in any other CSS/SCSS\r\n * files in this directory. Styles in this file should be added after the last require_* statement.\r\n * It is generally better to create a new file per style scope.\r\n *\r\n *= require \'masonry/transitions\'\r\n */\r\n\r\n@import \"bootstrap\";\r\n```\r\n\r\nRequire bootstrap in application.js:\r\n\r\n``` \r\n//= require bootstrap\r\n```\r\n \r\nIt will now look like this:\r\n\r\n``` \r\n//= require jquery\r\n//= require bootstrap\r\n//= require jquery_ujs\r\n//= require turbolinks\r\n//= require_tree .\r\n```\r\n \r\nAdd signup, register, logout, account and new pin links in `layouts/_header.html.erb`:\r\n\r\n```rhtml\r\n<nav class=\"navbar navbar-dark bg-inverse navbar-fixed-top\">\r\n  <%= link_to \"Puppy Reviews\", root_path, class: \"navbar-brand\" %>\r\n  <ul class=\"nav navbar-nav\">\r\n    <% if user_signed_in? %>\r\n      <li class=\"nav-item\">\r\n        <%= link_to \"New Pin\", new_pin_path, class: \'nav-link\' %>\r\n      </li>\r\n      <li class=\"nav-item\">\r\n		<%= link_to \"Account\", edit_user_registration_path, class: \'nav-link\' %>\r\n      </li>\r\n      <li class=\"nav-item\">\r\n		<%= link_to \"Sign Out\", destroy_user_session_path, method: :delete, class: \'nav-link\' %>\r\n      </li>	  \r\n    <% else %>\r\n	    <li class=\"nav-item\">\r\n			<%= link_to \"Sign Up\", new_user_registration_path, class: \'nav-link\' %>	\r\n	    </li>\r\n	    <li class=\"nav-item\">\r\n			<%= link_to \"Sign In\", new_user_session_path, class: \'nav-link\' %>\r\n	    </li>\r\n    <% end %>\r\n  </ul>\r\n</nav>\r\n```\r\n\r\nAdd:\r\n\r\n```rhtml\r\n<%= render \'layouts/header\' %>\r\n```\r\n\r\nto layout file. In application.js:\r\n\r\n``` \r\n//= require masonry/jquery.masonry\r\n```\r\n \r\nIt will look like this:\r\n\r\n``` \r\n//= require jquery\r\n//= require bootstrap\r\n//= require jquery_ujs\r\n//= require masonry/jquery.masonry\r\n//= require turbolinks\r\n//= require_tree .\r\n```\r\n \r\nIn pins.coffee:\r\n \r\n```\r\n $ ->\r\n   $(\'#pins\').imagesLoaded ->\r\n     $(\'#pins\').masonry\r\n       itemSelector: \'.box\'\r\n       isFitWidth: true\r\n```\r\n \r\nNow you will see the transition effect when the browser window is resized.\r\n \r\n## Vote on a Pin\r\n\r\nAdd `acts_as_votable` gem to Gemfile.\r\n\r\n```ruby\r\ngem \'acts_as_votable\', \'~> 0.10.0\'\r\n```\r\n \r\nRun bundle. Generate and create the tables required for voting functionality.\r\n \r\n``` \r\nrails generate acts_as_votable:migration\r\nrails db:migrate\r\n```\r\n\r\nAdd:\r\n\r\n```ruby\r\nacts_as_votable\r\n```\r\n \r\nin pin model. Define the route to vote in routes.rb.\r\n \r\n```ruby\r\nresources :pins do\r\n  put \'like\', to: \'pins#upvote\'\r\nend\r\n```\r\n\r\nIf you do `rails routes`, you can see the route to vote: \r\n\r\n```\r\npin_like PUT    /pins/:pin_id/like(.:format)   pins#upvote\r\n```\r\n\r\nIn pin show page, display the like icon and the number of votes:\r\n\r\n```rhtml \r\n<%= link_to like_pin_path(@pin), method: :put, class: \"btn btn-secondary\" do %>\r\n  <span class=\"glyphicon glyphicon-heart\"></span>\r\n  <%= @pin.get_upvotes.size %>\r\n<% end %>\r\n``` \r\n\r\nDisplay the like button only if a user is signed in. \r\n \r\n```rhtml \r\n<% if user_signed_in? %>\r\n  <%= link_to like_pin_path(@pin), method: :put, class: \"btn btn-secondary\" do %>\r\n     <span class=\"glyphicon glyphicon-heart\"></span>\r\n     <%= @pin.get_upvotes.size %>\r\n  <% end %>\r\n \r\n   <%= link_to \"Edit\", edit_pin_path, class: \"btn btn-default\" %>\r\n   <%= link_to \"Delete\", pin_path, method: :delete, data: { confirm: \"Are you sure?\" }, class: \"btn btn-secondary\" %>\r\n<% end %>\r\n```\r\n \r\nIf you go to the show pin page, you will get the error:\r\n\r\n```\r\nundefined method `like_pin_path\'\r\n```\r\n\r\nThe output of `rails routes` shows: \r\n\r\n``` \r\npin_like PUT    /pins/:pin_id/like(.:format)   pins#upvote\r\n```\r\n\r\nLink the like icon to this path in the pin show page.\r\n\r\n```rhtml\r\n <%= link_to pin_like_path(@pin), method: :put, class: \"btn btn-secondary\" do %>\r\n ...\r\n```\r\n \r\nBootstrap 4 does not come with glyphicons support anymore. Let\'s use fontawesome instead. Add font-awesome-rails gem to Gemfile.\r\n\r\n```ruby\r\ngem \"font-awesome-rails\"\r\n```\r\n\r\nRun bundle. Require it in application.scss:\r\n\r\n```\r\n@import \"font-awesome\";\r\n```\r\n\r\nIn the pin show view, display the heart icon for the like link:\r\n\r\n```rhtml\r\n<i class=\"fa fa-heart\"></i>\r\n```\r\n\r\nClick on the vote. You will get:\r\n\r\n```\r\nundefined method `upvote_by\' for nil:NilClass\r\n```\r\n\r\nInitialize the @pin variable by adding the upvote action to `before_action` in pins controller.\r\n\r\n```ruby\r\nbefore_action :set_pin, only: [:show, :edit, :update, :destroy, :upvote]\r\n```\r\n\r\nYou will now get the error:\r\n\r\n```  \r\nCouldn\'t find Pin with \'id\'=\r\n```\r\n\r\nCurrently the route for like is:\r\n\r\n```\r\nrails routes | grep like\r\npin_like PUT    /pins/:pin_id/like(.:format)   pins#upvote\r\n```\r\n\r\nLet\'s enclose the like route within the member block.\r\n\r\n```ruby				\r\nresources :pins do\r\n  member do\r\n    put \'like\', to: \'pins#upvote\'\r\n  end\r\nend\r\n```\r\n\r\nYou will now get the error:\r\n\r\n```\r\nundefined method `pin_like_path\' \r\n```\r\n\r\nLet\'s look at the route for like link:\r\n\r\n```\r\nrails routes | grep like\r\n```\r\n\r\nThe output shows:\r\n\r\n```\r\nlike_pin PUT    /pins/:id/like(.:format)       pins#upvote			  \r\n```\r\n\r\nChange the like link in pin show.\r\n\r\n```rhtml\r\nlike_pin_path(@pin) \r\n```\r\n\r\nWe need to protect all actions except index and show from users who are not logged in. Add the `before_action` in pins controller that uses devise method to protect those actions.\r\n\r\n```ruby\r\nbefore_action :authenticate_user!, except: [:index, :show]\r\n```\r\n  \r\nNow you must be logged in to like any puppy by clicking the heart icon. You can download the source code for this article from [pini](https://github.com/bparanj/pini \'Pinterest Clone\')\r\n\r\n## Summary\r\n\r\nIn this article, you learned how to develop a Pinterest clone using masonry-rails, `acts_as_votable`, bootstrap 4, devise in Rails 5.\r\n\r\n## References\r\n\r\n- [Twitter Bootstrap 3 in a Rails 4 Application](http://www.erikminkel.com/2013/09/01/twitter-bootstrap-3-in-a-rails-4-application/ \'Twitter Bootstrap 3 in a Rails 4 Application\')\r\n- [Rails 4: How to Include Bootstrap Glyphicons](http://www.angkorbrick.com/2014/11/06/rails-4-how-to-include-bootstrap-glyphicons/ \'Rails 4: How to Include Bootstrap Glyphicons\')\r\n- [FontAwesome Rails Gem](https://github.com/bokmann/font-awesome-rails \'font-awesome-rails\')  \r\n- [FontAwesome Cheatsheet](http://fontawesome.io/cheatsheet/ \'font awesome cheatsheet\')','2016-05-20 04:29:08','2016-07-31 18:35:57'),(4051,'User Analytics for Rails Apps','## Getting IP Address\r\n\r\nExtract the IP from the request in the controller:\r\n\r\n```ruby\r\nrequest.remote_ip\r\n```\r\n\r\n## Getting Location details from IP \r\n\r\nUse Geocoder gem.\r\n\r\n```ruby\r\n> r = Geocoder.search(\'209.249.19.172\').first\r\n => #<Geocoder::Result::Freegeoip:0x007fc02ae9ad80 @data={\"ip\"=>\"209.249.19.172\", \"country_code\"=>\"US\", \"country_name\"=>\"United States\", \"region_code\"=>\"CA\", \"region_name\"=>\"California\", \"city\"=>\"Moraga\", \"zip_code\"=>\"94556\", \"time_zone\"=>\"America/Los_Angeles\", \"latitude\"=>37.8381, \"longitude\"=>-122.1026, \"metro_code\"=>807}, @cache_hit=nil>\r\n> r.class\r\n => Geocoder::Result::Freegeoip\r\n> r.data\r\n => {\"ip\"=>\"209.249.19.172\", \"country_code\"=>\"US\", \"country_name\"=>\"United States\", \"region_code\"=>\"CA\", \"region_name\"=>\"California\", \"city\"=>\"Moraga\", \"zip_code\"=>\"94556\", \"time_zone\"=>\"America/Los_Angeles\", \"latitude\"=>37.8381, \"longitude\"=>-122.1026, \"metro_code\"=>807}\r\n> r.data[\'ip\']\r\n => \"209.249.19.172\"\r\n> r.data[\'country_name\']\r\n => \"United States\"\r\n> r.data[\'region_name\']\r\n => \"California\"\r\n> r.data[\'city\']\r\n => \"Moraga\"\r\n> r.ip\r\n => \"209.249.19.172\"\r\n> r.country\r\n => \"United States\"\r\n> r.state\r\n => \"California\"\r\n> r.postal_code\r\n => \"94556\"\r\n> r.city\r\n => \"Moraga\"\r\n```\r\n\r\nSave the IP in the database and geocode in the background using background jobs.\r\n\r\n## Getting the Search Keyword\r\n\r\nUse referer-parser gem.\r\n\r\n```ruby\r\nrequire \'referer-parser\'\r\nrf = RefererParser::Parser.new.parse(\'http://www.google.com/search?q=gateway+oracle+cards+denise+linn&hl=en&client=safari\')\r\n => {:known=>true, :uri=>\"http://www.google.com/search?q=gateway+oracle+cards+denise+linn&hl=en&client=safari\", :source=>\"Google\", :medium=>\"search\", :domain=>\"google.com\", :term=>\"gateway oracle cards denise linn\"}\r\n> rf.class\r\n => Hash\r\n> rf\r\n => {:known=>true, :uri=>\"http://www.google.com/search?q=gateway+oracle+cards+denise+linn&hl=en&client=safari\", :source=>\"Google\", :medium=>\"search\", :domain=>\"google.com\", :term=>\"gateway oracle cards denise linn\"}\r\n> rf[:term]\r\n => \"gateway oracle cards denise linn\"\r\n> rf[:domain]\r\n => \"google.com\"\r\n> rf[:uri]\r\n => \"http://www.google.com/search?q=gateway+oracle+cards+denise+linn&hl=en&client=safari\"\r\n> rf[:source]\r\n => \"Google\"\r\n```\r\n\r\nIn the controller pass `request.referer` to the parse method. Save the request.referer in the database and use referer-parser gem to extract details in a background job. This will not work if the user is signed-in to Google.  \r\n\r\nYou will get the error:\r\n\r\n```\r\nException occurred : Only HTTP and HTTPS schemes are supported -- \r\n```\r\n\r\nfor direct traffic source. The reason is referer value will be nil and the library will throw this meaningless exception. You can identify direct traffic source:\r\n\r\n```ruby\r\nif request.referer.nil?\r\n  logger.info \'Traffice source : Direct\'\r\nend\r\n```\r\n\r\nThe precondition is not satisfied. So, ideally the library should throw an exception saying that it cannot parse nil to find the referer.\r\n \r\n## Find the Referring Domain\r\n\r\nUse addressable gem. Add it to Gemfile.\r\n\r\n```ruby\r\ngem \'addressable\'\r\n```\r\n\r\nThe value of request.referer provides the referring domain.  The standard URI library in ruby sometimes drops parts of the URL. It also has problems handling special characters in URLs like these: ™ ‘ ’ ° ®. Addressable ruby gem from sporkmonger on git hub is a perfect solution. So use this gem to find the referring domain.\r\n\r\n```ruby\r\nreferring_domain = Addressable::URI.parse(\'http://www.google.com/search?q=gateway+oracle+cards+denise+linn&hl=en&client=safari\').host\r\n => \"www.google.com\"\r\n``` \r\n\r\nSave the request.referer in the database. Do this processing in a background job.\r\n\r\n## Browser Details\r\n\r\nUser browser gem to extract browser related information.\r\n\r\n```ruby\r\nrequire \"browser\"\r\n> user_agent = \'Mozilla/5.0 (Macintosh; Intel Mac OS X 10_10_5) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/49.0.2623.112 Safari/537.36\'\r\n => \"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_10_5) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/49.0.2623.112 Safari/537.36\"\r\n    browser = Browser.new(user_agent, accept_language: \"en-us\")\r\n => #<Browser::Chrome:0x007f9772913488 @ua=\"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_10_5) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/49.0.2623.112 Safari/537.36\", @accept_language=[#<Browser::AcceptLanguage:0x007f9772913348 @part=\"en-us\", @quality=1.0>]>\r\n> browser.name\r\n => \"Chrome\"\r\n> browser.bot?\r\n => false\r\n> browser.version\r\n => \"49\"\r\n> browser.device\r\n => #<Browser::Device:0x007f97729621c8 @ua=\"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_10_5) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/49.0.2623.112 Safari/537.36\">\r\n> browser.device.name\r\n => \"Unknown\"\r\n> browser.device.id\r\n => :unknown\r\n> browser.platform\r\n => #<Browser::Platform:0x007f97730b8e68 @ua=\"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_10_5) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/49.0.2623.112 Safari/537.36\">\r\n> browser.platform.name\r\n => \"Macintosh\"\r\n```\r\n\r\nYou can pass the user agent to the browser constructor by calling:\r\n\r\n```ruby\r\nrequest.user_agent\r\n```\r\n\r\nin the controller.\r\n\r\n## Tracking New Visitors\r\n\r\nIn the controller, set a cookie when a visitor comes to your site if they don\'t already have value for ma_visit cookie. \r\n\r\n```ruby\r\nunless browser.bot?\r\n  unless cookies[:ma_visit].present?\r\n    # Sets a \"permanent\" cookie (which expires in 20 years from now).\r\n    cookies.permanent[:ma_visit] = \"some-unique-string-for-every-browser\"\r\n  end\r\nend\r\n```\r\n\r\nA visit is new if the ma_visit cookie does not exist.\r\n\r\n```ruby\r\ndef new_visit?\r\n  !existing_visit_id\r\nend\r\n\r\ndef existing_visit_id\r\n  request.cookies[\"ma_visit\"])\r\nend\r\n```\r\n\r\nTo generate the unique string for the cookie use uuidtools gem. Add it to Gemfile.\r\n\r\n```ruby\r\ngem \'uuidtools\'\r\n```\r\n\r\nYou can create an unique string like this:\r\n\r\n```ruby\r\n> UUIDTools::UUID.random_create.to_s\r\n => \"a5cd193b-b23f-4541-9238-8522b809e9e1\"\r\n```\r\n\r\n## User Agent Details\r\n\r\nYou can use `user_agent_parser` gem.\r\n\r\n```ruby\r\n> require \'user_agent_parser\'\r\n => false\r\n> user_agent = \'Mozilla/5.0 (Macintosh; Intel Mac OS X 10_10_5) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/49.0.2623.112 Safari/537.36\'\r\n => \"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_10_5) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/49.0.2623.112 Safari/537.36\"\r\n> ua = UserAgentParser.parse user_agent\r\n => #<UserAgentParser::UserAgent Chrome 49.0.2623 (Mac OS X 10.10.5) (Other)>\r\n> ua.to_s\r\n => \"Chrome 49.0.2623\"\r\n> ua.family\r\n => \"Chrome\"\r\n> ua.version\r\n => #<UserAgentParser::Version 49.0.2623>\r\n> ua.version.to_s\r\n => \"49.0.2623\"\r\n> ua.version.major\r\n => \"49\"\r\n> ua.version.minor\r\n => \"0\"\r\n> ua.os.to_s\r\n => \"Mac OS X 10.10.5\"\r\n```\r\n\r\nThese tips are based on the source code of `ahoy_matey` gem. It uses `user_agent_parser` gem to find the browser name and the OS. We can use the browser gem to give us that information. \r\n\r\n## References\r\n\r\n- [referer-parser gem](https://github.com/snowplow/referer-parser \'referer-parser gem\')\r\n- [Geocoder Gem](https://github.com/alexreisner/geocoder \'Geocoder Gem\')\r\n- [Browser Gem](https://github.com/fnando/browser \'Browser Gem\')\r\n- [Replacing Ruby\'s URI with Addressable](http://cloudspace.com/blog/2009/05/26/replacing-rubys-uri-with-addressable/#.V0CF8SMrKgs \'Replacing Ruby\'s URI with Addressable\')\r\n','2016-05-21 03:18:23','2016-05-22 03:31:01'),(4061,'How to handle exceptions in Rails 5','## Problem\r\n\r\nThe bots make requests to [rubyplus.com](http://www.rubyplus.com \'rubyplus\') podcast section that results in ActionController::RoutingError in the log files. I can see the stack trace, the bot sees an error page. Ideally what I would like to do is to handle the exception so that I can still see that it happened in the log file and notify the bot that I don\'t have anything for that URL request. Basically the Rails app should not crash. \r\n\r\n## Solution\r\n\r\nAdd this:\r\n\r\n```ruby\r\nrescue_from ActionController::RoutingError do |exception|\r\n logger.error \'Routing error occurred\'\r\n render plain: \'404 Not found\', status: 404 \r\nend\r\n```\r\n\r\nto the application controller. Add the catch all route in routes.rb:\r\n\r\n```ruby\r\nmatch \"*path\", to: \"welcome#catch_404\", via: :all\r\n```\r\n\r\nIn welcome controller, add catch_404 method.\r\n\r\n```ruby\r\ndef catch_404\r\n  raise ActionController::RoutingError.new(params[:path])\r\nend\r\n```\r\n\r\n If you see other exceptions such as missing template errors, you can do something similar.\r\n\r\n```ruby\r\nrescue_from ActionView::MissingTemplate do |exception|\r\n  logger.error exception.message\r\n  render plain: \'404 Not found\', status: 404 \r\nend\r\n```\r\n\r\nIf the errors happen due to a user, you should show a meaningful message for a human and provide useful links on the page such as your recent podcast episode and most popular articles on your site. I don\'t think doing a redirect is a good idea. This article [Rails\' rescue_from](http://www.rubytutorial.io/rails-rescue_from/ \'Rails rescue_from\') shows how you can do that.\r\n\r\n## Summary\r\n\r\nIn this article, you learned how to handle exceptions caused by bots and what to render on the error page for a user vs a bot.\r\n','2016-05-21 17:36:45','2016-05-22 04:14:00'),(4071,'How to fix favicon error in Rails','[RubyPlus](https://www.rubyplus.com \'RubyPlus\') uses Amazon Cloudfront as the CDN. All the favicons for different devices and sizes are handled by using:\r\n\r\n```ruby\r\nfavicon_link_tag \r\n```  \r\n\r\nI have observed some requests get the error:\r\n\r\n```ruby\r\nActionController::RoutingError (No route matches [GET] \"/favicon.ico\r\n```\r\n\r\nin the log files. In the page source, the favicon helper generates:\r\n\r\n```html\r\n<link rel=\"shortcut icon\" type=\"image/x-icon\" href=\"/assets/favicon-b73a7c5b51d68c8f821e1c0e44083c8b8762c977bd620995642c32fb074d2941.ico\" />\r\n```\r\n\r\nThe signature changes if I make any modification to the assets. The users who have bookmarked before I used the CDN are still looking for the old favicon. Since it is no longer available, it crashes. This is bad for user experience. Add a favicon method in welcome controller.\r\n  \r\n```ruby\r\ndef favicon\r\n  send_file \'public/favicon.ico\', type: \'image/x-icon\', disposition: \'inline\'\r\nend\r\n```\r\n\r\nThis method renders the favicon image inline. Define the route in config/routes.rb:\r\n\r\n```ruby\r\nget \'favicon\', to: \"welcome#favicon\"\r\n```\r\n\r\nMake sure you have favicon.ico in public/images folder. Now if you click the  [favicon](https://rubyplus.com/favicon.ico), you will see the favicon rendered on the browser. \r\n\r\n## Reference\r\n\r\n[Render image with Rails controller](http://www.eq8.eu/blogs/7-render-image-with-rails-controller \'Render image with Rails controller\')','2016-05-21 19:12:39','2016-05-21 19:14:18'),(4081,'Server Side Event Streaming in Rails 5','The Server Side Event Streaming is used when the direction of communication is from the server to the client. If you want bi-directional communication between the server and client, you can use ActionCable. Include ActionController::Live module in the controller that will stream data to the client.\r\n\r\n```ruby\r\nclass WelcomeController < ApplicationController\r\n  include ActionController::Live\r\n    \r\n  def ticker\r\n    5.times do\r\n      response.stream.write \"hi <br/>\"\r\n      sleep 2\r\n    end\r\n    response.stream.close\r\n  end\r\nend\r\n```\r\n\r\nThe ticker action will stream the string `hi`, 5 times to the client. Define the routes.\r\n\r\n```ruby\r\nget \'welcome/ticker\'\r\n```\r\n  \r\nBrowse to `http://localhost:3001/welcome/ticker`, you will see:\r\n\r\n```json\r\nhi\r\nhi\r\nhi\r\nhi\r\nhi\r\n```\r\n\r\nCreate a ticker folder in lib directory with sse.rb:\r\n\r\n```ruby\r\nrequire \'json\'\r\n\r\nmodule  Ticker\r\n  class SSE\r\n    def initialize(io)\r\n      @io = io\r\n    end \r\n    \r\n    def write(object, options = {})\r\n      options.each do |k,v|\r\n        @io.write(\"#{k}: #{v}\\n\")\r\n      end\r\n      @io.write(\"data: #{JSON.dump(object)}\\n\\n\")\r\n    end\r\n    \r\n    def close\r\n      @io.close\r\n    end\r\n  end\r\nend\r\n```\r\n\r\nChange the ticker action in the welcome controller to use the Server Side Event.\r\n\r\n```ruby\r\n  def ticker\r\n    response.headers[\'Content-Type\'] = \'text/event-stream\'\r\n    sse = Ticker::SSE.new(response.stream)\r\n    begin\r\n      loop do\r\n        sse.write({ time: Time.now })\r\n        sleep 2\r\n      end\r\n    rescue IOError\r\n      logger.info \'Client disconnects causes IOError on write\'\r\n    ensure\r\n      sse.close\r\n    end\r\n  end\r\n```\r\n\r\nBrowse to `localhost:3001/welcome/ticker`, you will see\r\n\r\n```json\r\ndata: {\"time\":\"2016-05-26 15:47:50 -0700\"}\r\ndata: {\"time\":\"2016-05-26 15:47:52 -0700\"}\r\ndata: {\"time\":\"2016-05-26 15:47:54 -0700\"}\r\ndata: {\"time\":\"2016-05-26 15:47:56 -0700\"}\r\ndata: {\"time\":\"2016-05-26 15:47:58 -0700\"}\r\n```\r\n\r\nThe sleep call makes it easier to view the streaming on the browser. You can imagine a stock ticker that streams the quote every second Let\'s now simulate a stock ticker. Change the ticker action to stream the stock value for a stock symbol SRV.\r\n\r\n```ruby\r\ndef ticker\r\n  response.headers[\'Content-Type\'] = \'text/event-stream\'\r\n  sse = Ticker::SSE.new(response.stream)\r\n  begin\r\n    loop do\r\n      quotes = [410, 411, 415, 413, 414, 420]\r\n      sse.write({ SRV:  quotes.sample})\r\n      sleep 2\r\n    end\r\n  rescue IOError\r\n    logger.info \'Client disconnects causes IOError on write\'\r\n  ensure\r\n    sse.close\r\n  end\r\nend\r\n```\r\n\r\nIf you browse to `localhost:3001/welcome/ticker`, you will see:\r\n\r\n```json\r\ndata: {\"SRV\":414}\r\ndata: {\"SRV\":414}\r\ndata: {\"SRV\":415}\r\ndata: {\"SRV\":414}\r\ndata: {\"SRV\":413}\r\ndata: {\"SRV\":410}\r\n```\r\n\r\n## Summary\r\n\r\nIn this article, you learned how to stream data to the client using ActionController::Live in Rails 5.\r\n\r\n## References\r\n\r\n[Live Streaming](http://tenderlovemaking.com/2012/07/30/is-it-live.html \'Live Streaming\')','2016-05-26 04:35:16','2016-05-28 03:39:29'),(4091,'Fixing CORS problem with Amazon CloudFront CDN in Rails apps','I am using Alpha SSL for SSL certificate for rubyplus.com. I did not have wildcard SSL certificate. The Chrome browser was freaking out with CORS related errors because I was accessing static resources using `cloudfront.net` domain. Did you know you can get free wildcard SSL from Amazon? As long as you are in virginia region, you can get a free SSL from Amazon. I am using Linode for deploying my Rails apps. The instructions will work for any VPS.\r\n\r\n## Create CNAME in your VPS\r\n\r\nCreate a CNAME for `cdn.yourdomain.com` pointing to `https://your-cloudfront-cdn-id.cloudfront.net` in Linode. \r\n\r\n## Test with Curl\r\n\r\nView page source on your site and grab a link to an image and use curl to test.\r\n \r\n``` \r\ncurl -I http://cdn.rubyplus.com/assets/favicon-very-long-alpha-numeric-string.ico\r\n```\r\n\r\nThis failed with the output:\r\n\r\n```\r\nHTTP/1.1 403 Forbidden\r\nServer: CloudFront\r\nDate: Thu, 26 May 2016 22:39:47 GMT\r\nContent-Type: text/html\r\nContent-Length: 551\r\nConnection: keep-alive\r\nX-Cache: Error from cloudfront\r\nVia: 1.1 3245d45aedf7a8621aabe6b30d2f5a48.cloudfront.net (CloudFront)\r\nX-Amz-Cf-Id: NrdZWePG5rUVcViciQkV87rDaaus25K5LjhJd5w2q3i8neb9MUDIzg==\r\n```\r\n\r\n## Speficy CNAME in CloudFront Distribution\r\n\r\nAdd `cdn.yourdomain.com` as the CNAME in the CloudFront settings.\r\n\r\n<img src=\"https://3.bp.blogspot.com/-qZbyiI-BlO0/V0iNBtaWwkI/AAAAAAAABIs/bDOn23hbklE4Pu_dJYcjB_ZNb5WQ4K1RACLcB/s1600/Screen%2BShot%2B2016-05-26%2Bat%2B3.43.13%2BPM.png\" style=\"border: 1px solid #000; max-width:800px; max-height:600px;\">\r\n\r\n<img src=\"https://1.bp.blogspot.com/-B4c_NtROgEE/V0iNO-AmBgI/AAAAAAAABJw/Wpb1uq1h0HIwxZzkgxR-ZpBNl0VrIxxcQCLcB/s1600/Screen%2BShot%2B2016-05-26%2Bat%2B7.33.38%2BPM.png\" style=\"border: 1px solid #000; max-width:800px; max-height:600px;\">\r\n\r\n<img src=\"https://2.bp.blogspot.com/-wWR7vcNo7Tg/V0iNQXvZQII/AAAAAAAABJ4/HKGajDIUopYtAo3I5rQit0iyzPtf-RBxgCLcB/s1600/Screen%2BShot%2B2016-05-26%2Bat%2B7.34.59%2BPM.png\" style=\"border: 1px solid #000; max-width:800px; max-height:600px;\">\r\n\r\n## AWS Command Line Tool\r\n\r\nInstall AWS command line tool on your laptop.\r\n\r\n```\r\nsudo pip install awscli --ignore-installed six\r\n```\r\n\r\nConvert crt to pem on the server.\r\n\r\n```\r\nopenssl x509 -in mycert.crt -out mycert.pem -outform PEM\r\n```\r\n\r\nGo the directory where the SSL certificate files are stored and run openssl.\r\n\r\n```\r\nopenssl x509 -in intermediate_domain.crt -out intermediate_domain.pem -outform PEM\r\n```\r\n\r\nThis generates the `intermediate_domain.pem` file.\r\n\r\n```\r\n intermediate_domain.crt\r\n intermediate_domain.pem\r\n rubyplus.com.crt\r\n rubyplus.com.key\r\n```\r\n\r\nCopy the files on the server to your laptop:\r\n\r\n```\r\n$scp deployer@rubyplus.com:/home/deployer/certs/* .\r\n```\r\n\r\nYou can upload the generated SSL intermediate certificate to AWS by using the AWS command line tool from your laptop.\r\n\r\n```\r\naws iam upload-server-certificate --server-certificate-name rubyplus.com --certificate-body file://./rubyplus.com.crt --private-key file://./rubyplus.com.key --certificate-chain file://intermediate_domain.pem --path /cloudfront/rubyplus.com/\r\n```\r\n\r\nThis gave the error:\r\n\r\n```\r\nUnable to locate credentials. You can configure credentials by running \"aws configure\".\r\n```\r\n\r\nRun the configuration tool on your laptop to specify your credentials:\r\n\r\n```\r\n$aws configure\r\nAWS Access Key ID [None]: Your-access-key-id-here\r\nAWS Secret Access Key [None]: secret-access-key\r\nDefault region name [None]: us-east-1\r\nDefault output format [None]: json\r\n```\r\n\r\nMy Cloudfront is in the us-east-1 region.  Go to .aws directory on your laptop and check the generated files.\r\n\r\n```\r\n~/.aws $ll\r\ntotal 16\r\ndrwxr-xr-x    4 bparanj  staff   136B May 26 16:37 .\r\ndrwxr-xr-x+ 131 bparanj  staff   4.3K May 26 16:37 ..\r\n-rw-------    1 bparanj  staff    43B May 26 16:37 config\r\n-rw-------    1 bparanj  staff   116B May 26 16:37 credentials\r\n```\r\n\r\nRun the AWS command line tool again.\r\n\r\n```\r\naws iam upload-server-certificate --server-certificate-name rubyplus.com --certificate-body file://./rubyplus.com.crt --private-key file://./rubyplus.com.key --certificate-chain file://intermediate_domain.pem --path /cloudfront/rubyplus.com/\r\n```\r\n\r\nThis gave an error:\r\n\r\n```\r\nA client error (AccessDenied) occurred when calling the UploadServerCertificate operation: User: arn:aws:iam::875721448715:user/rubyplus is not authorized to perform: iam:UploadServerCertificate on resource: arn:aws:iam::875721448715:server-certificate/cloudfront/rubyplus.com/rubyplus.com\r\n```\r\n\r\n## Providing the Permission to AWS User\r\n\r\nLogin to your Cloudfront account and provide the user the permission to upload files. Create a new user in AWS.\r\n\r\n<img src=\"https://4.bp.blogspot.com/-Nx-fhdg0e-I/V0iNB23-hhI/AAAAAAAABIw/lG-xVYHYw48C67BJb6BTi96e7pFBFreMACLcB/s1600/Screen%2BShot%2B2016-05-26%2Bat%2B4.33.49%2BPM.png\" style=\"border: 1px solid #000; max-width:800px; max-height:600px;\">\r\n\r\nUser created successfully.\r\n\r\n<img src=\"https://3.bp.blogspot.com/-LyPBXl2DLzY/V0iNByitCGI/AAAAAAAABI0/L_UDSxk3eQ8X2v2iIz6DSNXiGPL9rN8RQCLcB/s1600/Screen%2BShot%2B2016-05-26%2Bat%2B4.34.12%2BPM.png\" style=\"border: 1px solid #000; max-width:800px; max-height:600px;\">\r\n\r\nAttach Policy to allow user to upload SSL certificate.\r\n\r\n<img src=\"https://2.bp.blogspot.com/-JNxvdB35G-Y/V0iNCaWuZhI/AAAAAAAABI4/r2z3i2P7RLUvwZijW36f-NOSjQWdxAiLwCLcB/s1600/Screen%2BShot%2B2016-05-26%2Bat%2B4.40.55%2BPM.png\r\n\" style=\"border: 1px solid #000; max-width:800px; max-height:600px;\">\r\n\r\nRun the AWS command line tool again:\r\n\r\n```\r\naws iam upload-server-certificate --server-certificate-name rubyplus.com --certificate-body file://./rubyplus.com.crt --private-key file://./rubyplus.com.key --certificate-chain file://intermediate_domain.pem --path /cloudfront/rubyplus.com/\r\n```\r\n\r\nThe command ran successfully with the output:\r\n\r\n```json\r\n{\r\n    \"ServerCertificateMetadata\": {\r\n        \"ServerCertificateId\": \"your-server-certificate-id\", \r\n        \"ServerCertificateName\": \"rubyplus.com\", \r\n        \"Expiration\": \"2016-12-07T23:12:37Z\", \r\n        \"Path\": \"/cloudfront/rubyplus.com/\", \r\n        \"Arn\": \"arn:aws:iam::875721448715:server-certificate/cloudfront/rubyplus.com/rubyplus.com\", \r\n        \"UploadDate\": \"2016-05-26T23:41:20.713Z\"\r\n    }\r\n}\r\n```\r\n\r\nChooose Custom SSL Certificate for the CDN in Distribution Settings.\r\n\r\n<img src=\"https://2.bp.blogspot.com/-fPKxAZgJsVs/V0iNEudMAJI/AAAAAAAABJA/Z-QUzz2Tswsn6BOejN5GNxhw2KuvCZnzgCLcB/s1600/Screen%2BShot%2B2016-05-26%2Bat%2B4.46.58%2BPM.png\" style=\"border: 1px solid #000; max-width:800px; max-height:600px;\">\r\n\r\nUse curl to test.\r\n\r\n``` \r\ncurl -I https://cdn.rubyplus.com/assets/favicon-very-long-alphanumeric-string.ico\r\n```\r\n\r\nI got the error:\r\n\r\n```\r\ncurl: (60) SSL certificate problem: Invalid certificate chain\r\nMore details here: http://curl.haxx.se/docs/sslcerts.html\r\n\r\ncurl performs SSL certificate verification by default, using a \"bundle\"\r\n of Certificate Authority (CA) public keys (CA certs). If the default\r\n bundle file isn\'t adequate, you can specify an alternate file\r\n using the --cacert option.\r\nIf this HTTPS server uses a certificate signed by a CA represented in\r\n the bundle, the certificate verification probably failed due to a\r\n problem with the certificate (it might be expired, or the name might\r\n not match the domain name in the URL).\r\nIf you\'d like to turn off curl\'s verification of the certificate, use\r\n the -k (or --insecure) option.\r\n``` \r\n\r\nLet\'s try with the -k switch:\r\n\r\n``` \r\n curl -k -I https://cdn.rubyplus.com/assets/favicon-b73a7c5b51d68c8f821e1c0e44083c8b8762c977bd620995642c32fb074d2941.ico\r\n```\r\n\r\nIt had the same problem.\r\n\r\n``` \r\n HTTP/1.1 200 OK\r\n Content-Type: image/x-icon\r\n Content-Length: 7406\r\n Connection: keep-alive\r\n Date: Thu, 26 May 2016 23:42:38 GMT\r\n Server: Apache/2.2.22 (Ubuntu)\r\n Last-Modified: Thu, 03 Mar 2016 08:51:13 GMT\r\n Accept-Ranges: bytes\r\n Cache-Control: max-age=31536000\r\n Expires: Fri, 26 May 2017 23:42:38 GMT\r\n Age: 126\r\n X-Cache: Hit from cloudfront\r\n Via: 1.1 aa96a51fedae85199c643eb5c8eca4e4.cloudfront.net (CloudFront)\r\n X-Amz-Cf-Id: 2yYMTGBdQdIyK3om0URDD9E87Ehr8xdbXGOX6EYhahdkFF9U3osprQ==\r\n```\r\n\r\nUntrusted SSL Connection\r\n\r\n<img src=\"https://1.bp.blogspot.com/-RtjG64OrrMc/V0iNHEbkDXI/AAAAAAAABJI/AV9fcZZXdqcKlC6tZVDNg9x1UWtSwY3JwCLcB/s1600/Screen%2BShot%2B2016-05-26%2Bat%2B5.04.40%2BPM.png\" style=\"border: 1px solid #000; max-width:800px; max-height:600px;\">\r\n\r\nConnection is not private error in Chrome.\r\n\r\n<img src=\"https://1.bp.blogspot.com/-aJG0ccUjgjA/V0iNHjlAPRI/AAAAAAAABJM/HVTb8mDhtl8MB4axrxkBBpwgSZUI1NPLACLcB/s1600/Screen%2BShot%2B2016-05-26%2Bat%2B5.07.54%2BPM.png\" style=\"border: 1px solid #000; max-width:800px; max-height:600px;\">\r\n\r\n## Amazon Wildcard SSL\r\n\r\nAWS Certificate Manager\r\n\r\n<img src=\"https://4.bp.blogspot.com/-LwfO2A3gTcE/V0iNIYxYFXI/AAAAAAAABJU/e60CJo9dEVsAvvk51PYX9dyQQPxA0JZggCLcB/s1600/Screen%2BShot%2B2016-05-26%2Bat%2B5.23.09%2BPM.png\" style=\"border: 1px solid #000; max-width:800px; max-height:600px;\">\r\n\r\nAmazon Wildcard SSL pending validation\r\n\r\n<img src=\"https://3.bp.blogspot.com/-O2dzLD5kXy8/V0iNK3s04AI/AAAAAAAABJc/OS8oM5F2WFcyGSDOinQ27K2IssjJXdqiQCLcB/s1600/Screen%2BShot%2B2016-05-26%2Bat%2B5.24.40%2BPM.png\" style=\"border: 1px solid #000; max-width:800px; max-height:600px;\">\r\n\r\nApprove Amazon SSL request.\r\n\r\n<img src=\"https://3.bp.blogspot.com/-8rIJMhWDGTQ/V0iNKx_Z5oI/AAAAAAAABJY/VyiBEr3pau8nFVJecEc4NF03olLo1W87gCLcB/s1600/Screen%2BShot%2B2016-05-26%2Bat%2B5.25.06%2BPM.png\" style=\"border: 1px solid #000; max-width:800px; max-height:600px;\">\r\n\r\nApproving the Amazon SSL request.\r\n\r\n<img src=\"https://3.bp.blogspot.com/-51Oqmj2DHNo/V0iNLPSWjCI/AAAAAAAABJg/-AJulE4x0OsY_I5lazZwb63-4UcUsizmACLcB/s1600/Screen%2BShot%2B2016-05-26%2Bat%2B5.25.39%2BPM.png\" style=\"border: 1px solid #000; max-width:800px; max-height:600px;\">\r\n\r\nSuccessful approval of Amazon SSL certificate.\r\n\r\n<img src=\"https://1.bp.blogspot.com/-knRygrtFIAw/V0iNLzFKhsI/AAAAAAAABJk/_hUrf4XMMqISPQ257a-OysaN43wrXfMzQCLcB/s1600/Screen%2BShot%2B2016-05-26%2Bat%2B5.25.57%2BPM.png\" style=\"border: 1px solid #000; max-width:800px; max-height:600px;\">\r\n\r\nVerify Amazon wildcard SSL status\r\n\r\n<img src=\"https://3.bp.blogspot.com/-0xe84paHBkw/V0iNQTHqipI/AAAAAAAABKA/80xs4Voj4ZEccHY9gaOCbqPGRY9kzc-xwCLcB/s1600/Screen%2BShot%2B2016-05-26%2Bat%2B7.33.55%2BPM.png\r\n\" style=\"border: 1px solid #000; max-width:800px; max-height:600px;\">\r\n\r\n## Use Asset Host in Rails App\r\n\r\nEdit the production.rb in your Rails app:\r\n\r\n```\r\nconfig.action_controller.asset_host = \'//cdn.rubyplus.com\'\r\n```\r\n\r\nDeploy your Rails app. Go to your site and view page source. Hyperlinks without protocol.\r\n\r\n<img src=\"https://4.bp.blogspot.com/-ePuLpdS6QVM/V0iNGZKX6NI/AAAAAAAABJE/62KVq8zfcysDPzg43IVb_DmJFKvmqeTlQCLcB/s1600/Screen%2BShot%2B2016-05-26%2Bat%2B5.03.12%2BPM.png\" style=\"border: 1px solid #000; max-width:800px; max-height:600px;\">\r\n\r\nI was getting:\r\n\r\n```\r\n   Font from origin \'https://cdn.rubyplus.com\' has been blocked from loading by Cross-Origin Resource Sharing policy: No \'Access-Control-Allow-Origin\' header is present on the requested resource. Origin \'https://www.rubyplus.com\' is therefore not allowed access.\r\n```   \r\n\r\nI searched for this error:\r\n\r\n```\r\nFont from origin  has been blocked from loading by Cross-Origin Resource Sharing policy: No \'Access-Control-Allow-Origin\' header is present on the requested resource. Origin  is therefore not allowed access.\r\n```\r\n\r\nI found that you have to set a CORS Configuration for your CloudFront in AWS console. In CloudFront -> Distribution -> Behaviors for this origin, use the Forward Headers: Whitelist option and whitelist the \'Origin\' header. \r\n\r\nChoosing wildcard SSL in CloudFront Distribution settings\r\n\r\n<img src=\"https://4.bp.blogspot.com/-NWesViF6978/V0iNMydxarI/AAAAAAAABJo/65S1Zqh9uIAC2m-5U43OJlI-r3npUhR6QCLcB/s1600/Screen%2BShot%2B2016-05-26%2Bat%2B5.29.33%2BPM.png\" style=\"border: 1px solid #000; max-width:800px; max-height:600px;\">\r\n\r\nEdit CloudFront behavior to set the forward header and whitelist header\r\n\r\n<img src=\"https://3.bp.blogspot.com/-gDVux3SAopI/V0iNO5QtIeI/AAAAAAAABJ0/olhnqXf6KmQ1fZnxpochtiOBQwh5qkg4QCLcB/s1600/Screen%2BShot%2B2016-05-26%2Bat%2B6.11.37%2BPM.png\r\n\" style=\"border: 1px solid #000; max-width:800px; max-height:600px;\">\r\n\r\nWait for 20 minutes or so while CloudFront propagates the new rule. Now your CloudFront distribution should cache different responses (with proper CORS headers) for different client Origin headers. Use curl to test the cloudfront setup by hitting an icon. The output shows that it worked.\r\n\r\n```\r\nHTTP/1.1 200 OK\r\nContent-Type: image/x-icon\r\nContent-Length: 7406\r\nConnection: keep-alive\r\nDate: Thu, 26 May 2016 23:42:38 GMT\r\nServer: Apache/2.2.22 (Ubuntu)\r\nLast-Modified: Thu, 03 Mar 2016 08:51:13 GMT\r\nAccept-Ranges: bytes\r\nCache-Control: max-age=31536000\r\nExpires: Fri, 26 May 2017 23:42:38 GMT\r\nX-Cache: Miss from cloudfront\r\nVia: 1.1 2239f0bfe6d7427183a4e375c4638619.cloudfront.net (CloudFront)\r\nX-Amz-Cf-Id: 4X9YJwlXoEALb_LzdaVP62x2_TbaDh8bHufLlH263FwO8kSJNNZySw==\r\n```\r\n\r\nAlpha SSL on the home page of rubyplus.com\r\n\r\n<img src=\"https://3.bp.blogspot.com/-b4NmMB4JJIg/V0iNNnn6FbI/AAAAAAAABJs/d2Zq3dXtcfA8eADOlE9CmoK7djJQmP3PQCLcB/s1600/Screen%2BShot%2B2016-05-26%2Bat%2B6.00.08%2BPM.png\" style=\"border: 1px solid #000; max-width:800px; max-height:600px;\">\r\n\r\n<img src=\"https://4.bp.blogspot.com/-pZLeoVOPaFY/V0iNQ-NmCaI/AAAAAAAABKE/-t4158DRe9w4iKgn4bqctvTLM0lbaP6dACLcB/s1600/Screen%2BShot%2B2016-05-26%2Bat%2B8.36.23%2BPM.png\" style=\"border: 1px solid #000; max-width:800px; max-height:600px;\">\r\n\r\nThe Amazon SSL takes care of the wildcard SSL. The Alpha SSL takes care of the SSL for rubyplus.com and www.rubyplus.com. \r\n\r\n## Fixing Font Loading Issue due to CORS Error\r\n\r\nIf you inspect the page, Chrome shows the following error.\r\n\r\n```\r\nFont from origin \'https://cdn.rubyplus.com\' has been blocked from loading by Cross-Origin Resource Sharing policy: No \'Access-Control-Allow-Origin\' header is present on the requested resource. Origin \'https://rubyplus.com\' is therefore not allowed access.\r\n```\r\n\r\nFirefox error is better, it shows specific cause of the problem and suggestions to fix them.\r\n\r\n```\r\ndownloadable font: download failed (font-family: \"OpenSans-Regular\" style:normal weight:normal stretch:normal src index:0): bad URI or cross-site access not allowed\r\nsource: https://cdn.rubyplus.com/assets/OpenSans-Regular-e64e508b2aa2880f907e470c4550980ec4c0694d103a43f36150ac3f93189bee.ttf\r\n\r\nCross-Origin Request Blocked: The Same Origin Policy disallows reading the remote resource at https://cdn.rubyplus.com/assets/OpenSans-Regular-e64e508b2aa2880f907e470c4550980ec4c0694d103a43f36150ac3f93189bee.ttf. This can be fixed by moving the resource to the same domain or enabling CORS.\r\n```\r\n\r\nCreate a directory yourdomain.com under /var/www directory. Create a .htaccess file with:\r\n\r\n```\r\n<FilesMatch \".(ttf|otf|eot|woff)\">\r\n  Header set Access-Control-Allow-Origin \"*\" \r\n</FilesMatch>\r\n```\r\n\r\nYou do not need to restart apache server for this change to take effect.\r\n\r\n## CloudFront Cache Behavior Settings\r\n\r\nDefault Cache Behavior Settings Screen\r\n\r\n<img src=\"https://3.bp.blogspot.com/-cVrqQdfxheY/V1CWp6XoIzI/AAAAAAAABKk/d-8Hn1f6dDArpq3UjvS9hwx9P7dXhHpIQCLcB/s1600/Screen%2BShot%2B2016-05-31%2Bat%2B10.40.55%2BPM.png\" style=\"border: 1px solid #000; max-width:800px; max-height:600px;\">\r\n\r\nYou must have OPTIONS also as shown here.\r\n\r\n<img src=\"https://3.bp.blogspot.com/-hdPihYI8nkA/V1CWqARWX5I/AAAAAAAABKs/eBkciokOlVk98Y_0zR4RjxZkXitcd5TXwCLcB/s1600/Screen%2BShot%2B2016-05-31%2Bat%2B10.41.33%2BPM.png\" style=\"border: 1px solid #000; max-width:800px; max-height:600px;\">\r\n\r\nMake sure to whitelist the origin header.\r\n\r\n<img src=\"https://1.bp.blogspot.com/-Z1riOdSS12c/V1CWqH4wfnI/AAAAAAAABKo/SFzI-53GZbQJnDng7InF-qZEyRS9LEyMACLcB/s1600/Screen%2BShot%2B2016-05-31%2Bat%2B10.42.27%2BPM.png\" style=\"border: 1px solid #000; max-width:800px; max-height:600px;\">\r\n\r\nThe entire setup should look like this:\r\n\r\n<img src=\"https://4.bp.blogspot.com/-lyXOury5ZtI/V1CWrBU867I/AAAAAAAABKw/OgMck7XLPJIzM_jpHUMDpVHIrvAwn3yfgCLcB/s320/Screen%2BShot%2B2016-05-31%2Bat%2B10.43.12%2BPM.png\" style=\"border: 1px solid #000; max-width:900px; max-height:900px;\">\r\n\r\n## References\r\n\r\n[Setting Headers in Rails 4](https://chriszetter.com/blog/2013/10/04/setting-headers-in-rails-4/ \'Setting Headers in Rails 4\')\r\n','2016-05-27 17:47:41','2016-06-02 20:56:51'),(4101,'Implementing Copy to Clipboard Feature in Rails 4.2 Apps','## Setup Clipboard.js\r\n\r\nDownload [clipboard.js](https://github.com/zenorocha/clipboard.js/archive/master.zip \'Clipboard\'). Extract the downloaded zip file and copy the dist/clipboard.js to vendor/assets/javascripts directory. Create the html file.\r\n\r\n```rhtml\r\n<!-- Target -->\r\n<textarea id=\"bar\">Mussum ipsum cacilds...</textarea>\r\n\r\n<!-- Trigger -->\r\n<button class=\"btn\" data-clipboard-target=\"#bar\">\r\n    Copy to clipboard\r\n</button>\r\n```\r\n\r\nIn application.js, add:\r\n\r\n```\r\n//= require clipboard\r\n```\r\n\r\nI got the error:\r\n\r\n```\r\njquery is not defined rails\r\n```\r\n\r\nAdd bootstrap-sprockets after jquery and jquery_ujs.\r\n\r\n```\r\n//= require jquery\r\n//= require jquery_ujs\r\n//= require bootstrap-sprockets		\r\n```\r\n\r\nI got the error:\r\n\r\n```\r\ncouldn\'t find file \'bootstrap-popover\' with type \'application/javascript\'\r\n```\r\n\r\nChange the order like this:\r\n\r\n```\r\n@import \"bootstrap\";\r\n@import \"bootstrap-sprockets\";\r\n```\r\n\r\nI defined this in load_bootstrap.scss file. Now I got \r\n\r\n```\r\nclipboard is not defined error. \r\n```\r\n\r\n## Workaround\r\n\r\nAdd this to the bottom of the html file where you need the copy to clipboard feature.\r\n\r\n```rhtml\r\n<% content_for(:third_party_js) do %>\r\n  <script src=\"https://cdn.rawgit.com/zenorocha/clipboard.js/v1.5.10/dist/clipboard.min.js\"></script>\r\n<% end %>	\r\n<script>\r\n    var clipboard = new Clipboard(\'.btn\');\r\n</script>\r\n```\r\n\r\nInside head tag, add yield to application layout.\r\n\r\n```rhtml\r\n<%= yield :third_party_js %>\r\n```\r\n\r\nYou will now be able to copy to clipboard by clicking on the button.\r\n\r\n## Summary\r\n\r\nYou can use [Clipboard Rails](https://github.com/sadiqmmm/clipboard-rails \'Clipboard Rails\') that simplifies integrating clipboard.js to Rails apps. I only have this feature for admin section of rubyplus.com. So, I decided not to use it. Don\'t forget to play with the demo samples that comes with the clipboard.js zip file.','2016-05-29 21:32:29','2016-07-16 06:15:20'),(4111,'Processing Stripe Payments with a Background Worker in Rails 5','## Introduction\r\n\r\nThe technique used in this article can be used to process any long processing tasks in the background. The example does not actually process the payments. The background job receives the data required to process the payment.\r\n\r\n## Processing Payments in the Background\r\n\r\nCreate a background job class to process payments.\r\n\r\n```\r\nrails g job stripe_payment\r\n```\r\n\r\nThe `app/jobs/stripe_payment_job.rb` looks like this:\r\n\r\n```ruby\r\nclass StripePaymentJob < ApplicationJob\r\n  queue_as :default\r\n\r\n  def perform(*args)\r\n    # Do payment processing here\r\n  end\r\nend\r\n```\r\n\r\nAdd resque gem to Gemfile and run bundle.\r\n\r\n```ruby\r\ngem \'resque\'\r\n```\r\n\r\nIn application.rb, specify the queue_adapter:\r\n\r\n```ruby\r\nconfig.active_job.queue_adapter = :resque\r\n```\r\n\r\nCreate a controller for processing payments.\r\n\r\n```\r\nrails g controller payments create\r\n```\r\n\r\nThis controller will take the stripe token and payment id in the create action and process the payment in the background.\r\n\r\n```ruby\r\nclass PaymentsController < ApplicationController\r\n  def create\r\n    StripePaymentJob.perform_later(\'process payment later\')\r\n  end\r\nend\r\n```\r\n\r\nIt is sending only a string argument. You can send the stripe token and payment id in a hash to the `perform_later` method. Start the rails server and hit `http://localhost:3000/payments/create`. You will see:\r\n\r\n```\r\nStarted GET \"/payments/create\" for ::1 at 2016-06-07 19:39:45 -0700\r\nProcessing by PaymentsController#create as HTML\r\n[ActiveJob] Enqueued StripePaymentJob (Job ID: 3b3ab29c-5978-4f70-912f-bf5ec0e8a98e) to Resque(default) with arguments: \"process payment later\"\r\n```\r\n\r\nin the log file. Poll the server every 5 second. The ajax call is made to payments/show to check the status of the payment.\r\n\r\n```javascript\r\n(function poll(){\r\n   setTimeout(function(){\r\n      $.ajax({ url: \"show\", success: function(data){\r\n        //Setup the next poll recursively\r\n        poll();\r\n      }, dataType: \"json\"});\r\n  }, 5000);\r\n})();\r\n```\r\n\r\nLet\'s hard code the result to success in the payments controller, show action.\r\n\r\n```ruby\r\ndef show\r\n  render json: { result: \'success\'}\r\nend\r\n```\r\n\r\nWe can now handle the success, failure and pending states in the payment.js.\r\n\r\n```javascript\r\n(function poll(){\r\n   setTimeout(function(){\r\n      $.ajax({ url: \"show\", success: function(data){\r\n		console.log(data.result);\r\n		if(data.result === \'success\') {\r\n			alert(\'It was success\');\r\n		} else if (data.result === \'failure\') {\r\n			alert(\'It failed\');\r\n		} else if (data.result === \'pending\') {\r\n	        //Setup the next poll recursively\r\n	        poll();			\r\n		}\r\n      }, dataType: \"json\"});\r\n  }, 5000);\r\n})();\r\n```\r\n\r\nWe continue polling only when the payment is in pending state. We can simulate a failure in the show action to test if the poll stops for failure.\r\n\r\n```ruby\r\ndef show\r\n  render json: { result: \'failure\'}\r\nend\r\n```\r\n\r\nWe can add the payment status messages to notify the customer about the payment status.\r\n\r\n```javascript\r\n(function poll(){\r\n   setTimeout(function(){\r\n      $.ajax({ url: \"show\", \r\n		beforeSend: function() {\r\n	       $(\'#loader\').show();\r\n	    },		\r\n	   success: function(data){\r\n		console.log(data.result);\r\n		if(data.result === \'success\') {\r\n			$(\'#loader\').hide();\r\n			$(\'#status\').html(\'Payment processed successfully.\')\r\n		} else if (data.result === \'failure\') {\r\n			$(\'#loader\').hide();\r\n            $(\'#status\').html(\'Payment processing failed.\')\r\n		} else if (data.result === \'pending\') {\r\n	        //Setup the next poll recursively\r\n	        poll();			\r\n		}\r\n      }, dataType: \"json\"});\r\n  }, 5000);\r\n})();\r\n```\r\n\r\n## How to pass the payment id from Rails to javascript?\r\n\r\nLet\'s hardcode the payment id in the payments controller, create action.\r\n\r\n```ruby\r\ndef create\r\n  @payment = OpenStruct.new(id: 200)\r\n  StripePaymentJob.perform_later(\'process payment later\')\r\nend\r\n```\r\n\r\nWe can use the javascript window object to set the paymentID in create.html.erb.\r\n\r\n```rhtml\r\n<h1>Payments#create</h1>\r\n<%= javascript_tag do %>\r\n  window.paymentID = \'<%= @payment.id %>\';\r\n<% end %>\r\n<div id=\'loader\'>\r\n	<img src=\"http://preloaders.net/preloaders/712/Floating%20rays.gif\"/>\r\n</div>\r\n<div id=\'status\'>Payment is being processed. Please wait...</div>\r\n```\r\n\r\nChange the show action to fail.\r\n\r\n```ruby\r\ndef show\r\n  logger.info params\r\n  render json: { result: \'failure\'}\r\nend\r\n```\r\n\r\nWe can now access the paymentID that was set in the create.html.erb in the payment.js to poll the payment status.\r\n\r\n```javascript\r\n(function poll(){\r\n   setTimeout(function(){\r\n      $.ajax({ url: \"show/\" + paymentID,\r\n		beforeSend: function() {\r\n	       $(\'#loader\').show();\r\n		   console.log(paymentID);\r\n	    },		\r\n	   success: function(data){\r\n		console.log(data.result);\r\n		if(data.result === \'success\') {\r\n			$(\'#loader\').hide();\r\n			$(\'#status\').html(\'Payment processed successfully.\')\r\n		} else if (data.result === \'failure\') {\r\n			$(\'#loader\').hide();\r\n            $(\'#status\').html(\'Payment processing failed.\')\r\n		} else if (data.result === \'pending\') {\r\n	        //Setup the next poll recursively\r\n	        poll();			\r\n		}\r\n      }, dataType: \"json\"});\r\n  }, 5000);\r\n})();\r\n```\r\n\r\nYou will get the error:\r\n\r\n```\r\nGET http://localhost:3000/payments/show/200 404 (Not Found)\r\n```\r\n\r\nLet\'s define the routes properly.\r\n\r\n```ruby\r\nget \'payments/show/:id\', to: \'payments#show\'\r\n```\r\n\r\nWe can now see the payment id passed to the server.\r\n\r\n```\r\nStarted GET \"/payments/show/200\" for ::1 at 2016-06-07 15:52:20 -0700\r\nProcessing by PaymentsController#show as JSON\r\n  Parameters: {\"id\"=>\"200\"}\r\n```\r\n\r\nWe can use the payment id to check the current status of the payment by loading it from the database. Let\'s display the receipt id on payment success. \r\n\r\n```javascript\r\n$(\'#status\').html(\'Payment processed successfully. Your receipt ID is : \' + data.receipt_id);\r\n```\r\n\r\nWe can hard-code the `receipt_id` in the show action.\r\n\r\n```ruby\r\ndef show\r\n  logger.info params\r\n  render json: { result: \'success\', receipt_id: \'CXM4873\'}\r\nend\r\n```\r\n\r\n## Replace hard coded URL in the javascript.\r\n\r\nLet\'s use HTML 5 data attribute so that we can get rid of the window object hack we did earlier.\r\n\r\n```rhtml\r\n<div id=\'loader\' data-url=\"<%= payments_show_url(@payment.id) %>\">\r\n	<img src=\"http://preloaders.net/preloaders/712/Floating%20rays.gif\"/>\r\n</div>\r\n```\r\n\r\nMake the route a named url that we can use in the view.\r\n\r\n```\r\nget \'payments/show/:id\', to: \'payments#show\', as: :payments_show\r\n```\r\n\r\nLet\'s cleanup. Remove paymentID hack to pass value from rails to javascript.\r\n\r\n```rhtml\r\n<h1>Payments#create</h1>\r\n<div id=\'loader\' data-url=\"<%= payments_show_url(@payment.id) %>\">\r\n	<img src=\"http://preloaders.net/preloaders/712/Floating%20rays.gif\"/>\r\n</div>\r\n<div id=\'status\'>Payment is being processed. Please wait...</div>\r\n```\r\n\r\nThe final payment.js looks like this:\r\n\r\n```javascript\r\n(function poll(){\r\n   setTimeout(function(){\r\n	   $.ajax({ url: $(\'#loader\').data(\'url\'), \r\n		beforeSend: function() {\r\n	       $(\'#loader\').show();\r\n	    },		\r\n	   success: function(data){\r\n		console.log(data.result);\r\n		if(data.result === \'success\') {\r\n			$(\'#loader\').hide();\r\n			$(\'#status\').html(\'Payment processed successfully. Your receipt ID is : \' + data.receipt_id);\r\n		} else if (data.result === \'failure\') {\r\n			$(\'#loader\').hide();\r\n            $(\'#status\').html(\'Payment processing failed.\')\r\n		} else if (data.result === \'pending\') {\r\n	        //Setup the next poll recursively\r\n	        poll();			\r\n		}\r\n      }, dataType: \"json\"});\r\n  }, 5000);\r\n})();\r\n```\r\n\r\nReplace the hard coded value for the json returned in the show action with the values of the payment record for a given payment id from the javascript poll request. You can download the source code for this article from [Poll](https://github.com/bparanj/spol \'Poll\')\r\n\r\n## References\r\n\r\n- [Simple Long Polling Example with JavaScript and jQuery](https://techoctave.com/c7/posts/60-simple-long-polling-example-with-javascript-and-jquery   \'Simple Long Polling Example with JavaScript and jQuery\')\r\n- [Design for Failure: Processing Payments with a Background Worker](https://www.masteringmodernpayments.com/blog/design-for-failure-processing-payments-with-a-background-worker \'Design for Failure: Processing Payments with a Background Worker\')','2016-06-08 04:02:22','2016-07-16 06:00:19'),(4121,'Exporting Records in CSV and Excel Formats in Rails 5','Create a new Rails 5 project and create a product model.\r\n\r\n```\r\nrails g model product name released_on:date price:decimal\r\n```\r\n\r\nSpecify the precision and scale for the price column in the migration file.\r\n\r\n```ruby\r\nt.decimal :price, :precision => 2, :scale => 8\r\n```\r\n\r\nMigrate the database.\r\n\r\n```\r\nrails db:migrate\r\n```\r\n\r\nCopy the seed data to seeds.rb. Populate the database.\r\n\r\n```\r\nrails db:seed\r\n```\r\n\r\nCreate a products controller.\r\n\r\n```\r\nrails g controller products\r\n```\r\n\r\nRetrieve products in the index action.\r\n\r\n```ruby\r\ndef index\r\n  @products = Product.order(:name)\r\nend\r\n```\r\n\r\nDefine the resources in the routes.rb.\r\n\r\n```ruby\r\nRails.application.routes.draw do\r\n  resources :products\r\n  \r\n  root to: \'products#index\'\r\nend\r\n```\r\n\r\nCreate layout.css with css shown in the github code download link. Add:\r\n\r\n```css\r\ntable td, table th {\r\n  padding-right: 20px;\r\n  padding-bottom: 5px;\r\n  text-align: left;\r\n  &:last-child {\r\n    text-align: right;\r\n  }\r\n}\r\n```\r\n\r\nto products.scss. Create products/index.html.erb:\r\n\r\n```rhtml\r\n<h1>Products</h1>\r\n<table id=\"products\">\r\n  <tr>\r\n    <th>Product Name</th>\r\n    <th>Release Date</th>\r\n    <th>Price</th>\r\n  </tr>\r\n<%= render @products %>\r\n</table>\r\n```\r\n\r\nCreate product partial, `_product.html.erb`:\r\n\r\n```rhtml\r\n<tr>\r\n  <td><%= product.name %></td>\r\n  <td><%= product.released_on.strftime(\"%B %e, %Y\") %></td>\r\n  <td><%= number_to_currency(product.price) %></td>\r\n</tr>\r\n```\r\n\r\nReplace the body section of the layout file:\r\n\r\n```rhtml\r\n<body>\r\n  <div id=\"container\">\r\n    <% flash.each do |name, msg| %>\r\n      <%= content_tag :div, msg, id: \"flash_#{name}\" %>\r\n    <% end %>\r\n    <%= yield %>\r\n  </div>\r\n</body>\r\n```\r\n\r\nYou will now be able to view list of products in the home page.\r\n\r\n## Export Data\r\n\r\nAdd download link to CSV and Excel in products index page.\r\n\r\n```rhtml\r\n<p>\r\n  Download:\r\n  <%= link_to \"CSV\", products_path(format: \"csv\") %> |\r\n  <%= link_to \"Excel\", products_path(format: \"xls\") %>\r\n</p>\r\n```\r\n\r\nChange the index action.\r\n\r\n```ruby\r\nrespond_to do |format|\r\n  format.html\r\n  format.csv { send_data @products.to_csv }\r\n  format.xls \r\nend\r\n```\r\n\r\nAdd the converter method to product model.\r\n\r\n```ruby\r\ndef self.to_csv(options = {})\r\n  CSV.generate(options) do |csv|\r\n    csv << column_names\r\n    all.each do |product|\r\n      csv << product.attributes\r\n    end\r\n  end\r\nend\r\n```\r\n\r\nClick on the download link. You will get the error:\r\n\r\n```\r\nTo respond to a custom format, register it as a MIME type first: http://guides.rubyonrails.org/action_controller_overview.html#restful-downloads. If you meant to respond to a variant like :tablet or :phone, not a custom format, be sure to nest your variant response within a format response: format.html { |html| html.tablet { ... } }\r\n```\r\n\r\nIn `config/initializers/mime_types.rb`, add:\r\n\r\n```ruby\r\nMime::Type.register \"application/xls\", :xls\r\n```\r\n\r\nRestart the server. Click on download link again. You will get the error:\r\n\r\n```\r\nuninitialized constant Product::CSV\r\n```\r\n\r\nAdd the require statement:\r\n\r\n```ruby\r\nrequire \'csv\'\r\n```\r\n\r\nin product model. Let\'s experiment in the rails console. We can get the list of column names for a model like this:\r\n\r\n```ruby\r\nProduct.column_names\r\n => [\"id\", \"name\", \"released_on\", \"price\", \"created_at\", \"updated_at\"]\r\n```\r\n\r\nWe can retrieve the values of a given record like this:\r\n\r\n```ruby\r\np = Product.first\r\n  Product Load (0.1ms)  SELECT  \"products\".* FROM \"products\" ORDER BY \"products\".\"id\" ASC LIMIT ?  [[\"LIMIT\", 1]]\r\n => #<Product id: 1, name: \"Settlers of Catan\", released_on: \"2016-04-15\", price: #<BigDecimal:7fada51e1018,\'0.35E2\',9(18)>, created_at: \"2016-06-09 20:16:29\", updated_at: \"2016-06-09 20:16:29\">\r\n> p.attributes\r\n => {\"id\"=>1, \"name\"=>\"Settlers of Catan\", \"released_on\"=>Fri, 15 Apr 2016, \"price\"=>#<BigDecimal:7fada51e1018,\'0.35E2\',9(18)>, \"created_at\"=>Thu, 09 Jun 2016 20:16:29 UTC +00:00, \"updated_at\"=>Thu, 09 Jun 2016 20:16:29 UTC +00:00}\r\n> p.attributes.values\r\n => [1, \"Settlers of Catan\", Fri, 15 Apr 2016, #<BigDecimal:7fada51e1018,\'0.35E2\',9(18)>, Thu, 09 Jun 2016 20:16:29 UTC +00:00, Thu, 09 Jun 2016 20:16:29 UTC +00:00]\r\n```\r\n\r\nWe can now implement the `to_csv` method in product model. \r\n\r\n```ruby\r\ndef self.to_csv(options = {})\r\n  CSV.generate(options) do |csv|\r\n    csv << column_names\r\n    all.each do |product|\r\n      csv << product.attributes.values\r\n    end\r\n  end\r\nend\r\n```\r\n\r\nSince we are getting all the columns for this product, we retrieve the values for all the attributes of a given product. You will now be able to download the csv file. In a real project, I would create a new ProductCsvGenerator class for this method, the signature of the `to_csv` would not dependent on ActiveRecord specific details such as accessing product attribute values. It would look something like this:\r\n\r\n```ruby\r\ndef self.to_csv(column_names, products, options = {})\r\n  CSV.generate(options) do |csv|\r\n    csv << column_names\r\n    products.each do |product|\r\n      csv << product.column_values\r\n    end\r\n  end\r\nend\r\n```\r\n\r\nIn this case, the products collection would be a product wrapper that encapsulates the knowledge about accessing the values of the product attributes.\r\n\r\n### Exporting Specified Columns\r\n\r\nLet\'s say you want to filter out `created_at` and `updated_at` fields, we can do it like this:\r\n\r\n```ruby\r\ndef self.to_csv(options = {})\r\n  desired_columns = [\"id\", \"name\", \"released_on\", \"price\"]\r\n  CSV.generate(options) do |csv|\r\n    csv << desired_columns\r\n    all.each do |product|\r\n      csv << product.attributes.values_at(*desired_columns)\r\n    end\r\n  end\r\nend\r\n```\r\n\r\nCreate index.xls.erb with:\r\n\r\n```rhtml\r\n<?xml version=\"1.0\"?>\r\n<Workbook xmlns=\"urn:schemas-microsoft-com:office:spreadsheet\"\r\n  xmlns:o=\"urn:schemas-microsoft-com:office:office\"\r\n  xmlns:x=\"urn:schemas-microsoft-com:office:excel\"\r\n  xmlns:ss=\"urn:schemas-microsoft-com:office:spreadsheet\"\r\n  xmlns:html=\"http://www.w3.org/TR/REC-html40\">\r\n  <Worksheet ss:Name=\"Sheet1\">\r\n    <Table>\r\n      <Row>\r\n        <Cell><Data ss:Type=\"String\">ID</Data></Cell>\r\n        <Cell><Data ss:Type=\"String\">Name</Data></Cell>\r\n        <Cell><Data ss:Type=\"String\">Release Date</Data></Cell>\r\n        <Cell><Data ss:Type=\"String\">Price</Data></Cell>\r\n      </Row>\r\n    <% @products.each do |product| %>\r\n      <Row>\r\n        <Cell><Data ss:Type=\"Number\"><%= product.id %></Data></Cell>\r\n        <Cell><Data ss:Type=\"String\"><%= product.name %></Data></Cell>\r\n        <Cell><Data ss:Type=\"String\"><%= product.released_on %></Data></Cell>\r\n        <Cell><Data ss:Type=\"Number\"><%= product.price %></Data></Cell>\r\n      </Row>\r\n    <% end %>\r\n    </Table>\r\n  </Worksheet>\r\n</Workbook>\r\n```\r\n\r\nClick on Excel download link. You will now be able to download and view the excel spreadsheet. You can download the code for this article from [exp](https://github.com/bparanj/exp \'Export\').\r\n\r\n\r\n','2016-06-10 04:40:49','2016-11-06 07:58:35'),(4131,'Import Records from CSV and Excel in Rails 5','We will continue working on the project we created in [Exporting Records in CSV and Excel Formats in Rails 5](https://rubyplus.com/articles/4121-Exporting-Records-in-CSV-and-Excel-Formats-in-Rails-5 \'Exporting Records in CSV and Excel Formats in Rails 5\'). Add:\r\n\r\n```ruby\r\ngem \'roo\'\r\n```\r\n\r\nto Gemfile and run bundle. In products/index.html.erb, add file upload field:\r\n\r\n```rhtml\r\n<h2>Import Products</h2>\r\n<%= form_tag import_products_path, multipart: true do %>\r\n  <%= file_field_tag :file %>\r\n  <%= submit_tag \"Import\" %>\r\n<% end %>\r\n```\r\n\r\nDefine route to import data from the uploaded file.\r\n\r\n```ruby\r\nresources :products do\r\n  collection do\r\n    post :import\r\n  end\r\nend\r\n```\r\n\r\nThis defines the following route.\r\n\r\n```\r\nimport_products POST   /products/import(.:format)   products#import\r\n```\r\n\r\nImplement import action in products controller.\r\n\r\n```ruby\r\ndef import\r\n  Product.import(params[:file])\r\n  \r\n  redirect_to root_url, notice: \'Products imported.\'\r\nend\r\n```\r\n\r\nThis gives the error:\r\n\r\n```\r\nuninitialized constant Roo::Csv\r\n```\r\n\r\nChange:\r\n\r\n```ruby\r\nRoo::Csv\r\n```\r\n\r\nto \r\n\r\n```ruby\r\nRoo::CSV\r\n```\r\n\r\nIn product model, change:\r\n\r\n```ruby\r\nspreadsheet = Roo::Spreadsheet.open(file.path)\r\n```\r\n\r\nWe get the error, ActiveRecord::NotFound exception. Change the import line that finds a record like this:\r\n\r\n```ruby\r\nproduct = find_by(id: row[\"id\"]) || new\r\n```\r\n\r\nThe entire method now looks like this:\r\n\r\n```ruby\r\ndef self.import(file)\r\n  spreadsheet = Roo::Spreadsheet.open(file.path)\r\n  header = spreadsheet.row(1)\r\n  (2..spreadsheet.last_row).each do |i|\r\n    row = Hash[[header, spreadsheet.row(i)].transpose]\r\n    product = find_by(id: row[\"id\"]) || new\r\n    product.attributes = row.to_hash\r\n    product.save!\r\n  end\r\nend  \r\n```\r\n\r\nMake sure to name the headers have the same value as the column name in the database, so the header should be id, name and `released_on`. Delete this:\r\n\r\n```ruby\r\ndef self.open_spreadsheet(file)\r\n  case File.extname(file.original_filename)\r\n  when \".csv\" then Roo::CSV.new(file.path, nil, :ignore)\r\n  when \".xls\" then Roo::Excel.new(file.path, nil, :ignore)\r\n  when \".xlsx\" then Roo::Excelx.new(file.path, nil, :ignore)\r\n  else raise \"Unknown file type: #{file.original_filename}\"\r\n  end\r\nend\r\n```\r\n\r\nThis uses [Roo Gem](https://github.com/roo-rb/roo \'Roo Gem\') version 2.4.0. The railscast uses Roo gem 1.10.1. You can download the code for this article from [exp](https://github.com/bparanj/exp \'Export\').','2016-06-10 04:43:12','2016-06-10 04:43:12'),(4141,'File Upload using Refile Gem in Rails 5','## Install Prerequisite Image Processing Library\r\n\r\nCheck if ImageMagick is already installed by running the convert command.\r\n\r\n```\r\nconvert -version\r\n```\r\n\r\nIf it is already installed, you will see the ImageMagick version number:\r\n\r\n```\r\nVersion: ImageMagick 6.9.2-4 Q16 x86_64 2015-10-11 http://www.imagemagick.org\r\nCopyright: Copyright (C) 1999-2015 ImageMagick Studio LLC\r\nLicense: http://www.imagemagick.org/script/license.php\r\nFeatures: Cipher DPC Modules \r\nDelegates (built-in): bzlib freetype jng jpeg ltdl lzma png tiff xml zlib\r\n```\r\n\r\nIf it is not already installed, you can install it on OS X:\r\n\r\n```\r\nbrew install imagemagick\r\n```\r\n\r\nOn Ubuntu:\r\n\r\n```\r\nsudo apt-get install imagemagick\r\n```\r\n\r\n## Create a Rails 5 Photo Album App\r\n\r\nCreate a Rails 5 project.\r\n\r\n```\r\nrails new album\r\n```\r\n\r\nCreate a photo scaffold.\r\n\r\n```\r\nrails g scaffold photo name\r\n```\r\n\r\nMigrate the database.\r\n\r\n```\r\nrails db:migrate\r\n```\r\n\r\n## Install Refile Gems\r\n\r\nAdd the gems to Gemfile.\r\n\r\n```ruby\r\ngem \"refile\", require: \"refile/rails\"\r\ngem \"refile-mini_magick\"\r\n```\r\n\r\nRun:\r\n\r\n```\r\nbundle\r\n```\r\n\r\nThis results in the following error:\r\n\r\n```\r\nBundler could not find compatible versions for gem \"rack\":\r\n  In Gemfile:\r\n    rails (< 5.1, >= 5.0.0.rc1) was resolved to 5.0.0.rc1, which depends on\r\n      actioncable (= 5.0.0.rc1) was resolved to 5.0.0.rc1, which depends on\r\n        actionpack (= 5.0.0.rc1) was resolved to 5.0.0.rc1, which depends on\r\n          rack (~> 2.x)\r\n\r\n    rails (< 5.1, >= 5.0.0.rc1) was resolved to 5.0.0.rc1, which depends on\r\n      actioncable (= 5.0.0.rc1) was resolved to 5.0.0.rc1, which depends on\r\n        actionpack (= 5.0.0.rc1) was resolved to 5.0.0.rc1, which depends on\r\n          rack-test (~> 0.6.3) was resolved to 0.6.3, which depends on\r\n            rack (>= 1.0)\r\n\r\n    refile-mini_magick was resolved to 0.1.0, which depends on\r\n      refile (~> 0.5) was resolved to 0.5.0, which depends on\r\n        sinatra (~> 1.4.5) was resolved to 1.4.5, which depends on\r\n          rack (~> 1.4)\r\n\r\n    sass-rails (~> 5.0) was resolved to 5.0.4, which depends on\r\n      sprockets (< 4.0, >= 2.8) was resolved to 3.6.0, which depends on\r\n        rack (< 3, > 1)\r\n```\r\n\r\nYou can specify git source with a ref, branch or tag in Gemfile like this:\r\n\r\n```ruby\r\ngem \'rails\', :git => \"git://github.com/rails/rails.git\", :ref => \"4aded\"\r\ngem \'rails\', :git => \"git://github.com/rails/rails.git\", :branch => \"2-3-stable\"\r\ngem \'rails\', :git => \"git://github.com/rails/rails.git\", :tag => \"v2.3.5\"\r\n```\r\n\r\nFor our gem, we can use the tag 0.6.2 like this:\r\n\r\n```ruby\r\ngem \'refile\', :git => \"git://github.com/rails/rails.git\", :tag => \"0.6.2\", require: \"refile/rails\"\r\ngem \"refile-mini_magick\"\r\n```\r\n\r\nRun:\r\n\r\n```\r\nbundle\r\n```\r\n\r\n```\r\nfatal: Needed a single revision\r\n```\r\n\r\nYou must specify the tag as seen in the github repo, change the tag:\r\n\r\n```\r\n:tag => \"v0.6.2\"\r\n```\r\n\r\nYou will now get the error:\r\n\r\n```\r\nBundler could not find compatible versions for gem \"rack\":\r\n  In Gemfile:\r\n    rails (< 5.1, >= 5.0.0.rc1) was resolved to 5.0.0.rc1, which depends on\r\n      railties (= 5.0.0.rc1) was resolved to 5.0.0.rc1, which depends on\r\n        actionpack (= 5.0.0.rc1) was resolved to 5.0.0.rc1, which depends on\r\n          rack (~> 2.x)\r\n\r\n    refile was resolved to 0.6.2, which depends on\r\n      sinatra (~> 1.4.5) was resolved to 1.4.5, which depends on\r\n        rack (~> 1.4)\r\n\r\n[Can\'t install on Rails 5 ](https://github.com/refile/refile/issues/447 \'Can\'t install on Rails 5\')\r\n```\r\n\r\nChange the refile gem section in Gemfile to this:\r\n\r\n```ruby\r\ngem \'sinatra\', github: \'sinatra\' #require master to get the rack >= 2.0\r\n# remove version on gem dependency to use sinatra master branch\r\ngem \'refile\', require: \'refile/rails\', github: \'pgericson/refile\', branch: \'stupid-hack-sinatra-version\' \r\ngem \'refile-mini_magick\'\r\n```\r\n\r\nRun:\r\n\r\n```\r\nbundle\r\n```\r\n\r\nThe installation will now complete successfully.\r\n\r\n## Integrate Refile Gem into Rails 5 App\r\n\r\nAdd the attachment declaration in the photo model.\r\n\r\n```ruby\r\nclass Photo < ApplicationRecord\r\n  attachment :image\r\nend\r\n```\r\n\r\nGenerate the migration to add `image_id` column to photos table.\r\n\r\n```\r\nrails g migration add_image_to_photos image_id\r\n```\r\n\r\nMigrate the database.\r\n\r\n```\r\nrails db:migrate\r\n```\r\n\r\nIn the form partial, add the file upload field:\r\n\r\n```rhtml\r\n<div class=\'field\'>\r\n	<%= f.attachment_field :image %>\r\n</div>\r\n```\r\n\r\nAllow the image field to be accessed from the form.\r\n\r\n```ruby\r\ndef photo_params\r\n  params.require(:photo).permit(:name, :image)\r\nend\r\n```\r\n\r\nIn show.html.erb, display the uploaded image:\r\n\r\n```rhtml\r\n<%= image_tag attachment_url (@photo, :image) %>\r\n```\r\n\r\nHaving a space between the arguments and the attachment_url method will create a syntax error in Ruby. Remove the space.\r\n\r\n```rhtml\r\n<%= image_tag attachment_url(@photo, :image) %>\r\n```\r\n\r\nYou can use the fill and dimensions to display the image in a different size.\r\n\r\n```rhtml\r\n<%= image_tag attachment_url(@photo, :image, :fill, 100, 100, format: \'jpg\') %>\r\n```\r\n\r\nThis will resize the image to a small thumb. You can increase the size from 100 to 300.\r\n\r\n```rhtml\r\n<%= image_tag attachment_url(@photo, :image, :fill, 300, 300, format: \'jpg\') %>\r\n```\r\n\r\nThis chops the top and bottom. Change fill to fit to solve that problem. \r\n\r\n```rhtml\r\n<%= image_tag attachment_url(@photo, :image, :fit, 300, 300, format: \'jpg\') %>\r\n```\r\n\r\n## Removing Attachments\r\n\r\nAdd remove check box to form partial:\r\n\r\n```ruby\r\n<% if @photo.image_id? %>\r\n  <%= image_tag attachment_url(@photo, :image, :fit, 500, 500) %>\r\n  <%= f.check_box :remove_image %>\r\n  <%= f.label :remove_image %>\r\n<% end %>\r\n```\r\n\r\nAllow the `remove_image` field to be submitted to the server.\r\n\r\n```ruby\r\ndef photo_params\r\n  params.require(:photo).permit(:name, :image, :remove_image)\r\nend\r\n```\r\n\r\nYou will now be able to delete the image. When the image is displayed, this results in an error:\r\n\r\n```\r\nnil is not a valid asset source in photos#show\r\n```\r\n\r\nAdd a conditional to hide the image display if there is no image.\r\n\r\n```rhtml\r\n<% if @photo.image_id? %>\r\n  <%= image_tag attachment_url(@photo, :image, :fit, 500, 500, format: \'jpg\') %>\r\n<% end %>\r\n```\r\n\r\nReload photos show page, it will load without crashing. It will have only the name. \r\n\r\n## Image Type Validation\r\n\r\nTo validate the file uploaded is an image you can use the type option.\r\n\r\n```ruby\r\nclass Photo < ApplicationRecord\r\n  attachment :image, type: :image\r\nend\r\n```\r\n\r\nThis will restrict the uploaded file to JPEG, PNG and GIF formats. For more validations, checkout the [refile](https://github.com/refile/refile \'Refile Gem\') home page. \r\n\r\n## Cleanup\r\n\r\nDelete the scaffold.css and add your own layout to layout.css. Checkout the source code for this article at [album](https://github.com/bparanj/refil \'Album\').\r\n\r\n## Summary\r\n\r\nIn this article, you learned how to implement file upload using refile gem in Rails 5 apps.\r\n\r\n## References\r\n\r\n[How to resize Image?](https://github.com/refile/refile/issues/313 \'How to resize Image\')\r\n[Rails 5 support](https://github.com/refile/refile/issues/416 \'Rails 5 support\')','2016-06-14 04:29:40','2017-02-12 19:01:35'),(4151,'Validation of CSV Records for Importer in Rails 5','This article updates the original railscast episode on Export / Import of CSV / Excel files to database to Rails 5. Create a new `product_imports` controller with new action.\r\n\r\n```\r\nrails g controller product_imports new\r\n```\r\n\r\nThe new and create action is implemented as follows:\r\n\r\n```ruby\r\nclass ProductImportsController < ApplicationController\r\n  def new\r\n    @product_import = ProductImport.new\r\n  end\r\n\r\n  def create\r\n    @product_import = ProductImport.new(params[:product_import])\r\n    if @product_import.save\r\n      redirect_to root_url, notice: \"Imported products successfully.\"\r\n    else\r\n      render :new\r\n    end\r\n  end\r\nend\r\n```\r\n\r\nThe ProductImport class is implemented as follows:\r\n\r\n```ruby\r\nclass ProductImport\r\n  include ActiveModel::Model\r\n  attr_accessor :file\r\n\r\n  def initialize(attributes = {})\r\n    attributes.each { |name, value| send(\"#{name}=\", value) }\r\n  end\r\n\r\n  def persisted?\r\n    false\r\n  end\r\n\r\n  def save\r\n    if imported_products.map(&:valid?).all?\r\n      imported_products.each(&:save!)\r\n      true\r\n    else\r\n      imported_products.each_with_index do |product, index|\r\n        product.errors.full_messages.each do |message|\r\n          errors.add :base, \"Row #{index+2}: #{message}\"\r\n        end\r\n      end\r\n      false\r\n    end\r\n  end\r\n\r\n  def imported_products\r\n    @imported_products ||= load_imported_products\r\n  end\r\n\r\n  def load_imported_products\r\n    spreadsheet = Roo::Spreadsheet.open(file.path)\r\n    header = spreadsheet.row(1)\r\n    (2..spreadsheet.last_row).each do |i|\r\n      row = Hash[[header, spreadsheet.row(i)].transpose]\r\n      product = Product.find_by(id: row[\"id\"]) || Product.new\r\n      product.attributes = row.to_hash\r\n      product\r\n    end    \r\n  end\r\nend\r\n```\r\n\r\nDefine the routes for the `product_imports` resource.\r\n\r\n```ruby\r\nresources :product_imports\r\n```\r\n\r\nCreate the `product_imports/new.html.erb` view:\r\n\r\n```rhtml\r\n<h1>Product Import</h1>\r\n<p>A CSV or Excel file can be used to import records. The first row should be the column name. The following columns are allowed.</p>\r\n\r\n<ul>\r\n  <% Product.columns.each do |column| %>\r\n    <% if column.name.in? [\"id\", \"name\", \"released_on\", \"price\"] %>\r\n      <li>\r\n        <strong><%= column.name %></strong> -\r\n        <%= column.type.to_s.titleize %> type\r\n      </li>\r\n    <% end %>\r\n  <% end %>\r\n</ul>\r\n\r\n<p>If an <strong>id</strong> is supplied it will update the matching record instead of creating a new one.</p>\r\n\r\n<%= form_for @product_import do |f| %>\r\n  <% if @product_import.errors.any? %>\r\n    <div id=\"error_explanation\">\r\n      <h2><%= pluralize(@product_import.errors.count, \"error\") %> prohibited this import from completing:</h2>\r\n      <ul>\r\n      <% @product_import.errors.full_messages.each do |msg| %>\r\n        <li><%= msg %></li>\r\n      <% end %>\r\n      </ul>\r\n    </div>\r\n  <% end %>\r\n\r\n  <div class=\"field\">\r\n    <%= f.file_field :file %>\r\n  </div>\r\n  <div class=\"buttons\"><%= f.submit \"Import\" %></div>\r\n<% end %>\r\n```\r\n\r\nThe column names are hard-coded in the view, because if we do:\r\n\r\n```ruby\r\nProduct.accessible_attributes\r\n```\r\n\r\nWe will get this error:\r\n\r\n```\r\nNoMethodError: undefined method `accessible_attributes\' for Product (call \'Product.connection\' to establish a connection):Class\r\nDid you mean?  accepts_nested_attributes_for\r\n```\r\n\r\nBrowse to `http://localhost:3000/product_imports/new`. You can now import a CSV file that has valid records. Add:\r\n\r\n```ruby\r\nvalidates_presence_of :price\r\n```\r\n\r\nto product model. Make the price value blank and import a csv file. You will get the validation error:\r\n\r\n```\r\n2 errors prohibited this import from completing:\r\n    Row 2: Price can\'t be blank\r\n    Row 3: Price can\'t be blank\r\n```\r\n\r\nYou can download the source code for this article from [exp](https://github.com/bparanj/exp \'export\').\r\n\r\n## Summary\r\n\r\nIn this article, you learned how to validate the CSV records during import into database in Rails 5.\r\n\r\n## References\r\n\r\n[ActiveModel Rails API](http://api.rubyonrails.org/classes/ActiveModel/Model.html \'ActiveModel Rails API\')','2016-06-14 04:33:58','2016-06-14 06:26:03'),(4161,'Photo Gallery using Lightbox 2 in Rails 5','In this article, you will learn how to implement a photo gallery using Lightbox 2 in Rails 5. We will continue working on the album project that we discussed in the article [File Upload using Refile Gem in Rails 5](https://rubyplus.com/articles/4141-File-Upload-using-Refile-Gem-in-Rails-5 \'File Upload using Refile Gem in Rails 5\').\r\n\r\n## Initial Setup\r\n\r\n- Download [lightbox 2](http://lokeshdhakar.com/projects/lightbox2/ \'lightbox2\'). \r\n- Extract the zip file. \r\n- Copy the lightbox.css to app/vendor/assets/stylesheets directory.\r\n- Copy the lightbox.js to app/vendor/assets/javascripts directory.\r\n- Copy the images close.png, loading.gif, next.png and prev.png to app/assets/images folder.\r\n\r\nYou can use a package manager, Bower: \r\n\r\n```\r\nbower install lightbox2 --save\r\n```\r\n\r\nor NPM: \r\n\r\n```\r\nnpm install lightbox2 --save\r\n```\r\n\r\nto install [lightbox2](http://lokeshdhakar.com/projects/lightbox2/).\r\n\r\n## Integrate Lightbox 2 with Rails 5\r\n\r\nLet\'s hook Lightbox 2 Javascript to asset pipeline. Add\r\n\r\n```\r\n//= require lightbox\r\n```\r\n\r\nto app/assets/javascripts/application.js. It will now look like this:\r\n\r\n```\r\n//= require jquery\r\n//= require jquery_ujs\r\n//= require turbolinks	\r\n//= require lightbox\r\n//= require_tree .\r\n```\r\n\r\nLet\'s hook Lightbox 2 stylesheet to asset pipeline. Add\r\n\r\n```\r\n@import \'lightbox\';\r\n```\r\n\r\nto app/assets/stylesheets/application.scss. It will now look like this:\r\n\r\n```\r\n *= require_tree .\r\n *= require_self\r\n */\r\n\r\n@import \'lightbox\';\r\n```\r\n\r\n**Note**: The file extension must be .scss not css.  Move the Javascript Include tag in layout file. The app/views/layouts/application.html.erb must have the `javascript_include_tag` just before body tag ends, otherwise the photo gallery will not work. The layout file looks like this:\r\n\r\n```rhtml\r\n<!DOCTYPE html>\r\n<html>\r\n  <head>\r\n    <title>Album</title>\r\n    <%= csrf_meta_tags %>\r\n    <%= stylesheet_link_tag \'application\', media: \'all\', \'data-turbolinks-track\': \'reload\' %>\r\n  </head>\r\n  <body>\r\n    <div id=\"container\">\r\n      <% flash.each do |name, msg| %>\r\n        <%= content_tag :div, msg, id: \"flash_#{name}\" %>\r\n      <% end %>\r\n      <%= yield %>\r\n    </div>\r\n	\r\n    <%= javascript_include_tag \'application\', \'data-turbolinks-track\': \'reload\' %>\r\n	\r\n  </body>\r\n</html>\r\n```\r\n\r\nRename the lightbox.css to lightbox.scss.erb. The css files needs to use asset pipeline helper `image_path`, to hook the images to asset pipeline. It will now look like this:\r\n\r\n```css\r\n/* Preload images */\r\nbody:after {\r\n  content: url(<%= image_path(\'close.png\')%>) url(<%= image_path(\'loading.gif\')%>) url(<%= image_path(\'prev.png\')%>) url(<%= image_path(\'next.png\')%>);\r\n  display: none;\r\n}\r\n\r\nbody.lb-disable-scrolling {\r\n  overflow: hidden;\r\n}\r\n\r\n.lightboxOverlay {\r\n  position: absolute;\r\n  top: 0;\r\n  left: 0;\r\n  z-index: 9999;\r\n  background-color: black;\r\n  filter: progid:DXImageTransform.Microsoft.Alpha(Opacity=80);\r\n  opacity: 0.8;\r\n  display: none;\r\n}\r\n\r\n.lightbox {\r\n  position: absolute;\r\n  left: 0;\r\n  width: 100%;\r\n  z-index: 10000;\r\n  text-align: center;\r\n  line-height: 0;\r\n  font-weight: normal;\r\n}\r\n\r\n.lightbox .lb-image {\r\n  display: block;\r\n  height: auto;\r\n  max-width: inherit;\r\n  border-radius: 3px;\r\n}\r\n\r\n.lightbox a img {\r\n  border: none;\r\n}\r\n\r\n.lb-outerContainer {\r\n  position: relative;\r\n  background-color: white;\r\n  *zoom: 1;\r\n  width: 250px;\r\n  height: 250px;\r\n  margin: 0 auto;\r\n  border-radius: 4px;\r\n}\r\n\r\n.lb-outerContainer:after {\r\n  content: \"\";\r\n  display: table;\r\n  clear: both;\r\n}\r\n\r\n.lb-container {\r\n  padding: 4px;\r\n}\r\n\r\n.lb-loader {\r\n  position: absolute;\r\n  top: 43%;\r\n  left: 0;\r\n  height: 25%;\r\n  width: 100%;\r\n  text-align: center;\r\n  line-height: 0;\r\n}\r\n\r\n.lb-cancel {\r\n  display: block;\r\n  width: 32px;\r\n  height: 32px;\r\n  margin: 0 auto;\r\n  \r\n  background: url(<%= image_path(\'loading.gif\')%>) no-repeat;\r\n}\r\n\r\n.lb-nav {\r\n  position: absolute;\r\n  top: 0;\r\n  left: 0;\r\n  height: 100%;\r\n  width: 100%;\r\n  z-index: 10;\r\n}\r\n\r\n.lb-container > .nav {\r\n  left: 0;\r\n}\r\n\r\n.lb-nav a {\r\n  outline: none;\r\n  background-image: url(\'data:image/gif;base64,R0lGODlhAQABAPAAAP///wAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw==\');\r\n}\r\n\r\n.lb-prev, .lb-next {\r\n  height: 100%;\r\n  cursor: pointer;\r\n  display: block;\r\n}\r\n\r\n.lb-nav a.lb-prev {\r\n  width: 34%;\r\n  left: 0;\r\n  float: left;\r\n  background: url(<%= image_path(\'prev.png\')%>) left 48% no-repeat;\r\n  filter: progid:DXImageTransform.Microsoft.Alpha(Opacity=0);\r\n  opacity: 0;\r\n  -webkit-transition: opacity 0.6s;\r\n  -moz-transition: opacity 0.6s;\r\n  -o-transition: opacity 0.6s;\r\n  transition: opacity 0.6s;\r\n}\r\n\r\n.lb-nav a.lb-prev:hover {\r\n  filter: progid:DXImageTransform.Microsoft.Alpha(Opacity=100);\r\n  opacity: 1;\r\n}\r\n\r\n.lb-nav a.lb-next {\r\n  width: 64%;\r\n  right: 0;\r\n  float: right;\r\n  background: url(<%= image_path(\'next.png\')%>) right 48% no-repeat;\r\n  filter: progid:DXImageTransform.Microsoft.Alpha(Opacity=0);\r\n  opacity: 0;\r\n  -webkit-transition: opacity 0.6s;\r\n  -moz-transition: opacity 0.6s;\r\n  -o-transition: opacity 0.6s;\r\n  transition: opacity 0.6s;\r\n}\r\n\r\n.lb-nav a.lb-next:hover {\r\n  filter: progid:DXImageTransform.Microsoft.Alpha(Opacity=100);\r\n  opacity: 1;\r\n}\r\n\r\n.lb-dataContainer {\r\n  margin: 0 auto;\r\n  padding-top: 5px;\r\n  *zoom: 1;\r\n  width: 100%;\r\n  -moz-border-radius-bottomleft: 4px;\r\n  -webkit-border-bottom-left-radius: 4px;\r\n  border-bottom-left-radius: 4px;\r\n  -moz-border-radius-bottomright: 4px;\r\n  -webkit-border-bottom-right-radius: 4px;\r\n  border-bottom-right-radius: 4px;\r\n}\r\n\r\n.lb-dataContainer:after {\r\n  content: \"\";\r\n  display: table;\r\n  clear: both;\r\n}\r\n\r\n.lb-data {\r\n  padding: 0 4px;\r\n  color: #ccc;\r\n}\r\n\r\n.lb-data .lb-details {\r\n  width: 85%;\r\n  float: left;\r\n  text-align: left;\r\n  line-height: 1.1em;\r\n}\r\n\r\n.lb-data .lb-caption {\r\n  font-size: 13px;\r\n  font-weight: bold;\r\n  line-height: 1em;\r\n}\r\n\r\n.lb-data .lb-number {\r\n  display: block;\r\n  clear: left;\r\n  padding-bottom: 1em;\r\n  font-size: 12px;\r\n  color: #999999;\r\n}\r\n\r\n.lb-data .lb-close {\r\n  display: block;\r\n  float: right;\r\n  width: 30px;\r\n  height: 30px;   \r\n  background: url(<%= image_path(\'close.png\')%>) top right no-repeat;\r\n  text-align: right;\r\n  outline: none;\r\n  filter: progid:DXImageTransform.Microsoft.Alpha(Opacity=70);\r\n  opacity: 0.7;\r\n  -webkit-transition: opacity 0.2s;\r\n  -moz-transition: opacity 0.2s;\r\n  -o-transition: opacity 0.2s;\r\n  transition: opacity 0.2s;\r\n}\r\n\r\n.lb-data .lb-close:hover {\r\n  cursor: pointer;\r\n  filter: progid:DXImageTransform.Microsoft.Alpha(Opacity=100);\r\n  opacity: 1;\r\n}\r\n```\r\n\r\n## Test the Configuration\r\n\r\nLet\'s use the example code that ships with Lightbox 2 to verify our setup is working. Add the following code in app/views/photos/index.html.erb.\r\n\r\n```html\r\n<h3>A Four Image Set</h3>\r\n  <div>\r\n      <a class=\"example-image-link\" href=\"http://lokeshdhakar.com/projects/lightbox2/images/image-3.jpg\" data-lightbox=\"example-set\" data-title=\"Click the right half of the image to move forward.\"><img class=\"example-image\" src=\"http://lokeshdhakar.com/projects/lightbox2/images/thumb-3.jpg\" alt=\"\"/></a>\r\n      <a class=\"example-image-link\" href=\"http://lokeshdhakar.com/projects/lightbox2/images/image-4.jpg\" data-lightbox=\"example-set\" data-title=\"Or press the right arrow on your keyboard.\"><img class=\"example-image\" src=\"http://lokeshdhakar.com/projects/lightbox2/images/thumb-4.jpg\" alt=\"\" /></a>\r\n      <a class=\"example-image-link\" href=\"http://lokeshdhakar.com/projects/lightbox2/images/image-5.jpg\" data-lightbox=\"example-set\" data-title=\"The next image in the set is preloaded as you\'re viewing.\"><img class=\"example-image\" src=\"http://lokeshdhakar.com/projects/lightbox2/images/thumb-5.jpg\" alt=\"\" /></a>\r\n      <a class=\"example-image-link\" href=\"http://lokeshdhakar.com/projects/lightbox2/images/image-6.jpg\" data-lightbox=\"example-set\" data-title=\"Click anywhere outside the image or the X to the right to close.\"><img class=\"example-image\" src=\"http://lokeshdhakar.com/projects/lightbox2/images/thumb-6.jpg\" alt=\"\" /></a>\r\n  </div>\r\n</section>\r\n```\r\n\r\nBrowse to `http://localhost:3000/photos` to view the lightbox photo gallery in action. \r\n\r\n## Photo Gallery of Album\r\n\r\nWe can now remove the hard coded images and use the uploaded images for the gallery like this:\r\n\r\n```rhtml\r\n<div>\r\n  <% @photos.each do |photo| %>	  	  \r\n    <%= link_to(image_tag(attachment_url(photo, :image, :fit, 100, 100, format: \'jpg\')), attachment_url(photo, :image, :fit, 500, 500, format: \'jpg\'), data: { lightbox: \"example-set\", title: photo.name }) %>		\r\n  <% end %>\r\n</div>	  \r\n```\r\n\r\nYou will now be able to view the uploaded images of the album in a photo gallery. You can [download](https://github.com/bparanj/refi) the source code for this article from github.\r\n\r\n## Summary\r\n\r\nIn this article, you learned how to implement a photo gallery using Lightbox 2 Javascript library in Rails 5.','2016-06-17 18:33:55','2017-02-21 18:05:47'),(4171,'Authentication from Scratch in Rails 5','## Basic Rails 5 App\r\n\r\nCreate a new Rails 5 project.\r\n\r\n```\r\nrails new au5\r\n```\r\n\r\nCreate an article model.\r\n\r\n```\r\nrails g model article name author content:text published_at:datetime\r\n```\r\n\r\nMigrate the database.\r\n\r\n```\r\nrails db:migrate\r\n```\r\n\r\nCreate some sample data in seeds.rb.\r\n\r\n```ruby\r\nsuperman = Article.create! name: \"Superman\", author: \"Clark Kent\", published_at: 1.weeks.ago, content: \"Superman is a fictional comic book superhero appearing in publications by DC Comics, widely considered to be an American cultural icon. Created by American writer Jerry Siegel and Canadian-born American artist Joe Shuster in 1932 while both were living in Cleveland, Ohio, and sold to Detective Comics, Inc. (later DC Comics) in 1938, the character first appeared in Action Comics #1 (June 1938) and subsequently appeared in various radio serials, television programs, films, newspaper strips, and video games. (from Wikipedia)\"\r\nkrypton = Article.create! name: \"Krypton\", author: \"Clark Kent\", published_at: 4.weeks.ago, content: \"Krypton is a fictional planet in the DC Comics universe, and the native world of the super-heroes Superman and, in some tellings, Supergirl and Krypto the Superdog. Krypton has been portrayed consistently as having been destroyed just after Superman\'s flight from the planet, with exact details of its destruction varying by time period, writers and franchise. Kryptonians were the dominant people of Krypton. (from Wikipedia)\"\r\nbatman = Article.create! name: \"Batman & Robin\", author: \"Bruce Wayne\", published_at: 2.weeks.ago, content: \"Batman is a fictional character created by the artist Bob Kane and writer Bill Finger. A comic book superhero, Batman first appeared in Detective Comics #27 (May 1939), and since then has appeared primarily in publications by DC Comics. Originally referred to as The Bat-Man and still referred to at times as The Batman, he is additionally known as The Caped Crusader, The Dark Knight, and the World\'s Greatest Detective, among other titles. (from Wikipedia)\"\r\n\r\nArticle.create! name: \"Wonder Woman\", author: \"Diana of Themyscira\", published_at: 6.weeks.ago, content: \"Wonder Woman is a DC Comics superheroine created by William Moulton Marston. She first appeared in All Star Comics #8 (December 1941). The Wonder Woman title has been published by DC Comics almost continuously except for a brief hiatus in 1986. (from Wikipedia)\"\r\nArticle.create! name: \"Flash\", author: \"Bart Allen\", published_at: 5.weeks.ago, content: \"The Flash is a name shared by several fictional comic book superheroes from the DC Comics universe. Created by writer Gardner Fox and artist Harry Lampert, the original Flash first appeared in Flash Comics #1 (January 1940). (from Wikipedia)\"\r\nArticle.create! name: \"Splinter\", author: \"Hamato Yoshi\", published_at: 3.weeks.ago, content: \"Master Splinter, or simply Splinter, is a fictional character from the Teenage Mutant Ninja Turtles comics and all related media. (from Wikipedia)\"\r\n```\r\n\r\nPopulate the database.\r\n\r\n```\r\nrails db:seed\r\n```\r\n\r\nCreate the articles controller with index, show and edit actions.\r\n\r\n```\r\nrails g controller articles index show edit\r\n```\r\n\r\nThe implementation is straight forward.\r\n\r\n```ruby\r\nclass ArticlesController < ApplicationController\r\n  def index\r\n    @articles = Article.all\r\n  end\r\n\r\n  def show\r\n    @article = Article.find(params[:id])\r\n  end\r\n\r\n  def edit\r\n    @article = Article.find(params[:id])\r\n  end\r\n  \r\n  def update\r\n    @article = Article.find(params[:id])\r\n    if @article.update_attributes(allowed_params)\r\n      redirect_to @article, notice: \'Article has been updated\'\r\n    else\r\n      render :edit\r\n    end\r\n  end\r\n  \r\n  private\r\n  \r\n  def allowed_params\r\n    params.require(:article).permit(:name, :author, :content, :published_at)    \r\n  end\r\nend\r\n```\r\n\r\nThe article edit.html.erb looks like this:\r\n\r\n```rhtml\r\n<h1>Edit Article</h1>\r\n<%= form_for @article do |f| %>\r\n  <% if @article.errors.any? %>\r\n    <div class=\"error_messages\">\r\n      <h2><%= pluralize(@article.errors.count, \"error\") %> prohibited this article from being saved:</h2>\r\n      <ul>\r\n      <% @article.errors.full_messages.each do |msg| %>\r\n        <li><%= msg %></li>\r\n      <% end %>\r\n      </ul>\r\n    </div>\r\n  <% end %>\r\n\r\n  <div class=\"field\">\r\n    <%= f.label :name %><br />\r\n    <%= f.text_field :name %>\r\n  </div>\r\n  <div class=\"field\">\r\n    <%= f.label :author %><br />\r\n    <%= f.text_field :author %>\r\n  </div>\r\n  <div class=\"field\">\r\n    <%= f.label :content %><br />\r\n    <%= f.text_area :content, :rows => 12, :cols => 35 %>\r\n  </div>\r\n  <div class=\"actions\"><%= f.submit %></div>\r\n<% end %>\r\n```\r\n\r\nThe articles index.html.erb looks like this:\r\n\r\n```rhtml\r\n<h1>Articles</h1>\r\n<div id=\"articles\">\r\n<%= render @articles %>\r\n</div>\r\n```\r\n\r\nThe article partial `_article.html.erb` looks like this:\r\n\r\n```rhtml\r\n<h2>\r\n  <%= link_to article.name, article %>\r\n</h2>\r\n<div class=\"info\">\r\n  by <%= article.author %>\r\n  on <%= article.published_at.strftime(\'%b %d, %Y\') %>\r\n</div>\r\n<div class=\"content\"><%= article.content %></div>\r\n```\r\n\r\nThe article show.html.erb looks like this:\r\n\r\n```rhtml\r\n<h1><%= @article.name %></h1>\r\n<%= @article.content %>\r\n<p>\r\n  <%= link_to \"Edit\", edit_article_path(@article) %> |\r\n  <%= link_to \"Browse Articles\", articles_path %>\r\n</p>\r\n```\r\n\r\nDefine the article resource in routes.rb.\r\n\r\n```ruby\r\nRails.application.routes.draw do\r\n  resources :articles\r\n  \r\n  root to: \'articles#index\'\r\nend\r\n```\r\n\r\nThe layout file application.html.erb looks like this:\r\n\r\n```rhtml\r\n<!DOCTYPE html>\r\n<html>\r\n  <head>\r\n    <title>Au5</title>\r\n    <%= csrf_meta_tags %>\r\n    <%= stylesheet_link_tag    \'application\', media: \'all\', \'data-turbolinks-track\': \'reload\' %>\r\n    <%= javascript_include_tag \'application\', \'data-turbolinks-track\': \'reload\' %>\r\n  </head>\r\n  <body>\r\n    <div id=\"container\">\r\n      <% flash.each do |name, msg| %>\r\n        <%= content_tag :div, msg, id: \"flash_#{name}\" %>\r\n      <% end %>\r\n      <%= yield %>\r\n    </div>\r\n  </body>\r\n</html>\r\n```\r\n\r\n## Authentication\r\n\r\nUncomment \r\n\r\n```ruby\r\ngem \'bcrypt\', \'~> 3.1.7\'\r\n```\r\n\r\nin Gemfile. Run:\r\n\r\n```\r\nbundle\r\n```\r\n\r\nGenerate the user model:\r\n\r\n```\r\nrails g resource user email password_digest\r\n```\r\n\r\nThe users controller looks like this:\r\n\r\n```ruby\r\nclass UsersController < ApplicationController\r\n  def new\r\n    @user = User.new\r\n  end\r\n  \r\n  def create\r\n    @user = User.new(allowed_params)\r\n    if @user.save\r\n      redirect_to root_url, notice: \'Thank you for signing up!\'\r\n    else\r\n      render :new\r\n    end\r\n  end\r\n  \r\n  private\r\n  \r\n  def allowed_params\r\n    params.require(:user).permit(:email, :password_digest)\r\n  end\r\nend\r\n```\r\n\r\nRun the migration.\r\n\r\n```\r\nrails db:migrate\r\n```\r\n\r\nThe users/new.html.erb looks like this:\r\n\r\n```rhtml\r\n<h1>Sign Up</h1>\r\n<%= form_for @user do |f| %>\r\n  <% if @user.errors.any? %>\r\n    <div class=\"error_messages\">\r\n      <h2>Form is invalid</h2>\r\n      <ul>\r\n        <% @user.errors.full_messages.each do |message| %>\r\n          <li><%= message %></li>\r\n        <% end %>\r\n      </ul>\r\n    </div>\r\n  <% end %>\r\n\r\n  <div class=\"field\">\r\n    <%= f.label :email %><br />\r\n    <%= f.text_field :email %>\r\n  </div>\r\n  <div class=\"field\">\r\n    <%= f.label :password %><br />\r\n    <%= f.password_field :password %>\r\n  </div>\r\n  <div class=\"field\">\r\n    <%= f.label :password_confirmation %><br />\r\n    <%= f.password_field :password_confirmation %>\r\n  </div>\r\n  <div class=\"actions\"><%= f.submit \"Sign Up\" %></div>\r\n<% end %>\r\n```\r\n\r\nAdd signup link to the layout file.\r\n\r\n```rhtml\r\n<div id=\"user_header\">\r\n   <%= link_to \"Sign Up\", new_user_path %>\r\n</div>\r\n```\r\n\r\nSignup as a new user.\r\n\r\n```\r\nrails g controller sessions new\r\n```\r\n\r\nThe sessions/new.html.erb looks like this:\r\n\r\n```rhtml\r\n<h1>Log In</h1>\r\n<%= form_tag sessions_path do %>\r\n  <div class=\"field\">\r\n    <%= label_tag :email %><br />\r\n    <%= text_field_tag :email, params[:email] %>\r\n  </div>\r\n  <div class=\"field\">\r\n    <%= label_tag :password %><br />\r\n    <%= password_field_tag :password %>\r\n  </div>\r\n  <div class=\"actions\"><%= submit_tag \"Log In\" %></div>\r\n<% end %>\r\n```\r\n\r\nAdd login link to the layout file:\r\n\r\n```rhtml\r\n<%= link_to \"Log In\", new_session_path %>\r\n```\r\n\r\nDefine the sessions resource in routes.rb:\r\n\r\n```ruby\r\nresources :sessions\r\n```\r\n\r\nAdd create action to sessions controller:\r\n\r\n```ruby\r\ndef create\r\n  user = User.find_by(email: params[:email])\r\n  if user && user.authenticate(params[:password])\r\n    session[:user_id] = user.id\r\n    redirect_to root_url, notice: \'Logged in!\'\r\n  else\r\n    flash.now.alert = \'Email or password is invalid\'\r\n    render :new\r\n  end\r\nend\r\n```\r\n\r\nLogin as the newly registered user. You will get the error:\r\n\r\n```\r\nundefined method `authenticate\' for #<User:0x007f8>\r\n```\r\n\r\nAdd:\r\n\r\n```ruby\r\nhas_secure_password\r\n```\r\n\r\nto user.rb. You will now get the error:\r\n\r\n```\r\nBCrypt::Errors::InvalidHash in SessionsController#create \r\n```\r\n\r\nYou can check the values of the user record in the rails console.\r\n\r\n```ruby\r\nu = User.first\r\n  User Load (0.2ms)  SELECT  \"users\".* FROM \"users\" ORDER BY \"users\".\"id\" ASC LIMIT ?  [[\"LIMIT\", 1]]\r\n => #<User id: 1, email: \"bparanj@gmail.com\", password_digest: nil, created_at: \"2016-06-28 20:05:34\", updated_at: \"2016-06-28 20:05:34\">\r\n``` \r\n \r\nSince this record was created before we added the `has_secure_password` declaration, it fails. Create another user and login as that user. You will now get the error:\r\n\r\n```\r\nError: Password can\'t be blank\r\n```\r\n\r\nIn the log, error is: \r\n\r\n```\r\nUnpermitted parameters: password, password_confirmation\r\n```\r\n\r\nTo fix this, in `users_controller.rb` add `allowed_params` method:\r\n\r\n```ruby\r\ndef allowed_params\r\n  params.require(:user).permit(:email, :password, :password_confirmation)\r\nend\r\n```\r\n\r\nUse this method in the action. You can now register and login. We can automatically login the user after signup, in users_controller after saving the user:\r\n\r\n```ruby\r\nsession[:user_id] = @user.id\r\n```\r\n\r\nTo logout a user, add destroy action to `sessions_controller.rb`:\r\n\r\n```ruby\r\ndef destroy\r\n  session[:user_id] = nil\r\n  redirect_to root_url, notice: \'Logged out!\'\r\nend\r\n```\r\n\r\nChange the navigation in the layout file:\r\n\r\n```rhtml\r\n<div id=\"user_header\">\r\n  <% if logged_in? %>\r\n	 <%= link_to \'Logout\', session_path, method: :delete %>\r\n  <% else %>\r\n     <%= link_to \"Sign Up\", new_user_path %>\r\n	 <%= link_to \"Log In\", new_session_path %>		 \r\n  <% end %>\r\n</div>\r\n```\r\n\r\nAdd the logged_in? helper to application controller:\r\n\r\n```ruby\r\nprivate\r\n\r\ndef logged_in?\r\n  @current_user ||= User.find(session[:user_id]) if session[:user_id]\r\nend\r\n\r\nhelper_method :logged_in?\r\n```\r\n\r\nLogin and logout, you will see an error:\r\n\r\n```\r\nActionView::Template::Error (No route matches {:action=>\"show\", :controller=>\"sessions\"} missing required keys: [:id]):\r\n```\r\n\r\n```rhtml\r\n<%= link_to \'Logout\', session_path(\'bogus-id\'), method: :delete %>\r\n```\r\n\r\nYou will now be able signin, signup, login and logout. Let\'s make URL\'s user friendly. Define the following routes in routes.rb:\r\n\r\n```ruby\r\nget \'signup\', to: \'users#new\', as: \'signup\'\r\nget \'login\', to: \'sessions#new\', as: \'login\'\r\nget \'logout\', to: \'sessions#destroy\', as: \'logout\'\r\n```\r\n\r\nUse the named routes in the layout file.\r\n\r\n```rhtml\r\n<% if logged_in? %>\r\n  <%= link_to \'Logout\', logout_path %>\r\n<% else %>\r\n  <%= link_to \"Sign Up\", signup_path %>\r\n  <%= link_to \"Log In\", login_path %>		 \r\n<% end %>\r\n```\r\n\r\nYou can download the source code for this article from [au5](https://github.com/bparanj/au5 \'Authentication from Scratch in Rails 5\').\r\n\r\n## Summary\r\n\r\nIn this article, you learned how to use ActiveModel `has_secure_password` to implement register, login, logout features in Rails 5.','2016-06-28 03:54:22','2016-06-28 04:13:43'),(4181,'Supporting Guest Users in Rails 5 App','### Starter Todo List App\r\n\r\nCreate a new Rails 5 app.\r\n\r\n```\r\nrails new clist\r\n```\r\n\r\nCreate a user model.\r\n\r\n```\r\nrails g model user email handle password_digest\r\n```\r\n\r\nCreate a task model.\r\n\r\n```\r\nrails g model task name complete:boolean user:references \r\n```\r\n\r\nOpen the migration file and make the default value for complete field as false.\r\n\r\n```ruby\r\nclass CreateTasks < ActiveRecord::Migration[5.0]\r\n  def change\r\n    create_table :tasks do |t|\r\n      t.string :name\r\n      t.boolean :complete, default: false\r\n      t.references :user, foreign_key: true\r\n\r\n      t.timestamps\r\n    end\r\n  end\r\nend\r\n```\r\n\r\nRun the migration.\r\n\r\n```\r\nrails db:migrate\r\n```\r\n\r\nAdd sample data in seeds.rb:\r\n\r\n```ruby\r\nu = User.create! handle: \"bbunny\", email: \"bugs@example.com\", password: \"secret\"\r\n\r\nu.tasks.create! name: \"Meet Mr. Miyagi\", complete: true\r\nu.tasks.create! name: \"Paint the fence\", complete: true\r\nu.tasks.create! name: \"Wax the car\"\r\nu.tasks.create! name: \"Sand the deck\"\r\n```\r\n\r\nPopulate the database:\r\n\r\n```\r\nrails db:seed\r\n```\r\n\r\nYou will get the error:\r\n\r\n```\r\nActiveModel::UnknownAttributeError: unknown attribute \'password\' for User.\r\n```\r\n\r\nAdd the `has_secure_password` to user model.\r\n\r\n```ruby\r\nclass User < ApplicationRecord\r\n  has_secure_password\r\nend\r\n```\r\n\r\nUncomment the bcrypt gem in Gemfile.\r\n\r\n```ruby\r\ngem \'bcrypt\', \'~> 3.1.7\'\r\n```\r\n\r\nRun bundle. Populate the databse.\r\n\r\n```\r\nrails db:seed\r\n```\r\n\r\nYou will get the error:\r\n\r\n```\r\nNoMethodError: undefined method `tasks\' for #<User:0x007fa08>\r\n```\r\n\r\nAdd the ActiveRecord declaration to user model:\r\n\r\n```ruby\r\nhas_many :tasks\r\n```\r\n\r\nAdd the ActiveRecord declaration to task model:\r\n\r\n```ruby\r\nbelongs_to :user\r\n```\r\n\r\nDefine the routes in routes.rb:\r\n\r\n```ruby \r\nRails.application.routes.draw do\r\n  resources :users\r\n  resources :tasks\r\n  \r\n  root to: \'tasks#index\'\r\nend\r\n```\r\n\r\nCreate a users controller.\r\n\r\n```  \r\nrails g controller users new\r\n```\r\n\r\nThe implementation is straightforward:\r\n\r\n```ruby\r\nclass UsersController < ApplicationController\r\n  def new\r\n    @user = User.new\r\n  end\r\n  \r\n  def create\r\n    @user = User.new(allowed_params)\r\n    if @user.save\r\n      session[:user_id] = @user.id\r\n      redirect_to root_url\r\n    else\r\n      render :new\r\n    end\r\n  end\r\n  \r\n  private\r\n  \r\n  def allowed_params\r\n    params.require(:user).permit(:email, :handle, :password, :password_confirmation)\r\n  end\r\nend\r\n```\r\n\r\nAdd `current_user` method to application controller.\r\n\r\n```ruby\r\nclass ApplicationController < ActionController::Base\r\n  # Prevent CSRF attacks by raising an exception.\r\n  # For APIs, you may want to use :null_session instead.\r\n  protect_from_forgery with: :exception\r\n  \r\n  private\r\n  \r\n  def current_user\r\n    @current_user ||= User.find(session[:user_id]) if session[:user_id]\r\n  end\r\n  \r\n  helper_method :current_user\r\nend\r\n```\r\n\r\nCreate a tasks controller.\r\n\r\n```\r\nrails g controller tasks index\r\n```\r\n\r\nImplement the index, create, update and destroy.\r\n\r\n```ruby\r\nclass TasksController < ApplicationController\r\n  def index\r\n    if current_user\r\n      @incomplete_tasks = current_user.tasks.where(complete: false)\r\n      @complete_tasks = current_user.tasks.where(complete: true)\r\n    else\r\n      @incomplete_tasks = []\r\n      @complete_tasks = []\r\n    end\r\n  end\r\n  \r\n  def create\r\n    @task = current_user.tasks.create!(allowed_params)\r\n    redirect_to tasks_url\r\n  end\r\n  \r\n  def update\r\n    @task = current_user.tasks.find(params[:id])\r\n    @task.update_attributes!(allowed_params)\r\n    respond_to do |f|\r\n      f.html { redirect_to tasks_url }\r\n      f.js\r\n    end\r\n  end\r\n  \r\n  def destroy\r\n    @task = current_user.tasks.find(params[:id])\r\n    @task.destroy\r\n    respond_to do |f|\r\n      f.html { redirect_to tasks_url }\r\n      f.js\r\n    end\r\n  end\r\n  \r\n  private\r\n  \r\n  def allowed_params\r\n    params.require(:task).permit(:name, :complete)\r\n  end\r\nend\r\n```\r\n\r\nUpdate the routes.rb:\r\n\r\n```ruby\r\nRails.application.routes.draw do\r\n  get \'signup\', to: \'users#new\', as: \'signup\'\r\n  get \'login\', to: \'sessions#new\', as: \'login\'\r\n  get \'logout\', to: \'sessions#destroy\', as: \'logout\'\r\n  \r\n  resources :users\r\n  resources :sessions\r\n  resources :tasks\r\n  \r\n  root to: \'tasks#index\'\r\nend\r\n```\r\n\r\nGenerate the sessions controller to login and logout the user.\r\n\r\n```\r\nrails g controller sessions new \r\n```\r\n\r\nImplement the create and destroy actions.\r\n\r\n```ruby\r\nclass SessionsController < ApplicationController\r\n  def new\r\n  end\r\n  \r\n  def create\r\n    user = User.find_by(handle: params[:handle])\r\n    if user && user.authenticate(params[:password])\r\n      session[:user_id] = user.id\r\n      redirect_to root_url, notice: \'Logged in!\'\r\n    else\r\n      flash.now.alert = \'Name or password is invalid\'\r\n      render :new\r\n    end\r\n  end\r\n  \r\n  def destroy\r\n    session[:user_id] = nil\r\n    redirect_to root_url, notice: \'Logged out!\'\r\n  end\r\nend\r\n```\r\n\r\nThe sessions/new.html.erb looks like this:\r\n\r\n```rhtml\r\n<h1>Log In</h1>\r\n<%= form_tag sessions_path do %>\r\n  <div class=\"field\">\r\n    <%= label_tag :username %><br />\r\n    <%= text_field_tag :handle, params[:handle] %>\r\n  </div>\r\n  <div class=\"field\">\r\n    <%= label_tag :password %><br />\r\n    <%= password_field_tag :password %>\r\n  </div>\r\n  <div class=\"actions\"><%= submit_tag \"Log In\" %></div>\r\n<% end %>\r\n```\r\n\r\nThe task partial in `tasks/_task.html.erb` looks like this:\r\n\r\n```rhtml\r\n<%= form_for task, remote: true do |f| %>\r\n  <%= f.check_box :complete %>\r\n  <%= f.label :complete, task.name %>\r\n  <%= link_to \"(remove)\", task, method: :delete, data: {confirm: \"Are you sure?\"}, remote: true %>\r\n<% end %>\r\n```\r\n\r\nYou can now use the basic task management functionality, login, logout and signup.\r\n\r\n### Guest Record\r\n\r\nIn app/controllers/users_controller.rb, change the create action to add:\r\n\r\n```ruby\r\n@user = params[:user] ? User.new(allowed_params) : User.new_guest\r\ncurrent_user.move_to(@user) if current_user && current_user.guest?\r\n```\r\n	\r\nIt will now look like this:\r\n\r\n```ruby	\r\ndef create\r\n  @user = params[:user] ? User.new(allowed_params) : User.new_guest\r\n  if @user.save\r\n    current_user.move_to(@user) if current_user && current_user.guest?\r\n    session[:user_id] = @user.id\r\n    redirect_to root_url\r\n  else\r\n    render :new\r\n  end\r\nend\r\n```\r\n\r\nIn user model add the validation, guest record creation and moving data from guest to a new user:\r\n\r\n```ruby\r\nclass User < ApplicationRecord\r\n  has_many :tasks, dependent: :destroy\r\n  \r\n  validates_presence_of :handle, :email, :password_digest\r\n  validates_uniqueness_of :handle\r\n  validates_confirmation_of :password\r\n  \r\n  has_secure_password\r\n  \r\n  def self.new_guest\r\n    new(email: \"#{Time.now}@bogus.com\", \r\n        handle: Time.now,\r\n        password_digest: \'bogus\')\r\n  end\r\n  \r\n  def move_to(user)\r\n    tasks.update_all(user_id: user.id)\r\n  end\r\n  \r\n  def guest?\r\n    email.include?(\'bogus.com\')\r\n  end\r\nend\r\n```\r\n\r\nThe bogus guest records can be cleaned up by running a rake task that will delete old guest records. In app/views/layouts/application.html.erb display the links:\r\n\r\n```rhtml\r\n<% if current_user.guest? %>\r\n  <%= link_to \'Become a member\', signup_path %>\r\n<% else %>\r\n   Logged in as <strong><%= current_user.handle %></strong>\r\n  <%= link_to \"Log Out\", logout_path %>\r\n<% end %>\r\n```\r\n\r\nIn app/views/tasks/index.html.erb change the code to:\r\n\r\n```rhtml\r\n<p><%= button_to \"Try it for free!\", users_path %></p>\r\n```\r\n \r\nYou will now be able to try the app without creating a new account and become a member later. All the data will be transferred to the new account. You can download the source code from [clist](https://github.com/bparanj/clist \'clist\')\r\n\r\n### Summary\r\n\r\nIn this article, you learned how to allow a visitor to try your web app without creating an account and how to transfer any data created for the guest user to the new account.','2016-06-29 04:17:55','2016-07-16 06:27:14'),(4191,'How to Expose Local Rails App to the Public Internet','## Using localtunnel gem\r\n\r\n### Step 1\r\n\r\nInstall NodeJS, if your machine does not have it installed.\r\n\r\n### Step 2\r\n\r\nInstall Localtunnel.\r\n\r\n```\r\nnpm install -g localtunnel\r\n```\r\n\r\n### Step 3\r\n\r\nStart your rails app on your machine\r\n\r\n```\r\nrails s\r\n```\r\n\r\n### Step 4\r\n\r\nRequest a tunnel to your local server:\r\n\r\n```\r\nlt --port 3000\r\n```\r\n\r\n### Step 5\r\n\r\nCopy the URL in the output:\r\n\r\n```\r\nyour url is: https://cgoyfetijd.localtunnel.me\r\n```\r\n\r\nto access it from any machine. This gave the error: \r\n\r\n```\r\n504 Gateway Error (with nginx server version)\r\n```\r\n\r\nDue to security, since Rails 4.2 the local server is not exposed to the network. \r\n\r\n### Step 6\r\n\r\nTo fix this, start the server like this :\r\n\r\n```\r\nrails s -b 0.0.0.0\r\n```\r\n\r\nWhen this is accessed from another machine, the log file shows the error:\r\n\r\n```\r\nCannot render console from 209.249.19.171! Allowed networks: 127.0.0.1, ::1, 127.0.0.0/127.255.255.255\r\n```\r\n\r\n### Step 7\r\n\r\nIn development.rb:\r\n\r\n```ruby\r\nconfig.web_console.whiny_requests = false\r\n```\r\n\r\ndoes not work. In development.rb, add:\r\n\r\n```ruby\r\nconfig.web_console.whitelisted_ips = \'209.249.19.171\'\r\n```\r\n\r\nto allow that particular IP to connect remotely to your local Rails app. To whitelist the whole private network:\r\n\r\n```ruby\r\nconfig.web_console.whitelisted_ips = \'209.249.0.0/16\'\r\n```\r\n\r\nYou will now be able to access the Rails app running on machine from any machine connected to your network.\r\n\r\n### Using ngrok\r\n\r\n#### Why ngrok?\r\n\r\n- Build webhook integrations with ease.\r\n- Run personal cloud services from your own private network.\r\n- Demo without deploying\r\n- Simplify mobile device testing\r\n\r\n### Step 1\r\n\r\nDownload [ngrok](https://ngrok.com/ \'ngrok\') and install it.\r\n\r\n### Step 2\r\n\r\nRun your Rails app : \r\n\r\n```\r\nrails s -b 0.0.0.0\r\n```\r\n\r\n### Step 3\r\n\r\nGo to the directory where you extracted the zip file and run it. \r\n\r\n```\r\n./grok http 3000\r\n```\r\n\r\n### Step 4\r\n\r\nYou can now access the Rails app from the URL displayed in the ngrok Forwarding section of the server output from anywhere. It will be something like: `http://81ce07d0.ngrok.io`.\r\n\r\n<img src=\"https://4.bp.blogspot.com/--WhN1iSV9_s/V37G16BPGKI/AAAAAAAABLU/AiKZpRdV8Do3QXHI3VabA_xNz0hbmIehgCLcB/s1600/Screen%2BShot%2B2016-07-06%2Bat%2B1.30.58%2BPM.png\" alt=\"London Underground Map\" />\r\n\r\n## References\r\n\r\n- [localtunnel](https://localtunnel.me/ \'localtunnel\')\r\n- [localtunnel gem](https://github.com/dstil/localtunnel \'localtunnel gem\')','2016-07-07 03:48:18','2016-07-08 05:14:28'),(4201,'How to Handle Sensitive Credentials in Rails 5 Apps','Rails 4.1 introduced secrets.yml. The default file has `secret_key_base`. You can also store access keys to external APIs, http basic login and other sensitive credentials.\r\n\r\n```ruby\r\ndevelopment:\r\n  secret_key_base: 3b7cd727ee24e8444053437c36cc66c3\r\n  some_api_key: SOMEKEY\r\n```  \r\n  \r\nYou can now access the values in development by:\r\n\r\n```ruby\r\nRails.application.secrets.some_api_key\r\n```\r\n\r\nInstead of having a dependency on: \r\n\r\n```ruby\r\nRails.application.secrets\r\n```\r\n\r\nthat might change in the future, we can create a class and encapsulate this behind a stable interface like this:\r\n\r\n```ruby\r\nclass Credential\r\n  def self.some_api_key\r\n    Rails.application.secrets.some_api_key\r\n  end\r\nend\r\n```\r\n\r\nNow you will depend only on this stable interface throughout your application. Like this:\r\n\r\n```ruby\r\nCredential.some_api_key\r\n```\r\n\r\nThis isolates any changes to the way Rails exposes the values to one Credential class. The sensitive values are hard-coded in the secrets.yml and we add it to .gitignore to prevent checking it into source control. A better way is not to hard-code the credentials and use environment variables. The secrets.yml will look like this:\r\n\r\n```yaml\r\ndevelopment:\r\n  secret_key_base: ENV[SECRET_KEY_BASE]\r\n  some_api_key: ENV[SOMEKEY]\r\n```\r\n\r\nIn production, you need to define the values in either ~/.bashrc or ~/.profile like this:\r\n\r\n```\r\nexport SOMEKEY=\'thisisverysecret\'\r\n```\r\n\r\nFor Moonshine, you can edit the config/moonshine.yml and add a line for secrets.yml like this:\r\n\r\n```ruby\r\n# Use :shared_config to copy directories straight from your local project\r\n# directory to the server: these are files that you don\'t have/want in scm.\r\n:shared_config:\r\n  - config/database.yml\r\n  - config/secrets.yml\r\n```\r\n\r\nHere is my secrets.yml:\r\n\r\n```\r\n# See https://help.github.com/articles/ignoring-files for more about ignoring files.\r\n#\r\n# If you find yourself ignoring temporary files generated by your text editor\r\n# or operating system, you probably want to add a global ignore instead:\r\n#   git config --global core.excludesfile \'~/.gitignore_global\'\r\n\r\n# Ignore bundler config.\r\n/.bundle\r\n\r\n# Ignore the default SQLite database.\r\n/db/*.sqlite3\r\n/db/*.sqlite3-journal\r\n\r\npublic/favicon.ico\r\nconfig/database.yml\r\nconfig/secrets.yml\r\ncoverage/**/*\r\n# Ignore all logfiles and tempfiles.\r\n/log/*.log\r\n/tmp\r\n```\r\n\r\nWhen I deploy using Capistrano the secrets.yml file gets uploaded to the server. The secrets.yml file does not contain any sensitive information anymore. So, it\'s not really necessary to remove it from source control. The secrets.yml uses environment variables for different environment like this:\r\n\r\n```yaml\r\ndevelopment:\r\n  http_basic_user: fake\r\n  http_basic_password: fake\r\n  mailchimp_api_key: fake\r\n  secret_key_base: fake\r\n  stripe_secret_key: <%= ENV[\'STRIPE_SECRET_KEY\'] %>\r\n  stripe_publishable_key: <%= ENV[\'STRIPE_PUBLISHABLE_KEY\'] %>  \r\n  \r\ntest:\r\n  http_basic_user: fake\r\n  http_basic_password: fake\r\n  mailchimp_api_key: fake\r\n  secret_key_base: fake\r\n  stripe_secret_key: <%= ENV[\'STRIPE_SECRET_KEY\'] %>\r\n  stripe_publishable_key: <%= ENV[\'STRIPE_PUBLISHABLE_KEY\'] %>  \r\n\r\nproduction:\r\n  secret_key_base: <%= ENV[\'SECRET_KEY_BASE\'] %>\r\n  sendgrid_username: <%= ENV[\'SENDGRID_USERNAME\'] %> \r\n  sendgrid_password: <%= ENV[\'SENDGRID_PASSWORD\'] %> \r\n```\r\n\r\nIf you enjoyed this article, please share it by clicking one of the sharing button below.','2016-07-08 05:10:43','2016-07-08 05:11:50'),(4211,'Using Ajax and jQuery in Rails 5 Apps','You can watch this tutorial as a screencast [Using Ajax and jQuery in Rails 5 Apps](https://itunes.apple.com/us/podcast/rails-screencast/id1142573687 \'Using Ajax and jQuery in Rails 5 Apps\'). Create a new Rails 5 app without spring. \r\n\r\n```\r\nrails new ckl --skip-spring\r\n```\r\n\r\nCreate a task model with name and complete fields.\r\n\r\n```\r\nrails g model task name complete:boolean\r\n```\r\n\r\nChange the migration file to make complete flag default to false.\r\n\r\n```ruby\r\nclass CreateTasks < ActiveRecord::Migration[5.0]\r\n  def change\r\n    create_table :tasks do |t|\r\n      t.string :name\r\n      t.boolean :complete, default: false, null: false\r\n\r\n      t.timestamps\r\n    end\r\n  end\r\nend\r\n```\r\n\r\nCreate sample data in seeds.rb:\r\n\r\n```ruby\r\nTask.create! name: \"Meet Mr. Miyagi\", complete: true\r\nTask.create! name: \"Paint the fence\", complete: true\r\nTask.create! name: \"Wax the car\"\r\nTask.create! name: \"Sand the deck\"\r\n```\r\n\r\nCreate a tasks controller with index and new actions.\r\n\r\n```\r\nrails g controller tasks index new \r\n```\r\n\r\nThe tasks controller looks like this:\r\n\r\n```ruby\r\nclass TasksController < ApplicationController\r\n  def index\r\n    @incomplete_tasks = Task.where(complete: false)\r\n    @complete_tasks = Task.where(complete: true)\r\n  end\r\n\r\n  def new\r\n    @task = Task.new\r\n  end\r\n  \r\n  def create\r\n    @task = Task.create!(allowed_params)\r\n    \r\n    redirect_to tasks_url\r\n  end\r\n  \r\n  def update\r\n    @task = Task.find(params[:id])\r\n    @task.update_attributes!(allowed_params)\r\n    \r\n    redirect_to tasks_url\r\n  end\r\n  \r\n  def destroy\r\n    @task = Task.destroy(params[:id])\r\n    \r\n    redirect_to tasks_url\r\n  end\r\n  \r\n  private\r\n  \r\n  def allowed_params\r\n    params.require(:task).permit(:name, :complete)\r\n  end\r\nend\r\n```\r\n\r\nDefine the resources in routes.rb:\r\n\r\n```ruby\r\nRails.application.routes.draw do\r\n  resources :tasks\r\n  \r\n  root to: \'tasks#index\'\r\nend\r\n```\r\n\r\nMigrate and populate the database.\r\n\r\n```\r\nrails db:migrate\r\nrails db:seed\r\n```\r\n\r\nThe tasks/index.html.erb looks like this:\r\n\r\n```rhtml\r\n<h1>Task Dog</h1>\r\n<%= link_to \"New Task\", new_task_path, id: \"new_link\" %>\r\n<h2>Incomplete Tasks</h2>\r\n<div class=\"tasks\" id=\"incomplete_tasks\">\r\n  <%= render @incomplete_tasks %>\r\n</div>\r\n<h2>Comlpete Tasks</h2>\r\n<div class=\"tasks\" id=\"complete_tasks\">\r\n  <%= render @complete_tasks %>\r\n</div>\r\n```\r\n\r\nCreate the task partial:\r\n\r\n```rhtml\r\n<%= form_for task do |f| %>\r\n  <%= f.check_box :complete %>\r\n  <%= f.submit \"Update\" %>\r\n  <%= f.label :complete, task.name %>\r\n  <%= link_to \"(remove)\", task, method: :delete, data: {confirm: \"Are you sure?\"} %>\r\n<% end %>\r\n```\r\n\r\nThe new.html.erb looks like this:\r\n\r\n```rhtml\r\n<h1>New Task</h1>\r\n<%= render \'form\' %>\r\n<p><%= link_to \"Back to tasks\", tasks_path %></p>\r\n```\r\n\r\nThe form partial, _form.html.erb:\r\n\r\n```rhtml\r\n<%= form_for @task do |f| %>\r\n  <%= f.text_field :name %>\r\n  <%= f.submit %>\r\n<% end %>\r\n```\r\n\r\nCheck the source code at `https://github.com/bparanj/ckl` for css and the layout file changes. The todo app will work without any ajax, meaning the page will be refreshed due to redirect when you delete, create or update tasks. Let\'s now add Ajax to this basic todo app.\r\n\r\n## Ajaxify the Task App\r\n\r\nCreate new.js.erb:\r\n\r\n```rhtml\r\n$(\'#new_link\').hide().after(\'<%= j render(\"form\") %>\');\r\n```\r\n\r\nMake the \'New Task\' link render a form using ajax. Add \r\n\r\n```ruby\r\nremote: true \r\n```\r\n\r\nto the form partial.\r\n\r\n```rhtml\r\n<%= form_for @task, remote: true do |f| %>\r\n  <%= f.text_field :name %>\r\n  <%= f.submit %>\r\n<% end %>\r\n```\r\n\r\nand the \'New Task\' link:\r\n\r\n```rhtml\r\n<%= link_to \"New Task\", new_task_path, id: \"new_link\", remote: true %>\r\n```\r\n\r\nYou can now create a task with the inline form. You can see that there is a redirect after the task is created.\r\n\r\n```\r\nStarted POST \"/tasks\" for ::1 at 2016-07-07 16:22:50 -0700\r\nProcessing by TasksController#create as JS\r\n  Parameters: {\"utf8\"=>\"✓\", \"task\"=>{\"name\"=>\"Buy a necklace\"}, \"commit\"=>\"Create Task\"}\r\n   (0.1ms)  begin transaction\r\n  SQL (0.3ms)  INSERT INTO \"tasks\" (\"name\", \"created_at\", \"updated_at\") VALUES (?, ?, ?)  [[\"name\", \"Buy a necklace\"], [\"created_at\", 2016-07-07 23:22:50 UTC], [\"updated_at\", 2016-07-07 23:22:50 UTC]]\r\n   (2.0ms)  commit transaction\r\nRedirected to http://localhost:3000/tasks\r\nCompleted 200 OK in 4ms (ActiveRecord: 2.3ms)\r\n\r\nStarted GET \"/tasks\" for ::1 at 2016-07-07 16:22:50 -0700\r\nProcessing by TasksController#index as HTML\r\n  Rendering tasks/index.html.erb within layouts/application\r\n  Task Load (0.3ms)  SELECT \"tasks\".* FROM \"tasks\" WHERE \"tasks\".\"complete\" = ?  [[\"complete\", false]]\r\n  Rendered collection of tasks/_task.html.erb [6 times] (5.2ms)\r\n  Task Load (0.2ms)  SELECT \"tasks\".* FROM \"tasks\" WHERE \"tasks\".\"complete\" = ?  [[\"complete\", true]]\r\n  Rendered collection of tasks/_task.html.erb [2 times] (1.2ms)\r\n  Rendered tasks/index.html.erb within layouts/application (12.0ms)\r\nCompleted 200 OK in 36ms (Views: 33.6ms | ActiveRecord: 0.5ms)\r\n```\r\n\r\nChange the create action to handle the ajax request:\r\n\r\n```ruby\r\ndef create\r\n  @task = Task.create!(allowed_params)\r\n  \r\n  respond_to do |f|\r\n    f.html { redirect_to tasks_url }\r\n    f.js\r\n  end\r\nend\r\n```\r\n\r\nCreate create.js.erb:\r\n\r\n```rhtml\r\n$(\'#new_task\').remove();\r\n$(\'#new_link\').show();\r\n$(\'#incomplete_tasks\').append(\'<%= j render(@task) %>\')\r\n```\r\n\r\nYou can now create a new task. The new task goes to the bottom of incomplete tasks list. There is no redirect when a new task is created.\r\n\r\n```\r\nStarted POST \"/tasks\" for ::1 at 2016-07-07 16:30:09 -0700\r\nProcessing by TasksController#create as JS\r\n  Parameters: {\"utf8\"=>\"✓\", \"task\"=>{\"name\"=>\"Buy a puppy\"}, \"commit\"=>\"Create Task\"}\r\n   (0.1ms)  begin transaction\r\n  SQL (0.3ms)  INSERT INTO \"tasks\" (\"name\", \"created_at\", \"updated_at\") VALUES (?, ?, ?)  [[\"name\", \"Buy a puppy\"], [\"created_at\", 2016-07-07 23:30:09 UTC], [\"updated_at\", 2016-07-07 23:30:09 UTC]]\r\n   (0.4ms)  commit transaction\r\n  Rendering tasks/create.js.erb\r\n  Rendered tasks/_task.html.erb (1.2ms)\r\n  Rendered tasks/create.js.erb (2.9ms)\r\nCompleted 200 OK in 10ms (Views: 6.1ms | ActiveRecord: 0.7ms)\r\n```\r\n\r\nThe remove link redirects as you can see in the log file:\r\n\r\n```\r\nStarted DELETE \"/tasks/13\" for ::1 at 2016-07-07 18:13:44 -0700\r\nProcessing by TasksController#destroy as HTML\r\n  Parameters: {\"authenticity_token\"=>\"M60nBritB5vowdT03ZeulVOcC0NkNAfBdsKswwj5/HtqS0cdYVk6KLktRGZmNiuCvK2ITkZ/fJ5lR/BfKp1Isg==\", \"id\"=>\"13\"}\r\n  Task Load (0.2ms)  SELECT  \"tasks\".* FROM \"tasks\" WHERE \"tasks\".\"id\" = ? LIMIT ?  [[\"id\", 13], [\"LIMIT\", 1]]\r\n   (0.0ms)  begin transaction\r\n  SQL (0.3ms)  DELETE FROM \"tasks\" WHERE \"tasks\".\"id\" = ?  [[\"id\", 13]]\r\n   (0.5ms)  commit transaction\r\nRedirected to http://localhost:3000/tasks\r\nCompleted 302 Found in 3ms (ActiveRecord: 1.0ms)\r\n\r\nStarted GET \"/tasks\" for ::1 at 2016-07-07 18:13:44 -0700\r\nProcessing by TasksController#index as HTML\r\n  Rendering tasks/index.html.erb within layouts/application\r\n  Task Load (0.1ms)  SELECT \"tasks\".* FROM \"tasks\" WHERE \"tasks\".\"complete\" = ?  [[\"complete\", false]]\r\n  Rendered collection of tasks/_task.html.erb [1 times] (1.0ms)\r\n  Task Load (0.1ms)  SELECT \"tasks\".* FROM \"tasks\" WHERE \"tasks\".\"complete\" = ?  [[\"complete\", true]]\r\n  Rendered collection of tasks/_task.html.erb [2 times] (0.9ms)\r\n  Rendered tasks/index.html.erb within layouts/application (4.9ms)\r\nCompleted 200 OK in 26ms (Views: 24.5ms | ActiveRecord: 0.2ms)\r\n```\r\n\r\nAdd the remote flag to the remove link in task partial.\r\n\r\n```rhtml\r\n<%= link_to \"(remove)\", task, method: :delete, data: {confirm: \"Are you sure?\"}, remote: true %>\r\n```\r\n\r\nChange the destroy action to handle the ajax call.\r\n\r\n```ruby\r\ndef destroy\r\n  @task = Task.destroy(params[:id])\r\n  \r\n  respond_to do |f|\r\n    f.html { redirect_to tasks_url }\r\n    f.js\r\n  end\r\nend\r\n```\r\n\r\nCreate destroy.js.erb:\r\n\r\n```rhtml\r\n$(\'#edit_task_<%= @task.id %>\').remove();\r\n```\r\n\r\nReload the tasks index page. Remove the task by clicking (remove). You will now see redirect in the log file:\r\n\r\n```\r\nStarted DELETE \"/tasks/1\" for ::1 at 2016-07-07 18:26:33 -0700\r\nProcessing by TasksController#destroy as JS\r\n  Parameters: {\"id\"=>\"1\"}\r\n  Task Load (0.1ms)  SELECT  \"tasks\".* FROM \"tasks\" WHERE \"tasks\".\"id\" = ? LIMIT ?  [[\"id\", 1], [\"LIMIT\", 1]]\r\n   (0.0ms)  begin transaction\r\n  SQL (1.6ms)  DELETE FROM \"tasks\" WHERE \"tasks\".\"id\" = ?  [[\"id\", 1]]\r\n   (0.4ms)  commit transaction\r\n  Rendering tasks/destroy.js.erb\r\n  Rendered tasks/destroy.js.erb (0.4ms)\r\nCompleted 200 OK in 10ms (Views: 3.8ms | ActiveRecord: 2.2ms)\r\n```\r\n\r\nLet\'s mark a task as complete without update button. We will automatically submit the form when the checkbox is clicked. In tasks.js:\r\n\r\n```rhtml\r\n$(function() {\r\n	$(\'.edit_task input[type=checkbox]\').click(function() {\r\n		alert(\'clicked\');\r\n	});\r\n});\r\n```\r\n\r\nReload the tasks index page and click on the check box. Change the javascript to submit the form when the checkbox is clicked and remove all the update buttons.\r\n\r\n```rhtml\r\n$(function() {\r\n	$(\'.edit_task input[type=submit]\').remove();\r\n	$(\'.edit_task input[type=checkbox]\').click(function() {\r\n		$(this).parent(\'form\').submit();\r\n	});\r\n});\r\n```\r\n\r\nReload the page. Check any incomplete tasks and you will see it moved to the Complete tasks section. You can also check the complete tasks and it will go into the incomplete tasks section.\r\n\r\nCreate a new task and you will see the update button show up again. To fix this, change tasks.js:\r\n\r\n```javascript\r\njQuery.fn.submitOnCheck = function() {\r\n	this.find(\'input[type=submit]\').remove();\r\n	this.find(\'input[type=checkbox]\').click(function() {\r\n		$(this).parent(\'form\').submit();\r\n	});\r\n	return this;\r\n}\r\n\r\n$(function() {\r\n	$(\'.edit_task\').submitOnCheck();\r\n});\r\n```\r\n\r\nIn task partial, add:\r\n\r\n```\r\nremote: true:\r\n```\r\n\r\noption to the `link_to` method:\r\n\r\n```rhtml\r\n<%= form_for task, remote: true do |f| %>\r\n  <%= f.check_box :complete %>\r\n  <%= f.submit \"Update\" %>\r\n  <%= f.label :complete, task.name %>\r\n  <%= link_to \"(remove)\", task, method: :delete, data: {confirm: \"Are you sure?\"}, remote: true %>\r\n<% end %>\r\n```\r\n\r\nChange the create.js.erb:\r\n\r\n```rhtml\r\n$(\'#new_task\').remove();\r\n$(\'#new_link\').show();\r\n$(\'#incomplete_tasks\').append(\'<%= j render(@task) %>\');\r\n$(\'#edit_task_<%= @task.id %>\').submitOnCheck();\r\n```\r\n\r\nNow handle the ajax call in the update action:\r\n\r\n```ruby\r\ndef update\r\n  @task = Task.find(params[:id])\r\n  @task.update_attributes!(allowed_params)\r\n  \r\n  respond_to do |f|\r\n    f.html { redirect_to tasks_url }\r\n    f.js\r\n  end\r\nend\r\n``` \r\n\r\nCreate update.js.erb to move the task to appropriate section:\r\n\r\n```rhtml\r\n<% if @task.complete? %>\r\n  $(\'#edit_task_<%= @task.id %>\').appendTo(\'#complete_tasks\');\r\n<% else %>\r\n  $(\'#edit_task_<%= @task.id %>\').appendTo(\'#incomplete_tasks\');\r\n<% end %>  \r\n```\r\n\r\nYou can download the source code for this article from [ckl](https://github.com/bparanj/ckl \'jquery ajax in rails 5\').\r\n\r\n## Summary\r\n\r\nIn this article, we used Ajax and jQuery to create a better user experience for our simple todo app. Read the jQuery docs to learn how the jQuery methods work. You can also experiment with the sample code shown in jQuery docs.','2016-07-08 16:41:58','2016-10-29 17:14:06'),(4221,'Reddit Clone in Rails 5 using Twitter Bootstrap 4','## Libraries Used\r\n\r\n- Devise\r\n- Acts as Votable\r\n- Twitter Bootstrap 4\r\n\r\n## Reddit Clone\r\n\r\nCreate a new Rails 5 project.\r\n\r\n```\r\nrails new rabbit --skip-spring\r\n```\r\n\r\nAdd devise gem to Gemfile.\r\n\r\n```ruby\r\ngem \'devise\', :github => \'plataformatec/devise\', :branch => \'master\'\r\n```\r\n\r\nRun:\r\n\r\n```\r\nbundle\r\n```\r\n\r\nRun devise generator:\r\n\r\n```\r\nrails generate devise:install\r\n```\r\n\r\nAdd the mailer url in config/environments/development.rb:\r\n\r\n```ruby\r\nconfig.action_mailer.default_url_options = { host: \'localhost\', port: 3000 }\r\n```\r\n\r\nAdd the root url in routes.rb:\r\n\r\n```ruby\r\nroot to: \"links#index\"\r\n```\r\n\r\nCreate user model that will be used for authentication by devise.\r\n\r\n```\r\nrails g devise user\r\n```\r\n\r\nMigrate the database.\r\n\r\n```\r\nrails db:migrate\r\n```\r\n\r\nCopy the views provided devise to our project so that we can customize it.\r\n\r\n```\r\nrails g devise:views\r\n```\r\n\r\nCreate the link model with string fields title and url. It also has a user_id foreign key.\r\n\r\n```\r\nrails g model link title url user:references\r\n```\r\n\r\nAdd the relationship declaration to user model.\r\n\r\n```ruby\r\nhas_many :links\r\n```\r\n\r\nAdd the relationship declaration to link model.\r\n\r\n```ruby\r\nbelongs_to :user\r\n```\r\n\r\nAdd the devise routes to routes.rb:\r\n\r\n```ruby\r\ndevise_for :users \r\n```\r\n\r\nThis provides the following routes:\r\n\r\n```\r\n                  Prefix Verb   URI Pattern                    Controller#Action\r\n        new_user_session GET    /users/sign_in(.:format)       devise/sessions#new\r\n            user_session POST   /users/sign_in(.:format)       devise/sessions#create\r\n    destroy_user_session DELETE /users/sign_out(.:format)      devise/sessions#destroy\r\n           user_password POST   /users/password(.:format)      devise/passwords#create\r\n       new_user_password GET    /users/password/new(.:format)  devise/passwords#new\r\n      edit_user_password GET    /users/password/edit(.:format) devise/passwords#edit\r\n                         PATCH  /users/password(.:format)      devise/passwords#update\r\n                         PUT    /users/password(.:format)      devise/passwords#update\r\ncancel_user_registration GET    /users/cancel(.:format)        devise/registrations#cancel\r\n       user_registration POST   /users(.:format)               devise/registrations#create\r\n   new_user_registration GET    /users/sign_up(.:format)       devise/registrations#new\r\n  edit_user_registration GET    /users/edit(.:format)          devise/registrations#edit\r\n                         PATCH  /users(.:format)               devise/registrations#update\r\n                         PUT    /users(.:format)               devise/registrations#update\r\n                         DELETE /users(.:format)               devise/registrations#destroy\r\n```\r\n\r\nThis is the output of rails routes. Add the link resource to routes.\r\n\r\n```ruby\r\nresources :links\r\n```\r\n\r\nCreate a links controller.\r\n\r\n```\r\nrails g controller links\r\n```\r\n\r\nLinks controller looks like this:\r\n\r\n```ruby\r\nclass LinksController < ApplicationController\r\n  before_action :set_link, only: [:show, :edit, :update, :destroy]\r\n  before_action :authenticate_user!, except: [:index, :show]\r\n  before_action :authorized_user, only: [:edit, :update, :destroy]\r\n\r\n  # GET /links\r\n  # GET /links.json\r\n  def index\r\n    @links = Link.all\r\n  end\r\n\r\n  # GET /links/1\r\n  # GET /links/1.json\r\n  def show\r\n  end\r\n\r\n  # GET /links/new\r\n  def new\r\n    @link = current_user.links.build\r\n  end\r\n\r\n  # GET /links/1/edit\r\n  def edit\r\n  end\r\n\r\n  # POST /links\r\n  # POST /links.json\r\n  def create\r\n    @link = current_user.links.build(link_params)\r\n\r\n    respond_to do |format|\r\n      if @link.save\r\n        format.html { redirect_to @link, notice: \'Link was successfully created.\' }\r\n        format.json { render :show, status: :created, location: @link }\r\n      else\r\n        format.html { render :new }\r\n        format.json { render json: @link.errors, status: :unprocessable_entity }\r\n      end\r\n    end\r\n  end\r\n\r\n  # PATCH/PUT /links/1\r\n  # PATCH/PUT /links/1.json\r\n  def update\r\n    respond_to do |format|\r\n      if @link.update(link_params)\r\n        format.html { redirect_to @link, notice: \'Link was successfully updated.\' }\r\n        format.json { render :show, status: :ok, location: @link }\r\n      else\r\n        format.html { render :edit }\r\n        format.json { render json: @link.errors, status: :unprocessable_entity }\r\n      end\r\n    end\r\n  end\r\n\r\n  # DELETE /links/1\r\n  # DELETE /links/1.json\r\n  def destroy\r\n    @link.destroy\r\n    respond_to do |format|\r\n      format.html { redirect_to links_url, notice: \'Link was successfully destroyed.\' }\r\n      format.json { head :no_content }\r\n    end\r\n  end\r\n\r\n  private\r\n    # Use callbacks to share common setup or constraints between actions.\r\n    def set_link\r\n      @link = Link.find(params[:id])\r\n    end\r\n\r\n    def authorized_user\r\n      @link = current_user.links.find_by(id: params[:id])\r\n      redirect_to links_path, notice: \"Not authorized to edit this link\" if @link.nil?\r\n    end\r\n\r\n    # Never trust parameters from the scary internet, only allow the white list through.\r\n    def link_params\r\n      params.require(:link).permit(:title, :url)\r\n    end\r\nend\r\n```\r\n\r\nCreate the link form partial:\r\n\r\n```rhtml\r\n<%= form_for(@link) do |f| %>\r\n  <% if @link.errors.any? %>\r\n    <div id=\"error_explanation\">\r\n      <h2><%= pluralize(@link.errors.count, \"error\") %> prohibited this link from being saved:</h2>\r\n      <ul>\r\n      <% @link.errors.full_messages.each do |message| %>\r\n        <li><%= message %></li>\r\n      <% end %>\r\n      </ul>\r\n    </div>\r\n  <% end %>\r\n\r\n  <div class=\"form-group\">\r\n    <%= f.label :title %><br>\r\n    <%= f.text_field :title, class: \"form-control\" %>\r\n  </div>\r\n  <div class=\"form-group\">\r\n    <%= f.label :url %><br>\r\n    <%= f.text_field :url, class: \"form-control\" %>\r\n  </div>\r\n  <br>\r\n  <div class=\"form-group\">\r\n    <%= f.submit \"Submit\", class: \"btn btn-lg btn-primary\" %>\r\n  </div>\r\n<% end %>\r\n```\r\n\r\nCreate links/edit.html.erb:\r\n\r\n```rhtml\r\n<h1>Editing link</h1>\r\n<%= render \'form\' %>\r\n\r\n<%= link_to \'Show\', @link %> |\r\n<%= link_to \'Back\', links_path %>\r\n```\r\n\r\nCreate links/index.html.erb:\r\n\r\n```rhtml\r\n<% @links.each do |link| %>\r\n  <div class=\"link row clearfix\">\r\n    <h2>\r\n      <%= link_to link.title, link %><br>\r\n      <small class=\"author\">Submitted <%= time_ago_in_words(link.created_at) %> by <%= link.user.name %></small>\r\n    </h2>\r\n  </div>\r\n<% end %>\r\n```\r\n\r\nCreate the links/new.html.erb:\r\n\r\n```rhtml\r\n<h1>Submit New link</h1>\r\n<%= render \'form\' %>\r\n<%= link_to \'Back\', links_path %>\r\n```\r\n\r\nCreate the links/show.html.erb:\r\n\r\n```rhtml\r\n<div class=\"page-header\">\r\n  <h1><a href=\"<%= @link.url %>\"><%= @link.title %></a><br> <small>Submitted by <%= @link.user.name %></small></h1>\r\n</div>\r\n\r\n<div class=\"btn-group\">\r\n	<%= link_to \'Visit URL\', @link.url, class: \"btn btn-primary\" %>\r\n</div>\r\n\r\n<% if @link.user == current_user -%>\r\n	<div class=\"btn-group\">\r\n		<%= link_to \'Edit\', edit_link_path(@link), class: \"btn btn-default\" %>\r\n		<%= link_to \'Destroy\', @link, method: :delete, data: { confirm: \'Are you sure?\' }, class: \"btn btn-default\" %>\r\n	</div>\r\n<% end %>\r\n```\r\n\r\nAdd name field to the users table.\r\n\r\n```\r\nrails g migration add_name_to_users name\r\n```\r\n\r\nMigrate the database.\r\n\r\n```\r\nrails db:migrate\r\n```\r\n\r\nStart the rails server.\r\n\r\n```\r\nrails s\r\n```\r\n\r\nYou can now submit links. To add the name, change devise/registrations/new.html.erb:\r\n\r\n```rhtml\r\n<div class=\"field\">\r\n  <%= f.label :name %><br />\r\n  <%= f.text_field :name, autofocus: true %>\r\n</div>\r\n```\r\n\r\nStill the name is not populated when the link is displayed. To fix it, in application controller, add:\r\n\r\n```ruby\r\nbefore_filter :configure_permitted_parameters, if: :devise_controller?\r\n\r\nprotected\r\n\r\ndef configure_permitted_parameters\r\n  devise_parameter_sanitizer.for(:sign_up) << :name\r\n  devise_parameter_sanitizer.for(:account_update) << :name\r\nend\r\n```\r\n\r\nThis gives the:\r\n\r\n```\r\nundefined method `for\' for #<Devise::ParameterSanitizer\r\n```\r\n\r\nChange the implementation as follows:\r\n\r\n```ruby\r\ndef configure_permitted_parameters\r\n  devise_parameter_sanitizer.permit(:sign_up, keys: :name)\r\n  devise_parameter_sanitizer.permit(:account_update, keys: :name)\r\nend\r\n```\r\n\r\nThis results in:\r\n\r\n```\r\nno implicit conversion of Symbol into Array\r\n```\r\n\r\nChange the implementation as follows:\r\n\r\n```ruby\r\ndef configure_permitted_parameters\r\n  devise_parameter_sanitizer.permit(:sign_up, keys: [:name])\r\n  devise_parameter_sanitizer.permit(:account_update, keys: [:name])\r\nend\r\n```\r\n\r\nYou can now display the user name of the submitted link. Add bootstrap gem to Gemfile.\r\n\r\n```ruby\r\ngem \'bootstrap\', \'~> 4.0.0.alpha3\'\r\n```\r\n\r\nRun:\r\n\r\n```\r\nbundle\r\n```\r\n\r\nWithin the head tag of the application layout, add:\r\n\r\n```html\r\n<!-- Required meta tags always come first -->\r\n<meta charset=\"utf-8\">\r\n<meta name=\"viewport\" content=\"width=device-width, initial-scale=1, shrink-to-fit=no\">\r\n<meta http-equiv=\"x-ua-compatible\" content=\"ie=edge\">\r\n```\r\n\r\nAdd navigation bar within body tag in application layout:\r\n\r\n```rhtml\r\n<nav class=\"navbar navbar-light bg-faded\">\r\n  <%= link_to \'Rabbit\', root_path, class: \'navbar-brand\' %>\r\n  <ul class=\"nav navbar-nav\">\r\n  <% if user_signed_in? %>	\r\n    <li class=\"nav-item\">\r\n	  <%= link_to \'Submit Link\', new_link_path, class: \'nav-link\' %> \r\n    </li>\r\n    <li class=\"nav-item\">\r\n      <%= link_to \'Account\', edit_user_registration_path, class: \'nav-link\' %>\r\n    </li>\r\n    <li class=\"nav-item\">\r\n       <%= link_to \'Sign Out\', destroy_user_session_path, class: \'nav-link\', method: :delete %>\r\n	    </li>\r\n	  <% else %>\r\n        <li class=\"nav-item\">\r\n          <%= link_to \'Sign Up\', new_user_registration_path, class: \'nav-link\' %>\r\n        </li>\r\n        <li class=\"nav-item\">\r\n           <%= link_to \'Sign In\', new_user_session_path, class: \'nav-link\' %>\r\n        </li>\r\n	  <% end %>\r\n    </ul>\r\n    <form class=\"form-inline pull-xs-right\">\r\n      <input class=\"form-control\" type=\"text\" placeholder=\"Search\">\r\n      <button class=\"btn btn-success-outline\" type=\"submit\">Search</button>\r\n    </form>\r\n</nav>\r\n```\r\n\r\nChange field class to form-group in devise/registrations/new.html.erb:\r\n\r\n```rhtml\r\n<div class=\"form-group\">\r\n  <%= f.label :name %><br />\r\n  <%= f.text_field :name, autofocus: true %>\r\n</div>\r\n	\r\n<div class=\"form-group\">\r\n  <%= f.label :email %><br />\r\n  <%= f.email_field :email %>\r\n</div>\r\n\r\n<div class=\"form-group\">\r\n  <%= f.label :password %>\r\n  <% if @minimum_password_length %>\r\n  <em>(<%= @minimum_password_length %> characters minimum)</em>\r\n  <% end %><br />\r\n  <%= f.password_field :password, autocomplete: \"off\" %>\r\n</div>\r\n\r\n<div class=\"form-group\">\r\n  <%= f.label :password_confirmation %><br />\r\n  <%= f.password_field :password_confirmation, autocomplete: \"off\" %>\r\n</div>\r\n\r\n<div class=\"actions\">\r\n  <%= f.submit \"Sign up\", class: \'btn btn-primary\' %>\r\n</div>\r\n```\r\n\r\nTo make the text field size reasonable, change the class in application layout:\r\n\r\n```rhtml\r\n<div id=\"content\" class=\"col-md-4 center-block\">\r\n  <%= yield %>\r\n</div>\r\n```\r\n\r\nChange the style of edit and destroy buttons by adding the classes link/show.html.erb.\r\n\r\n```rhtml\r\n<%= link_to \'Edit\', edit_link_path(@link), class: \"btn btn-secondary\" %>\r\n<%= link_to \'Destroy\', @link, method: :delete, data: { confirm: \'Are you sure?\' }, class: \"btn btn-danger\" %>\r\n```\r\n\r\nMake the `submitted by` small case and group buttons.\r\n\r\n```rhtml\r\n<div>\r\n  <h3><a href=\"<%= @link.url %>\"><%= @link.title %></a><br> <small>Submitted by <%= @link.user.name %></small></h3>\r\n</div>\r\n\r\n<div class=\"btn-group\">\r\n	<%= link_to \'Visit URL\', @link.url, class: \"btn btn-primary\" %>\r\n</div>\r\n\r\n<% if @link.user == current_user -%>\r\n	<div class=\"btn-group\">\r\n		<%= link_to \'Edit\', edit_link_path(@link), class: \"btn btn-secondary\" %>\r\n		<%= link_to \'Destroy\', @link, method: :delete, data: { confirm: \'Are you sure?\' }, class: \"btn btn-danger\" %>\r\n	</div>\r\n<% end %>\r\n```\r\n\r\nThe outer div should be main_content and the yield should be within the content like this:\r\n\r\n```rhtml\r\n<div id=\"main_content\" class=\"container\">\r\n  <% flash.each do |name, msg| %>\r\n	<%= content_tag(:div, msg, class: \"alert alert-info\") %>\r\n  <% end %>\r\n\r\n  <div id=\"content\" class=\"col-md-6 center-block\">\r\n	  <%= yield %>\r\n  </div>\r\n</div>\r\n```\r\n\r\nReload the page, you will see the links centered, styled and separated by lines. Remove the back link the new link submission form and add Back button to the form partial:\r\n\r\n```rhtml\r\n<div class=\"form-group\">\r\n  <%= f.submit \"Submit\", class: \"btn btn-lg btn-primary\" %>\r\n  <%= link_to \'Back\', links_path, class: \'btn btn-lg btn-secondary\' %>\r\n</div>\r\n```\r\n\r\nLet\'s style the edit account page (`http://localhost:3000/users/edit`). Add form-group and form-control to registrations/edit.html.erb. Use card and card-block classes.\r\n\r\n```rhtml\r\n<h2>Edit <%= resource_name.to_s.humanize %></h2>\r\n\r\n<%= form_for(resource, as: resource_name, url: registration_path(resource_name), html: { method: :put }) do |f| %>\r\n  <%= devise_error_messages! %>\r\n\r\n  <div class=\'card\'>\r\n	<div class=\'card-block\'>\r\n		\r\n	  <div class=\"form-group\">\r\n	    <%= f.label :email %><br />\r\n	    <%= f.email_field :email, autofocus: true, class: \'form-control\' %>\r\n	  </div>\r\n\r\n	  <% if devise_mapping.confirmable? && resource.pending_reconfirmation? %>\r\n	    <div>Currently waiting confirmation for: <%= resource.unconfirmed_email %></div>\r\n	  <% end %>\r\n\r\n	  <div class=\"form-group\">\r\n	    <%= f.label :password %> <i>(leave blank if you don\'t want to change it)</i><br />\r\n	    <%= f.password_field :password, autocomplete: \"off\", class: \'form-control\' %>\r\n	    <% if @minimum_password_length %>\r\n	      <br />\r\n	      <em>(<%= @minimum_password_length %> characters minimum)</em>\r\n	    <% end %>\r\n	  </div>\r\n\r\n	  <div class=\"form-group\">\r\n	    <%= f.label :password_confirmation %><br />\r\n	    <%= f.password_field :password_confirmation, autocomplete: \"off\", class: \'form-control\' %>\r\n	  </div>\r\n\r\n	  <div class=\"form-group\">\r\n	    <%= f.label :current_password %> <i>(we need your current password to confirm your changes)</i><br />\r\n	    <%= f.password_field :current_password, autocomplete: \"off\", class: \'form-control\' %>\r\n	  </div>\r\n\r\n	  <div class=\"actions\">\r\n	    <%= f.submit \"Update\", class: \'btn btn-lg btn-primary\' %>\r\n	  </div>\r\n	 </div>\r\n  </div>\r\n<% end %>\r\n\r\n<div class=\'card-footer\'>\r\n<h3>Cancel my account</h3>\r\n\r\n<p>Unhappy? <%= button_to \"Cancel my account\", registration_path(resource_name), data: { confirm: \"Are you sure?\" }, method: :delete, class: \'btn btn-lg btn-secondary\' %>\r\n</p>\r\n	\r\n</div>\r\n<hr/>\r\n<%= link_to \"Back\", :back, class: \'btn btn-lg btn-secondary\' %>\r\n```\r\n\r\nAdd `acts_as_votable` gem to Gemfile.\r\n\r\n```ruby\r\ngem \'acts_as_votable\'\r\n```\r\n\r\nRun:\r\n\r\n```\r\nbundle\r\n```\r\n\r\nCreate the votes table.\r\n\r\n```\r\nrails g acts_as_votable:migration\r\n```\r\n\r\nMigrate the database.\r\n\r\n```\r\nrails db:migrate\r\n```\r\n\r\nAdd \r\n\r\n```ruby\r\nacts_as_votable\r\n```\r\n\r\nto Link model. Define route to like and dislike in routes.rb.\r\n\r\n```ruby\r\nresources :links do\r\n  member do\r\n    put \'like\', to: \'links#upvote\'\r\n    put \'dislike\', to: \'links#downvote\'\r\n  end\r\nend\r\n```\r\n\r\nImplement upvote and downvote actions in links controller.\r\n\r\n```ruby\r\ndef upvote\r\n  @link = Link.find(params[:id])  \r\n  @link.upvote_by current_user\r\n  \r\n  redirect_to :back\r\nend\r\n\r\ndef downvote\r\n  @link = Link.find(params[:id])\r\n  @link.downvote_by current_user\r\n  \r\n  redirect_to :back\r\nend\r\n```\r\n\r\nCheckout [How to build a Pinterest Clone in Rails 5](https://rubyplus.com/articles/4041-How-to-build-a-Pinterest-Clone-in-Rails-5 \'How to build a Pinterest Clone in Rails 5\') to see how to get glyphicons to work with bootstrap 4. To display upvote and downvote glyphicons using font awesome, change the links/index.html.erb:\r\n\r\n```rhtml\r\n<% @links.each do |link| %>\r\n  <div class=\"link row clearfix\">\r\n    <h3>\r\n      <%= link_to link.title, link %><br>\r\n      <small>Submitted <%= time_ago_in_words(link.created_at) %> by <%= link.user.name %></small>\r\n    </h3>\r\n	<div class=\'btn-group\'>\r\n	  <%= link_to \'Visit Link\', link.url, class: \'btn btn-secondary\' %> \r\n	  <%= link_to like_link_path(link), method: :put, class: \'btn btn-secondary\' do %>\r\n	    <span class=\'fa fa-arrow-up\'></span>\r\n		Upvote\r\n		<%= link.get_upvotes.size %>\r\n	  <% end %>\r\n	  <%= link_to dislike_link_path(link), method: :put, class: \'btn btn-secondary\' do %>\r\n	    <span class=\'fa fa-arrow-down\'></span>\r\n		Downvote\r\n		<%= link.get_downvotes.size %>\r\n	  <% end %>\r\n	</div>\r\n  </div>\r\n<% end %>\r\n```\r\n\r\nAdd voting links to the bottom of the link show page.\r\n\r\n```rhtml\r\n<div class=\'btn-group pull-right\'>\r\n  <%= link_to like_link_path(@link), method: :put, class: \'btn btn-secondary btn-sm\' do %>\r\n    <span class=\'fa fa-arrow-up\'></span>	\r\n	Upvote\r\n	<%= @link.get_upvotes.size %>\r\n  <% end %>\r\n  <%= link_to dislike_link_path(@link), method: :put, class: \'btn btn-secondary btn-sm\' do %>\r\n  <span class=\'fa fa-arrow-down\'></span>\r\n  Downvote\r\n  <%= @link.get_downvotes.size %>\r\n  <% end %>\r\n</div>\r\n```\r\n\r\nChange the width to accommodate all buttons by changing the class in application layout file:\r\n\r\n```rhtml\r\n<div id=\"content\" class=\"col-md-9 center-block\">\r\n  <%= yield %>\r\n</div>\r\n```\r\n\r\nGenerate the comment model.\r\n\r\n```\r\nrails g scaffold comment link_id:integer:index body:text user:references --skip-stylesheets\r\n```\r\n\r\nMigrate the database.\r\n\r\n```\r\nrails db:migrate\r\n```\r\n\r\nDefine the relationship between link and comments in the link model.\r\n\r\n```ruby\r\nhas_many :comments\r\n```\r\n\r\nDefine the relationship between comment and link in the comment model.\r\n\r\n```ruby\r\nbelongs_to :link\r\n```\r\n\r\nIn routes, add:\r\n\r\n```ruby\r\nresources :comments \r\n```\r\n\r\ninside the link resource, like this:\r\n\r\n```ruby\r\nresources :links do\r\n  member do\r\n    put \'like\', to: \'links#upvote\'\r\n    put \'dislike\', to: \'links#downvote\'\r\n  end\r\n  resources :comments\r\nend\r\n```\r\n  \r\nAdd comment section to link show page.\r\n\r\n```rhtml\r\n<h3 class=\'comments_title\'>\r\n  <%= pluralize(@link.comments.count, \'Comment\') %>\r\n</h3>\r\n\r\n<div id=\'comments\'>\r\n	<%= render @link.comments %>\r\n</div>\r\n\r\n<%= form_for([@link, Comment.new]) do |f| %>\r\n  <div class=\'form-group\'>\r\n	<%= f.label :body %>  \r\n  	<%= f.text_area :body, class: \'form-control\' %>\r\n  </div>\r\n  <br>\r\n  <div class=\'form-group\'>\r\n  	<%= f.submit \'Add Comment\', class: \'btn btn-primary\' %>\r\n  </div>\r\n<% end %>\r\n```\r\n\r\nDelete unnecessary actions in comments controller and customize the create and destroy actions.\r\n\r\n```ruby\r\nclass CommentsController < ApplicationController\r\n  before_action :set_comment, only: [:show, :edit, :update, :destroy]\r\n  before_action :authenticate_user!\r\n  \r\n  def create\r\n    @link = Link.find(params[:link_id])\r\n    @comment = @link.comments.build(comment_params)\r\n    @comment.user = current_user\r\n    \r\n    respond_to do |format|\r\n      if @comment.save\r\n        format.html { redirect_to @link, notice: \'Comment was successfully created.\' }\r\n        format.json { render :show, status: :created, location: @comment }\r\n      else\r\n        format.html { render :new }\r\n        format.json { render json: @comment.errors, status: :unprocessable_entity }\r\n      end\r\n    end\r\n  end\r\n\r\n  def destroy\r\n    @comment.destroy\r\n    respond_to do |format|\r\n      format.html { redirect_to :back, notice: \'Comment was successfully destroyed.\' }\r\n      format.json { head :no_content }\r\n    end\r\n  end\r\n\r\n  private\r\n    # Use callbacks to share common setup or constraints between actions.\r\n    def set_comment\r\n      @comment = Comment.find(params[:id])\r\n    end\r\n\r\n    # Never trust parameters from the scary internet, only allow the white list through.\r\n    def comment_params\r\n      params.require(:comment).permit(:link_id, :body, :user_id)\r\n    end\r\nend\r\n```\r\n\r\nCreate comments/_comment.html.erb:\r\n\r\n```rhtml\r\n<div id=\"comment_#{comment.id}\" class=\'comment\'>\r\n  <div class=\"comments_wrapper clearfix\">\r\n    <div class=\"pull-left\">\r\n	  <p class=\"lead\"><%= comment.body %></p>\r\n	  <p><small>Submitted <strong><%= time_ago_in_words(comment.created_at) %> ago</strong> by <%= comment.user.email %></small></p>\r\n	</div>\r\n\r\n	<div class=\"btn-group pull-right\">\r\n	  <% if comment.user == current_user -%>\r\n	    <%= link_to \'Destroy\', comment, method: :delete, data: { confirm: \'Are you sure?\' }, class: \"btn btn-sm btn-default\" %>\r\n	  <% end %>\r\n	</div>\r\n  </div>\r\n</div>\r\n```\r\n\r\nDisplay name in the edit account page.\r\n\r\n```rhtml\r\n<div class=\"form-group\">\r\n  <%= f.label :name %><br />\r\n  <%= f.text_field :name, autofocus: true, class: \'form-control\' %>\r\n</div>\r\n```\r\n\r\nWe can update the name because of the method `configure_permitted_parameters` . You can download the source code for this article from `https://github.com/bparanj/rabbit`.\r\n\r\n## Summary\r\n\r\nIn this article, you learned how to create a reddit clone using Rails 5, acts_as_votable, font awesome, devise and Twitter Bootstrap 4.\r\n\r\n## References\r\n\r\n[FontAwesome Cheatsheet](http://fontawesome.io/cheatsheet/ \'FontAwesome Cheatsheet\')\r\n[Migrating to v4](http://v4-alpha.getbootstrap.com/migration/ \'Migrating to v4\') \r\n','2016-07-14 04:43:23','2016-07-16 05:53:16'),(4231,'Tagging using Acts as Taggable On in Rails 5','## Why Tag?\r\n\r\nTags are useful in situations where people are not sure what they are looking for or what\'s around. It helps people to explore and find related information. This means visitors to your site spend more time on your site. They are more likely to buy from you when they read your valuable content.\r\n\r\n## Basic Rails 5 App\r\n\r\nCreate a new Rails 5 app.\r\n\r\n```\r\nrails new dag --skip-spring\r\n```\r\n\r\nCreate an article model.\r\n\r\n```\r\nrails g model articles name published_on:date content:text\r\n```\r\n\r\nMigrate the database.\r\n\r\n```\r\nrails db:migrate\r\n```\r\n\r\nPopulate sample data using seeds.rb:\r\n\r\n```ruby\r\nbatman = Article.create! name: \"Batman\", content: <<-ARTICLE\r\nBatman is a fictional character created by the artist Bob Kane and writer Bill Finger. A comic book superhero, Batman first appeared in Detective Comics #27 (May 1939), and since then has appeared primarily in publications by DC Comics. Originally referred to as \"The Bat-Man\" and still referred to at times as \"The Batman\", he is additionally known as \"The Caped Crusader\", \"The Dark Knight\", and the \"World\'s Greatest Detective,\" among other titles. (from Wikipedia)\r\nARTICLE\r\n\r\nsuperman = Article.create! name: \"Superman\", content: <<-ARTICLE\r\nSuperman is a fictional comic book superhero appearing in publications by DC Comics, widely considered to be an American cultural icon. Created by American writer Jerry Siegel and Canadian-born American artist Joe Shuster in 1932 while both were living in Cleveland, Ohio, and sold to Detective Comics, Inc. (later DC Comics) in 1938, the character first appeared in Action Comics #1 (June 1938) and subsequently appeared in various radio serials, television programs, films, newspaper strips, and video games. (from Wikipedia)\r\nARTICLE\r\n\r\nkrypton = Article.create! name: \"Krypton\", content: <<-ARTICLE\r\nKrypton is a fictional planet in the DC Comics universe, and the native world of the super-heroes Superman and, in some tellings, Supergirl and Krypto the Superdog. Krypton has been portrayed consistently as having been destroyed just after Superman\'s flight from the planet, with exact details of its destruction varying by time period, writers and franchise. Kryptonians were the dominant people of Krypton. (from Wikipedia)\r\nARTICLE\r\n\r\nlex_luthor = Article.create! name: \"Lex Luthor\", content: <<-ARTICLE\r\nLex Luthor is a fictional character, a supervillain who appears in comic books published by DC Comics. He is the archenemy of Superman, and is also a major adversary of Batman and other superheroes in the DC Universe. Created by Jerry Siegel and Joe Shuster, he first appeared in Action Comics #23 (April 1940). Luthor is described as \"a power-mad, evil scientist\" of high intelligence and incredible technological prowess. (from Wikipedia)\r\nARTICLE\r\n\r\nrobin = Article.create! name: \"Robin\", content: <<-ARTICLE\r\nRobin is the name of several fictional characters appearing in comic books published by DC Comics, originally created by Bob Kane, Bill Finger and Jerry Robinson, as a junior counterpart to DC Comics superhero Batman. The team of Batman and Robin is commonly referred to as the Dynamic Duo or the Caped Crusaders. (from Wikipedia)\r\nARTICLE\r\n```\r\n\r\nPopulate the database.\r\n\r\n```\r\nrails db:seed\r\n```\r\n\r\nCreate the articles controller.\r\n\r\n```\r\nrails g controller articles index show new edit\r\n```\r\n\r\nThe implementation is straightforward.\r\n\r\n```ruby\r\nclass ArticlesController < ApplicationController\r\n  def index\r\n    @articles = Article.all\r\n  end\r\n\r\n  def show\r\n    @article = Article.find(params[:id])\r\n  end\r\n\r\n  def new\r\n    @article = Article.new\r\n  end\r\n\r\n  def create\r\n    @article = Article.new(params[:article])\r\n    if @article.save\r\n      redirect_to @article, notice: \"Created article.\"\r\n    else\r\n      render :new\r\n    end\r\n  end\r\n\r\n  def edit\r\n    @article = Article.find(params[:id])\r\n  end\r\n\r\n  def update\r\n    @article = Article.find(params[:id])\r\n    if @article.update_attributes(params[:article])\r\n      redirect_to @article, notice: \"Updated article.\"\r\n    else\r\n      render :edit\r\n    end\r\n  end\r\n  \r\n  private\r\n  \r\n  def allowed_params\r\n    params.require(:article).permit(:content, :name)\r\n  end\r\nend\r\n```\r\n\r\nCheckout the source code for this article [Tag](https://github.com/bparanj/dag.git \'Tagging\') for the app/assets/stylesheets/layout.scss and app/views/layouts/application.html.erb. Define the routes for article resource.\r\n\r\n```ruby\r\nresources :articles\r\nroot to: \'articles#index\'\r\n```\r\n\r\nYou can now play with a basic Rails 5 app that has article as the main model.\r\n\r\n## Acts as Taggable On \r\n\r\nAdd the acts-as-taggable-on gem to Gemfile.\r\n\r\n```ruby\r\ngem \'acts-as-taggable-on\', \'~> 3.4\'\r\n```\r\n\r\nRun:\r\n\r\n```\r\nbundle\r\n```\r\n\r\nYou will get the error:\r\n\r\n```\r\nBundler could not find compatible versions for gem \"activerecord\":\r\n  In snapshot (Gemfile.lock):\r\n    activerecord (= 5.0.0)\r\n\r\n  In Gemfile:\r\n    acts-as-taggable-on (~> 3.4) was resolved to 3.4.0, which depends on\r\n      activerecord (< 5, >= 3.2)\r\n\r\n    rails (~> 5.0.0) was resolved to 5.0.0, which depends on\r\n      activerecord (= 5.0.0)\r\n\r\nRunning `bundle update` will rebuild your snapshot from scratch, using only\r\nthe gems in your Gemfile, which may resolve the conflict.\r\n```\r\n\r\nPoint the gem to the master branch in the Gemfile.\r\n\r\n```ruby\r\ngem \'acts-as-taggable-on\', :git => \'https://github.com/mbleigh/acts-as-taggable-on\'\r\n```\r\n\r\nRun:\r\n\r\n```\r\nbundle\r\n```\r\n\r\nCopy the tagging gem migration files to your project.\r\n\r\n```\r\nrails acts_as_taggable_on_engine:install:migrations\r\n```\r\n\r\nRun the migration.\r\n\r\n```\r\nrails db:migrate\r\n```\r\n\r\nCreate `confit/initializers/acts_as_taggable_on.rb`:\r\n\r\n```ruby\r\nActsAsTaggableOn.force_binary_collation = true\r\n```\r\n\r\nAdd:\r\n\r\n```ruby\r\nacts_as_taggable \r\n```\r\n\r\nto article model. In articles controller, add `:tag_list` to allowed_params method.\r\n\r\n```ruby\r\ndef allowed_params\r\n  params.require(:article).permit(:content, :name, :tag_list)\r\nend\r\n```\r\n\r\nAdd text field to tag articles in form partial.\r\n\r\n```rhtml\r\n<div class=\'field\'>\r\n	<%= f.label :tag_list, \'Tags (separated by commas)\' %><br/>\r\n	<%= f.text_field :tag_list %>\r\n</div>\r\n```\r\n\r\nDisplay the tags in article show page.\r\n\r\n```rhtml\r\n<p>Tags: <%= article.tag_list %></p>\r\n```\r\n	\r\nMake the tags clickable.\r\n\r\n```rhtml\r\n<p>Tags: <%= article.tag_list.map { |t| link_to t, tag_path(t) }.join(\', \') %></p>	\r\n```\r\n\r\nDefine routes for the tag links:\r\n\r\n```ruby\r\nget \'tags/:tag\', to: \'articles#index\', as: :tag\r\n```\r\n\r\nChange the index action to filter the article by selected tag.\r\n\r\n```ruby\r\nif params[:tag]\r\n  @articles = Article.tagged_with(params[:tag])\r\nelse\r\n  @articles = Article.all\r\nend\r\n```\r\n\r\nThe articles index page display the tag as:\r\n\r\n```html\r\n<a href=\"/tags/batman\">batman</a>, <a href=\"/tags/comic\">comic</a>\r\n```\r\n\r\ninstead of creating link for the tags. Use raw method to fix this problem.\r\n\r\n```rhtml\r\n<p>Tags: <%= raw(article.tag_list.map { |t| link_to t, tag_path(t) }.join(\', \')) %></p>\r\n```\r\n\r\nYou can now click the link to view all the articles tagged with that particular tag.\r\n\r\n### Adding a Tag Cloud\r\n\r\n```rhtml\r\n<div id=\'tag_cloud\'>\r\n  <% tag_cloud Article.tag_counts, %w{s m l} do |tag, css_class| %>\r\n    <%= link_to tag.name, tag_path(tag.name), class: css_class %>\r\n  <% end %>\r\n</div>\r\n```\r\n\r\nAdd css to style the tag cloud, in articles.scss:\r\n\r\n```css\r\n#tag_cloud {\r\n  width: 400px;\r\n  line-height: 1.6em;\r\n  .s { font-size: 0.8em; }\r\n  .m { font-size: 1.2em; }\r\n  .l { font-size: 1.8em; }\r\n}\r\n```\r\n\r\nYou can now see the font size differ based on their frequency of occurrence. \r\n\r\n## Summary\r\n\r\nIn this article, you learned how to tag a model using acts-as-taggable-on gem in Rails 5. We were able to list all the tags as clickable links and display tag cloud.\r\n','2016-07-15 03:44:19','2016-07-16 06:22:49'),(4241,'Tagging from Scratch in Rails 5','In this article, you will learn how to tag just one model in your Rails 5 app from scratch. This is based on railscast episode number 382.\r\n\r\nCreate a new Rails 5 app.\r\n\r\n```\r\nrails new tug\r\n```\r\n\r\nCreate an article model.\r\n\r\n```\r\nrails g model article name published_on:date content:text\r\n```\r\n\r\nCreate sample data in seeds.rb:\r\n\r\n```ruby\r\nbatman = Article.create! name: \"Batman\", content: <<-ARTICLE\r\nBatman is a fictional character created by the artist Bob Kane and writer Bill Finger. A comic book superhero, Batman first appeared in Detective Comics #27 (May 1939), and since then has appeared primarily in publications by DC Comics. Originally referred to as \"The Bat-Man\" and still referred to at times as \"The Batman\", he is additionally known as \"The Caped Crusader\", \"The Dark Knight\", and the \"World\'s Greatest Detective,\" among other titles. (from Wikipedia)\r\nARTICLE\r\n\r\nsuperman = Article.create! name: \"Superman\", content: <<-ARTICLE\r\nSuperman is a fictional comic book superhero appearing in publications by DC Comics, widely considered to be an American cultural icon. Created by American writer Jerry Siegel and Canadian-born American artist Joe Shuster in 1932 while both were living in Cleveland, Ohio, and sold to Detective Comics, Inc. (later DC Comics) in 1938, the character first appeared in Action Comics #1 (June 1938) and subsequently appeared in various radio serials, television programs, films, newspaper strips, and video games. (from Wikipedia)\r\nARTICLE\r\n\r\nkrypton = Article.create! name: \"Krypton\", content: <<-ARTICLE\r\nKrypton is a fictional planet in the DC Comics universe, and the native world of the super-heroes Superman and, in some tellings, Supergirl and Krypto the Superdog. Krypton has been portrayed consistently as having been destroyed just after Superman\'s flight from the planet, with exact details of its destruction varying by time period, writers and franchise. Kryptonians were the dominant people of Krypton. (from Wikipedia)\r\nARTICLE\r\n\r\nlex_luthor = Article.create! name: \"Lex Luthor\", content: <<-ARTICLE\r\nLex Luthor is a fictional character, a supervillain who appears in comic books published by DC Comics. He is the archenemy of Superman, and is also a major adversary of Batman and other superheroes in the DC Universe. Created by Jerry Siegel and Joe Shuster, he first appeared in Action Comics #23 (April 1940). Luthor is described as \"a power-mad, evil scientist\" of high intelligence and incredible technological prowess. (from Wikipedia)\r\nARTICLE\r\n\r\nrobin = Article.create! name: \"Robin\", content: <<-ARTICLE\r\nRobin is the name of several fictional characters appearing in comic books published by DC Comics, originally created by Bob Kane, Bill Finger and Jerry Robinson, as a junior counterpart to DC Comics superhero Batman. The team of Batman and Robin is commonly referred to as the Dynamic Duo or the Caped Crusaders. (from Wikipedia)\r\nARTICLE\r\n```\r\n\r\nCreate the tag model with name attribute.\r\n\r\n```\r\nrails g model tag name\r\n```\r\n\r\nCreate the tagging model.\r\n\r\n```\r\nrails g model tagging tag:belongs_to article:belongs_to\r\n```\r\n\r\nAdd indexes to the generated migrations.\r\n\r\n```ruby\r\nclass CreateTaggings < ActiveRecord::Migration[5.0]\r\n  def change\r\n    create_table :taggings do |t|\r\n      t.belongs_to :tag, foreign_key: true\r\n      t.belongs_to :article, foreign_key: true\r\n\r\n      t.timestamps\r\n    end\r\n    add_index :taggings, :tag_id\r\n    add_index :taggings, :article_id\r\n  end\r\nend\r\n```\r\n\r\n```\r\nrails db:migrate\r\n```\r\n\r\nYou will get the error:\r\n\r\n```\r\nStandardError: An error has occurred, this and all later migrations canceled:\r\n\r\nIndex name \'index_taggings_on_tag_id\' on table \'taggings\' already exists\r\n```\r\n\r\nRemove:\r\n\r\n```ruby\r\nadd_index :taggings, :tag_id\r\nadd_index :taggings, :article_id\r\n```\r\n\r\nMigrate the database.\r\n\r\n```\r\nrails db:migrate\r\n```\r\n\r\nSetup the associations in the models. In tag model:\r\n\r\n```ruby\r\nclass Tag < ApplicationRecord\r\n  has_many :taggings\r\n  has_many :articles, through: :taggings\r\nend\r\n```\r\n\r\nIn article model:\r\n\r\n```ruby\r\nclass Article < ApplicationRecord\r\n  has_many :taggings\r\n  has_many :tags, through: :taggings\r\n  \r\n  def self.tagged_with(name)\r\n    Tag.find_by!(name: name).articles\r\n  end\r\n  \r\n  def self.tag_counts\r\n    Tag.select(\'tags.*, count(taggings.tag_id) as count\').joins(:taggings).group(\'taggings.tag_id\')\r\n  end\r\n  \r\n  def tag_list\r\n    tags.map(&:name).join(\', \')\r\n  end\r\n  \r\n  def tag_list=(names)\r\n    self.tags = names.split(\',\').map do |n|\r\n      Tag.where(name: n.strip).first_or_create!\r\n    end\r\n  end\r\nend\r\n```\r\n\r\nCreate the articles controller with index, new, show and edit actions.\r\n\r\n```\r\nrails g controller articles index new show edit\r\n```\r\n\r\nThe articles controller is straightforward.\r\n\r\n```ruby\r\nclass ArticlesController < ApplicationController\r\n  def index\r\n    @articles = if params[:tag]\r\n      Article.tagged_with(params[:tag])\r\n    else\r\n      Article.all\r\n    end\r\n  end\r\n\r\n  def new\r\n    @article = Article.new\r\n  end\r\n\r\n  def show\r\n    @article = Article.find(params[:id])\r\n  end\r\n  \r\n  def create\r\n    @article = Article.new(article_params)\r\n    if @article.save\r\n      redirect_to @article, notice: \'Created article.\'\r\n    else\r\n      render :new\r\n    end\r\n  end\r\n\r\n  def edit\r\n    @article = Article.find(params[:id])\r\n  end\r\n  \r\n  def update\r\n    @article = Article.find(params[:id])\r\n    if @article.update_attributes(article_params)\r\n      redirect_to @article, notice: \'Updated article.\'\r\n    else\r\n      render :edit\r\n    end\r\n  end\r\n  \r\n  private\r\n  \r\n  def article_params\r\n    params.require(:article).permit(:name, :published_on, :content)\r\n  end\r\nend\r\n```\r\n\r\nIn app/views/articles/index.html.erb, add the code to display the tags for an article:\r\n\r\n```rhtml\r\n<%= raw article.tags.map(&:name).map { |t| link_to t, tag_path(t) }.join(\', \') %>\r\n```\r\n\r\nIt will look like this:\r\n\r\n```rhtml\r\n<h1>Articles</h1>\r\n\r\n<div id=\"tag_cloud\">\r\n  <% tag_cloud Article.tag_counts, %w[s m l] do |tag, css_class| %>\r\n    <%= link_to tag.name, tag_path(tag.name), class: css_class %>\r\n  <% end %>\r\n</div>\r\n\r\n<div id=\"articles\">\r\n  <% @articles.each do |article| %>\r\n    <h2><%= link_to article.name, article %></h2>\r\n    <%= simple_format article.content %>\r\n    <p>\r\n      Tags: <%= raw article.tags.map(&:name).map { |t| link_to t, tag_path(t) }.join(\', \') %>\r\n    </p>\r\n    <p><%= link_to \"Edit Article\", edit_article_path(article) %></p>\r\n  <% end %>\r\n</div>\r\n\r\n<p><%= link_to \"New Article\", new_article_path %></p>\r\n```\r\n\r\nAdd css for tag cloud to articles.scss:\r\n\r\n```css\r\n#tag_cloud {\r\n  width: 400px;\r\n  line-height: 1.6em;\r\n  .s { font-size: 0.8em; }\r\n  .m { font-size: 1.2em; }\r\n  .l { font-size: 1.8em; }\r\n}\r\n```\r\n\r\nFor layout.scss, refer the git repository for the source. Here is the implementation for the `tag_cloud`.\r\n\r\n```ruby\r\nmodule ApplicationHelper\r\n  def tag_cloud(tags, classes)\r\n    max = tags.sort_by(&:count).last\r\n    tags.each do |tag|\r\n      index = tag.count.to_f / max.count * (classes.size - 1)\r\n      yield(tag, classes[index.round])\r\n    end\r\n  end\r\nend\r\n```\r\n\r\nPopulate sample data using seeds.rb:\r\n\r\n```\r\nrails db:seed\r\n```\r\n\r\nDefine the resource in routes.rb.\r\n\r\n```ruby\r\nRails.application.routes.draw do\r\n  resources :articles\r\n  \r\n  root \'articles#index\'\r\nend\r\n```\r\n\r\nStart the rails server.\r\n\r\n```\r\nrails s\r\n```\r\n\r\nGo to `localhost:3000`. Edit an article and add some tags. It will fail with error:\r\n\r\n```\r\nUnpermitted parameter: tag_list\r\n```\r\n\r\nAdd `tag_list` to the `article_params` method:\r\n\r\n```ruby\r\ndef article_params\r\n  params.require(:article).permit(:name, :published_on, :content, :tag_list)\r\nend\r\n```\r\n\r\nNow the tag will get saved. If you go the articles index page, you will get the error:\r\n\r\n```\r\nShowing /Users/bparanj/projects/tug/app/views/articles/index.html.erb where line #5 raised:\r\n\r\nundefined method `tag_path\' for #<#<Class:0x007ff0a30e0e20>:0x007ff09d7d4a70>\r\nDid you mean?  tag_option\r\n```\r\n\r\nAdd:\r\n\r\n```ruby\r\nget \'tags/:tag\', to: \'articles#index\', as: :tag\r\n```\r\n\r\nto routes.rb. Now you will be able to see the tags for all the articles and the tag cloud.\r\n\r\nPerformance Tip by Oren Dobzinski: There\'s no need to sort the array only to pick the largest element. In application helper for the `tag_cloud` method: \r\n\r\n```ruby\r\nmax = tags.max_by(&:count)\r\n```\r\n\r\nThe form partial needs to have a text field to accept tags that are separated by commas.\r\n\r\n```rhtml\r\n<%= form_for @article do |f| %>\r\n  <% if @article.errors.any? %>\r\n    <div id=\"error_explanation\">\r\n      <h2><%= pluralize(@article.errors.count, \"error\") %> prohibited this article from being saved:</h2>\r\n      <ul>\r\n      <% @article.errors.full_messages.each do |msg| %>\r\n        <li><%= msg %></li>\r\n      <% end %>\r\n      </ul>\r\n    </div>\r\n  <% end %>\r\n\r\n  <div class=\"field\">\r\n    <%= f.label :name %><br />\r\n    <%= f.text_field :name %>\r\n  </div>\r\n  <div class=\"field\">\r\n    <%= f.label :tag_list, \"Tags (separated by commas)\" %><br />\r\n    <%= f.text_field :tag_list %>\r\n  </div>\r\n  <div class=\"field\">\r\n    <%= f.label :content %><br />\r\n    <%= f.text_area :content %>\r\n  </div>\r\n  <div class=\"actions\">\r\n    <%= f.submit %>\r\n  </div>\r\n<% end %>\r\n```\r\n\r\nYou can download the source code for this article from [tug](https://github.com/bparanj/tug \'tagging\').\r\n\r\n## Bug Fix\r\n\r\nIf the tags have a dot within the word, for instance Rails 5.1, this solution will break with the error message:\r\n\r\n```\r\nError: ActionController::UnknownFormat (ActionController::UnknownFormat)\r\n```\r\n \r\nBecause Rails will treat whatever it finds after the dot, in this case 1 as an extension. To fix it, change the routes as follows:\r\n\r\n```ruby\r\nget \'tags/:tag\', to: \'episodes#index\', as: :tag, :constraints  => { :tag => /[^\\/]+/ }\r\n```\r\n\r\nThe constraint tells Rails not to get confused if it sees a dot and then a number. So, it will not be treated as an extension for a format. The entire query parameter will now consist of the string \'Rails 5.1\' instead of getting chopped off like this: \'Rails 5\'.\r\n\r\n## Summary\r\n\r\nIn this article, you learned how to implement tagging functionality for just one model in a Rails 5 app.','2016-08-03 06:54:07','2016-12-25 05:50:09'),(4251,'Tagging from Scratch in Rails 5 using Zurb Foundation','## Libraries Used\r\n\r\n- Zurb Foundation  6.2.3\r\n- Modernizr        3.3.1\r\n\r\nZurb Foundation is a CSS framework. Modernizr tells you what HTML, CSS and JavaScript features the user’s browser has to offer.\r\n\r\n## Basic Setup\r\n\r\nCreate a new Rails 5 project.\r\n\r\n```\r\nrails new taf\r\n```\r\n\r\nAdd:\r\n\r\n```ruby\r\ngem \'foundation-rails\'\r\n```\r\n\r\nto Gemfile and run:\r\n\r\n```\r\nbundle\r\n```\r\n\r\nInstall Zurb Foundation by running the generator.\r\n\r\n```\r\nrails g foundation:install\r\n```\r\n\r\nSay, yes to override the application.html.erb. Create the tag model:\r\n\r\n```\r\nrails g model tag name\r\n```\r\n\r\nCreate the article model:\r\n\r\n```\r\nrails g model article author content:text\r\n```\r\n\r\nCreate the tagging model:\r\n\r\n```\r\nrails g model tagging article:belongs_to tag:belongs_to\r\n```\r\n\r\nMigrate the database:\r\n\r\n```\r\nrails db:migrate\r\n```\r\n\r\nIf you use `belongs_to` in the rails generator, Rails will automatically add indexes to the foreign keys. You can see it in the schema.rb:\r\n\r\n```ruby\r\ncreate_table \"taggings\", force: :cascade do |t|\r\n  t.integer  \"article_id\"\r\n  t.integer  \"tag_id\"\r\n  t.datetime \"created_at\", null: false\r\n  t.datetime \"updated_at\", null: false\r\n  t.index [\"article_id\"], name: \"index_taggings_on_article_id\"\r\n  t.index [\"tag_id\"], name: \"index_taggings_on_tag_id\"\r\nend\r\n```\r\n\r\nDefine the assocations between article and tag models:\r\n\r\n```ruby\r\nclass Tag < ApplicationRecord\r\n  has_many :taggings\r\n  has_many :articles, through: :taggings\r\nend\r\n```\r\n\r\n```ruby\r\nclass Article < ApplicationRecord\r\n  has_many :taggings\r\n  has_many :tags, through: :taggings\r\nend\r\n```\r\n\r\nSince we used the `belongs_to` in the rails generator for tagging model, we have:\r\n\r\n```ruby\r\nclass Tagging < ApplicationRecord\r\n  belongs_to :article\r\n  belongs_to :tag\r\nend\r\n```\r\n\r\n## Tagging an Article\r\n\r\nAdd tag related methods to article model.\r\n\r\n```ruby\r\ndef all_tags=(names)\r\n  self.tags = names.split(\',\').map do |name|\r\n    Tag.where(name: name.strip).first_or_create!\r\n  end\r\nend\r\n\r\ndef all_tags\r\n  self.tags.map(&:name).join(\', \')\r\nend\r\n```\r\n\r\nCreate the articles controller with index and create actions.\r\n\r\n```\r\nrails g controller articles index create\r\n```\r\n\r\nThe user enters value for the `all_tags` virtual attribute in the view, so include it in the strong parameters.\r\n\r\n```ruby\r\nprivate\r\n\r\ndef article_params\r\n  params.require(:article).permit(:author, :content, :all_tags)\r\nend\r\n```\r\n\r\nCreate the form with a text field for tags. We will use AJAX to create an article. In `app/views/articles/_form.html.erb`:\r\n\r\n```rhtml\r\n<div class=\"row\">\r\n  <div class=\"large-10 large-centered columns\">\r\n     <%= form_for(@article, remote: true) do |f| %>\r\n      <div class=\"row column log-in-form\">\r\n        <h4 class=\"text-center\">Tag Me!</h4>\r\n        <label>Author\r\n          <%= f.text_field :author %>\r\n        </label>\r\n        <label>Body\r\n          <%= f.text_area :content, rows: 5 %>\r\n        </label>\r\n        <label>Tags\r\n          <%= f.text_field :all_tags, placeholder: \"Tags separated with comma\" %>\r\n        </label>\r\n	    <%= f.submit \"Submit\", class: \"button\"%>\r\n      </div>\r\n    <% end %>\r\n  </div>\r\n</div>\r\n```\r\n\r\nThe `remote: true` attribute must be specified to make an AJAX call to the create action in articles controller. Here is the app/views/articles/index.html.erb:\r\n\r\n```rhtml\r\n<div class=\"row\">\r\n  <div class=\"large-8 columns\">\r\n    <%= render  \"form\" %>\r\n  </div>\r\n</div>\r\n```\r\n\r\nDefine the resources in the routes.rb:\r\n\r\n```ruby\r\nRails.application.routes.draw do\r\n  resources :articles\r\n  root \'articles#index\'\r\nend\r\n```\r\n\r\nFor the css in articles.scss, refer the source code repository for this article [taf](https://github.com/bparanj/taf \'tagging in rails 5\'). Run the rails server. When we create a new article, we get the error:\r\n\r\n```\r\nActionController::RoutingError (No route matches [GET] \"/javascripts/vendor/modernizr.js\"):\r\n```\r\n\r\nAdd:\r\n\r\n```ruby\r\ngem \'modernizr-rails\'\r\n```\r\n\r\nto Gemfile and run bundle. In layout, add:\r\n\r\n```rhtml\r\n<%= javascript_include_tag :modernizr %>\r\n```\r\n\r\nin the head section. Otherwise, you will have problems loading modernizr.js. Restart the server. You will now get the error:\r\n\r\n```\r\nSprockets::Rails::Helper::AssetNotPrecompiled in Articles#index\r\nAsset was not declared to be precompiled in production.\r\nAdd `Rails.application.config.assets.precompile += %w( modernizr.js )` to `config/initializers/assets.rb` and restart your server\r\n```\r\n\r\nAdd the above declaration and restart the server. Create the file app/views/articles/create.js.erb:\r\n\r\n```rhtml\r\nvar new_post = $(\"<%= escape_javascript(render(partial: @article))%>\").hide();\r\n$(\'#articles\').prepend(new_post);\r\n$(\'#article_<%= @article.id %>\').fadeIn(\'slow\');\r\n$(\'#new_article\')[0].reset();\r\n```\r\n\r\nImplement the create action:\r\n\r\n```ruby\r\ndef create\r\n  @article = Article.new(article_params)\r\n  respond_to do |format|\r\n    if @article.save\r\n      format.js\r\n    else\r\n      format.html { render root_path }\r\n    end\r\n  end\r\nend\r\n```\r\n\r\nCreate _article.html.erb to render the article:\r\n\r\n```\r\n<div id=\"article_<%= article.id %>\">\r\n  <div class=\"large-12 columns border border-box glassy-bg mt pt\">\r\n    <strong><%= h(article.author) %></strong><br />\r\n    <sup class=\"text-muted\">From <%= time_ago_in_words(article.created_at)%></sup><br />\r\n    <div class=\"mb pb\">\r\n      <%= h(article.content) %>\r\n    </div>\r\n    <div class=\"tags\">\r\n      <%=raw tag_links(article.all_tags)%>\r\n    </div>\r\n  </div>\r\n</div>\r\n```\r\n\r\n## Search by Tag\r\n\r\nImplement the method to find all articles that is tagged with a certain tag in article.rb:\r\n\r\n```ruby\r\ndef self.tagged_with(name)\r\n  Tag.find_by(name: name).articles\r\nend\r\n```\r\n\r\nChange the articles index action to handle the search:\r\n\r\n```ruby\r\n@articles = if params[:tag]\r\n  Article.tagged_with(params[:tag])\r\nelse\r\n  Article.all\r\nend\r\n```\r\n\r\nDeclare the route for searching.\r\n\r\n```ruby\r\nget \'tags/:tag\', to: \'articles#index\', as: \'tag\'\r\n```\r\n\r\nNow you can see all the articles that has been tagged by a specific tag by clicking on any tag.\r\n\r\n## Tag Cloud\r\n\r\nImplement the number method in Tag.\r\n\r\n```ruby\r\nclass Tag < ApplicationRecord\r\n  has_many :taggings\r\n  has_many :articles, through: :taggings\r\n  \r\n  def self.number\r\n    self.select(\"name, count(taggings.tag_id) as count\").joins(:taggings).group(\"taggings.tag_id\")\r\n  end\r\nend\r\n```\r\n\r\nImplement the `tag_cloud` method in articles helper.\r\n\r\n```ruby\r\nmodule ArticlesHelper\r\n  def tag_links(tags)\r\n    tags.split(\",\").map{|tag| link_to tag.strip, tag_path(tag.strip) }.join(\", \") \r\n  end\r\n\r\n  def tag_cloud(tags, classes)\r\n    max = tags.sort_by(&:count).last\r\n    tags.each do |tag|\r\n      index = tag.count.to_f / max.count * (classes.size-1)\r\n      yield(tag, classes[index.round])\r\n    end\r\n  end\r\nend\r\n```\r\n\r\nAdd the css to tags.scss:\r\n\r\n```css\r\n.css1 { font-size: 1.0em;}\r\n.css2 { font-size: 1.2em;}\r\n.css3 { font-size: 1.4em;}\r\n.css4 { font-size: 1.6em;}\r\n```\r\n\r\nCreate an article with some tags. Change index to display the articles:\r\n\r\n```rhtml\r\n<div class=\"row mt pt\">\r\n  <div class=\"large-5 columns\">\r\n    <div class=\"top-pad glassy-bg\">\r\n      <%= render \'form\' %>\r\n    </div>\r\n    <div class=\"tags-cloud glassy-bg\">\r\n      <h4>Tags Cloud</h4>\r\n      <% tag_cloud Tag.number, %w{css1 css2 css3 css4} do |tag, css_class| %>\r\n        <%= link_to tag.name, tag_path(tag.name), class: css_class %>\r\n      <% end %>\r\n    </div>\r\n  </div>\r\n  <div class= \"large-7 columns\" id=\"posts\">\r\n    <%= render partial: @articles.reverse %>\r\n  </div>\r\n</div>\r\n```\r\n\r\nYou can download the source code for this article from [Tagging in Rails 5](https://github.com/bparanj/taf \'Tagging in Rails 5\').\r\n\r\n## Summary\r\n\r\nIn this article, you learned how to develop tagging a single model from scratch in Rails 5 using Zurb Foundation and Modernizr.\r\n\r\n## Resources\r\n\r\n[Modernizr](https://modernizr.com \'Modernizr\')\r\n[Tagging from Scratch in Rails 4](https://www.sitepoint.com/tagging-scratch-rails/ \'Tagging from Scratch in Rails 4\')','2016-08-04 05:31:01','2016-08-04 05:31:01'),(4261,'How to use Ouibounce in Rails 5','Ouibounce is a small library enabling you to display a modal before a user leaves your website. It detects the user exit intent. You can download the ouibounce static app to play with from my repo [ouibounce static app](https://github.com/bparanj/ouibounce \'ouibounce static app\').\r\n\r\n![alternate text](http://cdn2-www.dogtime.com/assets/uploads/gallery/30-impossibly-cute-puppies/impossibly-cute-puppy-8.jpg)\r\n\r\n## Step 1\r\n\r\nDownload the [ouibounce.js](https://raw.githubusercontent.com/carlsednaoui/ouibounce/master/build/ouibounce.js \'ouibounce js\') and save it in vendor/assets/javascripts folder.\r\n\r\n## Step 2\r\n\r\nIn app/views/layouts/application.html.erb, add:\r\n\r\n```rhtml\r\n<%= javascript_include_tag \'ouibounce\' %>	\r\n```\r\n\r\nThe head section of the layout file will look like this:\r\n\r\n```rhtml\r\n<head>\r\n  <meta charset=\"utf-8\" />\r\n  <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\" />\r\n  <link href=\'http://fonts.googleapis.com/css?family=PT+Sans\' rel=\'stylesheet\' type=\'text/css\'>\r\n  <title>Tagging System</title>\r\n  <%= csrf_meta_tags %>\r\n  <%= stylesheet_link_tag    \'application\', media: \'all\', \'data-turbolinks-track\': \'reload\' %>\r\n  <%= javascript_include_tag :modernizr %>\r\n  <%= javascript_include_tag \'ouibounce\' %>	\r\n</head>\r\n```\r\n\r\n## Step 3\r\n\r\nJust before the body tag ends, add:\r\n\r\n```html\r\n<!-- Ouibounce Modal -->\r\n<div id=\"ouibounce-modal\">\r\n  <div class=\"underlay\"></div>\r\n  <div class=\"modal\">\r\n    <div class=\"modal-title\">\r\n      <h3>This is a Ouibounce modal</h3>\r\n    </div>\r\n\r\n    <div class=\"modal-body\">\r\n      <p>Thanks for stoping by!</p>\r\n      <br>\r\n      <p>You can style your Ouibounce modal however you see fit. You can also include big buttons, an email capture or just plain text. The sky\'s the limit!</p>\r\n      <br>\r\n      <p>Close this modal by clicking \"No Thanks\" below or clicking anywhere outside of the modal.</p>\r\n\r\n      <form>\r\n        <input type=\"text\" placeholder=\"you@email.com\">\r\n        <input type=\"submit\" value=\"learn more &raquo;\">\r\n        <p class=\"form-notice\">*this is a fake form</p>\r\n      </form>\r\n    </div>\r\n\r\n    <div class=\"modal-footer\">\r\n      <p>no thanks</p>\r\n    </div>\r\n  </div>\r\n</div>\r\n\r\n<!-- Example page JS        -->\r\n<!-- Used to fire the modal -->\r\n<script>\r\n\r\n  // if you want to use the \'fire\' or \'disable\' fn,\r\n  // you need to save OuiBounce to an object\r\n  var _ouibounce = ouibounce(document.getElementById(\'ouibounce-modal\'), {\r\n    aggressive: true,\r\n    timer: 0,\r\n    callback: function() { console.log(\'ouibounce fired!\'); }\r\n  });\r\n\r\n  $(\'body\').on(\'click\', function() {\r\n    $(\'#ouibounce-modal\').hide();\r\n  });\r\n\r\n  $(\'#ouibounce-modal .modal-footer\').on(\'click\', function() {\r\n    $(\'#ouibounce-modal\').hide();\r\n  });\r\n\r\n  $(\'#ouibounce-modal .modal\').on(\'click\', function(e) {\r\n    e.stopPropagation();\r\n  });\r\n</script>\r\n```\r\n	\r\nto the layout file.\r\n\r\n## Step 4\r\n\r\nIn assets.rb add the ouibounce javascript file:\r\n\r\n```ruby\r\nRails.application.config.assets.precompile += %w( modernizr.js ouibounce.js )\r\n```\r\n\r\n## Step 5 \r\n\r\nCreate modal.scss in app/assets/stylesheets with the following css:\r\n\r\n```css\r\n#ouibounce-modal {\r\n  font-family: \'Open Sans\', sans-serif;\r\n  display: none;\r\n  position: fixed;\r\n  top: 0;\r\n  left: 0;\r\n  width: 100%;\r\n  height: 100%;\r\n}\r\n#ouibounce-modal .underlay {\r\n  width: 100%;\r\n  height: 100%;\r\n  position: absolute;\r\n  top: 0;\r\n  left: 0;\r\n  background-color: rgba(0,0,0,0.5);\r\n  cursor: pointer;\r\n  -webkit-animation: fadein 0.5s;\r\n  animation: fadein 0.5s;\r\n}\r\n#ouibounce-modal .modal {\r\n  width: 600px;\r\n  height: 400px;\r\n  background-color: #f0f1f2;\r\n  z-index: 1;\r\n  position: absolute;\r\n  margin: auto;\r\n  top: 0;\r\n  right: 0;\r\n  bottom: 0;\r\n  left: 0;\r\n  border-radius: 4px;\r\n  -webkit-animation: popin 0.3s;\r\n  animation: popin 0.3s;\r\n}\r\n#ouibounce-modal .modal-title {\r\n  font-size: 18px;\r\n  background-color: #252525;\r\n  color: #fff;\r\n  padding: 10px;\r\n  margin: 0;\r\n  border-radius: 4px 4px 0 0;\r\n  text-align: center;\r\n}\r\n#ouibounce-modal h3 {\r\n  color: #fff;\r\n  font-size: 1em;\r\n  margin: 0.2em;\r\n  text-transform: uppercase;\r\n  font-weight: 500;\r\n}\r\n#ouibounce-modal .modal-body {\r\n  padding: 20px 35px;\r\n  font-size: 0.9em;\r\n}\r\n#ouibounce-modal p {\r\n  color: #344a5f;\r\n  line-height: 1.3em;\r\n}\r\n#ouibounce-modal form {\r\n  text-align: center;\r\n  margin-top: 35px;\r\n}\r\n#ouibounce-modal form input[type=text] {\r\n  padding: 12px;\r\n  font-size: 1.2em;\r\n  width: 300px;\r\n  border-radius: 4px;\r\n  border: 1px solid #ccc;\r\n  -webkit-font-smoothing: antialiased;\r\n}\r\n#ouibounce-modal form input[type=submit] {\r\n  text-transform: uppercase;\r\n  font-weight: bold;\r\n  padding: 12px;\r\n  font-size: 1.1em;\r\n  border-radius: 4px;\r\n  color: #fff;\r\n  background-color: #4ab471;\r\n  border: none;\r\n  cursor: pointer;\r\n  -webkit-font-smoothing: antialiased;\r\n}\r\n#ouibounce-modal form p {\r\n  text-align: left;\r\n  margin-left: 35px;\r\n  opacity: 0.8;\r\n  margin-top: 1px;\r\n  padding-top: 1px;\r\n  font-size: 0.9em;\r\n}\r\n#ouibounce-modal .modal-footer {\r\n  position: absolute;\r\n  bottom: 20px;\r\n  text-align: center;\r\n  width: 100%;\r\n}\r\n#ouibounce-modal .modal-footer p {\r\n  text-transform: capitalize;\r\n  cursor: pointer;\r\n  display: inline;\r\n  border-bottom: 1px solid #344a5f;\r\n}\r\n@-webkit-keyframes fadein {\r\n  0% {\r\n    opacity: 0;\r\n  }\r\n\r\n  100% {\r\n    opacity: 1;\r\n  }\r\n}\r\n@-ms-keyframes fadein {\r\n  0% {\r\n    opacity: 0;\r\n  }\r\n\r\n  100% {\r\n    opacity: 1;\r\n  }\r\n}\r\n@keyframes fadein {\r\n  0% {\r\n    opacity: 0;\r\n  }\r\n\r\n  100% {\r\n    opacity: 1;\r\n  }\r\n}\r\n@-webkit-keyframes popin {\r\n  0% {\r\n    -webkit-transform: scale(0);\r\n    transform: scale(0);\r\n    opacity: 0;\r\n  }\r\n\r\n  85% {\r\n    -webkit-transform: scale(1.05);\r\n    transform: scale(1.05);\r\n    opacity: 1;\r\n  }\r\n\r\n  100% {\r\n    -webkit-transform: scale(1);\r\n    transform: scale(1);\r\n    opacity: 1;\r\n  }\r\n}\r\n@-ms-keyframes popin {\r\n  0% {\r\n    -ms-transform: scale(0);\r\n    transform: scale(0);\r\n    opacity: 0;\r\n  }\r\n\r\n  85% {\r\n    -ms-transform: scale(1.05);\r\n    transform: scale(1.05);\r\n    opacity: 1;\r\n  }\r\n\r\n  100% {\r\n    -ms-transform: scale(1);\r\n    transform: scale(1);\r\n    opacity: 1;\r\n  }\r\n}\r\n@keyframes popin {\r\n  0% {\r\n    -webkit-transform: scale(0);\r\n    -ms-transform: scale(0);\r\n    transform: scale(0);\r\n    opacity: 0;\r\n  }\r\n\r\n  85% {\r\n    -webkit-transform: scale(1.05);\r\n    -ms-transform: scale(1.05);\r\n    transform: scale(1.05);\r\n    opacity: 1;\r\n  }\r\n\r\n  100% {\r\n    -webkit-transform: scale(1);\r\n    -ms-transform: scale(1);\r\n    transform: scale(1);\r\n    opacity: 1;\r\n  }\r\n}\r\n```\r\n\r\nYou will now see the sample modal when you are about to close the tab.\r\n\r\n## Summary\r\n\r\nIn this article, you learned how to hook up the ouibounce library with Rails 5 asset pipeline.','2016-08-05 05:51:29','2016-11-01 05:13:30'),(4271,'Using Zurb Foundation 6 with Rails 5 Apps','\r\nWe will use zurb-foundation version 6 with Rails 5. The foundation-rails gem version used is 6.2.3.0. Create a new Rails 5 project.\r\n\r\n## Setup Rails 5 Project\r\n\r\n```\r\nrails new zurb6\r\n```\r\n\r\nCreate a product resource.\r\n\r\n```\r\nrails g scaffold product name price:decimal --skip-stylesheets\r\n```\r\n\r\nMigrate the database.\r\n\r\n```\r\nrails db:migrate\r\n```\r\n\r\n## Setup Zurb Foundation\r\n\r\nAdd:\r\n\r\n```ruby\r\ngem \'foundation-rails\'\r\n```\r\n\r\nto Gemfile. Run bundle. Install zurb foundation.\r\n\r\n```\r\nrails g foundation:install\r\n```\r\n\r\nSay yes to overwrite application.html.erb. Include:\r\n\r\n```rhtml\r\n<%= javascript_include_tag \"vendor/modernizr\" %>\r\n```\r\n\r\ninside the head section of the layout file.\r\n\r\n## Navigation Bar\r\n\r\nAdd navigation to the layout file:\r\n\r\n```rhtml\r\n<div class=\"top-bar\">\r\n  <div class=\"top-bar-left\">\r\n    <ul class=\"dropdown menu\" data-dropdown-menu>\r\n      <li class=\"menu-text\">Site Title</li>\r\n      <li>\r\n        <%= link_to \"Browse Products\", products_path %>\r\n      </li>\r\n      <li><%= link_to \"Price List\" %></li>\r\n      <li><%= link_to \"Contact Us\" %></li>\r\n      <li><%= link_to \"Cart\" %></li>\r\n    </ul>\r\n  </div>\r\n</div>\r\n```\r\n\r\nIt now looks like this:\r\n\r\n```\r\n<!DOCTYPE html>\r\n<html lang=\"en\">\r\n  <head>\r\n    <meta charset=\"utf-8\" />\r\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\" />\r\n    <title>My Store</title>\r\n    <%= stylesheet_link_tag    \"application\" %>\r\n    <%= javascript_include_tag \"application\", \'data-turbolinks-track\' => true %>\r\n	<%= javascript_include_tag \"vendor/modernizr\" %>\r\n    <%= csrf_meta_tags %>\r\n  </head>\r\n  <body>\r\n  <div class=\"top-bar\">\r\n    <div class=\"top-bar-left\">\r\n      <ul class=\"dropdown menu\" data-dropdown-menu>\r\n        <li class=\"menu-text\">Site Title</li>\r\n        <li>\r\n          <%= link_to \"Browse Products\", products_path %>\r\n        </li>\r\n        <li><%= link_to \"Price List\" %></li>\r\n        <li><%= link_to \"Contact Us\" %></li>\r\n        <li><%= link_to \"Cart\" %></li>\r\n      </ul>\r\n    </div>\r\n  </div>\r\n  <%= yield %>\r\n  </body>\r\n</html>\r\n```\r\n\r\nDefine the route for the home page.\r\n\r\n```ruby\r\nRails.application.routes.draw do\r\n  resources :products\r\n  root \'products#index\'\r\nend\r\n```\r\n\r\nGo to the home page. You will see the home page styled using Zurb foundation. Add modernizr.js to assets.rb:\r\n\r\n```ruby\r\nRails.application.config.assets.precompile += %w( vendor/modernizr.js )\r\n```\r\n\r\n## Sidebar\r\n\r\nAdd a sidebar to the layout file:\r\n\r\n```rhtml\r\n<!-- Sidebar -->\r\n<aside class=\"large-3 columns\">\r\n  <h5>Categories</h5>\r\n  <ul class=\"side-nav\">\r\n    <li><a href=\"#\">News</a></li>\r\n    <li><a href=\"#\">Code</a></li>\r\n    <li><a href=\"#\">Design</a></li>\r\n    <li><a href=\"#\">Fun</a></li>\r\n    <li><a href=\"#\">Weasels</a></li>\r\n  </ul>\r\n  <div class=\"panel\">\r\n    <h5>Featured</h5>\r\n    <p>Pork drumstick turkey fugiat. Tri-tip elit turducken pork chop in. Swine short ribs meatball irure bacon nulla pork belly cupidatat meatloaf cow.</p>\r\n    <a href=\"#\">Read More &rarr;</a>\r\n  </div>\r\n</aside>\r\n<!-- End Sidebar -->\r\n```\r\n\r\nIt will now look like this:\r\n\r\n```rhtml\r\n<!DOCTYPE html>\r\n<html lang=\"en\">\r\n  <head>\r\n    <meta charset=\"utf-8\" />\r\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\" />\r\n    <title>My Store</title>\r\n    <%= stylesheet_link_tag    \"application\" %>\r\n    <%= javascript_include_tag \"application\", \'data-turbolinks-track\' => true %>\r\n	<%= javascript_include_tag \"vendor/modernizr\" %>\r\n    <%= csrf_meta_tags %>\r\n  </head>\r\n  <body>\r\n  <div class=\"top-bar\">\r\n    <div class=\"top-bar-left\">\r\n      <ul class=\"dropdown menu\" data-dropdown-menu>\r\n        <li class=\"menu-text\">Site Title</li>\r\n        <li>\r\n          <%= link_to \"Browse Products\", products_path %>\r\n        </li>\r\n        <li><%= link_to \"Price List\" %></li>\r\n        <li><%= link_to \"Contact Us\" %></li>\r\n        <li><%= link_to \"Cart\" %></li>\r\n      </ul>\r\n    </div>\r\n  </div>\r\n  <%= yield %>\r\n  <!-- Sidebar -->\r\n    <aside class=\"large-3 columns\">\r\n      <h5>Categories</h5>\r\n      <ul class=\"side-nav\">\r\n        <li><a href=\"#\">News</a></li>\r\n        <li><a href=\"#\">Code</a></li>\r\n        <li><a href=\"#\">Design</a></li>\r\n        <li><a href=\"#\">Fun</a></li>\r\n        <li><a href=\"#\">Weasels</a></li>\r\n      </ul>\r\n      <div class=\"panel\">\r\n        <h5>Featured</h5>\r\n        <p>Pork drumstick turkey fugiat. Tri-tip elit turducken pork chop in. Swine short ribs meatball irure bacon nulla pork belly cupidatat meatloaf cow.</p>\r\n        <a href=\"#\">Read More &rarr;</a>\r\n      </div>\r\n    </aside>\r\n    <!-- End Sidebar -->\r\n  </body>\r\n</html>\r\n```\r\n\r\n## Style Changes for Form\r\n\r\nLet\'s style the form. Change the form partial:\r\n\r\n```rhtml\r\n<%= form_for(product) do |f| %>\r\n  <% if product.errors.any? %>\r\n    <div id=\"error_explanation\">\r\n      <h2><%= pluralize(product.errors.count, \"error\") %> prohibited this product from being saved:</h2>\r\n      <ul>\r\n      <% product.errors.full_messages.each do |message| %>\r\n        <li><%= message %></li>\r\n      <% end %>\r\n      </ul>\r\n    </div>\r\n  <% end %>\r\n  <div class=\"row\">\r\n	<div class=\'large-4 columns\'>\r\n      <%= f.label :name %>\r\n      <%= f.text_field :name %>		\r\n	</div>\r\n  </div>\r\n  <div class=\"row\">\r\n	<div class=\'large-4 columns\'>\r\n      <%= f.label :price %>\r\n      <%= f.text_field :price %>		\r\n	</div>\r\n  </div>\r\n  <div class=\"row\">\r\n	<div class=\'large-4 columns\'>\r\n	  <%= f.submit \'Submit\', class: \'button\' %>	\r\n	</div>  \r\n  </div>\r\n<% end %>\r\n```\r\n\r\nDisplay the sidebar only in the products index page:\r\n\r\n```rhtml\r\n<!DOCTYPE html>\r\n<html lang=\"en\">\r\n  <head>\r\n    <meta charset=\"utf-8\" />\r\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\" />\r\n    <title>My Store</title>\r\n    <%= stylesheet_link_tag    \"application\" %>\r\n    <%= javascript_include_tag \"application\", \'data-turbolinks-track\' => true %>\r\n	<%= javascript_include_tag \"vendor/modernizr\" %>\r\n    <%= csrf_meta_tags %>\r\n  </head>\r\n  <body>\r\n  <div class=\"top-bar\">\r\n    <div class=\"top-bar-left\">\r\n      <ul class=\"dropdown menu\" data-dropdown-menu>\r\n        <li class=\"menu-text\">Site Title</li>\r\n        <li>\r\n          <%= link_to \"Browse Products\", products_path %>\r\n        </li>\r\n        <li><%= link_to \"Price List\" %></li>\r\n        <li><%= link_to \"Contact Us\" %></li>\r\n        <li><%= link_to \"Cart\" %></li>\r\n      </ul>\r\n    </div>\r\n  </div>\r\n  <%= yield %>\r\n  <%= yield :sidebar %>	\r\n  </body>\r\n</html>\r\n```\r\n\r\nAdd `content_for` in products/index.html.erb to display the sidebar:\r\n\r\n```rhtml\r\n<p id=\"notice\"><%= notice %></p>\r\n<h1>Products</h1>\r\n<table>\r\n  <thead>\r\n    <tr>\r\n      <th>Name</th>\r\n      <th>Price</th>\r\n      <th colspan=\"3\"></th>\r\n    </tr>\r\n  </thead>\r\n  <tbody>\r\n    <% @products.each do |product| %>\r\n      <tr>\r\n        <td><%= product.name %></td>\r\n        <td><%= product.price %></td>\r\n        <td><%= link_to \'Show\', product %></td>\r\n        <td><%= link_to \'Edit\', edit_product_path(product) %></td>\r\n        <td><%= link_to \'Destroy\', product, method: :delete, data: { confirm: \'Are you sure?\' } %></td>\r\n      </tr>\r\n    <% end %>\r\n  </tbody>\r\n</table>\r\n<br>\r\n<% content_for :sidebar do %>\r\n  <!-- Sidebar -->\r\n    <aside class=\"large-3 columns\">\r\n      <h5>Categories</h5>\r\n      <ul class=\"side-nav\">\r\n        <li><a href=\"#\">News</a></li>\r\n        <li><a href=\"#\">Code</a></li>\r\n        <li><a href=\"#\">Design</a></li>\r\n        <li><a href=\"#\">Fun</a></li>\r\n        <li><a href=\"#\">Weasels</a></li>\r\n      </ul>\r\n      <div class=\"panel\">\r\n        <h5>Featured</h5>\r\n        <p>Pork drumstick turkey fugiat. Tri-tip elit turducken pork chop in. Swine short ribs meatball irure bacon nulla pork belly cupidatat meatloaf cow.</p>\r\n        <a href=\"#\">Read More &rarr;</a>\r\n      </div>\r\n    </aside>\r\n    <!-- End Sidebar -->\r\n<% end %>\r\n```\r\n\r\nWe can style the \'New Product\' link as button:\r\n\r\n```rhtml\r\n<%= link_to \'New Product\', new_product_path, class: \'button\' %>\r\n```\r\n\r\nChange the value for:\r\n\r\n```css\r\n$grid-column-gutter: 30px;\r\n```\r\nin _settings.scss\r\n\r\nThis will provide the gap on the left for the new product form. You can add tool tip to the price label in the new product form:\r\n\r\n```rhtml\r\n<span data-tooltip aria-haspopup=\"true\" class=\"has-tip\" data-disable-hover=\"false\" tabindex=\"1\" title=\"Price in USD.\">\r\n  <%= f.label :price %>	\r\n</span> \r\n```\r\n\r\nReload the new product page. Now, if you hover over the Price label, you will see the tooltip. You can download the source code for this article form [zurb](https://github.com/bparanj/zurb6 \'zurb foundation\').\r\n\r\n## Summary\r\n\r\nIn this article, you learned how to setup and use Zurb 6 with Rails 5 projects.\r\n\r\n## References\r\n\r\n- [Zurb Top Bar](http://foundation.zurb.com/sites/docs/top-bar.html \'Zurb Top Bar\')\r\n- [Zurb Building Blocks](http://zurb.com/building-blocks \'Zurb Building Blocks\')\r\n','2016-08-09 04:08:33','2016-08-10 03:55:58'),(4281,'nil vs empty vs blank in ruby and rails','<table class=\"table table-striped\"><thead><tr><th>Method</th><th>nil?</th><th>if()</th><th>empty?</th><th>blank?</th><th>present?(!blank)</th><th>any?</th>  </tr></thead><tbody><tr><td>Scope</td><td>Ruby</td><td>Ruby</td><td>Ruby</td><td>Rails</td><td>Rails</td><td>Rails</td></tr><tr> <td>Object</td><td>all</td><td>all</td><td>String, Array, Hash</td><td>all</td><td>all</td><td>Enumerable</td></tr><tr>    <td>nil</td><td>true</td><td>false</td><td>NoMethodError</td><td>true</td><td>false</td><td>NoMethodError</td></tr><tr>    <td>false</td><td>false</td><td>false</td><td>NoMethodError</td><td>true</td><td>false</td><td>NoMethodError</td></tr><tr>    <td>true</td><td>false</td><td>true</td><td>NoMethodError</td><td>false</td><td>true</td><td>NoMethodError</td></tr><tr><td>0</td>    <td>false</td><td>true</td><td>NoMethodError</td><td>false</td><td>true</td><td>NoMethodError</td></tr><tr><td>1</td><td>false</td><td>true</td><td>NoMethodError</td><td>false</td><td>true</td><td>NoMethodError</td></tr><tr><td>\'\"\"\'</td><td>false</td><td>true</td><td>true</td><td>true</td><td>false</td><td>NoMethodError</td></tr><tr><td>\"\"</td><td>false</td><td>true</td><td>false</td><td>true</td><td>false</td><td>NoMethodError</td></tr><tr><td>[]</td><td>false</td><td>true</td><td>true</td><td>true</td><td>false</td><td>false</td></tr><tr><td>[nil]</td><td>false</td><td>true</td><td>false</td><td>false</td><td>true</td><td>false</td></tr><tr><td>{}</td><td>false</td><td>true</td><td>true</td><td>true</td><td>false</td><td>false</td></tr><tr><td>{a:nil}</td><td>false</td><td>true</td><td>false</td><td>false</td><td>true</td><td>true</td></tr></tbody></table>','2016-08-13 10:18:05','2016-08-13 10:18:05'),(4291,'Include vs Joins in Rails 5','Create a new Rails 5 project.\r\n\r\n```\r\nrails new commenter\r\n```\r\n\r\nCreate the user model.\r\n\r\n```\r\nrails g model user name admin:boolean\r\n```\r\n\r\nCreate the comment model.\r\n\r\n```\r\nrails g model comment content:text user:references \r\n```\r\n\r\nDeclare the association in the user model.\r\n\r\n```ruby\r\nclass User < ApplicationRecord\r\n  has_many :comments\r\nend\r\n```\r\n\r\nGenerate the users controller.\r\n\r\n```\r\nrails g controller users index new show edit\r\n```\r\n\r\nIn users/edit.html.erb:\r\n\r\n```rhtml\r\n<%= render \'form\' %>\r\n<p>\r\n  <%= link_to \"Show\", @user %> |\r\n  <%= link_to \"View All\", users_path %>\r\n</p>\r\n```\r\n\r\nIn users/index.html.erb:\r\n\r\n```rhtml\r\n<% for user in @users %>\r\n<p class=\"user\">\r\n  <strong><%= link_to h(user.name), user %></strong>\r\n  <%= \"(admin)\" if user.admin? %><br />\r\n  \r\n  <%= pluralize user.comments.size, \"comment\" %><br />\r\n  \r\n  <%= link_to \"Edit\", edit_user_path(user) %> |\r\n  <%= link_to \"Destroy\", user, :confirm => \'Are you sure?\', :method => :delete %>\r\n</p>\r\n<% end %>\r\n<p><%= link_to \"New User\", new_user_path %></p>\r\n```\r\n\r\nIn users/new.html.erb:\r\n\r\n```rhtml\r\n<%= render \'form\' %>\r\n<p><%= link_to \"Back to List\", users_path %></p>\r\n```\r\n\r\nIn users/show.html.erb:\r\n\r\n```rhtml\r\n<p>\r\n  <strong>Name:</strong>\r\n  <%=h @user.name %>\r\n</p>\r\n<p>\r\n  <strong>Admin:</strong>\r\n  <%=h @user.admin %>\r\n</p>\r\n<p>\r\n  <%= link_to \"Edit\", edit_user_path(@user) %> |\r\n  <%= link_to \"Destroy\", @user, :confirm => \'Are you sure?\', :method => :delete %> |\r\n  <%= link_to \"View All\", users_path %>\r\n</p>\r\n```\r\n\r\nThe layout file:\r\n\r\n```rhtml\r\n<!DOCTYPE html>\r\n<html>\r\n  <head>\r\n    <title>Commenter</title>\r\n    <%= csrf_meta_tags %>\r\n    <%= stylesheet_link_tag    \'application\', media: \'all\', \'data-turbolinks-track\': \'reload\' %>\r\n    <%= javascript_include_tag \'application\', \'data-turbolinks-track\': \'reload\' %>\r\n  </head>\r\n  <body>\r\n    <div id=\"container\">\r\n      <%- flash.each do |name, msg| -%>\r\n        <%= content_tag :div, msg, :id => \"flash_#{name}\" %>\r\n      <%- end -%>\r\n      <%= yield %>\r\n    </div>\r\n  </body>\r\n</html>\r\n```\r\n\r\nThe user form partial:\r\n\r\n```rhtml\r\n<%= form_for @user do |f| %>\r\n  <p>\r\n    <%= f.label :name %><br />\r\n    <%= f.text_field :name %>\r\n  </p>\r\n  <p>\r\n    <%= f.check_box :admin %> <%= f.label :admin %>\r\n  </p>\r\n  <p>\r\n  <p><%= f.submit \"Submit\" %></p>\r\n<% end %>\r\n```\r\n\r\nThe routes.rb:\r\n\r\n```ruby\r\nRails.application.routes.draw do\r\n  resources :users\r\n  resources :comments\r\n  \r\n  root \'comments#index\'\r\nend\r\n```\r\n\r\nMigrate the database:\r\n\r\n```\r\nrails db:migrate\r\n```\r\n\r\nCreate the comments controller:\r\n\r\n```\r\nrails g controller comments index new show edit\r\n```\r\n\r\nIn comments/index.html.erb:\r\n\r\n```rhtml\r\n<%= render @comments %>\r\n<p><%= link_to \"New Comment\", new_comment_path %></p>\r\n```\r\n\r\nIn comments/new.html.erb:\r\n\r\n```rhtml\r\n<%= render \'form\' %>\r\n<p><%= link_to \"Back to List\", comments_path %></p>\r\n```\r\n\r\nIn comments/edit.html.erb:\r\n\r\n```rhtml\r\n<%= render \'form\' %>\r\n<p>\r\n  <%= link_to \"Show\", @comment %> |\r\n  <%= link_to \"View All\", comments_path %>\r\n</p>\r\n```\r\n\r\nIn comment form partial:\r\n\r\n```rhtml\r\n<%= form_for @comment do |f| %>\r\n  <p>\r\n    <%= f.label :content %><br />\r\n    <%= f.text_area :content %>\r\n  </p>\r\n  <p>\r\n    <%= f.label :user_id %><br />\r\n    <%= f.collection_select :user_id, User.all, :id, :name %>\r\n  </p>\r\n  <p><%= f.submit \"Submit\" %></p>\r\n<% end %>\r\n```\r\n\r\nIn comment partial:\r\n\r\n```rhtml\r\n<div class=\"comment\">\r\n  <%= simple_format comment.content %>\r\n  <p class=\"actions\">\r\n    <%= link_to \"edit\", edit_comment_path(comment) %> |\r\n    <%= link_to \"destroy\", comment, :method => :delete, :confirm => \"Are you sure?\" %>\r\n  </p>\r\n</div>\r\n```\r\n\r\nComments controller:\r\n\r\n```ruby\r\nclass CommentsController < ApplicationController\r\n  def index\r\n    @comments = Comment.joins(:user).where(\'users.admin\' => true).order(\'comments.created_at desc\')\r\n  end\r\n  \r\n  def show\r\n    @comment = Comment.find(params[:id])\r\n  end\r\n  \r\n  def new\r\n    @comment = Comment.new\r\n  end\r\n  \r\n  def create\r\n    @comment = Comment.new(comment_params)\r\n    if @comment.save\r\n      flash[:notice] = \"Successfully created comment.\"\r\n      \r\n      redirect_to @comment\r\n    else\r\n      render :new\r\n    end\r\n  end\r\n  \r\n  def edit\r\n    @comment = Comment.find(params[:id])\r\n  end\r\n  \r\n  def update\r\n    @comment = Comment.find(params[:id])\r\n    if @comment.update_attributes(comment_params)\r\n      flash[:notice] = \"Successfully updated comment.\"\r\n    \r\n      redirect_to @comment\r\n    else\r\n      render :edit\r\n    end\r\n  end\r\n  \r\n  def destroy\r\n    @comment = Comment.find(params[:id])\r\n    @comment.destroy\r\n    flash[:notice] = \"Successfully destroyed comment.\"\r\n    \r\n    redirect_to comments_url\r\n  end\r\n  \r\n  private\r\n  \r\n  def comment_params\r\n    params.require(:comment).permit(:content, :user_id)  \r\n  end\r\nend\r\n```\r\n\r\nThe users controller:\r\n\r\n```ruby\r\nclass UsersController < ApplicationController\r\n  def index\r\n    @users = User.joins(:comments).select(\'users.*, count(comments.id) as comments_count\').group(\'users.id\')\r\n  end\r\n  \r\n  def show\r\n    @user = User.find(params[:id])\r\n  end\r\n  \r\n  def new\r\n    @user = User.new\r\n  end\r\n  \r\n  def create\r\n    @user = User.new(user_params)\r\n    if @user.save\r\n      flash[:notice] = \"Successfully created user.\"\r\n    \r\n      redirect_to @user\r\n    else\r\n      render :action => \'new\'\r\n    end\r\n  end\r\n  \r\n  def edit\r\n    @user = User.find(params[:id])\r\n  end\r\n  \r\n  def update\r\n    @user = User.find(params[:id])\r\n    if @user.update_attributes(user_params)\r\n      flash[:notice] = \"Successfully updated user.\"\r\n    \r\n      redirect_to @user\r\n    else\r\n      render :action => \'edit\'\r\n    end\r\n  end\r\n  \r\n  def destroy\r\n    @user = User.find(params[:id])\r\n    @user.destroy\r\n    flash[:notice] = \"Successfully destroyed user.\"\r\n    \r\n    redirect_to users_url\r\n  end\r\n\r\n  private\r\n  \r\n  def user_params\r\n    params.require(:user).permit(:name, :admin)\r\n  end\r\nend\r\n```\r\n\r\nCreate an admin and a non admin user. Create some comments for both users.  Let\'s experiment in the Rails console. \r\n\r\n## Joins\r\n\r\nWe can retrieve all comments in descending order:\r\n\r\n```ruby\r\n>> wise_comments = Comment.order(\'comments.created_at desc\')\r\n  Comment Load (0.4ms)  SELECT \"comments\".* FROM \"comments\" ORDER BY comments.created_at desc\r\n=> #<ActiveRecord::Relation [#<Comment id: 2, content: \"I am a super user.\", user_id: 2, created_at: \"2016-08-13 20:06:41\", updated_at: \"2016-08-13 20:06:41\">, #<Comment id: 1, content: \"This is great!\", user_id: 1, created_at: \"2016-08-13 20:06:06\", updated_at: \"2016-08-13 20:06:06\">]>\r\n```\r\n\r\nThis returns an ActiveRecord::Relation object. We can retrieve the rows by calling the to_a:\r\n\r\n```ruby\r\n>> wise_comments.to_a\r\n=> [#<Comment id: 2, content: \"I am a super user.\", user_id: 2, created_at: \"2016-08-13 20:06:41\", updated_at: \"2016-08-13 20:06:41\">, #<Comment id: 1, content: \"This is great!\", user_id: 1, created_at: \"2016-08-13 20:06:06\", updated_at: \"2016-08-13 20:06:06\">]\r\n```\r\n\r\nWe can retrieve all comments made by an admin user in descending order:\r\n\r\n```ruby\r\n>> Comment.joins(:user).where(\'users.admin\' => true).order(\'comments.created_at desc\')\r\n  Comment Load (0.3ms)  SELECT \"comments\".* FROM \"comments\" INNER JOIN \"users\" ON \"users\".\"id\" = \"comments\".\"user_id\" WHERE \"users\".\"admin\" = ? ORDER BY comments.created_at desc  [[\"admin\", true]]\r\n=> #<ActiveRecord::Relation [#<Comment id: 2, content: \"I am a super user.\", user_id: 2, created_at: \"2016-08-13 20:06:41\", updated_at: \"2016-08-13 20:06:41\">]>\r\n```\r\n\r\nThe joins fired one query that is an inner join of comments and users tables. We can access the user associated with the comment:\r\n\r\n```ruby\r\n>> c.first.user\r\n  User Load (0.2ms)  SELECT  \"users\".* FROM \"users\" WHERE \"users\".\"id\" = ? LIMIT ?  [[\"id\", 2], [\"LIMIT\", 1]]\r\n=> #<User id: 2, name: \"Daffy Duck\", admin: true, created_at: \"2016-08-13 20:02:34\", updated_at: \"2016-08-13 20:02:34\">\r\n```\r\n\r\nYou can see the user was retrieved from the database, there is an additional hit to the database to access the user.\r\n\r\n## Includes\r\n\r\nUse of includes generates a complex SQL query:\r\n\r\n```ruby\r\n>> d = Comment.includes(:user).where(\'users.admin\' => true)\r\n  SQL (0.3ms)  SELECT \"comments\".\"id\" AS t0_r0, \"comments\".\"content\" AS t0_r1, \"comments\".\"user_id\" AS t0_r2, \"comments\".\"created_at\" AS t0_r3, \"comments\".\"updated_at\" AS t0_r4, \"users\".\"id\" AS t1_r0, \"users\".\"name\" AS t1_r1, \"users\".\"admin\" AS t1_r2, \"users\".\"created_at\" AS t1_r3, \"users\".\"updated_at\" AS t1_r4 FROM \"comments\" LEFT OUTER JOIN \"users\" ON \"users\".\"id\" = \"comments\".\"user_id\" WHERE \"users\".\"admin\" = ?  [[\"admin\", true]]\r\n=> #<ActiveRecord::Relation [#<Comment id: 2, content: \"I am a super user.\", user_id: 2, created_at: \"2016-08-13 20:06:41\", updated_at: \"2016-08-13 20:06:41\">]>\r\n>> d.to_a\r\n=> [#<Comment id: 2, content: \"I am a super user.\", user_id: 2, created_at: \"2016-08-13 20:06:41\", updated_at: \"2016-08-13 20:06:41\">]\r\n```\r\n\r\nWhen we access the corresponding user of the comment:\r\n\r\n```ruby\r\n>> d.first.user\r\n=> #<User id: 2, name: \"Daffy Duck\", admin: true, created_at: \"2016-08-13 20:02:34\", updated_at: \"2016-08-13 20:02:34\">\r\n```\r\n\r\nThere is no hit to the database. You can download the source code for this project from [commenter](https://github.com/bparanj/commenter \'commenter\').\r\n\r\n\r\n## Summary\r\n\r\nThe includes eager loads the associations to prevent N+1 queries problem when you know that you need to access the data in the associated model. The joins is used when you don\'t need to access the data in the associated model. So, in this case, you don\'t retrieve them when you get the comments.','2016-08-13 21:38:36','2016-08-26 06:37:55'),(4301,'Site Wide Announcement in Rails using jQuery','Add to application layout file:\r\n\r\n```\r\n<div id=\"announcement\"> Download the <a href=\'https://www.rubyplus.com\'>Top 10 Mistakes Rails Developers</a> Make Now!</div>\r\n```\r\n\r\nAdd the jQuery to hide the announcement after 5 seconds:\r\n\r\n```javascript\r\n$(\'#announcement\').delay(5000).fadeOut(\'slow\');\r\n```\r\n\r\nThe layout file now looks like this:\r\n\r\n```rhtml\r\n<!DOCTYPE html>\r\n<html>\r\n  <head>\r\n    <title>Anc</title>\r\n    <%= csrf_meta_tags %>\r\n    <%= stylesheet_link_tag    \'application\', media: \'all\', \'data-turbolinks-track\': \'reload\' %>\r\n    <%= javascript_include_tag \'application\', \'data-turbolinks-track\': \'reload\' %>\r\n  </head>\r\n  <body>\r\n	<div id=\"announcement\"> Download the <a href=\'https://www.rubyplus.com\'>Top 10 Mistakes Rails Developers</a> Make Now!</div>\r\n    <%= yield %>\r\n	<script type=\'text/javascript\'>\r\n	   $(\'#announcement\').delay(5000).fadeOut(\'slow\');\r\n	</script>\r\n  </body>\r\n</html>\r\n```\r\n\r\nFor Twitter Bootstrap 4, you can use this:\r\n\r\n```html\r\n<div class=\"alert alert-info\" id=\'announcement\'>\r\n   Subscribe to the free <a href=\'https://itunes.apple.com/us/podcast/rails-screencast/id1142573687\'>Rails Screencasts </a> Now!\r\n</div>\r\n```\r\n\r\nStart the server and go to: `http://localhost:3000/welcome/index` to see the announcement. It will disappear after 5 seconds.\r\n\r\nIf you get:\r\n\r\n```\r\n$ is not defined\r\n```\r\n\r\nerror in the javascript console of the developer tool, change the javascript in the layout like this:\r\n\r\n```javascript\r\n  <script type=\'text/javascript\'>\r\n	jQuery(document).ready(function($) {\r\n	  $(\'#announcement\').delay(5000).fadeOut(\'slow\');  \r\n	});  \r\n  </script>\r\n```','2016-08-16 03:32:12','2016-08-16 07:13:27'),(4311,'Securing an API in Rails 5 using Token Based Authentication','The user can login by providing a valid email and password. In this article, we will use Curl command that sends the user credentials in plain text format. In a real project, this will be sent over a SSL connection. Create a user model that has token for Token based authentication and `password_digest` for storing login password field. The `password_digest` is required for `has_secure_password` method provided by Rails. It adds methods to set and authenticate against a BCrypt password.\r\n\r\n```\r\nrails g model user name token email password_digest\r\n```\r\n\r\nAdd the index for the token field in the migration.\r\n\r\n```ruby\r\nadd_index :users, :token\r\n```\r\n\r\nDeclare `has_secure_password` in the user model.\r\n\r\n```ruby\r\nclass User < ApplicationRecord\r\n  has_secure_password\r\nend\r\n```\r\n\r\nWe need to install bcrypt gem to use the `has_secure_password` Rails builtin functionality for storing encrypted passwords in our database. It also provides `authenticate` method to check if the password provided by the user is correct. Add the bcrypt gem to Gemfile.\r\n\r\n```ruby\r\ngem \'bcrypt\'\r\n```\r\n\r\nRun bundle install. This will install bcrypt gem version 3.1.11. Create some sample records in seeds.rb. \r\n\r\n```ruby\r\nUser.destroy_all\r\nUser.create(name: \'bugs\', email: \'bugs@rubyplus.com\', password: \'123456\')\r\nUser.create(name: \'daffy\', email: \'daffy@rubyplus.com\', password: \'123456\')\r\n```\r\n\r\nRun the migration and populate the database.\r\n\r\n```\r\nrails db:migrate\r\nrails db:seed\r\n```\r\n\r\n## Login User\r\n\r\nLet\'s implement login functionality. When a user successfully logs in, we will return token otherwise we will return error in json format. This token will be used in subsequent calls to access the protected API endpoints. When the user logs out, the token will become invalid and no further calls to the protected endpoints can use the expired token. When a user logs in again, a new token will be generated. Let\'s create a controller that holds all the API related functionality.\r\n\r\n```\r\nrails g controller api\r\n```\r\n\r\nThe code for the `api_controller` is as shown below:\r\n\r\n```ruby\r\nclass ApiController < ActionController::Base\r\n  def require_login\r\n    authenticate_token || render_unauthorized(\"Access denied\")\r\n  end\r\n      \r\n  def current_user\r\n    @current_user ||= authenticate_token\r\n  end\r\n  \r\n  protected\r\n  \r\n  def render_unauthorized(message)\r\n    errors = { errors: [ { detail: message } ] }\r\n    render json: errors, status: :unauthorized\r\n  end\r\n  \r\n  private\r\n  \r\n  def authenticate_token\r\n    authenticate_with_http_token do |token, options|\r\n      User.find_by(token: token)\r\n    end\r\n  end  \r\nend\r\n```\r\n\r\nThe `authenticate_with_http_token` takes the token provided in the header of the http request and makes it available in the `token` block variable. We ignore the `options` block variable, since we don\'t need it. Create a sessions controller that inherits from the ApiController.\r\n\r\n```ruby\r\nclass SessionsController < ApiController\r\n  skip_before_action :require_login, only: [:create], raise: false\r\n\r\n  def create\r\n    if user = User.valid_login?(params[:email], params[:password])\r\n      allow_token_to_be_used_only_once_for(user)\r\n      send_auth_token_for_valid_login_of(user)\r\n    else\r\n      render_unauthorized(\"Error with your login or password\")\r\n    end\r\n  end\r\n\r\n  def destroy\r\n    logout\r\n    head :ok\r\n  end\r\n\r\n  private\r\n  \r\n  def send_auth_token_for_valid_login_of(user)\r\n    render json: { token: user.token }\r\n  end\r\n  \r\n  def allow_token_to_be_used_only_once_for(user)\r\n    user.regenerate_token\r\n  end\r\n  \r\n  def logout\r\n    current_user.invalidate_token\r\n  end\r\nend\r\n```\r\n\r\nIn Rails 5, we need to use the `raise: false` in `skip_before_action` filter to return boolean instead of raising an exception. The user model is as shown below.\r\n\r\n```ruby\r\nclass User < ApplicationRecord\r\n  has_secure_password\r\n  has_secure_token\r\n  \r\n  # This method is not available in has_secure_token\r\n  def invalidate_token\r\n    self.update_columns(token: nil)\r\n  end\r\n  \r\n  def self.valid_login?(email, password)\r\n    user = find_by(email: email)\r\n    if user && user.authenticate(password)\r\n      user\r\n    end\r\n  end\r\nend\r\n```\r\n\r\nThe `invalidate_token` method is required to expire an user\'s token. It should have been part of the `has_secure_token` functionality. Unfortunately, we have to implement it. The `has_secure_token` by default expects `token` column in the users table. We can customize it by providing it as an argument to the `has_secure_token` method:\r\n\r\n```ruby\r\nhas_secure_token :auth_token\r\n```\r\n\r\nWe are using `has_secure_token` to use the Rails builtin functionality to create unique tokens. Define the routes to handle the API protected endpoints and the login/logout functionality. We only allow the json format request by specifying the format in the constraints option.\r\n\r\n```ruby\r\nRails.application.routes.draw do\r\n  get \'hacker_spots/index\'\r\n\r\n  scope :format => true, :constraints => { :format => \'json\' } do\r\n    post   \"/login\"       => \"sessions#create\"\r\n    delete \"/logout\"      => \"sessions#destroy\"\r\n  end\r\nend\r\n```\r\n\r\nThe protected endpoint is a simple implementation that returns a json structure.\r\n\r\n```ruby\r\nclass HackerSpotsController < ApiController\r\n  before_action :require_login\r\n  \r\n  # This is protected by API token\r\n  def index\r\n    render json: { spots: \'List of places to work in coffee shops\'}\r\n  end\r\nend\r\n```\r\n\r\nThe `before_action` filter enforces the login requirement. The `require_login` is implemented in the ApiController. Here is the list of Curl commands to test the API from a terminal.\r\n\r\n### Initial Authorization\r\n\r\n```\r\ncurl -X POST --data \"email=bugs@rubyplus.com&password=123456\" http://localhost:3010/login.json\r\n```\r\n\r\n### Incorrect Login Credentials\r\n\r\n```\r\ncurl -X POST --data \"email=bugs@rubyplus.com&password=123\" http://localhost:3010/login.json\r\n```\r\n\r\n### Protected API Calls\r\n\r\n```\r\ncurl -H \"Authorization: Token token=aQNeG5FtnrgU49eC42mShNjX\" http://localhost:3010/hacker_spots/index.json\r\n```\r\n\r\n### Sign out\r\n\r\n```\r\ncurl -X DELETE -H \"Authorization: Token token=aQNeG5FtnrgU49eC42mShNjX\" http://localhost:3010/logout.json\r\n```\r\n\r\nTo mitigate timing attacks, change the API controller as follows:\r\n\r\n```ruby\r\ndef authenticate_token\r\n  authenticate_with_http_token do |token, options|\r\n    # Compare the tokens in a time-constant manner, to mitigate timing attacks.\r\n    if user = User.find_by(token: token)\r\n      ActiveSupport::SecurityUtils.secure_compare(\r\n                      ::Digest::SHA256.hexdigest(token),\r\n                      ::Digest::SHA256.hexdigest(user.token))\r\n      user\r\n    end\r\n  end\r\nend  \r\n```\r\n\r\n## Expiration of Tokens\r\n\r\nWe can expire the tokens to time out the inactive login sessions and force the client to login again. Add a `token_created_at` field to users table.\r\n\r\n```\r\n$ rails g migration add_token_created_at_to_users token_created_at:datetime\r\n```\r\n\r\nAdd compound index to the generated migration:\r\n\r\n```ruby\r\nclass AddTokenCreatedAtToUsers < ActiveRecord::Migration[5.0]\r\n  def change\r\n    add_column :users, :token_created_at, :datetime\r\n    remove_index :users, :token\r\n    add_index :users, [:token, :token_created_at]\r\n  end\r\nend\r\n```\r\n\r\nRun the migration.\r\n\r\n```\r\nrails db:migrate\r\n```\r\n\r\nWe need to update the `token_created_at` attribute when we create and destroy tokens. In Api controller, call the `with_unexpired_token` User class method:\r\n\r\n```ruby\r\ndef authenticate_token\r\n  authenticate_with_http_token do |token, options|\r\n    if user = User.with_unexpired_token(token, 2.days.ago)\r\n      # Compare the tokens in a time-constant manner, to mitigate timing attacks.\r\n      ActiveSupport::SecurityUtils.secure_compare(\r\n                      ::Digest::SHA256.hexdigest(token),\r\n                      ::Digest::SHA256.hexdigest(user.token))\r\n      user\r\n    end\r\n  end\r\nend  \r\n```\r\n\r\nIn user model, implement `with_unexpired_token` method. The complete source code for user is as follows:\r\n\r\n```ruby\r\nclass User < ApplicationRecord\r\n  has_secure_password\r\n  has_secure_token\r\n    \r\n  def self.valid_login?(email, password)\r\n    user = find_by(email: email)\r\n    if user && user.authenticate(password)\r\n      user\r\n    end\r\n  end\r\n  \r\n  def allow_token_to_be_used_only_once\r\n    regenerate_token\r\n    touch(:token_created_at)\r\n  end\r\n  \r\n  def logout\r\n    invalidate_token\r\n  end\r\n  \r\n  def with_unexpired_token(token, period)\r\n    where(token: token).where(\'token_created_at >= ?\', period).first\r\n  end\r\n  \r\n  private\r\n  \r\n  # This method is not available in has_secure_token\r\n  def invalidate_token\r\n    update_columns(token: nil)\r\n    touch(:token_created_at)\r\n  end\r\nend\r\n```\r\n\r\nThe touch method updates the timestamp of the `token_created_at` attribute in the users table. **Tip**: Use -I switch in Curl to view the http response headers.\r\n\r\nThe refactored sessions controller is shown below:\r\n\r\n```ruby\r\nclass SessionsController < ApiController\r\n  skip_before_action :require_login, only: [:create], raise: false\r\n\r\n  def create\r\n    if user = User.valid_login?(params[:email], params[:password])\r\n      user.allow_token_to_be_used_only_once\r\n      send_auth_token_for_valid_login_of(user)\r\n    else\r\n      render_unauthorized(\"Error with your login or password\")\r\n    end\r\n  end\r\n\r\n  def destroy\r\n    current_user.logout\r\n    head :ok\r\n  end\r\n\r\n  private\r\n  \r\n  def send_auth_token_for_valid_login_of(user)\r\n    render json: { token: user.token }\r\n  end\r\nend\r\n```\r\n\r\nYou can download the source code for this article from [tokie](https://github.com/bparanj/tokie \'Token Based API authentication\').\r\n\r\n## Feedback from Github User jaeming\r\n\r\nI was checking out the related tutorial for this and found an error in the migration:\r\n\r\n```ruby\r\nadd_index :users, :token\r\n```\r\n\r\nThis doesn\'t make sense as indexing foreign keys can only happen between two different tables. You would not index a column to a table to which it already belongs. In other words, you\'d only do something like this if Token was a separate table.\r\n\r\nIf you switch your db to postgres you\'ll get an error while trying to migrate:\r\n\r\n```\r\nPG::UndefinedTable: ERROR:  relation \"users\" does not exist\r\n: CREATE  INDEX  \"index_users_on_token\" ON \"users\"  (\"token\")\r\nThe reason it work in SQLite is because SQLite basically ignores foreign keys.\r\n````\r\n\r\nReferences\r\n============\r\n\r\n- [Mitigate Timing Attacks](http://api.rubyonrails.org/classes/ActionController/HttpAuthentication/Token.html \'Rails Token Authentication\')\r\n- [Token Based Authentication Rails](https://www.codeschool.com/blog/2014/02/03/token-based-authentication-rails/ \'Token Based Authentication Rails\')\r\n- [Rails 5 Security Utils](https://github.com/rails/rails/blob/92703a9ea5d8b96f30e0b706b801c9185ef14f0e/activesupport/lib/active_support/security_utils.rb \'Rails 5 Security Utils\')\r\n- [has secure token in Rails 5](http://api.rubyonrails.org/classes/ActiveRecord/SecureToken/ClassMethods.html \'has_secure_token in Rails 5\')\r\n- [has secure password in Rails 5](http://api.rubyonrails.org/classes/ActiveModel/SecurePassword/ClassMethods.html \'has_secure_password in Rails 5\')\r\n- [Rack Middleware for Blocking and Throttling](https://github.com/kickstarter/rack-attack \'Rack Middleware for Blocking and Throttling\')','2016-12-06 05:17:24','2017-02-11 00:16:06'),(4321,'YAML Configuration File in Rails 5','\r\nRemove Spring from Rails 5.\r\n\r\n```\r\nbin/spring binstub --remove --all\r\n```\r\n\r\nCreate a article model with name, content and `published_on` fields. Migrate the database.\r\n```\r\nrails g model article name content:text published_on:date\r\nrails db:migrate\r\n```\r\n\r\nCopy the sample data to seeds.rb.\r\n\r\n```ruby\r\nbatman = Article.create! name: \"Batman\", content: <<-ARTICLE\r\nBatman is a fictional character created by the artist Bob Kane and writer Bill Finger. A comic book superhero, Batman first appeared in Detective Comics #27 (May 1939), and since then has appeared primarily in publications by DC Comics. Originally referred to as \"The Bat-Man\" and still referred to at times as \"The Batman\", he is additionally known as \"The Caped Crusader\", \"The Dark Knight\", and the \"World\'s Greatest Detective,\" among other titles. (from Railscast)\r\nARTICLE\r\n\r\nsuperman = Article.create! name: \"Superman\", content: <<-ARTICLE\r\nSuperman is a fictional comic book superhero appearing in publications by DC Comics, widely considered to be an American cultural icon. Created by American writer Jerry Siegel and Canadian-born American artist Joe Shuster in 1932 while both were living in Cleveland, Ohio, and sold to Detective Comics, Inc. (later DC Comics) in 1938, the character first appeared in Action Comics #1 (June 1938) and subsequently appeared in various radio serials, television programs, films, newspaper strips, and video games. (from Wikipedia)\r\nARTICLE\r\n\r\nkrypton = Article.create! name: \"Krypton\", content: <<-ARTICLE\r\nKrypton is a fictional planet in the DC Comics universe, and the native world of the super-heroes Superman and, in some tellings, Supergirl and Krypto the Superdog. Krypton has been portrayed consistently as having been destroyed just after Superman\'s flight from the planet, with exact details of its destruction varying by time period, writers and franchise. Kryptonians were the dominant people of Krypton. (from Wikipedia)\r\nARTICLE\r\n\r\nlex_luthor = Article.create! name: \"Lex Luthor\", content: <<-ARTICLE\r\nLex Luthor is a fictional character, a supervillain who appears in comic books published by DC Comics. He is the archenemy of Superman, and is also a major adversary of Batman and other superheroes in the DC Universe. Created by Jerry Siegel and Joe Shuster, he first appeared in Action Comics #23 (April 1940). Luthor is described as \"a power-mad, evil scientist\" of high intelligence and incredible technological prowess. (from Wikipedia)\r\nARTICLE\r\n\r\nrobin = Article.create! name: \"Robin\", content: <<-ARTICLE\r\nRobin is the name of several fictional characters appearing in comic books published by DC Comics, originally created by Bob Kane, Bill Finger and Jerry Robinson, as a junior counterpart to DC Comics superhero Batman. The team of Batman and Robin is commonly referred to as the Dynamic Duo or the Caped Crusaders. (from Wikipedia)\r\nARTICLE\r\n```\r\n\r\nPopulate the database.\r\n\r\n```\r\nrails db:seed\r\n```\r\n\r\nCreate articles controller.\r\n\r\n```\r\nrails g controller articles\r\n```\r\n\r\nThe articles controller uses http basic authentication to restrict edit and destroy of article. It hard codes the user name and password.\r\n\r\n```ruby\r\nclass ArticlesController < ApplicationController\r\n  http_basic_authenticate_with name: \"admin\", password: \"secret\",\r\n                               except: [:index, :show]\r\n\r\n  def index\r\n    @articles = Article.all\r\n  end\r\n\r\n  def show\r\n    @article = Article.find(params[:id])\r\n  end\r\n\r\n  def new\r\n    @article = Article.new\r\n  end\r\n\r\n  def create\r\n    @article = Article.new(allowed_params)\r\n    if @article.save\r\n      redirect_to @article, notice: \"Created article.\"\r\n    else\r\n      render :new\r\n    end\r\n  end\r\n\r\n  def edit\r\n    @article = Article.find(params[:id])\r\n  end\r\n\r\n  def update\r\n    @article = Article.find(params[:id])\r\n    if @article.update_attributes(allowed_params)\r\n      redirect_to @article, notice: \"Updated article.\"\r\n    else\r\n      render :edit\r\n    end\r\n  end\r\n  \r\n  private\r\n  def allowed_params\r\n    params.require(:article).permit(:name, :published_on, :content)\r\n  end\r\nend\r\n```\r\n\r\nThe body of the layout file is as shown below:\r\n\r\n```rhtml\r\n<body>\r\n  <div id=\"container\">\r\n    <% flash.each do |name, msg| %>\r\n      <%= content_tag :div, msg, id: \"flash_#{name}\" %>\r\n    <% end %>\r\n    <%= yield %>\r\n  </div>\r\n</body>\r\n```\r\n\r\nViews are straight forward. Define the rerouces in routes.rb.\r\n\r\n```ruby\r\nresources :articles\r\nroot to: \'articles#index\'\r\n```\r\n\r\nWe can move the hard-coded http basic authentication credentials to the secrets.yml file:\r\n\r\n```ruby\r\ndevelopment:\r\n  secret_key_base: very-long-string\r\n  http_basic_user: test\r\n  http_basic_password: best\r\n```\r\n\r\nWe can then access the values in secrets.yml in the rails console as follows:\r\n\r\n```ruby  \r\n> Rails.application.secrets\r\n => {:secret_key_base=>\"7ae70512d6dcc17f8ea22e057925e9c0d8a4074a75742c6a590ffaba2778034d0be796b42b0ab9bc3b2f5237a3bfa332cd0bbf8fd9760b9ff2885f1f4fb40902\", :http_basic_user=>\"test\", :http_basic_password=>\"test\", :secret_token=>nil}\r\n> Rails.application.secrets.http_basic_user\r\n => \"test\"\r\n> Rails.application.secrets.http_basic_password\r\n => \"best\"\r\n```\r\n\r\nAdd secrets.yml to .gitignore file to prevent checking it in to source control.\r\n\r\n```\r\necho config/secrets.yml >> .gitignore\r\n```\r\n\r\nReplace the controller hard-coded values with the values from secrets file:\r\n\r\n```ruby\r\nhttp_basic_authenticate_with name: Rails.application.secrets.http_basic_user, \r\n							 password: Rails.application.secrets.http_basic_password,\r\n                             except: [:index, :show]\r\n```\r\n\r\nMake your code immune to future changes of Rails. Create credentials.rb in lib folder and define methods that wrap the knowledge about accessing the credentials into methods as shown below:\r\n\r\n```ruby\r\nclass Credential\r\n  def self.http_basic_user\r\n    Rails.application.secrets.http_basic_user\r\n  end\r\n \r\n  def self.http_basic_password\r\n    Rails.application.secrets.http_basic_password\r\n  end\r\nend\r\n```\r\n\r\nWe now have localized the changes to one file, any future Rails backward incompatible API changes will not cause changes to multiple files in our application. This is crucial when your application becomes big. In application.rb, add the lib folder to the autoload paths:\r\n\r\n```ruby\r\nconfig.autoload_paths << Rails.root.join(\'lib\')\r\n```\r\n\r\nYou can now use the utility methods defined in the Credential class.\r\n\r\n```ruby\r\nhttp_basic_authenticate_with name: Credential.http_basic_user, \r\n							 password: Credential.http_basic_password,\r\n                             except: [:index, :show]\r\n```\r\n\r\nWhat if you want to create a separate yml file for a given functionality? Let\'s say credit card processing, create config/stripe.yml and specify the `api_key` and `api_secret`:\r\n\r\n```yaml\r\ndevelopment:\r\n  api_key: 12345\r\n  api_secret: 6789\r\ntest:\r\n  api_key: 12345\r\n  api_secret: 6789\r\nproduction:\r\n  api_key: <%= ENV[\"STRIPE_API_KEY\"] %>\r\n  api_secret: <%= ENV[\"STRIPE_API_SECRET\"] %>\r\n```\r\n\r\nWe can now access the values in the Rails console like this:\r\n \r\n``` ruby\r\n> stripe_config = Rails.application.config_for(:stripe)\r\n => {\"api_key\"=>12345, \"api_secret\"=>6789}\r\n> Rails.application.config.x.stripe.api_key = stripe_config[\'api_key\']\r\n => 12345\r\n> Rails.application.config.x.stripe.api_secret = stripe_config[\'api_secret\']\r\n => 6789\r\n> Rails.application.config.x.stripe.api_key\r\n => 12345\r\n> Rails.application.config.x.stripe.api_secret\r\n => 6789\r\n```\r\n \r\nCreate config/initializers/stripe.rb to read the Stripe credentials once when the application boots up.\r\n\r\n```ruby\r\nSTRIPE_CONFIG = Rails.application.config_for(:stripe)\r\n```\r\n\r\nThis reads the credential values in the stripe.yml for the current Rails environment. We can add the new methods to retrieve the Stripe credentials in the Credential class.\r\n\r\n```ruby\r\ndef self.stripe_api_key\r\n  STRIPE_CONFIG[\'api_key\']\r\nend\r\n\r\ndef self.stripe_api_secret\r\n  STRIPE_CONFIG[\'api_secret\']\r\nend\r\n```\r\n\r\nYou can now access the Stripe credentials in your code like this:\r\n\r\n```ruby\r\n> Credential.stripe_api_key\r\n => 12345\r\n> Credential.stripe_api_secret\r\n => 6789\r\n```\r\n\r\nAdd the stripe.yml to the .gitignore file. You can create a sample, stripe.yml.sample to provide a template for other developers in your team to use. How do we handle the credentials in the production environment? You can either set the environment variable or use something enterprisey like [zookeeper](https://zookeeper.apache.org/ \'Apache Zookeeper\'). You can download the source code for this project from [ycon](https://github.com/bparanj/ycon \'YAML Configuration file in Rails 5\').','2016-12-07 05:24:11','2016-12-07 05:26:43'),(4331,'Basics of Webpack','Rails 5.1 will support Webpack. [Webpacker](https://github.com/rails/webpacker \'Webpacker\') uses Webpack to manage app-like JavaScript modules in Rails. It\'s time to learn the basics of Webpack.\r\n\r\n## What is Webpack?\r\n\r\nWebpack is a tool to build JavaScript modules in your application. \r\n\r\n## Why Webpack?\r\n\r\nBundlers take assets, such as JavaScript files in, and then transform them into format that\'s suitable for the browser of the end user to consume. This process of bundling happens to be one of the most important problems in web development and solving it well you can remove a large part of pain from the process. \r\n\r\n## Installation\r\n\r\nInstall the latest version of [NodeJS](https://nodejs.org \'NodeJS\'). Open a new terminal and check the NodeJS version:\r\n\r\n```\r\n$ node -v\r\nv7.2.1\r\n```\r\nInstall webpack locally.\r\n\r\n```\r\nnpm install webpack --save-dev\r\n```\r\n\r\nTo view the help:\r\n\r\n```\r\nwebpack --help\r\n```\r\n\r\nFor a simple webpack tutorial, see the link in the references section below.\r\n\r\nReferences\r\n============\r\n\r\n[Webpack Getting Started](https://webpack.js.org/get-started/ \'Webpack Getting Started\')\r\n[Why Webpack](https://webpack.js.org/get-started/why-webpack \'Why Webpack\')\r\n[Simple webpack tutorial](http://www.edc4it.com/blog/web/webpack-tutorial.html \'Simple webpack tutorial\')','2016-12-11 05:33:23','2016-12-11 05:33:23'),(4341,'Twitter Share and Follow Buttons in Rails 5 App','## Tweet Button to Share Content\r\n\r\nYou can implement and go live in just 5 minutes. In the view, add the Tweet button code shown below:\r\n\r\n```rhtml\r\n <div class=\"social\">\r\n      <a href=\"http://twitter.com/share\" class=\"twitter-share-button\" data-url=\"<%= episode_url(@episode) %>\" data-text=\"Watching <%= @episode.title %> on RubyPlus\" data-count=\"horizontal\" data-via=\"ruby_plus\">Tweet</a><script type=\"text/javascript\" src=\"https://platform.twitter.com/widgets.js\"></script>\r\n    </div>\r\n```\r\n\r\nThe data-via value should be the name of your Twitter account. The data-url is the show page for article or episode in my case. The data-text value can be any text. In this case, it displays:\r\n\r\nWatching Securing an API using Token Based Authentication in Rails 5 on RubyPlus followed by the link to the episode and the Twitter account handle. Watch it in action, by clicking this link: [Securing an API in Rails 5](https://rubyplus.com/episodes/191-Securing-an-API-using-Token-Based-Authentication-in-Rails-5 \'Securing an API in Rails 5\').\r\n\r\n## Twitter Follow Button\r\n\r\nYou need to provide the class twitter-follow-button for Twitter javascript to recognize the html. Replace @ruby_plus with your Twitter handle name and the link to your Twitter account in the href tag. \r\n\r\n```rhtml\r\n<a href=\"https://twitter.com/ruby_plus\" class=\"twitter-follow-button\">Follow @ruby_plus</a><script async src=\"//platform.twitter.com/widgets.js\" charset=\"utf-8\"></script>\r\n```\r\n\r\nYou can see this in action in the [about](https://rubyplus.com/about \'About\') page.\r\n\r\n','2016-12-11 06:42:28','2016-12-12 02:11:19'),(4351,'Author and Canonical Link for SEO in Rails Apps','## Introduction\r\n\r\nIn this article we will add the author meta tag and canonical link for article. You can read the articles in the references section at the end of this article to learn why we need them. The first 100 articles or so on rubyplus.com used only integer in the URL for showing an article, I later made the URL use permalink to make it easy for me to identify which articles is most popular when I saw the Google Analytics. The most popular articles became screencasts. \r\n\r\n## Implementation for Rails\r\n\r\nIn articles/show.html.erb, provide the value for the author meta tag and canonical link as follows:\r\n\r\n```rhtml\r\n<%= content_for(:meta_author, \'Bala Paranj\') %>\r\n<%= content_for(:canonical_link, article_url(@article)) %>\r\n\r\n<article>\r\n<h1 class=\"content-header\"><%= @article.title %></h1>\r\n  <div class=\"byline\">\r\n      <address class=\"author\">By <a rel=\"author\" href=\"/about\">Bala Paranj</a></address><time pubdate datetime=\"<%= published_date(@article) %>\" title=\"<%= published_date(@article) %>\"> <%= published_date(@article) %>  </time>\r\n  </div>          \r\n</div>\r\n\r\n...\r\n\r\n</article>\r\n```\r\n\r\nEach article is wrapped within article html tag. Also the header must have header tag. I have not used header tag above due to styling issues in my app. In application layout file:\r\n\r\n```rhtml\r\n<% if yield(:meta_author).present? %>\r\n  <meta name=\"author\" content=\"Bala Paranj\" />\r\n<% end %>\r\n\r\n<% if yield(:canonical_link).present? %>\r\n  <link rel=\"canonical\" href=\"<%= yield(:canonical_link) %>\" >\r\n<% end %>\r\n```\r\n\r\n## References\r\n\r\n[Dynamic SEO Title and Meta Tags in Rails](http://www.rymcmahon.com/articles/1 \'Dynamic SEO Title and Meta Tags in Rails\')\r\n[Canonical Link](https://yoast.com/rel-canonical/ \'Canonical Link\')\r\n[HTML 5 Tags to Use for Author Name](http://stackoverflow.com/questions/7290504/which-html5-tag-should-i-use-to-mark-up-an-author-s-name \'HTML 5 Tags to Use for Author Name\')\r\n[Microformats](http://microformats.org/wiki/hcard \'Microformats\')\r\n','2016-12-26 02:59:40','2016-12-26 03:02:29'),(4361,'GraphQL in Rails 5','## Introduction\r\n\r\nWe will first write a simple Hello GraphQL World program using graphql gem. We will then see an ActiveRecord example, a model with a self-reflexive association: person has many friends relationship. Working with GraphQL involves three steps:\r\n\r\n- Define some types\r\n- Connect them to a schema\r\n- Execute queries with your schema\r\n\r\n## Hello GraphQL in Ruby\r\n\r\nThe simple Hello GraphQL stolen from the graphql gem home page:\r\n\r\n```ruby\r\n# Define some types\r\nQueryType = GraphQL::ObjectType.define do\r\n  name \'Query\'\r\n  field :hello do\r\n    type types.String\r\n    resolve -> (obj, args, ctx) { \'Hello GraphQL\' }\r\n  end\r\nend\r\n\r\n# Connect them to a schema\r\nSchema = GraphQL::Schema.define do\r\n  query QueryType\r\nend\r\n\r\n# Execute queries with your schema\r\nputs Schema.execute(\'{ hello }\')\r\n```\r\nYou can run this from a IRB or rails console. You must have installed the graphql gem. We first define a query type, QueryType. We then connect them to a schema, by calling the `GraphQL::Schema.define` method. We then execute the query with our schema by calling the `execute` class method in Schema class.\r\n\r\n## GraphQL with ActiveRecord in Rails 5\r\n\r\n### Initial Setup\r\n\r\nDefine the following gems in the Gemfile and run bundle install.\r\n\r\n```ruby\r\ngem \"graphql\"\r\ngem \"graphiql-rails\"\r\n```\r\n\r\nMount the GraphiQL Rails engine in routes.rb:\r\n\r\n```ruby\r\npost \'/graphql\', to: \'graphql#query\'\r\nif Rails.env.development?\r\n  mount GraphiQL::Rails::Engine, at: \"/graphiql\", graphql_path: \"/graphql\"\r\nend\r\n```\r\n\r\nCreate the model and the migration.\r\n\r\n```\r\nrails g model people first_name last_name email username\r\nrails g migration create_friendships person:references friend:references\r\n```\r\n\r\nAdd data to play with in seeds.rb:\r\n\r\n```ruby\r\nme = Person.create(first_name: \'Steven\', last_name: \'Luscher\', email: \'steveluscher@fb.com\', username: \'steveluscher\')\r\ndhh = Person.create(first_name: \'David\', last_name: \'Heinemeier Hansson\', email: \'dhh@37signals.com\', username: \'dhh\')\r\nezra = Person.create(first_name: \'Ezra\', last_name: \'Zygmuntowicz\', email: \'ezra@merbivore.com\', username: \'ezra\')\r\nmatz = Person.create(first_name: \'Yukihiro\', last_name: \'Matsumoto\', email: \'matz@heroku.com\', username: \'matz\')\r\nme.friends << [matz]\r\ndhh.friends << [ezra, matz]\r\nezra.friends << [dhh, matz]\r\nmatz.friends << [me, ezra, dhh]\r\n```\r\n\r\nDefine the friendships relationship in the Person model.\r\n\r\n```ruby\r\nclass Person < ApplicationRecord\r\n  has_and_belongs_to_many :friends,\r\n    class_name: \'Person\',\r\n    join_table: :friendships,\r\n    foreign_key: :person_id,\r\n    association_foreign_key: :friend_id  \r\nend\r\n```\r\n\r\nRun the migration and seed the database. Create app/serializers/person_serializer.rb:\r\n\r\n```ruby\r\nclass PersonSerializer < ActiveModel::Serializer\r\n  attributes :id, :first_name, :last_name, :email, :username, :friends\r\n  def id\r\n    object.id.to_s\r\n  end\r\n  def friends\r\n    object.friend_ids.map do |id|\r\n      Rails.application.routes.url_helpers.person_path(id)\r\n    end\r\n  end\r\nend\r\n```\r\n\r\nCreate the controller.\r\n\r\n```\r\nrails g controller people \r\n```\r\n\r\nRender json in the controller as follows:\r\n\r\n```ruby\r\nclass PeopleController < ApplicationController\r\n  def index\r\n    render json: Person.all\r\n  end\r\n  def show\r\n    render json: Person.find(params[:id])\r\n  end\r\nend\r\n```\r\n\r\nThis controller is just to see the JSON in the browser, not related to GraphQL. Define the people resource in the routes.rb.\r\n\r\n```ruby\r\nresources :people, :only => [:index, :show]\r\n```\r\n\r\nYou can now see the JSON output of the data by browsing to `localhost:3000/people` to view all records and `localhost:3000/people/1` to view a specific record. This shows all the attributes. Beauty of GraphQL is you need only one endpoint to retrieve only the data you need. Let\'s now use GraphQL.\r\n\r\n#### Step 1\r\n\r\nCreate schema.rb in model directory to define some types:\r\n\r\n```ruby\r\nPersonType = GraphQL::ObjectType.define do\r\n  name \'Person\'\r\n  description \'Somebody to lean on\'\r\n\r\n  field :id, !types.ID\r\n  field :firstName, !types.String, property: :first_name\r\n  field :lastName, !types.String, property: :last_name\r\n  field :email, !types.String, \'Like a phone number, but spammier\'\r\n  field :username, !types.String, \'Use this to log in to your computer\'\r\n  field :friends, -> { types[PersonType] }, \'Some people to lean on\'\r\n  field :fullName do\r\n    type !types.String\r\n    description \'Every name, all at once\'\r\n    resolve -> (obj, args, ctx) { \"#{obj.first_name} #{obj.last_name}\" }\r\n  end\r\nend\r\n\r\nQueryType = GraphQL::ObjectType.define do\r\n  name \'Query\'\r\n  description \'The root of all queries\'\r\n\r\n  field :allPeople do\r\n    type types[PersonType]\r\n    description \'Everyone in the Universe\'\r\n    resolve -> (obj, args, ctx) { Person.all }\r\n  end\r\n  field :person do\r\n    type PersonType\r\n    description \'The person associated with a given ID\'\r\n    argument :id, !types.ID\r\n    resolve -> (obj, args, ctx) { Person.find(args[:id]) }\r\n  end\r\nend\r\n```\r\n\r\n#### Step 2\r\n\r\nIn schema.rb, connect them to a schema:\r\n\r\n```ruby\r\nSchema = GraphQL::Schema.define do\r\n  query QueryType\r\nend\r\n```\r\n\r\n#### Step 3\r\n\r\nExecute queries with your schema in the controller.\r\n\r\n```ruby\r\nclass GraphqlController < ApplicationController\r\n  skip_before_filter :verify_authenticity_token\r\n\r\n  def query\r\n    # 3. Execute queries with your schema\r\n    result = Schema.execute(params[:query], variables: params[:variables])\r\n    render json: result\r\n  end\r\nend\r\n```\r\n \r\nYou can now go to `http://localhost:3000/graphiql` on your browser to send the graphql queries to the server. The browser will have autocomplete to help you create the queries to send to the server. You will see the JSON response from the server, served by GraphqlController.\r\n\r\n## References\r\n\r\n[Getting Started with Rails GraphQL Relay](http://mgiroux.me/2015/getting-started-with-rails-graphql-relay/ \'Getting Started with Rails GraphQL Relay\')\r\n[GraphQL Ruby Gem](https://rmosolgo.github.io/graphql-ruby \'GraphQL Ruby Gem\')\r\n[GraphQL Gist](https://gist.github.com/JoshCheek/0a6977d2b40b9d4d5d09615e16a8a656 \'GraphQL Gist\')\r\n[Zero to GraphQL in 30 Minutes](https://www.youtube.com/watch?v=UBGzsb2UkeY \'Zero to GraphQL in 30 Minutes\')\r\n[Steve Luscher Github Source](https://github.com/steveluscher/zero-to-graphql \'Steve Luscher Github Source\')','2016-12-27 06:26:12','2016-12-27 06:27:29'),(4371,'Separation of Concerns','## Origin\r\n\r\nEdsger W. Dijkstra is credited with coining Separation of Concerns in his 1974 paper titled, “On the role of scientific thought.”  In this paper he states:\r\n\r\n>Let me try to explain to you, what to my taste is characteristic for all intelligent thinking. It is, that one is willing to study in depth an aspect of one\'s subject matter in isolation for the sake of its own consistency, all the time knowing that one is occupying oneself only with one of the aspects. We know that a program must be correct and we can study it from that viewpoint only; we also know that it should be efficient and we can study its efficiency on another day, so to speak. In another mood we may ask ourselves whether, and if so: why, the program is desirable. But nothing is gained —on the contrary!— by tackling these various aspects simultaneously. It is what I sometimes have called \"the separation of concerns\", which, even if not perfectly possible, is yet the only available technique for effective ordering of one\'s thoughts, that I know of. This is what I mean by \"focusing one\'s attention upon some aspect\": it does not mean ignoring the other aspects, it is just doing justice to the fact that from this aspect\'s point of view, the other is irrelevant. It is being one- and multiple-track minded simultaneously.\r\n\r\n## Complexity\r\n\r\n> In order to master complexity, one has to deal with one important issue (or concern) at a time. Dijkstra, 1976\r\n\r\n## What is a Concern?\r\n\r\nConcerns is a way of organizing requirements.  You can think of it as a particular issue of focus. I like to use the term dimension instead of concern. Because there is a lot of confusion about the term concern in the current literature.\r\n\r\n## The Principle\r\n\r\nThe principle states that software should be decomposed in such a way that different aspects of the problem are addressed in separate parts of the software system. This principle should drive the identification of the decomposition of a problem. The decomposition into parts must overlap in functionality as little as possible. It promotes the separation of different interests in a problem, solving them separately without requiring detailed knowledge of the other parts, and finally combining them into one result. It also serves to structure the functionality of programs. \r\n\r\n## Impact of Changes\r\n\r\n- Changes to one part of the program do not impact other parts of the program.\r\n- The worst case scenario is when changes are required, they are localized to a small number of elements.\r\n- If the requirements change, then the part of the program that has to be changed is obvious.\r\n\r\n## Benefits\r\n\r\n- It is easier to trace concerns, expressed as a requirement to the program that implement these concerns.\r\n- You can focus on one element without regard for the other elements in the program. \r\n- You can understand each part of the program by knowing its concern, without the need to understand other elements.  \r\n- Refactoring source code within limited scopes becomes possible.\r\n- Sections of code can be written independently.\r\n- It encourages decoupling.\r\n- It results in modular programs.\r\n\r\n## Applying the Principle\r\n\r\nProgramming language constructs such as methods and classes are the mechanism to organize and structure the core concerns of a system. We should organize software so that each element in the program (class, method etc.) does one thing and one thing only. \r\n\r\nHow do you find the areas of interest in the code? The principle of orthogonality in software can be used to find the answer. It is discussed in the article on [Orthogonality Software](https://rubyplus.com/articles/4381-Orthogonality-in-Software \'\').\r\n\r\n## References\r\n\r\n[Separations of Concerns in Java](http://javajdk.net/tutorial/separation-of-concerns \'Separations of Concerns in Java\')\r\n[Lecture on Separation of Concerns](http://homepages.dcc.ufmg.br/~figueiredo/disciplinas/lectures/soc_v01.pdf \'Lecture on Separation of Concerns\')\r\n[On the importance of the separation-of-concerns principle in secure software engineering](https://distrinet.cs.kuleuven.be/projects/sobenet/dissemination/docs/ACSA.pdf \'On the importance of the separation-of-concerns principle in secure software engineering\')\r\n[Separation of Concerns](https://effectivesoftwaredesign.com/2012/02/05/separation-of-concerns \'Separation of Concerns\')','2016-12-28 06:48:47','2016-12-29 21:58:59'),(4381,'Orthogonality in Software','In mathematics, orthogonality refers to two lines at right angles to each other. This relation can be generalized into n dimensions. It is used to express the independence between different dimensions. It can be thought of as describing non-overlapping, uncorrelated or independent objects. This implies, an object moving along the x-axis in a three-dimensional space does not change its y and z coordinates. \r\n\r\nLet\'s now look at the definitions of Orthogonality in programs found in books. The Art of UNIX Programming defines Orthogonality as:\r\n\r\n> Orthogonality is one of the most important properties that can help make even complex designs compact. In a purely orthogonal design, operations do not have side effects; each action (whether it\'s an API call, a macro invocation, or a language operation) changes just one thing without affecting others. There is one and only one way to change each property of whatever system you are controlling.\r\n\r\nProgramming Language Pragmatics defines it as:\r\n\r\n> Orthogonality means that features can be used in any combination, that the combinations all make sense, and that the meaning of a given feature is consistent, regardless of the other features with which it is combined.\r\n\r\nOn Lisp defines it as:\r\n\r\n> An orthogonal language is one in which you can express a lot by combining a small number of operators in a lot of different ways.\r\n\r\n#### Extensible Software\r\n\r\nOrthogonality is often used to describe modular software. You can think about systems as points in a multi-dimensional space, spawned by independent, orthogonal dimensions. It helps us to ensure that changes to one aspect of the system will not have side-effects on another. It enables us to establish a simple mental model for complex use cases. We can focus on one dimension while ignoring other aspects. It is useful in testing, because it reduces the number of combinations to test. Each functionality can be tested once in isolation. It makes combining functionality with different implementations possible. For instance, combining a shopping cart provider with a different payment processor in an eCommerce system. So, the software is designed to be extensible.\r\n\r\n#### The Role of Abstraction \r\n\r\nAbstraction is the key to developing software that is orthogonal in nature. Each dimension of an orthogonal system addresses one particular area of interest in the system. In object oriented languages, the dimension is usually represented by a class. The classes represent a dimension, while the objects represents the points within the given dimension.\r\n\r\n## Example\r\n\r\nLet\'s look at an example where a person can own many credit cards, can have an address and a spouse. The orthogonal code will look like:\r\n\r\n```ruby\r\nclass CreditCard\r\n  attr_reader :type, :expiration\r\n\r\n  def initialize(type, expiration)\r\n    @type = type\r\n    @expiration = expiration\r\n  end\r\nend\r\n\r\nclass Address\r\n  attr_reader :street, :state, :city, :zip\r\n\r\n  def initialize(street, state, city, zip)\r\n    @street = street\r\n    @state = state\r\n    @city = city\r\n    @zip = zip\r\n  end\r\nend\r\n\r\nclass Person\r\n  attr_accessor :address, :spouse\r\n  attr_reader :credit_cards, :name\r\n\r\n  def initialize(name)\r\n    @name = name\r\n    @credit_cards = []\r\n    @address = \'No Address\'\r\n    @spouse  = \'No Spouse\'\r\n  end\r\n\r\n  def add_credit_card(credit_card)\r\n    @credit_cards << credit_card\r\n  end\r\n\r\n  def to_s\r\n    \"My name is #{@name}. I own #{@credit_cards.size} credit cards.\"\r\n  end  \r\nend\r\n\r\nbugs = Person.new(\'Bugs Bunny\')\r\ncredit_card = CreditCard.new(\'Visa\', \'July 10, 2020\')\r\nbugs.add_credit_card(credit_card)\r\n\r\nputs bugs\r\n\r\ndaffy = Person.new(\'Daffy\')\r\n\r\nputs daffy\r\n```\r\n\r\nThe three dimensions in this code are credit card, address and spouse. The credit card and address are application level objects whereas the spouse is a Ruby builtin string object. We have write programs that combines these dimensions as follows:\r\n\r\n- A person with many credit cards, an address and a spouse.\r\n- A person with no credit cards, address or spouse\r\n\r\nand so on. There are all valid combinations resulting in a valid person object in our application. We can vary these dimensions independent of each other. The person class uses composition to achieve orthogonality.\r\n\r\n## Non Example\r\n\r\nThe example for code that violates Orthogonality is shown below:\r\n\r\n```ruby\r\nclass VirtualClock\r\n  attr_accessor :hour\r\n\r\n  def morning?\r\n    hour <= 12\r\n  end\r\nend\r\n\r\nclass FizzBuzz\r\n  def initialize(clock, output=$stdout)\r\n    @output = output\r\n    @clock = clock\r\n  end\r\n\r\n  def transform(n)\r\n    result = sequence\r\n    if @clock && @clock.morning?\r\n     result = \"#{result} Morning\"\r\n    end\r\n    result\r\n  end    \r\n  \r\n  def sequence\r\n    \'Fizz\'\r\n  end\r\nend\r\n\r\nclock = VirtualClock.new\r\nclock.hour = 9\r\nfb = FizzBuzz.new(clock)\r\nputs fb.transform(10)\r\n```\r\n\r\nIn this case, there are two dimensions, time and output device type. We cannot vary them independently in this program. The following rewritten example shows one way to vary them independently.\r\n\r\n```ruby\r\nclass VirtualClock\r\n  attr_accessor :hour\r\n\r\n  def morning?\r\n    hour <= 12\r\n  end\r\nend\r\n\r\nclass TimeDimension\r\n  def initialize(clock)\r\n    @clock = clock\r\n  end\r\n  \r\n  def transform(n)\r\n    result = n\r\n    if @clock && @clock.morning?\r\n     result = \"#{result} Morning\"\r\n    end\r\n    result\r\n  end      \r\nend\r\n\r\nclass FizzBuzz\r\n  def initialize(output=$stdout)\r\n    @output = output\r\n  end\r\n\r\n  def transform(n)\r\n    result = sequence\r\n  end    \r\n\r\n  def sequence\r\n    \'Fizz\'\r\n  end\r\nend\r\n\r\nfb = FizzBuzz.new\r\nf = fb.transform(3)\r\n\r\nclock = VirtualClock.new\r\nclock.hour = 9\r\ntd = TimeDimension.new(clock)\r\n\r\nputs td.transform(f)\r\n``` \r\n \r\n### References\r\n \r\nThe Principles of Modular and Maintainable Design by Jens Dietrich','2016-12-28 08:50:44','2017-01-09 19:51:01'),(4391,'Flattening Nested if-else in Rails Projects','## Introduction\r\n\r\nI read the article [Monads in recurring payment handling](http://beyondscheme.com/2016/monads-in-recurring-payment-handling \'Monads in recurring payment handling\') by Artur Trzop. I would like to show you how to refactor the solution without increasing the complexity of the code by not using Monads.\r\n\r\n## Before Refactoring\r\n\r\n```ruby\r\ndef create\r\n  if customer_data_valid?\r\n    if customer_created_or_updated_in_payment_system?\r\n      if subscription_created_or_updated_in_payment_system?\r\n        show_success\r\n      else\r\n        show_errors\r\n      end\r\n    else\r\n      show_errors\r\n    end\r\n  else\r\n    show_errors\r\n  end\r\nend\r\n```\r\n\r\nThe controller does following things:\r\n\r\n- Validation\r\n- Payment Processing\r\n- Subscription\r\n\r\n## After Refactoring\r\n\r\n```ruby\r\ndef create\r\n  customer_data_valid? || render_invalid_data(\"Invalid data\")\r\n  customer_created_or_updated_in_payment_system? || render_payment_error(\'Payment failed\')\r\n  subscription_created_or_updated_in_payment_system? || render_subscription_error(\'Subscription failed\')\r\nend\r\n\r\ndef render_invalid_data(message)\r\n  @error = message\r\n  render :new and return\r\nend\r\n\r\ndef render_payment_error(message)\r\n  @error = message\r\n  render :new and return\r\nend\r\n\r\ndef render_subscription_error(message)\r\n  @error = message\r\n  render :new and return  \r\nend\r\n```\r\n\r\nThe refactored version uses Rails trick of rendering and returning immediately in case of an error. The methods such as  `customer_data_valid?`, `customer_created_or_updated_in_payment_system?` and `subscription_created_or_updated_in_payment_system?` either returns true for success or returns false if something goes wrong. This makes the code following the || to execute. So, the failure case is handled. \r\n','2017-01-09 23:49:33','2017-01-09 23:50:25'),(4401,'How to Add Electronic Business Card in Rails App','## What is vCard ?\r\n\r\nvCard is a file format standard for electronic business cards. vCards are often attached to e-mail messages, it can also be exchanged through a webapp or instant messaging.\r\n\r\n## Why Virtual Business Card?\r\n\r\n- You can update your contact details easily. \r\n- Integrates easily with contact management applications.\r\n- Provide a link to anyone to add your contact details with just a few clicks. \r\n- Avoid mistakes in entering phone number, email etc.\r\n- You don\'t need to install any mobile app\r\n- You don\'t need to be in the same OS or platform as your contact\r\n\r\n## Steps\r\n\r\nRails already comes with vcf mime type defined in `rails/actionpack/lib/action_dispatch/http/mime_types.rb` as shown below:\r\n\r\n```ruby\r\nMime::Type.register \"text/vcard\", :vcf\r\n```\r\n\r\nIf the version of Rails you are using does not have it. You can add the mime-type for vcards in config/initializers/mime_types.rb:\r\n\r\n```ruby\r\nMime::Type.register \'text/x-vcard\', :vcf \r\n```\r\n \r\nAdd a link to download the vCard in the view:\r\n\r\n```rhtml\r\n<%= link_to(\"Download vcard\",  download_vcard_path(:format => \'vcf\'))  %>\r\n```\r\n\r\nDefine a route in routes.rb:\r\n\r\n```ruby\r\nget \'vcard\',  to: \'welcome#download_vcard\', :as => :download_vcard\r\n```\r\n\r\nAdd an action to process the vCard request in welcome controller:\r\n\r\n```ruby\r\ndef download_vcard\r\n  respond_to do |format|\r\n    format.vcf do\r\n      tmp_file = open(\'https://www.rubyplus.com/bparanj.vcf\')\r\n      send_data tmp_file.read, :filename => \'bparanj.vcf\', :type => :vcf \r\n    end\r\n  end\r\nend\r\n```\r\n\r\nIn my case, the bparanj.vcf file is in the public folder of my Rails app. The contents are as follows:\r\n\r\n```\r\nBEGIN:VCARD\r\nVERSION:4.0\r\nN:Paranj;Bala;;Mr;\r\nFN:Mr Bala Paranj\r\nTITLE:Software Engineer\r\nPHOTO;TYPE=uri:https://images.rubyplus.com/me.jpg\r\nEMAIL:feedback@rubyplus.com\r\nORG:RubyPlus\r\nTEL:4048615540\r\nURL;type=pref:https://www.rubyplus.com\r\nADR:;2484 Briarcliff Road, 22-119;;Atlanta;GA;30329;USA\r\nEND:VCARD\r\n```\r\n\r\nYou can customize the above file by replacing my details with your contact details. Now the download link will add the contact to your contact list as a contact in your Mac, Android device etc. You can test this feature by clicking on the \'Download vCard\' link on the [RubyPlus Contact](https://rubyplus.com/contact \'RubyPlus Contact\') page. You can also download my virtual business card by clicking [Bala Paranj Virtual Business Card](https://www.rubyplus.com/vcard.vcf). I can paste the link to vCard in instant messaging systems, email signature etc to share my contact details easily. This makes it very easy for your potential professional networking person to add you to their contact list.\r\n\r\n## Virtual Business Card HTML\r\n\r\nYou can also add html for vcard like this:\r\n\r\n```html\r\n<div class=\"vcard\">\r\n <span class=\"fn\"><span class=\"given-name\">Bala</span>\r\n <span class=\"family-name\">Paranj</span></span>,\r\n <span class=\"title\">Senior Copy Paster</span>,\r\n <div class=\"org\">RubyPlus</div>\r\n <div class=\"adr\">\r\n  <div class=\"street-address\">2484 Briarcliff Road, #22-119</div>\r\n  <span class=\"locality\">Georgia</span>,\r\n  <span class=\"region\">Atlanta</span>\r\n  <span class=\"postal-code\">30329</span>\r\n </div>\r\n <div>Phone: <span class=\"tel\">4048615540</span></div>\r\n <div>Email:\r\n <span class=\"email\">feedback@rubyplus.com</span></div>\r\n</div>                \r\n```\r\n\r\nAnyone can open the vcf file and they can import it to their contact list.\r\n\r\n![Import Business Card](https://images.rubyplus.com/vcard-1.png)\r\n\r\nThe details of the contact for rubyplus.com contact page is shown below:\r\n\r\n![Import Business Card](https://images.rubyplus.com/vcard-2.png)\r\n\r\n## Summary\r\n\r\nIn this article, you learned how easy it is to add a virtual business card in a Rails app. It makes it easier to update and share your contact information with others.','2017-01-12 21:03:29','2017-01-15 21:49:38'),(4411,'Uploading Files to S3 using AWS SDK Ruby Gem','To upload files to your Amazon S3 bucket, you can use the aws-sdk version 2. By default the gem looks for the credentials in the environment variables. So you must export the values in a terminal like this:\r\n\r\n```\r\nexport AWS_ACCESS_KEY_ID=\'my-very-secret-key\'\r\n```\r\n\r\nYou can verify it is set by doing:\r\n\r\n```\r\necho $AWS_ACCESS_KEY_ID\r\n```\r\n\r\nYou must set `AWS_ACCESS_KEY_ID`, `AWS_SECRET_ACCESS_KEY` and `AWS_REGION`. You can create a S3 resource for the region where your bucket exists and create an object with a unique file name and call `upload_file` as shown below.\r\n\r\n```ruby\r\nrequire \'aws-sdk\'\r\n\r\nfile_name = \'your-file.mp4\'\r\n\r\ns3 = Aws::S3::Resource.new(region: ENV[\'AWS_REGION\'])\r\nobj = s3.bucket(\'your-s3-bucket-name\').object(file_name)\r\nputs \"Uploading file #{file_name}\"\r\nobj.upload_file(\"/Users/username/path/to/#{file_name}\")\r\nputs \"Done\"\r\n```\r\n\r\nWe can add a spinner to make it clear that progress is being made. The modified version is shown below:\r\n\r\n```ruby\r\nrequire \'aws-sdk\'\r\n\r\ndef with_spinner\r\n  chars = %w[| / - \\\\]\r\n  not_done = true\r\n  spinner = Thread.new do\r\n    while not_done do  \r\n      print chars.rotate!.first\r\n      sleep 0.1\r\n      print \"\\b\"\r\n    end\r\n  end\r\n  yield.tap do         # After yielding to the block, save the return value\r\n    not_done = false   # Tell the thread to exit, cleaning up after itself…\r\n    spinner.join       # …and wait for it to do so.\r\n  end                  # Use the block\'s return value as the method\'s\r\nend\r\n\r\n# By default aws-sdk looks at these environment variables\r\n# ENV[\'AWS_REGION\'], ENV[\'AWS_ACCESS_KEY_ID\'] and ENV[\'AWS_SECRET_ACCESS_KEY\'] \r\n\r\ndef actual_job\r\n  ENV[\'AWS_REGION\'] = \'us-east-1\'\r\n  file_name = \'test.mp4\'\r\n\r\n  s3 = Aws::S3::Resource.new(region: ENV[\'AWS_REGION\'])\r\n  obj = s3.bucket(\'s3-bucket-name\').object(file_name)\r\n  print \"Uploading file #{file_name}\"\r\n  \r\n  obj.upload_file(\"/Users/bugs/Desktop/#{file_name}\")\r\nend\r\n\r\nwith_spinner do \r\n  actual_job\r\nend\r\n\r\nputs \"Done!\"\r\n```\r\n\r\nTo retrieve the size of the file, I used to use the curl command, you can execute any command in ruby using the Kernel tick method.\r\n\r\n```ruby\r\ncommand = `curl -I -s https://your-s3-bucket-url/test.mp4 | grep \'Content-Length\'`\r\nputs command\r\n```\r\n\r\nInstead of using curl, to be consistent, we can use aws-sdk library to find the file size:\r\n\r\n```ruby\r\nrequire \'aws-sdk\'\r\n\r\no = Aws::S3::Object.new(\'your-s3-bucket\', \'your-s3-file-name-with-extension\')\r\nputs o.content_length\r\n```\r\n\r\nThis automates some of the steps of screencast workflow for rubyplus.com. Since I no longer have to login to a password manager, login to aws console, use their UI to go to the correct bucket and upload the file manually. ','2017-01-23 02:23:46','2017-01-25 08:18:43'),(4421,'How to Align Buttons in Twitter Bootstrap 3.3','You can nest the buttons inside a div tag as shown below:\r\n\r\n```rhtml\r\n<div>\r\n  <div>\r\n    <%= link_to \'Watch Video\', episode, class: \'btn btn-primary\', rel: \'nofollow\' %>  \r\n    <% unless episode.article_id.blank? %>\r\n      <%= link_to \'Read Article\', article_url(id: episode.article.to_param), class: \'btn btn-success\', rel: \'nofollow\' %>  \r\n    <% end %>\r\n  </div>                                  \r\n</div>    \r\n```\r\n\r\nThis took me about 30 minutes to figure. I hope it helps someone.','2017-01-23 02:53:50','2017-01-23 02:53:50'),(4431,'Geocoding in Rails 5','The [geocoder](https://github.com/alexreisner/geocoder) version used in this article is 1.4.1. Create a location model that can store the address and the corresponding latitude and longitude.\r\n\r\n```\r\nrails g model location address latitude:float longitude:float\r\n```\r\n\r\nMigrate the database.\r\n\r\n```\r\nrails db:migrate\r\n```\r\n\r\nThe layout file looks like this:\r\n\r\n```rhtml\r\n<!DOCTYPE html>\r\n<html>\r\n  <head>\r\n    <title>Gcode</title>\r\n    <%= csrf_meta_tags %>\r\n    <%= stylesheet_link_tag    \'application\', media: \'all\', \'data-turbolinks-track\': \'reload\' %>\r\n    <%= javascript_include_tag \'application\', \'data-turbolinks-track\': \'reload\' %>\r\n  </head>\r\n  \r\n  <div id=\"container\">\r\n    <% flash.each do |name, msg| %>\r\n      <%= content_tag :div, msg, :id => \"flash_#{name}\" %>\r\n    <% end %>\r\n    <%= yield %>\r\n  </div>\r\n</html>\r\n```\r\n\r\nAdd the geocoder gem to Gemfile and run bundle.\r\n\r\n```ruby\r\ngem \'geocoder\'\r\n```\r\n\r\nCreate a locations controller.\r\n\r\n```\r\nrails g controller locations\r\n```\r\n\r\nThe locations controller is straightforward and looks like this:\r\n\r\n```ruby\r\nclass LocationsController < ApplicationController\r\n  def index\r\n    if params[:search].present?\r\n      @locations = Location.near(params[:search], 50, :order => :distance)\r\n    else\r\n      @locations = Location.all\r\n    end\r\n  end\r\n\r\n  def show\r\n    @location = Location.find(params[:id])\r\n  end\r\n\r\n  def new\r\n    @location = Location.new\r\n  end\r\n\r\n  def create\r\n    @location = Location.new(allowed_params)\r\n    if @location.save\r\n      redirect_to @location, :notice => \"Successfully created location.\"\r\n    else\r\n      render :new\r\n    end\r\n  end\r\n\r\n  def edit\r\n    @location = Location.find(params[:id])\r\n  end\r\n\r\n  def update\r\n    @location = Location.find(params[:id])\r\n    if @location.update_attributes(allowed_params)\r\n      redirect_to @location, :notice  => \"Successfully updated location.\"\r\n    else\r\n      render :edit\r\n    end\r\n  end\r\n\r\n  def destroy\r\n    @location = Location.find(params[:id])\r\n    @location.destroy\r\n    \r\n    redirect_to locations_url, :notice => \"Successfully destroyed location.\"\r\n  end\r\n  \r\n  private\r\n  \r\n  def allowed_params\r\n    params.require(:location).permit(:id, :address, :latitude, :longitude)\r\n  end\r\nend\r\n```\r\n\r\nThe location model has the declaration to geocode the address. After validation it hits the network to fetch the values for latitude and longitude values of the location.\r\n\r\n```ruby\r\nclass Location < ApplicationRecord\r\n  geocoded_by :address       # can also be an IP address\r\n  after_validation :geocode  # auto-fetch coordinates\r\nend\r\n```\r\n\r\nThe location form is in locations/_form.html.erb is as follows:\r\n\r\n```rhtml\r\n<%= form_for @location do |f| %>\r\n  <p>\r\n    <%= f.label :address %><br />\r\n    <%= f.text_field :address %>\r\n  </p>\r\n  <p>\r\n    <%= f.label :latitude %><br />\r\n    <%= f.text_field :latitude %>\r\n  </p>\r\n  <p>\r\n    <%= f.label :longitude %><br />\r\n    <%= f.text_field :longitude %>\r\n  </p>\r\n  <p><%= f.submit %></p>\r\n<% end %>\r\n```\r\n\r\nThe edit.html.erb is as shown below:\r\n\r\n```rhtml\r\n<%= render \'form\' %>\r\n<p>\r\n  <%= link_to \"Show\", @location %> |\r\n  <%= link_to \"View All\", locations_path %>\r\n</p>\r\n```\r\n\r\nThe index.html.erb is as follows:\r\n\r\n```rhtml\r\n<%= form_tag locations_path, :method => :get do %>\r\n  <p>\r\n    <%= text_field_tag :search, params[:search] %>\r\n    <%= submit_tag \"Search Near\", :name => nil %>\r\n  </p>\r\n<% end %>\r\n\r\n<table>\r\n  <tr>\r\n    <th>Address</th>\r\n    <th>Latitude</th>\r\n    <th>Longitude</th>\r\n  </tr>\r\n  <% for location in @locations %>\r\n    <tr>\r\n      <td><%= location.address %></td>\r\n      <td><%= location.latitude %></td>\r\n      <td><%= location.longitude %></td>\r\n      <td><%= link_to \"Show\", location %></td>\r\n      <td><%= link_to \"Edit\", edit_location_path(location) %></td>\r\n      <td><%= link_to \"Destroy\", location, :confirm => \'Are you sure?\', :method => :delete %></td>\r\n    </tr>\r\n  <% end %>\r\n</table>\r\n\r\n<p><%= link_to \"New Location\", new_location_path %></p>\r\n```\r\n\r\nThe new.html.erb is as follows:\r\n\r\n```rhtml\r\n<%= render \'form\' %>\r\n<p><%= link_to \"Back to List\", locations_path %></p>\r\n```\r\n\r\nThe show.html.erb is as follows:\r\n\r\n```rhtml\r\n<p>\r\n  <strong>Address:</strong>\r\n  <%= @location.address %>\r\n</p>\r\n<p>\r\n  <strong>Latitude:</strong>\r\n  <%= @location.latitude %>\r\n</p>\r\n<p>\r\n  <strong>Longitude:</strong>\r\n  <%= @location.longitude %>\r\n</p>\r\n\r\n<%= image_tag \"http://maps.google.com/maps/api/staticmap?size=450x300&sensor=false&zoom=16&markers=#{@location.latitude}%2C#{@location.longitude}\" %>\r\n\r\n<h3>Nearby locations</h3>\r\n<ul>\r\n<% for location in @location.nearbys(10) %>\r\n  <li><%= link_to location.address, location %> (<%= location.distance.round(2) %> miles)</li>\r\n<% end %>\r\n</ul>\r\n\r\n<p>\r\n  <%= link_to \"Edit\", edit_location_path(@location) %> |\r\n  <%= link_to \"Destroy\", @location, :confirm => \'Are you sure?\', :method => :delete %> |\r\n  <%= link_to \"View All\", locations_path %>\r\n</p>\r\n```\r\n\r\nDefine the location resource in routes.rb:\r\n\r\n```ruby\r\nresources :locations\r\n```\r\n\r\nYou can now create locations by going to `localhost:3000/locations`.\r\n\r\n## Converting IP address to Location\r\n\r\nCreate a download model with field to store IP address.\r\n\r\n```\r\nrails g model download ip\r\n```\r\n\r\nMigrate the database.\r\n\r\n```\r\nrails db:migrate\r\n```\r\n\r\nAdd the geocoding declaration to the download model.\r\n\r\n```ruby\r\nclass Download < ApplicationRecord\r\n  geocoded_by :ip\r\n  after_validation :geocode\r\nend\r\n```\r\n\r\nCreate a download model in rails console:\r\n\r\n```ruby\r\n> Download.create(ip: \'209.249.19.173\')\r\n   (0.1ms)  begin transaction\r\n   (0.1ms)  rollback transaction\r\nNoMethodError: undefined method `latitude=\' for #<Download:0x007ffc5cdccd18>\r\n```\r\n\r\nThis fails, the geocoder gem needs the latitude and longitude to populate the record when it geocodes the IP after validation. Drop the development database.\r\n\r\n```\r\nrails db:drop\r\n```\r\n\r\nAdd the required fields for coordinates in the migration.\r\n\r\n```ruby\r\nclass CreateDownloads < ActiveRecord::Migration[5.0]\r\n  def change\r\n    create_table :downloads do |t|\r\n      t.string :ip\r\n      t.float :latitude\r\n      t.float :longitude\r\n      t.timestamps\r\n    end\r\n  end\r\nend\r\n```\r\n\r\nMigrate the database.\r\n\r\n```\r\nrails db:migrate\r\n```\r\n\r\nLet\'s create a download record in the rails console.\r\n\r\n```ruby\r\n> Download.create(ip: \'209.249.19.173\')\r\n   (0.0ms)  begin transaction\r\nGeocoding API not responding fast enough (use Geocoder.configure(:timeout => ...) to set limit).\r\n  SQL (0.4ms)  INSERT INTO \"downloads\" (\"ip\", \"created_at\", \"updated_at\") VALUES (?, ?, ?)  [[\"ip\", \"209.249.19.173\"], [\"created_at\", 2017-01-25 19:38:45 UTC], [\"updated_at\", 2017-01-25 19:38:45 UTC]]\r\n   (2.5ms)  commit transaction\r\n => #<Download id: 1, ip: \"209.249.19.173\", latitude: nil, longitude: nil, created_at: \"2017-01-25 19:38:45\", updated_at: \"2017-01-25 19:38:45\">\r\n```\r\n\r\nThis fails with \'not responding\' error. Define the timeout in config/initializers/geocoder.rb:\r\n     \r\n```ruby\r\nGeocoder::Configuration.timeout = 15\r\n```\r\n\r\nYou can now create a download record in the rails console.\r\n\r\n```ruby\r\n> Download.create(ip: \'209.249.19.173\')\r\n   (0.1ms)  begin transaction\r\n  SQL (0.5ms)  INSERT INTO \"downloads\" (\"ip\", \"latitude\", \"longitude\", \"created_at\", \"updated_at\") VALUES (?, ?, ?, ?, ?)  [[\"ip\", \"209.249.19.173\"], [\"latitude\", 37.8381], [\"longitude\", -122.1026], [\"created_at\", 2017-01-25 19:40:03 UTC], [\"updated_at\", 2017-01-25 19:40:03 UTC]]\r\n   (2.6ms)  commit transaction\r\n => #<Download id: 2, ip: \"209.249.19.173\", latitude: 37.8381, longitude: -122.1026, created_at: \"2017-01-25 19:40:03\", updated_at: \"2017-01-25 19:40:03\">\r\n```\r\n\r\nYou can see that the coordinates is now populated. How do we convert the coordinates to an address? Geocoder gem provides a CLI. You can provide the coordinates to the geocode command.\r\n\r\n```ruby\r\n$ geocode 37.8381,  -122.1026\r\nLatitude:         37.8375726\r\nLongitude:        -122.1023373\r\nFull address:     Cross Path, Moraga, CA 94556, USA\r\nCity:             Moraga\r\nState/province:   California\r\nPostal code:      94556\r\nCountry:          United States\r\nGoogle map:       http://maps.google.com/maps?q=37.8375726,-122.1023373\r\n```\r\n\r\nThe address private method in this [example](https://github.com/alexreisner/geocoder/blob/master/examples/reverse_geocode_job.rb) in the examples folder shows how to convert coordinates to an address. Let\'s use that in the rails console.\r\n\r\n```ruby\r\n$ rails c\r\nLoading development environment (Rails 5.0.1)\r\n> Geocoder.address([37.8381,  -122.1026])\r\n => \"Cross Path, Moraga, CA 94556, USA\"\r\n> Geocoder.address([37.7618242,-122.39858709999999])\r\n => \"324 Arkansas St, San Francisco, CA 94107, USA\"\r\n```\r\n\r\nYou can also find the address directly without storing any coordinates:\r\n\r\n```ruby\r\n> Geocoder.search(\'209.249.19.173\').first\r\n => #<Geocoder::Result::Freegeoip:0x007ff82b428d50 @data={\"ip\"=>\"209.249.19.173\", \"country_code\"=>\"US\", \"country_name\"=>\"United States\", \"region_code\"=>\"CA\", \"region_name\"=>\"California\", \"city\"=>\"Moraga\", \"zip_code\"=>\"94556\", \"time_zone\"=>\"America/Los_Angeles\", \"latitude\"=>37.8381, \"longitude\"=>-122.1026, \"metro_code\"=>807}, @cache_hit=nil>\r\n```\r\n\r\nI found this way by reading this test: https://github.com/alexreisner/geocoder/blob/master/test/unit/lookups/geoip2_test.rb. If you want to convert a zip code to latitude and longitude, you can use [freemaptools.com](https://www.freemaptools.com/convert-us-zip-code-to-lat-lng.htm)\r\n\r\n## Possible Issues and Fixes\r\n\r\nIf you get the error:\r\n\r\n```\r\nGeocoding API not responding fast enough (use Geocoder.configure(:timeout => ...) to set limit).\r\n```\r\n\r\nCreate config/initializers/geocoder.rb and define the timeout:\r\n\r\n```ruby\r\nGeocoder::Configuration.timeout = 15\r\n```\r\n\r\nIt will now work. ','2017-01-25 07:41:11','2017-02-09 22:34:35'),(4441,'RubyPlus Unplugged : BCrypt Gem','## Introduction\r\n\r\nI was getting the `BCrypt::Errors::InvalidHash: invalid hash` error when I forgot to declare the `has_secure_password` in the model for a Rails project. This is covered in the episode on [Authentication from Scratch](https://rubyplus.com/episodes/401-to-be-released-this-week). The error message did not make any sense to me. The questions is how can I reproduct this problem, what error message would be meaningful and helpful for the developers using the library. \r\n\r\n## Reproducing the Problem\r\n\r\nAfter reading the source code for bcrypt gem I found a way to reproduce the problem.\r\n\r\n```ruby\r\n> require \'bcrypt\'\r\n => true\r\n> BCrypt::Password.new(nil)\r\nBCrypt::Errors::InvalidHash: invalid hash\r\n    from /Users/bparanj/.rvm/gems/ruby-2.3.1@rails5/gems/bcrypt-3.1.11/lib/bcrypt/password.rb:60:in `initialize\'\r\n```\r\n\r\nWhat is hash? Is it the data structure? It is confusing error message because a developer looking at this error message on the browser might thing it is the data structure. Looking at the source code, we can see what a hash means:\r\n\r\n```ruby\r\ndef valid_hash?(h)\r\n  h =~ /^\\$[0-9a-z]{2}\\$[0-9]{2}\\$[A-Za-z0-9\\.\\/]{53}$/\r\nend\r\n```\r\n\r\nThis tells us that the word hash has a different meaning is in the context of security. According to the [Wikipedia](https://simple.wikipedia.org/wiki/Cryptographic_hash_function):\r\n\r\n>A cryptographic hash function is a hash function which takes an input (or \'message\') and returns a fixed-size alphanumeric string. The string is called the \'hash value\', \'message digest\', \'digital fingerprint\', \'digest\' or \'checksum\').\r\n\r\n## Creating a Hash\r\n\r\nWe can create a hash for a password:\r\n\r\n```ruby    \r\n> h = BCrypt::Password.create(\"test\")\r\n => \"$2a$10$3pQfd7SpGKlOE7mfotr5POa5iiF4gFHaUya1FunlWkEOj5z23lydC\"\r\n```\r\n\r\nWe can now compare it with the stored hash to see if the user entered the correct password:\r\n\r\n```ruby\r\n> BCrypt::Password.new(h) == \'test\'\r\n => true\r\n````\r\n\r\nThe nil is not a valid hash because it is not a valid alphanumeric string. In the bcrypt gem implementation, you can see the constructor checks for a valid hash:\r\n\r\n```ruby\r\ndef initialize(raw_hash)\r\n  if valid_hash?(raw_hash)\r\n    self.replace(raw_hash)\r\n    @version, @cost, @salt, @checksum = split_hash(self)\r\n  else\r\n    raise Errors::InvalidHash.new(\"invalid hash\")\r\n  end\r\nend\r\n```\r\n\r\nWe must raise an exception saying \'Password digest cannot be nil\'. This message makes it clear to the developer why the gem is crashing. In a Rails project, if  you check the user record, you will find that the password_digest is nil. If you are interested in contributing to open source. Write a failing test and fix this issue and send a pull request to the author of the gem. Contributing to open source can be as simple as knowing the best practices and making them better by applying them.','2017-01-25 07:43:35','2017-01-25 08:00:11'),(4451,'WebSocket Basics : Hello World','In this article, you will learn the basics of WebSocket using NodeJS. We will write a very simple Hello WebSocket program. The reason we are not using Rails 5 is because we want to learn the concepts first. According to Mozilla Developer Network:\r\n\r\n> WebSockets is an advanced technology that makes it possible to open an interactive communication session between the user\'s browser and a server. With this API, you can send messages to a server and receive event-driven responses without having to poll the server for a reply.\r\n\r\nCreate the index.html file, this will be the WebSocket client that sends data to the WebSocket server.\r\n\r\n```html\r\n<!DOCTYPE html>\r\n<html lang=\"en\">\r\n<head>\r\n<title>WebSocket Hello World</title>\r\n<script src=\"https://ajax.googleapis.com/ajax/libs/jquery/3.1.0/jquery.min.js\"></script>\r\n    <script>\r\n        var ws = new WebSocket(\"ws://localhost:8080\");\r\n        ws.onopen = function(e) {\r\n          console.log(\'Connected to server\');\r\n        }\r\n\r\n        function sendMessage() {\r\n            ws.send($(\'#message\').val());\r\n        }\r\n    </script>\r\n</head>\r\n<body lang=\"en\">\r\n    \r\n  <form id=\"echo_form\" onsubmit=\"sendMessage(); return false;\">\r\n    <input class=\"form-control\" type=\"text\" name=\"message\" id=\"message\" placeholder=\"Type text to echo in here\" value=\"\" autofocus/>\r\n        \r\n    <button type=\"button\" id=\"send\" class=\"btn btn-primary\" onclick=\"sendMessage();\">Send</button>\r\n  </form>\r\n\r\n</body>\r\n</html>\r\n```\r\n\r\nWe need to install NodeJS. I had old version of node on my machine.\r\n\r\n```\r\nnode -v\r\nv4.4.7\r\n```\r\n\r\nYou can use brew to install node.\r\n\r\n```\r\n$ brew install node\r\n```\r\n\r\nThis failed. I installed using [NodeJS Mac installer](https://nodejs.org/en/download/). This installed node 6.9.4.\r\n\r\n```\r\nnode -v\r\nv6.9.4\r\n```\r\n\r\nNext, we need to install WebSocker server. We can install the ws library for our Node.js application. According to the [Node package manager](https://www.npmjs.com/package/ws) website:\r\n\r\n> ws is a simple to use WebSocket implementation, up-to-date against RFC-6455, and probably the fastest WebSocket library for node.js.\r\n\r\nWe can install it by:\r\n\r\n```\r\nnpm install ws\r\n```\r\n\r\nThis gave an error:\r\n\r\n```\r\nenoent ENOENT: no such file or directory, open package.json\r\n```\r\n\r\nCreate package.json file by running:\r\n\r\n```\r\n$ npm init \r\n```\r\n\r\nThis will prompt you to answer questions and create package.json. This will loook something like this:\r\n\r\n```json\r\n{\r\n  \"name\": \"wstutorial\",\r\n  \"version\": \"1.0.0\",\r\n  \"description\": \"WebSocket Basics\",\r\n  \"main\": \"server.js\",\r\n  \"scripts\": {\r\n    \"test\": \"echo \\\"Error: no test specified\\\" && exit 1\"\r\n  },\r\n  \"keywords\": [\r\n    \"hello\",\r\n    \"world\"\r\n  ],\r\n  \"author\": \"Bala Paranj\",\r\n  \"license\": \"MIT\"\r\n}\r\n```\r\n\r\nLet\'s now install the ws WebSocket library.\r\n\r\n```\r\nnpm install ws\r\nwstutorial@1.0.0 /Users/bparanj/temp/websocket\r\n└─┬ ws@1.1.1 \r\n  ├── options@0.0.6 \r\n  └── ultron@1.0.2 \r\n\r\nnpm WARN wstutorial@1.0.0 No repository field.\r\n```\r\n\r\nCreate server.js file with:\r\n\r\n```javascript\r\nvar WebSocketServer = require(\'ws\').Server,\r\n    wss = new WebSocketServer({port: 8080});\r\n\r\nwss.on(\'connection\', function(ws) {\r\n    console.log(\'client connected\');\r\n    ws.on(\'message\', function(message) {\r\n        console.log(\'received: %s\', message);\r\n    });\r\n});\r\n```\r\n\r\nThis creates a websocket server running on port 8080. We have two functions, one on connection, the other when the server receives the message from the client. Run it:\r\n\r\n```\r\nnode server.js\r\n```\r\n\r\nOpen the index.html in the browser and enter \'hello world\'. You will see the output in the terminal where the node server is running. Inspect Tab, select localhost, headers and see the different sections. If you make any changes to server.js, you have to restart the server. In this article, you learned how the client send data to the server. In the next article, we will see how the data sent by the server can be received by the client. You can download the source for this article from my github repo [websocket](https://github.com/bparanj/websocket).','2017-01-26 05:37:07','2017-01-27 09:03:41'),(4461,'WebSocket Basics : Streaming Data from Server','In the previous article, we saw how to send data from the client to the server. In this article, we will see how to send data from the server to the client. Create index.html that will display the random number generated by the server to the browser.\r\n\r\n```html\r\n<!DOCTYPE html>\r\n<html lang=\"en\">\r\n<head>\r\n<title>Random Number Generator</title>\r\n<script src=\"https://ajax.googleapis.com/ajax/libs/jquery/3.1.0/jquery.min.js\"></script>\r\n  <script>\r\n    var ws = new WebSocket(\"ws://localhost:8080\");\r\n    ws.onopen = function(e) {\r\n      console.log(\'Connected to server\');\r\n    }\r\n      ws.onmessage = function(event) {\r\n        console.log(event.data);\r\n        $( \'#randomNums\' ).append(event.data + \' \');\r\n      }\r\n  </script>\r\n</head>\r\n<body lang=\"en\">\r\n\r\n  <div id=\"randomNums\"></div>    \r\n\r\n</body>\r\n</html>\r\n```\r\n\r\nWe first establish connection to the server. We are now ready to receive messages from the server in the onmessage handler. When we receive a data from the server, we append the number to the div with id randomNums. Whenever the data is received from the server, the onmessage javascript function is fired.\r\n\r\nCreate server.js that creates a WebSocketServer listening on port 8080. It sends a random number once every second. The setInterval function is used to stream random number at one second at a time to the client so that we can see the numbers emerging one by one in the browser. In a real app like tennis score board, there will be an unknown amount of delay in getting the latest score. The score board on the browser will be updated whenever the point is won. I used the [Server example](https://github.com/websockets/ws) found in the ws library github home page as a starting point for this demo.\r\n\r\n```javascript\r\nconst WebSocket = require(\'ws\');\r\n\r\nconst wss = new WebSocket.Server({ port: 8080 });\r\n\r\nwss.on(\'connection\', function connection(ws) {\r\n  ws.on(\'message\', function incoming(message) {\r\n    console.log(\'received: %s\', message);\r\n  });\r\n\r\n  var clientRandomNumberUpdater;\r\n  var sendRandomNumbers = function(ws) {\r\n    var randomNum = Math.floor(Math.random() * 11);  \r\n    ws.send(randomNum.toString());      \r\n  }\r\n  clientRandomNumberUpdater = setInterval(function(){\r\n      sendRandomNumbers(ws);\r\n  }, 1000);  \r\n});\r\n```\r\n\r\nModify this demo so that the client sends a string when it connects and the existing code for the server already prints it to the console. You can verify the message sent by the client is received by the server by looking at the code. You can read the previous article on how to complete this exercise. You can download the source for this article from my github repo [websocket](https://github.com/bparanj/websocket).','2017-01-27 09:02:32','2017-01-27 09:02:32'),(4471,'Data Duplication','It is easy to see code duplication and eliminate it during the refactoring step. However, it is difficult to see the data duplication in code that could be a sign of hidden abstraction. We must reflect about data duplication and consider expressing the hidden domain concept in a class during the refactoring step. You might also accomplish this by aiming for low semantic gap in the solution. The language we use to describe a problem affects the code quality. I discuss this in depth in my upcoming TDD in Ruby book scheduled for release in March 2017 by Apress. In this book I review the solution by Anderson Dias for Conway\'s Game of Life found at: https://github.com/andersondias/conway-game-of-life-ruby. The cell object has a neighbours method that looks like this:\r\n\r\n```ruby\r\nclass Cell\r\n  def neighbours\r\n    neighbours = []\r\n    neighbours.push(@world.cell_at(self.x - 1, self.y - 1))\r\n    neighbours.push(@world.cell_at(self.x - 1, self.y))\r\n    neighbours.push(@world.cell_at(self.x - 1, self.y + 1))\r\n\r\n    neighbours.push(@world.cell_at(self.x, self.y - 1))\r\n    neighbours.push(@world.cell_at(self.x, self.y + 1))\r\n\r\n    neighbours.push(@world.cell_at(self.x + 1, self.y - 1))\r\n    neighbours.push(@world.cell_at(self.x + 1, self.y))\r\n    neighbours.push(@world.cell_at(self.x + 1, self.y + 1))\r\n\r\n    neighbours\r\n  end\r\n\r\n  def live_neighbours\r\n    self.neighbours.select do |n|\r\n        n && n.live?\r\n    end\r\n  end\r\nend\r\n``` \r\n\r\nIn this case, you cannot replace the hard coded 1 with a constant and call it a day. This solution suffers from **Primitive Obsession**, since the location is accessed using integer values. The domain specific concept, Location is missing. The x and y stores data and is duplicated. What does x and y represent? We need to capture that abstraction and hide the data in x and y within the class. My solution uses Location object that looks like this:\r\n\r\n```ruby\r\nclass Location\r\n  NORTHWEST = [-1, 1]\r\n  NORTHEAST = [1, 1]\r\n  SOUTHWEST = [-1, -1]\r\n  SOUTHEAST = [1, -1]\r\n  CENTER    = [0, 0]\r\n  NORTH     = [0, 1]\r\n  SOUTH     = [0, -1]\r\n  EAST      = [1, 0]\r\n  WEST      = [-1, 0]\r\n\r\n  OFFSETS = [NORTHWEST, NORTHEAST, SOUTHWEST, SOUTHEAST, NORTH, SOUTH, EAST, WEST]\r\n\r\n  def self.add(first, second)\r\n    [first[0]+second[0], first[1]+second[1]]\r\n  end\r\nend\r\n```\r\n\r\nThe combination of a specific pair of x and y represents a specific location in the Moore\'s neighborhood. You can also see the Location class provides a closed operation, the add method.\r\n\r\n> Where it fits, define an operation whose return type is the same as the type of its arguments. Such an operation is closed under the set of instances of that type. A closed operation provides a high-level interface without introducing any dependency on other concepts. This pattern is most often applied to the operations of a Value Object. \r\n         -- Eric Evans, Domain Driven Design\r\n\r\nThe location class now provides us a place to allocate related responsibilities. I discuss these concepts in more depth in the book. Subscribe to my newsletter if you want to be notified about the discount coupon codes for the upcoming book.','2017-01-27 20:20:05','2017-01-27 20:20:05'),(4481,'Coding and Precision in Language and Meaning','An infant cries and you don’t know whether it is hungry or has tummy trouble. If you give it milk, it stops crying. As it grows, the request \"Milk!\" becomes \"Me Milk!\" and later \"Please give me some milk to drink.\" Children learn as they grow and their language acquires more precise meaning. Similarly, as the software grows, the tests acquire more precise meaning.\r\n\r\nProposition in logic is a statement that expresses a concept that can be either true or false. For instance, we can make valid propositions about the concept of grass:\r\n\r\n•    Grass is green.\r\n•    Grass is a plant.\r\n•    Grass grows.\r\n•    Grass is a monocot.\r\n\r\nAnd so on lead to increasing meaning and precision of meaning for the concept of grass. We can express this as specifications in code similar to the sheep example as shown below:\r\n \r\n```ruby\r\ndescribe Grass\r\n  it \'is green\'\r\n  it \'is a plant\'\r\n  it \'grows\'\r\n  it \'is a monocot\'\r\nend\r\n```\r\n\r\nNow consider the following:\r\n\r\n•    It has a wide opening to water tank\r\n•    It has a marked tank for exact water filling\r\n•    It has two-hour auto shut off\r\n•    It has filter basket \r\n•    It has a thermal carafe\r\n•    It is usually in the kitchen\r\n•    It has a sink\r\n•    It maintains the temperature of the drink inside\r\n\r\nWhat is it? At some point in the sequence you connected with the pattern and understood it was a description of a coffee maker. From that point, each statement confirmed your understanding. We can express these statements as specifications in code that describes the coffee maker. This is discussed in more detail in my upcoming book TDD in Ruby in March 2017 published by Apress. Subscribe to my newsletter if you want to be notified about the discount coupon codes for the upcoming book.','2017-01-27 21:55:16','2017-01-27 21:55:16'),(4491,'Relationship Between the Test Name and Test in TDD','The relationship between the test name and the implementation of the test must be consistent. We want to avoid code like this:\r\n\r\n```ruby\r\nit \'Dog should wag the tail when it sees the owner\' do\r\n  owner = Person.new\r\n  dog = Dog.new\r\n  result = dog.see(owner)\r\n\r\n  assert_equal \'bark\', result\r\nend\r\n```\r\n\r\nThis example seems obvious but developers make this very common mistake. We can fix this code as follows:\r\n\r\n```ruby\r\nit \'Dog should wag the tail when it sees the owner\' do\r\n  owner = Person.new\r\n  dog = Dog.new\r\n  result = dog.see(owner)\r\n\r\n  assert_equal \'wagging my tail\', result\r\nend\r\n```\r\n\r\nThe mistake is often caused by lack of knowledge about the domain because the developer is unfamiliar with the domain. So, instead of blindly adding new tests, during the refactoring step - we must review the existing tests and make decisions about deleting or updating the tests to reflect our growing knowledge about the domain. By doing so, we as developers make the transition from \"Me Milk\" to \"Please give me some milk to drink.\"\r\n\r\n> A test must be syntactically and semantically correct. Ruby interpreter enforces the syntactic correctness of a test. It is the developer\'s responsibility to enforce the semantic correctness of a test.\r\n\r\nI discuss this in depth in my upcoming TDD in Ruby book scheduled for release in March 2017 by Apress. Subscribe to my newsletter if you want to be notified about the discount coupon codes for the upcoming book.','2017-01-27 21:56:35','2017-01-27 21:56:35'),(4501,'Implementation Aware Tests in TDD','One of the most common mistake in TDD is writing tests that are aware of the implementation details. It could be data structure used in the code. For instance, in the example below, the test is aware of the fact that the concept of color is represented as a string.\r\n\r\n```ruby\r\nrequire \'minitest/autorun\'\r\n\r\nclass Grass\r\n  attr_reader :color\r\n\r\n  def initialize\r\n    @color = \'green\'\r\n  end  \r\nend\r\n\r\ndescribe Grass do\r\n  it \'is green\' do\r\n    grass = Grass.new\r\n    result = grass.color\r\n    assert_equal \'green\', result\r\n  end\r\nend\r\n```\r\n\r\nThe design decision of how to represent color could change to RGB values, Struct etc. In this case, the client code would like this:\r\n\r\n```ruby\r\ngrass = Grass.new\r\nif grass.color == \'green\'\r\n  puts \"Well maintained lawn\"\r\nelse\r\n  puts \"Grass is brown\"\r\nend\r\n```\r\n\r\nIf we do not hide the design decisions from the clients, we will break them when we change our design decision. We can hide the design decision by rewriting our test and implementation as shown below:\r\n\r\n```ruby\r\nrequire \'minitest/autorun\'\r\n\r\nclass Grass  \r\n  def initialize\r\n    @color = \'green\'\r\n  end  \r\n\r\n  def green?\r\n    @color == \'green\'\r\n  end\r\nend\r\n\r\ndescribe Grass do\r\n  it \'is green\' do\r\n    grass = Grass.new\r\n    result = grass.green?\r\n    assert result\r\n  end\r\nend\r\n```\r\n\r\nIn this case, our class does not expose its internal data representation to its clients. It provides a higher level, well defined interface green? that encapsulates the data to provide a service to it’s clients. In this case, contrast the client code shown below to the previous version of the client code.\r\n\r\n```ruby\r\ngrass = Grass.new\r\nif grass.green?\r\n  puts \"Well maintained lawn\"\r\nelse\r\n  puts \"Grass is brown\"\r\nend\r\n```\r\n\r\nThe client has no knowledge about whether the color is a string, Struct or RGB values. It does not ask for data and process the data to make a decision. It uses the boolean return value of the green? method in the conditional. This makes it immune to any changes to the way the color is represented inside the Green class.\r\n\r\nI discuss this in depth in my upcoming TDD in Ruby book scheduled for release in March 2017 by Apress. Subscribe to my newsletter if you want to be notified about the discount coupon codes for the upcoming book.','2017-01-27 21:58:07','2017-01-27 22:01:23'),(4511,'Twitter Bootstrap 4 : Setup Environment','The current version of rubyplus.com uses Twitter Bootstrap 3.3. The goal of the Twitter Bootstrap article series is to migrate it to Twitter Bootstrap 4. The upgrade is the most painful thing in a Rails project. Front-end developers find it difficult to run different servers and all the dependencies in Gemfile just to test changes to their static files. Separating the front-end allows the secret sauce to remain in Rails app. It is easier to delegate UI tasks without asking someone to sign NDA. Front-end developers can use their favorite tools to develop the front-end part of the application. It is easier and faster to prototype workflow.\r\n\r\nThere is no need to argue about NodeJS vs Rails. We can leverage the strengths of both these technologies and minimize the drawbacks by using them where it makes sense. They can co-exist. In this article, we will write a simple hello world html file and setup the environment to work on our migration project. Let\'s create a simple hello bootstrap html page. Create hello.html with the following contents:\r\n\r\n```html\r\n<!DOCTYPE html>\r\n<html lang=\"en\">\r\n  <head>\r\n    <title>RubyPlus</title>\r\n    \r\n    <!-- Required meta tags -->\r\n    <meta charset=\"utf-8\">\r\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1, shrink-to-fit=no\">\r\n\r\n    <!-- Bootstrap CSS -->\r\n    <link rel=\"stylesheet\" href=\"https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-alpha.6/css/bootstrap.min.css\" integrity=\"sha384-rwoIResjU2yc3z8GV/NPeZWAv56rSmLldC3R/AZzGRnGxQQKnKkoFVhFQhNUwEyJ\" crossorigin=\"anonymous\">\r\n  </head>\r\n  <body>\r\n    <h1>Hello Bootstrap 4</h1>\r\n    <!-- jQuery first, then Tether, then Bootstrap JS. -->\r\n    <script src=\"https://code.jquery.com/jquery-3.1.1.slim.min.js\" integrity=\"sha384-A7FZj7v+d/sdmMqp/nOQwliLvUsJfDHW+k9Omg/a/EheAdgtzNs3hpfag6Ed950n\" crossorigin=\"anonymous\"></script>\r\n    <script src=\"https://cdnjs.cloudflare.com/ajax/libs/tether/1.4.0/js/tether.min.js\" integrity=\"sha384-DztdAPBWPRXSA/3eYEEUWrWCy7G5KFbe8fFjk5JAIxUYHKkDx6Qin1DkWx51bBrb\" crossorigin=\"anonymous\"></script>\r\n    <script src=\"https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-alpha.6/js/bootstrap.min.js\" integrity=\"sha384-vBWWzlZJ8ea9aCX4pEW3rVHjgjt7zpkNpZk+02D9phzyeVkE+jo0ieGizqPLForn\" crossorigin=\"anonymous\"></script>\r\n  </body>\r\n</html>\r\n```\r\n\r\nThis html page is the starter template copied from Twitter Bootstrap 4 home page. This page uses CDN. If we need to develop without internet connection we need to download the css, javascript files and store in locally in our file system. This will become tedious to keep upto date with the changes as the project grows. We can use bower to manage the dependencies. You need NodeJS installed on your machine. You can then install bower:\r\n\r\n```\r\nnpm install -g bower\r\n```\r\n\r\nWe can install the bootstrap 4 by running the bower command:\r\n\r\n```\r\nbower install bootstrap#v4.0.0-alpha.6\r\n```\r\n\r\nThis will install all the required libraries (bootstrap, jquery and tether) in bower_components under your project directory.  We can now change the html page to use the libraries installed by the bower.\r\n\r\n```html\r\n<!DOCTYPE html>\r\n<html lang=\"en\">\r\n<head>\r\n    <meta charset=\"utf-8\">\r\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1,shrink-to-fit=no\">\r\n    <meta http-equiv=\"x-ua-compatible\" content=\"ie=edge\">\r\n    <title>RubyPlus</title>\r\n    <link rel=\"stylesheet\" href=\"bower_components/bootstrap/dist/css/bootstrap.min.css\">\r\n    <link rel=\"stylesheet\" href=\"bower_components/tether/dist/css/tether.min.css\">\r\n</head>\r\n<body>\r\n    <div class=\"alert alert-info\">\r\n        Hello Bootstrap 4\r\n    </div>\r\n    <script src=\"bower_components/jquery/dist/jquery.min.js\"></script>\r\n    <script src=\"bower_components/tether/dist/js/tether.min.js\">\r\n    </script>\r\n    <script src=\"bower_components/bootstrap/dist/js/bootstrap.min.js\">\r\n    </script>\r\n</body>\r\n</html>\r\n```\r\n\r\nWe are now ready to start developing the Bootstrap 4 version of rubyplus.com. We will continue adding new features to this webapp in the upcoming articles.','2017-01-29 01:03:45','2017-01-29 03:25:24'),(4521,'Twitter Bootstrap 4 : Grid System','You can use a container class to hold all contents in a page. It renders the contents of a page to a fixed width. Add the following code within the body section of the html page we created in the previous article.\r\n\r\n```html\r\n<div class=\"container\">\r\n    <h1>Hello Container</h1>\r\n</div>\r\n<div>\r\n    <h1>I am outside the container</h1>\r\n</div>\r\n\r\n<p>You can also use class=\'container-fluid\'</p>\r\n```\r\n\r\nContainer fluid takes up the full-width of the viewport, except for 15 pixels padding left and right. Inside the container, you can have as many rows as you want.\r\n\r\n```html\r\n<div class=\"container\">\r\n  <h1>Inside Container</h1>\r\n  <div class=\"row\">\r\n      <div>Row 1</div>\r\n  </div>\r\n  <div class=\"row\">\r\n      <div>Row 2</div>\r\n  </div>\r\n  <div class=\"row\">\r\n      <div>Row 3</div>\r\n  </div>\r\n</div>\r\n  \r\n<div>\r\n  <h1>Outside Container</h1>\r\n</div>  \r\n```\r\n\r\nYou can define columns within a row like this:\r\n\r\n```html\r\n<div class=\"container\">\r\n  <h1>Columns within a Row</h1>\r\n  <div class=\"row\">\r\n    <div class=\"col-sm-1\">Col 1</div>\r\n    <div class=\"col-sm-1\">Col 2</div>\r\n    <div class=\"col-sm-1\">Col 3</div>\r\n    <div class=\"col-sm-1\">Col 4</div>\r\n    <div class=\"col-sm-1\">Col 5</div>\r\n    <div class=\"col-sm-1\">Col 6</div>\r\n    <div class=\"col-sm-1\">Col 7</div>\r\n    <div class=\"col-sm-1\">Col 8</div>\r\n    <div class=\"col-sm-1\">Col 9</div>\r\n    <div class=\"col-sm-1\">Col 10</div>\r\n    <div class=\"col-sm-1\">Col 11</div>\r\n    <div class=\"col-sm-1\">Col 12</div>\r\n  </div>\r\n</div>\r\n\r\n<p>Smaller view ports revert to a stacked view</p>\r\n```\r\n\r\nThe twelve columns will render within one row on desktop, if the device is small to display all the columns you will see the columns stacked over each other. You can define columns that add up to 12 within a row like this:\r\n\r\n```html\r\n<div class=\"container\">\r\n  <h1>Breaking News</h1>\r\n  <div class=\"row\">\r\n    <div class=\"col-sm-3\">Section 1</div>\r\n    <div class=\"col-sm-3\">Section 2</div>\r\n    <div class=\"col-sm-3\">Section 3</div>\r\n    <div class=\"col-sm-3\">Section 4</div>\r\n  </div>\r\n</div>\r\n```\r\n\r\n<img src=\"https://1.bp.blogspot.com/-Fb4T-dEc6oc/WI73I2tcq1I/AAAAAAAABS0/F4scGDMz0U40dg1NF9LvVUny4GMkrya1ACLcB/s1600/Screen%2BShot%2B2017-01-30%2Bat%2B12.11.38%2BAM.png\" alt=\"Twitter Bootstrap 4\" style=\"border: 1px solid #000; max-width:800px; max-height:600px;\" />\r\n\r\nIf you want the elements to take up a different number of columns as the viewport size changes, you can define the column widths for all breakpoints, and Bootstrap will decide which rule to apply. \r\n\r\n```html\r\n<div class=\"container\">\r\n  <h1>Breaking News</h1>\r\n  <div class=\"row\">\r\n    <div class=\"col-xs-6 col-sm-3\">Section 1</div>\r\n    <div class=\"col-xs-6 col-sm-3\">Section 2</div>\r\n    <div class=\"col-xs-6 col-sm-3\">Section 3</div>\r\n    <div class=\"col-xs-6 col-sm-3\">Section 4</div>\r\n  </div>\r\n</div>\r\n```\r\n\r\n<img src=\"https://4.bp.blogspot.com/-qraTLsXrtz0/WI73I0cE7YI/AAAAAAAABS8/Kx_7FnwnrkkR8QwD0bucFbnWZSx19ASXQCLcB/s1600/Screen%2BShot%2B2017-01-30%2Bat%2B12.10.44%2BAM.png\" alt=\"Twitter Bootstrap 4\" style=\"border: 1px solid #000; max-width:800px; max-height:600px;\" />\r\n\r\nYou can nest the rows and columns like this:\r\n\r\n```html\r\n<div class=\"container\">\r\n  <h1>Breaking News</h1>\r\n  <div class=\"row\">\r\n    <div class=\"col-xs-6 col-sm-3\">\r\n      <h5>Headline 1</h5>\r\n      <div class=\"row\">\r\n        <div class=\"col-sm-4\">Section 1</div>\r\n        <div class=\"col-sm-4\">Section 2</div>\r\n        <div class=\"col-sm-4\">Section 3</div>\r\n      </div>\r\n    </div>\r\n    <div class=\"col-xs-6 col-sm-3\">\r\n      <h5>Headline 2</h5>\r\n      <div class=\"row\">\r\n        <div class=\"col-sm-4\">Section 4</div>\r\n        <div class=\"col-sm-4\">Section 5</div>\r\n        <div class=\"col-sm-4\">Section 6</div>\r\n      </div>\r\n    </div>\r\n    <div class=\"col-xs-6 col-sm-3\">\r\n      <h5>Headline 3</h5>\r\n      <div class=\"row\">\r\n        <div class=\"col-sm-4\">Section 7</div>\r\n        <div class=\"col-sm-4\">Section 8</div>\r\n        <div class=\"col-sm-4\">Section 9</div>\r\n      </div>\r\n    </div>\r\n    <div class=\"col-xs-6 col-sm-3\">\r\n      <h5>Headline 4</h5>\r\n      <div class=\"row\">\r\n        <div class=\"col-sm-4\">Section 10</div>\r\n        <div class=\"col-sm-4\">Section 11</div>\r\n        <div class=\"col-sm-4\">Section 12</div>\r\n      </div>\r\n    </div>\r\n  </div>\r\n</div>    \r\n```\r\n\r\n<img src=\"https://3.bp.blogspot.com/-bNYAJP4TQ_M/WI73I-q0bbI/AAAAAAAABS4/b9F7_0yXzAEuP15UMBNAKbX6fzY5liJMACLcB/s1600/Screen%2BShot%2B2017-01-30%2Bat%2B12.10.31%2BAM.png\" alt=\"Twitter Bootstrap 4\" style=\"border: 1px solid #000; max-width:800px; max-height:600px;\" />\r\n\r\nIn this article, we saw how the Twitter Bootstrap 4 grid works by experimenting with the rows, columns and viewport related classes to layout the webpage.','2017-01-29 20:23:07','2017-01-30 08:23:14'),(4531,'Twitter Bootstrap 4 : Layout Basics','## Navigation Bar\r\n\r\nLet\'s create the navigation bar that has brand, links and a search box. Add the code for the navigation bar just below the body tag:\r\n\r\n```html\r\n<nav class=\"navbar navbar-toggleable-md navbar-light bg-faded\">\r\n  <button class=\"navbar-toggler navbar-toggler-right\" type=\"button\" data-toggle=\"collapse\" data-target=\"#navbarSupportedContent\" aria-controls=\"navbarSupportedContent\" aria-expanded=\"false\" aria-label=\"Toggle navigation\">\r\n    <span class=\"navbar-toggler-icon\"></span>\r\n  </button>\r\n  <a class=\"navbar-brand\" href=\"#\">RubyPlus</a>\r\n\r\n  <div class=\"collapse navbar-collapse\" id=\"navbarSupportedContent\">\r\n    <ul class=\"navbar-nav mr-auto\">\r\n      <li class=\"nav-item active\">\r\n        <a class=\"nav-link\" href=\"#\">Products <span class=\"sr-only\">(current)</span></a>\r\n      </li>\r\n      <li class=\"nav-item\">\r\n        <a class=\"nav-link\" href=\"#\">Screencasts</a>\r\n      </li>\r\n      <li class=\"nav-item\">\r\n        <a class=\"nav-link\" href=\"#\">Podcasts</a>\r\n      </li>\r\n      <li class=\"nav-item\">\r\n        <a class=\"nav-link\" href=\"#\">Articles</a>\r\n      </li>\r\n      <li class=\"nav-item\">\r\n        <a class=\"nav-link\" href=\"#\">Subscribe</a>\r\n      </li>\r\n      <li class=\"nav-item\">\r\n        <a class=\"nav-link\" href=\"#\">Login</a>\r\n      </li>\r\n    </ul>\r\n    <form class=\"form-inline my-2 my-lg-0\">\r\n      <input class=\"form-control mr-sm-2\" type=\"text\" placeholder=\"Search\">\r\n      <button class=\"btn btn-outline-success my-2 my-sm-0\" type=\"submit\">Search</button>\r\n    </form>\r\n  </div>\r\n</nav>\r\n```\r\n\r\n<img src=\"https://2.bp.blogspot.com/-8KUnD5Ria_4/WI7xENhhyWI/AAAAAAAABSU/1afrUC3Gt6UrEOO-7PVh0oU6pPRj8tbMgCLcB/s1600/Screen%2BShot%2B2017-01-29%2Bat%2B11.50.55%2BPM.png\" alt=\"Twitter Bootstrap 4 Navigation\" style=\"border: 1px solid #000; max-width:800px; max-height:600px;\" />\r\n\r\nThe navbar-light class defines the color of the navigation bar. The navbar-collapse class displays the hamburger when the width of the screen becomes small. The products link is highlighted by using the active class. The following section of the code makes clicking the hamburger button display the links stacked over each other when the screen width becomes small:\r\n\r\n```html\r\n    <button class=\"navbar-toggler navbar-toggler-right\" type=\"button\" data-toggle=\"collapse\" data-target=\"#navbarSupportedContent\" aria-controls=\"navbarSupportedContent\" aria-expanded=\"false\" aria-label=\"Toggle navigation\">\r\n      <span class=\"navbar-toggler-icon\"></span>\r\n    </button>\r\n```\r\n\r\n<img src=\"https://4.bp.blogspot.com/-eFFdNTLxSxk/WI7xD0Ef1sI/AAAAAAAABSQ/MK0orReIMIABRw_qEzPbhGVqWScVavmXwCLcB/s1600/Screen%2BShot%2B2017-01-29%2Bat%2B11.51.22%2BPM.png\" alt=\"Twitter Bootstrap 4 Navigation\" style=\"border: 1px solid #000; max-width:800px; max-height:600px;\"/>\r\n\r\n<img src=\"https://4.bp.blogspot.com/-8oEGQImEFcs/WI7xEQBUJZI/AAAAAAAABSc/TvZTl-MYuVYt5TxVIIocJk-wqzjM0bzQwCLcB/s1600/Screen%2BShot%2B2017-01-29%2Bat%2B11.51.38%2BPM.png\" alt=\"Twitter Bootstrap 4 Navigation\" style=\"border: 1px solid #000; max-width:800px; max-height:600px;\"/>\r\n\r\n## Sticky Footer\r\n\r\nCreate sticky_footer.css to make the footer stay at the bottom of the page.\r\n\r\n```css\r\n/* Sticky footer styles\r\n-------------------------------------------------- */\r\nhtml {\r\n  position: relative;\r\n  min-height: 100%;\r\n}\r\nbody {\r\n  /* Margin bottom by footer height */\r\n  margin-bottom: 60px;\r\n}\r\n.footer {\r\n  position: absolute;\r\n  bottom: 0;\r\n  width: 100%;\r\n  /* Set the fixed height of the footer here */\r\n  height: 60px;\r\n  line-height: 60px; /* Vertically center the text there */\r\n  background-color: #f5f5f5;\r\n}\r\n```\r\n\r\nThe complete html file looks like this:\r\n\r\n```html\r\n<!DOCTYPE html>\r\n<html lang=\"en\">\r\n<head>\r\n    <meta charset=\"utf-8\">\r\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1,shrink-to-fit=no\">\r\n    <meta http-equiv=\"x-ua-compatible\" content=\"ie=edge\">\r\n    <title>RubyPlus</title>\r\n    <link rel=\"stylesheet\" href=\"../bower_components/bootstrap/dist/css/bootstrap.min.css\">\r\n    <link rel=\"stylesheet\" href=\"../bower_components/tether/dist/css/tether.min.css\">\r\n    <link rel=\"stylesheet\" href=\"sticky_footer.css\">\r\n</head>\r\n<body>\r\n  <nav class=\"navbar navbar-toggleable-md navbar-light bg-faded\">\r\n    <button class=\"navbar-toggler navbar-toggler-right\" type=\"button\" data-toggle=\"collapse\" data-target=\"#navbarSupportedContent\" aria-controls=\"navbarSupportedContent\" aria-expanded=\"false\" aria-label=\"Toggle navigation\">\r\n      <span class=\"navbar-toggler-icon\"></span>\r\n    </button>\r\n    <a class=\"navbar-brand\" href=\"#\">RubyPlus</a>\r\n    <div class=\"collapse navbar-collapse\" id=\"navbarSupportedContent\">\r\n      <ul class=\"navbar-nav mr-auto\">\r\n        <li class=\"nav-item active\">\r\n          <a class=\"nav-link\" href=\"#\">Products <span class=\"sr-only\">(current)</span></a>\r\n        </li>\r\n        <li class=\"nav-item\">\r\n          <a class=\"nav-link\" href=\"#\">Screencasts</a>\r\n        </li>\r\n        <li class=\"nav-item\">\r\n          <a class=\"nav-link\" href=\"#\">Podcasts</a>\r\n        </li>\r\n        <li class=\"nav-item\">\r\n          <a class=\"nav-link\" href=\"#\">Articles</a>\r\n        </li>\r\n        <li class=\"nav-item\">\r\n          <a class=\"nav-link\" href=\"#\">Subscribe</a>\r\n        </li>\r\n        <li class=\"nav-item\">\r\n          <a class=\"nav-link\" href=\"#\">Login</a>\r\n        </li>\r\n      </ul>\r\n      <form class=\"form-inline my-2 my-lg-0\">\r\n        <input class=\"form-control mr-sm-2\" type=\"text\" placeholder=\"Search\">\r\n        <button class=\"btn btn-outline-success my-2 my-sm-0\" type=\"submit\">Search</button>\r\n      </form>\r\n    </div>\r\n  </nav>\r\n    <div class=\'container-fluid\'>\r\n        Main content goes here.\r\n    </div>\r\n      <footer class=\"footer\">\r\n        <div class=\"container text-center\">\r\n          <span>\r\n            &copy; 2013 - 2017 RubyPlus | \r\n            <a href=\"#\">About</a> &middot; <a href=\"#\">Contact</a> &middot; <a href=\"#\">Jobs</a> \r\n          </span>\r\n        </div>\r\n      </footer>  \r\n    <script src=\"../bower_components/jquery/dist/jquery.min.js\"></script>\r\n    <script src=\"../bower_components/tether/dist/js/tether.min.js\">\r\n    </script>\r\n    <script src=\"../bower_components/bootstrap/dist/js/bootstrap.min.js\">\r\n    </script>\r\n</body>\r\n</html>\r\n```\r\n\r\nThe main content section uses container-fluid class. This was discussed in a previous article.','2017-01-30 07:46:33','2017-01-30 08:59:05'),(4541,'Twitter Bootstrap 4 : Customizing Navigation and Icons','## Customizing Navigation Bar\r\n\r\nYou can make navigation bar dark by using the classes navbar-inverse bg-inverse in the nav tag : \r\n  \r\n```html  \r\n<nav class=\"navbar navbar-toggleable-md navbar-inverse bg-inverse\">\r\n```\r\n  \r\nThis will make it easy for color blind people to view your site.\r\n\r\n## Icons \r\n\r\nWe can use the free font-awesome library for displaying icons. Install it using bower.\r\n\r\n```  \r\n$bower install components-font-awesome\r\nbower components-font-awesome#*       not-cached https://github.com/components/font-awesome.git#*\r\nbower components-font-awesome#*          resolve https://github.com/components/font-awesome.git#*\r\nbower components-font-awesome#*         download https://github.com/components/font-awesome/archive/4.7.0.tar.gz\r\nbower components-font-awesome#*          extract archive.tar.gz\r\nbower components-font-awesome#*         resolved https://github.com/components/font-awesome.git#4.7.0\r\nbower components-font-awesome#^4.7.0     install components-font-awesome#4.7.0\r\n\r\ncomponents-font-awesome#4.7.0 bower_components/components-font-awesome\r\n```\r\n\r\nAdd the link to font-awesome css within the head section of the html page :\r\n\r\n```html\r\n<link rel=\"stylesheet\" href=\"bower_components/components-font-awesome/css/font-awesome.min.css\" />\r\n```\r\n\r\nThe head section of the html page will look like this:\r\n\r\n```html\r\n<html lang=\"en\">\r\n<head>\r\n    <meta charset=\"utf-8\">\r\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1,shrink-to-fit=no\">\r\n    <meta http-equiv=\"x-ua-compatible\" content=\"ie=edge\">\r\n    <title>RubyPlus</title>\r\n    <link rel=\"stylesheet\" href=\"../bower_components/bootstrap/dist/css/bootstrap.min.css\">\r\n    <link rel=\"stylesheet\" href=\"../bower_components/tether/dist/css/tether.min.css\">\r\n    <link rel=\"stylesheet\" href=\"../bower_components/components-font-awesome/css/font-awesome.min.css\" />\r\n    <link rel=\"stylesheet\" href=\"sticky_footer.css\" >\r\n</head>\r\n<body>\r\n\r\nRest of the html is the same as before\r\n```\r\n\r\nSearch for the term time in http://glyphsearch.com, you will get the name of the clock icon in the search results. If you click on the icon you will copy the class needed to include it in your web page. For clock, it is:\r\n\r\n```html\r\n<i class=\"fa fa-clock-o\"></i>\r\n```\r\n\r\nYou can display this icon next to the publish date for a blog a post. You will find useful user account related icons such as:\r\n\r\n```\r\nfa-user  \r\nfa-cog\r\nfa-sign-out\r\n```\r\n\r\nin the font-awesome library. You can add the clock icon to page by adding the code within the container div.\r\n\r\n```html\r\n<div class=\'container-fluid\'>\r\n    <i class=\"fa fa-clock-o\"></i>\r\n</div>\r\n```  \r\n\r\nIn this article, you learned how to customize the Twitter Bootstrap 4 navigation bar and use Font Awesome icons in html pages.','2017-01-30 18:50:09','2017-01-30 18:52:14'),(4551,'Twitter Bootstrap 4 : About and Contact Pages','You can use form-group and input-group classes to create a form. The has-danger class is used when there is an error in the input. The Contact Us page is as follows:\r\n\r\n```html\r\n<div class=\"container\">\r\n  <h3>Contact Us</h3>\r\n    <form>\r\n      <div class=\"form-group input-group\">\r\n        <span class=\"input-group-addon\"><i class=\"fa fa-user\"></i></span>\r\n        <input type=\"text\" class=\"form-control\" placeholder=\"Your name\">\r\n      </div>\r\n        \r\n      <div class=\"form-group input-group has-danger\">\r\n        <span class=\"input-group-addon\"><i class=\"fa fa-at\"></i></span>\r\n        <input type=\"text\" class=\"form-control form-control-danger\" placeholder=\"Your email address\">\r\n      </div>\r\n\r\n      <div class=\"form-group\">\r\n        <label for=\"name\">Your message</label>\r\n        <textarea class=\"form-control\" rows=\"5\" id=\"message\"></textarea>\r\n      </div>\r\n      \r\n      <div class=\"form-group\">\r\n        <button class=\"btn btn-success\">\r\n          <i class=\"fa fa-send-o\"></i>\r\n          Send\r\n        </button>\r\n      </div>\r\n    </form>\r\n</div>\r\n```\r\n\r\nIt looks like this:\r\n\r\n<img src=\"https://2.bp.blogspot.com/-W-029TKXsqM/WI-r6Z7FMHI/AAAAAAAABTY/PH4NZjK8HzYSL3WJcP-UD_OMbtChOb4AQCLcB/s1600/Contact.png\" alt=\"Twitter Bootstrap 4\" style=\"border: 1px solid #000; max-width:800px; max-height:600px;\" />\r\n\r\nWe can use the card component to draw a nice border around the about page. The image is displayed to the left and the bio, on the right.\r\n\r\n```html\r\n<div class=\'container-fluid\'>\r\n  <div class=\"card card-block bg-faded\">\r\n    <div class=\"media\">\r\n      <div class=\"media-left\">\r\n        <img class=\"media-object\" src=\"../me.jpg\" alt=\"Bala Paranj\">  \r\n      </div>\r\n      <div class=\"media-body\">\r\n        <h4 class=\"media-heading\">Bala Paranj</h4>\r\n            Bala Paranj has a masters degree in Electrical Engineering from Wichita State University. He has been working in the software industry since 1996. He started his career as Technical Support Engineer and became a Web Developer using Perl, Java and Ruby. He is a published author of the upcoming book by Apress, TDD in Ruby.          \r\n      </div>\r\n    </div>    \r\n  </div>\r\n</div>\r\n```\r\n\r\n<img src=\"https://2.bp.blogspot.com/-693y25T_U30/WI-r6i4-tlI/AAAAAAAABTc/jxqwDohwsVkQAghixwimm5c1f4oJL6VcQCLcB/s1600/About.png\" alt=\"Twitter Bootstrap 4\" style=\"border: 1px solid #000; max-width:800px; max-height:600px;\" />\r\n\r\nIn this article, you learned how to style About and Contact pages in Twitter Bootstrap 4.\r\n','2017-01-30 21:17:06','2017-01-30 21:17:06'),(4561,'Twitter Bootstrap 4 : Lightbox','In this article, you will learn how to use [Bootstrap Lightbox](http://ashleydw.github.io/lightbox/#single-image) to display images. According to the readme, ekko-lightbox is:\r\n\r\n> A lightbox module for Bootstrap that supports images, YouTube videos, and galleries - built around Bootstrap\'s Modal plugin.\r\n\r\nInstall the ekko-lightbox library.\r\n\r\n```\r\nbower install ekko-lightbox --save\r\n```\r\n\r\nAdd the javascript to display the lightbox when a user clicks on the thumbnail to the end of the body section:\r\n\r\n```javascript\r\n<script type=\"text/javascript\">\r\n    $(document).on(\'click\', \'[data-toggle=\"lightbox\"]\', function(event) {\r\n        event.preventDefault();\r\n        $(this).ekkoLightbox();\r\n    });\r\n</script>\r\n```\r\n\r\nAdd the data-toggle attribute to the image link to trigger the lightbox:\r\n\r\n```html\r\n<a href=\"../me.jpg\" data-toggle=\"lightbox\">\r\n  <img src=\"../me.jpg\" class=\"img-fluid\" align=\"left\" width=\"80\" height=\"45\">\r\n</a>\r\n```\r\n\r\nAdd the lightbox javascript to the botom of the page before the end of the body tag:\r\n\r\n```html\r\n<script src=\"../bower_components/bootstrap/ekko-lightbox/dist/ekko-lightbox.min.js\"></script>\r\n```\r\n\r\nAdd link to lightbox CSS within the head tag:\r\n\r\n```html\r\n<link rel=\"stylesheet\" href=\"../bower_components/ekko-lightbox/dist/ekko-lightbox.min.css\" />\r\n```\r\n\r\nThe entire file looks like this:\r\n\r\n```html\r\n<!DOCTYPE html>\r\n<html lang=\"en\">\r\n<head>\r\n    <meta charset=\"utf-8\">\r\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1,shrink-to-fit=no\">\r\n    <meta http-equiv=\"x-ua-compatible\" content=\"ie=edge\">\r\n    <title>RubyPlus</title>\r\n    <link rel=\"stylesheet\" href=\"../bower_components/bootstrap/dist/css/bootstrap.min.css\">\r\n    <link rel=\"stylesheet\" href=\"../bower_components/tether/dist/css/tether.min.css\">\r\n    <link rel=\"stylesheet\" href=\"../bower_components/components-font-awesome/css/font-awesome.min.css\" />\r\n    <link rel=\"stylesheet\" href=\"../bower_components/ekko-lightbox/dist/ekko-lightbox.min.css\" />\r\n    <link rel=\"stylesheet\" href=\"sticky_footer.css\" >\r\n</head>\r\n<body>\r\n  <nav class=\"navbar navbar-toggleable-md navbar-inverse bg-inverse\">\r\n    <button class=\"navbar-toggler navbar-toggler-right\" type=\"button\" data-toggle=\"collapse\" data-target=\"#navbarSupportedContent\" aria-controls=\"navbarSupportedContent\" aria-expanded=\"false\" aria-label=\"Toggle navigation\">\r\n      <span class=\"navbar-toggler-icon\"></span>\r\n    </button>\r\n    <a class=\"navbar-brand\" href=\"#\">RubyPlus</a>\r\n\r\n    <div class=\"collapse navbar-collapse\" id=\"navbarSupportedContent\">\r\n      <ul class=\"navbar-nav mr-auto\">\r\n        <li class=\"nav-item active\">\r\n          <a class=\"nav-link\" href=\"#\">Products <span class=\"sr-only\">(current)</span></a>\r\n        </li>\r\n        <li class=\"nav-item\">\r\n          <a class=\"nav-link\" href=\"#\">Screencasts</a>\r\n        </li>\r\n        <li class=\"nav-item\">\r\n          <a class=\"nav-link\" href=\"#\">Podcasts</a>\r\n        </li>\r\n        <li class=\"nav-item\">\r\n          <a class=\"nav-link\" href=\"#\">Articles</a>\r\n        </li>\r\n        <li class=\"nav-item\">\r\n          <a class=\"nav-link\" href=\"#\">Subscribe</a>\r\n        </li>\r\n        <li class=\"nav-item\">\r\n          <a class=\"nav-link\" href=\"#\">Login</a>\r\n        </li>\r\n      </ul>\r\n      <form class=\"form-inline my-2 my-lg-0\">\r\n        <input class=\"form-control mr-sm-2\" type=\"text\" placeholder=\"Search\">\r\n        <button class=\"btn btn-outline-success my-2 my-sm-0\" type=\"submit\">Search</button>\r\n      </form>\r\n    </div>\r\n  </nav>\r\n  \r\n    <div class=\'container-fluid\'>\r\n      <div>\r\n        <h3>#1 Integrate Twitter Bootstrap 4 with Rails 5</h3>\r\n        <p>\r\n          <a href=\"../me.jpg\" data-toggle=\"lightbox\">\r\n            <img src=\"../me.jpg\" class=\"img-fluid\" align=\"left\" width=\"80\" height=\"45\">\r\n          </a>\r\n                       Lorem ipsum dolor sit amet, consectetur adipiscing elit.\r\n                       Curabitur leo dolor,\r\n                       fringilla vel lacus at, auctor finibus ipsum. Lorem ipsum dolor\r\n                       sit amet.\r\n           </p>\r\n           <h3>#2 Integrate Stripe with Rails 5</h3>\r\n           <p>\r\n             <img src=\"../me.jpg\" align=\"left\" width=\"80\" height=\"45\"/>\r\n                       Lorem ipsum dolor sit amet, consectetur adipiscing elit.\r\n                       Curabitur leo dolor,\r\n                       fringilla vel lacus at, auctor finibus ipsum. Lorem ipsum\r\n                       dolor sit amet.\r\n             </p>\r\n        </div>\r\n    </div>\r\n\r\n    <footer class=\"footer\">\r\n      <div class=\"container text-center\">\r\n        <span>\r\n          &copy; 2013 - 2017 RubyPlus | \r\n          <a href=\"#\">About</a> &middot; <a href=\"#\">Contact</a> &middot; <a href=\"#\">Jobs</a> \r\n        </span>\r\n    \r\n      </div>\r\n    </footer>  \r\n        \r\n    <script src=\"../bower_components/jquery/dist/jquery.min.js\"></script>\r\n    <script src=\"../bower_components/tether/dist/js/tether.min.js\"></script>\r\n    <script src=\"../bower_components/bootstrap/dist/js/bootstrap.min.js\"></script>\r\n    <script src=\"../bower_components/ekko-lightbox/dist/ekko-lightbox.min.js\"></script>\r\n    \r\n<script type=\"text/javascript\">\r\n    $(document).on(\'click\', \'[data-toggle=\"lightbox\"]\', function(event) {\r\n        event.preventDefault();\r\n        $(this).ekkoLightbox();\r\n    });\r\n</script>\r\n</body>\r\n</html>\r\n```\r\n\r\nYou can now click on thumbnail image in the first row to display the bigger version of the image. It will look like the screenshot shown below.\r\n\r\n<img src=\"https://4.bp.blogspot.com/-TN2Gmpcan38/WI_hba5aW3I/AAAAAAAABT0/HZSCMEC4opIZ5PygytqkYBPAFZ4-2bpQgCLcB/s1600/Screen%2BShot%2B2017-01-30%2Bat%2B4.57.46%2BPM.png\" alt=\"Twitter Bootstrap 4\" style=\"border: 1px solid #000; max-width:800px; max-height:600px;\" />\r\n\r\nRead the documentation for [ekko-lightbox](http://ashleydw.github.io/lightbox/#image-gallery) to learn how to use it for image gallery, video gallery and more.','2017-01-31 01:01:40','2017-01-31 02:52:24'),(4571,'How to integrate Bootstrap 4 in Rails 5 without any Gems','## Managing the Twitter Bootstrap 4 Library using Node\r\n\r\nSome of the steps found in [How to install Bootstrap 4 in Rails](https://mixandgo.com/blog/how-to-install-bootstrap-4-in-rails) are manual. I wanted to automate those steps. I also did not want to depend on any gems to minimize dependencies and avoid problems. Create a new Rails 5 project.\r\n\r\n```\r\nrails new bt4a\r\n```\r\n\r\nWe will use NodeJS to install everything we need. Create a new directory outside the Rails 5 project directory structure. I have node version 6.9.2 installed on my Mac. Use bower to install Bootstrap 4. You must already have bower installed. Read the [Twitter Bootstrap 4 Setup Environment](https://rubyplus.com/articles/4511-Twitter-Bootstrap-4-Setup-Environment) article to learn how.\r\n\r\n```\r\n$bower install bootstrap#v4.0.0-alpha.6\r\n\r\nbower bootstrap#v4.0.0-alpha.6  cached https://github.com/twbs/bootstrap.git#4.0.0-alpha.6\r\nbower bootstrap#v4.0.0-alpha.6         validate 4.0.0-alpha.6 against https://github.com/twbs/bootstrap.git#v4.0.0-alpha.6\r\nbower jquery#>=1.9.1                     cached https://github.com/jquery/jquery-dist.git#3.1.1\r\nbower jquery#>=1.9.1                   validate 3.1.1 against https://github.com/jquery/jquery-dist.git#>=1.9.1\r\nbower tether#^1.4.0                      cached https://github.com/HubSpot/tether.git#1.4.0\r\nbower tether#^1.4.0                    validate 1.4.0 against https://github.com/HubSpot/tether.git#^1.4.0\r\nbower bootstrap#v4.0.0-alpha.6          install bootstrap#4.0.0-alpha.6\r\nbower jquery#>=1.9.1                    install jquery#3.1.1\r\nbower tether#^1.4.0                     install tether#1.4.0\r\n\r\nbootstrap#4.0.0-alpha.6 bower_components/bootstrap\r\n├── jquery#3.1.1\r\n└── tether#1.4.0\r\n\r\njquery#3.1.1 bower_components/jquery\r\n\r\ntether#1.4.0 bower_components/tether\r\n```\r\n\r\nInstall the Javascript task runner grunt.\r\n\r\n```\r\nnpm install -g grunt-cli\r\n```\r\n\r\nGenerate the css and javascript by running:\r\n\r\n```\r\ngrunt dist\r\n```\r\n\r\nThis results in the following error:\r\n\r\n```\r\nFatal error: Unable to find local grunt.\r\n```\r\n\r\nAccording to the home page:\r\n\r\n> Installing grunt-cli does not install the grunt task runner. The job of the grunt CLI is to run the version of grunt which has been installed next to a Gruntfile. This allows multiple versions of grunt to be installed on the same machine simultaneously.\r\n\r\nSo in your project folder, install the latest grunt version:\r\n\r\n```\r\nnpm install grunt --save-dev\r\n```\r\n\r\nNow run:\r\n\r\n```\r\ngrunt dist\r\n```\r\n\r\nThis results in the error:\r\n\r\n```\r\nA valid Gruntfile could not be found. Please see the getting started guide for more information on how to configure grunt: http://gruntjs.com/getting-started. Fatal error: Unable to find Gruntfile.\r\n```\r\n\r\nRun:\r\n\r\n```\r\nnpm init\r\n```\r\n\r\n```\r\ngrunt dist\r\n```\r\n\r\nThis results in the same error.\r\n\r\n\r\nNavigate to bootstrap directory and run, in my case, it is the directory: /Users/bparanj/temp/bt4/bower_components/bootstrap\r\n\r\nRun:\r\n\r\n```\r\nnpm install\r\n```\r\n\r\nThis will succeed because, the directory contains the package.json. Run:\r\n\r\n```\r\ngrunt dist\r\n```\r\n\r\nnpm hangs. I tried:\r\n\r\n```\r\nnpm install -g npm@next\r\n```\r\n\r\nThis does not fix the problem. I was not able to run grunt dist due to errors. Let\'s copy the bootstrap.js to vendor/assets/javascripts and bootstrap.css to vendor/assets/stylesheets. Create the home page controller.\r\n\r\n## Integrating Twitter Bootstrap 4 CSS with Rails 5\r\n\r\n```\r\nrails g controller welcome index\r\n```\r\n\r\nChange the layout file application.html.erb as follows:\r\n\r\n```rhtml\r\n<!DOCTYPE html>\r\n<html lang=\"en\">\r\n  <head>\r\n    <!-- Required meta tags -->\r\n    <meta charset=\"utf-8\">\r\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1, shrink-to-fit=no\">\r\n    \r\n    <title>RubyPlus</title>\r\n    <%= stylesheet_link_tag    \'application\', media: \'all\', \'data-turbolinks-track\': \'reload\' %>\r\n    <%= csrf_meta_tags %>\r\n  </head>\r\n  <body>\r\n    <div class=\"container\">\r\n      <%= yield %>\r\n    </div>\r\n    <%= javascript_include_tag \'application\', \'data-turbolinks-track\': \'reload\' %>\r\n  </body>\r\n</html>\r\n```\r\n\r\nAdd some code to test the Bootstrap 4 in welcome/index.html.erb:\r\n\r\n```rhtml\r\n<div class=\"row\">\r\n  <div class=\"col-sm-12 text-xs-center bootstrap-welcome\">\r\n    <h1>Bootstrap 4 Works!</h1>\r\n    <p class=\"lead\">Go ahead and build your awesome app now.</p>\r\n  </div>\r\n</div>\r\n```\r\n\r\nRename application.css to application.scss and add:\r\n\r\n```\r\n@import \"bootstrap\";\r\n```\r\n\r\nIf you fat-finger the name of the bootstrap files in the vendor directory you will get the error:\r\n\r\n```\r\nFile to import not found or unreadable: bootstrap.\r\n```\r\n\r\nAdd padding in welcome.scss:\r\n\r\n```css\r\n.bootstrap-welcome {\r\n  padding-top: 5em;\r\n}\r\n```\r\n\r\nYou will now see some space above the main content as shown in the following screenshot.\r\n\r\n<img src=\"https://3.bp.blogspot.com/-25vYtZv_vI0/WJAJfsiPpwI/AAAAAAAABUM/DmG4aFPo1i8Lq6Y2lO0Hq35scCrY4GlKwCLcB/s1600/hello-tb4.png\" alt=\"Twitter Bootstrap 4\" style=\"border: 1px solid #000; max-width:800px; max-height:600px;\" />\r\n\r\n## Integrating Bootstrap 4 Javascript with Rails 5\r\n\r\nIn application.js, add:\r\n\r\n```\r\n//= require bootstrap\r\n```\r\n\r\nto the end of the file. It will now look like this:\r\n\r\n```\r\n//= require jquery\r\n//= require jquery_ujs\r\n//= require turbolinks\r\n//= require_tree .\r\n//= require bootstrap\r\n```\r\n\r\nWe can test the integration of Bootstrap 4 javascript with Rails 5 by changing the index.html.erb as follows:\r\n\r\n```html\r\n<div class=\"container\">\r\n  <div class=\"row\">\r\n    <div class=\"col-sm-12 text-center bootstrap-welcome\">\r\n      <h1>Bootstrap 4 Works!</h1>\r\n      <p class=\"lead\">Go ahead and build your awesome app now.</p>\r\n      <button type=\"button\" class=\"btn btn-primary btn-lg\" data-toggle=\"modal\" data-target=\"#myModal\">\r\n        Launch demo modal\r\n      </button>\r\n    </div>\r\n  </div>\r\n</div>\r\n\r\n<!-- Modal -->\r\n<div class=\"modal fade\" id=\"myModal\" tabindex=\"-1\" role=\"dialog\" aria-labelledby=\"myModalLabel\">\r\n  <div class=\"modal-dialog\" role=\"document\">\r\n    <div class=\"modal-content\">\r\n      <div class=\"modal-header\">\r\n        <button type=\"button\" class=\"close\" data-dismiss=\"modal\" aria-label=\"Close\"><span aria-hidden=\"true\">&times;</span></button>\r\n        <h4 class=\"modal-title\" id=\"myModalLabel\">Modal title</h4>\r\n      </div>\r\n      <div class=\"modal-body\">\r\n        ...\r\n      </div>\r\n      <div class=\"modal-footer\">\r\n        <button type=\"button\" class=\"btn btn-default\" data-dismiss=\"modal\">Close</button>\r\n        <button type=\"button\" class=\"btn btn-primary\">Save changes</button>\r\n      </div>\r\n    </div>\r\n  </div>\r\n</div>\r\n```\r\n\r\n<img src=\"https://1.bp.blogspot.com/-4Mv3yP1-j_w/WJAJfmNnewI/AAAAAAAABUQ/0mTHuQgGG5ckMNNOqU6wFbpN6YI_XSDkQCLcB/s1600/hello-tb4-js.png\" alt=\"Twitter Bootstrap 4\" style=\"border: 1px solid #000; max-width:800px; max-height:600px;\" />\r\n\r\n<img src=\"https://3.bp.blogspot.com/-sxNojbT2a7E/WJAJf7CdstI/AAAAAAAABUU/YR9RWRyMi9Y7NfgZtNqJp6Wq1pIIaPkMQCLcB/s1600/hello-tb4-modal.png\" alt=\"Twitter Bootstrap 4\" style=\"border: 1px solid #000; max-width:800px; max-height:600px;\" />\r\n\r\nYou can now see the modal window when you click the button. This method does not use any gems and will be able to upgrade to newer versions faster without waiting for the gem authors to update or fix their gems with latest version of Twitter Bootstrap.\r\n\r\n## Faster Upgrades\r\n\r\nIf you install gems for integrating Twitter Boostrap latest versing using [rails-assets](https://rails-assets.org/#/), you will encounter errors like this:\r\n\r\n<img src=\"https://3.bp.blogspot.com/-WtnuFYshAeY/WJqa-WvFr2I/AAAAAAAABVg/Ynd_N9GYQH4z8M51ZuBkHjQNToASuIfZwCLcB/s1600/Screen%2BShot%2B2017-02-07%2Bat%2B8.10.45%2BPM.png\" alt=\"Twitter Bootstrap 4\" style=\"border: 1px solid #000; max-width:800px; max-height:600px;\" />\r\n\r\npreventing you from taking advantage of latest version of Twitter Bootstrap library. The ability to upgrade faster means you will be ahead of your competition in terms of getting more traffic due to SEO and providing a great user experience for your customers.\r\n\r\n## Reference\r\n\r\n[Twitter Bootstrap 4 Build Tools](http://v4-alpha.getbootstrap.com/getting-started/build-tools/)','2017-01-31 03:52:34','2017-02-08 18:07:22'),(4581,'Websocket Bi-directional Broadcast Demo','## Node Setup\r\n\r\nInstall node module to generate UUID to keep track of clients that connect to the WebSocket chat server. \r\n\r\n```\r\nnpm install node-uuid\r\n```\r\n\r\nThis gives an error:\r\n\r\n```\r\nnpm uninstall --save node-uuid\r\nnpm WARN deprecated node-uuid@1.4.7: use uuid module instead\r\n```\r\n\r\nThe fix is:\r\n\r\n```\r\nnpm uninstall --save node-uuid\r\nnpm install --save uuid\r\n```\r\n\r\n## WebSocket Server\r\n\r\nThe WebSocket server code in server.js looks like this:\r\n\r\n```javascript\r\nvar WebSocket = require(\'ws\');\r\nvar WebSocketServer = WebSocket.Server,\r\n    wss = new WebSocketServer({port: 8080});\r\nvar uuid = require(\'node-uuid\');\r\n\r\nvar clients = [];\r\n\r\nwss.on(\'connection\', function(ws) {\r\n  var client_uuid = uuid.v4();\r\n  clients.push({\"id\": client_uuid, \"ws\": ws});\r\n  console.log(\'client [%s] connected\', client_uuid);\r\n  ws.on(\'message\', function(message) {\r\n    for(var i=0; i<clients.length; i++) {\r\n        var clientSocket = clients[i].ws;\r\n        if(clientSocket.readyState === WebSocket.OPEN) {\r\n            console.log(\'client [%s]: %s\', clients[i].id, message);\r\n            clientSocket.send(JSON.stringify({\r\n                \"id\": client_uuid,\r\n                \"message\": message\r\n            }));\r\n        }\r\n    }\r\n  });\r\n\r\n  ws.on(\'close\', function() {\r\n    for(var i=0; i<clients.length; i++) {\r\n        if(clients[i].id == client_uuid) {\r\n            console.log(\'client [%s] disconnected\', client_uuid);\r\n            clients.splice(i, 1);\r\n        }\r\n    }\r\n  });\r\n});\r\n```\r\n\r\nWe save the uuid.v4 value to the client_uuid variable. We can now identify messages sent and any close event. We store a JSON with UUID and the WebSocket object in the clients array. The server receives the message from the client and iterates over all the connected clients collection to send the messages to them. The clients connected to the server will receive the JSON string that is shown to the end user. The server listens for a close event, when it receives it for a given client, it iterates through the collection and removes the client. \r\n\r\n## WebSocket Client\r\n\r\nThe websocket client is shown below:\r\n\r\n```html\r\n<!DOCTYPE html>\r\n<html lang=\"en\">\r\n<head>\r\n<title>WebSocket Chat Demo</title>\r\n\r\n<script src=\"https://ajax.googleapis.com/ajax/libs/jquery/3.1.0/jquery.min.js\"></script>\r\n<script>\r\n  var ws = new WebSocket(\"ws://localhost:8080\");\r\n  ws.onopen = function(e) {\r\n    console.log(\'Connection to server opened\');\r\n  }\r\n  function appendLog(message) {\r\n    var messages =  document.getElementById(\'messages\');\r\n    var messageElem = document.createElement(\"li\");\r\n\r\n    messageElem.innerHTML = \"<h2>\" + message + \"</h2>\";\r\n    messages.appendChild(messageElem);\r\n  }\r\n  ws.onmessage = function(e) {\r\n     var data = JSON.parse(e.data);\r\n     appendLog(data.message);\r\n     console.log(\"ID: [%s] = %s\", data.id, data.message);\r\n  }\r\n  ws.onclose = function(e) {\r\n    appendLog(\"Connection closed\");\r\n    console.log(\"Connection closed\");\r\n  }\r\n  function sendMessage() {\r\n    if(ws.readyState === WebSocket.OPEN) {\r\n      ws.send($(\'#message\').val());\r\n    }\r\n    $(\'#message\').val(\'\');\r\n    $(\'#message\').focus();\r\n  }\r\n  function disconnect() {\r\n    ws.close();\r\n  }\r\n</script> \r\n</head>\r\n<body lang=\"en\">\r\n  <div class=\"container\">\r\n    <ul id=\"messages\">\r\n    </ul>\r\n    <hr />\r\n    <form role=\"form\" id=\"chat_form\" onsubmit=\"sendMessage(); return false;\">\r\n       <div class=\"form-group\">\r\n          <input class=\"form-control\" type=\"text\" name=\"message\" id=\"message\" placeholder=\"Type your message here\" value=\"\" autofocus/>\r\n        </div>\r\n        <button type=\"button\" id=\"send\" onclick=\"sendMessage();\">Send Message</button>\r\n    </form>\r\n  </div>\r\n</body>\r\n</html>\r\n```\r\n\r\nThe client receives a message in JSON format from the server. We use JavaScript built-in parsing function to extract the message field. The message is appended to an unordered list using the appendChild method. Now you can open the index.html in two different tabs or browsers and simulate a chat session. In this article, you learned how broadcasting to multiple clients works in websockets. We created a WebSocket server that can broadcast the messages received from a client to all the connected clients. This completes the series of articles on WebSocket focused on concepts required to grasp ActionCable. ','2017-02-01 06:09:39','2017-02-01 06:09:39'),(4591,'Backup MySQL Production Data using Capistrano and SSHKit','I wanted to automate the following tasks for rubyplus.com:\r\n\r\n1. Backup mysql production data\r\n2. Download the production data dump to laptop\r\n3. Import the production data dump to development database on laptop\r\n4. Backup the data by uploading the compressed production data to S3\r\n\r\n## First Attempt\r\n\r\nI am using Capistrano 2.15.9 and SSKKit 1.11.1. My first attempt that automates most of the steps is as follows. For step 1, here is the Capistrano task:\r\n\r\n```ruby\r\nnamespace :myserverbkup do\r\n  desc \'This is mysql backup capistrano task\'\r\n  task :backup, :roles => :db, :only => { :primary => true } do\r\n    filename = \"./cool-app.dump.#{Time.now.to_f}.sql.bz2\"\r\n    text = capture \"cat #{deploy_to}/current/config/database.yml\"\r\n    yaml = YAML::load(text)\r\n\r\n    run \"mysqldump -u #{yaml[\'production\'][\'username\']} -p #{yaml[\'production\'][\'database\']} | bzip2 -c > #{filename}\" do |ch, stream, out|\r\n      ch.send_data \"#{yaml[\'production\'][\'password\']}\\n\" if out =~ /^Enter password:/\r\n    end\r\n  end    \r\nend\r\n```\r\n\r\nRun: \r\n\r\n```\r\ncap myserverbkup:backup\r\n```\r\n\r\non your laptop where you deploy your Rails app to create the backup file named by the variable filename. This Capistrano task was stolen from somewhere online. It uses the mysql credentials for production defined in the database.yml and creates the data dump. It does not require you to enter any password as long as you can deploy your Rails app from the machine where you run this Capistrano task. \r\n\r\nFor step 2, I wrote a small Ruby program using SSHKit.\r\n\r\n```ruby\r\nrequire \'sshkit/dsl\'\r\nrequire \'sshkit\'\r\n\r\ninclude SSHKit::DSL\r\n\r\nSSHKit::Backend::Netssh.configure do |ssh|\r\n  ssh.ssh_options = {\r\n      user: \'deploy-user-name\',\r\n      auth_methods: [\'publickey\']\r\n  }\r\nend\r\n\r\non \'www.example.com\' do\r\n  puts \'Downloading database backup file\'\r\n  download! \'/home/user/cool-app.dump.148213442.628791.sql.bz2\', \'.\'\r\n  puts \'Done\'\r\nend\r\n```\r\n\r\nI saved this under lib/tasks/download.rb which can be run like this (again you must be able to deploy from this machine, which means you have setup SSH keys):\r\n\r\n```ruby\r\nruby lib/tasks/download.rb\r\n```\r\n\r\nThis downloads the data dump into the home directory of the Rails project.\r\n\r\n```\r\nDownloading database backup file\r\n  INFO Downloading ./cool-app.dump.1486427812.612312.sql.bz2 10.14%\r\n  INFO Downloading ./cool-app.dump.1486427812.612312.sql.bz2 20.27%\r\n  INFO Downloading ./cool-app.dump.1486427812.612312.sql.bz2 30.06%\r\n  INFO Downloading ./cool-app.dump.1486427812.612312.sql.bz2 40.2%\r\n  INFO Downloading ./cool-app.dump.1486427812.612312.sql.bz2 50.33%\r\n  INFO Downloading ./cool-app.dump.1486427812.612312.sql.bz2 60.12%\r\n  INFO Downloading ./cool-app.dump.1486427812.612312.sql.bz2 70.26%\r\n  INFO Downloading ./cool-app.dump.1486427812.612312.sql.bz2 80.05%\r\n  INFO Downloading ./cool-app.dump.1486427812.612312.sql.bz2 90.18%\r\n  INFO Downloading ./cool-app.dump.1486427812.612312.sql.bz2 100.0%\r\nDone\r\n```\r\n\r\nYou can see SSHKit shows download progress without requiring you to write any code. Now, I unzip the bz2 file manually (this step needs to be automated by executing gunzip in the terminal using Ruby). To import the data into my local database, I run:\r\n\r\n```\r\nmysql -u root -p -h localhost < my-cool-app.sql\r\n```\r\n\r\n## Second Attempt\r\n\r\nAfter a good night\'s sleep, the next day I had the mental energy to improve the quick-and-dirty Capistrano task. I combined another Capistrano task that I found online to make everything into one Capistrano task:\r\n\r\n```ruby\r\n# Run cap myserverbkup:backup to create the backup file named filename\r\nnamespace :myserverbkup do\r\n  desc \'This is mysql backup capistrano task\'\r\n  task :backup, :roles => :db, :only => { :primary => true } do\r\n    filename = \"./prod-db.dump.#{Time.now.to_f}.sql.bz2\"\r\n    text = capture \"cat #{deploy_to}/current/config/database.yml\"\r\n    yaml = YAML::load(text)\r\n\r\n    run \"mysqldump -u #{yaml[\'production\'][\'username\']} -p #{yaml[\'production\'][\'database\']} | bzip2 -c > #{filename}\" do |ch, stream, out|\r\n      ch.send_data \"#{yaml[\'production\'][\'password\']}\\n\" if out =~ /^Enter password:/\r\n    end\r\n    \r\n    puts \"Fetching remote data\"\r\n    get \"#{filename}\", \"prod-db.dump.sql.bz2\"\r\n   \r\n    # unzip the file. Can\'t use exec() for some reason so backticks will do\r\n    puts \"Uncompressing dump\"\r\n    `bzip2 -d prod-db.dump.sql.bz2`\r\n    cmd = \"mysql -u root --database=your-dev-db-name < prod-db.dump.sql\"\r\n    puts \"Importing production data : #{cmd}\"\r\n    `#{cmd}`\r\n    puts \"Deleting prod-db.dump.sql\"\r\n    `rm -f prod-db.dump.sql`\r\n    \r\n    puts \"Be sure to run rake db:migrate to ensure your database schema is up to date!\"\r\n  end    \r\nend\r\n```\r\n\r\nThe only customization in this Capistrano task is that I am using bz2 to compress and bzip2 command to uncompress the downloaded file. The only pending task is uploading the data dump to S3 before deleting it on the laptop. The Amazon S3 file upload is discussed in the article [Uploading Files to S3 using AWS SDK gem](https://rubyplus.com/articles/4411-Uploading-Files-to-S3-using-AWS-SDK-Ruby-Gem).','2017-02-04 21:59:02','2017-02-05 22:46:35'),(4601,'Twitter Bootstrap 4 : DataTables jQuery Plugin','According to the [DataTables](https://datatables.net/) home page:\r\n\r\n> DataTables is a plug-in for the jQuery Javascript library. It is a highly flexible tool, based upon the foundations of progressive enhancement, and will add advanced interaction controls to any HTML table.\r\n\r\nIt provides:\r\n\r\n- Pagination, instant search and multi-column ordering\r\n- Supports any data source.\r\n- Easily theme-able: Bootstrap, Foundation etc.\r\n\r\nand more. Use bower to install it.\r\n\r\n```\r\nbower install DataTables\r\n```\r\n\r\nYou will now find bower_components/DataTables directory in your project home directory. Add the DataTables related files to your html file:\r\n\r\n```html\r\n<script src=\"bower_components/DataTables/media/js/jquery.dataTables.min.js\"></script>\r\n<script src=\"bower_components/DataTables/media/js/dataTables.bootstrap4.min.js\"></script>\r\n<link rel=\"stylesheet\" href=\"bower_components/DataTables/media/css/dataTables.bootstrap4.min.css\" />\r\n```\r\n\r\nThe css file will be within the head tag and the javascript files will be inserted just before the body tag ends. The html page with some data will now look like this:\r\n\r\n```html\r\n<!DOCTYPE html>\r\n<html lang=\"en\">\r\n<head>\r\n    <meta charset=\"utf-8\">\r\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1,shrink-to-fit=no\">\r\n    <meta http-equiv=\"x-ua-compatible\" content=\"ie=edge\">\r\n    <title>DataTables with Bootstrap 4 Theme</title>\r\n    <link rel=\"stylesheet\" href=\"bower_components/bootstrap/dist/css/bootstrap.min.css\">\r\n    <link rel=\"stylesheet\" href=\"bower_components/tether/dist/css/tether.min.css\">\r\n    <link rel=\"stylesheet\" href=\"bower_components/DataTables/media/css/dataTables.bootstrap4.min.css\" />\r\n</head>\r\n<body>\r\n\r\n<table id=\"example\" class=\"display\" cellspacing=\"0\" width=\"100%\">\r\n        <thead>\r\n            <tr>\r\n                <th>Name</th>\r\n                <th>Position</th>\r\n                <th>Office</th>\r\n                <th>Age</th>\r\n                <th>Start date</th>\r\n                <th>Salary</th>\r\n            </tr>\r\n        </thead>\r\n        <tfoot>\r\n            <tr>\r\n                <th>Name</th>\r\n                <th>Position</th>\r\n                <th>Office</th>\r\n                <th>Age</th>\r\n                <th>Start date</th>\r\n                <th>Salary</th>\r\n            </tr>\r\n        </tfoot>\r\n        <tbody>\r\n            <tr>\r\n                <td>Tiger Nixon</td>\r\n                <td>System Architect</td>\r\n                <td>Edinburgh</td>\r\n                <td>61</td>\r\n                <td>2011/04/25</td>\r\n                <td>$320,800</td>\r\n            </tr>\r\n            <tr>\r\n                <td>Garrett Winters</td>\r\n                <td>Accountant</td>\r\n                <td>Tokyo</td>\r\n                <td>63</td>\r\n                <td>2011/07/25</td>\r\n                <td>$170,750</td>\r\n            </tr>\r\n            <tr>\r\n                <td>Ashton Cox</td>\r\n                <td>Junior Technical Author</td>\r\n                <td>San Francisco</td>\r\n                <td>66</td>\r\n                <td>2009/01/12</td>\r\n                <td>$86,000</td>\r\n            </tr>\r\n            <tr>\r\n                <td>Cedric Kelly</td>\r\n                <td>Senior Javascript Developer</td>\r\n                <td>Edinburgh</td>\r\n                <td>22</td>\r\n                <td>2012/03/29</td>\r\n                <td>$433,060</td>\r\n            </tr>\r\n            <tr>\r\n                <td>Airi Satou</td>\r\n                <td>Accountant</td>\r\n                <td>Tokyo</td>\r\n                <td>33</td>\r\n                <td>2008/11/28</td>\r\n                <td>$162,700</td>\r\n            </tr>\r\n            <tr>\r\n                <td>Brielle Williamson</td>\r\n                <td>Integration Specialist</td>\r\n                <td>New York</td>\r\n                <td>61</td>\r\n                <td>2012/12/02</td>\r\n                <td>$372,000</td>\r\n            </tr>\r\n            <tr>\r\n                <td>Herrod Chandler</td>\r\n                <td>Sales Assistant</td>\r\n                <td>San Francisco</td>\r\n                <td>59</td>\r\n                <td>2012/08/06</td>\r\n                <td>$137,500</td>\r\n            </tr>\r\n            <tr>\r\n                <td>Rhona Davidson</td>\r\n                <td>Integration Specialist</td>\r\n                <td>Tokyo</td>\r\n                <td>55</td>\r\n                <td>2010/10/14</td>\r\n                <td>$327,900</td>\r\n            </tr>\r\n            <tr>\r\n                <td>Colleen Hurst</td>\r\n                <td>Javascript Developer</td>\r\n                <td>San Francisco</td>\r\n                <td>39</td>\r\n                <td>2009/09/15</td>\r\n                <td>$205,500</td>\r\n            </tr>\r\n            <tr>\r\n                <td>Sonya Frost</td>\r\n                <td>Software Engineer</td>\r\n                <td>Edinburgh</td>\r\n                <td>23</td>\r\n                <td>2008/12/13</td>\r\n                <td>$103,600</td>\r\n            </tr>\r\n            <tr>\r\n                <td>Jena Gaines</td>\r\n                <td>Office Manager</td>\r\n                <td>London</td>\r\n                <td>30</td>\r\n                <td>2008/12/19</td>\r\n                <td>$90,560</td>\r\n            </tr>\r\n            <tr>\r\n                <td>Quinn Flynn</td>\r\n                <td>Support Lead</td>\r\n                <td>Edinburgh</td>\r\n                <td>22</td>\r\n                <td>2013/03/03</td>\r\n                <td>$342,000</td>\r\n            </tr>\r\n            <tr>\r\n                <td>Charde Marshall</td>\r\n                <td>Regional Director</td>\r\n                <td>San Francisco</td>\r\n                <td>36</td>\r\n                <td>2008/10/16</td>\r\n                <td>$470,600</td>\r\n            </tr>\r\n            <tr>\r\n                <td>Haley Kennedy</td>\r\n                <td>Senior Marketing Designer</td>\r\n                <td>London</td>\r\n                <td>43</td>\r\n                <td>2012/12/18</td>\r\n                <td>$313,500</td>\r\n            </tr>\r\n            <tr>\r\n                <td>Tatyana Fitzpatrick</td>\r\n                <td>Regional Director</td>\r\n                <td>London</td>\r\n                <td>19</td>\r\n                <td>2010/03/17</td>\r\n                <td>$385,750</td>\r\n            </tr>\r\n            <tr>\r\n                <td>Michael Silva</td>\r\n                <td>Marketing Designer</td>\r\n                <td>London</td>\r\n                <td>66</td>\r\n                <td>2012/11/27</td>\r\n                <td>$198,500</td>\r\n            </tr>\r\n            <tr>\r\n                <td>Paul Byrd</td>\r\n                <td>Chief Financial Officer (CFO)</td>\r\n                <td>New York</td>\r\n                <td>64</td>\r\n                <td>2010/06/09</td>\r\n                <td>$725,000</td>\r\n            </tr>\r\n            <tr>\r\n                <td>Gloria Little</td>\r\n                <td>Systems Administrator</td>\r\n                <td>New York</td>\r\n                <td>59</td>\r\n                <td>2009/04/10</td>\r\n                <td>$237,500</td>\r\n            </tr>\r\n            <tr>\r\n                <td>Bradley Greer</td>\r\n                <td>Software Engineer</td>\r\n                <td>London</td>\r\n                <td>41</td>\r\n                <td>2012/10/13</td>\r\n                <td>$132,000</td>\r\n            </tr>\r\n            <tr>\r\n                <td>Dai Rios</td>\r\n                <td>Personnel Lead</td>\r\n                <td>Edinburgh</td>\r\n                <td>35</td>\r\n                <td>2012/09/26</td>\r\n                <td>$217,500</td>\r\n            </tr>\r\n            <tr>\r\n                <td>Jenette Caldwell</td>\r\n                <td>Development Lead</td>\r\n                <td>New York</td>\r\n                <td>30</td>\r\n                <td>2011/09/03</td>\r\n                <td>$345,000</td>\r\n            </tr>\r\n            <tr>\r\n                <td>Yuri Berry</td>\r\n                <td>Chief Marketing Officer (CMO)</td>\r\n                <td>New York</td>\r\n                <td>40</td>\r\n                <td>2009/06/25</td>\r\n                <td>$675,000</td>\r\n            </tr>\r\n            <tr>\r\n                <td>Caesar Vance</td>\r\n                <td>Pre-Sales Support</td>\r\n                <td>New York</td>\r\n                <td>21</td>\r\n                <td>2011/12/12</td>\r\n                <td>$106,450</td>\r\n            </tr>\r\n            <tr>\r\n                <td>Doris Wilder</td>\r\n                <td>Sales Assistant</td>\r\n                <td>Sidney</td>\r\n                <td>23</td>\r\n                <td>2010/09/20</td>\r\n                <td>$85,600</td>\r\n            </tr>\r\n            <tr>\r\n                <td>Angelica Ramos</td>\r\n                <td>Chief Executive Officer (CEO)</td>\r\n                <td>London</td>\r\n                <td>47</td>\r\n                <td>2009/10/09</td>\r\n                <td>$1,200,000</td>\r\n            </tr>\r\n            <tr>\r\n                <td>Gavin Joyce</td>\r\n                <td>Developer</td>\r\n                <td>Edinburgh</td>\r\n                <td>42</td>\r\n                <td>2010/12/22</td>\r\n                <td>$92,575</td>\r\n            </tr>\r\n            <tr>\r\n                <td>Jennifer Chang</td>\r\n                <td>Regional Director</td>\r\n                <td>Singapore</td>\r\n                <td>28</td>\r\n                <td>2010/11/14</td>\r\n                <td>$357,650</td>\r\n            </tr>\r\n            <tr>\r\n                <td>Brenden Wagner</td>\r\n                <td>Software Engineer</td>\r\n                <td>San Francisco</td>\r\n                <td>28</td>\r\n                <td>2011/06/07</td>\r\n                <td>$206,850</td>\r\n            </tr>\r\n            <tr>\r\n                <td>Fiona Green</td>\r\n                <td>Chief Operating Officer (COO)</td>\r\n                <td>San Francisco</td>\r\n                <td>48</td>\r\n                <td>2010/03/11</td>\r\n                <td>$850,000</td>\r\n            </tr>\r\n            <tr>\r\n                <td>Shou Itou</td>\r\n                <td>Regional Marketing</td>\r\n                <td>Tokyo</td>\r\n                <td>20</td>\r\n                <td>2011/08/14</td>\r\n                <td>$163,000</td>\r\n            </tr>\r\n            <tr>\r\n                <td>Michelle House</td>\r\n                <td>Integration Specialist</td>\r\n                <td>Sidney</td>\r\n                <td>37</td>\r\n                <td>2011/06/02</td>\r\n                <td>$95,400</td>\r\n            </tr>\r\n            <tr>\r\n                <td>Suki Burks</td>\r\n                <td>Developer</td>\r\n                <td>London</td>\r\n                <td>53</td>\r\n                <td>2009/10/22</td>\r\n                <td>$114,500</td>\r\n            </tr>\r\n            <tr>\r\n                <td>Prescott Bartlett</td>\r\n                <td>Technical Author</td>\r\n                <td>London</td>\r\n                <td>27</td>\r\n                <td>2011/05/07</td>\r\n                <td>$145,000</td>\r\n            </tr>\r\n            <tr>\r\n                <td>Gavin Cortez</td>\r\n                <td>Team Leader</td>\r\n                <td>San Francisco</td>\r\n                <td>22</td>\r\n                <td>2008/10/26</td>\r\n                <td>$235,500</td>\r\n            </tr>\r\n            <tr>\r\n                <td>Martena Mccray</td>\r\n                <td>Post-Sales support</td>\r\n                <td>Edinburgh</td>\r\n                <td>46</td>\r\n                <td>2011/03/09</td>\r\n                <td>$324,050</td>\r\n            </tr>\r\n            <tr>\r\n                <td>Unity Butler</td>\r\n                <td>Marketing Designer</td>\r\n                <td>San Francisco</td>\r\n                <td>47</td>\r\n                <td>2009/12/09</td>\r\n                <td>$85,675</td>\r\n            </tr>\r\n            <tr>\r\n                <td>Howard Hatfield</td>\r\n                <td>Office Manager</td>\r\n                <td>San Francisco</td>\r\n                <td>51</td>\r\n                <td>2008/12/16</td>\r\n                <td>$164,500</td>\r\n            </tr>\r\n            <tr>\r\n                <td>Hope Fuentes</td>\r\n                <td>Secretary</td>\r\n                <td>San Francisco</td>\r\n                <td>41</td>\r\n                <td>2010/02/12</td>\r\n                <td>$109,850</td>\r\n            </tr>\r\n            <tr>\r\n                <td>Vivian Harrell</td>\r\n                <td>Financial Controller</td>\r\n                <td>San Francisco</td>\r\n                <td>62</td>\r\n                <td>2009/02/14</td>\r\n                <td>$452,500</td>\r\n            </tr>\r\n            <tr>\r\n                <td>Timothy Mooney</td>\r\n                <td>Office Manager</td>\r\n                <td>London</td>\r\n                <td>37</td>\r\n                <td>2008/12/11</td>\r\n                <td>$136,200</td>\r\n            </tr>\r\n            <tr>\r\n                <td>Jackson Bradshaw</td>\r\n                <td>Director</td>\r\n                <td>New York</td>\r\n                <td>65</td>\r\n                <td>2008/09/26</td>\r\n                <td>$645,750</td>\r\n            </tr>\r\n            <tr>\r\n                <td>Olivia Liang</td>\r\n                <td>Support Engineer</td>\r\n                <td>Singapore</td>\r\n                <td>64</td>\r\n                <td>2011/02/03</td>\r\n                <td>$234,500</td>\r\n            </tr>\r\n            <tr>\r\n                <td>Bruno Nash</td>\r\n                <td>Software Engineer</td>\r\n                <td>London</td>\r\n                <td>38</td>\r\n                <td>2011/05/03</td>\r\n                <td>$163,500</td>\r\n            </tr>\r\n            <tr>\r\n                <td>Sakura Yamamoto</td>\r\n                <td>Support Engineer</td>\r\n                <td>Tokyo</td>\r\n                <td>37</td>\r\n                <td>2009/08/19</td>\r\n                <td>$139,575</td>\r\n            </tr>\r\n            <tr>\r\n                <td>Thor Walton</td>\r\n                <td>Developer</td>\r\n                <td>New York</td>\r\n                <td>61</td>\r\n                <td>2013/08/11</td>\r\n                <td>$98,540</td>\r\n            </tr>\r\n            <tr>\r\n                <td>Finn Camacho</td>\r\n                <td>Support Engineer</td>\r\n                <td>San Francisco</td>\r\n                <td>47</td>\r\n                <td>2009/07/07</td>\r\n                <td>$87,500</td>\r\n            </tr>\r\n            <tr>\r\n                <td>Serge Baldwin</td>\r\n                <td>Data Coordinator</td>\r\n                <td>Singapore</td>\r\n                <td>64</td>\r\n                <td>2012/04/09</td>\r\n                <td>$138,575</td>\r\n            </tr>\r\n            <tr>\r\n                <td>Zenaida Frank</td>\r\n                <td>Software Engineer</td>\r\n                <td>New York</td>\r\n                <td>63</td>\r\n                <td>2010/01/04</td>\r\n                <td>$125,250</td>\r\n            </tr>\r\n            <tr>\r\n                <td>Zorita Serrano</td>\r\n                <td>Software Engineer</td>\r\n                <td>San Francisco</td>\r\n                <td>56</td>\r\n                <td>2012/06/01</td>\r\n                <td>$115,000</td>\r\n            </tr>\r\n            <tr>\r\n                <td>Jennifer Acosta</td>\r\n                <td>Junior Javascript Developer</td>\r\n                <td>Edinburgh</td>\r\n                <td>43</td>\r\n                <td>2013/02/01</td>\r\n                <td>$75,650</td>\r\n            </tr>\r\n            <tr>\r\n                <td>Cara Stevens</td>\r\n                <td>Sales Assistant</td>\r\n                <td>New York</td>\r\n                <td>46</td>\r\n                <td>2011/12/06</td>\r\n                <td>$145,600</td>\r\n            </tr>\r\n            <tr>\r\n                <td>Hermione Butler</td>\r\n                <td>Regional Director</td>\r\n                <td>London</td>\r\n                <td>47</td>\r\n                <td>2011/03/21</td>\r\n                <td>$356,250</td>\r\n            </tr>\r\n            <tr>\r\n                <td>Lael Greer</td>\r\n                <td>Systems Administrator</td>\r\n                <td>London</td>\r\n                <td>21</td>\r\n                <td>2009/02/27</td>\r\n                <td>$103,500</td>\r\n            </tr>\r\n            <tr>\r\n                <td>Jonas Alexander</td>\r\n                <td>Developer</td>\r\n                <td>San Francisco</td>\r\n                <td>30</td>\r\n                <td>2010/07/14</td>\r\n                <td>$86,500</td>\r\n            </tr>\r\n            <tr>\r\n                <td>Shad Decker</td>\r\n                <td>Regional Director</td>\r\n                <td>Edinburgh</td>\r\n                <td>51</td>\r\n                <td>2008/11/13</td>\r\n                <td>$183,000</td>\r\n            </tr>\r\n            <tr>\r\n                <td>Michael Bruce</td>\r\n                <td>Javascript Developer</td>\r\n                <td>Singapore</td>\r\n                <td>29</td>\r\n                <td>2011/06/27</td>\r\n                <td>$183,000</td>\r\n            </tr>\r\n            <tr>\r\n                <td>Donna Snider</td>\r\n                <td>Customer Support</td>\r\n                <td>New York</td>\r\n                <td>27</td>\r\n                <td>2011/01/25</td>\r\n                <td>$112,000</td>\r\n            </tr>\r\n        </tbody>\r\n    </table>\r\n\r\n    <script src=\"bower_components/jquery/dist/jquery.min.js\"></script>\r\n    <script src=\"bower_components/tether/dist/js/tether.min.js\"></script>\r\n    <script src=\"bower_components/bootstrap/dist/js/bootstrap.min.js\"></script>\r\n    <script src=\"bower_components/DataTables/media/js/jquery.dataTables.min.js\"></script>\r\n    <script src=\"bower_components/DataTables/media/js/dataTables.bootstrap4.min.js\"></script>\r\n</body>\r\n</html>\r\n```\r\n\r\nThe table is copied from [DataTables Twitter Bootstrap 4 example](https://datatables.net/examples/styling/bootstrap4.html). You have to add the jQuery script to initialize the table just before the body tag ends.\r\n\r\n```html\r\n<script type=\"text/javascript\" class=\"init\">\r\n  $(document).ready(function() {\r\n  	$(\'#example\').DataTable();\r\n  } );\r\n</script>\r\n```\r\n\r\nYou will now be able to search, filter, change number of rows displayed per page and paginate through the records.\r\n\r\n<img src=\"https://2.bp.blogspot.com/-a-AazNkoOKQ/WJe_gd3O90I/AAAAAAAABUs/m-YdjCcpYQQ1_4gkR4piOYlUWe6BqWwTACLcB/s1600/Screen%2BShot%2B2017-02-05%2Bat%2B4.08.19%2BPM.png\" alt=\"DataTables using Twitter Bootstrap 4\" style=\"border: 1px solid #000; max-width:800px; max-height:600px;\" />\r\n\r\nIn this article, you learned how to use DataTables jQuery plugin with Twitter Bootstrap 4 theme. ','2017-02-06 00:15:54','2017-02-06 00:19:51'),(4611,'Highcharts in Rails 5','Add the following gems to Gemfile.\r\n\r\n```ruby\r\ngem \'chartkick\'\r\ngem \'groupdate\'\r\n```\r\n\r\nRun bundle. Create a charts controller:\r\n\r\n```\r\nrails g controller charts downloads_by_day\r\n```\r\n\r\nMake sure the following routes is defined in routes.rb.\r\n\r\n```ruby\r\nget \'charts/downloads_by_day\'\r\n```\r\n\r\nThe downloads_by_day action is empty. In downloads_by_day.html.erb:\r\n\r\n```rhtml\r\n<%= line_chart Download.group_by_day(:created_at).count %>\r\n```\r\n\r\nThe display shows the text loading but no chart is drawn. I was pointing the development database to sqlite instead of MySQL that had production data in development database. Changed the database configuration to use MySQL. Browsing to `http://localhost:3000/charts/downloads_by_day` gave the error:\r\n\r\n```\r\nBe sure to install time zone support - https://github.com/ankane/groupdate#for-mysql\r\n```\r\n\r\nIn a terminal, run the command.\r\n\r\n```\r\n$mysql_tzinfo_to_sql /usr/share/zoneinfo | mysql -uroot --force mysql\r\n```\r\n\r\nThe output of this command is as follows.\r\n\r\n```\r\nWarning: Unable to load \'/usr/share/zoneinfo/+VERSION\' as time zone. Skipping it.\r\nERROR 1406 (22001) at line 39271: Data too long for column \'Abbreviation\' at row 1\r\nWarning: Unable to load \'/usr/share/zoneinfo/iso3166.tab\' as time zone. Skipping it.\r\nWarning: Unable to load \'/usr/share/zoneinfo/zone.tab\' as time zone. Skipping it.\r\n```\r\n\r\nYou can ignore those warnings. To verify it worked, run:\r\n\r\n```\r\n$mysql\r\nWelcome to the MySQL monitor.  Commands end with ; or \\g.\r\nYour MySQL connection id is 12\r\nServer version: 5.6.21 MySQL Community Server (GPL)\r\n\r\nCopyright (c) 2000, 2014, Oracle and/or its affiliates. All rights reserved.\r\n\r\nOracle is a registered trademark of Oracle Corporation and/or its\r\naffiliates. Other names may be trademarks of their respective\r\nowners.\r\n\r\nType \'help;\' or \'\\h\' for help. Type \'\\c\' to clear the current input statement.\r\n\r\nmysql> SELECT CONVERT_TZ(NOW(), \'+00:00\', \'Etc/UTC\');\r\n+----------------------------------------+\r\n| CONVERT_TZ(NOW(), \'+00:00\', \'Etc/UTC\') |\r\n+----------------------------------------+\r\n| 2017-02-05 20:44:18                    |\r\n+----------------------------------------+\r\n1 row in set (0.00 sec)\r\n```\r\n\r\nThe time displayed means that it worked.\r\n\r\n## Troubleshooting Problems\r\n\r\nThe chart was not loading on the webpage. I copied the SQL query from the log and ran it in mysql console.\r\n\r\n### Check Data\r\n\r\nCheck the results of the query fired by ActiveRecord in mysql console.\r\n\r\n```\r\n$mysql -u user-name -p\r\nWelcome to the MySQL monitor.  Commands end with ; or \\g.\r\nYour MySQL connection id is 14\r\nServer version: 5.6.21 MySQL Community Server (GPL)\r\n\r\nCopyright (c) 2000, 2014, Oracle and/or its affiliates. All rights reserved.\r\n\r\nOracle is a registered trademark of Oracle Corporation and/or its\r\naffiliates. Other names may be trademarks of their respective\r\nowners.\r\n\r\nType \'help;\' or \'\\h\' for help. Type \'\\c\' to clear the current input statement.\r\n\r\nmysql> show databases;\r\n+---------------------+\r\n| Database            |\r\n+---------------------+\r\n| information_schema  |\r\n| merlot              |\r\n| test                |\r\n+---------------------+\r\n13 rows in set (0.00 sec)\r\n\r\nmysql> use merlot;\r\nReading table information for completion of table and column names\r\nYou can turn off this feature to get a quicker startup with -A\r\n\r\nDatabase changed\r\nmysql>  SELECT COUNT(*) AS count_all, DATE_ADD(CONVERT_TZ(DATE_FORMAT(CONVERT_TZ(DATE_SUB(created_at, INTERVAL 0 second), \'+00:00\', \'Etc/UTC\'), \'%Y-%m-%d 00:00:00\'), \'Etc/UTC\', \'+00:00\'), INTERVAL 0 second) AS day FROM `downloads` WHERE (created_at IS NOT NULL) GROUP BY DATE_ADD(CONVERT_TZ(DATE_FORMAT(CONVERT_TZ(DATE_SUB(created_at, INTERVAL 0 second), \'+00:00\', \'Etc/UTC\'), \'%Y-%m-%d 00:00:00\'), \'Etc/UTC\', \'+00:00\'), INTERVAL 0 second);\r\n+-----------+---------------------+\r\n| count_all | day                 |\r\n+-----------+---------------------+\r\n|         1 | 2016-12-08 00:00:00 |\r\n|         2 | 2016-12-09 00:00:00 |\r\n|        51 | 2016-12-11 00:00:00 |\r\n|         9 | 2016-12-12 00:00:00 |\r\n|         2 | 2016-12-13 00:00:00 |\r\n|        15 | 2016-12-14 00:00:00 |\r\n|        24 | 2016-12-15 00:00:00 |\r\n|         8 | 2016-12-16 00:00:00 |\r\n|        57 | 2016-12-17 00:00:00 |\r\n|        55 | 2016-12-18 00:00:00 |\r\n|        37 | 2016-12-19 00:00:00 |\r\n|        57 | 2016-12-20 00:00:00 |\r\n|         7 | 2016-12-21 00:00:00 |\r\n|         5 | 2016-12-22 00:00:00 |\r\n|        21 | 2016-12-23 00:00:00 |\r\n|         2 | 2016-12-24 00:00:00 |\r\n|        28 | 2016-12-25 00:00:00 |\r\n|         6 | 2016-12-26 00:00:00 |\r\n|        19 | 2016-12-27 00:00:00 |\r\n|        59 | 2016-12-29 00:00:00 |\r\n|        50 | 2016-12-30 00:00:00 |\r\n|        14 | 2016-12-31 00:00:00 |\r\n|        10 | 2017-01-01 00:00:00 |\r\n|        22 | 2017-01-02 00:00:00 |\r\n|        32 | 2017-01-03 00:00:00 |\r\n|         5 | 2017-01-04 00:00:00 |\r\n|         9 | 2017-01-05 00:00:00 |\r\n|         2 | 2017-01-06 00:00:00 |\r\n|       322 | 2017-01-07 00:00:00 |\r\n|       162 | 2017-01-08 00:00:00 |\r\n|       133 | 2017-01-09 00:00:00 |\r\n|       147 | 2017-01-10 00:00:00 |\r\n|        61 | 2017-01-11 00:00:00 |\r\n|        79 | 2017-01-12 00:00:00 |\r\n|        19 | 2017-01-13 00:00:00 |\r\n|        33 | 2017-01-14 00:00:00 |\r\n|        71 | 2017-01-15 00:00:00 |\r\n|        37 | 2017-01-16 00:00:00 |\r\n|        22 | 2017-01-17 00:00:00 |\r\n|        30 | 2017-01-18 00:00:00 |\r\n|        12 | 2017-01-19 00:00:00 |\r\n|        81 | 2017-01-20 00:00:00 |\r\n|       100 | 2017-01-21 00:00:00 |\r\n|        12 | 2017-01-22 00:00:00 |\r\n|        67 | 2017-01-23 00:00:00 |\r\n|        17 | 2017-01-24 00:00:00 |\r\n|        64 | 2017-01-25 00:00:00 |\r\n|         8 | 2017-01-26 00:00:00 |\r\n|       136 | 2017-01-27 00:00:00 |\r\n|        42 | 2017-01-28 00:00:00 |\r\n|        29 | 2017-01-29 00:00:00 |\r\n|        83 | 2017-01-30 00:00:00 |\r\n|        79 | 2017-01-31 00:00:00 |\r\n|        24 | 2017-02-01 00:00:00 |\r\n|         8 | 2017-02-02 00:00:00 |\r\n|        23 | 2017-02-03 00:00:00 |\r\n|        27 | 2017-02-04 00:00:00 |\r\n|        76 | 2017-02-05 00:00:00 |\r\n+-----------+---------------------+\r\n58 rows in set (0.01 sec)\r\n```\r\n\r\nYou can see that we are connected to the right database and have data.\r\n\r\n### View Page Source in the Browser\r\n\r\nViewing the page source in the browser shows that the data is being used by line chart:\r\n\r\n```html\r\n<div id=\"chart-1\" style=\"height: 300px; width: 100%; text-align: center; color: #999; line-height: 300px; font-size: 14px; font-family: \'Lucida Grande\', \'Lucida Sans Unicode\', Verdana, Arial, Helvetica, sans-serif;\">Loading...</div><script type=\"text/javascript\">\r\n  new Chartkick.LineChart(\"chart-1\", {\"2016-12-08\":1,\"2016-12-09\":2,\"2016-12-10\":0,\"2016-12-11\":51,\"2016-12-12\":9,\"2016-12-13\":2,\"2016-12-14\":15,\"2016-12-15\":24,\"2016-12-16\":8,\"2016-12-17\":57,\"2016-12-18\":55,\"2016-12-19\":37,\"2016-12-20\":57,\"2016-12-21\":7,\"2016-12-22\":5,\"2016-12-23\":21,\"2016-12-24\":2,\"2016-12-25\":28,\"2016-12-26\":6,\"2016-12-27\":19,\"2016-12-28\":0,\"2016-12-29\":59,\"2016-12-30\":50,\"2016-12-31\":14,\"2017-01-01\":10,\"2017-01-02\":22,\"2017-01-03\":32,\"2017-01-04\":5,\"2017-01-05\":9,\"2017-01-06\":2,\"2017-01-07\":322,\"2017-01-08\":162,\"2017-01-09\":133,\"2017-01-10\":147,\"2017-01-11\":61,\"2017-01-12\":79,\"2017-01-13\":19,\"2017-01-14\":33,\"2017-01-15\":71,\"2017-01-16\":37,\"2017-01-17\":22,\"2017-01-18\":30,\"2017-01-19\":12,\"2017-01-20\":81,\"2017-01-21\":100,\"2017-01-22\":12,\"2017-01-23\":67,\"2017-01-24\":17,\"2017-01-25\":64,\"2017-01-26\":8,\"2017-01-27\":136,\"2017-01-28\":42,\"2017-01-29\":29,\"2017-01-30\":83,\"2017-01-31\":79,\"2017-02-01\":24,\"2017-02-02\":8,\"2017-02-03\":23,\"2017-02-04\":27,\"2017-02-05\":76}, {});\r\n</script>\r\n```\r\n\r\nThe chart is still not loading. I checked the readme of the Highcharts homepage, it is compatible with jQuery version 3.1.1. I took a step back and focused on the basics by playing with the hello world for Highcharts, you can read about [Highcharts Basics](https://rubyplus.com/articles/4621-Highcharts-Basics-Simple-Bar-Chart-) and play with a simple bar chart. This program helped me to answer questions such as where should the javascript references go? What version of jQuery works with Highcharts and so on. Reducing the number of unknowns helps to get a simple program working. We can gradually improve it, for instance replace hard-coded data in the Javascript with JSON data from the server.\r\n\r\n## Rendering the Chart\r\n\r\nI was getting the error:  Chartkick is not defined. I added:\r\n\r\n```\r\n//= require chartkick\r\n```\r\n\r\nin application.js. \r\n\r\nI added \r\n\r\n```rhtml\r\n<%= javascript_include_tag \"chartkick\" %>\r\n```\r\n\r\nin the application layout file. I got the error: Error Loading Chart: No adapter found. So I added the Google charts:\r\n\r\n```rhtml\r\n<%= javascript_include_tag \"http://www.google.com/jsapi\", \"chartkick\" %>\r\n```\r\n\r\nIt finally worked! To use Highcharts, switch the adapter in the layout file:\r\n\r\n```rhtml\r\n<%= javascript_include_tag \"http://code.highcharts.com/highcharts.js\", \"chartkick\" %>\r\n```\r\n\r\nThe graph now looks prettier than Google charts. But, the dates displayed are not as many as the Google charts. To display all the dates on the x-axis, Highcharts requires tick interval to be specified. This can be customized in chartkick as follows:\r\n\r\n```rhtml\r\n<%= line_chart Download.group_by_day(:created_at).count, {discrete: true} %>\r\n```\r\n\r\n<img src=\"https://1.bp.blogspot.com/-g_qZV-wwkYg/WJl-rIAZc7I/AAAAAAAABVI/XEGRgdugmnMx35tBHLZJu3xY6PNuCcoowCLcB/s1600/Screen%2BShot%2B2017-02-06%2Bat%2B11.57.37%2BPM.png\" alt=\"Twitter Bootstrap 4\" style=\"border: 1px solid #000; max-width:800px; max-height:600px;\" />\r\n\r\nNote: The chartkick documentation says: Download highcharts.js into vendor/assets/javascripts. In application.js, add:\r\n\r\n```\r\n//= require highcharts\r\n//= require chartkick\r\n```\r\n\r\nThen, in your layout:\r\n\r\n```rhtml\r\n<%= yield :charts_js %>\r\n```\r\n\r\nThis is great for including all of your JavaScript at the bottom of the page. This is the right way to do it in production. I got it working the quick and dirty way to get a feel for the Chartkick and Highcharts libraries. We can also send JSON in `downloads_by_day action` and use that JSON data in the view. This is the ideal way to implement the charting functionality. You can download the source code [ckick](https://github.com/bparanj/ckick) to play with the charts in Rails 5, chartkick 2.2.2, groupdate 3.2.0 and active_median 0.1.4. This example Rails 5 project follows the steps of the tutorial in the references section below.\r\n\r\n## References\r\n\r\n- [Highcharts Documentation](http://www.highcharts.com/docs/getting-started/installation)\r\n- [Charting with Chartkick](https://richonrails.com/articles/charting-with-chartkick)\r\n- [Highcharts Axes](http://www.highcharts.com/docs/chart-concepts/axes)\r\n- [Highcharts Tick Interval](http://api.highcharts.com/highcharts/xAxis.tickInterval)','2017-02-06 06:49:02','2017-02-09 19:20:04'),(4621,'Highcharts Basics : Simple Bar Chart ','## Hello Highcharts\r\n\r\nIn this article we will write the simplest charting program using Highcharts javascript library. Include the jQuery and highcharts javascript within the head section. Define a div tag with an id container within the body of the page. We can now use Highcharts.chart method to draw the chart inside the container div. The complete code is shown below.\r\n\r\n```html\r\n<!DOCTYPE html>\r\n<html>\r\n    <head>\r\n        <title>Hello High Charts</title>\r\n        <script\r\n          src=\"https://code.jquery.com/jquery-3.1.1.min.js\"\r\n          integrity=\"sha256-hVVnYaiADRTO2PzUGmuLJr8BLUSjGIZsDYGmIJLv2b8=\"\r\n          crossorigin=\"anonymous\"></script>\r\n          <script src=\"http://code.highcharts.com/highcharts.js\"></script>\r\n    </head>\r\n    <body>\r\n\r\n        <script>\r\n        \r\n        $(function () { \r\n            var myChart = Highcharts.chart(\'container\', {\r\n                chart: {\r\n                    type: \'bar\'\r\n                },\r\n                title: {\r\n                    text: \'Fruit Consumption\'\r\n                },\r\n                xAxis: {\r\n                    categories: [\'Apples\', \'Bananas\', \'Oranges\']\r\n                },\r\n                yAxis: {\r\n                    title: {\r\n                        text: \'Fruit eaten\'\r\n                    }\r\n                },\r\n                series: [{\r\n                    name: \'Jane\',\r\n                    data: [1, 0, 4]\r\n                }, {\r\n                    name: \'John\',\r\n                    data: [5, 7, 3]\r\n                }]\r\n            });\r\n        });            \r\n            \r\n        </script>\r\n    \r\n    <div id=\"container\"></div>\r\n    </body>\r\n</html>\r\n```\r\n\r\n## Separate Data from the Method Invocation\r\n\r\nWe can refactor the code to separate the data from invoking the Highcharts.chart method.\r\n\r\n```javascript\r\n<script>\r\n  var options = {\r\n    chart: {\r\n        type: \'bar\'\r\n    },\r\n    title: {\r\n        text: \'Fruit Consumption\'\r\n    },\r\n    xAxis: {\r\n        categories: [\'Apples\', \'Bananas\', \'Oranges\']\r\n    },\r\n    yAxis: {\r\n        title: {\r\n            text: \'Fruit eaten\'\r\n        }\r\n    },\r\n    series: [{\r\n        name: \'Bugs\',\r\n        data: [1, 0, 4]\r\n    }, {\r\n        name: \'Daffy\',\r\n        data: [5, 7, 3]\r\n    }]\r\n  };\r\n    \r\n  $(function () { \r\n    var myChart = Highcharts.chart(\'container\', options);\r\n  });            \r\n    \r\n</script>\r\n```\r\n\r\nThe options object contains the data and configuration of Highcharts. We can also specify the div id in the options object, renderTo: key-value and pass the options as the only parameter to the chart method as follows:\r\n\r\n```javascript\r\n<script>\r\n  var options = {\r\n    chart: {\r\n        renderTo: \'container\',\r\n        type: \'bar\'\r\n    },\r\n    title: {\r\n        text: \'Fruit Consumption\'\r\n    },\r\n    xAxis: {\r\n        categories: [\'Apples\', \'Bananas\', \'Oranges\']\r\n    },\r\n    yAxis: {\r\n        title: {\r\n            text: \'Fruit eaten\'\r\n        }\r\n    },\r\n    series: [{\r\n        name: \'Rhonda\',\r\n        data: [1, 0, 4]\r\n    }, {\r\n        name: \'Jane\',\r\n        data: [5, 7, 3]\r\n    }]\r\n  };\r\n    \r\n  $(function () { \r\n    var myChart = Highcharts.chart(options);\r\n  });            \r\n    \r\n</script>\r\n```\r\n\r\n## Highcharts Starter Template\r\n\r\nHere is the template that you can use as a starting point to play with Highcharts API.\r\n\r\n```javascript\r\n<!DOCTYPE html>\r\n<html>\r\n    <head>\r\n        <title></title>\r\n        <script\r\n          src=\"https://code.jquery.com/jquery-3.1.1.min.js\"\r\n          integrity=\"sha256-hVVnYaiADRTO2PzUGmuLJr8BLUSjGIZsDYGmIJLv2b8=\"\r\n          crossorigin=\"anonymous\"></script>\r\n          \r\n          <script src=\"http://code.highcharts.com/highcharts.js\"></script>\r\n    </head>\r\n    <body>\r\n\r\n    <script>\r\n      var options = {\r\n    \r\n          };\r\n   \r\n          $(function () { \r\n               var chart = Highcharts.chart(options);\r\n          });            \r\n    </script>\r\n    \r\n        <div id=\"container\"></div>\r\n        \r\n    </body>\r\n</html>\r\n```\r\n\r\n## Summary\r\n\r\nIn this article, we wrote a simple hello highcharts program using jQuery 3.1.1 and Highcharts 5.0.7. You can experiment with these examples. For instance, move the javascript tags before the end of the body section and see what happens. In a real project, we don\'t hard-code the data in the Javascript code, we will be hitting a backend API endpoint to get a JSON that will be rendered as charts. We will discuss this topic in an upcoming article.','2017-02-07 07:00:56','2017-02-07 07:03:07'),(4631,'Rails Productivity Tips : Super Fast Learning and Troubleshooting Tip','## Rails Play Ground \r\n\r\nYou can use the Rails bug template to play with ActionController. For instance, here is a simple todos controller:\r\n\r\n```ruby\r\nbegin\r\n  require \'bundler/inline\'\r\nrescue LoadError => e\r\n  $stderr.puts \'Bundler version 1.10 or later is required. Please update your Bundler\'\r\n  raise e\r\nend\r\n\r\ngemfile(true) do\r\n  source \'https://rubygems.org\'\r\n  gem \'rails\', \'5.0.1\'\r\n  gem \'pry\'\r\n  gem \'sqlite3\'\r\n  gem \'rb-readline\'\r\nend\r\n\r\nrequire \'action_controller/railtie\'\r\nrequire \'active_record\'\r\nrequire \'minitest/autorun\'\r\nrequire \'logger\'\r\n\r\nActiveRecord::Base.establish_connection(adapter: \'sqlite3\', database: \':memory:\')\r\nActiveRecord::Base.logger = Logger.new(STDOUT)\r\n\r\nActiveRecord::Schema.define do\r\n  create_table :todos, force: true  do |t|\r\n    t.string :content\r\n  end\r\nend\r\n\r\nclass Todo < ActiveRecord::Base\r\n  alias_attribute :content_html, :content\r\n  validates_presence_of :content\r\nend\r\n\r\nclass TestApp < Rails::Application\r\n  config.root = File.dirname(__FILE__)\r\n  config.session_store :cookie_store, key: \'cookie_store_key\'\r\n  secrets.secret_token    = \'secret_token\'\r\n  secrets.secret_key_base = \'secret_key_base\'\r\n\r\n  config.logger = Logger.new($stdout)\r\n  Rails.logger  = config.logger\r\n\r\n  routes.draw do\r\n    resources :todos\r\n    resources :wrapped_todos\r\n  end\r\nend\r\n\r\nActionController::Base.wrap_parameters format: [:json]\r\n\r\nclass TodosController < ActionController::Base\r\n  include Rails.application.routes.url_helpers\r\n\r\n  def create\r\n    Todo.create!(params.require(:todo).permit(:content, :content_html))\r\n    render plain: \'It worked?\'\r\n  end\r\nend\r\n\r\nclass WrappedTodosController < ActionController::Base\r\n  wrap_parameters :todo, include: %i( content_html )\r\n\r\n  def create\r\n    Todo.create!(params.require(:todo).permit(:content, :content_html))\r\n    render plain: \'It worked?\'\r\n  end\r\nend\r\n\r\nrequire \'minitest/autorun\'\r\nrequire \'rack/test\'\r\n\r\nclass BugTest < Minitest::Test\r\n  include Rack::Test::Methods\r\n\r\n  def test_wrapping_listed_attribute\r\n    post \'/todos.json\', { content: \"<b>Please clap</b>\" }.to_json, { \"CONTENT_TYPE\" => \"application/json\" }\r\n    assert last_response.ok?, \"Wrapping did not work with attribute on model\"\r\n  end\r\n\r\n  def test_explicitly_wrapping_unlisted_attribute\r\n    post \'/wrapped_todos.json\', { content_html: \"<b>Please clap</b>\" }.to_json, { \"CONTENT_TYPE\" => \"application/json\" }\r\n    Pry.start\r\n    assert last_response.ok?, \"Wrapping works when given explicitly with include option\"\r\n  end\r\n\r\n  private\r\n    def app\r\n      Rails.application\r\n    end\r\nend\r\n```\r\n\r\nI have customized this stolen script from Rails github repository to include pry gem and start a REPL pry session when this script is run. You can see Pry.start in the second test, this drops us to a Pry session and we can experiment with the code. For instance, I can look at the secrets:\r\n\r\n```ruby\r\n Rails.application.secrets\r\n=> {:secret_key_base=>\"secret_key_base\", :secret_token=>\"secret_token\"}\r\n```\r\n\r\nWhy is this useful? I initially had this script which was using Rails 5 beta version. I was able to quickly change the Rails version to 5.0.1 and run these tests. You can quickly isolate problems due to Rails versions without having to create many projects with different Rails versions. This will become difficult to keep track. You can also use this as your playground to experiment and learn more about Rails.','2017-02-07 07:05:21','2017-02-07 07:05:37'),(4641,'Using jQuery flip Javascript Library','The following html page displays a simple card that you can flip by clicking the text.\r\n\r\n```html\r\n<!DOCTYPE HTML>\r\n<html lang=\"en-US\">\r\n<head>\r\n    <meta charset=\"UTF-8\">\r\n    <meta name=\"robots\" content=\"noindex, nofollow\" />\r\n    <title>jQuery Flip example</title>\r\n    <script src=\"https://code.jquery.com/jquery-2.1.4.min.js\"> </script>\r\n    <script src=\"https://cdn.rawgit.com/nnattawat/flip/master/dist/jquery.flip.min.js\"></script>\r\n</head>\r\n<body>\r\n<div id=\"card\"> \r\n  <div class=\"front\"> \r\n    Front content\r\n  </div> \r\n  <div class=\"back\">\r\n    Back content\r\n  </div> \r\n</div>\r\n    <script type=\"text/javascript\">\r\n      $(document).on(\'ready\', function() {\r\n        $(\"#card\").flip();\r\n      });\r\n    </script>\r\n</body>\r\n</html>\r\n```\r\n\r\nThe jQuery version must be 2.1.4. If you copy paste the code from the flip.js homepage, make sure you have ending script tag, otherwise you will get the error:\r\n\r\n```\r\nUncaught TypeError: $(...).flip is not a function\r\n```\r\n\r\nAnother common mistake is:\r\n\r\n```javascript\r\n<script type=\"text/javascript\">\r\n  $(function(){\r\n      $(\"#card\").flip(); \r\n  });\r\n</script>\r\n```\r\n\r\nThe script is running before the entire document is loaded into the browser, so jQuery isn\'t actually selecting anything to flip. In jQuery to make the script wait until document load, wrap the code like this:\r\n\r\n```javascript\r\n<script type=\"text/javascript\">\r\n  $(document).on(\'ready\', function() {\r\n    $(\"#card\").flip();\r\n  });\r\n</script>\r\n```\r\n\r\nYou can add some CSS to display the content as a card. \r\n\r\n```css\r\n<style>\r\n        #card {\r\n            height: 300px;\r\n        }\r\n        #card .front{\r\n            text-align: center;\r\n            font-size: 30px;\r\n            font-weight: 200;\r\n            background-color: yellow;\r\n        }\r\n\r\n        #card .back{\r\n            text-align: center;\r\n            font-size: 30px;\r\n            font-weight: 200;\r\n            background-color: #eee;\r\n        }\r\n</style>\r\n```\r\n\r\nI went to the flip jQuery home page to find out how the example worked. On Chrome:\r\n\r\n1. Right click.\r\n2. Select inspect.\r\n3. Click on the pointer icon on the top left corner.\r\n4. This shows the CSS for the front class.\r\n5. Click on the file name that contains the front CSS class (index.html).\r\n6. You can now copy the CSS for front and back classes to your project.\r\n\r\nIn this article, we wrote a simple hello flip program using jQuery flip library. You also learned how to figure out how something works in CSS by using the Chrome developer tools to reverse engineer CSS functionality.','2017-02-08 02:21:38','2017-02-09 04:01:20'),(4651,'How to Secure RSS Feed for Paid Content in Rails 5','To create a URL for the paid episodes that users can access: `https://rubyplus.com/episodes/paid.rss`, you have to define the endpoint in the routes.rb:\r\n\r\n```ruby\r\nresources :episodes \r\n   collection do\r\n     get :paid\r\n   end\r\nend\r\n```\r\n\r\nNow, define a paid action in episodes controller:\r\n\r\n```ruby\r\ndef  paid\r\n  @episodes = Episode.published.paid.order(\'position desc\')\r\n  \r\n  respond_to do |f|\r\n    f.rss { render action: :index }\r\n  end\r\nend\r\n```\r\n\r\nThe published and paid methods are implemented in episode model.\r\n\r\n```ruby\r\ndef self.published\r\n  where(\'published_at <= ?\', Time.now.utc)\r\nend\r\n\r\ndef self.paid\r\n  where(paid: true)\r\nend\r\n```\r\n\r\nThe app/views/episodes/index.rss.builder looks like this:\r\n\r\n```rhtml\r\ntitle = \"Rails Screencasts\"\r\nauthor = \"Bala Paranj\"\r\ndescription = \"Learn practical tips and techniques on how to develop web applications using Ruby on Rails web framework. The episodes are short to minimize the amount of content to avoid overwhelming learners. The episodes are designed to give developers a quick way to get their feet wet and learn by building web apps.\"\r\nkeywords = \"rails, ruby on rails, screencasts, podcasts, tips, tricks, tutorials, training, programming,, web application framework\"\r\next = \'mp4\'\r\n\r\nxml.rss :version => \"2.0\", \"xmlns:itunes\" => \"http://www.itunes.com/dtds/podcast-1.0.dtd\",  \"xmlns:media\" => \"http://search.yahoo.com/mrss/\", \"xmlns:atom\" => \"http://www.w3.org/2005/Atom\" do\r\n  xml.channel do\r\n    xml.tag!(\"atom:link\",  \"href\"=>\"https://rubyplus.com/episodes.rss\", \"rel\"=>\"self\", \"type\"=>\"application/rss+xml\") \r\n    xml.title title\r\n    xml.link \'https://www.rubyplus.com\'\r\n    xml.description description\r\n    xml.language \'en\'\r\n    xml.pubDate @episodes.first.created_at.to_s(:rfc822)\r\n    xml.lastBuildDate @episodes.first.created_at.to_s(:rfc822)\r\n    xml.itunes :author, author\r\n    xml.itunes :keywords, keywords\r\n    xml.itunes :explicit, \'clean\'\r\n    xml.itunes :image, :href => \"http://rubyplus.com/images/RAILS-res-3000px-winning-purple.png\"\r\n    xml.itunes :owner do\r\n      xml.itunes :name, author\r\n      xml.itunes :email, \'feedback@rubyplus.com\'\r\n    end\r\n    xml.itunes :block, \'no\'\r\n    xml.itunes :category, :text => \'Technology\' do\r\n      xml.itunes :category, :text => \'Software How-To\'\r\n    end\r\n    xml.itunes :category, :text => \'Education\' do\r\n      xml.itunes :category, :text => \'Training\'\r\n    end\r\n\r\n    @episodes.each do  |episode|\r\n      xml.item do\r\n        xml.title episode.title\r\n        xml.description episode.description\r\n        xml.pubDate episode.created_at.to_s(:rfc822)\r\n        xml.enclosure :url => \"http://rubyplus.com/download/episode?id=#{episode.id}\", :length => episode.file_size, :type => \'video/mp4\'\r\n        xml.link episode_url(episode)\r\n        xml.guid({:isPermaLink => \"false\"}, episode.permalink)\r\n        xml.itunes :author, author\r\n        xml.itunes :subtitle, truncate(episode.description, :length => 150)\r\n        xml.itunes :summary, episode.description\r\n        xml.itunes :explicit, \'no\'\r\n        xml.itunes :duration, episode.duration\r\n      end\r\n    end\r\n  end\r\nend\r\n```\r\n\r\nThis template is stolen from Ryan Bates project. This is Rails built-in feature. We don\'t need any gems. In devise.rb, uncomment:\r\n\r\n```ruby\r\nconfig.http_authenticatable = true\r\n```\r\n\r\nto turn on HTTP authentication in the controller. In the episodes controller, you must have the before action to authenticate the user for access to paid only RSS feed:\r\n\r\n```ruby\r\nbefore_action :authenticate_user! , only: [:paid]\r\n```\r\n\r\nThat\'s it. Now the subscribers will be able to access your paid RSS feed using the credentials on your site. It\'s easy to use basic authentication to secure feeds in Rails 5 with Devise gem.','2017-02-09 04:23:57','2017-02-09 04:27:43'),(4661,'The require and load path in Ruby','The require is a Kernel method in Ruby. In this article, we will see how Ruby knows where to find the files. Can you require a ruby file in the same directory? Let\'s create two files first a.rb: \r\n\r\n```ruby\r\nputs \'a\' \r\n```\r\n\r\nand b.rb: \r\n\r\n```ruby\r\nrequire \'a\' \r\n```\r\n\r\nWill this work? Let\'s run the b.rb:\r\n\r\n```\r\n$ ruby b.rb\r\n `require\': cannot load such file -- a (LoadError)\r\n```\r\n\r\nWe get an error. We can fix this by changing b.rb to:\r\n\r\n```ruby\r\nrequire \'./a\'\r\n```\r\n\r\nNow it works:\r\n\r\n```\r\n$ ruby b.rb\r\na\r\n```\r\n\r\nSpeficying the directory where a.rb file can be found in the require method is problematic. Because if we go back up one directory and run b.rb, it fails with the same error message.\r\n\r\n```\r\ncd ..\r\n$ ruby geme/b.rb\r\n`require\': cannot load such file -- a (LoadError)\r\n```\r\n\r\nThis fails because the dot refers to the Ruby process\'s current working directory not the directory of the source file. So in my case, Ruby looked for a file a.rb in the folder `/Users/bparanj/projects`, that is the directory where the Ruby process ran. But the file was inside `/Users/bparanj/projects/geme`. We can overcome this by using `require_relative` Kernel method. The `require_relative` method specifies files relative to the source file without relying on the directory where the Ruby process was run.\r\n\r\n## Load Path \r\n\r\nLook at the Ruby help screen.\r\n\r\n```\r\n ruby --help\r\nUsage: ruby [switches] [--] [programfile] [arguments]\r\n  -0[octal]       specify record separator (\\0, if no argument)\r\n  -a              autosplit mode with -n or -p (splits $_ into $F)\r\n  -c              check syntax only\r\n  -Cdirectory     cd to directory before executing your script\r\n  -d, --debug     set debugging flags (set $DEBUG to true)\r\n  -e \'command\'    one line of script. Several -e\'s allowed. Omit [programfile]\r\n  -Eex[:in], --encoding=ex[:in]\r\n                  specify the default external and internal character encodings\r\n  -Fpattern       split() pattern for autosplit (-a)\r\n  -i[extension]   edit ARGV files in place (make backup if extension supplied)\r\n  -Idirectory     specify $LOAD_PATH directory (may be used more than once)\r\n  -l              enable line ending processing\r\n  -n              assume \'while gets(); ... end\' loop around your script\r\n  -p              assume loop like -n but print line also like sed\r\n  -rlibrary       require the library before executing your script\r\n  -s              enable some switch parsing for switches after script name\r\n  -S              look for the script using PATH environment variable\r\n  -T[level=1]     turn on tainting checks\r\n  -v, --verbose   print version number, then turn on verbose mode\r\n  -w              turn warnings on for your script\r\n  -W[level=2]     set warning level; 0=silence, 1=medium, 2=verbose\r\n  -x[directory]   strip off text before #!ruby line and perhaps cd to directory\r\n  --copyright     print the copyright\r\n  --enable=feature[,...], --disable=feature[,...]\r\n                  enable or disable features\r\n  --external-encoding=encoding, --internal-encoding=encoding\r\n                  specify the default external or internal character encoding\r\n  --version       print the version\r\n  --help          show this message, -h for short message\r\nFeatures:\r\n  gems            rubygems (default: enabled)\r\n  rubyopt         RUBYOPT environment variable (default: enabled)\r\n``` \r\n\r\nThe -I switch specifies the load path directory. So if we change our require method argument back to just `a` in b.rb:\r\n\r\n```ruby\r\nrequire \'a\'\r\n```\r\n\r\nand use this flag to pass the current directory it should work.\r\n\r\n```\r\n$ ruby -I . b.rb\r\na\r\n```\r\n\r\nIt works! The dot after -I switch specifies the directory where the require can find files. In this case, the current directory. What is load path in Ruby? In Ruby identifiers starting with a dollar sign is a global variable, if we run interactive Ruby we can see what load path contains by default.\r\n\r\n```\r\n$ irb\r\n> $LOAD_PATH\r\n => [\"/Users/bparanj/.rvm/rubies/ruby-2.2.3/lib/ruby/site_ruby/2.2.0\", \"/Users/bparanj/.rvm/rubies/ruby-2.2.3/lib/ruby/site_ruby/2.2.0/x86_64-darwin14\", \"/Users/bparanj/.rvm/rubies/ruby-2.2.3/lib/ruby/site_ruby\", \"/Users/bparanj/.rvm/rubies/ruby-2.2.3/lib/ruby/vendor_ruby/2.2.0\", \"/Users/bparanj/.rvm/rubies/ruby-2.2.3/lib/ruby/vendor_ruby/2.2.0/x86_64-darwin14\", \"/Users/bparanj/.rvm/rubies/ruby-2.2.3/lib/ruby/vendor_ruby\", \"/Users/bparanj/.rvm/rubies/ruby-2.2.3/lib/ruby/2.2.0\", \"/Users/bparanj/.rvm/rubies/ruby-2.2.3/lib/ruby/2.2.0/x86_64-darwin14\"]\r\n```\r\n\r\n### Sidenote\r\n\r\nLooking at this output I got curious about `site_ruby` and `vendor_ruby` directories. I found a good explanation by Ammar on the Ruby mailing list.\r\n\r\n> The theory is, things you or your admin installs go into `site_ruby`, as they are specific to the site (machine, server, etc.) Things installed by the distribution (for example MRI, jruby, etc.) go into `vendor_ruby`, they are specific to that distribution vendor. There are also architecture specific directories under each, for example `site_ruby/1.9.1/i686-linux` or `vendor_ruby/1.9.1/i386-darwin`, that contain modules specific to that machine\'s architecture. If you look at the contents of the default load paths (p $:) you\'ll notice that the site directories come before the vendor directories, allowing you to \"override\" certain vendor modules with ones you install, in site. BTW, this is not specific to ruby. perl, python, php, and others have a similar arrangement. -- Ammar (Ruby mailing list)\r\n\r\nComing back to our topic at hand, the load path is an array of absolute paths. So in b.rb let\'s add to load path the directory containing a.rb. In this case we can add the current directory before the require statement. \r\n\r\n```ruby\r\n$LOAD_PATH.unshift(\'.\')\r\nrequire \'a\'\r\n```\r\n\r\nRuby will now know where to find the a.rb file without needing the load path modifier flag. \r\n\r\n```\r\n$ ruby b.rb\r\na\r\n```\r\n\r\nIt now works. The unshift will put the argument in the beginning of the array. Here is a quick example:\r\n\r\n```ruby\r\n$ irb\r\n> [1,2].unshift(0)\r\n => [0, 1, 2]\r\n```\r\n\r\nBut this still has the same problem when you run the program from some other directory. \r\n\r\n```ruby\r\n$ cd ..\r\nprojects bparanj$ ruby geme/b.rb\r\n `require\': cannot load such file -- a (LoadError)\r\n```\r\n\r\nWe can fix it like this:\r\n\r\n```ruby\r\nfolder = File.expand_path(\'.\',__dir__)\r\n$:.unshift(folder) unless $:.include?(folder)\r\n\r\nrequire \'a\'\r\n```\r\n\r\nThe line:\r\n\r\n```ruby\r\nFile.expand_path(\'.\',__dir__)\r\n```\r\n\r\ngives the expanded path where the b.rb resides. In my case, it is `/Users/bparanj/projects/geme`. Now I can run this program from any folder, for instance I can go back up one directory:\r\n\r\n```\r\n$ cd ..\r\nprojects bparanj$ ruby geme/b.rb\r\na\r\n```\r\n\r\nIt works. Even from my home directory:\r\n\r\n```\r\n$ ruby projects/geme/b.rb\r\na\r\n```\r\n\r\nIt still works! So, Ruby will concatenate the folder and the a.rb to find the location of a.rb file, read this file into memory and execute the code for top to bottom. In this article, you learned how the require and load path work in Ruby and how you can run a ruby program using require from any directory.','2017-02-12 07:31:04','2017-02-19 05:43:10'),(4671,'Twitter Bootstrap 4 : Testimonials using Salvattore Javascript Library','Create testimonial.css:\r\n\r\n```css\r\n.testimonial-row {\r\n	margin-right: 5px;\r\n}\r\n.testimonial-column {\r\n    padding: 10px;\r\n    border: 1px solid #000000;\r\n    margin: 5px;\r\n    background-color: #FFFFFF;\r\n}\r\n```\r\n\r\nAdd the Testimonials tab to the index.html file.\r\n\r\n```html\r\n<li class=\"nav-item\">\r\n  <a class=\"nav-link\" href=\"#\">Login</a>\r\n  <a href=\"#testimonials\" class=\"nav-link\" data-toggle=\"tab\">Testimonials</a>\r\n</li>\r\n```\r\n\r\nAdd the link to testimonial.css in index.html file.\r\n\r\n```html\r\n<link rel=\"stylesheet\" href=\"testimonial.css\" >\r\n```\r\n\r\nAdd the html for the testimonials. The following is the testimonials for my [TDD in Ruby](https://rubyplus.com/sales/new?id=11) course. \r\n\r\n```html\r\n<div class=\'container\'>      \r\n  <div role=\"tabpanel\" class=\"tab-pane\" id=\"testimonials\">\r\n    <div class=\"container\">\r\n      <div class=\"row testimonial-row\">\r\n        <div class=\"col-xs-3 testimonial-column\">\r\n          <h6>Jeff Casimir, Principal, Jumpstart Lab</h6>\r\n          <p>\r\n            The actual coding TDD examples for Fizz Buzz and Fibonacci were really well done.\r\n            During the coding exercises the refactoring of code was a good illustration of how to improve certainty of test results\r\n            Good overview of the importance of testing\r\n            Each lecture / exercise was only 5-10 minutes providing nice incremental gains in the course\r\n          </p>\r\n        </div>\r\n        <div class=\"col-xs-3 testimonial-column\">\r\n          <h6>Mylene Reiners</h6>\r\n          <p>When you want a theoretical background on TDD, this course is great (and the Ruby part is not too hard for people knowing only a little Ruby...)</p>\r\n        </div>\r\n        <div class=\"col-xs-3 testimonial-column\">\r\n          <h6>Yury Voloshin</h6>\r\n          <p>This is a good introduction to TDD for those who either have never used it or who have a very rudimentary understanding of it. Some of the more advanced concepts toward the end are somewhat rushed through, but I\' sure that can\'t be helped due to time constraints and to the nature of the material. At least now I know the topics that I need to into more deeply.</p>\r\n        </div>\r\n        <div class=\"col-xs-3 testimonial-column\">\r\n          <h6>Nikolas</h6>\r\n          <p>This course introduces a solid foundation for practicing TDD. The instructor definitely knows what he\'s teaching. Information is divided in small logical and understandable chunks/lectures.</p>\r\n        </div>\r\n      </div>\r\n      <div class=\"row testimonial-row\">\r\n        <div class=\"col-xs-3 testimonial-column\">\r\n          <h6>Jesse Mignac</h6>\r\n          <p> Techniques, examples and theoretical material. This course is a really nice start to TDD with Ruby </p>\r\n        </div>\r\n        <div class=\"col-xs-3 testimonial-column\">\r\n          <h6> Andrew Platkin</h6>\r\n          <p> Very good pace and learned alot </p>\r\n        </div>\r\n      </div>\r\n      <div class=\"row testimonial-row\">\r\n        <div class=\"col-xs-3 testimonial-column\">\r\n          <h6>Thom Parkin </h6>\r\n            <p> The beginning of this course seems a bit slow and very dry. But your patience is well rewarded because the depth and detail of information provided is priceless! Mr. Paranj uses a time-tested technique of methodical presentation of ideas, one built upon the other, to its ultimate success. I am grateful and impressed by this course.</p>\r\n        </div>\r\n        <div class=\"col-xs-3 testimonial-column\">\r\n          <h6>Jikku Jose</h6>\r\n          <p>I am very happy to have such a comprehensive course from Mr. Paranj. I have been trying to do TDD in my projects for quite sometime without much success. This course helped a lot to expose much of the concepts and details one should focus on while doing TDD.  I wish the examples mentioned in \"Fake It till you make it\" and \"Triangulation\" was a bit more involved rather than the basic ones presented so that the techniques could be better understood.  I thank Mr. Paranj and Udemy for the course, it really helped me. Hope more advanced Ruby related materials can be brought out.\r\n          </p>\r\n        </div>\r\n        <div class=\"col-xs-3 testimonial-column\">\r\n           <h6>Pawel Jackowski</h6>\r\n           <p> Instructor knows TDD and explains it with ease. I am quite familiar with technique and just wanted to refresh knowledge and I still recommend course. I definitely learned something about common mistakes and importance of every step in TDD sequence. I enrolled for free.\r\n           </p>\r\n        </div>\r\n        <div class=\"col-xs-3 testimonial-column\">\r\n          <h6>Steve Freeman </h6>\r\n            <p> Instructor uses katas very effectively to show the patterns behind TDD. His clear examples and pointers to material for further study were very helpful and I look forward to practicing katas on my own. If you\'re trying to make sense of TDD I highly recommend this class!\r\n            </p>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  </div>   \r\n<div>\r\n```\r\n\r\nThe testimonials page looks like as shown in the following screenshot. \r\n\r\n<img src=\"https://4.bp.blogspot.com/-l_Pavp-DBy4/WJ_vfnbzhNI/AAAAAAAABV8/GKlt6t1OFsoiqPCCkNIfcINw5YPQzR3BgCLcB/s1600/Screen%2BShot%2B2017-02-11%2Bat%2B9.14.16%2BPM.png\" alt=\"Twitter Bootstrap 4\" style=\"border: 1px solid #000; max-width:800px; max-height:600px;\" />\r\n\r\nThis article will be updated once I resolve the pending issues with the testimonials page.\r\n','2017-02-12 08:33:44','2017-02-12 08:33:44'),(4681,'Loading Code in Rails ActiveSupport Gem','Loading code means reading the file containing code into memory and executing it. You can open the activesupport gem in your text editor if it is part of Rails project (because it needs Gemfile to resolve which version to use). You must have set the $EDITOR variable to your favorite text editor. In my case, it is Textmate.\r\n\r\n```\r\necho $EDITOR\r\n/usr/local/bin/mate\r\n```\r\nIf you are not working on a Rails project or have not setup Gemfile for the bundler, you will get the error:\r\n\r\n```\r\nbundle open activesupport\r\nCould not locate Gemfile or .bundle/ directory\r\n```\r\n\r\nIn such cases, you can use gemedit gem. Install it.\r\n\r\n```\r\ngem install gemedit\r\n```\r\n\r\nAnd open the gem using the edit as the argument to the gem command.\r\n\r\n```\r\ngem edit activesupport\r\nOpening the activesupport gem, version 5.0.1, with mate from /Users/bparanj/.rvm/gems/ruby-2.2.3/gems/activesupport-5.0.1\r\n```\r\n\r\nBrowsing the source code, I noticed there is no gemspec in it. The files directive in gemspec specifies the files to be included in the gem, like this:\r\n\r\n```ruby\r\ns.files        = Dir[\"CHANGELOG.md\", \"MIT-LICENSE\", \"README.rdoc\", \"lib/**/*\"]\r\n```\r\n\r\nThis is from the activesupport gemspec file. Ideally, we should be able to do `require \'activesupport\':\r\n\r\n```ruby\r\n$ irb\r\n> require \'activesupport\'\r\nLoadError: cannot load such file -- activesupport\r\n```\r\n\r\nThis throws an error. If you use underscore to separate the words:\r\n\r\n```ruby\r\n$ irb\r\n> require \'active_support\'\r\n => true\r\n```\r\n\r\nIt works. Why the gem name is not used in the require? Why do you need the underscore? If you read the [rubygems guide](http://guides.rubygems.org/name-your-gem/), you can see the recommended convention:\r\n\r\n<img src=\"https://1.bp.blogspot.com/-qprqq9nGQGs/WKODfZKnqxI/AAAAAAAABWU/2uelChWY3TQ7t6AVh6B_gOi0ClZN7qFSgCLcB/s1600/Screen%2BShot%2B2017-02-14%2Bat%2B2.19.51%2BPM.png\" alt=\"Twitter Bootstrap 4\" style=\"border: 1px solid #000; max-width:800px; max-height:600px;\" />\r\n\r\nGo to [activesupport github repository](https://github.com/rails/rails/tree/master/activesupport), look at the gemspec, name within the block shows that it is called `activesupport`. So:\r\n\r\nGem name is : activesupport\r\nMain module is : ActiveSupport in `active_support.rb`\r\nThe require uses : `active_support`.\r\n\r\nUnfortunately, the activesupport gem does not follow the ruby gems convention.\r\n\r\n## How to Name Gems \r\nby Eric Hodel \r\n\r\nReproduced here, because his original blog post fell out of the Internet ;-)\r\n\r\n### Use underscores for multiple words.\r\n\r\nUse underscore to separate multiple words. This matches the file the user will require makes it easier to start using the gem. Install by gem install `my_gem`. Load it by `require \'my_gem\'`.\r\n\r\n### Use dashes for extensions.\r\n\r\nIf you\'re adding functionality to another gem use a dash. The dash is different-enough from an underscore to be noticeable. If you tilt the dash a bit it becomes a slash as well, making it easier for the user to know what to require. gem install net-http-persistent becomes require \'net/http/persistent\'\r\n\r\n### Mix underscores and dashes appropriately\r\n\r\nRead [name your gem](http://guides.rubygems.org/name-your-gem) for more details.\r\n\r\n## What to Require ?\r\n\r\nHow do people answering questions on forums figure out what to require ? How do we load the code we need to use the methods from the library?\r\n\r\n```ruby\r\n> require \'active_support\'\r\n => true\r\n> \'\'.blank?\r\nNoMethodError: undefined method `blank?\' for \"\":String\r\n```\r\n\r\nSimply requiring the entire gem does not do anything. This is by design, to reduce the memory footprint. We know blank? is a method on the String object. Searching for `def blank?` using Textmate in activesupport gives 4 different files and 10 locations where it is defined. Reading the source code, the `active_support/core_ext/object/blank.rb` seems to be relevant to our task at hand. We can include this file in the IRB and use the blank? method.\r\n\r\n```ruby\r\n$ irb\r\n> require \'active_support/core_ext/object/blank\'\r\n => true\r\n> \'\'.blank?\r\n => true\r\n```\r\n\r\nWhat happens if we load all the core extensions of `active_support`?\r\n\r\n```ruby\r\n$ irb\r\n> require \'active_support/core_ext\'\r\nNameError: uninitialized constant ActiveSupport::Autoload\r\n```\r\n\r\nWe need to require the `active_support` first that does the initialization of autoload. So:\r\n\r\n```ruby\r\n> require \'active_support\'\r\n => true\r\n> require \'active_support/core_ext\' \r\n/Users/bparanj/.rvm/gems/ruby-2.2.3/gems/activesupport-5.0.1/lib/active_support/core_ext.rb:1: warning: already initialized constant DEPRECATED_FILES\r\n/Users/bparanj/.rvm/gems/ruby-2.2.3/gems/activesupport-5.0.1/lib/active_support/core_ext.rb:1: warning: previous definition of DEPRECATED_FILES was here\r\n => true\r\n> \'\'.blank?\r\n => true\r\n```  \r\n\r\nWe are now able to use the blank? method. This is different from including just the blank.rb because, we can use any core extension method of activesupport if we `require \'active_support/core_ext\'`.\r\n\r\n## Loading Grouped Core Extensions\r\n\r\nWe can load all the extensions defined for the Ruby Object by doing this:\r\n\r\n```ruby\r\nrequire \'active_support\'\r\nrequire \'active_support/core_ext/object\'\r\n```\r\n\r\nThe object.rb in `active_support/core_ext` folder is like this:\r\n\r\n```ruby\r\nrequire \'active_support/core_ext/object/acts_like\'\r\nrequire \'active_support/core_ext/object/blank\'\r\nrequire \'active_support/core_ext/object/duplicable\'\r\nrequire \'active_support/core_ext/object/deep_dup\'\r\nrequire \'active_support/core_ext/object/try\'\r\nrequire \'active_support/core_ext/object/inclusion\'\r\n\r\nrequire \'active_support/core_ext/object/conversions\'\r\nrequire \'active_support/core_ext/object/instance_variables\'\r\n\r\nrequire \'active_support/core_ext/object/json\'\r\nrequire \'active_support/core_ext/object/to_param\'\r\nrequire \'active_support/core_ext/object/to_query\'\r\nrequire \'active_support/core_ext/object/with_options\'\r\n```\r\n\r\nYou can see that it loads all the files inside the `active_support/core_ext/object` folder. You can verify it by browsing the source code for activesupport.\r\n\r\n## Loading All Core Extensions\r\n\r\nYou can:\r\n\r\n```ruby\r\nrequire \'active_support/all\'\r\n```\r\n\r\nto load everything in activesupport gem. The all.rb looks like this:\r\n\r\n```ruby\r\nrequire \'active_support\'\r\nrequire \'active_support/time\'\r\nrequire \'active_support/core_ext\'\r\n```\r\n\r\nFor the third require, the `core_ext.rb` in `active_support/core_ext.rb` looks like this:\r\n\r\n```ruby\r\nDEPRECATED_FILES = [\"#{File.dirname(__FILE__)}/core_ext/struct.rb\"]\r\n(Dir[\"#{File.dirname(__FILE__)}/core_ext/*.rb\"] - DEPRECATED_FILES).each do |path|\r\n  require path\r\nend\r\n```\r\n\r\nFor the second require, the time.rb in `active_support/time.rb` looks like this:\r\n\r\n```ruby\r\nmodule ActiveSupport\r\n  autoload :Duration, \'active_support/duration\'\r\n  autoload :TimeWithZone, \'active_support/time_with_zone\'\r\n  autoload :TimeZone, \'active_support/values/time_zone\'\r\nend\r\n\r\nrequire \'date\'\r\nrequire \'time\'\r\n\r\nrequire \'active_support/core_ext/time\'\r\nrequire \'active_support/core_ext/date\'\r\nrequire \'active_support/core_ext/date_time\'\r\n\r\nrequire \'active_support/core_ext/integer/time\'\r\nrequire \'active_support/core_ext/numeric/time\'\r\n\r\nrequire \'active_support/core_ext/string/conversions\'\r\nrequire \'active_support/core_ext/string/zones\'\r\n```\r\n\r\nHow to make sense of the Implementation of `core_ext.rb`? Let\'s deconstruct the code in `core_ext.rb` by designing small experiments to figure out how this code works. I am reducing the unknown to just one concept in each experiment. I am in my home directory.\r\n\r\n```\r\npwd\r\n/Users/bparanj\r\n```\r\n\r\nLet\'s see what `__FILE__` means.\r\n\r\n```\r\ncat test.rb\r\nputs __FILE__\r\n```\r\n\r\nRunning this program prints the name of the ruby file containing the code.\r\n\r\n```ruby\r\n$ ruby test.rb\r\ntest.rb\r\n```\r\n\r\nThe `__FILE__` is the current file name. Let\'s pass the `__FILE` to the dirname method.\r\n\r\n```ruby\r\n$ cat test.rb\r\nputs File.dirname(__FILE__)\r\n```\r\n\r\nRunning this program prints a dot, meaning the current directory.\r\n\r\n```\r\nruby test.rb\r\n.\r\n```\r\n\r\nAccording to the Ruby docs, the dirname(file_name):\r\n\r\n> Returns all components of the filename given in `file_name` except the last one. The filename can be formed using both `File::SEPARATOR` and `File::ALT_SEPARATOR` as the separator when `File::ALT_SEPARATOR` is not nil.\r\n\r\nLet\'s now add the Dir method to our test.rb.\r\n\r\n```ruby\r\ncat test.rb\r\nputs Dir[\"#{File.dirname(__FILE__)}/tok/con/app/models/*.rb\"]\r\n```\r\n\r\nThis prints the directory location going from current directory (my home directory) all the files including the file name.\r\n \r\n```\r\nruby test.rb\r\n./tok/con/app/models/application_record.rb\r\n./tok/con/app/models/article.rb\r\n```\r\n\r\nSo, this:\r\n\r\n```ruby\r\n(Dir[\"#{File.dirname(__FILE__)}/core_ext/*.rb\"]).each do |path|\r\n  require path\r\nend\r\n```\r\n\r\nexpands to this:\r\n\r\n```ruby\r\nrequire \'./core_ext/array\'\r\nrequire \'./core_ext/benchmark\'\r\n...\r\n... # more files not shown here\r\n...\r\nrequire \'./core_ext/uri\'\r\n```\r\n\r\nto include all the .rb files in the `core_ext` directory. That\'s how we are able to use any of the methods in the core extension of the activesupport library. In this article, you learned how Rails loads code in activesupport gem. Understanding this concept will help you figure out what to require when you want to use activesupport gem outside of Rails. The rails console automatically does require so you don\'t need to know any of these concepts. \r\n\r\n## References\r\n\r\n- [Ruby Docs dirname](https://ruby-doc.org/core-2.2.0/File.html#method-c-dirname)\r\n- [ActiveSupport Gemspec](https://github.com/rails/rails/blob/master/activesupport/activesupport.gemspec)\r\n- [ActiveSupport Core Extensions](http://guides.rubyonrails.org/active_support_core_extensions.html)','2017-02-15 04:41:02','2017-02-19 05:39:54'),(4691,'Ruby and Gems Installation Basics','## Ruby Installation \r\n\r\nYou can install ruby easily using installers that walks you through a GUI. The problem is that you don\'t have an understanding of what happens when you install Ruby. This article will provide the basics needed to understand the installation process. \r\n\r\nYou can download the source for Ruby as a tar.gz file from Ruby home page by using curl or a browser and extract it by clicking it or using the tar command. You can go into the extracted directory and run the configure, make and sudo make install to install Ruby. The configure step can be used to configure the directory where Ruby can be installed. If you don\'t provide a directory, the installation script will copy it to a default directory. The main job of the configure step is to create a Makefile that has rules. The make utility will read the rules. Some of the Ruby code is written in C. The C code is compiled in the make step and the executable is copied from a temporary directory to the system directory in the make install step. Ruby by default is installed in the system directory so that any user who has an account on your machine can use.  \r\n\r\n## The PATH Variable\r\n\r\nIf you open a terminal and go to any directory, you are able to run ruby. How does that work? When you installed Ruby, the installation program adds the directory of the Ruby executable to the path variable PATH. You can run:\r\n\r\n```\r\necho $PATH\r\n```\r\n\r\nto see the list of all directories in the path variable. When you run Ruby in the terminal, the OS looks in the PATH variable, it goes from left to right and when it encounters the first occurrence of a Ruby executable, it stops searching. Even if you have a newer version installed that is in the $PATH after the older version, the older version will get picked up. \r\n \r\n## Location of Gems and Ruby Executable\r\n\r\nYou can use the gem command to see where the gems are installed on your system.\r\n\r\n```\r\n gem env\r\nRubyGems Environment:\r\n  - RUBYGEMS VERSION: 2.4.5.1\r\n  - RUBY VERSION: 2.2.3 (2015-08-18 patchlevel 173) [x86_64-darwin14]\r\n  - INSTALLATION DIRECTORY: /Users/bparanj/.rvm/gems/ruby-2.2.3\r\n  - RUBY EXECUTABLE: /Users/bparanj/.rvm/rubies/ruby-2.2.3/bin/ruby\r\n```\r\n\r\nThe INSTALLATION DIRECTORY shows you the directory where all the gems are installed on your system. In my machine:\r\n\r\n```\r\nls -l \r\n/Users/bparanj/.rvm/gems/ruby-2.2.3/gems\r\n```\r\n\r\nshows all the gems installed on my machine. The Ruby executable is in the `/Users/bparanj/.rvm/rubies/ruby-2.2.3/bin/ruby` folder displayed as the value of RUBY EXECUTABLE. I can verify this by using the `which` command.\r\n\r\n```\r\nwhich ruby\r\n/Users/bparanj/.rvm/rubies/ruby-2.2.3/bin/ruby\r\n```\r\n\r\nIn this article, you learned the basics of Ruby installation and what happens when you install Ruby from source. If you worked on Rails projects, you may be aware that you use a similar process to install ImageMagick library. This is the basics of Ruby and provides a good foundation to learn about `$LOAD_PATH` and `$LOADED_FEATURES` that will be discussed in upcoming articles.','2017-02-15 05:02:39','2017-02-19 05:33:20'),(4701,'Ruby Basics : Class','# Class\r\n\r\nIn this article, you will the learn the basics of a class and how to define them in a program. We will look at the concept of car and how to represent a car in a program.\r\n\r\n## Concept of Car\r\n\r\nA car has attributes such as color, price, model and so on. You can exercise certain behavior such as drive, stop, turn, etc on a car.\r\n\r\n![Car Concept](https://images.rubyplus.com/car-concept.png)\r\n\r\n## Representing a Car\r\n\r\nWe can represent the concept of a car using a class.\r\n\r\n![Car Class](https://images.rubyplus.com/Class-Car.png)\r\n\r\nA class has a class name. In this example, the class name is Car.\r\n\r\n## Defining a Class\r\n\r\nLet\'s define a Car class.\r\n\r\n```ruby\r\nclass Car\r\nend\r\n```\r\n\r\n![Car](https://images.rubyplus.com/car.png)\r\n\r\nWe use the **class** keyword followed by the class name to define a class. In this case, Car is the class name.\r\n\r\n## Representing the Behavior\r\n\r\nWe can represent the drive behavior of a car by defining a **drive()** method for the Car class.\r\n\r\n```ruby\r\nclass Car\r\n  def drive()\r\n    return \'driving\'\r\n  end\r\nend\r\n```\r\n\r\n![Defining a Method](https://images.rubyplus.com/defining-method.png)\r\n\r\nThe methods provide the behavior for the objects. We use the **def** keyword followed by the method name to define a method. The body of the method becomes the implementation. \r\n\r\n## Car Class Analogy\r\n\r\nA Car class is like a car blueprint.\r\n\r\n![Car Blueprint](https://images.rubyplus.com/car-bluprint.png)\r\n\r\nA car blueprint is used to manufacture many cars.\r\n\r\n![Key Takeaways](https://images.rubyplus.com/kts2.png)\r\n\r\n* A car class acts as a template used to create cars.\r\n* A car class describes the behavior and attributes of a car.\r\n \r\n![Exercise](https://images.rubyplus.com/Exercise.png)\r\n\r\nDefine a method in the Car class to stop a car.\r\n\r\n## Summary\r\n\r\nIn this article, you learned the concept of class. A class describes the behavior and attributes of a certain concept. ','2017-02-22 02:58:46','2017-02-22 02:59:39'),(4711,'Ruby Basics : Object','In this article, you will the learn the basics of an object and how to create them.\r\n\r\n## Car Class\r\n\r\nIn the previous article, we defined a Car class. It has **drive** method that provides the behavior for the Car class.\r\n\r\n```ruby\r\nclass Car \r\n  def drive\r\n    return \'driving\'\r\n  end\r\nend\r\n```\r\n\r\n## Car Class Analogy\r\n\r\nCar class is like a car blueprint.\r\n\r\n![Car Blueprint](https://images.rubyplus.com/car-bluprint.png)\r\n\r\n## Car Object Analogy\r\n\r\nCar object is like a car made using the car blueprint.\r\n\r\n![Car Object](https://images.rubyplus.com/car-ferrari.jpg)\r\n\r\nWe cannot drive a car blueprint. We need a real car to exercise the drive behavior. How we do we create a car that we can drive in a Ruby program?\r\n\r\n## Car Object\r\n\r\nWe use the blueprint to create an object. The process of creating an object from a class is called instantiation. In Ruby the **new** method is used for instantiating an object. Let\'s create an instance of the Car class.\r\n\r\n```ruby\r\nclass Car \r\n  def drive\r\n    return \'driving\'\r\n  end\r\nend\r\n\r\ncar = Car.new\r\n```\r\nWe now have a car object. How do we invoke the drive behavior of the car object?\r\n\r\n## Sending the Message\r\n\r\nWe invoke the drive behavior by sending a message to the car object. Let\'s send the **drive** message to the car object.\r\n\r\n```ruby\r\np car.drive\r\n```\r\n\r\nThe dot notation is used to send a message to any object. This prints:\r\n\r\n```ruby\r\ndriving\r\n```\r\n\r\nFrom now on, you will hear *calling a method* and *invoking a method*. These terms mean the same thing as sending a message.\r\n\r\n## Return Value of Method\r\n\r\nIn Ruby, the last statement executed is the return value of a method. We can simplify the program by removing the return statement in the **drive** method.\r\n\r\n```ruby\r\nclass Car \r\n  def drive\r\n    \'driving\'\r\n  end\r\nend\r\n\r\ncar = Car.new(\'red\')\r\np car.drive\r\n```\r\n\r\nThis will still print:\r\n\r\n```\r\ndriving\r\n```\r\n\r\n![Key Takeaway](https://images.rubyplus.com/kt2.png)\r\n\r\n* Every object is an instance of a class.\r\n\r\n## Summary\r\n\r\nIn this article, we created a car object by creating an instance of the Car class. We invoked the instance method by sending a drive message. ','2017-02-23 04:33:50','2017-02-23 04:33:50'),(4721,'Ruby Basics : Creating an Object','In this article, you will learn how to create an object and the initialization process.\r\n\r\n## Initialization\r\n\r\nInitialization is the process of preparing an instance of a class. This process involves setting an initial value for each instance variable on that instance. Any required setup is also performed before the new instance is ready for use. For the car example, it will answer questions such as:\r\n\r\n- How many doors?\r\n- What is the color?\r\n- Auto or Manual transmission?\r\n\r\nWe can say:\r\n```ruby\r\ndoor = 2\r\ncolor = \'red\'\r\ntransmission = \'auto\'\r\n```\r\n\r\n![Initialization of Car Object](https://images.rubyplus.com/initialization-of-car-object.png)\r\n\r\nThe code answers those questions by initializing the variables. How do we initialize instance variables? Where do we initialize them? Let\'s discuss about them now.\r\n\r\n## Instance Variable\r\n\r\nAn instance variable has a name beginning with @. The instance variables comprise the state unique to an object. We can have two car objects with different colors such as red and black. Let\'s say that the instances of the Car class have an instance variable called **color**. We can initialize the color instance variable like this:\r\n\r\n```ruby\r\nclass Car\r\n  def initialize(color)\r\n    @color = color\r\n  end\r\nend\r\n```\r\n\r\n![Color Instance Variable](https://images.rubyplus.com/color-instance-variable.png)\r\n\r\n![Unique State of an Object](https://images.rubyplus.com/unique-state-of-an-object.png)\r\n\r\nThe parameters to the initialize method is used to assign initial values to the attributes of an object. Instance variables spring into existence when they are initialized for the first time. In this example, we initialize the color instance variable @color in the **initialize** method. We can now create an instance of a car object with a specific color.\r\n\r\n```ruby\r\ncar = Car.new(\'red\')\r\n```\r\n\r\nWe send the **new()** message to the Car class with the color **red** as the argument. \r\n\r\n![Car Instance](https://images.rubyplus.com/car-instance.png)\r\n\r\nRuby calls the **initialize** method with **red** as the argument. In the **initialize** method, we store the value of color, red, in the instance variable @color.\r\n\r\n## Fabio Asks\r\n\r\n**What happens if you call the initialize method?**\r\n\r\nLet\'s call the initialize method.\r\n\r\n```ruby\r\nCar.initialize(\'black\')\r\n```\r\n\r\nYou will get the error:\r\n\r\n```\r\nNoMethodError: private method ‘initialize’ called for Car:Class\r\n```\r\n\r\nWe cannot call the **initialize** method. Only Ruby can call it. To initialize an instance of any class, always use the **new** method.\r\n\r\n![Creating a Car Object](https://images.rubyplus.com/creating-car-object.png)\r\n\r\n## Uninitialized Instance Variables\r\n\r\nInstance variables have nil value if they are not initialized. The nil represents the concept of nothing in Ruby. Let\'s look at an example.\r\n\r\n```ruby\r\nclass Car  \r\n  def initialize(color)\r\n    @color = color\r\n  end\r\n  \r\n  def price\r\n    @price\r\n  end\r\n  \r\n  def drive\r\n    return \'driving\'\r\n  end\r\nend\r\n\r\nc = Car.new(\'red\')\r\np c.price\r\n```\r\n\r\nThis prints nil. The Car class has a new method called **price** that returns the price instance variable of the car. Since it was not initialized anywhere in the Car class, it has nil value.\r\n\r\n## Rhonda Asks\r\n\r\n**Why is it called an instance variable?**\r\n\r\nBecause the variable is unique to a specific instance of a class.\r\n\r\n## Summary\r\n\r\nIn this article, you learned about the initialization of an object. Initialization process instantiates a specific object with certain attributes.','2017-02-23 16:54:49','2017-02-23 16:54:49'),(4731,'Ruby Basics : State and Behavior','Instance variables represent the state of an object. The instance methods defined in the class provide the behavior for an object. Every object has its own unique state. But they share the same instance method behavior defined in the class. We can have a black car that has its own color that shares the drive method. \r\n\r\n```ruby\r\nclass Car\r\n  def initialize(color)\r\n    @color = color\r\n  end\r\n  \r\n  def drive\r\n    \'driving\'\r\n  end\r\nend\r\n\r\nblack_car = Car.new(\'black\')\r\np black_car.drive\r\n```\r\n\r\nThis prints:\r\n\r\n```\r\ndriving\r\n```\r\n\r\n![Instance Variable and Instance Method](https://images.rubyplus.com/multiple-objects-share-single-method2.png)\r\n\r\n## Rhonda Asks\r\n\r\n**Why is the method defined in the Car class called as an instance method?**\r\n\r\nBecause, we need an instance of the Car class to call the method.\r\n\r\n## Instance Variables Live in the Object\r\n\r\nWe can ask Ruby to list all the instance variables for car object.\r\n\r\n```ruby\r\np car.instance_variables\r\n```\r\n\r\nThis prints:\r\n\r\n```ruby\r\n[:@color]\r\n```\r\n\r\n![Instance Variables Live in Object](https://images.rubyplus.com/instance-variables-of-car.png)\r\n\r\nThe illustration shows that you can define many instance variables such as color, model of the car etc. for a car. Let\'s print the instance variables in the Car class.\r\n\r\n```ruby\r\np Car.instance_variables\r\n```\r\n\r\nThis prints:\r\n\r\n```ruby\r\n[]\r\n```\r\n\r\nThe result array is empty. There are no instance variables in the Car class.\r\n\r\n## Instance Method Lives in the Class\r\n\r\nWe can ask Ruby for the list of instance methods in the Car class.\r\n\r\n```ruby\r\np Car.instance_methods(false)\r\n```\r\n\r\nThis prints: \r\n\r\n```ruby\r\n[:drive]\r\n```\r\n\r\nThe Car class defines the **drive** instance method, so it shows up in the output. We pass **false** to the `instance_methods` to print instance methods found in the Car class only.\r\n\r\n![Drive Instance Method](https://images.rubyplus.com/drive-instance-methods.png)\r\n\r\nThe illustration shows that you can define many instance methods in the Car class. If you print the instance methods for the car object:\r\n\r\n```ruby\r\np car.instance_methods(false)\r\n```\r\n\r\nYou will get an error:\r\n\r\n```\r\nNoMethodError: undefined method ‘instance_methods’ for #<Car:0x00ca0 @color=\"red\">\r\n```\r\n\r\n![Key Takeaways](https://images.rubyplus.com/kts2.png)\r\n\r\n* Instance methods live in the class.\r\n* Instance variables live in the object.\r\n* Instance variables are unique to each object.\r\n\r\n## Summary\r\n\r\nIn this article, you learned about the state and behavior and where the instance methods and instance variables live.','2017-02-24 17:53:08','2017-02-24 17:53:08'),(4741,'Ruby Basics : Hidden Instance Variables','In this article, you will learn about inspecting an object, customizing the inspect message and visibility of instance variables.\r\n\r\n## Inspecting an Object\r\n\r\nWe can print the car object to inspect it.\r\n\r\n```ruby\r\nclass Car\r\n  def initialize(color)\r\n    @color = color\r\n  end\r\n  \r\n  def drive\r\n    \'driving\'\r\n  end\r\nend\r\n\r\ncar = Car.new(\'red\')\r\np car\r\n```\r\n\r\nThis prints:\r\n\r\n```ruby\r\n#<Car:0xcafb @color=\"red\">\r\n```\r\n\r\nThis shows that the car instance has the color instance variable with the value red and the memory location `#CAFB` of the car object.\r\n\r\n\r\n![Car Object in Memory](https://images.rubyplus.com/car-object-in-memory.png)\r\n\r\n## Customize Inspecting an Object\r\n\r\nWe can provide a custom implementation of **to_s** method.\r\n\r\n```ruby\r\nclass Car\r\n  def initialize(color)\r\n    @color = color\r\n  end\r\n\r\n  def drive\r\n    \'driving\'\r\n  end\r\n  \r\n  def to_s\r\n    \"I am a #{@color} car\"\r\n  end\r\nend\r\n\r\ncar = Car.new(\'red\')\r\nputs car\r\n```\r\n\r\nThe **to_s** provides string representation of the car object. This prints:\r\n\r\n```ruby\r\nI am a red car\r\n```\r\n\r\n![Car Objects with Unique State](https://images.rubyplus.com/car-objects-with-unique-state.png)\r\n\r\n## Visibility of Instance Variable\r\n\r\nThe instance variables are not visible from the outside of an object. \r\n\r\n![Hidden Attribute](https://images.rubyplus.com/hidden-attribute.png)\r\n\r\nLet\'s see what happens when we access the color instance variable.\r\n\r\n```ruby\r\nclass Car\r\n  def initialize(color)\r\n    @color = color\r\n  end\r\n \r\n  def drive\r\n    \'driving\'\r\n  end\r\nend\r\n \r\ncar = Car.new(\'red\')\r\np car.color\r\n```\r\n\r\nThis gives an error:\r\n\r\n```ruby\r\nNoMethodError: undefined method ‘color’ for #<Car:0x007fbc0 @color=\"red\">\r\n```\r\n\r\nWe can define a color method that returns the color instance variable.\r\n\r\n```ruby\r\nclass Car\r\n  def initialize(color)\r\n    @color = color\r\n  end\r\n  \r\n  def color\r\n    @color\r\n  end\r\nend\r\n \r\ncar = Car.new(\'red\')\r\np car.color\r\n```\r\n\r\nThis prints:\r\n\r\n```\r\nred\r\n```\r\n\r\n![Expose Hidden Attribute](https://images.rubyplus.com/expose-hidden-attribute.png)\r\n\r\nRuby has accessors that expose variables to the outside. So, instead of defining our own method, we can use **attr_reader**.\r\n\r\n```ruby\r\nclass Car\r\n  attr_reader :color\r\n  \r\n  def initialize(color)\r\n    @color = color\r\n  end\r\nend\r\n \r\ncar = Car.new(\'red\')\r\np car.color\r\n```\r\n\r\nThis prints:\r\n\r\n```\r\nred\r\n```\r\n\r\n![Key Takeaways](https://images.rubyplus.com/kts2.png)\r\n\r\n* By default, instance variables are hidden from the outside.\r\n* We can expose an instance variable via an accessor.\r\n* You can over-ride the **to_s** method to customize the inspect message.\r\n\r\n## Summary\r\n\r\nIn this article, we inspected the color instance variable of the car object. We also discussed the concept of accessing the instance variables via accessors.','2017-02-25 19:06:16','2017-02-25 19:06:16');
/*!40000 ALTER TABLE `articles` ENABLE KEYS */;
UNLOCK TABLES;
/*!40103 SET TIME_ZONE=@OLD_TIME_ZONE */;

/*!40101 SET SQL_MODE=@OLD_SQL_MODE */;
/*!40014 SET FOREIGN_KEY_CHECKS=@OLD_FOREIGN_KEY_CHECKS */;
/*!40014 SET UNIQUE_CHECKS=@OLD_UNIQUE_CHECKS */;
/*!40101 SET CHARACTER_SET_CLIENT=@OLD_CHARACTER_SET_CLIENT */;
/*!40101 SET CHARACTER_SET_RESULTS=@OLD_CHARACTER_SET_RESULTS */;
/*!40101 SET COLLATION_CONNECTION=@OLD_COLLATION_CONNECTION */;
/*!40111 SET SQL_NOTES=@OLD_SQL_NOTES */;

-- Dump completed on 2017-05-09 15:28:03
